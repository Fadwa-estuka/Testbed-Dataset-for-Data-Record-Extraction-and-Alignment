define(["jquery-1","search/stats","search/util"],function(c,a,d){var b={config:{facetListSelector:"section.filters ol",facetHeaderSelector:"section.filters header",breakpoint:600},facetList:null,facetHeader:null,shortMore:null,longMore:null,toggleList:null,button:null,filterSize:null,init:function(){this.facetList=c(this.config.facetListSelector);this.facetHeader=c(this.config.facetHeaderSelector);this.shortMore=this.facetHeader.attr("data-title");this.longMore=this.facetHeader.attr("data-more-label");var e=this;if(document.addEventListener){c(window).on("resize",function(){e.detectSize()})}this.detectSize()},setupSmallScreen:function(){var e=this;this.resetLayout();this.toggleList=this.facetList;this.button=c('<a href="">'+this.shortMore+"</a>").on("click",function(f){f.preventDefault();e.toggle()});this.facetHeader.append(c("<p>"+this.getSelectedTitle()+"</p>"),this.button.append("<span></span>"));this.addTracking(this.toggleList.find("li"))},setupLargeSrceen:function(){var h=this;this.resetLayout();this.toggleList=c('<ol class="temp"></ol>');var f=c("<ol></ol>");this.button=c('<li class="more"></li>').append(c('<a href="">'+this.longMore+"<span></span></a>").on("click",function(k){k.stopPropagation();k.preventDefault();h.toggle()}));this.facetHeader.append(c("<p>"+this.shortMore+"</p>"),f);this.facetList.show();var j=this.getButtonWidth(f);var e=false;var i=f.width()-j-32;var g=0;this.facetList.find("li").each(function(m,n){if(i-c(n).width()>0){i=i-c(n).width();f.append(c(n).clone())}else{e=true;i=0;if(c(n).hasClass("selected")){var k=i;var l=c(n).width();do{k+=f.find("li").last().width();h.toggleList.prepend(f.find("li").last().detach());g+=k}while(k<l&&f.find("li").length>0);f.append(c(n).clone())}else{h.toggleList.append(c(n).clone());g+=c(n).width()}}});this.facetList.hide();if(e&&g>j){f.append(this.button);this.facetList.after(this.toggleList.hide())}else{if(e&&g<j){this.toggleList.find("li").each(function(k,l){f.append(c(l))})}}this.addTracking(this.toggleList.find("li"));this.addTracking(f.find("li"))},getButtonWidth:function(g){var e=this.button.clone();g.append(e);var f=e.width();e.remove();return f},resetLayout:function(){this.facetHeader.empty();c("ol.temp").remove();this.facetList.hide()},getSelectedTitle:function(){return this.facetList.find(".selected").first().text()},toggle:function(){var e=this;this.toggleList.stop().slideToggle(200,"swing",function(){if(c(this).is(":visible")){e.button.addClass("shown")}else{e.button.removeClass("shown")}})},detectSize:function(){if(c(window).width()<this.config.breakpoint){if(this.filterSize!="small"){this.setupSmallScreen();this.filterSize="small"}}else{this.setupLargeSrceen();this.filterSize="large"}},addTracking:function(e){e.each(function(){c(this).find("a").on("click",function(f){if(c(this).attr("href")!=""){a.setLabel("search_form","search-serp");a.setLabel("search_type","refinement");a.setLabel("search_filter_site",d.getParameterByName("filter",c(this).attr("href")));a.addExitLabels("search-filter-bar",this)}})})}};return b});