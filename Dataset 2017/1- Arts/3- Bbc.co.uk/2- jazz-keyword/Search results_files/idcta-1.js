/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.0.2
 */

(function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function n(e){W=e}function o(e){J=e}function i(){return function(){process.nextTick(l)}}function s(){return function(){H(l)}}function a(){var e=0,t=new $(l),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function u(){var e=new MessageChannel;return e.port1.onmessage=l,function(){e.port2.postMessage(0)}}function c(){return function(){setTimeout(l,1)}}function l(){for(var e=0;e<Y;e+=2){var t=V[e],r=V[e+1];t(r),V[e]=void 0,V[e+1]=void 0}Y=0}function d(){try{var e=require,t=e("vertx");return H=t.runOnLoop||t.runOnContext,s()}catch(e){return c()}}function f(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(e){return te.error=e,te}}function p(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}function v(e,t,r){J(function(e){var n=!1,o=p(r,t,function(r){n||(n=!0,t!==r?_(e,r):C(e,r))},function(t){n||(n=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&o&&(n=!0,E(e,o))},e)}function y(e,t){t._state===X?C(e,t._result):t._state===ee?E(e,t._result):T(t,void 0,function(t){_(e,t)},function(t){E(e,t)})}function k(e,r){if(r.constructor===e.constructor)y(e,r);else{var n=m(r);n===te?E(e,te.error):void 0===n?C(e,r):t(n)?v(e,r,n):C(e,r)}}function _(t,r){t===r?E(t,h()):e(r)?k(t,r):C(t,r)}function w(e){e._onerror&&e._onerror(e._result),b(e)}function C(e,t){e._state===Z&&(e._result=t,e._state=X,0!==e._subscribers.length&&J(b,e))}function E(e,t){e._state===Z&&(e._state=ee,e._result=t,J(w,e))}function T(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+X]=r,o[i+ee]=n,0===i&&e._state&&J(b,e)}function b(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n,o,i=e._result,s=0;s<t.length;s+=3)n=t[s],o=t[s+r],n?I(r,n,o,i):o(i);e._subscribers.length=0}}function x(){this.error=null}function A(e,t){try{return e(t)}catch(e){return re.error=e,re}}function I(e,r,n,o){var i,s,a,u,c=t(n);if(c){if(i=A(n,o),i===re?(u=!0,s=i.error,i=null):a=!0,r===i)return void E(r,g())}else i=o,a=!0;r._state!==Z||(c&&a?_(r,i):u?E(r,s):e===X?C(r,i):e===ee&&E(r,i))}function R(e,t){try{t(function(t){_(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}function P(e,t){var r=this;r._instanceConstructor=e,r.promise=new e(f),r._validateInput(t)?(r._input=t,r.length=t.length,r._remaining=t.length,r._init(),0===r.length?C(r.promise,r._result):(r.length=r.length||0,r._enumerate(),0===r._remaining&&C(r.promise,r._result))):E(r.promise,r._validationError())}function O(e){return new ne(this,e).promise}function S(e){function t(e){_(o,e)}function r(e){E(o,e)}var n=this,o=new n(f);if(!G(e))return E(o,new TypeError("You must pass an array to race.")),o;for(var i=e.length,s=0;o._state===Z&&s<i;s++)T(n.resolve(e[s]),void 0,t,r);return o}function U(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(f);return _(r,e),r}function D(e){var t=this,r=new t(f);return E(r,e),r}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(e){this._id=ue++,this._state=void 0,this._result=void 0,this._subscribers=[],f!==e&&(t(e)||M(),this instanceof N||F(),R(this,e))}function j(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;t&&"[object Promise]"===Object.prototype.toString.call(t.resolve())&&!t.cast||(e.Promise=ce)}var L;L=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H,W,q,G=L,Y=0,J=({}.toString,function(e,t){V[Y]=e,V[Y+1]=t,Y+=2,2===Y&&(W?W(l):q())}),Q="undefined"!=typeof window?window:void 0,B=Q||{},$=B.MutationObserver||B.WebKitMutationObserver,z="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,V=new Array(1e3);q=z?i():$?a():K?u():void 0===Q&&"function"==typeof require?d():c();var Z=void 0,X=1,ee=2,te=new x,re=new x;P.prototype._validateInput=function(e){return G(e)},P.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},P.prototype._init=function(){this._result=new Array(this.length)};var ne=P;P.prototype._enumerate=function(){for(var e=this,t=e.length,r=e.promise,n=e._input,o=0;r._state===Z&&o<t;o++)e._eachEntry(n[o],o)},P.prototype._eachEntry=function(e,t){var n=this,o=n._instanceConstructor;r(e)?e.constructor===o&&e._state!==Z?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(o.resolve(e),t):(n._remaining--,n._result[t]=e)},P.prototype._settledAt=function(e,t,r){var n=this,o=n.promise;o._state===Z&&(n._remaining--,e===ee?E(o,r):n._result[t]=r),0===n._remaining&&C(o,n._result)},P.prototype._willSettleAt=function(e,t){var r=this;T(e,void 0,function(e){r._settledAt(X,t,e)},function(e){r._settledAt(ee,t,e)})};var oe=O,ie=S,se=U,ae=D,ue=0,ce=N;N.all=oe,N.race=ie,N.resolve=se,N.reject=ae,N._setScheduler=n,N._setAsap=o,N._asap=J,N.prototype={constructor:N,then:function(e,t){var r=this,n=r._state;if(n===X&&!e||n===ee&&!t)return this;var o=new this.constructor(f),i=r._result;if(n){var s=arguments[n-1];J(function(){I(n,o,s,i)})}else T(r,o,e,t);return o},catch:function(e){return this.then(null,e)}};var le=j,de={Promise:ce,polyfill:le};"function"==typeof define&&define.amd?define("idcta/es6-promise",[],function(){return de}):"undefined"!=typeof module&&module.exports?module.exports=de:"undefined"!=typeof this&&(this.ES6Promise=de),le()}).call(this),define("idcta/apiUtils",["idcta/es6-promise","istats-1"],function(e,t){function r(e,t){var r=t.substring(0,t.indexOf("=")+1);return e.indexOf(r)!==-1?e:e+=e.indexOf("?")!==-1?"&"+t:"?"+t}function n(){try{var e=t.getSite();if(e)return e.split(" ").shift();var r=t._getLabels();return r&&r.app_name?r.app_name.split(" ").shift():(r.prod_name||"").split(" ").shift()}catch(e){s.logCaughtError(e)}}function o(){try{return"undefined"!=typeof Promise?Promise:e.Promise}catch(e){s.logCaughtError(e)}}function i(){this.promise={},this.resolver={}}var s={},a=36e5;return s.verifyEndpointUrl=function(e,t){try{t!==!1&&(t=!0);var r=/https?:\/\/(((www|ssl)(\.int|\.test|\.stage)?)|(pal\.sandbox\.dev))\.bbc\.(co\.uk|com)/;if(r.test(e))return/(\.com|\.co\.uk)\/.+/.test(e)&&(e=e.split(/(\.com|\.co\.uk)\/.+/)[0]+e.split(/(\.com|\.co\.uk)\/.+/)[1]),e;var n="";"https"==e.slice(0,5)?(n+=(t?"https://":"")+"ssl.",e.indexOf(".sandbox.")>-1&&(n+="sandbox.dev.")):(n+=t?"http://":"",n+=e.indexOf(".sandbox.")>-1?"pal.sandbox.dev.":"www.");for(var o=["int","test","stage"],i=0;i<o.length;i++)e.indexOf("."+o[i]+".")>-1&&(n+=o[i]+".");return n+=/\.co\.uk/.test(e)?"bbc.co.uk":"bbc.com"}catch(e){s.logCaughtError(e)}},s.alignTldWithHostname=function(e,t){try{var r=t||window.location.hostname,n=r.split(/(\.com|\.co\.uk)$/)[1],o=e.split(/(\.com|\.co\.uk)\/.+/)[1];return o!==n&&void 0!==n&&(e=e.replace(o,n)),e}catch(e){s.logCaughtError(e)}},s.appendProductToConfig=function(e){var t="",o="",i="userOrigin=",s="context=",a=n();return"undefined"!=typeof a&&""!==a&&(t=i+a,o=s+a,e.register_url=r(e.register_url,t),e.register_url=r(e.register_url,o),e.signin_url=r(e.signin_url,t),e.signin_url=r(e.signin_url,o),e.signout_url=r(e.signout_url,t),e.signout_url=r(e.signout_url,o),e.status_url=r(e.status_url,t),e.status_url=r(e.status_url,o),e.settings_url=r(e.settings_url,t),e.settings_url=r(e.settings_url,o)),e},s.appendProductToCtaElement=function(e){var t="",o="",i="userOrigin=",a="context=",u=e.getAttribute("href");if(u&&(u.indexOf(i)===-1||u.indexOf(a)===-1)){var c=n();if("undefined"!=typeof c&&""!==c){t=i+c,o=a+c;var l=e.getAttribute("href"),d=s.parseUrl(l);if(d){var f=s.parseQueryString(d.search);if(f.ptrt&&(f.ptrt.indexOf("%2Fregister%2Fthanks")||f.ptrt.indexOf("%2Faccount%2Fmore-details"))){var h=decodeURIComponent(f.ptrt);h=encodeURIComponent(r(r(h,t),o)),d.search=d.search.replace(encodeURIComponent(f.ptrt),h)}var g=d.pathname;d.pathname.indexOf("/")===-1&&(g="/"+d.pathname),e.setAttribute("href",d.protocol+"//"+d.host+g+r(r(d.search,t),o)+d.hash)}}}},s.addQueryParameter=r,s.Promise=o(),s.loadUrlInHiddenIframe=function(e,t,r){try{return new s.Promise(function(n,o){s.logMessage('Creating iframe {src: "'+e+'", timeout: '+t+(r?', expectedPostMessages: ["'+r.join('", "')+'"]}':"}"));var i=document.createElement("iframe");i.scrolling="no",i.frameborder="0",i.width="0px",i.height="0px",i.border="0px",i.style.display="none",i.style.frameBorder="0px",i.style.borderStyle="none";var a=null,u=function(e){var t=e.message?"message":"data";return e.origin.match(/\.bbc\.(co\.uk|com)(:[0-9]+)*$/)&&r.indexOf(e[t])!=-1?(s.logMessage('Iframe received message "'+e[t]+'", resolving'),c(),n(e[t])):void s.logMessage('Iframe received unexpected message "'+e[t]+'", ignoring')},c=function(){a&&clearTimeout(a),r&&s.removeEventListener("message",u),document.body.removeChild(i)};r?s.addEventListener("message",u):i.onload=function(){return s.logMessage('Iframe with src "'+e+'" loading complete'),c(),n()},t&&(a=setTimeout(function(){return s.logMessage("Iframe with src "+e+" timed out after "+t+" milli seconds"),c(),o()},t)),i.src=e,document.body.appendChild(i)})}catch(e){s.logCaughtError(e)}},s.addEventListener=function(e,t,r){s.addEventListenerTo(window,e,t,r)},s.addEventListenerTo=function(e,t,r,n){try{return e.addEventListener?e.addEventListener(t,r,n):(t="message"==t?"onmessage":t,e.attachEvent(t,r))}catch(e){s.logCaughtError(e)}},s.removeEventListener=function(e,t){s.removeEventListenerFrom(window,e,t)},s.removeEventListenerFrom=function(e,t,r){try{return e.removeEventListener?e.removeEventListener(t,r):(t="message"==t?"onmessage":t,e.detachEvent(t,r))}catch(e){s.logCaughtError(e)}},s.getEnvFromUrl=function(){try{var e=window.location.href;return e.indexOf(".sandbox.")>-1?".sandbox.dev":e.indexOf(".int.")>-1?".int":e.indexOf(".test.")>-1?".test":e.indexOf(".stage.")>-1?".stage":""}catch(e){s.logCaughtError(e)}},s.parseUrl=function(e){try{var t=document.createElement("a");return t.href=e,t.query=t.search?s.parseQueryString(t.search):{},t}catch(e){s.logCaughtError(e)}},s.parseQueryString=function(e){try{"?"===e.charAt(0)&&(e=e.substring(1));for(var t={},r=e.split("&"),n=0;n<r.length;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||"")}return t}catch(e){s.logCaughtError(e)}},s.timestampInFuture=function(e){try{var t=(new Date).getTime();return e>t}catch(e){s.logCaughtError(e)}},s.timestampExpired=function(e){try{var t=(new Date).getTime();return e<t}catch(e){s.logCaughtError(e)}},s.generateFutureTimestamp=function(e){try{e=e?e:a;var t=new Date;return t.setTime(t.getTime()+e),t.getTime()}catch(e){s.logCaughtError(e)}},s.logCaughtError=function(e){window.console&&e.message&&console.log(e)},s.logMessage=function(e){var t="ckns_debugtoken",r=document.cookie.match(new RegExp(t+"=([^;]+)"));r&&(window.tokenRefeshLog=window.tokenRefeshLog||[],window.tokenRefeshLog.push(e))},i.prototype.isSet=function(e){return"undefined"!=typeof this.resolver[e]},i.prototype.set=function(e,t){this.resolver[e]=t},i.prototype.get=function(e){function t(){var t=r.resolver[e];return"function"!=typeof t?s.Promise.reject(new TypeError("Promise resolver "+t+" is not a function for key "+e)):new s.Promise(t).then(function(t){return delete r.promise[e],delete r.pending,t},function(t){throw delete r.promise[e],delete r.pending,t})}var r=this;return this.promise[e]?this.promise[e]:this.pending?(this.promise[e]=this.pending.then(t,t),this.pending=this.promise[e],this.promise[e]):(this.promise[e]=t(),this.pending=this.promise[e],this.promise[e])},s.PromisePool=i,s}),define("idcta/id-config",["idcta/config","idcta/translations","idcta/apiUtils"],function(e,t,r){var n,o=window.location.host.split(".");n="co"===o[o.length-2]&&"uk"===o[o.length-1]?o[o.length-3]+".co.uk":o[o.length-2]+"."+o[o.length-1],e=r.appendProductToConfig(e);var i={register_url:r.alignTldWithHostname(e.register_url),signin_url:r.alignTldWithHostname(e.signin_url),signout_url:e.signout_url,status_url:e.status_url,settings_url:e.settings_url,tokenRefresh_url:r.alignTldWithHostname(e.tokenRefresh_url),tokenRefresh_signout_url:r.alignTldWithHostname(e.tokenRefresh_signout_url),announce_url:r.alignTldWithHostname(e.announce_url),"bbcid-v5":e["bbcid-v5"],idapp:{version:"",hostname:"",insecurehostname:"",tld:n},tokenRefresh:e.tokenRefresh||!1,tokenImprovement:e.tokenImprovement||"RED",idtranslations:{version:""},identity:{baseUrl:"",cookieAgeDays:e.identity.cookieAgeDays,accessTokenCookieName:e.identity.accessTokenCookieName,idSignedInCookieName:e.identity.idSignedInCookieName},idpurl:"",translation_signedout:t.translation_statusbar_signedout,translation_signedin:t.translation_statusbar_signedin,useOverlay:!1,ptrt:window.location.href,fallback:{config:e.fallback||!1,translations:t.fallback||!1}};return i.getConfigAsync=function(){try{return{then:function(e){return e(i)}}}catch(e){r.logCaughtError(e)}},i.getConfig=function(){return i},i}),define("idcta/idCookie",["idcta/id-config","idcta/apiUtils"],function(e,t){function r(){try{return a?(a.refreshCookie(),a):a=new s}catch(e){t.logCaughtError(e)}}function n(e){try{a=e}catch(e){t.logCaughtError(e)}}function o(e){try{var t=window.atob(e),r=t.lastIndexOf("}"),n=t.substring(0,r+1);return JSON.parse(n)}catch(e){return null}}function i(e,r,n,o){try{r=r||"";var i="";if(n){var s=new Date;s.setTime(s.getTime()+n),i="Expires="+s.toUTCString()+"; "}r=o?window.btoa(r):r,document.cookie=e+"="+r+"; "+i+"Domain="+d+"; Path=/"}catch(e){t.logCaughtError(e)}}function s(){function e(){r()}function r(){var e=new RegExp(f+"=([\\w]+)"),t=document.cookie.match(e);if(!t)return void u();var r=o(t[1]);return r&&s(r)&&!a(r)?(p.valid=!0,p.displayname=r.dn,void(p.timestamp=r["jwt-exp"])):void u()}function n(){var e=p.cookieAgeDays*c,t=(new Date).getTime();return t-p.timestamp>=e}function s(e){return e.hasOwnProperty("ps")&&e.hasOwnProperty("jwt-exp")&&e.hasOwnProperty("tkn-exp")&&(e.hy||e.hasOwnProperty("ses-exp"))}function a(e){var t=(new Date).getTime(),r=e["jwt-exp"]||0,n=r<=t;return n}function u(){p.valid=!1,p.id="",p.username="~",p.displayname="",p.timestamp="","RED"===l&&p.unsetCookie("ckns_id")}var p=this;this.valid=!1,this.id="",this.username="~",this.displayname="",this.timestamp="",this.cookieAgeDays=h,this.isIdv5On=!0,this.refreshCookie=function(){try{r()}catch(e){t.logCaughtError(e)}},this.hasCookie=function(){try{return n()&&u(),p.valid}catch(e){t.logCaughtError(e)}},this.hasAccessTokenExpired=function(){try{var e=this.getUserDetailsFromCookie();if(!e)return!0;var r=(new Date).getTime(),n=e["tkn-exp"]||0;return n<=r}catch(e){t.logCaughtError(e)}},this.hasJwtTokenExpired=function(){try{var e=this.getUserDetailsFromCookie();if(!e)return!0;var r=(new Date).getTime(),n=e["jwt-exp"]||0;return n<=r}catch(e){t.logCaughtError(e)}},this.isHybridApp=function(){try{var e=this.getUserDetailsFromCookie();return!!e&&(e.hy||!1)}catch(e){t.logCaughtError(e)}},this.getError=function(){try{var e=this.getUserDetailsFromCookie();return e?e.ec||null:null}catch(e){t.logCaughtError(e)}},this.getIdFromCookie=function(){try{var e=this.getUserDetailsFromCookie();return e?e.ps:null}catch(e){t.logCaughtError(e)}},this.getHidFromCookie=function(){return this.getCookie(m)},this.isPersonalisationEnabled=function(){try{var e=this.getUserDetailsFromCookie();return e&&e.ep}catch(e){return t.logCaughtError(e),!1}},this.getUserDetailsFromCookie=function(){try{if(!this.hasCookie())return null;var e=new RegExp(f+"=([\\w]+)"),r=document.cookie.match(e);if(!r)return null;var n=decodeURIComponent(r[1]).split("|"),i=o(n.toString());return i&&s(i)?i:null}catch(e){t.logCaughtError(e)}},this.getNameFromCookie=function(){try{return this.hasCookie()&&p.displayname&&""!==p.displayname?p.displayname.replace(/\+/g," "):null}catch(e){t.logCaughtError(e)}},this.getAccessToken=function(){try{if(!this.hasCookie())return null;var e=new RegExp(g+"=([^;]*)"),r=document.cookie.match(e);return null!==r?r[1]:null}catch(e){t.logCaughtError(e)}},this.getCookie=function(e,r){try{var n=new RegExp(e+"=([^\\s;]*)"),i=document.cookie.match(n);if(!i)return null;if(r!==!0)return i[1];var s=decodeURIComponent(i[1]);return o(s)}catch(e){t.logCaughtError(e)}},this.setCknsIdCookieProperty=function(e,r){try{var n=this.getUserDetailsFromCookie();if(!n)return;r?n[e]=r:delete n[e];var o=n["jwt-exp"]?n["jwt-exp"]:c*h;i(f,JSON.stringify(n),o,!0)}catch(e){t.logCaughtError(e)}},this.unsetCookie=function(e){try{document.cookie=e+"=; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Domain="+d+"; Path=/"}catch(e){t.logCaughtError(e)}},e()}var a,u={},c=864e5,l=e.tokenImprovement||"RED",d=e.idapp.tld,f=e.identity&&e.identity.idSignedInCookieName?e.identity.idSignedInCookieName:"ckns_id",h=e.identity&&e.identity.cookieAgeDays?e.identity.cookieAgeDays:730,g=e.identity&&e.identity.accessTokenCookieName?e.identity.accessTokenCookieName:"ckns_atkn",m="ckpf_sylphid";return u.getInstance=r,u.setInstance=n,u}),define("idcta/tokenRefresh",["idcta/id-config","idcta/idCookie","idcta/apiUtils"],function(e,t,r){function n(n,s){var a=t.getInstance(),u=new Date,d=u.getTime();r.logMessage("Token refresh "+d+" starting ["+u+"]");try{if("RED"!==c&&!a.hasCookie())return r.logMessage("Token refresh "+d+" rejected as ckns_id cookie is missing, invalid or expired!"),r.Promise.reject(new o);if(a.isHybridApp())return r.logMessage("Token refresh "+d+" rejected, hybrid app detected"),r.Promise.reject(new i);var f=a.getError();if(f&&r.timestampInFuture(f.retryAfter))return r.logMessage("Token refresh "+d+" rejected as there is error in cookie { code: "+f.code+', message: "'+f.message+'", retryAfter: '+f.retryAfter+"}"),r.Promise.reject(f);if("RED"===c&&a.hasJwtTokenExpired())return r.logMessage("Token refresh "+d+" rejected as JWT token has expired"),E().then(function(){throw new o});if(n!==!0&&!a.hasAccessTokenExpired())return r.logMessage("Token refresh "+d+" resolved without action as token has not expired"),r.Promise.resolve();if(n&&r.logMessage("Token refresh "+d+" forced even though token may not have expired"),v.isSet(s))r.logMessage("Token refresh "+d+" reusing existing promise in progress for "+s);else{var h=e.tokenRefresh_url;h=s?r.alignTldWithHostname(h,s):h,h=r.addQueryParameter(h,"tr="+d);var g=e.announce_url||"";g=s?r.alignTldWithHostname(g,s):g,g=r.addQueryParameter(g,"tr="+d),g=encodeURIComponent(g),h=h.replace(e.announce_url,g),v.set(s,function(e,t){r.loadUrlInHiddenIframe(h,l,p).then(e,t)})}var m=function(){r.logMessage("Token refresh "+d+" complete.")},T=function(e){throw r.logMessage("Token refresh "+d+" failed with error { code: "+e.code+', message: "'+e.message+'", retryAfter: '+e.retryAfter+"}"),e};return v.get(s).then(null,y).then(k).then(_).then(null,w).then(null,C).then(m,T)}catch(e){r.logCaughtError(e)}}function o(){this.code=401,this.message="Invalid session"}function i(){this.code=401,this.message="Unauthorised"}function s(e){this.code=500,this.message="Unauthorised",this.retryAfter=e?e:(new Date).getTime()+d}function a(e){this.code=408,this.message="Request timeout",this.retryAfter=e?e:(new Date).getTime()+d}function u(e){v=e}var c=e.tokenImprovement||"RED",l="ORANGE"===c?5e4:1e4,d=15e3,f=36e5,h="bbcidv5_token_success",g="error",m="invalid",p=[h,g,m],v=new r.PromisePool,y=function(){var n=(new Date).getTime()+(e.tokenRefresh?d:f),o=new a(n);throw t.getInstance().setCknsIdCookieProperty("ec",o),r.logMessage("Token refresh - timed out, error added to cookie, if cookie exists { code: "+o.code+', message: "'+o.message+'", retryAfter: '+o.retryAfter+"}"),o},k=function(e){if(e!==m)return e;throw r.logMessage("Token refresh - invalid session error"),new o},_=function(e){if(e===h)return e;var n=t.getInstance().getError();throw n?r.logMessage("Token refresh - unsuccessful, throwing error from cookie { code: "+n.code+', message: "'+n.message+'", retryAfter: '+n.retryAfter+"}"):r.logMessage("Token refresh - unsuccessful, no error found in cookie"),n},w=function(e){if(e)throw e;throw e=new s,t.getInstance().setCknsIdCookieProperty("ec",e),r.logMessage("Token refresh - Internal service error, error added to cookie, if cookie exists { code: "+e.code+', message: "'+e.message+'", retryAfter: '+e.retryAfter+"}"),e},C=function(e){if(e.code!=(new o).code)throw e;if(r.logMessage("Token refresh - Invalid session error, error added to cookie { code: "+e.code+', message: "'+e.message+'", retryAfter: '+e.retryAfter+"}"),"GREEN"===c)throw e;return E().then(function(){throw e})},E=function(){return r.logMessage("Token Refresh - signing out user"),r.loadUrlInHiddenIframe(e.tokenRefresh_signout_url,l).then(null,function(){r.logMessage("Token Refresh - Failed to sign out user!")})};o.prototype.name="InvalidSessionError",i.prototype.name="UnauthorisedError",s.prototype.name="InternalServiceError",a.prototype.name="RequestTimeoutError";var T={};return T.refreshAccessToken=n,T.setPromisePool=u,T.RETRY_AFTER_SHORT=d,T.RETRY_AFTER_LONG=f,T.MESSAGE_SUCCESS=h,T.MESSAGE_ERROR=g,T.MESSAGE_INVALID=m,T.RETRY_AFTER_SHORT=d,T.RETRY_AFTER_LONG=f,T}),define("idcta/idcta-1",["idcta/idCookie","idcta/id-config","idcta/apiUtils","idcta/tokenRefresh"],function(e,t,r,n){function o(t){try{this.id=t.id,this.element=document.getElementById(t.id),this.states=t.states;var n=this;f.ctas[n.id]=n,t.publiclyCacheable===!0&&(e.getInstance().hasCookie()?s(n):n.element.getElementsByTagName("span")[0].innerHTML=n.states.unauthorised.signedout)}catch(e){r.logCaughtError(e)}}function i(e){var t=document.querySelectorAll("#"+e),n=function(){r.appendProductToCtaElement(this)};if(t.length)for(var o=0;o<t.length;o++)for(var i=t[o].getElementsByTagName("a"),s=0;s<i.length;s++)r.addEventListenerTo(i[s],"click",n,!1)}function s(t){if(t.states.authorised){var r=e.getInstance().getNameFromCookie(),n=t.states.authorised.anonymous;r&&(n=t.states.authorised.name.replace("{name}",r)),t.element.getElementsByTagName("span")[0].innerHTML=n}else t.element.parentNode&&t.element.parentNode.removeChild(t.element)}function a(e,t){try{return e=e===!0,n.refreshAccessToken(e,t)}catch(e){r.logCaughtError(e)}}function u(){try{return f.initiateTokenRefresh().then(function(){return!0},function(){throw!1})}catch(e){r.logCaughtError(e)}}function c(e,t,n){try{var o=document.querySelector("#"+e+" span"),i=["small","medium","large"],s=["blue","white","gray"];i.indexOf(t)>-1&&(o.className=o.className.replace(/small|medium|large/g,t)),s.indexOf(n)>-1&&(o.className=o.className.replace(/blue|white|gray/g,n));var a=document.querySelectorAll("#"+e+" span a");for(var u in a)a.hasOwnProperty(u)&&r.appendProductToCtaElement(a[u])}catch(e){r.logCaughtError(e)}}function l(e,t){try{var n=document.querySelectorAll("#"+e+" a");if(!n.length)throw"No cta elements found with provided Id";for(var o in n)if(n.hasOwnProperty(o)){var i=n[o].getAttribute("href"),s=decodeURIComponent(i).match(/ptrt\=([a-zA-Z:\/\/\_\\0-9.-]*)&?/).pop();s=encodeURIComponent(s);var a=i.substring(0,i.indexOf(s)),u=i.substring(i.indexOf(s)+s.length);n[o].setAttribute("href",a+t+u),r.appendProductToCtaElement(n[o])}}catch(e){r.logCaughtError(e)}}function d(){try{var t={},n=e.getInstance();if(!n.hasCookie())return t;if(t.bbc_identity="1",!n.isPersonalisationEnabled())return t;var o=n.getHidFromCookie();return o&&(t.bbc_hid=o),t}catch(e){return r.logCaughtError(e),{}}}var f={signals:{},ctas:{}};return f.Cta=o,f.modifyCta=c,f.modifyPtrt=l,f.addUserOrigin=i,f.initiateTokenRefresh=a,f.initiateUserUplift=u,f.getIStatsLabels=d,f.hasCookie=function(){return e.getInstance().hasCookie()},f.getCookieInstance=function(){return e.getInstance()},f.getIdFromCookie=function(){return e.getInstance().getIdFromCookie()},f.getUserDetailsFromCookie=function(){return e.getInstance().getUserDetailsFromCookie()},f.getNameFromCookie=function(){return e.getInstance().getNameFromCookie()},f.getAccessToken=function(t){return e.getInstance().getAccessToken(t)},f});