define(["jquery-1","search/stats","search/util"],function(c,b,d){var a={config:{paginator_selector:"nav.pagination",results_selector:"ol.search-results",timeout:5000,resultsPerPage:10,keyPrefix:"bbc.search-pagecontent.",localStorageCacheTime:10*60*1000},init:function(){var e=this;if(this.getPage()<this.getPageTotal()){this.getPaginator().prepend(this.getMoreBtn(),this.loading);this.getMoreBtn().on("click",function(f){f.preventDefault();e.getResults()})}else{this.getPaginator().hide()}c(window).unload(function(){localStorage[e.getStoreKey()+"_pos"]=c("body").scrollTop()});if(window.location.hash.indexOf("page")>-1){this.preload()}this.cleanupStorage();this.config.baseUrl=this.getBaseUrl();this.config.keyPrefix=this.getKeyPrefix()},paginator:null,page:null,pageTotal:null,moreLabel:null,errorLabel:null,moreBtn:null,loading:c('<span class="loading"></span>').hide(),getPaginator:function(){if(this.paginator===null){this.paginator=c(this.config.paginator_selector)}return this.paginator},getPage:function(){if(this.page===null){this.page=parseInt(this.getPaginator().attr("data-page"))+1}return this.page},getPageTotal:function(){if(this.pageTotal===null){this.pageTotal=Math.ceil(parseInt(c(this.config.results_selector).attr("data-total-results"))/this.config.resultsPerPage)}return this.pageTotal},getMoreLabel:function(){if(this.moreLabel===null){this.moreLabel=this.getPaginator().attr("data-more-label")}return this.moreLabel},getErrorLabel:function(){if(this.errorLabel===null){this.errorLabel=this.getPaginator().attr("data-error-label")}return this.errorLabel},getMoreBtn:function(){if(this.moreBtn===null){var e=this;this.moreBtn=c('<a href=""></a>').addClass("more").text(e.getMoreLabel())}return this.moreBtn},getResults:function(g){var f=this;g=(typeof g!=="undefined")?g:this.getPage();var e=this.config.baseUrl+"?page="+this.getPage()+"&"+window.location.search.substr(1);c.ajax({url:e,timeout:f.config.timeout,beforeSend:function(){f.getMoreBtn().hide();f.loading.show().css("display","block")}}).done(function(h){f.getMoreBtn().text(f.getMoreLabel());f.showNext(h)}).fail(function(){f.getMoreBtn().text(f.getErrorLabel());f.getMoreBtn().show();f.loading.hide()})},getBaseUrl:function(){return this.getPaginator().attr("data-pagination-url")},getKeyPrefix:function(){return d.getSearchContent().attr("data-storage-prefix")},showNext:function(e){this.getPaginator().before(e);window.location.replace("#page="+this.getPage());this.store(e);b.setLabel("page_num",this.getPage());b.logInteraction("click","show-more");d.getSearchResults().each(function(f,g){c(g).find("a").click(function(h){b.resultClick("organic",this,h)})});this.page++;if(this.getPage()<=this.getPageTotal()){this.getMoreBtn().show()}this.loading.hide()},store:function(e){if(Modernizr.localstorage){localStorage[this.getStoreKey()]!=undefined?localStorage[this.getStoreKey()]+=e:localStorage[this.getStoreKey()]=e;localStorage[this.getStoreKey()+"_time"]=(new Date).getTime()}},getStoreKey:function(){return this.config.keyPrefix+d.hashCode(d.getSearchTerm())},cleanupStorage:function(){var f;for(var e in localStorage){if(e.indexOf("_time")>-1){if(e-(new Date).getTime()+this.config.localStorageCacheTime<0){f=e.split("_")[0];localStorage.removeItem(f+"_time");localStorage.removeItem(f+"_pos");localStorage.removeItem(f)}}}},preload:function(){this.page=parseInt(window.location.hash.split("=")[1]);if(Modernizr.localstorage){if(localStorage[this.getStoreKey()+"_time"]<(new Date).getTime()+this.config.localStorageCacheTime&&localStorage[this.getStoreKey()]!="undefined"&&this.page>1){this.getPaginator().before(localStorage[this.getStoreKey()]);d.getSearchResults().each(function(e,f){c(f).find("a").click(function(g){b.resultClick("organic",this,g)})});c("body").scrollTop(localStorage[this.getStoreKey()+"_pos"]);this.page++;return true}else{return localStorage.removeItem(this.getStoreKey())||true}}}};return a});