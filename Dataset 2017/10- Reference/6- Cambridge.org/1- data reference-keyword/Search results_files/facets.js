function applyFacetFilters(){var urlParams=urlUtil.getUrlParams(),$webSubjCbs=$("input.pivotCb:checked").closest("li.thirdLvlFacetList").find(".webSubjectCb:not(:checked)");$("#webSubjects").closest("div.optionsHidden").show(),$.each($webSubjCbs,function(index,element){var $webSubjectCb=$("#"+$(element).attr("id"));$webSubjectCb.closest(".thirdLvlFacetList").find("input.pivotCb:checked").length===$webSubjectCb.closest(".thirdLvlFacetList").find("input.pivotCb").length?($webSubjectCb.attr("checked","checked"),$webSubjectCb.removeClass("webSubjectGreyed")):($webSubjectCb.removeAttr("checked"),$webSubjectCb.addClass("webSubjectGreyed"))}),$.isArray(urlParams["expandedMoreOptions[]"])&&$.each(urlParams["expandedMoreOptions[]"],function(key,val){var $list=$('ul[data-facet-title="'+decodeURIComponent(val.replace(/_/g," "))+'"]');$list.find(".extraFacetOptions").show(),$list.find("label.showMoreFacets span").text("Show Less")}),$.isArray(urlParams["thirdLvlFacetsExpand[]"])&&$.each(urlParams["thirdLvlFacetsExpand[]"],function(key,val){var $ulElement=$('ul[data-facet-title="'+decodeURIComponent(val)+'"]');$ulElement.show(),$ulElement.parent().find("i").removeClass("fa-angle-down").addClass("fa-angle-up")}),$.isArray(urlParams["openOptions[]"])&&$.each(urlParams["openOptions[]"],function(key,val){var $expanded2ndLvlFacets=$('ul[id="'+decodeURIComponent(val)+'"]').closest(".webSubject").find("h3 a");$expanded2ndLvlFacets.addClass("open"),$expanded2ndLvlFacets.closest("div.webSubject").find(".optionsHidden:first").show()}),$(".webSubject h3 a").on("click",function(){$(this).hasClass("open")?urlUtil.updateQueryStringParameter(window.location.href,"openOptions[]",$(this).closest(".webSubject").find("ul.options").attr("id"),!0):urlUtil.removeQueryStringParameter(window.location.href,"openOptions[]",$(this).closest(".webSubject").find("ul.options").attr("id"),!0)})}var UrlUtil=function(){var _re_escape_regex=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\","$","^","-"].join("|\\")+")","g");this.updateQueryStringParameter=function(uri,key,value,applyURL){var re=getQueryStringRegex(uri,key,value),i=uri.indexOf("#"),hash=-1===i?"":uri.substr(i);value=encodeURIComponent(value);var separator=-1!==uri.indexOf("?")?"&":"?";return uri=uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value,uri=uri.replace(hash,""),applyURL&&window.history.pushState(null,window.location.title,uri+hash),uri+hash},this.removeQueryStringParameter=function(uri,key,value,applyURL){var regex=getQueryStringRegex(uri,key,value),index=uri.indexOf("#"),hash=-1===index?"":uri.substr(index);return uri=uri.replace(hash,""),uri.match(regex)&&(uri=uri.replace(regex,"$1")),uri=uri.replace(/&$/,""),applyURL&&window.history.pushState(null,window.location.title,uri+hash),uri+hash},this.getUrlParams=function(){var params={};if(location.search)for(var parts=location.search.substring(1).split("&"),i=0;i<parts.length;i++){var nv=parts[i].split("=");nv[0]&&(-1!==nv[0].indexOf("[]")?$.isArray(params[nv[0]])?params[nv[0]].push(nv[1]||!0):params[nv[0]]=[nv[1]||!0]:params[nv[0]]=nv[1]||!0)}return params};var getQueryStringRegex=function(uri,key,value){var regex;value=encodeURIComponent(value);var regexKey=fnEscapeRegex(key),regexVal=fnEscapeRegex(value);return regex=key.indexOf("[]")>0?new RegExp("([?&])"+regexKey+"="+regexVal+"(&|$)","i"):new RegExp("([?&])"+regexKey+"=.*?(&|$)","i")},fnEscapeRegex=function(sVal){return sVal.replace(_re_escape_regex,"\\$1")}},urlUtil=new UrlUtil;!function($){"use strict";$(document).ready(function(){applyFacetFilters()}),$(document).on("click",".showMoreFacets",function(){var $optionsHolder=$(this).closest("ul"),$moreOptionLink=$(this).find("span"),dataFacetTitle=$optionsHolder.attr("data-facet-title").replace(/ /g,"_");0===$optionsHolder.find(".extraFacetOptions:visible").length?($optionsHolder.find(".extraFacetOptions").show(),$moreOptionLink.text($moreOptionLink.text().replace("More","Less")),urlUtil.updateQueryStringParameter(window.location.href,"expandedMoreOptions[]",dataFacetTitle,!0)):($optionsHolder.find(".extraFacetOptions").hide(),$moreOptionLink.text($moreOptionLink.text().replace("Less","More")),urlUtil.removeQueryStringParameter(window.location.href,"expandedMoreOptions[]",dataFacetTitle,!0))}),$(document).on("click","#clearAllFilters",function(){var $filtersForm=$("#filtersForm"),$checkBoxes=$filtersForm.find("input[type=checkbox]"),$hiddenFields=$filtersForm.find("input[type=hidden]");$checkBoxes.removeAttr("checked"),$checkBoxes.removeAttr("checked"),$hiddenFields.remove(),$filtersForm.submit()})}(jQuery);