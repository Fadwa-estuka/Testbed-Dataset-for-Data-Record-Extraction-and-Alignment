YUI.add('patch-3141-datatype-xml-parse',function(Y,NAME){Y.mix(Y.namespace("XML"),{parse:function(data){var xmlDoc=null,win;if(typeof data==="string"){win=Y.config.win;if(win.ActiveXObject!==undefined){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(data);}else if(win.DOMParser!==undefined){xmlDoc=new DOMParser().parseFromString(data,"text/xml");}else if(win.Windows!==undefined){xmlDoc=new Windows.Data.Xml.Dom.XmlDocument();xmlDoc.loadXml(data);}}
if(xmlDoc===null||xmlDoc.documentElement===null||xmlDoc.documentElement.nodeName==="parsererror"){}
return xmlDoc;}});Y.namespace("Parsers").xml=Y.XML.parse;Y.namespace("DataType");Y.DataType.XML=Y.XML;},'3.14.2');;YUI.add('datasource-randomize',function(Y){function Randomizable(){this._callback={};}
Randomizable.prototype={}
Randomizable.prototype._osetInterval=Y.DataSource.Local.prototype.setInterval;Randomizable.prototype.setInterval=function(msec,callback){if(typeof callback!=='undefined'){this._callback=callback;}
var fn=Y.bind(function(){var _s=this.get('source');if(_s.indexOf('?')>-1&&_s.indexOf('random=')>-1){var _sp=_s.indexOf('random='),_ep=_s.length;if(_s.substring(_sp).indexOf('&')>-1||_s.substring(_sp).indexOf('&amp;')>-1){_ep=((_s.substring(_sp).indexOf('&amp;')>-1)?(_s.substring(_sp).indexOf('&amp;')+_sp):(_s.substring(_sp).indexOf('&')+_sp))}
_ep=(_s.substring(0,_sp).lastIndexOf('&')==_s.substring(0,_sp).length-1&&_s.substring(_ep).indexOf('&')===0)?_ep+1:_ep;this.set('source',(_s.substring(0,_sp)+_s.substring(_ep)+(((_s.substring(0,_sp)+_s.substring(_ep)).lastIndexOf('&')===(_s.substring(0,_sp)+_s.substring(_ep)).length-1)||(_s.substring(0,_sp)+_s.substring(_ep)).length==0?'':'&')));}
var _cr=(_s.indexOf('?')<0)?'?':'';_cr+=('random='+(new Date().getTime()));this._callback.request=_cr;},this);this.on('response',fn);fn();return this._osetInterval(msec,this._callback);};Y.augment(Y.DataSource.Local,Randomizable,true);},"3.1.1",{requires:['oop','datasource','datasource-local','datasource-polling']});;YUI.add('scorestrip-event',function(Y){var Constants=nfl.constants,YDataSchemaXML=Y.DataSchema.XML,YArray=Y.Array;Y.ScoreStripEngine={GC_VIDEO_ADDED:"gamecenter:video:added",UPDATE:"scorestrip-engine:update"};function parseBoolString(value){return value&&value!=="0";}
function toInt(value){return parseInt(value,10);}
function ScoreStrip(){ScoreStrip.superclass.constructor.apply(this,arguments);}
function GameAlert(){GameAlert.superclass.constructor.apply(this,arguments);}
GameAlert=Y.extend(GameAlert,Y.Widget,{_visibleStyles:{left:{left:'0px'},right:{right:'0px'}},_hiddenStyles:{left:{left:'-226px'},right:{right:'-226px'}},initializer:function(config){this.set('gameMetaData',config.gameMetaData);this.set('queue',new Y.AsyncQueue());this.publish(Y.ScoreStripEngine.GC_VIDEO_ADDED,{emitFacade:true,broadcast:2});this.publish(GameAlert.GC_ALERT_CLICK,{emitFacade:true,broadcast:2});},_onTeamsData:function(response){console.info('ScoreBoard->_onTeamsData',response.data);var _tdata=Y.JSON.parse(response.data.responseText);this.set('teamData',_tdata);},addEvents:function(items){Y.Array.each(items,function(item){this._addEventToQueue(item);},this);if(true){this.get('queue').run();}},_addEventToQueue:function(item){if(typeof this.get('history')[item.id]!=='undefined'){return;}
var _cb={fn:Y.bind(this.showEvent,this,item),until:Y.bind(this.hasExecuted,this,item),timeout:1000};this.get('queue').add(_cb);},eventDisplayed:function(item){if(typeof this.get('history')[item.id]!=='undefined'){return true;}
return false;},showEvent:function(item){if(typeof this.get('executing')[item.id]!=='undefined'){return;}
this.set('executing.'+item.id,true);item.href=(((item.bpType).toLowerCase())=='big-play')?this.get('gameMetaData').link:this.get('gameMetaData').link+'#menu=highlights';console.info('GameAlert->showEvent',item,this.get('gameMetaData'));this.get('contentBox').setData('alertType',(item.bpType).toLowerCase()).setData('alertItem',item).setContent(Y.substitute(this.get('template'),item));this.showBigPlay(item);if(((item.bpType).toLowerCase()==='igh'||(item.bpType).toLowerCase()==='ih')&&this.onLinksGameCenter(item.gameId)){try{this.fire(Y.ScoreStripEngine.GC_VIDEO_ADDED,item);}
catch(e){Y.log('Could not notify Game Center: '+e.message);}}},onClick:function(event){if(!nfl.constants.IS_MOBILE){if(this.onLinksGameCenter(event.currentTarget.getData('alertItem').gameId)&&this.isHighlight(event)){try{this.fire(GameAlert.GC_ALERT_CLICK,event.currentTarget.getData('alertItem'));}catch(e){}}else if(!this.onLinksGameCenter(event.currentTarget.getData('alertItem').gameId)){window.open(event.currentTarget.getData('alertItem').href,'_top');}}
event.preventDefault();},onLinksGameCenter:function(gameid){return((new String(window.location)).indexOf('/gamecenter/'+gameid+'/')>-1);},isHighlight:function(event){return((event.currentTarget.getData('alertType')==='igh'||event.currentTarget.getData('alertType')==='ih')?true:false)},isBigPlay:function(event){return(event.currentTarget.getData('alertType')==='big-play');},showBigPlay:function(item){this.get('contentBox').transition(this._visibleStyles[this.get('align')],Y.bind(function(item){setTimeout(Y.bind(this.hideBigPlay,this,item),this.get('duration')*1000);},this,item));},hideBigPlay:function(item){this.get('contentBox').transition(this._hiddenStyles[this.get('align')],Y.bind(this.onCompleted,this,item));},onCompleted:function(item){this.set('history.'+item.id,item.id);this.set('executing.'+item.id,false);},isExecuting:function(item){return((typeof this.get('executing')[item.id]!=='undefined'&&this.get('executing')[item.id]!==false)?true:false);},hasExecuted:function(item){return((typeof this.get('executing')[item.id]!=='undefined'&&this.get('executing')[item.id]===false)?true:false);},syncUI:function(){this.get('contentBox').setStyles(this._hiddenStyles[this.get('align')]).on('click',Y.bind(this.onClick,this));},destructor:function(){}},{NAME:'nfl-scorestrip-event-alert',ATTRS:{gameMetaData:{value:{}},teamsData:{value:null},executing:{value:{}},history:{value:{}},queue:{value:null},template:{value:'<a class="headline" href="{href}" target="_top"><span>{headline}</span></a>'},duration:{value:5},align:{value:''}},GC_ALERT_CLICK:"gamecenter:alert:click"});Y.namespace('NFL').ScoreStrip=Y.extend(ScoreStrip,Y.Widget,{initializer:function(config){this.set('datasource',(new Y.DataSource.IO({source:this.get("url")})));this.set('requestConfig',{callback:{success:Y.bind("_onSuccess",this),failure:Y.bind("_onFailure",this)}});this._bbxy=-1;},_onFailure:function(response){},_getQuarter:function(q){switch(q.toUpperCase()){case"P":return this.get('day');case"1":case"2":case"3":case"4":return'Q'+q;case"H":return'HALF';case"F":return'FINAL';case"FO":return"FINAL OT";}
return"OT";},_getGameState:function(data){switch(data.quarter){case"P":return"PRE";case"F":return"POST";case"FO":return"POST";default:return"ACTIVE";}},_getGameLink:function(data){var _s=Constants.SITE_URL+'/scores';try{if(data.visitorTeamNickname&&data.homeTeamNickname){var matchup=data.visitorTeamNickname.replace(/ /g,'-').toLowerCase()+'@'+data.homeTeamNickname.replace(/ /g,'-').toLowerCase();_s=Constants.SITE_URL+'/gamecenter/'+data.gameId+'/'+this.get('metaData').year+'/';_s+=this.get('eventType')==='PRO'?'PRO21/':'POST22/';_s+=matchup;}}catch(e){console.log('_getGameLink error: '+data.visitorTeamAbbr+','+data.homeTeamAbbr,e);}
return _s;},_pollForUpdates:function(data){if(this._getGameState(data)==='PRE'||this._getGameState(data)==='ACTIVE'){if(this._getGameState(data)==='PRE'){if(this.get('metaData')!==null){if(this.get('metaData').gameDay===false){return false;}}}
return true;}
return false;},_onSuccess:function(response){try{var text=response.data.responseText,xml=response.data.responseXML,gamesSchema=this.get('gamesSchema'),gmsNode=xml.getElementsByTagName('gms')[0],gmsAttributes=gmsNode.attributes,meta={week:gmsAttributes.getNamedItem("w").value,year:gmsAttributes.getNamedItem("y").value,ballotOpen:gamesSchema.metaFields.ballotOpen.parser(gmsAttributes.getNamedItem("bf").value),seasonType:gamesSchema.metaFields.seasonType.parser(gmsAttributes.getNamedItem("t").value),gameDay:gamesSchema.metaFields.gameDay.parser(gmsAttributes.getNamedItem("gd").value)},games=YDataSchemaXML.apply(this.get('gamesSchema'),xml);}catch(err){console.error('scorestrip: '+err.message);return;}
if(this._gameData!==text){this._gameData=text;this.set('metaData',meta);if(this.get('gameIndex')<0){this.set('gameIndex',this._getGameIndexByType(games.results,this.get('eventType')));}
this.set('gameData',this._getGameByType(games.results,this.get('eventType')));this._render(this.get('gameData'));this.addEventsToGameAlertWidgets(xml);if(this._pollForUpdates(this.get('gameData'))&&!this.get('isActive')){this.get('datasource').setInterval((this.get('interval')*1000),this.get('requestConfig'));this.set('isActive',true);}}},_render:function(data){var _output='',homeArr=data.homeTeamName.split(' '),visitorArr=data.visitorTeamName.split(' '),homeLogo,visitorLogo;if(this.get('eventType')==='PRO'){homeArr=data.homeTeamNickname.split(' ');visitorArr=data.visitorTeamNickname.split(' ');}
data.time=data.day+' '+data.startTime+'PM EST '+data.network;data.q=this._getQuarter(data.quarter);data.ht_class='';data.vt_class='';data.evtClass='state-'+(this._getGameState(data)).toLowerCase();if(data.homeTeamAbbr==='AFC'||data.visitorTeamAbbr==='AFC'){data.conference='conference';data.homeMascot=homeArr[0];data.visitorMascot=visitorArr[0];data.homeCity='';data.visitorCity='';}else{data.conference='';data.homeMascot=homeArr.pop();data.visitorMascot=visitorArr.pop();data.homeCity=homeArr.join(' ');data.visitorCity=visitorArr.join(' ');}
data.homeTeamScoreDivs='';data.visitorTeamScoreDivs='';data.homeTeamScoreStr=((data.homeTeamScore<10)?'0'+data.homeTeamScore:data.homeTeamScore);data.visitorTeamScoreStr=((data.visitorTeamScore<10)?'0'+data.visitorTeamScore:data.visitorTeamScore);data.homeTeamScoreDivs=data.homeTeamScoreStr;data.visitorTeamScoreDivs=data.visitorTeamScoreStr;if(Modernizr.svg){homeLogo=nfl.constants.IMAGE_PATH+'/img/logos/svg/teams-matte/'+data.homeTeamAbbr+'.svg';visitorLogo=nfl.constants.IMAGE_PATH+'/img/logos/svg/teams-matte/'+data.visitorTeamAbbr+'.svg';}else{homeLogo=nfl.constants.IMAGE_PATH+'/img/logos/teams-matte-69x47/'+data.homeTeamAbbr+'.png';visitorLogo=nfl.constants.IMAGE_PATH+'/img/logos/teams-matte-69x47/'+data.visitorTeamAbbr+'.png';}
data.homeTeamLogo='<img src="'+homeLogo+'"/>';data.visitorTeamLogo='<img src="'+visitorLogo+'"/>';data.quarterclock=((Y.Lang.isNumber(parseInt(data.quarter)))?(data.q+'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+(data.clockTime?data.clockTime:'')):(data.q));var gclink=this._getGameLink(data);data.gclink=((data.gameId!=='')?'<a href="'+gclink+'" target="_top" class="gc-anchor">GAME CENTER &gt;</a>':'');data.sslink=(data.gameId!=='')?gclink:'';if(data.possessionTeam===data.homeTeamAbbr){data.ht_class+=((data.inRedzone)?' in-pos in-rz':' in-pos');}
if(data.possessionTeam===data.visitorTeamAbbr){data.vt_class+=((data.inRedzone)?' in-pos in-rz':' in-pos');}
if(this.get('metaData').ballotOpen===true){data.evtClass+=' ballot-open';data.ballotUrl=this.get('ballotUrl');}
_output=Y.substitute(this.get('template'),data);this.get('targetNode').setContent(_output);this.get('targetNode').get('parentNode').set('className',data.evtClass);this.createGameAlertWidgets(data);},createGameAlertWidgets:function(data){var _gData=this.get('metaData'),node;_gData['link']=this._getGameLink(data);if(this.get('gameAlertH')===null){node=Y.one('#game-alert-h');if(node!==null){this.set('gameAlertH',new GameAlert({srcNode:node,gameMetaData:_gData,align:'right',render:true}));}}
if(this.get('gameAlertV')===null){node=Y.one('#game-alert-v');if(node!==null){this.set('gameAlertV',new GameAlert({srcNode:node,gameMetaData:_gData,align:'left',render:true}));}}},addEventsToGameAlertWidgets:function(xml){var bigplays=YDataSchemaXML.apply(this.get('bigPlaysSchema'),xml);var highlights=YDataSchemaXML.apply(this.get('highlightsSchema'),xml);this.set('bigplaysData',this._getBPForGame(bigplays.results,this.get('gameData').gameId));this.set('highlightsData',this._getBPForGame(highlights.results,this.get('gameData').gameId));if(this.get('gameAlertH')!==null&&this.get('gameAlertV')!==null){var _htEvents=[];var _vtEvents=[];for(_evtk in this.get('bigplaysData')){var _gevt=this.get('bigplaysData')[_evtk];for(var _prop in this.get('gameData')){_gevt[_prop]=this.get('gameData')[_prop];}
if(_gevt.team===this.get('gameData').homeTeamAbbr){_htEvents[_htEvents.length]=_gevt;}
if(_gevt.team===this.get('gameData').visitorTeamAbbr){_vtEvents[_vtEvents.length]=_gevt;}}
for(_evtk in this.get('highlightsData')){var _gevt=this.get('highlightsData')[_evtk];for(var _prop in this.get('gameData')){_gevt[_prop]=this.get('gameData')[_prop];}
if(_gevt.team===this.get('gameData').homeTeamAbbr||_gevt.team===''||_gevt.team===null||typeof _gevt.team==='undefined'){_htEvents[_htEvents.length]=_gevt;}
if(_gevt.team===this.get('gameData').visitorTeamAbbr){_vtEvents[_vtEvents.length]=_gevt;}}
this.get('gameAlertH').addEvents(_htEvents);this.get('gameAlertV').addEvents(_vtEvents);}},_getGameByType:function(results,type){var _game=YArray.find(results,function(result,index,array){return(result.gameType===type);},results);return _game;},_getGameIndexByType:function(results,type){var _ind=0;YArray.each(results,function(result,index,array){if(result.gameType===type){_ind=index;}});return _ind;},_getBPForGame:function(results,id){var o={};Y.Array.each(results,function(r){if(r.gameId===id){o[r.id]=r;}});return o;},renderUI:function(){this.get('boundingBox').toggleClass('mobile',nfl.constants.IS_MOBILE);var cb=this.get('contentBox');cb.addClass('nfl-scorestrip-event-'+(this.get('eventType')).toLowerCase());cb.setContent('<div id="ss-container" class="ss-container"><div id="ss-content"></div><div id="game-alert-h" class="game-alert"></div><div id="game-alert-v" class="game-alert"></div></div>');},_onScroll:function(){var bbx=this.get("boundingBox"),winY=bbx.get("docScrollY");if(this._fixed&&winY<=this._bbxy){this._fixed=false;bbx.removeClass(this._fixedClass);if(Y.UA.ie){bbx.ancestors("div",false).setStyles({position:null,zIndex:null});}}else if(!this._fixed&&winY>this._bbxy){this._fixed=true;bbx.addClass(this._fixedClass);if(Y.UA.ie){bbx.ancestors("div",false).setStyles({position:"relative",zIndex:999});}}},bindUI:function(){this.set('targetNode',this.get('contentBox').one('#ss-content'));Y.delegate('click',function(e){var target=e.currentTarget;if(target.hasClass('gc-anchor')||target.hasClass('ss-link')){if(s_analytics&&this.get('gameData')){s_analytics.linkTrackVars="events,eVar12";s_analytics.linkTrackEvent="event50";s_analytics.events="event50";s_analytics.eVar12="ss-tile 1-"+this.get('gameData').visitorTeamAbbr.toLowerCase()+"@"+this.get('gameData').homeTeamAbbr.toLowerCase();s_analytics.tl(this,'o',s_analytics.eVar12);}}},'.'+this.getClassName('content'),'a',this);this._scrollHandler=Y.on("scroll",this._onScroll,Y.config.win,this);},syncUI:function(){this.get('datasource').sendRequest(this.get('requestConfig'));this._bbxy=this.get("boundingBox").getY();this._fixedClass=this.getClassName("fixed");this._fixed=false;this._onScroll();},destructor:function(){}},{NAME:'nfl-scorestrip-event',ATTRS:{datasource:{value:null},eventType:{value:nfl.constants.SS_TYPE},metaData:{value:null},gameIndex:{value:-1},gameData:{value:null},bigplaysData:{value:null},highlightsData:{value:null},interval:{value:15},isActive:{value:false},gameAlertH:{value:null},gameAlertV:{value:null},targetNode:{value:null},url:{readOnly:true,value:'/liveupdate/scorestrip/postseason/ss.xml?'+('random='+(new Date().getTime()))},ballotUrl:{value:nfl.constants.SITE_URL+'/mvp'},type:{value:''},week:{value:null},gameCenter:{value:false},template:{value:'<div id="game-tile-h" class="game-tile{ht_class}"><div class="city">{homeCity}</div><div class="mascot {conference}">{homeMascot}</div><div class="pill">{homeTeamLogo}</div><div class="score">{homeTeamScoreDivs}</div><div class="pi"></div><div class="rz">RED ZONE</div></div>'+' <div class="jewel"><div class="quarter">{quarterclock}</div><div class="time">{time}</div></div>'+' <div id="game-tile-v" class="game-tile{vt_class}"><div class="city">{visitorCity}</div><div class="mascot {conference}">{visitorMascot}</div><div class="pill">{visitorTeamLogo}</div><div class="score">{visitorTeamScoreDivs}</div><div class="pi"></div><div class="rz">RED ZONE</div></div>'+'   <div class="gc-link">{gclink}</div><a href="{sslink}" target="_top" class="ss-link"></a><div class="ballot-link"><a href="{ballotUrl}" target="_top"><span></span></a></div>'},requestConfig:{value:null},gamesSchema:{value:{metaFields:{week:{locator:"//gms/@w",parser:toInt},year:{locator:"//gms/@y",parser:toInt},ballotOpen:{locator:"//gms/@bf",parser:parseBoolString},seasonType:{locator:"//gms/@t",parser:function(value){var result=value.toUpperCase();switch(value){case'R':result='REG';break;case'POST':result='POST';break;case'P':result='PRE';}
return result;}},gameDay:{locator:"//gms/@gd",parser:parseBoolString}},resultListLocator:"g",resultFields:[{key:"gameId",locator:"@eid"},{key:"gsisKey",locator:"@gsis"},{key:"day",locator:"@d"},{key:"startTime",locator:"@t"},{key:"clockTime",locator:"@k"},{key:"quarter",locator:"@q"},{key:"homeTeamAbbr",locator:"@h"},{key:"homeTeamNickname",locator:"@hnn"},{key:"homeTeamName",locator:"@htn"},{key:"homeTeamScore",locator:"@hs",parser:toInt},{key:"visitorTeamAbbr",locator:"@v"},{key:"visitorTeamNickname",locator:"@vnn"},{key:"visitorTeamName",locator:"@vtn"},{key:"visitorTeamScore",locator:"@vs",parser:toInt},{key:"possessionTeam",locator:"@p"},{key:"inRedzone",locator:"@rz",parser:parseBoolString},{key:"gameAlert",locator:"@ga"},{key:"gameType",locator:"@gt"},{key:"network",locator:"@n"}]}},bigPlaysSchema:{value:{resultListLocator:'//bps/b',resultFields:[{key:"id",locator:"@id"},{key:"videoCMSID",locator:"@id",parser:function(value){return"";}},{key:"gsisKey",locator:"@gsis"},{key:"gameId",locator:"@eid"},{key:"headline",locator:"@x"},{key:"team",locator:"@abbr"},{key:"bpType",locator:"@id",parser:function(value){return"big-play";}}]}},highlightsSchema:{value:{resultListLocator:'//igh/h',resultFields:[{key:"id",locator:"@id"},{key:"videoCMSID",locator:"@id"},{key:"gsisKey",locator:"@gsis"},{key:"gameId",locator:"@eid"},{key:"pid",locator:"@pid"},{key:"headline",locator:"@d"},{key:"team",locator:"@abbr"},{key:"bpType",locator:"@type"}]}}}});Y.ScoreStrip=ScoreStrip;},"3.1.1",{requires:['base-build','node-base','node-screen','widget','async-queue','datasource-io','json-parse','datasource-polling','datasource-randomize','dataschema-xml','substitute','array-extras','transition','font-endzonesans-condmedium'],skinnable:true});