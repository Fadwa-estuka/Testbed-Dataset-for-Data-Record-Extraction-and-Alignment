!function(e){function t(e,t,n){var i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},o=i[Chorus.Modernizr.prefixed("transition")];e.each(function(e,t){function i(){t.removeEventListener(o,i),n(t)}t.addEventListener(o,i)})}e.fn.addClassWithAnimationCallback=function(e,n){return"undefined"!=typeof Modernizr&&Chorus.Modernizr.csstransitions?(t(this,e,n),this.addClass(e),this):(this.addClass(e),this.each(function(e,t){n(t)}),this)},e.fn.removeClassWithAnimationCallback=function(e,n){return"undefined"!=typeof Modernizr&&Chorus.Modernizr.csstransitions?(t(this,e,n),this.removeClass(e),this):(this.removeClass(e),this.each(function(e,t){n(t)}),this)}}(jQuery),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var n=e(t);e.fn.lazyload=function(i){function o(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function a(){var t=0;s.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("lazyload:appear")})}var r,s=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(i&&(void 0!==i.failurelimit&&(i.failure_limit=i.failurelimit,delete i.failurelimit),void 0!==i.effectspeed&&(i.effect_speed=i.effectspeed,delete i.effectspeed),e.extend(l,i)),r=void 0===l.container||l.container===t?n:e(l.container),0===l.event.indexOf("scroll")){var c=function(){return a()};r.bind(l.event,o(c,l.scrollInterval))}this.each(function(){var n=this,i=e(n);n.loaded=!1,n.error_event_set=!1;var a=4e3,r=4,c=0,d=function(){if(!this.loaded){if(l.appear){var o=s.length;l.appear.call(n,o,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){i.hide().attr("src",i.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),n.loaded=!0;var t=e.grep(s,function(e){return!e.loaded});if(s=e(t),l.load){var o=s.length;l.load.call(n,o,l)}}).bind("error",function(){n.error_event_set||t.setTimeout(e.proxy(u,this),a),n.error_event_set=!0}).attr("src",i.attr("data-"+l.data_attribute));else{i.css("background-image","url('"+i.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),n.loaded=!0;var r=e.grep(s,function(e){return!e.loaded});if(s=e(r),l.load){var o=s.length;l.load.call(n,o,l)}}}},u=function(){if(c+=1,c<=r){e(this).bind("error",function(){t.setTimeout(e.proxy(u,this),a)});var n=this.src.split("?")[0];this.src=n+"?"+(new Date).getTime()}};if(i.one("lazyload:appear",d),0!==l.event.indexOf("scroll")){var h=function(){n.loaded||i.trigger("lazyload:appear")};i.bind(l.event,o(h,l.scrollInterval))}});var d=function(){a()};return n.bind("resize",o(d,l.resizeInterval)),a(),this},e.belowthefold=function(i,o){var a;return a=void 0===o.container||o.container===t?n.height()+n.scrollTop():e(o.container).offset().top+e(o.container).height(),a<=e(i).offset().top-o.threshold},e.rightoffold=function(i,o){var a;return a=void 0===o.container||o.container===t?n.width()+n.scrollLeft():e(o.container).offset().left+e(o.container).width(),a<=e(i).offset().left-o.threshold},e.abovethetop=function(i,o){var a;return a=void 0===o.container||o.container===t?n.scrollTop():e(o.container).offset().top,a>=e(i).offset().top+o.threshold+e(i).height()},e.leftofbegin=function(i,o){var a;return a=void 0===o.container||o.container===t?n.scrollLeft():e(o.container).offset().left,a>=e(i).offset().left+o.threshold+e(i).width()},e.inviewport=function(t,n){return!(e.rightofscreen(t,n)||e.leftofscreen(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,n){var s={failure_limit:20,load:function(){var t=e(this),n=t.parent(".image-window");if(t.is("img")&&(n.length>0?(t.css({position:"absolute",top:Math.round((n.outerHeight()-t.outerHeight())/2),left:Math.round((n.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(a),t.removeClass(r),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var i=Chorus.Context.gif_opts||{};if(Chorus.Context&&Chorus.Context.main_link_color&&(i.circleBackgroundColor=Chorus.Context.main_link_color,i.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var o=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),s=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');o.length+s.length===1?PLAYGIF_DISABLE_FLAG=!0:o&&o.length>0&&(PLAYGIF_DISABLE_FLAG=!1,o.playGIF(i))}t.playGIF(i)}},threshold:800};n&&e.extend(s,n),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(o+":visible").not("."+r+", ."+a),c=[],d=[];l.each(function(){var t,n,o,a,l,u=e(this),h=u.attr("data-imgkey"),m=u.data("chorus-asset-id");if("undefined"!=typeof h){if(s.parentDimensionSlc){var f=u.closest(s.parentDimensionSlc);t=f.outerWidth(),n=f.outerHeight()}t||(t=u.outerWidth()),n||(n=u.outerHeight()),0==n&&(o=u.data("ratio"),n="undefined"!=typeof o&&o>0?Math.ceil(t/o):t),u.is("img")&&(o=u.data("ratio"),a=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(n=Math.ceil(t/o)),a.length>0&&(t=Math.ceil(a.outerWidth()),n=Math.ceil(a.outerHeight())),n>0&&u.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n)),/\.(png|jpg|jpeg)$/i.test(u.attr("data-original"))&&i.webp&&!Chorus.Modernizr.touch&&(l="webp");var p=h+":"+t+"x"+n+(l?":"+l:"");c.push(p),u.attr("data-dim",t+"x"+n),u.addClass(r)}else if("undefined"!=typeof m){t=u.outerWidth(),n=u.outerHeight(),u.is("img")&&(o=u.data("ratio"),a=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(n=Math.ceil(t/o)),a.length>0&&(t=Math.ceil(a.outerWidth()),n=Math.ceil(a.outerHeight())),n>0&&u.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n));var g=m+":"+t+":"+n;d.push(g),u.data("asset-key",g),u.addClass(r)}else u.lazyload(s)}),0===c.length&&0===d.length||(e.each([d,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:d.join(",")},success:function(t){var n=t.urls,i={};_.forEach(n,function(e,t){var n=t.replace(/\:webp|\:jp2/,"");i[n]=e}),n=i,l.each(function(){var t,i=e(this);t=i.attr("data-imgkey")?i.attr("data-imgkey")+":"+i.attr("data-dim"):i.data("asset-key");var o=n[t];"undefined"!=typeof o&&(i.attr("data-original",o),i.lazyload(s))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var n={},i={webp:!1,jp2:!1},o=".vox-lazy-load",a="lazy-loaded",r="lazy-loading";return n.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))i.webp="true"===window.localStorage.getItem("supportsWebp"),o();else{var e=new Image;e.onload=function(){i.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",i.webp),o()},e.onerror=function(){i.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",i.webp),o()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function o(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:n.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},n.initUI=function(e,n){t(e,n)},n.applyTo=function(e,n){t(e,n)},n}(jQuery),/*
* touchSwipe - jQuery Plugin
* https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
* http://labs.skinkers.com/touchSwipe/
* http://plugins.jquery.com/project/touchSwipe
*
* Copyright (c) 2010 Matt Bryson (www.skinkers.com)
* Dual licensed under the MIT or GPL Version 2 licenses.
*
* $version: 1.3.3
*/
function(e){function t(t){return!t||void 0!==t.allowPageScroll||void 0===t.swipe&&void 0===t.swipeStatus||(t.allowPageScroll=s),t||(t={}),t=e.extend({},e.fn.swipe.defaults,t),this.each(function(){var i=e(this),o=i.data(v);o||(o=new n(this,t),i.data(v,o))})}function n(t,n){function b(e){var t,e=e.originalEvent,i=g?e.touches[0]:e;return R=h,g?Q=e.touches.length:e.preventDefault(),U=0,M=null,$=0,g&&Q!==n.fingers&&n.fingers!==u?w(e):(A=B=i.pageX,N=E=i.pageY,O=(new Date).getTime(),n.swipeStatus&&(t=C(e,R))),!1===t?(R=p,C(e,R),t):(L.bind(P,_),void L.bind(F,y))}function _(e){if(e=e.originalEvent,R!==f&&R!==p){var t,h=g?e.touches[0]:e;B=h.pageX,E=h.pageY,z=(new Date).getTime(),M=x(),g&&(Q=e.touches.length),R=m;var h=e,v=M;if(n.allowPageScroll===s)h.preventDefault();else{var b=n.allowPageScroll===l;switch(v){case i:(n.swipeLeft&&b||!b&&n.allowPageScroll!=c)&&h.preventDefault();break;case o:(n.swipeRight&&b||!b&&n.allowPageScroll!=c)&&h.preventDefault();break;case a:(n.swipeUp&&b||!b&&n.allowPageScroll!=d)&&h.preventDefault();break;case r:(n.swipeDown&&b||!b&&n.allowPageScroll!=d)&&h.preventDefault()}}Q!==n.fingers&&n.fingers!==u&&g?(R=p,C(e,R)):(U=S(),$=z-O,n.swipeStatus&&(t=C(e,R,M,U,$)),n.triggerOnTouchEnd||(h=!(n.maxTimeThreshold?!($>=n.maxTimeThreshold):1),!0===k()?(R=f,t=C(e,R)):h&&(R=p,C(e,R)))),!1===t&&(R=p,C(e,R))}}function y(e){if(e=e.originalEvent,e.preventDefault(),z=(new Date).getTime(),U=S(),M=x(),$=z-O,n.triggerOnTouchEnd||!1===n.triggerOnTouchEnd&&R===m)if(R=f,Q!==n.fingers&&n.fingers!==u&&g||0===B)R=p,C(e,R);else{var t=!(n.maxTimeThreshold?!($>=n.maxTimeThreshold):1);!0!==k()&&null!==k()||t?(t||!1===k())&&(R=p,C(e,R)):C(e,R)}else R===m&&(R=p,C(e,R));L.unbind(P,_,!1),L.unbind(F,y,!1)}function w(){O=z=E=B=N=A=Q=0}function C(e,t){var s=void 0;if(n.swipeStatus&&(s=n.swipeStatus.call(L,e,t,M||null,U||0,$||0,Q)),t!==p||!n.click||1!==Q&&g||!isNaN(U)&&0!==U||(s=n.click.call(L,e,e.target)),t==f)switch(n.swipe&&(s=n.swipe.call(L,e,M,U,$,Q)),M){case i:n.swipeLeft&&(s=n.swipeLeft.call(L,e,M,U,$,Q));break;case o:n.swipeRight&&(s=n.swipeRight.call(L,e,M,U,$,Q));break;case a:n.swipeUp&&(s=n.swipeUp.call(L,e,M,U,$,Q));break;case r:n.swipeDown&&(s=n.swipeDown.call(L,e,M,U,$,Q))}return(t===p||t===f)&&w(e),s}function k(){return null!==n.threshold?U>=n.threshold:null}function S(){return Math.round(Math.sqrt(Math.pow(B-A,2)+Math.pow(E-N,2)))}function x(){var e;return e=Math.atan2(E-N,A-B),e=Math.round(180*e/Math.PI),0>e&&(e=360-Math.abs(e)),45>=e&&0<=e?i:360>=e&&315<=e?i:135<=e&&225>=e?o:45<e&&135>e?r:a}function T(){L.unbind(j,b),L.unbind(D,w),L.unbind(P,_),L.unbind(F,y)}var B,E,A,N,I=g||!n.fallbackToMouseEvents,j=I?"touchstart":"mousedown",P=I?"touchmove":"mousemove",F=I?"touchend":"mouseup",D="touchcancel",U=0,M=null,$=0,L=e(t),R="start",Q=0,O=E=B=N=A=0,z=0;try{L.bind(j,b),L.bind(D,w)}catch(t){e.error("events not supported "+j+","+D+" on jQuery.swipe")}this.enable=function(){return L.bind(j,b),L.bind(D,w),L},this.disable=function(){return T(),L},this.destroy=function(){return T(),L.data(v,null),L}}var i="left",o="right",a="up",r="down",s="none",l="auto",c="horizontal",d="vertical",u="all",h="start",m="move",f="end",p="cancel",g="ontouchstart"in window,v="TouchSwipe";e.fn.swipe=function(n){var i=e(this),o=i.data(v);if(o&&"string"==typeof n){if(o[n])return o[n].apply(this,Array.prototype.slice.call(arguments,1));e.error("Method "+n+" does not exist on jQuery.swipe")}else if(!(o||"object"!=typeof n&&n))return t.apply(this,arguments);return i},e.fn.swipe.defaults={fingers:1,threshold:75,maxTimeThreshold:null,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,click:null,triggerOnTouchEnd:!0,allowPageScroll:"auto",fallbackToMouseEvents:!0},e.fn.swipe.phases={PHASE_START:h,PHASE_MOVE:m,PHASE_END:f,PHASE_CANCEL:p},e.fn.swipe.directions={LEFT:i,RIGHT:o,UP:a,DOWN:r},e.fn.swipe.pageScroll={NONE:s,HORIZONTAL:c,VERTICAL:d,AUTO:l},e.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:u}}(jQuery),function(e){function t(t){t.preventDefault();var n=t.data,o=n.attr("href"),a=n.data("rec-url")===o,r=n.data("recommend-entry-id"),s=e('*[data-recommend-entry-id="'+r+'"]');e.post(o,function(){s.each(function(){i(a,e(this))})})}function n(e){var t=e.data("rec-count");e.find(".recommend-link-count").remove(),t<1&&(t=""),e.append('<span class="recommend-link-count p-button__count">'+t+"</span>")}function i(e,t){var i=parseInt(t.data("rec-count"));e?(t.attr("href",t.data("unrec-url")),t.data("rec-count",i+1),t.find(".p-button__social-text").text("Unrec"),t.find(".p-button__social-text-long").text("Unrecommend this Post"),n(t)):(t.attr("href",t.data("rec-url")),t.data("rec-count",i-1),t.find(".p-button__social-text").text("Rec"),t.find(".p-button__social-text-long").text("Recommend this Post"),n(t))}e.fn.sbnRecommendLink=function(){return this.each(function(){var i=e(this);i.data("rec-link-init")!==!0&&(i.data("rec-link-init",!0),i.on("click",i,t),n(i))})}}(jQuery),function(e){e("*[data-recommend-entry-id]").sbnRecommendLink()}(jQuery),function(e){e.fn.serializeObject=function(){var t=this,n={},i={},o={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,t,n){return e[t]=n,e},this.push_counter=function(e){return void 0===i[e]&&(i[e]=0),i[e]++},e.each(e(this).serializeArray(),function(){if(o.validate.test(this.name)){for(var i,a=this.name.match(o.key),r=this.value,s=this.name;void 0!==(i=a.pop());)s=s.replace(new RegExp("\\["+i+"\\]$"),""),i.match(o.push)?r=t.build([],t.push_counter(s),r):i.match(o.fixed)?r=t.build([],i,r):i.match(o.named)&&(r=t.build({},i,r));n=e.extend(!0,n,r)}}),n}}(jQuery),function(e){function t(t,n){var i={oddClass:n.oddClass||"ui-state-odd",evenClass:n.evenClass||"ui-state-even",highlightRows:n.highlightRows===!0,highlightClass:n.highlighClass||"ui-state-hover"},o=t.find("tbody tr");i.highlightRows&&(o.unbind("mouseenter",function(){e(this).addClass(i.highlighClass)}),o.unbind("mouseleave",function(){e(this).removeClass(i.highlighClass)}),o.bind("mouseenter",function(){e(this).addClass(i.highlighClass)}),o.bind("mouseleave",function(){e(this).removeClass(i.highlighClass)})),i.oddClass&&o.filter(":odd").addClass(i.oddClass),i.evenClass&&o.filter(":even").addClass(i.evenClass)}e.fn.zebraTables=function(e){if(this.length>0){var n=e||{};table=this,t(table,n),this.bind("DOMNodeInserted",function(){t(table,n)})}return this}}(jQuery);var PLAYGIF_DISABLE_FLAG;!function(e){e.fn.playGIF=function(t){var n=e.extend({on:"touchstart mouseenter",off:"touchstart mouseleave",autoResize:!1,enable:!0,circleBackgroundColor:"FFF200",circleTextColor:"4C4E4D",gifText:"GIF",removeAnchor:!0},t);"undefined"!=typeof PLAYGIF_DISABLE_FLAG&&(n.enable=!PLAYGIF_DISABLE_FLAG);var i=function(e,t,i){t=Math.floor(t),i=Math.floor(i);var o=35;e.fillStyle="#"+n.circleBackgroundColor,e.beginPath(),e.arc(t,i,o,0,2*Math.PI,!0),e.closePath(),e.fill(),e.fillStyle="#"+n.circleTextColor,e.font="15px 'Gotham SSm A', 'Gotham SSm B', sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(n.gifText,t,i)};return this.each(function(){if(n.enable!==!1){var t=e(this);if(!t.is("img")||!/\.gif$/i.test(t.attr("src")))return!0;var o=document.createElement("canvas");if("undefined"==typeof o.getContext)return!0;var a=o.getContext("2d"),r=new Image,s=function(e,t){t.on(n.off,function(){l(e,t)});var i=t.attr("src");t.attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),t.css({width:e.attr("width"),height:e.attr("height")}),setTimeout(function(){t.attr("src",i)},0),e.replaceWith(t)},l=function(e,t){e.on(n.on,function(){s(e,t)}),t.replaceWith(e)};r.onload=function(){var l=t.width(),c=t.height();o.width=l,o.height=c,a.drawImage(r,0,0,l,c);var d=e(o);if(n.autoResize===!0){o.setAttribute("data-src",t.attr("src")),o.setAttribute("class","gif");var u=e('<span class="faux-image">');u.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),"max-width":"100%",position:"relative",display:"block",height:o.height}),d.css({position:"absolute",top:0,left:0}),d=u.append(d)}else d.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),display:t.css("display")});t.replaceWith(d);var h=d.parent();h.is("p")||"none"===h.css("max-width")&&"none"===h.css("max-height")||(l=h.width(),c=h.height()),n.removeAnchor&&h.is("a")&&/\.gif$/i.test(h.attr("href"))&&h.replaceWith(d),l>150&&c>150&&i(a,l/2,c/2),d.on(n.on,function(){s(d,t)})},r.src=t.attr("src")}})}}(jQuery),function(e){e.fn.redraw=function(){return e(this).each(function(){var t=document.createTextNode(" ");e(this).append(t),setTimeout(function(){t.parentNode.removeChild(t)},0)})}}(jQuery),function(e){e.fn.noUiSlider=function(t,n){function i(e,t,n){"function"==typeof e&&e.call(t,n)}function o(e,t,n){var i=t.data("setup"),o=i.handles,a=i.settings,r=i.pos;if(e=e<0?0:e>100?100:e,2==a.handles)if(n.is(":first-child")){var s=parseFloat(o[1][0].style[r])-a.margin;e=e>s?s:e}else{var s=parseFloat(o[0][0].style[r])+a.margin;e=e<s?s:e}if(a.step){var c=l.from(a.range,a.step);e=Math.round(e/c)*c}return e}function a(e){try{return[e.clientX||e.originalEvent.clientX||e.originalEvent.touches[0].clientX,e.clientY||e.originalEvent.clientY||e.originalEvent.touches[0].clientY]}catch(e){return["x","y"]}}function r(e,t){return parseFloat(e[0].style[t])}var s=window.navigator.msPointerEnabled?2:"ontouchend"in document?3:1;window.debug&&console&&console.log(s);var l={to:function(e,t){return t=e[0]<0?t+Math.abs(e[0]):t-e[0],100*t/this._length(e)},from:function(e,t){return 100*t/this._length(e)},is:function(e,t){return t*this._length(e)/100+e[0]},_length:function(e){return e[0]>e[1]?e[0]-e[1]:e[1]-e[0]}},c={handles:2,serialization:{to:["",""],resolution:.01}};methods={create:function(){return this.each(function(){function n(e,t){e.css(d,t+"%").data("input").val(l.is(h.range,t).toFixed(_))}var d,u,h=e.extend(c,t),m="<a><div></div></a>",f=e(this).data("_isnS_",!0),p=[],g="",v=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},b=(h.serialization.resolution=h.serialization.resolution||.01).toString().split("."),_=1==b[0]?0:b[1].length;h.start=v(h.start)?[h.start,0]:h.start,e.each(h,function(e,t){v(t)?h[e]=parseFloat(t):"object"==typeof t&&v(t[0])&&(t[0]=parseFloat(t[0]),v(t[1])&&(t[1]=parseFloat(t[1])));var n=!1;switch(t="undefined"==typeof t?"x":t,e){case"range":case"start":n=2!=t.length||!v(t[0])||!v(t[1]);break;case"handles":n=t<1||t>2||!v(t);break;case"connect":n="lower"!=t&&"upper"!=t&&"boolean"!=typeof t;break;case"orientation":n="vertical"!=t&&"horizontal"!=t;break;case"margin":case"step":n="undefined"!=typeof t&&!v(t);break;case"serialization":n="object"!=typeof t||!v(t.resolution)||"object"==typeof t.to&&t.to.length<h.handles;break;case"slide":n="function"!=typeof t}n&&console&&console.error("Bad input for "+e+" on slider:",f)}),h.margin=h.margin?l.from(h.range,h.margin):0,(h.serialization.to instanceof jQuery||"string"==typeof h.serialization.to||h.serialization.to===!1)&&(h.serialization.to=[h.serialization.to]),"vertical"==h.orientation?(g+="vertical",d="top",u=1):(g+="horizontal",d="left",u=0),g+=h.connect?"lower"==h.connect?" connect lower":" connect":"",f.addClass(g);for(var y=0;y<h.handles;y++){p[y]=f.append(m).children(":last");var w=l.to(h.range,h.start[y]);p[y].css(d,w+"%"),100==w&&p[y].is(":first-child")&&p[y].css("z-index",2);var C=".noUiSlider",k=(1===s?"mousedown":2===s?"MSPointerDown":"touchstart")+C+"X",S=(1===s?"mousemove":2===s?"MSPointerMove":"touchmove")+C,x=(1===s?"mouseup":2===s?"MSPointerUp":"touchend")+C;p[y].find("div").on(k,function(t){if(e("body").bind("selectstart"+C,function(){return!1}),!f.hasClass("disabled")){e("body").addClass("TOUCH");var n=e(this).addClass("active").parent(),r=n.add(e(document)).add("body"),s=parseFloat(n[0].style[d]),c=a(t),m=c,g=!1;e(document).on(S,function(e){e.preventDefault();var t=a(e);if("x"!=t[0]){t[0]-=c[0],t[1]-=c[1];var r=[m[0]!=t[0],m[1]!=t[1]],v=s+100*t[u]/(u?f.height():f.width());v=o(v,f,n),r[u]&&v!=g&&(n.css(d,v+"%").data("input").val(l.is(h.range,v).toFixed(_)),i(h.slide,f.data("_n",!0)),g=v,n.css("z-index",2==p.length&&100==v&&n.is(":first-child")?2:1)),m=t}}).on(x,function(){r.off(C),e("body").removeClass("TOUCH"),f.find(".active").removeClass("active").end().data("_n")&&f.data("_n",!1).change()})}}).on("click",function(e){e.stopPropagation()})}1==s&&f.on("click",function(e){if(!f.hasClass("disabled")){var t=a(e),r=100*(t[u]-f.offset()[d])/(u?f.height():f.width()),s=p.length>1?t[u]<(p[0].offset()[d]+p[1].offset()[d])/2?p[0]:p[1]:p[0];n(s,o(r,f,s),f),i(h.slide,f),f.change()}});for(var y=0;y<p.length;y++){var T=l.is(h.range,r(p[y],d)).toFixed(_);"string"==typeof h.serialization.to[y]?p[y].data("input",f.append('<input type="hidden" name="'+h.serialization.to[y]+'">').find("input:last").val(T).change(function(e){e.stopPropagation()})):0==h.serialization.to[y]?p[y].data("input",{val:function(e){return"undefined"==typeof e?this.handle.data("noUiVal"):void this.handle.data("noUiVal",e)},handle:p[y]}):p[y].data("input",h.serialization.to[y].data("handleNR",y).val(T).change(function(){var t=[null,null];t[e(this).data("handleNR")]=e(this).val(),f.val(t)}))}e(this).data("setup",{settings:h,handles:p,pos:d,res:_})})},val:function(){if("undefined"!=typeof arguments[0]){var t="number"==typeof arguments[0]?[arguments[0]]:arguments[0];return this.each(function(){for(var n=e(this).data("setup"),i=0;i<n.handles.length;i++)if(null!=t[i]){var a=o(l.to(n.settings.range,t[i]),e(this),n.handles[i]);n.handles[i].css(n.pos,a+"%").data("input").val(l.is(n.settings.range,a).toFixed(n.res))}})}for(var n=e(this).data("setup").handles,i=[],a=0;a<n.length;a++)i.push(parseFloat(n[a].data("input").val()));return 1==i.length?i[0]:i},disabled:function(){return n?e(this).addClass("disabled"):e(this).removeClass("disabled")}};var d=jQuery.fn.val;return jQuery.fn.val=function(){return this.data("_isnS_")?methods.val.apply(this,arguments):d.apply(this,arguments)},"disabled"==t?methods.disabled.apply(this):methods.create.apply(this)}}(jQuery),jQuery(document).ready(function(e){var t={networkVars:{sbn:{scope:e(".m-entry__body"),linkable:"p",buffer:!1},verge:{scope:e(".article-body, .entry-content"),linkable:"p",buffer:!1},polygon:{scope:e("article .body, .forum_article"),linkable:"p",buffer:e("#polybar")}},init:function(){this.config(function(){t.scope.length&&(e(document).bind("keydown",t.keydown),t.buildLinks(t.readHash))})},config:function(t){this.network=window.Chorus.Context.network_slug,this.scope=this.networkVars[this.network].scope,this.linkable=this.scope.find(this.networkVars[this.network].linkable).filter(function(){if(0==e(this).parents("table").length)return e(this)}),this.keyStore=this.keyDivider="|",this.trigger="|16|16|",this.linksVisible=!1,this.linkClassname="pgh-link",this.scrollSpeed=200,this.highlightFadeSpeed=5e3,this.extraBuffer=100,this.loaded=!1,this.paragraphClassname="pgh-paragraph",this.buffer=this.networkVars[this.network].buffer?this.networkVars[this.network].buffer.outerHeight():0,t()},buildLinks:function(n){t.linkable.each(function(n,i){var o=e(i);if(""!==o.text().replace(/^\s+|\s+$/g,"")){var a=o.offset(),r=e('<a href="" id="pgh'+n+'" class="'+t.linkClassname+'" />').css({top:a.top,left:a.left}).data({id:n,top:Math.floor(a.top)});o.attr("id","paragraph"+n).addClass(t.paragraphClassname).data("id",n),e("body").append(r)}}),t.links=e("."+t.linkClassname),t.links.on("click",t.buildHash),n()},recalculateLinks:function(){e("."+t.paragraphClassname).each(function(t,n){var i=e(n),o=i.offset(),a=e("#pgh"+i.data("id"));a.css("top",o.top).data("top",o.top)})},buildHash:function(){var n=e(this).data();return window.location.hash="pgh/"+n.id+"/"+n.top,t.scrollToParagraph(n.id,n.top,!1),!1},readHash:function(){if(window.location.hash&&window.location.hash.indexOf("pgh")>-1){var e=window.location.hash.split("/");t.scrollToParagraph(e[1],e[2],!0)}},scrollToParagraph:function(t,n,i){var o=n-this.buffer,a=e("#paragraph"+t);if(i){var r=this.scope.find(this.networkVars[this.network].linkable);o-=this.extraBuffer,r.fadeTo(0,.25,function(){a.fadeTo(0,1)}),setTimeout(function(){r.fadeTo(500,1)},this.highlightFadeSpeed)}e("html, body").animate({scrollTop:o},this.scrollSpeed)},keydown:function(e){var n=e.keyCode;t.keyStore=t.keyStore+n+t.keyDivider,t.keyStore.indexOf(t.trigger)>-1&&(t.linksVisible?(t.linksVisible=!1,t.links.hide()):(t.loaded||(t.recalculateLinks(),t.loaded=!0),t.linksVisible=!0,t.links.show())),setTimeout(function(){t.keyStore=t.keyDivider},500)}};t.init()}),function(e,t){e.rails!==t&&e.error("jquery-ujs has already been loaded!");var n,i=e(document);e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(t){var n=e('meta[name="csrf-token"]').attr("content");n&&t.setRequestHeader("X-CSRF-Token",n)},refreshCSRFTokens:function(){var t=e("meta[name=csrf-token]").attr("content"),n=e("meta[name=csrf-param]").attr("content");e('form input[name="'+n+'"]').val(t)},fire:function(t,n,i){var o=e.Event(n);return t.trigger(o,i),o.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e[0].href},handleRemote:function(i){var o,a,r,s,l,c;if(n.fire(i,"ajax:before")){if(s=i.data("with-credentials")||null,l=i.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,i.is("form")){o=i.attr("method"),a=i.attr("action"),r=i.serializeArray();var d=i.data("ujs:submit-button");d&&(r.push(d),i.data("ujs:submit-button",null))}else i.is(n.inputChangeSelector)?(o=i.data("method"),a=i.data("url"),r=i.serialize(),i.data("params")&&(r=r+"&"+i.data("params"))):i.is(n.buttonClickSelector)?(o=i.data("method")||"get",a=i.data("url"),r=i.serialize(),i.data("params")&&(r=r+"&"+i.data("params"))):(o=i.data("method"),a=n.href(i),r=i.data("params")||null);return c={type:o||"GET",data:r,dataType:l,beforeSend:function(e,o){return o.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+o.accepts.script),!!n.fire(i,"ajax:beforeSend",[e,o])&&void i.trigger("ajax:send",e)},success:function(e,t,n){i.trigger("ajax:success",[e,t,n])},complete:function(e,t){i.trigger("ajax:complete",[e,t])},error:function(e,t,n){i.trigger("ajax:error",[e,t,n])},crossDomain:n.isCrossDomain(a)},s&&(c.xhrFields={withCredentials:s}),a&&(c.url=a),n.ajax(c)}return!1},isCrossDomain:function(e){var t=document.createElement("a");t.href=location.href;var n=document.createElement("a");try{return n.href=e,n.href=n.href,!n.protocol||!n.host||t.protocol+"//"+t.host!=n.protocol+"//"+n.host}catch(e){return!0}},handleMethod:function(i){var o=n.href(i),a=i.data("method"),r=i.attr("target"),s=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),c=e('<form method="post" action="'+o+'"></form>'),d='<input name="_method" value="'+a+'" type="hidden" />';l===t||s===t||n.isCrossDomain(o)||(d+='<input name="'+l+'" value="'+s+'" type="hidden" />'),r&&c.attr("target",r),c.hide().append(d).appendTo("body"),c.submit()},formElements:function(t,n){return t.is("form")?e(t[0].elements).filter(n):t.find(n)},disableFormElements:function(t){n.formElements(t,n.disableSelector).each(function(){n.disableFormElement(e(this))})},disableFormElement:function(e){var n,i;n=e.is("button")?"html":"val",i=e.data("disable-with"),e.data("ujs:enable-with",e[n]()),i!==t&&e[n](i),e.prop("disabled",!0)},enableFormElements:function(t){n.formElements(t,n.enableSelector).each(function(){n.enableFormElement(e(this))})},enableFormElement:function(e){var t=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[t](e.data("ujs:enable-with")),e.prop("disabled",!1)},allowAction:function(e){var t,i=e.data("confirm"),o=!1;return!i||(n.fire(e,"confirm")&&(o=n.confirm(i),t=n.fire(e,"confirm:complete",[o])),o&&t)},blankInputs:function(t,n,i){var o,a,r=e(),s=n||"input,textarea",l=t.find(s);return l.each(function(){if(o=e(this),a=o.is("input[type=checkbox],input[type=radio]")?o.is(":checked"):o.val(),!a==!i){if(o.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+o.attr("name")+'"]').length)return!0;r=r.add(o)}}),!!r.length&&r},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var i=e.data("disable-with");e.data("ujs:enable-with",e.html()),i!==t&&e.html(i),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable")}},n.fire(i,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,i){e.crossDomain||n.CSRFProtection(i)}),e(window).on("pageshow.rails",function(){e(e.rails.enableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableFormElement(t)}),e(e.rails.linkDisableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableElement(t)})}),i.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),i.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(e(this))}),i.delegate(n.linkClickSelector,"click.rails",function(i){var o=e(this),a=o.data("method"),r=o.data("params"),s=i.metaKey||i.ctrlKey;if(!n.allowAction(o))return n.stopEverything(i);if(!s&&o.is(n.linkDisableSelector)&&n.disableElement(o),o.data("remote")!==t){if(s&&(!a||"GET"===a)&&!r)return!0;var l=n.handleRemote(o);return l===!1?n.enableElement(o):l.fail(function(){n.enableElement(o)}),!1}return a?(n.handleMethod(o),!1):void 0}),i.delegate(n.buttonClickSelector,"click.rails",function(t){var i=e(this);if(!n.allowAction(i))return n.stopEverything(t);i.is(n.buttonDisableSelector)&&n.disableFormElement(i);var o=n.handleRemote(i);return o===!1?n.enableFormElement(i):o.fail(function(){n.enableFormElement(i)}),!1}),i.delegate(n.inputChangeSelector,"change.rails",function(t){var i=e(this);return n.allowAction(i)?(n.handleRemote(i),!1):n.stopEverything(t)}),i.delegate(n.formSubmitSelector,"submit.rails",function(i){var o,a,r=e(this),s=r.data("remote")!==t;if(!n.allowAction(r))return n.stopEverything(i);if(r.attr("novalidate")==t&&(o=n.blankInputs(r,n.requiredInputSelector),o&&n.fire(r,"ajax:aborted:required",[o])))return n.stopEverything(i);if(s){if(a=n.nonBlankInputs(r,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(r)},13);var l=n.fire(r,"ajax:aborted:file",[a]);return l||setTimeout(function(){n.enableFormElements(r)},13),l}return n.handleRemote(r),!1}setTimeout(function(){n.disableFormElements(r)},13)}),i.delegate(n.formInputClickSelector,"click.rails",function(t){var i=e(this);if(!n.allowAction(i))return n.stopEverything(t);var o=i.attr("name"),a=o?{name:o,value:i.val()}:null;i.closest("form").data("ujs:submit-button",a)}),i.delegate(n.formSubmitSelector,"ajax:send.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),i.delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))}),e(function(){n.refreshCSRFTokens()}))}(jQuery);var SBN=SBN||{};SBN.Nav=function(e){function t(){var t=e(".m-site-nav__logo img"),n=t.attr("data-logo-url");t.attr("src",n)}function n(t,n){var i=e(".m-site-nav__logo img"),a=i.attr("data-dark-logo-url"),r=i.attr("data-light-logo-url");if(o(),_.delay(o,1e3),a&&r&&(i.attr("src",t?r:a),n)){var s=i.attr("data-bw-logo-url");s?i.attr("src",s):console.log("Tried to apply third logo/black and white logo, but none was available for this site/network.")}}function i(t,n){if(!B){t.children("li").css({visibility:"hidden"}).removeClass("is-hidden-desktop");var i=t.find(".m-site-nav__more-link"),o=i.find("ul").empty(),a=n-i.width()-E,r=0,s=0;t.children(".is-pinned").css("visibility","visible").each(function(){r+=e(this).width()}),t.children("li").not(".is-pinned").each(function(){var t=e(this);if(!t.is(i))if(r+=t.width(),r<a)t.css("visibility","visible");else{s++;var n=t.children("a");n.length>0&&o.append("<li>"+n[0].outerHTML+"</li>"),t.addClass("is-hidden-desktop"),t.css("visibility","visible")}}),s>0&&i.css("visibility","visible")}}function o(){if(Chorus.Environment.currentBreakpoint().index>1){var t=x.width()-T.width();x.find(".m-site-nav__network, .m-site-nav__community").each(function(){i(e(this),t)})}else x.find("> ul > li").css({visibility:"visible"})}function a(){S.toggleClass("is-mobile-nav-active")}function r(){clearTimeout(k),Chorus.Environment.currentBreakpoint().index>1&&S.hasClass("has-both-navs")===!0&&S.addClass("is-network-nav-active")}function s(){S.removeClass("is-network-nav-active"),clearTimeout(k)}function l(e){n(e.useLightLogo===!0,e.useThirdLogo===!0,e.useSolidBackground===!0)}function c(e){Chorus.Environment.currentBreakpoint().index>1&&e.toggleClass("is-active")}function d(e){Chorus.Environment.currentBreakpoint().index<2&&e.hasClass("has-dropdown")&&(x.find(".is-active").not(e).removeClass("is-active"),e.toggleClass("is-active"))}function u(t){c(e(t.currentTarget))}function h(t){var n=e(t.currentTarget);n.hasClass("has-dropdown")===!0&&n.hasClass("is-active")===!1&&t.preventDefault(),d(n)}function m(){o()}function f(){r()}function p(){k=setTimeout(s,2e3)}function g(){s()}function v(){e(".m-site-nav__search").addClass("is-focus")}function b(){e(".m-site-nav__search").removeClass("is-focus")}function y(){a()}function w(t){var n=e(t.currentTarget);n.find("iframe").css({"background-color":n.css("background-color")}),FB.XFBML.parse(document.getElementById("nav-fb-like-btn"))}function C(){S=e(".m-site-nav"),x=S.find("nav"),t(),T=e(".m-site-nav__right-side"),e(".m-site-nav nav > ul > li").on("mouseenter",u).on("mouseleave",u),e(".m-site-nav nav .m-site-nav__community > li").on("click",h),Chorus.EventDispatcher.subscribe("campaignReskinApplied",l),e(window).on("resize",_.debounce(m,100)),e(".m-site-nav__netnav-trigger, .m-site-nav__network").on("mouseenter",f),x.on("mouseleave",p),e(".m-site-nav__logo").on("mouseenter",g),e(".m-site-nav__search__input").on("focus",v).on("blur",b),e(".m-site-nav__mobile-trigger").on("click",y),e(".m-site-nav__social-btn").on("mouseenter",w),o()}var k,S,x,T,B=e.browser.msie&&e.browser.version<9,E=10;return{init:function(){C()}}}(jQuery),jQuery(function(){SBN.Nav.init()});var SBN=SBN||{};SBN.UserNav=function(e){return{init:function(){this.config(function(){SBN.UserNav.mySbnToggle.off("click",SBN.UserNav.showMySbnModal),SBN.UserNav.mySbnToggle.on("click",SBN.UserNav.showMySbnModal)})},config:function(t){this.mySbnToggle=e("#user-nav-my-sbn"),t()},showMySbnModal:function(e){Chorus.EventDispatcher.publish("modal_open",{url:"/modal/mysbn"}),e.preventDefault()}}}(jQuery),jQuery(function(){SBN.UserNav.init()});var SBN=SBN||{};SBN.FilterPane=function(e){return{init:function(){var t=e(".m-filter-pane");t.length<1||this.config(function(){SBN.FilterPane.cloneToggleEvents(),SBN.FilterPane.mobileDropdown.on("change",SBN.FilterPane.triggerMobileChange)})},config:function(t){this.contentToggle=e("#filter-pane-toggle"),this.mobileDropdown=e("#filter-pane-toggle-mobile"),this.selectedClass="is-selected",t()},cloneToggleEvents:function(){this.contentToggle.find("li").each(function(t){var n=e('<option data-index="'+t+'">'+e(this).find("a").text()+"</option>").appendTo(SBN.FilterPane.mobileDropdown);0==e(this).data("count")&&n.attr("disabled",!0),e(this).hasClass(SBN.FilterPane.selectedClass)&&n.attr("selected",!0)})},triggerMobileChange:function(){var e=SBN.FilterPane.mobileDropdown.find(":selected").data("index");SBN.FilterPane.contentToggle.find("li").eq(e).find("a")[0].click()}}}(jQuery),jQuery(function(){SBN.FilterPane.init()});var SBN=SBN||{};SBN.FanShots=function(e){var t=!1;return{init:function(){t||(t=!0,this.config(function(){SBN.FanShots.fanshotModalTrigger.on("click",SBN.FanShots.openModal),SBN.FanShots.collapseOn.length&&(SBN.FanShots.collapseImageShots(),SBN.FanShots.collapseFanShotBlurbs())}),SBN.UnreadComments.init())},config:function(t){this.fanshotModalTrigger=e("#new-fanshot-trigger"),this.fanshotInput=e("#new-fanshot-input"),this.form="#new-fanshot-form",this.formTypes="#fanshot-type-toggle li",this.formTypeToggle="#fanshot-type-toggle a",this.typeInput="#type",this.forms=".m-modal-fanshots__details",this.selectedClass="is-selected",this.url=null,this.linkEmbed="#link_shot_url",this.imageEmbed="#image_shot_url",this.videoEmbed="#video_shot_html",this.twitterToggle={User:"#entry_tweet_as_user",Community:"#entry_tweet_as_community"},this.twitterBox={User:"#twitter-box-user",Community:"#twitter-box-community"},this.tweetCount={User:"#twitter-count-user",Community:"#twitter-count-community"},this.tweetLength=110,this.collapseOn=e(".m-fanshot-index, .is-front-page"),this.collapsible=e(".m-block__fanshot-media.image"),this.collapseToggle=e(".m-fanshot__image-collapse"),this.collapsedImageClass="-is-collapsed",this.imageShotMaxHeight=150,this.fanShotBlurbs=e(".m-block.fanshot .m-block__body__blurb"),this.blurbMaxWords=15,this.blurbReadMoreClass="m-fanshot__read-more-link",this.blurbReadMore=' ... <a href="" class="'+this.blurbReadMoreClass+'">Read More</a>',t()},openModal:function(){return Chorus.Context.logged_in?Chorus.EventDispatcher.publish("modal_open",{url:"/modal/new_fanshot",callbacks:{attach:function(){SBN.FanShots.parseUrl()},submit:function(){SBN.FanShots.submitForm()}}}):(event.preventDefault(),Chorus.Auth.modal.open("login")),!1},switchTypeForm:function(){e(SBN.FanShots.formTypes).removeClass(SBN.FanShots.selectedClass),e(this).parent().addClass(SBN.FanShots.selectedClass);var t=e(this).data("fanshot-type");return e(SBN.FanShots.typeInput).val(t),e(SBN.FanShots.forms).hide().filter("#"+t.toLowerCase()).show(0,function(){e(window).trigger("recalculate_modal")}),!1},parseUrl:function(){e(SBN.FanShots.formTypeToggle).on("click",SBN.FanShots.switchTypeForm),e(SBN.FanShots.twitterToggle.User).on("click",{account:"User"},SBN.FanShots.toggleTwitterBox),e(SBN.FanShots.twitterToggle.Community).on("click",{account:"Community"},SBN.FanShots.toggleTwitterBox),SBN.FanShots.url=SBN.FanShots.fanshotInput.val().replace(/^\s+|\s+$/g,""),e.ajax({type:"POST",url:"/fanshots/lookup",data:{url:SBN.FanShots.url}}).done(function(t){var n=t.shot_type;e(SBN.FanShots.formTypeToggle).filter('[data-fanshot-type="'+n+'"]').trigger("click"),"ImageShot"==n?e(SBN.FanShots.imageEmbed).val(t.data):"VideoShot"==n?e(SBN.FanShots.videoEmbed).val(t.data):e(SBN.FanShots.linkEmbed).val(SBN.FanShots.url)})},toggleTwitterBox:function(t){type=t.data.account,e(t.currentTarget).is(":checked")?(e(SBN.FanShots.twitterBox[type]).show(),e(SBN.FanShots.tweetCount[type]).text(SBN.FanShots.tweetLength),e(SBN.FanShots.twitterBox[type]).find("textarea").on("keyup",t.data,SBN.FanShots.countTweetChars)):(e(SBN.FanShots.twitterBox[type]).hide(),e(SBN.FanShots.tweetCount[type]).text(""),e(SBN.FanShots.twitterBox[type]).find("textarea").off("keyup",t.data,SBN.FanShots.countTweetChars))},countTweetChars:function(t){type=t.data.account;var n=e(SBN.FanShots.tweetCount[type]),i=SBN.FanShots.tweetLength-e(SBN.FanShots.twitterBox[type]).find("textarea").val().length;n.text(i),i<10&&!n.hasClass("warning")?e(SBN.FanShots.tweetCount[type]).addClass("warning"):i>10&&n.hasClass("warning")&&e(SBN.FanShots.tweetCount[type]).removeClass("warning")},submitForm:function(){var t=e(this.form),n=t.serialize(),i=t.attr("action"),o=e("input:submit",t),a=0,r=e(SBN.FanShots.forms).filter(":visible"),s=e(SBN.FanShots.forms).filter(":hidden");return r.find('[data-required="true"]').each(function(){
if(""===e.trim(e(this).val()))return alert("Please fill out all required fields"),e(this).focus(),a++,!1}),0===a&&(s.find("input, textarea").val(""),e.ajax({type:"POST",url:i,data:n,beforeSend:function(){o.val("Saving...")}}).done(function(e){200!==e.status?(o.val("Post"),alert(e.message)):(o.val("Saved!"),location.reload())}).fail(function(){o.val("Post"),alert("An error occured while saving this fanshot.")})),!1},collapseImageShots:function(){SBN.FanShots.collapsible.each(function(){var t=e(this),n=t.find("img");t.find("img").on("click",SBN.FanShots.expandImageShots),t.find(SBN.FanShots.collapseToggle).on("click",SBN.FanShots.expandImageShots),t.data("image-height",t.height()),t.data("image-height")>SBN.FanShots.imageShotMaxHeight&&(t.addClass(SBN.FanShots.collapsedImageClass).height(SBN.FanShots.imageShotMaxHeight),t.find(SBN.FanShots.collapseToggle).width(n.width()))})},expandImageShots:function(t){var n=e(this).parent();n.removeClass(SBN.FanShots.collapsedImageClass),n.animate({height:n.data("image-height")},100,function(){n.removeClass(SBN.FanShots.collapsedImageClass)}),t.preventDefault()},collapseFanShotBlurbs:function(){SBN.FanShots.fanShotBlurbs.each(function(t,n){var i=e(n);if(0!==i.length){i.data("full-content",i.html());var o=i.text().match(/(\S+)/g);o.length>SBN.FanShots.blurbMaxWords&&(i.html("<p>"+o.slice(0,SBN.FanShots.blurbMaxWords).join(" ")+SBN.FanShots.blurbReadMore+"</p>"),i.find("."+SBN.FanShots.blurbReadMoreClass).on("click",SBN.FanShots.expandFanShotBlurb))}})},expandFanShotBlurb:function(t){var n=e(this).closest(".m-block__body__blurb");n.html(n.data("full-content")),t.preventDefault()}}}(jQuery);var SBN=SBN||{};SBN.UserProfile=function(e){return{init:function(){var t=e(".m-profile");t.length<1||this.config(function(){SBN.UserProfile.activityToggle.on("click","a",SBN.UserProfile.toggleActivity),SBN.UserProfile.blogMembershipToggle.on("click","a",SBN.UserProfile.toggleBlogMembership),SBN.UserProfile.favoriteToggle.on("click",SBN.UserProfile.toggleFavoriteBlog),SBN.UserProfile.adminLinkToggle.on("change",SBN.UserProfile.gotoAdminLink),SBN.UserProfile.coloredRows(SBN.UserProfile.activityTableClass,"tr"),SBN.UserProfile.activityToggle.find("a:first").trigger("click")})},config:function(t){this.activityToggle=e("#filter-pane-toggle"),this.blogMembershipToggle=e("#blog-membership-toggle"),this.blogMembershipList=e(".m-profile__memberships"),this.profileRail=e(".m-filter-pane__rail"),this.profileRiver=e(".m-filter-pane__content"),this.activityTable=e(".m-profile__activity-table"),this.activityTableClass=".m-profile__activity-table",this.favoriteToggle=e(".m-profile__blog__favorite"),this.adminLinkToggle=e("#profile-meta-link-toggle"),this.selectedClass="is-selected",this.disabledClass="is-disabled",this.favoriteClass="is-favorite",this.oddClass="odd",t()},gotoAdminLink:function(){var t=e(this).val();""!==t&&(window.location=t)},toggleFavoriteBlog:function(t){var n=e(this),i=n.parent().hasClass(SBN.UserProfile.favoriteClass)?n.data("unfavorite-url"):n.data("favorite-url");e.post(i,function(){n.parent().toggleClass(SBN.UserProfile.favoriteClass)}),t.preventDefault()},toggleActivity:function(){if(e(this).parent().hasClass(SBN.UserProfile.disabledClass))return e(this).parent().next().find("a").trigger("click"),!1;var t=e(this).data("type");if(!_.isUndefined(t)){var n=SBN.UserProfile.activityTable.length,i=n?SBN.UserProfile.activityTable.find("tr"):SBN.UserProfile.profileRiver.find(".m-block"),o=e(this).parents(SBN.UserProfile.activityToggle.selector).find("li");return o.removeClass(SBN.UserProfile.selectedClass),e(this).parent().addClass(SBN.UserProfile.selectedClass),n&&i.removeClass(SBN.UserProfile.oddClass),i.hide(),"all"===t?i.show():i.filter("."+t+", ."+t.toLowerCase()).show(),n&&SBN.UserProfile.coloredRows(SBN.UserProfile.activityTableClass,"tr"),!1}},toggleBlogMembership:function(){return SBN.UserProfile.blogMembershipToggle.find("li").removeClass(SBN.UserProfile.selectedClass),e(this).parent().addClass(SBN.UserProfile.selectedClass),"all"===e(this).data("show")?SBN.UserProfile.blogMembershipList.addClass("show-all"):SBN.UserProfile.blogMembershipList.removeClass("show-all"),!1},coloredRows:function(t,n){e(t).find(n).filter(":visible").each(function(t){t%2&&e(this).addClass("odd")})}}}(jQuery),jQuery(function(){SBN.UserProfile.init()});var Chorus=Chorus||{};Chorus.Debug={countCSSRules:function(){function e(e){var n=0;if(e&&e.cssRules){for(var i=0,o=e.cssRules.length;i<o;i++)e.cssRules[i].selectorText&&(n+=e.cssRules[i].selectorText.split(",").length);log+="\nFile: "+(e.href?e.href:"inline <style> tag"),log+="\nRules: "+e.cssRules.length,log+="\nSelectors: "+n,log+="\n--------------------------",n>=4096&&(t+="\n********************************\nWARNING:\n There are "+n+" CSS rules in the stylesheet "+e.href+" - IE will ignore the last "+(n-4096)+" rules!\n")}}var t=log="";if(document.styleSheets){for(var n=0;n<document.styleSheets.length;n++)e(document.styleSheets[n]);console.log(log),t&&console.log(t)}}};var SBN=SBN||{};SBN.DelayedLoadGlobalNav=function(e){return{init:function(){var t=e("#delayedLoadGlobalNavSubItems");t.find(".m-site-nav__dropdown").each(function(t,n){var i=e(n);e("#"+i.data("nav-id")).append(i)}),t.remove()}}}(jQuery);var SBN=SBN||{};SBN.StreamFilter=function(e){function t(){e(b).remove()}function n(){var t=e(p),n=1,i=_.template(e(g).html());t.each(function(t,o){var r=e(o),s=r.next();if(s.length>0&&s.hasClass(f))n+=1;else{var l=e(i({count:n}));l.on("click",a),r.after(l),n=1}})}function i(i){t(),e(h).removeClass(f).not(e("*["+c+'*="'+i+'"]')).addClass(f),e(u+"."+d).removeClass(d),e(u+"["+c+'="'+i+'"]').addClass(d),n(),Chorus.DynamicSizedImages.initUI(e(".m-stream__update"))}function o(e){var t=e.prev();for(e.remove();t.hasClass(f);)t.removeClass(f),t=t.prev()}function a(t){o(e(t.currentTarget))}function r(t){i(e(t.currentTarget).attr(c))}function s(e){i(e.target.value)}var l=".m-stream",c="data-filter-info",d="is-selected",u="#stream-filter-rail li",h=".m-stream__update",m="#stream-filter-rail .m-filter-pane__filter-list--mobile",f="is-hidden",p=h+"."+f,g="#m-stream-flag-template",v="m-stream__hidden-flag",b="."+v;return{init:function(){e(l).length<1||(e(u+"["+c+"]").on("click",r),e(m).on("change",s),e(g).length>0&&n())}}}(jQuery),jQuery(function(){SBN.StreamFilter.init()});var SBN=SBN||{};SBN.ShortLinkTooltip=function(e){function t(e){e.addClass(s),e.find("input").focus()}function n(e){e.removeClass(s),e.find("input").blur()}function i(t,n){var i=e('<div class="m-shortlink-tooltip"><input type="text" value="'+n+'" /><button class="'+l+'">&times;</button></div>');t.on("mouseenter",o),t.on("click","."+l,a),t.append(i)}function o(n){t(e(n.currentTarget))}function a(t){n(e(t.currentTarget).closest(r))}var r=".m-shortlink-tooltip__container",s="is-active",l="m-shortlink-tooltip__close";return{init:function(){e(r).each(function(){var t=e(this);i(t,t.find("a").attr("href"))})}}}(jQuery),jQuery(function(){SBN.ShortLinkTooltip.init()});var Chorus=Chorus||{};Chorus.EntryGallery=function(e){"use strict";function t(t){t.next("[data-gallery-full-size]").each(function(t,n){var i=e(n),o=new Image;o.src=i.data("gallery-full-size")})}function n(e){var t=e.parent(),n=Math.floor(t.height()),i=Math.floor(e.height());i>n&&(n=i),(void 0===t.data("min-height")||n>t.data("min-height"))&&(t.css("min-height",n+"px"),t.css("line-height",n+"px"),t.data("min-height",n))}function i(e,i){function o(){s.attr("src",a),s.addClass("is-stable"),t(e),_.delay(n,200,s)}var a=e.data("gallery-full-size"),r=e.closest(".m-gallery"),s=r.find(".m-gallery__image"),l=e.data("gallery-caption"),c=e.data("gallery-title"),d=l,u=i||!1;if(c&&(d='<span class="gallery-title">'+c+"</span> "+l),a!==s.attr("src")){!s.attr("src")||u?o():s.removeClassWithAnimationCallback("is-stable",o,500);var h=r.data("gallery-id"),m=r.find(".m-gallery__thumb").length,f=e.index()+1+" of "+m;r.find(".m-gallery__caption-index").text(f),r.find(".m-gallery__caption-body").html(d),Chorus.Analytics.event("gallery","image",h,{"Pagination Tracking":f,"Content ID":h})}}function o(e){if(e.hasClass("is-selected")!==!0){var t=e.closest(".m-gallery"),n=e.closest(".m-gallery__metadata");n.find(".is-selected").removeClass("is-selected"),e.addClass("is-selected");var i=0;n.width()>=n.parent().width()&&(i=e.position().left-.5*t.width()+.5*e.width(),i<0&&(i=0),i=0-i),n.css({left:i})}}function a(e,t){i(e,t),o(e);var n="http://"+window.location.host+window.location.pathname+"#"+e.data("gallery-id");history.replaceState({url:n},"",n)}function r(e,t){var n,i=e.find(".m-gallery__thumb.is-selected");n=0===i.length||t&&i.is(":last-child")?e.find(".m-gallery__thumb").first():!t&&i.is(":first-child")?e.find(".m-gallery__thumb").last():i[t?"next":"prev"](),n.trigger("click")}function s(t,n){var i=t.find(".m-gallery__metadata"),o=Math.round(.5*t.width()),a=parseInt(i.css("left"),10),r=0;i.find("a").each(function(){var t=e(this);r=r+t.width()+parseInt(t.css("margin-right"),10)}),a=n?a-o:a+o,a<0-(r-o)?a=0:a>0&&(a=0-(r-o)),i.css({left:a})}function l(){e(".m-gallery__nav .prev").trigger("click")}function c(){e(".m-gallery__nav .next").trigger("click")}function d(t){var n=e('<div class="m-gallery__thumb-modal"><h2 class="m-gallery__close m-gallery__close-top">Back To Gallery<a class="m-gallery__close m-gallery__close-x">\xd7</a></h2></div>'),i=e('<div class="m-gallery__thumb-modal-inner"></div'),o=t.data("gallery-id");i.append(t.find(".m-gallery__thumb").clone()),n.on("click",".m-gallery__thumb",function(t){var n=e(t.currentTarget),i=n.index()+1;Chorus.Analytics.event("gallery","grid:thumb:click:"+i,o,{"Pagination Tracking":i}),a(e('.m-gallery .m-gallery__thumb[data-gallery-id="'+e(t.currentTarget).data("gallery-id")+'"]'),!0)}),n.on("click",function(){Chorus.Analytics.event("gallery","grid:close",o,{"Content ID":o}),e(".m-gallery__thumb-modal").remove(),e("html").removeClass("gallery-modal-open")}),Chorus.Analytics.event("gallery","grid:open",o,{"Content ID":o}),e("html").addClass("gallery-modal-open").append(n.append(i)),_.delay(function(){n.addClass("is-visible")},500)}function u(e){37===e.keyCode&&l(),39===e.keyCode&&c()}function h(t){t.preventDefault();var n=e(t.currentTarget),i=n.closest(".m-gallery"),o=i.data("gallery-id");Chorus.Analytics.event("gallery","next_image_arrow:click",o,{"Content ID":o}),r(e(t.currentTarget).closest(".m-gallery"),!0)}function m(t){t.preventDefault();var n=e(t.currentTarget),i=n.closest(".m-gallery"),o=i.data("gallery-id");Chorus.Analytics.event("gallery","prev_image_arrow:click",o,{"Content ID":o}),r(e(t.currentTarget).closest(".m-gallery"),!1)}function f(t){var n=e(t.currentTarget),i=n.closest(".m-gallery"),o=i.data("gallery-id"),r=n.index()+1;Chorus.Analytics.event("gallery","thumb:click:"+r,o,{"Pagination Tracking":r}),a(e(t.currentTarget))}function p(t){t.preventDefault();var n=e(t.currentTarget),i=n.closest(".m-gallery"),o=i.data("gallery-id");Chorus.Analytics.event("gallery","prev_thumb_arrow:click",o,{"Content ID":o}),s(e(t.currentTarget).closest(".m-gallery"),!1)}function g(t){t.preventDefault();var n=e(t.currentTarget),i=n.closest(".m-gallery"),o=i.data("gallery-id");Chorus.Analytics.event("gallery","next_thumb_arrow:click",o,{"Content ID":o}),s(e(t.currentTarget).closest(".m-gallery"),!0)}function v(t){t.preventDefault(),d(e(t.currentTarget).closest(".m-gallery"))}var b=e("body");return{init:function(){var t=e(".m-gallery");t.length<1||(b.on("keydown",u),t.on("click",".m-gallery__thumb",f),t.on("click",".m-gallery__nav .prev",m),t.on("click",".m-gallery__nav .next",h),t.on("click",".m-gallery__thumbs-nav .prev",p),t.on("click",".m-gallery__thumbs-nav .next",g),t.on("click",".m-gallery__thumb-trigger",v),t.each(function(){var t=e(this),n=t.find(".m-gallery__thumb").first(),i=window.location.hash;if(""!==i.substring(1)){var o=t.find('.m-gallery__thumb[data-gallery-id="'+i.substring(1)+'"]');o.length>0&&(n=o)}n.trigger("click")}))}}}(jQuery),jQuery(Chorus.EntryGallery.init);var Chorus=Chorus||{};Chorus.EntryResponsiveVideo=function(e){function t(){n(e(o)),e(r).each(i)}function n(e){e.find(a).each(i)}function i(){var t="";return $this=e(this),!(!$this.hasClass("no-responsive-video")&&!$this.parents(".no-responsive-video").length)||(/instagram\.com/.test($this.attr("src"))?(t=" instagram",$this.wrap('<div class="instagram-wrap"></div>')):/vine\.co/.test($this.attr("src"))&&(t=" vine"),$this.find("object, embed, video").attr("width","100%").attr("height","100%"),$this.find("div.OoyalaHtml5VideoPlayer").css({width:"100%",height:"100%"}),$this.removeAttr("width").removeAttr("height").wrap('<div class="p-scalable-video'+t+'"></div>'),!0)}var o=".m-entry__body, .m-stream__update, .feature-body",a=['iframe[src*="youtube.com"]','iframe[src*="vine.co"]','iframe[src*="ooyala.com"]'].join(","),r=["div[id*=ooyalaPlayer]",".m-video__pane iframe",".mceItemFlash",".m-block__fanshot-media.video iframe",".m-block__fanshot-media.video object",".sbn-body-feature .sbn-feature-entry .feature-body iframe"].join(",");return{wrapVideosInEntryBody:function(e){setTimeout(function(){n(e)},1e3)},init:function(){setTimeout(t,1e3)}}}(jQuery),jQuery(Chorus.EntryResponsiveVideo.init);var SBN=SBN||{};SBN.FeaturedPoll=function(e){function t(t){return e(l+"[data-"+p+'="'+t+'"]')}function n(n){for(var i=_.template(e(g).html()),o=t(n.poll_id),a=o.find(u),r=0,s=n.options.length-1;s>-1;s--)r+=n.options[s].poll_option.votes;o.find(f).html("<i>"+r+" vote"+(1==r?"":"s")+" total</i>"),o.find(m).remove(),o.find(h).remove();for(var s=0,l=n.options.length;s<l;s++){var c=n.options[s].poll_option,d=parseFloat(c.votes/r)||0,d=Math.round(100*d);a.append(i({title:c.title,votes:c.votes,percentage:d}))}}function i(n){t(n);e.ajax({url:v,data:{id:n},success:s})}function o(n){var i=t(n),o=i.find("input:radio:checked");o.length>0&&e.ajax({url:b,dataType:"json",data:{poll_option:o[0].value,id:n},type:"POST",success:s})}function a(e){e.preventDefault(),i(e.data.pollId)}function r(e){e.preventDefault(),o(e.data.pollId)}function s(e){n(e)}var l=".m-poll-body",c=".m-poll-body__view-results",d=".m-poll-body__submit",u=".m-poll-body__options",h=".m-poll-body__controls",m=".m-poll-body__options li",f=".m-poll-body__count",p="poll-id",g="#m-poll-body-result",v="/polls/results_json",b="/polls/vote_json";return{init:function(){e(l).each(function(){var t=e(this),n=t.data(p);t.find(c).on("click",{pollId:n},a),t.find(d).on("click",{pollId:n},r)})}}}(jQuery);var Chorus=Chorus||{};Chorus.FlagEntry=function(e){"use strict";function t(e){Chorus.EventDispatcher.publish("modal_open",{url:e,callbacks:{attach:c}})}function n(e){Chorus.EventDispatcher.publish("modal_open",{url:e})}function i(t){var n=confirm("Pressing OK will remove the flag you placed on this entry. Cancel will leave it in place.");n===!0&&e.post(t,l,"json")}function o(t){var n=t.attr("action");e.post(n,t.serializeObject(),s,"json")}function a(t){e(f+"[data-"+g+'="'+t.id+'"]').replaceWith(t.markup),Chorus.EventDispatcher.publish("modal_close"),Chorus.FlagEntry.init()}function r(t){t.preventDefault(),o(e(this).parent("form"))}function s(e){a(e)}function l(e){a(e)}function c(){e(p).on("click",r)}function d(o){o.preventDefault();var a=e(o.currentTarget),r=a.find("a");return a.has(m).length>0?void n(r.attr("href")):a.has(h).length>0?void i(r.attr("href")):void t(r.attr("href"))}var u=".m-flag-button",h=".m-flag-button__unflag",m=".m-flag-button__view",f=".m-flag-button-wrapper",p=".m-modal-flag__submit",g="flag-id",v="flag-init";return{init:function(){e(u).each(function(){var t=e(this);t.data(v)||(t.data(v,!0),t.on("click",d))})}}}(jQuery),jQuery(function(){Chorus.FlagEntry.init()});var Chorus=Chorus||{};Chorus.ToggleLink=function(e){function t(){var t=e(this),n=t.data();return!n.toggleInProcess&&(n.toggleText&&(oldText=t.text(),t.text(n.toggleText)),n.toggleInProcess=!0,e.ajax({url:t.attr("href"),type:n.toggleMethod||"POST",dataType:"text",success:function(){if(n.toggleText=oldText,n.toggleUrl){var e=n.toggleUrl;t.attr("href",n.toggleUrl),n.toggleUrl=e}n.toggleInProcess=!1},error:function(){t.text(oldText),n.toggleInProcess=!1,alert("An unknown error occurred. Please try again later.")}}),!1)}var n="a[data-toggle-url]";return{init:function(){e(document).on("click",n,t)}}}(jQuery),jQuery(function(){Chorus.ToggleLink.init()});var Chorus=Chorus||{};Chorus.EntryDropCap=function(e){return{init:function(){var t=e(".m-entry__body > p:first-child, .m-entry-body article > p:first-child, .racked-feature .m-feature-intro > p").not('.m-entry__body.no-drop-caps > p:first-child, head[data-network="racked"] + body .m-entry__intro');if("undefined"!=typeof t){t=t.first();var n,i=t.text().trim();!Util.UserAgentProfiler.isAndroid()&&null!==i.match(/^[a-zA-Z]/)&&i.length>170&&i.split(" ").length>30&&(t.addClass("has-dropcap"),n=i.charAt(0).toLowerCase(),t.addClass("has-dropcap--"+n))}}}}(jQuery),jQuery(function(){Chorus.EntryDropCap.init()}),SBN.EntryTableSupport=function(e){function t(){e(".m-entry__body table:not([class]), .m-entry__body .sports_data_widget table").addClass("sbn-data-table").removeClass("zebra"),e(".sbn-data-table, .sports_data_widget .zebra").zebraTables();var t=e(".m-entry__body").width();e(".m-entry__body table").each(function(n,i){var o=e(i),a=e(i).width();a>t&&o.wrap('<div class="overflow-wrapper"></div>')})}return{init:function(){t()}}}(jQuery),jQuery(function(){SBN.EntryTableSupport.init()});var SBN=SBN||{};SBN.SocialCount=function(e){function t(e,t){return i[e]?void t(i[e]):void jQuery.getJSON("https://api.facebook.com/method/links.getStats",{urls:encodeURIComponent(e),format:"json"},function(n){var o=n[0].total_count;i[e]=o,t(o)})}function n(){e("[data-facebook-share-count-url]").each(function(){var n=e(this);t(n.data("facebook-share-count-url"),function(e){e>0&&(n.data("use-parens")===!1?n.text(e).redraw():n.text("("+e+")").redraw())})})}var i={};return{init:function(){n()}}}(jQuery),jQuery(function(){SBN.SocialCount.init()});var SBN=SBN||{};SBN.GroupHead=function(e){function t(t){t.useLightLogo&&e(".m-section-header").children().css("color","white")}return{init:function(){Chorus.EventDispatcher.subscribe("campaignReskinApplied",t)}}}(jQuery),jQuery(function(){SBN.GroupHead.init()});var SBN=SBN||{};SBN.UnreadComments=function(e){function t(t){console.log("SBN.UnreadComments: requestUnreadCommentCounts called");var t=t||e("body"),a=t.find("*["+i+"]").map(function(t,n){return e(n).data(o)});a=_.uniq(a).sort(),l===!0&&console.log("SBN.UnreadComments: Requesting Unread Comments for :",a),a.length>0&&e.get(s+a.join(","),n,"json")}function n(t){l===!0&&console.log("SBN.UnreadComments: Data Returned:",t),_.each(t,function(t,n){e("["+i+'="'+n+'"]').each(function(n,i){var o=t;$item=e(i);var s=$item.data(a);s&&(o+=" "+s);var l=$item.data(r);l&&(o=l+o),$item.text(o).addClass("loaded")})})}var i="data-unread-comments-id",o="unread-comments-id",a="unread-comments-token",r="unread-comments-token-before",s="/comments/unread_counts/",l=Util.getUrlVars().debugUnreadComments===!0;return{init:function(){Chorus.Context.logged_in&&t()},applyTo:function(e){Chorus.Context.logged_in&&t(e)}}}(jQuery),jQuery(function(){SBN.UnreadComments.init()});var SBN=SBN||{};SBN.BreakingNews=function(e){function t(){var t=e(i),n=t.data(o);e.cookie(r+n,"true",{expires:365,path:"/"}),t.remove()}function n(){t()}var i=".m-breaking-news",o="breaking-news-id",a='<div class="m-breaking-news__close">&times;</div>',r="breaking_news_";return{init:function(){var t=e(i);if(!(t.length>1||0==Chorus.Context.logged_in)){var o=e(a);o.on("click",n),t.append(o)}}}}(jQuery),jQuery(function(){SBN.BreakingNews.init()});var SBN=SBN||{};SBN.LookitCover=function(e){function t(e){var t=e.data.main,n=t.width();return t.removeClass("lookit-size-sm lookit-size-md lookit-size-lg"),n<470?void t.addClass("lookit-size-sm"):n<730?void t.addClass("lookit-size-md"):void t.addClass("lookit-size-lg")}function n(t,n){t.data("carousel-nav-index",n),t.find(".is-active").addClassWithAnimationCallback("is-animating",function(t){e(t).removeClass("is-animating")}).removeClass("is-active"),t.find(".lookit-cover-nav li:eq("+n+"), .lookit-box:eq("+n+")").addClassWithAnimationCallback("is-animating",function(t){e(t).removeClass("is-animating")}).addClass("is-active")}function i(e){var t=e.data("carousel-nav-index")+1;t>e.data("carousel-pane-last-index")&&(t=0),n(e,t)}function o(e){var t=e.data("carousel-nav-index")-1;t<0&&(t=e.data("carousel-pane-last-index")),n(e,t)}function a(){clearInterval(h),h=void 0}function r(){h=window.setInterval(function(){e(".lookit-cover-next").trigger("click")},4e3)}function s(t){t.preventDefault();var i=t.data.main;n(i,e(t.currentTarget).data("carousel-nav-index"))}function l(e){e.preventDefault();var t=e.data.main;o(t)}function c(e){e.preventDefault();var t=e.data.main;i(t)}function d(){event.preventDefault();var e=event.data.main;a(),o(e)}function u(){event.preventDefault();var e=event.data.main;a(),i(e)}var h,m=e(window);return{init:function(){var i=e(".lookit-cover");i.length<1||(i.each(function(i,o){var h=e(o);h.data("carousel-pane-last-index",h.find(".lookit-box").length-1),h.find(".lookit-cover-nav li").bind("click",{main:h},s),h.find(".lookit-cover-prev").bind("click",{main:h},l),h.find(".lookit-cover-next").bind("click",{main:h},c),h.swipe({swipeLeft:function(t){u(e.extend(!0,t,{data:{main:h}}))},swipeRight:function(t){d(e.extend(!0,t,{data:{main:h}}))},threshold:100,fingers:1}),h.bind("mouseenter",a),h.bind("mouseleave",r);var f=h.find(".is-active");t({data:{main:h}}),m.bind("resizeStop",{main:h},t),f.length>0?n(h,f.index()):n(h,0)}),r())}}}(jQuery),jQuery(function(){SBN.LookitCover.init()});var SBN=SBN||{};SBN.LookitTagBrowser=function(e){return{init:function(){var t=e(".lookit-tag-browser");t.length<1||t.each(function(t,n){var i=e(n),o=i.find("ul").width();i.find("li").each(function(t,n){var i=e(n);i.position().left+i.width()>o&&i.addClass("is-hidden")})})}}}(jQuery),jQuery(function(){SBN.LookitTagBrowser.init()});var SBN=SBN||{};SBN.LookitTweetShot=function(e){return{init:function(){e(".lookit-box-tweet").on("click",function(){window.location=e(this).data("href")})}}}(jQuery),jQuery(function(){SBN.LookitTweetShot.init()});var SBN=SBN||{};SBN.LivePromo=function(e){function t(){e(".m-live-promo").addClass("is-negative-color");var t=e(".m-live-promo .m-live-promo__logo img");t.attr("src",t.data("light-logo-url"))}return{init:function(){Chorus.EventDispatcher.subscribe("campaignReskinApplied",function(e){e.useLightLogo===!0&&t()})}}}(jQuery),jQuery(function(){SBN.LivePromo.init()});var SBN=SBN||{};SBN.Scoreboard=function(e){function t(e){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()]+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getDate()+", "+e.getFullYear();return t}function n(e){var t=e.getHours(),n=e.getMinutes(),i=t>11?"PM":"AM",o=e.toString().split("(")[1].split(")")[0];return t=0==t?12:t>12?t-12:t,n=n<10?"0"+n:n,t+":"+n+i+" "+o}function i(e){C(),p(e),y()}function o(){C(),r("there was an error loading the score")}function a(){A=(new Date).getTime(),y()}function r(t){var n=B({message:t});e(".m-scoreboard__error-message").remove(),e(".m-scoreboard__meta").append(n),SBN.DismissableMessage.init(e(".m-scoreboard__error-message"))}function s(t){c(t);var n=e('.m-scoreboard[data-scoreboard-league="'+t+'"]');1==n.data("scoreboard-hide-if-empty")?(n.remove(),e('.m-scoreboard__link a[href*="/scoreboard/'+n.data("scoreboard-league")+'"]').parent().remove()):(n.find(".m-scoreboard__empty-league").remove(),n.append('<div class="m-scoreboard__empty-league">There are no games scheduled for today.</div>'))}function l(){e(".m-scoreboard .m-scoreboard__loading").html('<div class="m-scoreboard__empty-league">There were no events found that match the request.</div>')}function c(t){e('.m-scoreboard[data-scoreboard-event-id="'+t+'"] .m-scoreboard__loading, .m-scoreboard[data-scoreboard-league="'+t+'"] .m-scoreboard__loading').remove()}function d(n,i,o){var a="Scores for ";o&&"Day"!==o&&(a+="the "+o.toLowerCase()+" of "),a+=t(new Date(i.from)),o&&"Day"!==o&&(a+=" - "+t(new Date(i.until))),e('.m-scoreboard[data-scoreboard-league="'+n+'"] .m-scoreboard__date').html(a)}function u(i,o){var a=new Date(i.start_time);i.event_time=t(a)+" - "+n(a);var r=T(i),s=e('.m-scoreboard__box-score[data-scoreboard-event-id="'+i.id+'"]');if(s.length>0)return void s.replaceWith(r);var l=e('.m-scoreboard[data-scoreboard-event-id="'+i.id+'"] .m-scoreboard__table-attach, .m-scoreboard[data-scoreboard-league="'+o+'"] .m-scoreboard__table-attach');return l.length>0?void l.append(r):void console.warn("data was recieved that is an unrequested event id, or is part of a league that cannot be found in the dom. data = ",i,"league = ",o)}function h(e,t){return e=new Date(e.dateModified),t=new Date(t.dateModified),e>t?-1:e<t?1:0}function m(e){for(var t=[],n=[],i=[],o=[],a=[],r=0,s=e.length;r<s;r++)switch(e[r].status){case"mid-event":t.push(e[r]);break;case"post-event":i.push(e[r]);break;case"postponed":case"weather-delay":n.push(e[r]);break;case"pre-event":o.push(e[r]);break;default:a.push(e[r])}return t.sort(h).concat(n.sort(h),i.sort(h),o.sort(h),a.sort(h))}function f(e,t){void 0!==t&&(0===e.length?s(t):c(t));for(var n=m(e),i=0,o=n.length;i<o;i++)u(n[i],t),void 0===t&&c(n[i].id)}function p(e){f(e.events);for(var t in e.leagues)f(e.leagues[t],t);l()}function g(){var t=(new Date).getTime()-A,n=S-t,i=(Math.floor(n/6e4),Math.floor(n/1e3)%60);i=i<10?"0"+i.toString():i.toString(),e(".m-scoreboard__counter-bar").width(n/S*100+"%")}function v(){e(".m-scoreboard__counter-time").html("")}function b(){e.ajax({dataType:"jsonp",url:E.url,data:{ranges:E.ranges,events:E.events},timeout:1e4,success:i,error:o,complete:a})}function y(){C(),I=setInterval(g,x),N=setTimeout(w,S)}function w(){C(),b()}function C(){v(),clearInterval(I),clearTimeout(N)}var k="/sbn_scoreboard/ajax_leagues_and_events",S=3e5,x=1e3,T=null,B=null,E={url:k,ranges:{},events:[]},A=(new Date).getTime(),N=null,I=null;return{init:function(){var t=e(".m-scoreboard");t.length<1||(T=_.template(e("#scoreboard-boxscore-template").html()),B=_.template(e("#scoreboard-error-template").html()),t.each(function(){var t=e(this);if(t.data("scoreboard-event-id"))E.events.push(t.data("scoreboard-event-id"));else{var n=t.data("scoreboard-league"),i=t.data("scoreboard-date-range"),o=t.data("scoreboard-interval");E.ranges[n]=i,d(n,i,o)}}),b())}}}(jQuery),jQuery(SBN.Scoreboard.init);var SBN=SBN||{};SBN.SocialPromo=function(e){function n(e,t){Chorus.DataStore.set(e,t)}function i(e){return Chorus.DataStore.get(e)}function o(){var t=e(".m-social-promo__unit");n("social-promo-hidden",1),t.remove()}function a(){var n=e(".m-social-promo__unit");if(!(n.length<1)){n.addClass("is-active"),n.find(".m-social-promo__close").on("click",function(e){e.preventDefault(),o("close")}),Chorus.EventDispatcher.subscribe("facebookSdkAvailable",function(){FB.Event.subscribe("edge.create",function(e){/ref=promo$/.test(e)&&o("like")})}),window.twttr=window.twttr||(t={_e:[],ready:function(e){t._e.push(e)}}),twttr.ready(function(e){e.widgets.createFollowButton(Chorus.Context.community_twitter_screen_name,document.getElementById("social-promo-twitter-follow-button"),function(){e.events.bind("follow",function(e){null==e.target&&o("follow")})},{size:"medium",count:"horizontal"})}),jQuery(".m-live-promo").length>0&&e(".m-social-promo__subnav").remove();var i=e(document),a=function(){i.scrollTop()>=400&&(e(".m-social-promo__slideout").addClass("is-available"),window.clearInterval(r))},r=window.setInterval(a,5e3)}}Chorus.Context.ga_track_prefix?Chorus.Context.ga_track_prefix+"_trackEvent":"_trackEvent";return{init:function(){Util.isReferrerCurrentDomain()||"sbnation.com"===Chorus.Context.community_domain&&Util.isReferrerSocialDomain()||1===parseInt(i("social-promo-hidden"))||a()}}}(jQuery),jQuery(function(){SBN.SocialPromo.init()});var SBN=SBN||{};SBN.DismissableMessage=function(e){function t(e){e.removeClass("is-visible")}function n(){event&&event.preventDefault&&event.preventDefault(),t(e(event.currentTarget))}function i(e){e.on("click",".dismiss",n)}return{init:function(t){i(t?t:e(".p-dismissible-message"))}}}(jQuery),SBN.NewsletterSignup=function(e){function t(){var t=e(".m-newsletter-signup form"),n=[],i=[];e("#selected-newsletters li").each(function(t,o){o=e(o),n.push(o.attr("data-list_id")),i.push(o.attr("data-team_id"))}),e("#lists_").val(n.toString()),e("#team_ids_").val(i.toString()),r(),e.ajax({type:"POST",url:t.attr("action"),data:t.serialize(),success:u,error:h})}function n(e){var t="li[data-list_id = '"+e.data("list_id")+"'][data-team_id = '"+e.data("team_id")+"']";return t}function i(t){var i=n(t);e(".m-newsletter-signup__section").find(i).addClass("is-selected"),e("#selected-newsletters").append('<li class="is-selectable is-selected" data-list_id="'+t.data("list_id")+'" data-team_id="'+t.data("team_id")+'">'+t.text()+"</li>")}function o(t){var i=n(t);e("#selected-newsletters").find(i).remove(),e(".m-newsletter-signup__section").find(i).removeClass("is-selected")}function a(){var t=e(".m-newsletter-signup__left-rail-field");return!(t.val().indexOf("@")<1)||(s(),!1)}function r(){e("#newsletter_submit").val("Submiting").attr("disabled","disabled")}function s(){e("#newsletter_submit").after('<span class="p-err-msg">There appears to be a problem with that email address.</span>')}function l(){p||(Chorus.Analytics.event("email","signup",document.title),p=!0),e("#newsletter_submit").after('<span class="p-confirm-msg">Thank you for signing up!</span>')}function c(){e("#newsletter_submit").after('<span class="p-err-msg">There was an error with the request. Maybe your email is invalid?</span>')}function d(){e("#newsletter_submit").val("Sign Up").removeAttr("disabled"),e(".m-newsletter-signup .p-err-msg, .m-newsletter-signup .p-confirm-msg").remove()}function u(){d(),l()}function h(){d(),c()}function m(t){var n=e(t.currentTarget);n.hasClass("is-selected")?o(n):i(n)}function f(e){e.preventDefault(),d(),a()&&t()}var p=!1;return{init:function(){e(".m-newsletter-signup").on("click",".is-selectable",m),e("#newsletter_submit").on("click",f)}}}(jQuery),jQuery(function(){SBN.NewsletterSignup.init()});var SBN=SBN||{};SBN.SiteDirectory=function(e){function t(){s.val().length<3?n():(d.hide(),u.each(function(t,n){var i=e(n),o=i.text().toUpperCase(),a=s.val().toUpperCase();i.toggle(o.indexOf(a)>=0)}))}function n(){d.show(),u.show(),l.find(".is-selected").removeClass("is-selected"),l.find('a[href="#all"]').parent().addClass("is-selected")}function i(t){l.find(".is-selected").removeClass("is-selected"),l.find('a[href="#'+t+'"]').parent().addClass("is-selected"),d.hide(),u.hide(),e("#"+t).show().nextUntil("h2").show()}function o(e){e.preventDefault(),t(!0)}function a(t){t.preventDefault();var o=e(t.currentTarget).val();"all"===o?n():i(o)}function r(t){t.preventDefault();var o=e(t.currentTarget).attr("href").substr(1);"all"===o?n():i(o)}var s,l,c,d,u;return{init:function(){var t=e(".m-sitedir");t.length<1||(s=e("#blog-query"),c=e("#blog-select"),l=e("#blog-filter"),d=e(".m-sitedir .m-filter-pane__content").find("h2, h3, h4").not(".m-sitedir__entry-title"),u=e(".m-sitedir__entry"),s.on("keyup",_.debounce(o,500)),c.on("change",a),l.on("click","a",r))}}}(jQuery),jQuery(SBN.SiteDirectory.init);var SBN=SBN||{};SBN.Fanposts=function(e){function t(e){Chorus.Context.logged_in||(e.preventDefault(),Chorus.Auth.modal.open("login"))}return{init:function(){e(".m-fanpost-index__new-link, .m-rock-fanpost__new").on("click",t)}}}(jQuery),jQuery(function(){SBN.Fanposts.init()});var SBN=SBN||{};SBN.AutoTabs=function(e){function t(){return""!==window.location.hash?window.location.hash.substring(1):null}function n(e,t){e.find(".is-selected").removeClass("is-selected"),e.find('.m-autotabs__content[id="'+t+'"]').add(e.find('.p-tabs a[href="#'+t+'"]').closest("li")).addClass("is-selected")}function i(t){var n=t.find(".m-autotabs__content"),i='<ul class="p-tabs">[% _.each(data.tabs, function(tab) { %] <li><a href="#[%= tab.id %]">[%= tab.label %]</a></li> [% }); %]</ul>',o={tabs:_.map(n,function(t){var t=e(t);return{id:t.attr("id"),label:t.data("autotabs-label")}})},a=_.template(i,o),r=e(a);n.first().before(r)}function o(t){t.preventDefault();var i=e(t.currentTarget);n(i.closest(".m-autotabs"),i.attr("href").substring(1))}return{init:function(){var n=e(".m-autotabs");if(!(n.length<1)){n.each(function(){i(e(this))}),n.on("click",".p-tabs a",o);var a=t();null!==a?n.find('.p-tabs a[href="#'+a+'"]').trigger("click"):n.find(".p-tabs a").first().trigger("click")}}}}(jQuery),jQuery(SBN.AutoTabs.init);var SBN=SBN||{};SBN.FullArchive=function(e){function t(t){a(e(t.currentTarget()).val());
}function n(t){var n=e(t),i=e('.m-full-archive__entries[data-full-archive-year="'+n.data("full-archive-year")+'"][data-full-archive-month="'+n.data("full-archive-month")+'"]');i.replaceWith(n),SBN.UnreadComments.applyTo(n)}function i(){alert("There was an error loading data from the server")}function o(t,o){e.ajax(r.entries_for_month_data,{data:{month:o,year:t},dataType:"html",timeout:1e4,error:i,success:n})}function a(e){window.location=r.entries_by_year.replace(":year",e.toString())}e(function(){SBN.FullArchive.init()});var r={entries_for_month_data:"/sbn_full_archive/entries_by_month",entries_by_year:"archives/full/:year"};return{init:function(){e(".m-full-archive").length<1||(e("select.m-full-archive__year").on("change",t),e(".m-full-archive__entries").each(function(){var t=e(this);o(t.data("full-archive-year"),t.data("full-archive-month"))}))}}}(jQuery),jQuery(function(){var e=jQuery,t=(Chorus.VideoContext,e(".m-video-browser"));t.length&&(t.on("click","[data-placement]:not(.playing)",function(n){n.preventDefault(),n.stopPropagation(),t.find("[data-placement]").removeClass("playing");var i=(e(n.target).closest("[data-video_index]").addClass("playing"),e(n.target).closest("[data-video-index]").data("video-index"));e("#video_browser").addClass("playing"),e("#video-browser-meta").empty(),$video_embeds=e(video_embeds[i]).filter(".volume-video"),$video_embeds.attr("data-volume-autoplay","true"),0==i?($video_embeds.attr("data-analytics-action","volume:view:hub:hero:playlist1:main"),$video_embeds.attr("data-analytics-placement","hub:hero:playlist1:main")):($video_embeds.attr("data-analytics-action","volume:view:hub:hero:playlist1:list"+i),$video_embeds.attr("data-analytics-placement","hub:hero:playlist1:list"+i)),e("#video_browser").html($video_embeds[0]),volume.embedVideo($video_embeds[0])}),(Util.UserAgentProfiler.isIOS()||Util.UserAgentProfiler.isAndroid())&&t.find("#video_browser").trigger("click"))});var SBN=SBN||{};!function(e){var t=Chorus.VideoContext,n={autoplay:!1,onPlay:function(){},callback:function(){var t=e("#linkset_embed_stub");t.children("div").css({position:"absolute"}),t.find("object, embed, video").attr("width","100%").attr("height","100%"),t.find("div.OoyalaHtml5VideoPlayer").css({width:"100%",height:"100%"})}};SBN.VideoLinkset={ooyala:function(e,i){var o=t.addOoyalaVideo(e,i);t.createPlayer("linkset_embed_stub",o,n)},entryGroup:function(e,i){var o=t.findUnviewedVideo(e,i);t.addVideo(e),t.createPlayer("linkset_embed_stub",o.id,n)}}}(jQuery),jQuery(function(){function e(){"undefined"!=typeof a&&(r&&r.trigger("click"),s&&s.trigger("click"))}function t(t){r=l(".m-hero__player-exit");var n=l(".m-hero__player"),i=".m-hero-block__overlay";t.on("click",i,function(t){var i=l(this).parents(".m-hero-block"),o=i.data("chorus-video-id"),a=Chorus.VideoContext.getVideo(o);"ooyala"===a.provider_video_type&&(t.preventDefault(),e(),n.removeClass("hidden").addClass(h?"transition":"").find("[data-chorus-video-id="+o+"]").removeClass("hidden"),Chorus.VideoContext.createPlayer("hero-video",o,p))}),r.on("click",function(e){e.preventDefault();var t=l(this).parents(".m-hero-block"),i=t.data("chorus-video-id");n.addClass("hidden").find("[data-chorus-video-id="+i+"]").addClass("hidden"),a.destroy()}),t.each(function(){var e=l(this);Chorus.VideoContext.createViewportProxy(l("#hero-video"),e,e.data("chorus-video-id"))})}function n(t){s=l(".m-block__player-exit");var n=".m-block__player";t.on("click",".m-block__image > a",function(t){var i=l(this).parents(".m-block.video"),o=i.find(".m-block__body"),a=i.find(".m-block__image"),r=i.innerHeight(),s=i.data("chorus-video-id"),c="block-video-"+s,d=Chorus.VideoContext.getVideo(s),m=p;"ooyala"===d.provider_video_type&&(t.preventDefault(),e(),h&&f?(i.css("min-height",r).addClass("accelerate").find(n).removeClass("hidden").addClass("transition"),o.addClass("absolute"),a.addClass("full-width transition").on(u,function(){a.off(u),Chorus.VideoContext.createPlayer(c,s,m)})):(i.css("min-height",r).find(n).removeClass("hidden"),o.addClass("absolute"),a.addClass("full-width"),Chorus.VideoContext.createPlayer(c,s,m)))}),s.on("click",function(e){e.preventDefault();var t=l(this).parents(".m-block.video"),i=t.find(".m-block__body"),o=t.find(".m-block__image");o.hasClass("full-width")&&(h&&f?(o.find(n).addClass("hidden"),o.removeClass("full-width").on(u,function(){t.css("min-height","initial").removeClass("accelerate"),i.removeClass("absolute"),o.off(u)})):(o.find(n).addClass("hidden"),o.removeClass("full-width"),t.css("min-height","initial"),i.removeClass("absolute")),a.destroy())}),t.each(function(){var e=l(this),t=e.data("chorus-video-id");Chorus.VideoContext.createViewportProxy(l("#block-video-"+t),e,t)})}function i(){return window.location.host.indexOf(d)>-1}function o(){if(i()&&!m){var e=l(".m-hero-block.videopost"),o=l(".m-block.video");e.length&&t(e),o.length&&n(o)}}var a,r,s,l=jQuery,c=l("html"),d="sbnation",u="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",h=Util.UserAgentProfiler.isDesktop(),m=c.hasClass("ie8"),f=c.hasClass("csstransitions"),p={autoplay:!0,namespace:"INLINE",player_id:window.alternate_ooyala_player_id,callback:function(e){a=e}};o()});var SBN=SBN||{};SBN.FeatureVideo=function(e){var t={playButton:e(".m-video__link"),exitButton:e(".m-video__exit"),videoPane:e(".m-video__pane")},n=t.playButton.data("title"),i=function(e){e.preventDefault();var i=t.playButton.data("ooyala-id"),o=Chorus.VideoContext.addOoyalaVideo(i,n);t.videoPane.removeClass("hidden"),""!==i&&Chorus.VideoContext.createPlayer("video-pane",o,{autoplay:!0,callback:function(e){Chorus.VideoContext.ooyalaPlayer=e}})},o=function(e){e.preventDefault(),Chorus.VideoContext.ooyalaPlayer&&Chorus.VideoContext.ooyalaPlayer.destroy(),t.videoPane.addClass("hidden")},a=function(){t.playButton.on("click",i),t.exitButton.on("click",o)};return{init:a}}(jQuery),jQuery(SBN.FeatureVideo.init);var SBN=SBN||{};SBN.YahooRecommends=function(e){document.referrer.indexOf("yahoo")>-1?e(".yahoo-referral").addClass("show"):e(".no-referral").addClass("show")}(jQuery),Chorus.ModuleLoader=function(e){var t={};e(document).ready(function(){Chorus.ModuleLoader.init()});var n=function(t){e.ajax({type:"GET",url:"/chorus_page/delayed_load_cells",dataType:"json",contentType:"application/json",timeout:1e4,data:t,success:function(t){null!==t&&e.each(t,function(t,n){var i=e(e.parseHTML(n,document,!0)),o=i.data("sbn-module-name");e("#"+t).replaceWith(i),Chorus.EventDispatcher&&(Chorus.EventDispatcher.publish("moduleInserted",{modules:i}),o&&SBN[o]&&SBN[o].init())})}})},i=function(t){t=t||e(document);var i=[],o=Util.UserAgentProfiler.profile();if(t.find("[data-delayed-load-cell-key]").each(function(){var t=e(this);t.data("unless-profile-is")!==o&&i.push(t.data("delayed-load-cell-key"))}),0!=i.length){i.sort();for(var a=2e3,r=0,s=[],l=0,c=i.length;l<c;l++){var d=i[l],u=d.length;if(r+u>=a){var h={cells:JSON.stringify(s)};Chorus.Context.hub_id&&(h.hub_id=Chorus.Context.hub_id),Chorus.Context.entry_id&&(h.entry_id=Chorus.Context.entry_id),n(h),s=[d],r=0}else r+=u,s.push(d);if(l+1==c){var h={cells:JSON.stringify(s)};Chorus.Context.hub_id&&(h.hub_id=Chorus.Context.hub_id),Chorus.Context.entry_id&&(h.entry_id=Chorus.Context.entry_id),n(h)}}}};return t.init=function(){this.initUI()},t.initUI=function(){i()},t}(jQuery);var Chorus=Chorus||{};Chorus.EditoriallyManagedCell=function(e,t){"use strict";function n(e){for(var t={},n=e.serializeArray(),i=n.length-1;i>-1;i--){var o=n[i].name,a=n[i].value;t[o]?t[o]=_.flatten([t[o],a]):t[o]=a}return t}function i(){alert("There was an error updating this cell. Please check your URL and/or that all fields are completed.")}function o(t){t.preventDefault();var n=e(t.currentTarget);r(n.closest(".chorus-emc__admin"),n.data("emc-action"),n.data("emc-data"))}function a(t){t.preventDefault();var i=e(t.currentTarget),o=i.closest("form");r(e('.chorus-emc__admin[data-emc-slug="'+o.data("emc-slug")+'"]'),"update",_.extend(n(o),{button_action:i.data("emc-action")}))}function r(t,n,o){var o=_.extend({slug:t.data("emc-slug"),bucket:t.data("emc-bucket")},o),a=c[n];if("edit"===n||"help"===n)Chorus.EventDispatcher.publish("modal_open",{method:r,url:a,data:o});else{var r="update"==n?"POST":"GET";s(t),e.ajax({method:r,url:a,data:o,success:function(n){Chorus.EventDispatcher.publish("modal_close");var i=e('.chorus-emc__content[data-emc-slug="'+t.data("emc-slug")+'"]');i.length>0&&i.replaceWith(n)},error:i})}}function s(t){e(t).find(".chorus-emc__content").html("Loading...")}function l(){e(t).on("click",".chorus-emc__admin *[data-emc-action]",o),e(t).on("click",".chorus-emc__form *[data-emc-action]",a)}var c={edit:"/editorially_managed_cells/handle_edit",update:"/editorially_managed_cells/handle_update",preview:"/editorially_managed_cells/preview",show_live:"/editorially_managed_cells/refresh",help:"/editorially_managed_cells/help"};return{init:l,urls:c}}(jQuery,document),jQuery(function(){Chorus.EditoriallyManagedCell.init()});var Chorus=Chorus||{};Chorus.EmcAdmin=function(e){function t(t,n){var i=t.find("input"),o=n.find("input");i.each(function(t){var n=e(this),i=e(o[t]),a=i.val();i.val(n.val()),n.val(a)})}function n(n){var i=e(n.currentTarget).closest("li"),o=i.prev("li");t(i,o)}function i(n){var i=e(n.currentTarget).closest("li"),o=i.next("li");t(i,o)}return{init:function(){Chorus.Context.emc_admin!==!1&&($doc=e(document),$doc.on("click",".m-emc-admin__reorderable-list .up",n),$doc.on("click",".m-emc-admin__reorderable-list .down",i))}}}(jQuery),jQuery(function(){Chorus.EmcAdmin.init()});var SBN=SBN||{};SBN.ChannelBrowser=function(e){function t(){var e=a.width(),t=Math.floor((e-s)/(r+s));return{number:t,gutterWidth:t<=1?s:(e-s-t*r)/(t-1)}}function n(){console.log(t());var e=a.find(".m-channel-browser__ad");e.prevAll(".m-channel-browser__item").insertAfter(e),e.nextAll(".m-channel-browser__item:lt("+(t().number-1)+")").insertBefore(e)}function i(){for(var e=a.find(".m-channel-browser__item"),n=t(),i=n.number,o=n.gutterWidth-4,r=0,l=0,c=e.length;l<c;l++){var d=r===i-1,u=o;d&&(u=0),i<=1&&(u=s),e.eq(l).css("margin-right",u),r=d?0:r+1}}function o(){n(),i()}var a,r=300,s=40;return{init:function(){a=e(".m-channel-browser"),a.length<1||(n(),i(),e(window).on("resize",_.debounce(o,500)))}}}(jQuery),jQuery(SBN.ChannelBrowser.init),jQuery(function(){function e(){if(sel=window.getSelection(),sel.rangeCount&&(range=sel.getRangeAt(0).cloneRange(),range.getClientRects)){var e=range.getClientRects(),t=e[e.length-1];if(t)return{x:t.right+l.scrollLeft()+5,y:t.top+l.scrollTop()+5}}return null}function t(e){r||(r=s(['<div class="m-share_selection_contextual">',"<h3>Share your selection with your interweb friends</h3>","<ul>",'<li><a href="#" class="p-button has-icon twitter" data-analytics-social="twitter" data-analytics-placement="selection">Tweet (<span id="contextual-chars"></span> char)</a></li>','<li><a href="#" class="p-button has-icon facebook" data-analytics-social="facebook" data-analytics-placement="selection">Share on Facebook</a></li>',"</ul>","</div>"].join("")).on("click","a",n),s("head").append('<script src="//connect.facebook.net/en_US/sdk.js"></script>')),r.find("#contextual-chars").text(window.getSelection().toString().length),r.css({top:e.y,left:e.x}),s("body").append(r)}function n(e){var t=s(e.currentTarget),n=t.attr("data-analytics-social"),o=Chorus.Context.entry_url||window.location.href,a="#";if("facebook"===n&&("undefined"!=typeof FB?(FB.ui({method:"feed",link:Chorus.Context.entry_url||window.location.href,caption:c},function(){}),e.stopPropagation()):a="https://facebook.com/sharer.php?u="+o),"twitter"===n){var r=Chorus.Context.community_twitter_screen_name;a="https://twitter.com/intent/tweet?url="+o+"&text="+c,r&&(a+="&via="+r)}t.attr("href",a),_.delay(i,20)}function i(){r&&r.detach()}function o(){_.delay(function(){c=window.getSelection().toString();var n=e();c.length<1||!n?i():t(n)},100)}function a(){window.getSelection&&Chorus.Context.select_to_tweet!==!1&&s(".m-entry__intro, .m-entry__body").on("mouseup",o)}var r,s=jQuery,l=s(window),c="";a()}),function(e){function t(e){var t={};e=(e||"").replace(/^(\?|\&)/,"").split("&");for(var n=0;n<e.length;n++){var i=e[n].split("=");i.length>1&&(t[i[0]]=i[1])}return t}function n(n,i){var a=n.attr("href"),r=n.attr("data-url");if(r&&o[i]&&(a=o[i]+encodeURIComponent(r)),a&&"#"!==a[0]){var s=a.match(/(.*(?:\?|\&)(?:url|u)=)([^&]+)(.*)/),l=n.closest("[data-analytics-placement]").attr("data-analytics-placement"),c=decodeURIComponent(s[2]).split("?"),d=c[0].split("#"),u=d[0]||c[0],h=d[1]||"",m=e.extend({utm_campaign:location.hostname.replace(/(www\.)?(.+)\.com/,"$2"),utm_content:Chorus.Analytics.contentType()+(l?":"+l:""),utm_medium:"social",utm_source:i},t(c[1]),t(n.attr("data-params")));a=""==h.trim()?s[1]+encodeURIComponent(u+"?"+e.param(m))+s[3]:s[1]+encodeURIComponent(u+"?"+e.param(m)+"#"+h)+s[3],n.attr("href",a)}return a}var i,o={facebook:"http://www.facebook.com/share.php?u=",twitter:"https://twitter.com/intent/tweet?url=",pinterest:"https://www.pinterest.com/pin/create/button/?url="};e("[data-analytics-social]").on("click",function(t){var o,a,r=e(this),s=r.attr("data-analytics-social"),l=n(r,s),c=570,d=570;if(Chorus.Context.is_preview)return t.stopPropagation(),alert("Social buttons cannot be used during preview.");switch(s){case"facebook":d=279;break;case"twitter":d=279;break;case"linkedin":d=520;break;case"pinterest":c=d=750}if("#"!==l[0]&&"_blank"!==r.attr("target")&&"whatsapp"!==s){i&&i.close&&i.close(),a=screen.width/2-c/2,o=screen.height/2-d/2,i=window.open(l,"","width="+c+", height="+d+", top="+o+", left="+a),t.preventDefault();var u=window.open;window.open=function(){},setTimeout(function(){window.open=u},0)}}),function(e,t,n){function i(){var e,i=t.getElementsByTagName(n)[0],o=function(o,a){t.getElementById(a)||(e=t.createElement(n),e.src=o,e.id=a,i.parentNode.insertBefore(e,i))};Util.UserAgentProfiler.isAndroidLt3()||(o("https://connect.facebook.net/en_US/sdk.js","fbjs"),o("https://platform.twitter.com/widgets.js","tweetjs"))}e.addEventListener?e.addEventListener("load",i,!1):e.attachEvent&&e.attachEvent("onload",i)}(window,document,"script"),function(){function t(){d();var e=c,t=i.scrollTop(),o=t>=r,a=!s||t<=s;c=o&&a&&!l,c!==e&&(Chorus.EventDispatcher.publish("fixedSocial",{isFixed:c,position:n.position()}),n.toggleClass("fixed",c))}var n=e("#chorus-social-fixed");if(n.length){n.appendTo("body");var i=e(window),o=e("#chorus-social-fixed-threshold"),a=e("#comments"),r=0,s=0,l=!1,c=!1,d=_.throttle(function(){Chorus.Environment.touch()&&(l=screen.width>window.innerWidth),o.length&&(r=o.offset().top),a.length&&(s=a.offset().top)},1500);e(document).on("scroll",_.throttle(t,150)),t()}}(),e("[data-shareable-content]").each(function(){var t=e(this),n=t.attr("data-original")||t.attr("src");if(!n){var i=this.currentStyle||window.getComputedStyle(this,!1);n=i&&i.backgroundImage.slice(4,-1)}if(n){var a="m-shareable-content",r=a+"__wrap",s=o.pinterest+encodeURIComponent(location.href)+"&media="+encodeURIComponent(n),l=Chorus.Environment.touch()?" touch":"";if(t.is("img")){var c=t.closest("."+r);t=c.length?c:t.wrap('<div class="'+r+'"></div>').parent()}else t.toggleClass(r,!0);t.prepend('<a href="'+s+'" class="'+a+"__pinterest"+l+'" data-analytics-social="pinterest"></a>')}})}(jQuery);var Chorus=Chorus||{};Chorus.MobileAdandSocialMediator=function(e){"use strict";function t(){e(r).css("display","none")}function n(){e(s).css("display","none")}function i(e){var i=e&&e.isFixed,o=e&&e.position&&e.position.top>100;!a&&i&&o&&(a=!0,t(),n())}function o(){Chorus.EventDispatcher.subscribe("fixedSocial",i,!0)}var a=!1,r=".krg-hov-wrapper, [class*=kargo-ad]",s=".crisp_Css_Ad_Cradle, .crispTopAdCradle";return{init:o}}(jQuery),jQuery(function(){Chorus.MobileAdandSocialMediator.init()});var Chorus=Chorus||{};Chorus.Tooltip=function(e){var t="tooltip-text",n="tooltip-class",i=function(t){return t.preventDefault(),e(this).data("tooltip-shown")||o(e(this)),!1},o=function(i){var o=i.data(t),r=i.data(n)||"tooltip",s="tool-tip-"+Math.round(1e3*Math.random());i.data("tooltip-shown",s);var l=i.offset().top+i.height(),c=i.offset().left,d=e("<span id='"+s+"' data-is-tooltip class='"+r+"'>"+o+"</span>");d.on("click",a),d.css({top:l,left:c,position:"absolute"}),Util.UserAgentProfiler.isMobile()&&d.css({left:0}),"undefined"!=typeof o&&""!==o&&(e(document.body).prepend(d),setTimeout(function(){d.addClass("shown")},200))},a=function(){var t=e(this).data("tooltip-shown")||e(this).filter("is-tooltip").attr("id");if(t){var n=e("#"+t);e(this).removeData("tooltip-shown"),n.removeClass("shown"),setTimeout(function(){n.remove()},1e3)}},r=function(t){e(t).not("[data-tooltip-shown]").on("click",i),e(t).not("[data-tooltip-shown]").on("mouseover",i),e(t).on("mouseout",a)};return{attachTo:r,init:r}}(jQuery),jQuery(function(){Chorus.Tooltip.attachTo("[data-tooltip-text]"),jQuery(document).on("hymnal:render",function(e,t){var n=jQuery(t.ad.getElement()).find("[data-tooltip-text]");Chorus.Tooltip.attachTo(n)})}),function(e){"use strict";function t(){var e=document.referrer.split("/")[2],t=location.href.split("/")[2];e!==t&&(C.referralDomain=C.referralDomain||e)}function n(){C.pagesSeeninSession++}function i(){var e=new Date-new Date(2014,0,0),t=864e5;return Math.floor(e/t)}function o(){C.recordedSessionCount||(y.loyaltySessions.push(i()),C.recordedSessionCount=!0)}function a(){return y.loyaltySessions.length}function r(){var e=y.loyaltySessions.length;if(e<1)return 0;var t=(i()-v,0);for(var n in y.loyaltySessionTimes)y.loyaltySessionTimes.hasOwnProperty(n)&&(t+=y.loyaltySessionTimes[n]);return Math.ceil(t/e)}function s(){var e=i()-v,t={};for(var n in y.loyaltySessionTimes)y.loyaltySessionTimes.hasOwnProperty(n)&&n>e&&(t[n]=y.loyaltySessionTimes[n]);y.loyaltySessionTimes=t,y.loyaltySessions=_.reject(y.loyaltySessions,function(t){return t<e})}function l(){C.updatedAt=new Date,sessionStorage.setItem(g,JSON.stringify(C)),localStorage.setItem(g,JSON.stringify(y))}function c(){C=JSON.parse(sessionStorage.getItem(g)),y=JSON.parse(localStorage.getItem(g)),(null===C||"object"!=typeof C||new Date-C.updatedAt>b)&&(C={},e.extend(C,k)),null!==y&&"object"==typeof y||(y={},e.extend(y,w)),d()}function d(){for(var e in w)y[e]=y[e]||w[e];for(e in k)sessionStorage[e]=sessionStorage[e]||k[e]}function u(){if("undefined"!=typeof window.onbeforeunload){var t=new Date,n=function(){var e=Math.round((new Date-t)/1e3);y.loyaltySessionTimes[i()]=(y.loyaltySessionTimes[i()]||0)+e,l()};e(window).on("beforeunload",n)}}function h(){return{loyalty_bsg:a(),avgsestime_bsg:r(),firstimp_bsg:C.pagesSeeninSession,referral_bsg:C.referralDomain}}function m(){var e=[],t=h();for(var n in t)e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));var i="essencedigital34895338176918191",o="https://z.moatads.com/"+i+"/moatcontent.js?"+e.join("&"),a=document.createElement("script");a.async=!0,a.type="text/javascript",a.src=o;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(a,r)}var f=!1,p="gbs4life",g="GBSignalUnison",v=30,b=18e5,y={loyaltySessions:[],loyaltySessionTimes:{}},w={};e.extend(w,y);var C={referralDomain:null,pagesSeeninSession:0,recordedSessionCount:!1,updatedAt:new Date},k={};if(e.extend(k,C),localStorage&&localStorage.setItem&&localStorage.removeItem)try{localStorage.setItem(p,p),localStorage.removeItem(p),f=!0}catch(e){}f&&"object"==typeof sessionStorage&&(c(),u(),t(),s(),n(),o(),l(),m())}(jQuery);var Chorus=Chorus||{};Chorus.PrintRef=function(e){var t=function(){var t=e(".m-entry__top-header, .m-entry__body, .m-breaker-stream").find("a[href^='http']:visible"),n=_.map(t,function(t,n){return"<div>["+n+"] "+e(t).attr("href")+"</div>"}).join("");_.each(t,function(t,n){e(t).attr("data-ref-index",n)}),e(".l-container, .l-wrapper").after("<div class='print-ref' style='display: none;'>"+n+"</div>")},n=function(){e(".video-wrap, .p-scalable-video").attr("data-ref-message",window.location.href)};return{init:function(){setTimeout(function(){t(),n()},1e3)}}}(jQuery),jQuery(Chorus.PrintRef.init);var dataLayer=dataLayer||[];Chorus.OnLoad(function(){var e;void 0!==navigator.doNotTrack?e=navigator.doNotTrack:void 0!==window.doNotTrack?e=window.doNotTrack:void 0!==navigator.msDoNotTrack&&(e=navigator.msDoNotTrack),e=void 0!==e?/1|yes|true/.test(String(e).toLowerCase())?"true":"false":"undefined";var t={DNT:e};"object"==typeof ChorusAds&&(t["Ads Blocked"]=ChorusAds.adsBlocked),dataLayer.push(t)});var Chorus=Chorus||{};Chorus.UserMessaging=function(e){function t(e){e.on("webkittransitionend transitionend otransitionEnd mstransitionend transitionend",function(){e.remove()}),e.addClass("is-closed")}function n(n){n.preventDefault(),n.stopPropagation(),t(e(n.delegateTarget))}function i(){var t=e(".m-user-msg__notice");t.length>1&&o(),t.first().find(".m-user-msg__close").trigger("click")}function o(){s===!0&&(dur=e(".m-user-msg__notice_short").length>0?c:l,to=setTimeout(i,dur))}function a(){e(".m-user-msg__notice, .m-user-msg__error").on("click",".m-user-msg__close",n)}function r(){e(".m-user-msg__modal").each(function(){Chorus.EventDispatcher.publish("modal_open",{content:e(this)})})}var s="polygon"===Chorus.Context.network_slug,l=3e4,c=4e3;return{init:function(){e(".m-user-msg").length<1||(r(),a(),o())}}}(jQuery),jQuery(Chorus.UserMessaging.init);var Chorus=Chorus||{};Chorus.Modal=function(e){"use strict";function t(){if(null===w){var t=e(y());v.append(t),t.on("click",f),w=t.find(".m-chorus-modal__root").addBack(".m-chorus-modal__root").first()}}function n(){t(),v.addClass("chorus-modal-loading")}function i(){v.removeClass("chorus-modal-loading")}function o(){t(),v.addClass("chorus-modal-open")}function a(){v.removeClass("chorus-modal-open")}function r(t){n();t.data||{};t.success=function(e){t.content=e,s(t)},t.error=function(e,t){"abort"!==t&&alert("There was an error recieving data from the server."),i()},C.push(e.ajax(t))}function s(t){i(),o();var n=e(b(t));if(n.find(".m-chorus-modal__window-root").append(t.content),t.includeCloseButton){var a=e('<div class="m-chorus-modal__close">&times;</div>');a.on("click",g),n.find(".m-chorus-modal__window-root").append(a)}n.addClass(t.modalClass),n.data("chorus-modal-callbacks",t.callbacks),w.prepend(n),n.on("click","*[data-chorus-modal-action]",m),d("attach",n)}function l(e){e.remove(),0===w.children().length&&(a(),i())}function c(e){e.callbacks=e.callbacks||{},e.title=e.title||"Untitled Modal",e.content=e.content||null,e.modalClass=e.modalClass||null,e.url?r(e):null!==e.content&&s(e)}function d(e,t){var n=t.data("chorus-modal-callbacks");if("cancel_confirm"===e){if(!confirm("Are you sure you want to close this window?"))return;e="cancel"}"function"==typeof n[e]&&n[e](t),"cancel"!=e&&"close"!=e||l(t)}function u(){for(Chorus.EventDispatcher.publish("modal_closed_by_modaljs"),e(".m-chorus-modal__window").each(function(){d("cancel",e(this))}),null!==w&&w.empty(),a(),i();C.length>0;)C.pop().abort()}function h(){k=!0;var t=e("#chorus-modal-window-template").html()||"",n=e("#chorus-modal-wrapper-template").html()||"";v=e("body"),b=_.template(t),y=_.template(n)}function m(t){t.preventDefault(),d(e(t.target).data("chorus-modal-action").toString().trim(),e(t.delegateTarget))}function f(t){e(t.target).is(w)&&u()}function p(e){k===!1&&h(),c(e)}function g(){u()}var v,b,y,w=null,C=[],k=!1;return{init:function(){Chorus.EventDispatcher.subscribe("modal_open",p),Chorus.EventDispatcher.subscribe("modal_close",g)},open:function(e){Chorus.EventDispatcher.publish("modal_open",e)},close:function(e){Chorus.EventDispatcher.publish("modal_close",e)}}}(jQuery),Chorus.Modal.init();var shortcut={all_shortcuts:{},add:function(e,t,n){var i={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(n)for(var o in i)"undefined"==typeof n[o]&&(n[o]=i[o]);else n=i;var a=n.target;"string"==typeof n.target&&(a=document.getElementById(n.target));e=e.toLowerCase();var r=function(i){if(i=i||window.event,n.disable_in_input){var o;if(i.target?o=i.target:i.srcElement&&(o=i.srcElement),3==o.nodeType&&(o=o.parentNode),"INPUT"==o.tagName||"TEXTAREA"==o.tagName)return}i.keyCode?code=i.keyCode:i.which&&(code=i.which),i.key?character=i.key.toLowerCase():character=String.fromCharCode(code).toLowerCase(),188==code&&(character=","),190==code&&(character=".");var a=e.split("+"),r=0,s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},l={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},c={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};i.ctrlKey&&(c.ctrl.pressed=!0),i.shiftKey&&(c.shift.pressed=!0),i.altKey&&(c.alt.pressed=!0),i.metaKey&&(c.meta.pressed=!0);for(var d=0;k=a[d],d<a.length;d++)"ctrl"==k||"control"==k?(r++,c.ctrl.wanted=!0):"shift"==k?(r++,c.shift.wanted=!0):"alt"==k?(r++,c.alt.wanted=!0):"meta"==k?(r++,c.meta.wanted=!0):k.length>1?l[k]==code&&r++:n.keycode?n.keycode==code&&r++:character==k?r++:s[character]&&i.shiftKey&&(character=s[character],character==k&&r++);if(r==a.length&&c.ctrl.pressed==c.ctrl.wanted&&c.shift.pressed==c.shift.wanted&&c.alt.pressed==c.alt.wanted&&c.meta.pressed==c.meta.wanted&&(t(i),!n.propagate))return i.cancelBubble=!0,i.returnValue=!1,i.stopPropagation&&(i.stopPropagation(),i.preventDefault()),!1};this.all_shortcuts[e]={callback:r,target:a,event:n.type},a.addEventListener?a.addEventListener(n.type,r,!1):a.attachEvent?a.attachEvent("on"+n.type,r):a["on"+n.type]=r},remove:function(e){e=e.toLowerCase();var t=this.all_shortcuts[e];if(delete this.all_shortcuts[e],t){var n=t.event,i=t.target,o=t.callback;i.detachEvent?i.detachEvent("on"+n,o):i.removeEventListener?i.removeEventListener(n,o,!1):i["on"+n]=!1}}},miuScript;!function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=!1,"string"==typeof settings&&(method=settings,params=extraSettings),options={id:"",nameSpace:"",root:"",previewHandler:!1,previewInWindow:"",previewInElement:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:!1,previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(e,t){miuScript=$(t).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])});var uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},matched=uaMatch(navigator.userAgent),browser={};return matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),this.each(function(){function localize(e,t){return t?e.replace(/("|')~\//g,"$1"+options.root):e.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor"),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),options.resizeHandle===!0&&browser.safari!==!0&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var t,n,i=$$.height(),o=e.clientY;t=function(e){return $$.css("height",Math.max(20,e.clientY+i-o)+"px"),!1},n=function(){return $("html").unbind("mousemove.markItUp",t).unbind("mouseup.markItUp",n),!1},$("html").bind("mousemove.markItUp",t).bind("mouseup.markItUp",n)}),footer.append(resizeHandle)),$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed),$$.bind("insertion.markItUp",function(e,t){t.target!==!1&&get(),textarea===$.markItUp.focused&&markup(t)}),$$.bind("focus.markItUp",function(){$.markItUp.focused=this}),options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'" tabindex="-1">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return!1}).bind("touchstart.markItUp",function(){(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))&&textarea.blur()}).bind("click.markItUp touchstart.markItUp",function(e){e.preventDefault()}).bind("mouseup touchend",function(){return button.call&&eval(button.call)(),markup(button),!1}).bind("mouseenter.markItUp",function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(e){return e?(e=e.toString(),e=e.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(e,t){var n=t.split("|!|");return altKey===!0?void 0!==n[1]?n[1]:n[0]:void 0===n[1]?"":n[0]}),e=e.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(e,t){var n=t.split(":!:");return abort!==!0&&(value=prompt(n[0],n[1]?n[1]:""),null===value&&(abort=!0),value)})):""}function prepare(e){return $.isFunction(e)&&(e=e(hash)),magicMarkups(e)}function build(e){var t=prepare(clicked.openWith),n=prepare(clicked.placeHolder),i=prepare(clicked.replaceWith),o=prepare(clicked.closeWith),a=prepare(clicked.openBlockWith),r=prepare(clicked.closeBlockWith),s=clicked.multiline;if(""!==i)block=t+i+o;else if(""===selection&&""!==n)block=t+n+o;else{e=e||selection;var l=[e],c=[];s===!0&&(l=e.split(/\r?\n/));for(var d=0;d<l.length;d++){line=l[d];var u;(u=line.match(/ *$/))?c.push(t+line.replace(/ *$/g,"")+o+u):c.push(t+line+o)}block=c.join("\n")}return block=a+block+r,{block:block,openBlockWith:a,openWith:t,replaceWith:i,placeHolder:n,closeWith:o,closeBlockWith:r}}function markup(e){var t,n,i,o;if(hash=clicked=e,get(),$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),ctrlKey===!0&&shiftKey===!0){for(lines=selection.split(/\r?\n/),n=0,i=lines.length,o=0;o<i;o++)""!==$.trim(lines[o])?($.extend(hash,{line:++n,selection:lines[o]}),lines[o]=build(lines[o]).block):lines[o]="";string={block:lines.join("\n")},start=caretPosition,t=string.block.length+(browser.opera?i-1:0)}else ctrlKey===!0?(string=build(selection),start=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,t-=string.block.match(/ $/)?1:0,t-=fixIeBug(string.block)):shiftKey===!0?(string=build(selection),start=caretPosition,t=string.block.length,t-=fixIeBug(string.block)):(string=build(selection),start=caretPosition+string.block.length,t=0,start-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),start=caretPosition+string.openBlockWith.length+string.openWith.length,t=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition
}),string.block!==selection&&abort===!1?(insert(string.block),set(start,t)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(e){return browser.opera?e.length-e.replace(/\n*/g,"").length:0}function fixIeBug(e){return browser.msie?e.length-e.replace(/\r*/g,"").length:0}function insert(e){if(document.selection){var t=document.selection.createRange();t.text=e}else textarea.value=textarea.value.substring(0,caretPosition)+e+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(e,t){if(textarea.createTextRange){if(browser.opera&&browser.version>=9.5&&0==t)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",e),range.moveEnd("character",t),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(e,e+t);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,browser.msie){textarea.focus();var e=document.selection.createRange(),t=e.duplicate();for(t.moveToElementText(textarea),caretPosition=-1;t.inRange(e);)t.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=textarea.value.substring(caretPosition,textarea.selectionEnd);return selection}function preview(){"function"==typeof options.previewHandler?previewWindow=!0:options.previewInElement?previewWindow=$(options.previewInElement):!previewWindow||previewWindow.closed?options.previewInWindow?(previewWindow=window.open("","preview",options.previewInWindow),$(window).unload(function(){previewWindow.close()})):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):altKey===!0&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview(),options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){if(options.previewHandler&&"function"==typeof options.previewHandler)options.previewHandler($$.val());else if(options.previewParser&&"function"==typeof options.previewParser){var e=options.previewParser($$.val());writeInPreview(localize(e,1))}else""!==options.previewParserPath?$.ajax({type:"POST",dataType:"text",global:!1,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(e){writeInPreview(localize(e,1))}}):template||$.ajax({url:options.previewTemplatePath,dataType:"text",global:!1,success:function(e){writeInPreview(localize(e,1).replace(/<!-- content -->/g,$$.val()))}});return!1}function writeInPreview(e){if(options.previewInElement)$(options.previewInElement).html(e);else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open(),previewWindow.document.write(e),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}}function keyPressed(e){if(shiftKey=e.shiftKey,altKey=e.altKey,ctrlKey=(!e.altKey||!e.ctrlKey)&&(e.ctrlKey||e.metaKey),"keydown"===e.type){if(ctrlKey===!0&&(li=$('a[accesskey="'+(13==e.keyCode?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li"),0!==li.length))return ctrlKey=!1,li.triggerHandler("mouseup"),!1;if(13===e.keyCode||10===e.keyCode)return ctrlKey===!0?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):shiftKey===!0?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===e.keyCode)return 1!=shiftKey&&1!=ctrlKey&&1!=altKey&&(caretOffset!==-1?(get(),caretOffset=$$.val().length-caretOffset,set(caretOffset,0),caretOffset=-1,!1):(markup(options.onTab),options.onTab.keepDefault))}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor"),$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$),$$.data("markItUp",null)}var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;if($$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),method)switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}else init()})},$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})},$.markItUp=function(e){var t={target:!1};return $.extend(t,e),t.target?$(t.target).each(function(){$(this).focus(),$(this).trigger("insertion",[t])}):void $("textarea").trigger("insertion",[t])}}(jQuery),window.Chorus||(Chorus={}),Chorus.Comments=_.extend({},Backbone.Events,{Collections:{},Models:{},Views:{},Mixins:{},autoUpdateTimeout:null,defaults:{ajaxParams:{},ajaxTimeout:15e3,alertErrors:!0,avatarBreakpointIndex:2,autoUpdateAlertMaxShown:5,autoUpdateAlertTimeShown:6500,autoUpdateEnabled:!1,buildAncestry:!0,currentAutoUpdateInterval:4e4,editTimeWindow:90,emptyUpdateTolerance:5,fastAutoUpdateInterval:3e4,flaggedThreshold:1,localClockOffset:null,markItUp:{onShiftEnter:{keepDefault:!1,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"*",openWith:"*"},{name:"Italic",key:"I",closeWith:"_",openWith:"_"},{name:"Strike through",key:"S",closeWith:"-",openWith:"-"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%"},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:!0},{name:"Numeric list",openWith:"# ",multiline:!0},{separator:"---------------"},{name:"Picture",openWith:"![![Source:!:http://]!](",closeWith:")!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Quotes",openWith:"bq. "}],resizeHandle:!1},maxIndentationDepth:30,offsetHeight:Math.floor(.333*jQuery(window).height()),recommendedThreshold:1,renderChunkLength:200,renderTo:"#comments",scrollAnimationDuration:300,scrollBuffer:0,showAutoUpdateAlert:!0,showAvatars:!0,showSignatures:!0,showImages:!0,removeImages:!1,removeEmoji:!1,slowAutoUpdateInterval:6e4,sortMethod:"ancestry",startOnScroll:Chorus.Environment.currentBreakpoint().index>1},settings:{},initialize:function(e,t){return this.stop(),this.started=!1,this.context={},this.settings=_.extend({},this.defaults,this.settings,t),this.collection=new Chorus.Comments.Collections.Comments([],{entryId:e}),this.settings.renderTo&&(this.compileTemplates(),this.view=new Chorus.Comments.Views.Main({el:this.settings.renderTo,collection:this.collection}),this.view.render()),window.location.hash.match(/^#\d+$/)&&this.start(),this},initContext:function(e){this.context=e,this.settings.autoUpdateEnabled=this.settings.autoUpdateEnabled&&this.context.able_to_comment&&!this.context.comments_closed&&Chorus.Environment.currentBreakpoint().index>1,this.settings.autoUpdateEnabled&&this.startAutoUpdate()},start:function(){if(!this.started)return this.started=!0,this.listenTo(this,"ajaxSuccess",this.ajaxSuccess),this.listenTo(this,"ajaxError",this.ajaxError),this.collection.load(),this.trigger("start"),Chorus.Analytics&&Chorus.Analytics.eventAutoFormat("interaction","comment_load"),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("startComments"),this},stop:function(){return this.view&&this.view.remove(),this.view=null,this.collection=null,this.started=!1,this.trigger("stop"),this.stopListening(),this},compileTemplates:function(){_.each(Chorus.Comments.Views,function(e){if(e.prototype.templateId){var t=jQuery("#"+e.prototype.templateId).html()||"";e.prototype.template=_.template(t)}})},scheduleAutoUpdate:function(e){if(this.settings.autoUpdateEnabled){var t;t=e.emptyUpdateCount<this.settings.emptyUpdateTolerance?this.settings.fastAutoUpdateInterval:this.settings.slowAutoUpdateInterval,this.settings.currentAutoUpdateInterval=t,clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=setTimeout(function(){e.update()},t)}},startAutoUpdate:function(){this.settings.autoUpdateEnabled=!0,this.listenTo(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),this.scheduleAutoUpdate(this.collection)},stopAutoUpdate:function(){this.settings.autoUpdateEnabled=!1,this.stopListening(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=null},openModal:function(e){Chorus.EventDispatcher.publish("modal_open",{content:e})},closeModal:function(){Chorus.EventDispatcher.publish("modal_close")},ajaxSuccess:function(e,t,n){var i=Date.parse(n.getResponseHeader("Date")),o=((new Date).valueOf()-i.valueOf())/1e3,a=this.settings.localClockOffset;_.isNumber(a)?this.settings.localClockOffset=(a+o)/2:this.settings.localClockOffset=o},ajaxError:function(e){try{var t=JSON.parse(e.responseText);t.message&&this.settings.alertErrors&&alert(t.message)}catch(e){}}}),Chorus.Comments.Mixins.Ajax={urlFor:function(e){var t=this.urls[e];return t&&(t=t.replace(/:([^\/]+)/,_.bind(function(e,t){return this instanceof Backbone.Model?this.get(t):this[t]},this))),t},ajax:function(e,t){var n=this.urlFor(e);if(!n)throw"ArgumentError: No url specified for action: "+e;var i=this,o=_.extend({url:n,dataType:"json",context:this,timeout:Chorus.Comments.settings.ajaxTimeout},this.ajaxOptions||{},t);return o.data&&_.isObject(o.data)&&"POST"===o.type&&(o.contentType="application/json",o.data=JSON.stringify(o.data),o.processData=!1),o.error=function(n,a,r){t&&_.isFunction(t.error)&&t.error.call(o.context,i,r),i.trigger(e+"Error",i,r,n),Chorus.Comments.trigger("ajaxError",n,a,r,i)},o.success=function(n,a,r){t&&_.isFunction(t.success)&&t.success.call(o.context,i,n),i.trigger(e+"Success",i,n,r),Chorus.Comments.trigger("ajaxSuccess",n,a,r,i)},i.trigger(e+"Start",i),Chorus.Comments.trigger("ajaxStart",i),jQuery.ajax(o)}},Chorus.Comments.Models.Comment=Backbone.Model.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{ajaxOptions:{type:"POST"},urls:{preview:"/comments/preview_comment",post:"/comments/post_comment",edit:"/comments/edit_comment/:id",hide:"/comments/hide_comment/:id",flag:"/comments/flag_comment/:id",unflag:"/comments/unflag_comment/:id",recommend:"/comments/recommend_comment/:id",destroy:"/comments/destroy_comment/:id",loadFlaggings:"/comments/ajax_comment_flags/:id",blockUser:"/comments/block_user/:id"},initialize:function(){!Chorus.Comments.settings.buildAncestry||this.get("ancestry")&&this.get("depth")||this.buildAncestry(),this.listenTo(this,"change:id change:parent_id",this.buildAncestry),this.listenTo(this,"change:collapsed",this.collapseDescendants)},buildAncestry:function(){var e,t=function(e){return e=e.toString(),e.length>=10?e:new Array(10-e.length+1).join("0")+e},n=this.id?t(this.id):"preview",i=this.parent();i&&(n=i.get("ancestry")+"/"+n),e=n.split("/").length,e=Math.min(e,Chorus.Comments.settings.maxIndentationDepth),this.set({ancestry:n,depth:e},{silent:!0})},user:function(){return this.collection.users.get(this.get("user_id"))||new Chorus.Comments.Models.User({display_name:this.get("username")||"anonymous"})},parent:function(){var e=this.get("parent_id");return e?this.collection.get(e):null},ancestors:function(){if(!this.get("ancestry"))return[];var e=this.get("ancestry").split("/");return e.pop(),_.map(e,function(e){return e=parseInt(e,10),this.collection.get(e)},this)},descendants:function(){var e=new RegExp("^"+this.get("ancestry")+"/");return this.collection.filter(function(t){return e.test(t.get("ancestry"))})},matchesConditions:function(e){for(var t in e)if(e[t]!=this.get(t))return!1;return!0},findNeighbor:function(e,t,n){var i,o=this.collection.indexOf(this),a=this.collection.length-1,r=o;if(0===a)return null;do{if(r=n?r-1:r+1,!t&&(r<0||r>a))return null;if(r<0?r=a:r>a&&(r=0),i=this.collection.at(r),i&&i.matchesConditions(e))return i}while(r!==o);return null},prev:function(e,t){return this.findNeighbor(e,t,!0)},next:function(e,t){return this.findNeighbor(e,t,!1)},flaggings:function(){return this.collection.flaggings.where({flaggable_id:this.id})},isFlagged:function(){return this.get("bad_flags_count")>=Chorus.Comments.settings.flaggedThreshold},isRecommended:function(){return this.get("recommended_flags_count")>=Chorus.Comments.settings.recommendedThreshold},createFlagging:function(e){return this.collection.flaggings.add({flag_name:e,flaggable_id:this.id,user_id:Chorus.Comments.context.user_id,created_on:new Date})},secondsSinceCreate:function(){var e=Chorus.Comments.settings.localClockOffset||0,t=(new Date).getTime()/1e3;return t=Math.round(t-e),t-this.get("created_on_timestamp")},isEditable:function(){return this.get("user_id")===Chorus.Comments.context.user_id&&this.secondsSinceCreate()<Chorus.Comments.settings.editTimeWindow},isPreview:function(){return!this.id},toJSON:function(){var e,t=_.clone(this.attributes);return t.is_flagged=this.isFlagged(),t.is_recommended=this.isRecommended(),t.is_editable=this.isEditable(),t.is_preview=this.isPreview(),t.permalink=this.getAbsoluteURL("permalink"),Chorus.Environment.currentBreakpoint().index<2?t.created_on=this.get("created_on_short"):t.created_on=this.get("created_on_long"),e=this.user(),e&&(t.user=e.toJSON(!0)),t},getAbsoluteURL:function(e){return window.location.origin+this.get(e)},preview:function(){return this.ajax("preview",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0])}})},post:function(){var e=this.get("body");return e&&this.set("rawBody",e),this.ajax("post",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0]),e.collection.add(e)}})},edit:function(e){return e.body&&this.set("rawBody",e.body),this.ajax("edit",{data:{entry_id:this.collection.entryId,comment:e},success:function(e,t){e.set(t.comments[0])}})},hide:function(){var e={},t=this.descendants();return _.each(t,function(t){e[t.id]=t.get("hidden"),t.set("hidden",!0)}),this.set("hidden",!0),this.ajax("hide",{error:function(n){n.set("hidden",!1),_.each(t,function(t){t.set("hidden",e[t.id])})}})},unhide:function(){return this.set("hidden",!1),this.ajax("hide",{error:function(e){e.set("hidden",!0)}})},flag:function(e){var t=this.createFlagging("inappropriate");return this.set({is_flagged_by_user:!0,bad_flags_count:this.get("bad_flags_count")+1}),this.ajax("flag",{data:e,error:function(e){e.set({is_flagged_by_user:!1,bad_flags_count:e.get("bad_flags_count")-1}),e.collection.flaggings.remove(t)}})},unflag:function(){var e=this.flaggingsLoaded,t=this.flaggings();return this.flaggingsLoaded=!1,this.collection.flaggings.remove(t),this.set({is_flagged_by_user:!1,bad_flags_count:this.get("bad_flags_count")-1}),this.ajax("unflag",{error:function(n){n.set({is_flagged_by_user:!0,bad_flags_count:n.get("bad_flags_count")+1}),n.collection.flaggings.add(t),n.flaggingsLoaded=e}})},recommend:function(){var e=this.createFlagging("recommended");return this.set({is_recommended_by_user:!0,recommended_flags_count:(this.get("recommended_flags_count")||0)+1}),this.ajax("recommend",{error:function(t){t.set({is_recommended_by_user:!1,recommended_flags_count:t.get("recommended_flags_count")-1}),t.collection.flaggings.remove(e)}})},unrecommend:function(){var e=this.flaggings();return this.collection.flaggings.remove(e),this.set({is_recommended_by_user:!1,recommended_flags_count:this.get("recommended_flags_count")-1}),this.ajax("unflag",{error:function(t){t.set({is_recommended_by_user:!0,recommended_flags_count:t.get("recommended_flags_count")+1}),t.collection.flaggings.add(e)}})},destroy:function(){var e=this.collection,t=this.descendants();return e.remove(t),e.remove(this),this.ajax("destroy",{error:function(n){e.add(n),e.add(t)}})},loadFlaggings:function(){return this.ajax("loadFlaggings",{type:"GET",success:function(e,t){e.collection.users.add(t,{parse:!0,merge:!0}),e.collection.flaggings.add(t,{parse:!0,merge:!0}),e.flaggingsLoaded=!0}})},collapseDescendants:function(e,t){t?_.each(this.descendants(),function(e){e.get("collapsedAncestorId")||e.set("collapsedAncestorId",this.id)},this):_.each(this.descendants(),function(e){e.get("collapsedAncestorId")===this.id&&e.set("collapsedAncestorId",null)},this)},blockUser:function(){var e=this.user(),t=this.collection,n=t.where({user_id:this.get("user_id")});return t.remove(n),t.users.remove(e),this.ajax("blockUser",{error:function(){t.users.add(e),t.add(n)}})}})),Chorus.Comments.Models.Flagging=Backbone.Model.extend({initialize:function(){this.set("created_on_timestamp",Math.round(new Date(this.get("created_on")).getTime()/1e3))},user:function(){return this.collection.users.get(this.get("user_id"))},flaggable:function(){return this.collection.comments.get(this.get("flaggable_id"))},toJSON:function(){var e=_.clone(this.attributes),t=this.user(),n=new Date(this.get("created_on")).toLocaleString();return e.created_on=n,t&&(e.user=t.toJSON()),e}}),Chorus.Comments.Models.User=Backbone.Model.extend({initialize:function(){var e=this.get("author_profile"),t=this.get("network_membership"),n=this.get("membership");e?this.set({profile_image:this.get("author_profile").image_url,profile_url:this.get("author_profile").url}):t&&this.set({profile_image:t.image_url,profile_url:t.url}),n&&this.set({inspect_user_url:n.inspect_user_url})},isAuthor:function(){return Chorus.Comments.context.author_id===this.id},isContributor:function(){return _.indexOf(Chorus.Comments.context.contributor_ids,this.id)>-1},toJSON:function(){var e=_.clone(this.attributes);return e.is_author=this.isAuthor(),e.is_contributor=this.isContributor(),e}}),Chorus.Comments.Collections.Comments=Backbone.Collection.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{model:Chorus.Comments.Models.Comment,urls:{load:"/comments/load_comments/:entryId",update:"/comments/ajax_comments_update/:entryId"},loaded:!1,lastRequestId:0,emptyUpdateCount:0,initialize:function(e,t){return this.entryId=t.entryId,this.users=new Chorus.Comments.Collections.Users,this.flaggings=new Chorus.Comments.Collections.Flaggings([],{users:this.users,comments:this}),this.listenTo(this,"add",this.findCollapsedAncestor),this},comparator:function(e,t){switch(Chorus.Comments.settings.sortMethod){case"ancestry":var n=e.get("ancestry"),i=t.get("ancestry");return n<i?-1:n>i?1:0;case"forward-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?e.get("id")-t.get("id"):e.get("created_on_timestamp")-t.get("created_on_timestamp");case"reverse-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?t.get("id")-e.get("id"):t.get("created_on_timestamp")-e.get("created_on_timestamp")}},parse:function(e){return e.comments||[]},load:function(){return this.ajax("load",{timeout:null,data:_.extend({t:(new Date).getTime()},Chorus.Comments.settings.ajaxParams),success:function(e,t){Chorus.Comments.initContext(t.context),e.loaded=!0,e.lastId=t.last_id,e.lastVersion=t.last_version,e.users.reset(t,{parse:!0}),e.flaggings.reset(t,{parse:!0}),e.reset(t,{parse:!0})}})},update:function(){return this.lastRequestId+=1,this.ajax("update",{data:_.extend({request_id:this.lastRequestId,last_id:this.lastId,last_version:this.lastVersion},Chorus.Comments.settings.ajaxParams),success:function(e,t){return e.lastRequestId!==t.last_request_id?void console.warn("Failed to update comments: updates arrived out of order"):(e.lastId=t.last_id,e.lastVersion=t.last_version,t.comments.length?e.emptyUpdateCount=0:e.emptyUpdateCount++,_.each(t.deleted_comment_ids,function(t){var n=e.get(t);n&&(e.remove(n.descendants()),e.remove(n))}),e.users.add(t,{parse:!0}),e.add(t,{parse:!0}),void e.flaggings.add(t,{parse:!0}))},error:function(e){e.emptyUpdateCount++}})},findCollapsedAncestor:function(e){var t=_.find(e.ancestors().reverse(),function(e){return e.get("collapsed")});t&&(e.set("collapsedAncestorId",t.id),t.trigger("change"))}})),Chorus.Comments.Collections.Flaggings=Backbone.Collection.extend({model:Chorus.Comments.Models.Flagging,initialize:function(e,t){this.users=t.users,this.comments=t.comments},parse:function(e){return e.flaggings||[]}}),Chorus.Comments.Collections.Users=Backbone.Collection.extend({model:Chorus.Comments.Models.User,parse:function(e){return e.users||[]},current:function(){return this.get(Chorus.Comments.context.user_id)}}),Chorus.Comments.Views.AccountActions=Backbone.View.extend({id:"",className:"",templateId:"comment-account-actions-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.AutoUpdateAlert=Backbone.View.extend({id:"autoupdate_info",templateId:"comment-auto-update-alert-template",events:{"click .close":"hide","click .go_to_comment":"goToComment"},initialize:function(){this.listenTo(this.collection,"updateSuccess",this.show)},render:function(){return this.$el.hide(),this.trigger("render",this),this},show:function(e,t){if(Chorus.Comments.settings.showAutoUpdateAlert!==!1){var n=[];if(_.each(t.comments,function(t){if(t.user_id!==Chorus.Comments.context.user_id){var i=e.get(t.id),o=i.toJSON(),a=i.parent();a&&(o.parent=a.toJSON()),n.push(o)}}),0!==n.length){var i=this.template({comments:n,settings:Chorus.Comments.settings});this.$el.html(i).fadeIn(1e3),setTimeout(_.bind(this.hide,this),Chorus.Comments.settings.autoUpdateAlertTimeShown)}}},hide:function(){return this.$el.fadeOut(500),!1},goToComment:function(e){var t=e.currentTarget.getAttribute("data-comment-id");return Chorus.Comments.trigger("activateComment",t),!1}}),Chorus.Comments.Views.BaseForm=Backbone.View.extend({events:{"submit form":"submit","click .post_comment_button":"post","click .preview_comment_button":"preview","click .cancel_comment_button":"cancel","focusin textarea":"hideTouchTools","focusout textarea":"showTouchTools"},renderPreview:function(e){return this.previewView?this.previewView.model=e:this.previewView=new Chorus.Comments.Views.Comment({model:e}),this.previewView.render().$el.prependTo(this.el),this.$(".preview-controls").show(),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){return this.previewView?this.post():this.preview(),!1},post:function(){var e=this.$(".post_comment_button");e.prop("disabled",!0).val(this.submitText+"ing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("postSuccess",function(){this.cancel()},this),t.once("postError",function(){e.prop("disabled",!1).val(this.submitText)},this),t.post(),!1},preview:function(){var e=this.$(".preview_comment_button");e.prop("disabled",!0).val("Previewing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("previewSuccess",this.renderPreview,this),t.once("previewError",function(){e.prop("disabled",!1).val("Preview")},this),t.preview(),!1},remove:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),Backbone.View.prototype.remove.call(this)},hideTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.hide()},showTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.show()}}),Chorus.Comments.Views.Comment=Backbone.View.extend({templateId:"comment-template",events:{"click .reply_link":"reply","click .edit_link":"edit","click .flag_link":"toggleFlagged","click .rec_link":"toggleRecommended","click .delete_link":"destroy","click .hide_link":"toggleHidden","click .up_link":"activateParent","click .actions_toggle":"toggleActions","click .inspect_flags_link":"inspectFlags","click .inspect_user_link":"inspectUser","click .block_user_link":"blockUser","click .collapse_toggle":"toggleCollapsed","click .image_toggle .message":"toggleImage"},renderTriggers:["id","parent_id","title","body","user_id","signature","hidden","created_on_long","created_on_short","created_on_timestamp","recommended_flags_count","is_recommended_by_user","troll_flags_count","spam_flags_count","inappropriate_flags_count","bad_flags_count","is_flagged_by_user"],initialize:function(){return this.listenTo(this.model,"change:"+this.renderTriggers.join(" change:"),this.render),this.listenTo(this.model,"change",this.regenerateWrapperClass),this.listenTo(this.model,"markRead",this.markCollapsedDescendantsRead),this.listenTo(this.model,"remove",this.remove),this},className:function(){var e=this.model.toJSON(),t=Chorus.Comments.context,n=[],i=function(e,t){t?n.push(e):n=_.without(n,e)};return this.el&&this.el.className&&(n=n.concat(this.el.className.split(" "))),i("citem",!0),i("cdepth-"+e.depth,!0),i("recommended",e.is_recommended),i("flagged",t.able_to_moderate&&e.is_flagged),i("new",e.is_new),i("hidden",e.hidden),i("obscured",e.obscured),i("collapsed",e.collapsed),i("collapsed-child",e.collapsedAncestorId),i("moderator",e.is_posted_by_moderator),i("preview",e.is_preview),_.uniq(n).join(" ")},attributes:function(){return{id:this.model.id}},delegateEvents:function(){},hasProfilePicture:function(){return this.model.user().get("profile_image")&&Chorus.Environment.currentBreakpoint().index>=Chorus.Comments.settings.avatarBreakpointIndex&&Chorus.Comments.settings.showAvatars},render:function(){var e=this.model.toJSON();return this.$el.html(this.template({view:this,context:Chorus.Comments.context,settings:Chorus.Comments.settings,comment:e})),this.model.isEditable()&&this.updateEditCountdown(),Chorus.Comments.settings.removeImages?this.removeImages():this.makeImagesHideable(),Chorus.Comments.settings.removeEmoji&&this.$(".cbody img.emoji").each(function(){jQuery(this).replaceWith(this.getAttribute("alt"))}),this.replyForm&&(this.$el.append(this.replyForm.el),this.replyForm.delegateEvents()),this.trigger("render",this),this},makeImagesHideable:function(){var e=this.$(".cbody img:not(.emoji)");e.wrap('<span href="#" class="image_toggle"></span>').parent().toggleClass("hidden",!Chorus.Comments.settings.showImages).append('<span class="message"></span>'),Chorus.Modernizr.localstorage&&e.each(function(){var e=jQuery(this);localStorage.getItem(e.attr("src"))&&e.parent().addClass("hidden")})},removeImages:function(){this.$(".cbody img:not(.emoji)").remove()},toggleImage:function(e){if(jQuery(e.currentTarget).parent().toggleClass("hidden"),Chorus.Modernizr.localstorage){var t=jQuery(e.currentTarget).parent(),n=t.find("img").attr("src");t.hasClass("hidden")?localStorage.setItem(n,"hidden"):localStorage.removeItem(n)}return!1},renderReplyCounts:function(){var e=this.model.descendants(),t=e.length;if(t>0){var n=_.filter(e,function(e){return e.get("is_new")}).length,i=1===t?"1 reply":t+" replies";n>0&&(i+=", "+n+" new"),this.$(".reply_count").text(i)}},regenerateWrapperClass:function(){this.$el.attr("class",this.className())},updateEditCountdown:function(){var e=Chorus.Comments.settings.editTimeWindow-this.model.secondsSinceCreate();e>0?(this.$(".countdown_timer").text(Math.round(e)),this.$(".countdown_timer_bar").width(100*(e/Chorus.Comments.settings.editTimeWindow)+"%"),setTimeout(_.bind(this.updateEditCountdown,this),1e3)):(this.$(".edit_link").remove(),this.$(".countdown_timer").text(""),this.$(".countdown_timer_bar").remove())},reply:function(){if(Chorus.Comments.context.user_id)if(Chorus.Comments.context.able_to_comment)this.replyForm||(this.replyForm=new Chorus.Comments.Views.ReplyForm({model:this.model,collection:this.model.collection}),this.replyForm.renderTo(this.el),this.listenTo(this.replyForm,"cancel",function(){this.replyForm=null}));else{var e=jQuery("#comment_tease, #comments .m-user-msg__account-action, #comments .m-user-msg__membership_required").offset();e&&jQuery("html, body").animate({scrollTop:e.top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})}else Chorus.Auth.modal.open("login");return!1},edit:function(){this.$el.addClass("ui-state-editing");var e=new Chorus.Comments.Views.EditForm({model:this.model});return e.render().$el.prependTo(this.el),e.once("cancel",function(){this.$el.removeClass("ui-state-editing")},this),!1},toggleHidden:function(){var e=this.model.get("hidden"),t=_.any(this.model.ancestors(),function(e){return e.get("hidden")});return t?alert("You can't "+(e?"unhide":"hide")+" this comment, because its parents are already hidden."):e?this.model.unhide():this.model.hide(),!1},destroy:function(){var e=confirm("You're about to delete this comment and all its replies. Are you sure?");return e===!0&&this.model.destroy(),!1},blockUser:function(){var e=["Spam ban is to be used exclusively for obvious spam, and not for normal moderation of community members.","","This action will ban the user from all Chorus communities (not just this one) and delete their comments. It is not reversible."].join("\n");return confirm(e)&&("BAN"==prompt("Enter the word 'BAN' (all caps) to confirm.")?this.model.blockUser():alert("Confirmation did not match.")),!1},toggleActions:function(){return this.$el.toggleClass("ui-state-tools-active"),!1},toggleRecommended:function(){return this.model.get("is_recommended_by_user")?this.model.unrecommend():this.model.recommend(),!1},toggleFlagged:function(){return this.model.get("is_flagged_by_user")?this.model.unflag():new Chorus.Comments.Views.FlagDialog({model:this.model}).render(),!1},inspectFlags:function(){return new Chorus.Comments.Views.InspectFlagsDialog({model:this.model}).render(),!1},inspectUser:function(){var e=this.model.user();return window.open(e.get("inspect_user_url")),!1},toggleCollapsed:function(){return this.model.get("collapsed")?this.uncollapse():(this.collapse(),this.renderReplyCounts()),!1},collapse:function(){this.model.set("collapsed",!0)},uncollapse:function(){this.model.set("collapsed",!1)},activate:function(){this.$el.addClass("active"),jQuery("html, body").stop(!0).animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})},activateParent:function(){var e=this.model.parent();return e&&Chorus.Comments.trigger("activateComment",e.id),!1},deactivate:function(){this.$el.removeClass("active")},markCollapsedDescendantsRead:function(){this.model.get("collapsed")&&(_.each(this.model.descendants(),function(e){e.set("is_new",!1)}),this.renderReplyCounts())}}),Chorus.Comments.Views.CommentList=Backbone.View.extend({id:"comments_list",className:"comment_master_list",childSelector:".citem",childView:Chorus.Comments.Views.Comment,shortcuts:{"Shift+a":"markAllRead","Shift+c":"activatePrev",c:"activateNext",j:"activateNext",k:"activatePrev",x:"markRead",z:"markReadAndActivateNext",r:"replyToCurrent"},initialize:function(){this.childViews={},this.listenTo(this.collection,"loadSuccess",this.renderAll),this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"loadSuccess add",this.renderEmbeds),this.listenTo(Chorus.Comments,"activateComment",this.activateId),this.listenTo(this,"renderAll",this.activateHash),_.each(this.shortcuts,function(e,t){shortcut.add(t,_.bind(this[e],this),{disable_in_input:!0,type:"keypress"})},this)},render:function(){return this},delegateEvents:function(){return _.each(this.childView.prototype.events,function(e,t){var n=t.match(/^(\S+)\s+(.+)$/),i=n[1],o=n[2],a=this.childViews,r=this.childSelector;this.$el.on(i+".delegateEvents",r+" "+o,function(t){var n=jQuery(this).closest(r),i=a[n.attr("id")];if(i)return i[e].call(i,t)})},this),Backbone.View.prototype.delegateEvents.call(this)},removeAll:function(){return this.$el.empty(),this.trigger("removeAll",this),this.childViews={},this},removeOne:function(e){var t=this.childViews[e.id];return t&&t.remove(),delete this.childViews[e.id],this.trigger("removeOne",this,t,e),this},renderAll:function(){var e=Chorus.Comments.settings;return this.renderPage(0,e.renderChunkLength)},renderPage:function(e,t){var n=(Chorus.Comments.settings,_.map(this.collection.slice(e,t),function(e){return this.renderOne(e,!1).el},this));if(this.$el.append(n),this.trigger("renderPage",this,e,t),
t<this.collection.length){e=t,t=Math.min(this.collection.length,e+Chorus.Comments.settings.renderChunkLength);var i=function(){this.renderPage(e,t)};setTimeout(_.bind(i,this),0)}else this.trigger("renderAll",this);return this},renderOne:function(e,t){var n=this.childViews[e.id]||new this.childView({model:e});if(this.childViews[e.id]=n.render(),t){for(var i,o=this.collection.length,a=this.collection.indexOf(e)+1;!i&&a<o;)i=this.collection.at(a++),i=i&&this.childViews[i.id];i?i.$el.before(n.el):this.$el.append(n.el),this.trigger("renderOne",this,n,e)}return n},renderEmbeds:function(){window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load()},activeModel:function(){return this.activeId?this.collection.get(this.activeId):null},activeView:function(){return this.activeId?this.childViews[this.activeId]:null},activateId:function(e){var t=this.activeView(),n=this.childViews[e];return t&&t.deactivate(),n&&(n.$el.hasClass("collapsed-child")?this.activateId(n.model.get("parent_id")):(n.activate(),this.activeId=e)),this},activateHash:function(){var e=window.location.hash.match(/^#(\d+)$/);e&&setTimeout(_.bind(this.activateId,this,e[1]),1e3)},activateNeighbor:function(e){var t,n=this.activeModel();if(n)t=n[e]({is_new:!0},!0);else for(t="next"===e?this.collection.first():this.collection.last();t&&!t.get("is_new");)t=t[e]();if(t)return this.activateId(t.id)},activatePrev:function(){this.collection.loaded?this.activateNeighbor("prev"):this.loadThenRun("activatePrev")},activateNext:function(){this.collection.loaded?this.activateNeighbor("next"):this.loadThenRun("activateNext")},markRead:function(){var e=this.activeModel(),t=this.activeView();e&&(e.set("is_new",!1),e.trigger("markRead")),t&&t.deactivate()},markAllRead:function(){_.each(this.collection.where({is_new:!0}),function(e){e.set("is_new",!1)})},markAllUnread:function(){this.collection.each(function(e){e.set("is_new",!0)}),this.activeId||(this.activeId=this.collection.first().id)},markReadAndActivateNext:function(){this.collection.loaded?(this.markRead(),this.activateNext()):this.loadThenRun("markReadAndActivateNext")},replyToCurrent:function(){var e=this.activeView();e&&e.reply()},loadThenRun:function(e){jQuery("html, body").animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.animationDuration}),Chorus.Comments.settings.startOnScroll||Chorus.Comments.start(),this.listenToOnce(this.collection,"loadSuccess",this[e])}}),Chorus.Comments.Views.CommentsClosedNotice=Backbone.View.extend({templateId:"comments-closed-notice-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.EditForm=Backbone.View.extend({className:"cedit cform",templateId:"comment-edit-form-template",events:{"submit form":"submit","click .post_edit_button":"submit","click .cancel_edit_button":"cancel"},render:function(){return this.$el.html(this.template({comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.trigger("render",this),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){var e=this.$(".post_edit_button");return e.prop("disabled",!0).val("Saving..."),this.model.once("editSuccess",function(){this.cancel()},this),this.model.once("editError",function(){e.prop("disabled",!1).val("Save")},this),this.model.edit(this.formData()),!1},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.FlagDialog=Backbone.View.extend({templateId:"comment-flag-dialog-template",events:{"submit form":"submit"},render:function(){var e=this.template({comment:this.model.toJSON()});return Chorus.Comments.openModal(e),this.setElement("#comment_flag_modal"),this.trigger("render",this),this},submit:function(){return this.model.flag(this.$("form").serialize()),Chorus.Comments.closeModal(),!1}}),Chorus.Comments.Views.Footer=Backbone.View.extend({templateId:"comments-footer-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.FormattingGuide=Backbone.View.extend({id:"comment_formatting_guide",templateId:"comment-formatting-guide-template",render:function(){return this.$el.html(this.template()).hide(),this.trigger("render",this),this}}),Chorus.Comments.Views.Header=Backbone.View.extend({className:"comments-header ui-state-unloaded",templateId:"comments-header-template",events:{"click .show_comments_link":"loadComments","click .tips_link":"toggleTips","click .auto_update_alert_toggle":"toggleAutoUpdateAlert","click .touch_tools_toggle":"toggleTouchTools"},initialize:function(){this.listenTo(Chorus.Comments,"start",this.showLoadingIndicator),this.listenTo(this.collection,"loadSuccess",this.hideLoadingIndicator),this.listenTo(this.collection,"loadError",this.showLoadError),this.listenTo(this.collection,"loadSuccess",this.render),this.listenTo(this.collection,"updateSuccess",this.updateCount)},render:function(){return this.$el.html(this.template({context:Chorus.Comments.context,settings:Chorus.Comments.settings})),this.trigger("render",this),this},loadComments:function(){return Chorus.Comments.start(),!1},toggleTips:function(){return this.$el.toggleClass("ui-state-tips-active"),!1},showLoadError:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-loading").addClass("ui-state-load-error")},showLoadingIndicator:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-load-error").addClass("ui-state-loading")},hideLoadingIndicator:function(){this.$el.removeClass("ui-state-unloaded").removeClass("ui-state-loading").removeClass("ui-state-load-error").addClass("ui-state-loaded")},updateCount:function(){this.$(".count").text(this.collection.length)},toggleAutoUpdateAlert:function(){var e=!Chorus.Comments.settings.showAutoUpdateAlert;return Chorus.Comments.settings.showAutoUpdateAlert=e,this.$(".auto_update_alert_toggle").text(e?"Hide it!":"Show it!"),!1},toggleTouchTools:function(){return Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.toggle(),!1}}),Chorus.Comments.Views.InspectFlagsDialog=Backbone.View.extend({templateId:"comment-inspect-flags-dialog-template",render:function(){if(!this.model.flaggingsLoaded)return this.model.once("loadFlaggingsSuccess",this.render,this),this.model.loadFlaggings(),this;var e=this.template({comment:this.model.toJSON(),flaggings:_.invoke(this.model.flaggings(),"toJSON")});return Chorus.Comments.openModal(e),this.setElement("#inspect_flags_modal"),this.trigger("render",this),this}}),Chorus.Comments.Views.MainForm=Chorus.Comments.Views.BaseForm.extend({id:"main_comment_form",className:"cform cform-main",templateId:"comment-main-form-template",submitText:"Post",events:function(){var e=_.clone(Chorus.Comments.Views.BaseForm.prototype.events);return e["click #formatting_guide_links a"]="toggleFormattingGuide",e},render:function(){this.$el.html(this.template({context:Chorus.Comments.context})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);var e=new Chorus.Comments.Views.FormattingGuide;return e.render().$el.appendTo(this.el),this.trigger("render",this),this},cancel:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),this.$(".preview-controls").hide(),this.$(".post_comment_button").prop("disabled",!1).val("Post"),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this.$("form").get(0).reset(),this.trigger("cancel"),!1},toggleFormattingGuide:function(e){return jQuery(e.target).hide().siblings().show(),jQuery("#comment_formatting_guide").slideToggle(),!1}}),Chorus.Comments.Views.Main=Backbone.View.extend({events:{"click .spoiler":"toggleSpoiler"},initialize:function(){var e=Chorus.Comments.Views;this.header=new e.Header({collection:this.collection}),this.commentList=new e.CommentList({collection:this.collection}),this.footer=new e.Footer,Chorus.Comments.settings.startOnScroll&&this.pollScrollPosition(),this.listenTo(this.collection,"loadSuccess",this.renderWithContext),this.listenTo(this.collection,"loadError",this.renderError)},render:function(){return this.$el.append(this.header.render().el,this.commentList.render().el),this.trigger("render",this),this},remove:function(){return this.header.remove(),this.commentList.remove(),this.footer.remove(),this.mainForm&&this.mainForm.remove(),this.touchTools&&this.touchTools.remove(),this.autoUpdateAlert&&this.autoUpdateAlert.remove(),this.$el.remove(),this},renderWithContext:function(){var e=Chorus.Comments.Views,t=Chorus.Comments.context,n=Chorus.Comments.settings,i=!1;t.comments_closed?(this.mainForm=new e.CommentsClosedNotice,i=!0):t.able_to_comment?this.mainForm=new e.MainForm({collection:this.collection}):(this.mainForm=new Backbone.View,i=!0);var o=new e.AccountActions;return this.$el.append(o.render().el,this.mainForm.render().el,this.footer.render().el),i&&!_.isUndefined(Chorus.Auth)&&Chorus.Auth.init(),t.able_to_comment&&Chorus.Environment.touch()&&(this.touchTools=new e.TouchTools({collection:this.collection}),this.touchTools.render().$el.appendTo(this.el)),n.autoUpdateEnabled&&n.showAutoUpdateAlert&&(this.autoUpdateAlert=new e.AutoUpdateAlert({collection:this.collection}),this.autoUpdateAlert.render().$el.appendTo(this.el)),this.trigger("render",this),this},renderError:function(){this.$el.append('<h2 class="comments-load-error-msg">There was an error loading the comments. Please try again later</h2>')},pollScrollPosition:function(){var e=this.$el,t=jQuery(window),n=Chorus.Comments.settings.scrollBuffer,i=function(){e.offset().top-t.scrollTop()-t.height()-n<0&&Chorus.Comments.start()};i=_.throttle(i,200),i(),t.on("scroll",i),Chorus.Comments.once("start",function(){t.off("scroll",i)})},toggleSpoiler:function(e){return jQuery(e.target).toggleClass("reveal_spoiler"),!1}}),Chorus.Comments.Views.ReplyForm=Chorus.Comments.Views.BaseForm.extend({className:"cform",templateId:"comment-reply-form-template",submitText:"Reply",renderTo:function(e){return this.$el.html(this.template({context:Chorus.Comments.context,comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.$el.appendTo(e),this.$("[autofocus]:first").focus(),this.trigger("render",this),this},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.TouchTools=Backbone.View.extend({id:"comment_touch_tools",templateId:"comment-touch-tools-template",events:{"click .close":"toggle","click .refresh":"refresh","click .next":"activateNext","click .mark":"markAllRead"},initialize:function(){this.listenTo(this.collection,"updateSuccess updateError",this.stopLoading)},render:function(){return this.$el.html(this.template()),this.trigger("render",this),this},toggle:function(){return this.$el.toggle(),!1},refresh:function(){return this.$el.addClass("loading"),this.collection.update(),!1},stopLoading:function(){this.$el.removeClass("loading")},activateNext:function(){return Chorus.Comments.view.commentList.markReadAndActivateNext(),!1},markAllRead:function(){return Chorus.Comments.view.commentList.markAllRead(),!1},show:function(){return this.$el.show(),!1},hide:function(){return this.$el.hide(),!1}});var Chorus=Chorus||{};Chorus.RemoteEntryAdminPermissions=function(e){"use strict";function t(){var t=e(s).map(function(t,n){return e(n).data(a)});t=_.uniq(_.compact(t)).sort(),t.length&&e.ajax({method:"GET",url:r,dataType:"json",data:{entry_ids:t.join(":")},success:n,error:i})}function n(e){o=_.extend(o,{loaded:!0},e),Chorus.EventDispatcher.publish("permissionsLoaded",_.clone(o),!0)}function i(){console&&console.error("there was an error loading the permissions object from the client controls")}var o={loaded:!1},a="remote-admin-entry-id",r="/remote_entry_admin/check_permissions",s="*[data-"+a+"]";return{init:function(){Chorus.Context.logged_in!==!1&&t()},getPermissions:function(){return o}}}(jQuery),jQuery(Chorus.RemoteEntryAdminPermissions.init);var Chorus=Chorus||{};Chorus.EntryAdminControls=function(e){"use strict";function t(t){e(p).each(function(n,i){var o=e(i),a=o.data(m),r=t[a];if(r&&r.permitted===!0){var s=o.data(f);"button"===s&&(o.append(y(r)),o.on("click",l)),"pane"===s&&o.load(g,{entry_id:a},function(){o.on("mouseenter",c),o.on("mouseleave",d)})}}),e("body").on("click","#inspect-images-link",u),e("body").on("click","#hide-entry-link",h)}function n(e){Chorus.EventDispatcher.publish("modal_open",{url:v,data:{entry_id:e}})}function i(e){return"*[data-"+m+'="'+e+'"][data-'+f+'="pane"]'}function o(t){e(i(t)).addClass("is-active")}function a(t){e(i(t)).removeClass("is-active")}function r(t){var n="Hidden"===t.text();t.text(n?"Unhiding":"Hiding"),e.ajax({method:"POST",url:t.attr("href"),dataType:"text",complete:function(){location.reload(!0)}})}function s(e){t(e)}function l(t){if(Util.UserAgentProfiler.isMobile()===!1){var o=e(t.delegateTarget).data(m);e(i(o)).length<1&&(t.preventDefault(),n(o))}}function c(t){o(e(t.delegateTarget).data(m))}function d(t){a(e(t.delegateTarget).data(m))}function u(t){t.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:b+"/"+e(t.target).data(m)})}function h(t){var n=confirm("Are you sure?");return!!n&&(t.preventDefault(),void r(e(t.target)))}var m="remote-admin-entry-id",f="remote-admin-entry-type",p="*[data-"+f+"]",g="/remote_entry_admin/pane",v="/remote_entry_admin/actions_modal",b="/remote_entry_admin/image_sizes_modal",y=_.template('<a href="[%= data.edit_url%]">Edit Entry</a>');return{init:function(){Chorus.Context.logged_in!==!1&&Chorus.EventDispatcher.subscribe("permissionsLoaded",s)}}}(jQuery),jQuery(Chorus.EntryAdminControls.init);var Chorus=Chorus||{};Chorus.RemoteHeadlineEdit=function(e){"use strict";function t(t){var n=t.data("remote-headline-promo-headine"),i=e(y({current_headline:t.text().replace(/"/g,"&quot;"),headline_save_url:v,field:t.data(p),entry_id:t.data(f),include_buttons:!n}));if(t.after(i),t.addClass("is-editing"),i.on("change",'input[type="text"]',h),i.on("click",'input[type="submit"]',u),i.on("click",'input[value="cancel"]',d),i.on("submit",function(e){e.preventDefault()}),n){var o=e(y({current_headline:n.replace(/"/g,"&quot;"),headline_save_url:v,field:g,entry_id:t.data(f),include_buttons:!0}));i.after(o),o.on("change",'input[type="text"]',h),o.on("click",'input[type="submit"]',u),o.on("click",'input[value="cancel"]',d),o.on("submit",function(e){e.preventDefault()})}}function n(t,n){return n===g&&(n="title"),e("*[data-"+p+'="'+n+'"][data-'+f+'="'+t+'"]')}function i(e){n(e.data(f),e.data(p)).removeClass("is-editing"),e.siblings(".m-inline-headline-edit__form").remove(),e.remove()}function o(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!0)}function a(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!1)}function r(e){e.data("remote-headline-edit-submit",!0)}function s(t){t.add(t.siblings(".m-inline-headline-edit__form")).each(function(t,r){var s=e(r);if(s.data("remote-headline-edit-submit")===!0){var l=s.find('input[name="entry_id"]').val(),c=s.find('input[name="new_value"]').val(),d=s.find('input[name="field"]').val();o(s),e.ajax({method:"POST",url:v,dataType:"json",data:{entry_id:l,field:d,value:c},success:function(){d===g?n(l,"title").data("remote-headline-promo-headine",c):n(l,d).text(c),i(s),alert(Util.stringToTitleCase(d.replace(/_/g," "))+" saved!")},error:function(){a(s),alert("There was an error recieving data from the server.")}})}})}function l(t){e("*[data-"+p+"]").each(function(n,i){var o=e(i),a=t[o.data(f)];a&&a.permitted===!0&&(o.addClass("is-editable"),o.on("click",c))})}function c(n){n.preventDefault();var i=e(n.delegateTarget);i.hasClass("is-editing")===!1&&t(i)}function d(t){t.preventDefault(),i(e(t.delegateTarget))}function u(t){t.preventDefault(),s(e(t.delegateTarget))}function h(t){r(e(t.delegateTarget))}function m(e){e.is_headline_editor===!0&&l(e)}var f="remote-admin-entry-id",p="remote-headline-edit",g="promo_headline_field",v="/remote_entry_admin/update_title",b=['<form action="[%= data.headline_save_url %]" data-'+f+'="[%= data.entry_id %]" data-'+p+'= "[%= data.field %]" method="post" class="m-inline-headline-edit__form">','<label for="new_value">[%= data.field.replace(/_/g, " ")  %]</label>','<input type="text" name="new_value" value="[%= data.current_headline %]" />','<input type="hidden" name="entry_id" value="[%= data.entry_id %]" />','<input type="hidden" name="field" value="[%= data.field %]" />','[% if (data.include_buttons === true) { %]<input type="submit" value="Save" class="p-button"/>','<input type="button" value="cancel" class="p-button" /> [% } %]',"</form>"].join(""),y=_.template(b);return{init:function(){Chorus.Context.logged_in!==!1&&Util.UserAgentProfiler.isMobile()!==!0&&Chorus.EventDispatcher.subscribe("permissionsLoaded",m)}}}(jQuery),jQuery(Chorus.RemoteHeadlineEdit.init);var Chorus=Chorus||{};Chorus.HubAdminMenu=function(e){"use strict";function t(){n.on("click",function(){n.toggleClass("is-open")})}var n=e("#hub-admin-menu");return{init:function(){t()}}}(jQuery),jQuery(Chorus.HubAdminMenu.init);var Util=Util||{};Util.UserAgentProfiler=function(){var e="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||navigator.msMaxTouchPoints>0,t=window.innerWidth,n=window.navigator.userAgent,i=e&&t<728||window.location.href.indexOf("mobile=true")>0,o=e&&t>=728,a=!i&&!o,r=/(iPad|iPhone|iPod)/g.test(n),s=r&&/OS\s(7|6_1_4)/g.test(n),l=/Android/g.test(n),c=!1,d=i?"mobile":o?"tablet":"desktop";if(n.indexOf("Android")>0)for(var u=n.split(";"),h=0,m=u.length;h<m;h++)if(u[h].indexOf("Android")>0){var f=u[h].split(" ");if(parseInt(f[f.length-1].split(".")[0])<3){c=!0;break}}return{screenWidth:function(){return t},profile:function(){return d},isTablet:function(){return o},isMobile:function(){return i},isDesktop:function(){return a},isAndroid:function(){return l},isAndroidLt3:function(){return c},isIOS:function(){return r},isIOS7:function(){return s},deviceTypeForAds:function(){return this.profile()},browserWidthForAds:function(){return Chorus.Environment.currentBreakpoint().name},doNotTrack:function(){var e;if(void 0!==navigator.doNotTrack)e=navigator.doNotTrack;else if(void 0!==window.doNotTrack)e=window.doNotTrack;else{if(void 0===navigator.msDoNotTrack)return"unsupported";e=navigator.msDoNotTrack}return/1|yes|true/.test(e)?"1":"0"}}}();var Chorus=Chorus||{};Chorus.Auth=function(e){return{browser:function(){if(!this._browser){var e=navigator.userAgent.toLowerCase(),t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],n=t[1]||"",i=t[2]||"0",o=this._browser={};n&&(o[n]=!0,o.version=i),o.chrome?o.webkit=!0:o.webkit&&(o.safari=!0)}return this._browser},init:function(){var t=this.browser(),n="https:"==window.location.protocol;!t.safari&&n&&(e('*[data-chorus-auth="login"]').on("click",function(e){e.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:Chorus.Context.login_action,includeCloseButton:!0})}),e('*[data-chorus-auth="register"]').on("click",function(e){e.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:Chorus.Context.register_action,includeCloseButton:!0})}))}}}(jQuery),jQuery(function(){Chorus.Auth.init()}),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var n=e(t);e.fn.lazyload=function(i){function o(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function a(){var t=0;s.each(function(){var n=e(this);if(!l.skip_invisible||n.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else n.trigger("lazyload:appear")})}var r,s=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(i&&(void 0!==i.failurelimit&&(i.failure_limit=i.failurelimit,delete i.failurelimit),void 0!==i.effectspeed&&(i.effect_speed=i.effectspeed,delete i.effectspeed),e.extend(l,i)),r=void 0===l.container||l.container===t?n:e(l.container),0===l.event.indexOf("scroll")){var c=function(){return a()};r.bind(l.event,o(c,l.scrollInterval))}this.each(function(){var n=this,i=e(n);n.loaded=!1,n.error_event_set=!1;var a=4e3,r=4,c=0,d=function(){if(!this.loaded){if(l.appear){var o=s.length;l.appear.call(n,o,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){i.hide().attr("src",i.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),n.loaded=!0;var t=e.grep(s,function(e){return!e.loaded});if(s=e(t),l.load){var o=s.length;l.load.call(n,o,l)}}).bind("error",function(){n.error_event_set||t.setTimeout(e.proxy(u,this),a),n.error_event_set=!0}).attr("src",i.attr("data-"+l.data_attribute));else{i.css("background-image","url('"+i.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),n.loaded=!0;var r=e.grep(s,function(e){return!e.loaded});if(s=e(r),l.load){var o=s.length;l.load.call(n,o,l)}}}},u=function(){if(c+=1,c<=r){e(this).bind("error",function(){t.setTimeout(e.proxy(u,this),a)});var n=this.src.split("?")[0];this.src=n+"?"+(new Date).getTime()}};if(i.one("lazyload:appear",d),0!==l.event.indexOf("scroll")){var h=function(){n.loaded||i.trigger("lazyload:appear")};i.bind(l.event,o(h,l.scrollInterval))}});var d=function(){a()};return n.bind("resize",o(d,l.resizeInterval)),a(),this},e.belowthefold=function(i,o){var a;return a=void 0===o.container||o.container===t?n.height()+n.scrollTop():e(o.container).offset().top+e(o.container).height(),a<=e(i).offset().top-o.threshold},e.rightoffold=function(i,o){var a;return a=void 0===o.container||o.container===t?n.width()+n.scrollLeft():e(o.container).offset().left+e(o.container).width(),a<=e(i).offset().left-o.threshold},e.abovethetop=function(i,o){var a;return a=void 0===o.container||o.container===t?n.scrollTop():e(o.container).offset().top,a>=e(i).offset().top+o.threshold+e(i).height()},e.leftofbegin=function(i,o){var a;return a=void 0===o.container||o.container===t?n.scrollLeft():e(o.container).offset().left,a>=e(i).offset().left+o.threshold+e(i).width()},e.inviewport=function(t,n){return!(e.rightofscreen(t,n)||e.leftofscreen(t,n)||e.belowthefold(t,n)||e.abovethetop(t,n))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,n){var s={failure_limit:20,load:function(){var t=e(this),n=t.parent(".image-window");if(t.is("img")&&(n.length>0?(t.css({position:"absolute",top:Math.round((n.outerHeight()-t.outerHeight())/2),left:Math.round((n.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(a),t.removeClass(r),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var i=Chorus.Context.gif_opts||{};if(Chorus.Context&&Chorus.Context.main_link_color&&(i.circleBackgroundColor=Chorus.Context.main_link_color,i.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var o=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),s=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');o.length+s.length===1?PLAYGIF_DISABLE_FLAG=!0:o&&o.length>0&&(PLAYGIF_DISABLE_FLAG=!1,o.playGIF(i))}t.playGIF(i)}},threshold:800};n&&e.extend(s,n),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(o+":visible").not("."+r+", ."+a),c=[],d=[];l.each(function(){var t,n,o,a,l,u=e(this),h=u.attr("data-imgkey"),m=u.data("chorus-asset-id");if("undefined"!=typeof h){if(s.parentDimensionSlc){var f=u.closest(s.parentDimensionSlc);t=f.outerWidth(),n=f.outerHeight()}t||(t=u.outerWidth()),n||(n=u.outerHeight()),0==n&&(o=u.data("ratio"),n="undefined"!=typeof o&&o>0?Math.ceil(t/o):t),u.is("img")&&(o=u.data("ratio"),a=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(n=Math.ceil(t/o)),a.length>0&&(t=Math.ceil(a.outerWidth()),n=Math.ceil(a.outerHeight())),n>0&&u.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n)),/\.(png|jpg|jpeg)$/i.test(u.attr("data-original"))&&i.webp&&!Chorus.Modernizr.touch&&(l="webp");var p=h+":"+t+"x"+n+(l?":"+l:"");c.push(p),u.attr("data-dim",t+"x"+n),u.addClass(r)}else if("undefined"!=typeof m){t=u.outerWidth(),n=u.outerHeight(),u.is("img")&&(o=u.data("ratio"),a=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(n=Math.ceil(t/o)),a.length>0&&(t=Math.ceil(a.outerWidth()),n=Math.ceil(a.outerHeight())),n>0&&u.css("height",n)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),n=Math.ceil(n*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),n=Math.ceil(1.3*n));var g=m+":"+t+":"+n;d.push(g),u.data("asset-key",g),u.addClass(r)}else u.lazyload(s)}),0===c.length&&0===d.length||(e.each([d,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:d.join(",")},success:function(t){var n=t.urls,i={};_.forEach(n,function(e,t){var n=t.replace(/\:webp|\:jp2/,"");i[n]=e}),n=i,l.each(function(){var t,i=e(this);t=i.attr("data-imgkey")?i.attr("data-imgkey")+":"+i.attr("data-dim"):i.data("asset-key");var o=n[t];"undefined"!=typeof o&&(i.attr("data-original",o),i.lazyload(s))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var n={},i={webp:!1,jp2:!1},o=".vox-lazy-load",a="lazy-loaded",r="lazy-loading";return n.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))i.webp="true"===window.localStorage.getItem("supportsWebp"),o();else{var e=new Image;e.onload=function(){i.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",i.webp),o()},e.onerror=function(){i.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",i.webp),o()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function o(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:n.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},n.initUI=function(e,n){t(e,n)},n.applyTo=function(e,n){t(e,n)},n}(jQuery),function(){"use strict";/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */
function e(t,i){function o(e,t){return function(){return e.apply(t,arguments)}}var a;if(i=i||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=i.touchBoundary||10,this.layer=t,this.tapDelay=i.tapDelay||200,this.tapTimeout=i.tapTimeout||700,!e.notNeeded(t)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],s=this,l=0,c=r.length;l<c;l++)s[r[l]]=o(s[r[l]],s);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,i){var o=Node.prototype.removeEventListener;"click"===e?o.call(t,e,n.hijacked||n,i):o.call(t,e,n,i)},t.addEventListener=function(e,n,i){var o=Node.prototype.addEventListener;"click"===e?o.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),i):o.call(t,e,n,i)}),"function"==typeof t.onclick&&(a=t.onclick,t.addEventListener("click",function(e){a(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,o=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),a=i&&/OS [6-7]_\d/.test(navigator.userAgent),r=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(i&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,i;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),i=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;i&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;if(t=e.fastClickScrollParent,!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,a;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],i){if(a=window.getSelection(),a.rangeCount&&!a.isCollapsed)return!0;if(!o){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n},e.prototype.onTouchMove=function(e){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0)},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,r,s,l,c,d=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,r=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,a&&(c=e.changedTouches[0],d=document.elementFromPoint(c.pageX-window.pageXOffset,c.pageY-window.pageYOffset)||d,d.fastClickScrollParent=this.targetElement.fastClickScrollParent),s=d.tagName.toLowerCase(),"label"===s){if(t=this.findControl(d)){if(this.focus(d),n)return!1;d=t}}else if(this.needsFocus(d))return e.timeStamp-r>100||i&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(d),this.sendClick(d,e),i&&"select"===s||(this.targetElement=null,e.preventDefault()),!1);return!(!i||o||(l=d.fastClickScrollParent,!l||l.fastClickLastScrollTop===l.scrollTop))||(this.needsClick(d)||(e.preventDefault(),this.sendClick(d,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return!this.targetElement||(!!e.forwardedTouchEvent||(!e.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1))))},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail||(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,i,o,a;if("undefined"==typeof window.ontouchstart)return!0;if(i=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(t=document.querySelector("meta[name=viewport]")){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(i>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(r&&(o=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),o[1]>=10&&o[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction||(a=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],!!(a>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(t.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth)))||("none"===e.style.touchAction||"manipulation"===e.style.touchAction))},e.attach=function(t,n){return new e(t,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1);