$.extend({confirmIt:function(e){var f={domain:document.location.protocol+"//"+document.location.host,pathName:location.pathname.toLowerCase()},a=$.extend({},f,env.survey,e);return{isInSampling:function(){return Math.floor(100*Math.random())+1<=a.samplingPercentage?!0:!1},isNotExcluded:{fromPageViewCount:function(){var b,d=a.excludes,c;for(c in d)-1<a.pathName.indexOf(d[c])&&(b=!0);return b?!1:!0},fromDisplayingSurvey:function(){var b;if("/"===a.pathName||-1<a.pathName.indexOf("home.aspx"))b=!0;return b?
!1:!0}},pageVisits:{getTotal:function(){return $.cookie(a.cookies.pageVisits)},increment:function(){var b=$.cookie(a.cookies.pageVisits),b=b?(parseInt(b,10)+1).toString():"1";$.cookie(a.cookies.pageVisits,b,{path:"/",domain:env.cookieDomain});return this.getTotal()?!1:!0},destroy:function(){$.cookie(a.cookies.pageVisits,null,{path:"/",domain:env.cookieDomain});return this.getTotal()?!1:!0}},surveyTabs:{destroy:function(){$.cookie(a.cookies.tabs,null,{path:"/",domain:env.cookieDomain})}},surveyTracker:{exist:function(){return null==
$.cookie(a.cookies.tracker)?!1:!0},destroy:function(){$.cookie(a.cookies.tracker,null,{path:"/",domain:env.cookieDomain})}},optOut:{exist:function(){return null==$.cookie(a.cookies.optOut)?!1:!0},create:function(){$.cookie(a.cookies.optOut,"1",{expires:a.optOut,path:"/",domain:env.cookieDomain});return this.exist()}},referrer:function(){var a={domain:document.referrer.split("/")[2],url:document.referrer};return"www.bestbuy.ca"===a.domain?!1:a},userInfo:function(){var b={locale:env.lang,"exit-page":window.location.href,
"survey-time":(new Date).getTime(),"screen-width":window.outerWidth||$(window).outerWidth(),"screen-height":window.outerHeight||$(window).outerHeight(),"window-width":window.innerWidth||$(window).innerWidth(),"window-height":window.innerHeight||$(window).innerHeight()};$.cookie(a.cookies.tracker)&&(b["page-view"]="undefined"!==typeof $.cookie(a.cookies.tracker).pageView?$.cookie(a.cookies.tracker).pageView:"0",b.referrer=$.cookie(a.cookies.tracker).referrer?$.cookie(a.cookies.tracker).referrer:"");
var d=[],c;for(c in b)d.push(encodeURIComponent(c)+"="+encodeURIComponent(b[c]));return d.join("&")},inviteToSurvey:function(){var b=this;b.pageVisits.destroy();b.optOut.create();$(document).modal({show:".survey-invite."+env.lang},function(){$(document).on("click",".survey-yes",function(a){a.preventDefault();b.registerCurrentTab();b.displaySurveyPopup()});$(document).on("click",".survey-no",function(a){a.preventDefault();b.surveyTracker.destroy();b.surveyTabs.destroy()})});var d={htmlPath:a.domain+
a.pages.invite};$(document).trigger("showModal",d)},displaySurveyPopup:function(){var b=a.pages.width,d=a.pages.height;window.open(a.domain+a.pages.survey+"?cookie="+a.cookies.tracker+"&lang="+env.lang+"&w="+a.pages.confirmItWidth+"&h="+a.pages.confirmItHeight+"&ie="+env.isIE+"&tabCookie="+a.cookies.tabs+"&cookieDomain="+env.cookieDomain,"BestBuy","toolbar=no, location=no, directories=no, status=no, menubar=no,scrollbars=yes, resizable=yes, copyhistory=no,width="+b+", height="+d+", top="+(screen.height/
2-d/2)+", left="+(screen.width/2-b/2))},tracker:function(){var b=this;$(document).on("ready",function(){var c={},d=$.cookie(a.cookies.tracker);c.pageView=d?(parseInt(d.pageView,10)+1).toString():"1";b.referrer()&&(c.referrer=b.referrer().domain,c.referrerUrl=b.referrer().url);c.surveyPath=a.pages[env.lang]+"&"+b.userInfo();$.cookie(a.cookies.tracker,c,{path:"/",domain:env.cookieDomain})});var d=window.onpagehide||null===window.onpagehide?"pagehide":"unload";$(window).on(d,function(){var c;c=$.cookie(a.cookies.tracker);
c.surveyPath=a.pages[env.lang]+"&"+b.userInfo();$.cookie(a.cookies.tracker,c,{path:"/",domain:env.cookieDomain})})},isFirstVisit:function(){return this.pageVisits.getTotal()?!1:!0},isQualified:function(){return!0===a.enabled&&this.isNotExcluded.fromPageViewCount()&&!this.optOut.exist()&&this.isInSampling()},isReachedThreshold:function(){return this.pageVisits.getTotal()>=a.pageViewThreshhold},tabHeartbeat:function(){var b=JSON.parse($.cookie(a.cookies.tabs));-1===jQuery.inArray("1",b)&&(b||(b=[]),
b.push("1"),$.cookie(a.cookies.tabs,JSON.stringify(b),{path:"/",domain:env.cookieDomain}))},registerCurrentTab:function(){$.cookie(a.cookies.tabs)||$.cookie(a.cookies.tabs,JSON.stringify([]),{path:"/",domain:env.cookieDomain});var b=this;window.setInterval(function(){b.tabHeartbeat()},2E3)},init:function(){!1===a.enabled&&(this.surveyTracker.destroy(),this.surveyTabs.destroy(),this.pageVisits.destroy());this.optOut.exist()?this.surveyTracker.exist()&&(this.registerCurrentTab(),this.tracker()):(this.isFirstVisit()?
this.isQualified()&&this.pageVisits.increment():this.isNotExcluded.fromPageViewCount()&&(this.pageVisits.increment(),this.isReachedThreshold()&&this.isNotExcluded.fromDisplayingSurvey()&&this.inviteToSurvey()),this.tracker())}}}});