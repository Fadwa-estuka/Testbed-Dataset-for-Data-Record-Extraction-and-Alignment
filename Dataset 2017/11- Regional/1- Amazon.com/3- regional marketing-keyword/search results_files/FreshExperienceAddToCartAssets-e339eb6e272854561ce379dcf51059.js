(function(e){var f=window.AmazonUIPageJS||window.P,h=f._namespace||f.attributeErrors,c=h?h("FreshExperienceAddToCartAssets"):f;c.guardFatal?c.guardFatal(e)(c,window):c.execute(function(){e(c,window)})})(function(e,f,h){e.when("A","jQuery","a-button").register("fx-atfc-button-utils",function(c,b,a){var d=!1;return{hideButtonAndRenderSpinner:function(a){var c=a.$currentTarget.find(".a-button");c&&c.length&&(d=!0,a="atfc-spinner-"+a.data.asin,c.wrap('<div id="'+a+'" class="atfc-spinner"></div>'),b("#"+
a).css({width:c.outerWidth()+"px"}),b("#"+a).css({height:c.outerHeight()+"px"}),c.css("visibility","hidden"))},showButtonAndRemoveSpinner:function(a){var c=a.$currentTarget.find(".a-button");a=b("#atfc-spinner-"+a.data.asin);c&&c.length&&a&&a.length&&(d=!1,c.css("visibility","visible"),c.unwrap())},shouldDisableButtonClicks:function(){return d}}});e.when("fresh-shared-add-to-cart","ready").register("fresh-add-to-cart",function(c){return{addToFreshCart:function(b){c.addToFreshCart(b,"desktop")}}});
e.when("A").register("afx-uatc-proxy",function(c){return function(b){var a="/gp/add-to-cart/json";b.reftag!==h&&(a+="/ref="+b.reftag);c.post(a,{timeout:5E3,params:{"session-id":b.sessionID,clientName:"SharedFreshHandler",nextPage:"cartitems",ASIN:b.asin,offerListingID:b.offerListingID,useUber:"1",source:"Fresh",ruleSet:"FreshGet"},success:b.success,error:b.error})}});e.when("A").register("afx-get-cart-count",function(c){return function(b){c.post("/gp/api/cart/1.0/get-cart-count.json",
{timeout:5E3,params:{sessionID:b.sessionID,clientName:"SharedFreshHandler"},success:b.success,error:b.error})}});e.register("afx-csm-metrics-utils",function(){var c={},b=function(a,b){f.ue&&f.ue.count&&a&&b&&f.ue.count(a,b)};return{startWidgetTimer:function(a){c[a]=Date.now()},endWidgetTimer:function(a,d){var f=Date.now()-c[a];b(d,f)},setWidgetClickTimestamp:function(a){f.ue&&f.uet&&a&&f.uet("tc",a,{wb:1})},setWidgetTimestamp:function(a,b){f.ue&&f.uet&&a&&b&&f.uet(a,b,{wb:1})},increment:function(a){f.ue&&
f.ue.count&&a&&f.ue.count(a,(f.ue.count(a)||0)+1)},setCount:b,sendWidgetMetrics:function(a){f.ue&&f.uex&&a&&f.uex("ld",a,{wb:1})}}});e.register("afx-metrics-helper",function(){var c={ATFC_COUNT:"afxAddToFreshCartCount",ATFC_SUCCESSFUL_ADD_COUNT:"afxAddToFreshCartSuccessfulAddCount",ATFC_ERROR_MODAL_COUNT:"afxAddToFreshCartErrorModalCount",ATFC_UNEXPECTED_ERROR_COUNT:"afxAddToFreshCartUnexpectedErrorCount",ATFC_LATENCY_SCOPE:"afxAddToFreshCartLatencyScope",ATFC_ERROR_MODAL_LATENCY_SCOPE:"afxAddToFreshCartErrorModalLatencyScope",
ATFC_CTCF:"afxAddToFreshCartCTCF",CLEAR_SLOT_ATFC_CTCF:"afxClearSlotAndAddToFreshCartCTFC",CART_SERVICE_RESPONSE_FALSE:"afxCartServiceResponseIsNotOKErrorCount",ITEM_NOT_AVAILABLE:"afxItemNotAvailableErrorModalCount",ITEM_PARTIALLY_AVAILABLE:"afxItemPartiallyAvailableErrorModalCount",ITEM_PARTIALLY_AVAILABLE_FOR_RESERVATION:"afxItemPartiallyAvailableErrorModalCount",ADDRESS_NOT_SELECTED:"afxAddressNotSelectedErrorCount",INPUT_INVALID:"afxGeneralErrorModalCount",ITEM_NOT_AVAILABLE_FOR_RESERVATION:"afxItemNotAvailableForReservationErrorModalCount",
INTERNAL_SERVER_ERROR:"afxGeneralErrorModalCount",PRICE_UNAVAILABLE:"afxItemNotAvailableErrorModalCount",QUANTITY_OVERFLOW:"afxUniqueItemQuantityOverflowErrorModalCount"};return{getMetricsForDevice:function(b){var a={};Object.keys(c).forEach(function(d){a[d]=c[d]+":"+b});return a}}});e.when("A").register("afx-quantity-helper",function(c){var b={};return{updateQuantity:function(a,c){"undefined"!==typeof a&&null!==a&&!isNaN(c)&&0<c&&(b[a]=c||1)},getQuantity:function(a){a=a.closest(".a-button");
return 0<a.length?b[a.attr("id")]||1:1}}});e.when("A","jQuery","a-modal","afx-uatc-proxy","afx-get-cart-count","fx-atfc-button-utils","afx-csm-metrics-utils","afx-metrics-helper","ready").register("fresh-shared-add-to-cart",function(c,b,a,d,k,r,g,p){var l;e.when("EWC").execute("add-to-cart-refresh",function(a){l=a});e.when("nav.getFlyout").execute(function(a){a("ewc")});var w={"itemPrice:priceUnavailable:1":"PRICE_UNAVAILABLE","itemDeleted:itemCountOverflow:6":"QUANTITY_OVERFLOW"};return{addToFreshCart:function(q,
x){function m(d,f){var e=f||{},k=d.data.sessionID;e.title=d.data.title;e.asin=d.data.asin;e.offerListingID=d.data.offerListingID;e.sessionID=k;e=b.param(e);e=a.create(d.$currentTarget,{name:"fresh-add-to-cart-modal",url:"/afx/cart/reservation_conflict?"+e});e.show();b("#a-popover-lgtbox").css("position","fixed");e.$container.css("position","fixed");c.on("a:popover:afterHide:fresh-add-to-cart-modal",function(b){A(k);a.remove(b.popover)})}function y(a){return a.filter(function(a){return a.statusKey in
w})}function C(a,b,c){c+=" returned by UATC is not an array";e.log(c,"Error",b);m(a);q.error(a,"","",c)}function u(a,c,f,k){var l=a.data.asin,p=a.data.offerListingID,u=a.data.sessionID,A=a.data.reftag;b.each({title:a.data.title,asin:l,offerListingID:p,sessionID:u},function(b,c){c===h&&(e.log("fresh-add-to-cart required parameter is missing","Error",b),m(a),q.error(a,void 0,void 0,void 0))});d({asin:l,offerListingID:p,sessionID:u,reftag:A,success:function(d){var e;d&&d.isOK?(e=d.extraErrorInfos)&&
e.constructor===Array&&0<e.length?e=!0:(e=d.statusList,e=e&&e.constructor===Array&&0<e.length?(e=y(e))&&0<e.length:!1,e=e?!0:!1):(!d.isOK&&g.increment(n.CART_SERVICE_RESPONSE_FALSE),e=!0);e?(g.increment(n.ATFC_ERROR_MODAL_COUNT),d?d.isOK?(e=d.extraErrorInfos,d=d.statusList,e&&e.constructor!==Array?C(a,e,"extraErrorInfos"):0<e.length?!e||0>=e.length||(d=e[0],"ADDRESS_NOT_SELECTED"===d.statusCode?(g.increment(n.ADDRESS_NOT_SELECTED),d=b.param({asin:a.data.asin,offerListingID:a.data.offerListingID,quantity:1,
redirectURL:document.location.href,ref:"afx_atfc_noaddress"}),document.location.href="/afx/nc/chooseaddress?"+d):(d.itemStatusCode in n&&g.increment(n[d.itemStatusCode]),m(a,{reasonCode:d.itemStatusCode,quantityAdded:d.availableQuantity,quantityRequested:d.requestedQuantity}))):d&&d.constructor!==Array?C(a,d,"statusList"):0<d.length&&d&&!(0>=d.length)&&(d=y(d))&&0<d.length&&(d=w[d[0].statusKey],m(a,{reasonCode:d}),g.increment(n[d]))):(m(a),q.error(a,"","","isOK returned by UATC is false")):(m(a),
q.error(a,"","","No response from UATC")),c&&f&&g.endWidgetTimer(c,f)):(g.increment(n.ATFC_SUCCESSFUL_ADD_COUNT),k(d,u));r.showButtonAndRemoveSpinner(a)},error:function(b,d,e){g.increment(n.ATFC_UNEXPECTED_ERROR_COUNT);m(a);q.error(a,b,d,e);c&&f&&g.endWidgetTimer(c,f);r.showButtonAndRemoveSpinner(a)}})}function E(a,b){u(a,"","",b)}function v(a){var b=n.ATFC_LATENCY_SCOPE+Date.now();g.startWidgetTimer(b);var d={token:(c.state("baseWidgetState")||{}).csrfToken};c.post("/afx/slotselection/cancel",{timeout:5E3,
params:d,success:function(){E(a,function(a,c){var d=n.CLEAR_SLOT_ATFC_CTCF+":lineItemBucket:"+(a.items&&Math.ceil(a.items.length/5));g.endWidgetTimer(b,d);location.reload()})},error:function(){e.log("Failed to clear reservation")}})}function D(a){k({sessionID:a,success:function(a){a&&a.isOK&&a.total&&B(a.total.numActiveItem)},error:function(){e.log("Failed to get cart count","Error",a)}})}function B(a){e.when("nav.setCartCount").execute(function(b){b(a)});e.when("mash").execute(function(b){b.cart&&
"function"===typeof b.cart.didUpdate&&b.cart.didUpdate({newCartQuantity:a})})}function A(a){l!==h&&"function"===typeof l.refresh?l.refresh():D(a)}var n=p.getMetricsForDevice(x);c.declarative("fresh-clear-slot","click",function(a){v(a)});c.declarative("fresh-add-to-cart","click",function(a){var b=n.ATFC_LATENCY_SCOPE+Date.now(),c=n.ATFC_ERROR_MODAL_LATENCY_SCOPE+Date.now();g.startWidgetTimer(b);g.startWidgetTimer(c);r.shouldDisableButtonClicks()||a.$currentTarget.find("input").is(":disabled")||(r.hideButtonAndRenderSpinner(a),
f.amazon&&f.amazon.cordova&&f.amazon.cordova.notification&&f.amazon.cordova.notification.vibrate&&f.amazon.cordova.notification.vibrate(50),g.increment(n.ATFC_COUNT),u(a,c,n.ATFC_ERROR_MODAL_LATENCY_SCOPE,function(c,d){var e=n.ATFC_CTCF+":lineItemBucket:"+(c.items&&Math.ceil(c.items.length/5));g.endWidgetTimer(b,e);A(d);q.success(a,c)}))})}}})});