require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _prebidGlobal=__webpack_require__(1);var _utils=__webpack_require__(2);var _video=__webpack_require__(4);__webpack_require__(16);var _url=__webpack_require__(17);var _cpmBucketManager=__webpack_require__(12);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var pbjs=(0,_prebidGlobal.getGlobal)();var CONSTANTS=__webpack_require__(3);var utils=__webpack_require__(2);var bidmanager=__webpack_require__(11);var adaptermanager=__webpack_require__(5);var bidfactory=__webpack_require__(13);var adloader=__webpack_require__(10);var events=__webpack_require__(8);var adserver=__webpack_require__(18);var objectType_function="function";var objectType_undefined="undefined";var objectType_object="object";var BID_WON=CONSTANTS.EVENTS.BID_WON;var auctionRunning=false;var bidRequestQueue=[];var pbTargetingKeys=[];var eventValidators={bidWon:checkDefinedPlacement};pbjs._bidsRequested=[];pbjs._bidsReceived=[];pbjs._adUnitCodes=[];pbjs._winningBids=[];pbjs._adsReceived=[];pbjs._sendAllBids=false;pbjs.bidderSettings=pbjs.bidderSettings||{};pbjs.bidderTimeout=pbjs.bidderTimeout||3e3;pbjs.cbTimeout=pbjs.cbTimeout||200;pbjs.timeoutBuffer=200;pbjs.logging=pbjs.logging||false;pbjs.libLoaded=true;pbjs.version="v0.17.0";utils.logInfo("Prebid.js v0.17.0 loaded");pbjs.adUnits=pbjs.adUnits||[];pbjs.que.push=function(cmd){if((typeof cmd==="undefined"?"undefined":_typeof(cmd))===objectType_function){try{cmd.call()}catch(e){utils.logError("Error processing command :"+e.message)}}else{utils.logError("Commands written into pbjs.que.push must wrapped in a function")}};function processQue(){for(var i=0;i<pbjs.que.length;i++){if(_typeof(pbjs.que[i].called)===objectType_undefined){try{pbjs.que[i].call();pbjs.que[i].called=true}catch(e){utils.logError("Error processing command :","prebid.js",e)}}}}function checkDefinedPlacement(id){var placementCodes=pbjs._bidsRequested.map(function(bidSet){return bidSet.bids.map(function(bid){return bid.placementCode})}).reduce(_utils.flatten).filter(_utils.uniques);if(!utils.contains(placementCodes,id)){utils.logError('The "'+id+'" placement is not defined.');return}return true}function resetPresetTargeting(){if((0,_utils.isGptPubadsDefined)()){window.googletag.pubads().getSlots().forEach(function(slot){pbTargetingKeys.forEach(function(key){slot.setTargeting(key,null)})})}}function setTargeting(targetingConfig){window.googletag.pubads().getSlots().forEach(function(slot){targetingConfig.filter(function(targeting){return Object.keys(targeting)[0]===slot.getAdUnitPath()||Object.keys(targeting)[0]===slot.getSlotElementId()}).forEach(function(targeting){return targeting[Object.keys(targeting)[0]].forEach(function(key){key[Object.keys(key)[0]].map(function(value){utils.logMessage("Attempting to set key value for slot: "+slot.getSlotElementId()+" key: "+Object.keys(key)[0]+" value: "+value);return value}).forEach(function(value){slot.setTargeting(Object.keys(key)[0],value)})})})})}function getStandardKeys(){return bidmanager.getStandardBidderAdServerTargeting().map(function(targeting){return targeting.key}).concat(CONSTANTS.TARGETING_KEYS).filter(_utils.uniques)}function getWinningBids(adUnitCode){var adUnitCodes=adUnitCode?[adUnitCode]:pbjs._adUnitCodes;return pbjs._bidsReceived.filter(function(bid){return adUnitCodes.includes(bid.adUnitCode)}).filter(function(bid){return bid.cpm>0}).map(function(bid){return bid.adUnitCode}).filter(_utils.uniques).map(function(adUnitCode){return pbjs._bidsReceived.filter(function(bid){return bid.adUnitCode===adUnitCode?bid:null}).reduce(_utils.getHighestCpm,{adUnitCode:adUnitCode,cpm:0,adserverTargeting:{},timeToRespond:0})})}function getWinningBidTargeting(){var winners=getWinningBids();winners.filter(function(bid){return bid.dealId}).map(function(bid){return bid.adserverTargeting.hb_deal=bid.dealId});var standardKeys=getStandardKeys();winners=winners.map(function(winner){return _defineProperty({},winner.adUnitCode,Object.keys(winner.adserverTargeting).filter(function(key){return typeof winner.sendStandardTargeting==="undefined"||winner.sendStandardTargeting||standardKeys.indexOf(key)===-1}).map(function(key){return _defineProperty({},key.substring(0,20),[winner.adserverTargeting[key]])}))});return winners}function getDealTargeting(){return pbjs._bidsReceived.filter(function(bid){return bid.dealId}).map(function(bid){var dealKey="hb_deal_"+bid.bidderCode;return _defineProperty({},bid.adUnitCode,getTargetingMap(bid,CONSTANTS.TARGETING_KEYS).concat(_defineProperty({},dealKey.substring(0,20),[bid.adserverTargeting[dealKey]])))})}function getAlwaysUseBidTargeting(adUnitCodes){var standardKeys=getStandardKeys();return pbjs._bidsReceived.filter(_utils.adUnitsFilter.bind(this,adUnitCodes)).map(function(bid){if(bid.alwaysUseBid){return _defineProperty({},bid.adUnitCode,Object.keys(bid.adserverTargeting).map(function(key){if(standardKeys.indexOf(key)>-1){return}return _defineProperty({},key.substring(0,20),[bid.adserverTargeting[key]])}).filter(function(key){return key}))}}).filter(function(bid){return bid})}function getBidLandscapeTargeting(adUnitCodes){var standardKeys=CONSTANTS.TARGETING_KEYS;return pbjs._bidsReceived.filter(_utils.adUnitsFilter.bind(this,adUnitCodes)).map(function(bid){if(bid.adserverTargeting){return _defineProperty({},bid.adUnitCode,getTargetingMap(bid,standardKeys))}}).filter(function(bid){return bid})}function getTargetingMap(bid,keys){return keys.map(function(key){return _defineProperty({},(key+"_"+bid.bidderCode).substring(0,20),[bid.adserverTargeting[key]])})}function getAllTargeting(adUnitCode){var adUnitCodes=adUnitCode&&adUnitCode.length?[adUnitCode]:pbjs._adUnitCodes;var targeting=getWinningBidTargeting(adUnitCodes).concat(getAlwaysUseBidTargeting(adUnitCodes)).concat(pbjs._sendAllBids?getBidLandscapeTargeting(adUnitCodes):[]).concat(getDealTargeting(adUnitCodes));targeting.map(function(adUnitCode){Object.keys(adUnitCode).map(function(key){adUnitCode[key].map(function(targetKey){if(pbTargetingKeys.indexOf(Object.keys(targetKey)[0])===-1){pbTargetingKeys=Object.keys(targetKey).concat(pbTargetingKeys)}})})});return targeting}function clearPlacements(){pbjs._bidsRequested=[];pbjs._bidsReceived=pbjs._bidsReceived.filter(function(bid){return!pbjs._adUnitCodes.includes(bid.adUnitCode)})}function setRenderSize(doc,width,height){if(doc.defaultView&&doc.defaultView.frameElement){doc.defaultView.frameElement.width=width;doc.defaultView.frameElement.height=height}}pbjs.getAdserverTargetingForAdUnitCodeStr=function(adunitCode){utils.logInfo("Invoking pbjs.getAdserverTargetingForAdUnitCodeStr",arguments);if(adunitCode){var res=pbjs.getAdserverTargetingForAdUnitCode(adunitCode);return utils.transformAdServerTargetingObj(res)}else{utils.logMessage("Need to call getAdserverTargetingForAdUnitCodeStr with adunitCode")}};pbjs.getAdserverTargetingForAdUnitCode=function(adUnitCode){return pbjs.getAdserverTargeting(adUnitCode)[adUnitCode]};pbjs.getAdserverTargeting=function(adUnitCode){utils.logInfo("Invoking pbjs.getAdserverTargeting",arguments);return getAllTargeting(adUnitCode).map(function(targeting){return _defineProperty({},Object.keys(targeting)[0],targeting[Object.keys(targeting)[0]].map(function(target){return _defineProperty({},Object.keys(target)[0],target[Object.keys(target)[0]].join(", "))}).reduce(function(p,c){return _extends(c,p)},{}))}).reduce(function(accumulator,targeting){var key=Object.keys(targeting)[0];accumulator[key]=_extends({},accumulator[key],targeting[key]);return accumulator},{})};pbjs.getBidResponses=function(){utils.logInfo("Invoking pbjs.getBidResponses",arguments);var responses=pbjs._bidsReceived.filter(_utils.adUnitsFilter.bind(this,pbjs._adUnitCodes));var currentRequestId=responses&&responses.length&&responses[responses.length-1].requestId;return responses.map(function(bid){return bid.adUnitCode}).filter(_utils.uniques).map(function(adUnitCode){return responses.filter(function(bid){return bid.requestId===currentRequestId&&bid.adUnitCode===adUnitCode})}).filter(function(bids){return bids&&bids[0]&&bids[0].adUnitCode}).map(function(bids){return _defineProperty({},bids[0].adUnitCode,{bids:bids})}).reduce(function(a,b){return _extends(a,b)},{})};pbjs.getBidResponsesForAdUnitCode=function(adUnitCode){var bids=pbjs._bidsReceived.filter(function(bid){return bid.adUnitCode===adUnitCode});return{bids:bids}};pbjs.setTargetingForGPTAsync=function(){utils.logInfo("Invoking pbjs.setTargetingForGPTAsync",arguments);if(!(0,_utils.isGptPubadsDefined)()){utils.logError("window.googletag is not defined on the page");return}resetPresetTargeting();setTargeting(getAllTargeting())};pbjs.allBidsAvailable=function(){utils.logInfo("Invoking pbjs.allBidsAvailable",arguments);return bidmanager.bidsBackAll()};pbjs.renderAd=function(doc,id){utils.logInfo("Invoking pbjs.renderAd",arguments);utils.logMessage("Calling renderAd with adId :"+id);if(doc&&id){try{var adObject=pbjs._bidsReceived.find(function(bid){return bid.adId===id});if(adObject){pbjs._winningBids.push(adObject);events.emit(BID_WON,adObject);var height=adObject.height;var width=adObject.width;var url=adObject.adUrl;var ad=adObject.ad;if(doc===document||adObject.mediaType==="video"){utils.logError("Error trying to write ad. Ad render call ad id "+id+" was prevented from writing to the main document.")}else if(ad){doc.write(ad);doc.close();setRenderSize(doc,width,height)}else if(url){doc.write('<IFRAME SRC="'+url+'" FRAMEBORDER="0" SCROLLING="no" MARGINHEIGHT="0" MARGINWIDTH="0" TOPMARGIN="0" LEFTMARGIN="0" ALLOWTRANSPARENCY="true" WIDTH="'+width+'" HEIGHT="'+height+'"></IFRAME>');doc.close();setRenderSize(doc,width,height)}else{utils.logError("Error trying to write ad. No ad for bid response id: "+id)}}else{utils.logError("Error trying to write ad. Cannot find ad by given id : "+id)}}catch(e){utils.logError("Error trying to write ad Id :"+id+" to the page:"+e.message)}}else{utils.logError("Error trying to write ad Id :"+id+" to the page. Missing document or adId")}};pbjs.removeAdUnit=function(adUnitCode){utils.logInfo("Invoking pbjs.removeAdUnit",arguments);if(adUnitCode){for(var i=0;i<pbjs.adUnits.length;i++){if(pbjs.adUnits[i].code===adUnitCode){pbjs.adUnits.splice(i,1)}}}};pbjs.clearAuction=function(){auctionRunning=false;utils.logMessage("Prebid auction cleared");if(bidRequestQueue.length){bidRequestQueue.shift()()}};pbjs.requestBids=function(_ref11){var bidsBackHandler=_ref11.bidsBackHandler,timeout=_ref11.timeout,adUnits=_ref11.adUnits,adUnitCodes=_ref11.adUnitCodes;var cbTimeout=pbjs.cbTimeout=timeout||pbjs.bidderTimeout;adUnits=adUnits||pbjs.adUnits;utils.logInfo("Invoking pbjs.requestBids",arguments);if(adUnitCodes&&adUnitCodes.length){adUnits=adUnits.filter(function(unit){return adUnitCodes.includes(unit.code)})}else{adUnitCodes=adUnits&&adUnits.map(function(unit){return unit.code})}var invalidVideoAdUnits=adUnits.filter(_video.videoAdUnit).filter(_video.hasNonVideoBidder);invalidVideoAdUnits.forEach(function(adUnit){utils.logError("adUnit "+adUnit.code+" has 'mediaType' set to 'video' but contains a bidder that doesn't support video. No Prebid demand requests will be triggered for this adUnit.");for(var i=0;i<adUnits.length;i++){if(adUnits[i].code===adUnit.code){adUnits.splice(i,1)}}});if(auctionRunning){bidRequestQueue.push(function(){pbjs.requestBids({bidsBackHandler:bidsBackHandler,timeout:cbTimeout,adUnits:adUnits,adUnitCodes:adUnitCodes})});return}auctionRunning=true;pbjs._adUnitCodes=adUnitCodes;bidmanager.externalCallbackReset();clearPlacements();if(!adUnits||adUnits.length===0){utils.logMessage("No adUnits configured. No bids requested.");if((typeof bidsBackHandler==="undefined"?"undefined":_typeof(bidsBackHandler))===objectType_function){bidmanager.addOneTimeCallback(bidsBackHandler,false)}bidmanager.executeCallback();return}var timedOut=true;var timeoutCallback=bidmanager.executeCallback.bind(bidmanager,timedOut);var timer=setTimeout(timeoutCallback,cbTimeout);if((typeof bidsBackHandler==="undefined"?"undefined":_typeof(bidsBackHandler))===objectType_function){bidmanager.addOneTimeCallback(bidsBackHandler,timer)}adaptermanager.callBids({adUnits:adUnits,adUnitCodes:adUnitCodes,cbTimeout:cbTimeout});if(pbjs._bidsRequested.length===0){bidmanager.executeCallback()}};pbjs.addAdUnits=function(adUnitArr){utils.logInfo("Invoking pbjs.addAdUnits",arguments);if(utils.isArray(adUnitArr)){pbjs.adUnits.push.apply(pbjs.adUnits,adUnitArr)}else if((typeof adUnitArr==="undefined"?"undefined":_typeof(adUnitArr))===objectType_object){pbjs.adUnits.push(adUnitArr)}};pbjs.onEvent=function(event,handler,id){utils.logInfo("Invoking pbjs.onEvent",arguments);if(!utils.isFn(handler)){utils.logError('The event handler provided is not a function and was not set on event "'+event+'".');return}if(id&&!eventValidators[event].call(null,id)){utils.logError('The id provided is not valid for event "'+event+'" and no handler was set.');return}events.on(event,handler,id)};pbjs.offEvent=function(event,handler,id){utils.logInfo("Invoking pbjs.offEvent",arguments);if(id&&!eventValidators[event].call(null,id)){return}events.off(event,handler,id)};pbjs.addCallback=function(eventStr,func){utils.logInfo("Invoking pbjs.addCallback",arguments);var id=null;if(!eventStr||!func||(typeof func==="undefined"?"undefined":_typeof(func))!==objectType_function){utils.logError("error registering callback. Check method signature");return id}id=utils.getUniqueIdentifierStr;bidmanager.addCallback(id,func,eventStr);return id};pbjs.removeCallback=function(){return null};pbjs.registerBidAdapter=function(bidderAdaptor,bidderCode){utils.logInfo("Invoking pbjs.registerBidAdapter",arguments);try{adaptermanager.registerBidAdapter(bidderAdaptor(),bidderCode)}catch(e){utils.logError("Error registering bidder adapter : "+e.message)}};pbjs.registerAnalyticsAdapter=function(options){utils.logInfo("Invoking pbjs.registerAnalyticsAdapter",arguments);try{adaptermanager.registerAnalyticsAdapter(options)}catch(e){utils.logError("Error registering analytics adapter : "+e.message)}};pbjs.bidsAvailableForAdapter=function(bidderCode){utils.logInfo("Invoking pbjs.bidsAvailableForAdapter",arguments);pbjs._bidsRequested.find(function(bidderRequest){return bidderRequest.bidderCode===bidderCode}).bids.map(function(bid){return _extends(bid,bidfactory.createBid(1),{bidderCode:bidderCode,adUnitCode:bid.placementCode})}).map(function(bid){return pbjs._bidsReceived.push(bid)})};pbjs.createBid=function(statusCode){utils.logInfo("Invoking pbjs.createBid",arguments);return bidfactory.createBid(statusCode)};pbjs.addBidResponse=function(adUnitCode,bid){utils.logInfo("Invoking pbjs.addBidResponse",arguments);bidmanager.addBidResponse(adUnitCode,bid)};pbjs.loadScript=function(tagSrc,callback,useCache){utils.logInfo("Invoking pbjs.loadScript",arguments);adloader.loadScript(tagSrc,callback,useCache)};pbjs.enableAnalytics=function(config){if(config&&!utils.isEmpty(config)){utils.logInfo("Invoking pbjs.enableAnalytics for: ",config);adaptermanager.enableAnalytics(config)}else{utils.logError("pbjs.enableAnalytics should be called with option {}")}};pbjs.aliasBidder=function(bidderCode,alias){utils.logInfo("Invoking pbjs.aliasBidder",arguments);if(bidderCode&&alias){adaptermanager.aliasBidAdapter(bidderCode,alias)}else{utils.logError("bidderCode and alias must be passed as arguments","pbjs.aliasBidder")}};pbjs.setPriceGranularity=function(granularity){utils.logInfo("Invoking pbjs.setPriceGranularity",arguments);if(!granularity){utils.logError("Prebid Error: no value passed to `setPriceGranularity()`");return}if(typeof granularity==="string"){bidmanager.setPriceGranularity(granularity)}else if((typeof granularity==="undefined"?"undefined":_typeof(granularity))==="object"){if(!(0,_cpmBucketManager.isValidePriceConfig)(granularity)){utils.logError("Invalid custom price value passed to `setPriceGranularity()`");return}bidmanager.setCustomPriceBucket(granularity);bidmanager.setPriceGranularity(CONSTANTS.GRANULARITY_OPTIONS.CUSTOM);utils.logMessage("Using custom price granularity")}};pbjs.enableSendAllBids=function(){pbjs._sendAllBids=true};pbjs.getAllWinningBids=function(){return pbjs._winningBids};pbjs.buildMasterVideoTagFromAdserverTag=function(adserverTag,options){utils.logInfo("Invoking pbjs.buildMasterVideoTagFromAdserverTag",arguments);var urlComponents=(0,_url.parse)(adserverTag);if(pbjs._bidsReceived.length===0){return adserverTag}var masterTag="";if(options.adserver.toLowerCase()==="dfp"){var dfpAdserverObj=adserver.dfpAdserver(options,urlComponents);if(!dfpAdserverObj.verifyAdserverTag()){utils.logError("Invalid adserverTag, required google params are missing in query string")}dfpAdserverObj.appendQueryParams();masterTag=(0,_url.format)(dfpAdserverObj.urlComponents)}else{utils.logError("Only DFP adserver is supported");return}return masterTag};pbjs.setBidderSequence=function(order){if(order===CONSTANTS.ORDER.RANDOM){adaptermanager.setBidderSequence(CONSTANTS.ORDER.RANDOM)}};pbjs.getHighestCpmBids=function(adUnitCode){return getWinningBids(adUnitCode)};processQue()},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getGlobal=getGlobal;window.pbjs=window.pbjs||{};window.pbjs.que=window.pbjs.que||[];function getGlobal(){return window.pbjs}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.uniques=uniques;exports.flatten=flatten;exports.getBidRequest=getBidRequest;exports.getKeys=getKeys;exports.getValue=getValue;exports.getBidderCodes=getBidderCodes;exports.isGptPubadsDefined=isGptPubadsDefined;exports.getHighestCpm=getHighestCpm;exports.shuffle=shuffle;exports.adUnitsFilter=adUnitsFilter;var CONSTANTS=__webpack_require__(3);var objectType_object="object";var objectType_string="string";var objectType_number="number";var _loggingChecked=false;var t_Arr="Array";var t_Str="String";var t_Fn="Function";var t_Numb="Number";var toString=Object.prototype.toString;var infoLogger=null;try{infoLogger=console.info.bind(window.console)}catch(e){}exports.replaceTokenInString=function(str,map,token){this._each(map,function(value,key){value=value===undefined?"":value;var keyString=token+key.toUpperCase()+token;var re=new RegExp(keyString,"g");str=str.replace(re,value)});return str};var getIncrementalInteger=function(){var count=0;return function(){count++;return count}}();function _getUniqueIdentifierStr(){return getIncrementalInteger()+Math.random().toString(16).substr(2)}exports.getUniqueIdentifierStr=_getUniqueIdentifierStr;exports.generateUUID=function generateUUID(placeholder){return placeholder?(placeholder^Math.random()*16>>placeholder/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,generateUUID)};exports.getBidIdParameter=function(key,paramsObj){if(paramsObj&&paramsObj[key]){return paramsObj[key]}return""};exports.tryAppendQueryString=function(existingUrl,key,value){if(value){return existingUrl+=key+"="+encodeURIComponent(value)+"&"}return existingUrl};exports.parseQueryStringParameters=function(queryObj){var result="";for(var k in queryObj){if(queryObj.hasOwnProperty(k))result+=k+"="+encodeURIComponent(queryObj[k])+"&"}return result};exports.transformAdServerTargetingObj=function(targeting){if(targeting&&Object.getOwnPropertyNames(targeting).length>0){return getKeys(targeting).map(function(key){return key+"="+encodeURIComponent(getValue(targeting,key))}).join("&")}else{return""}};exports.extend=function(target,source){target=target||{};this._each(source,function(value,prop){if(_typeof(source[prop])===objectType_object){target[prop]=this.extend(target[prop],source[prop])}else{target[prop]=source[prop]}});return target};exports.parseSizesInput=function(sizeObj){var parsedSizes=[];if((typeof sizeObj==="undefined"?"undefined":_typeof(sizeObj))===objectType_string){var sizes=sizeObj.split(",");var sizeRegex=/^(\d)+x(\d)+$/i;if(sizes){for(var curSizePos in sizes){if(hasOwn(sizes,curSizePos)&&sizes[curSizePos].match(sizeRegex)){parsedSizes.push(sizes[curSizePos])}}}}else if((typeof sizeObj==="undefined"?"undefined":_typeof(sizeObj))===objectType_object){var sizeArrayLength=sizeObj.length;if(sizeArrayLength>0){if(sizeArrayLength===2&&_typeof(sizeObj[0])===objectType_number&&_typeof(sizeObj[1])===objectType_number){parsedSizes.push(this.parseGPTSingleSizeArray(sizeObj))}else{for(var i=0;i<sizeArrayLength;i++){parsedSizes.push(this.parseGPTSingleSizeArray(sizeObj[i]))}}}}return parsedSizes};exports.parseGPTSingleSizeArray=function(singleSize){if(this.isArray(singleSize)&&singleSize.length===2&&!isNaN(singleSize[0])&&!isNaN(singleSize[1])){return singleSize[0]+"x"+singleSize[1]}};exports.getTopWindowLocation=function(){var location=void 0;try{location=window.top.location}catch(e){location=window.location}return location};exports.getTopWindowUrl=function(){var href=void 0;try{href=this.getTopWindowLocation().href}catch(e){href=""}return href};exports.logWarn=function(msg){if(debugTurnedOn()&&console.warn){console.warn("WARNING: "+msg)}};exports.logInfo=function(msg,args){if(debugTurnedOn()&&hasConsoleLogger()){if(infoLogger){if(!args||args.length===0){args=""}infoLogger("INFO: "+msg+(args===""?"":" : params : "),args)}}};exports.logMessage=function(msg){if(debugTurnedOn()&&hasConsoleLogger()){console.log("MESSAGE: "+msg)}};function hasConsoleLogger(){return window.console&&window.console.log}exports.hasConsoleLogger=hasConsoleLogger;var errLogFn=function(hasLogger){if(!hasLogger)return"";return window.console.error?"error":"log"}(hasConsoleLogger());var debugTurnedOn=function debugTurnedOn(){if(pbjs.logging===false&&_loggingChecked===false){pbjs.logging=getParameterByName(CONSTANTS.DEBUG_MODE).toUpperCase()==="TRUE";_loggingChecked=true}return!!pbjs.logging};exports.debugTurnedOn=debugTurnedOn;exports.logError=function(msg,code,exception){var errCode=code||"ERROR";if(debugTurnedOn()&&hasConsoleLogger()){console[errLogFn](console,errCode+": "+msg,exception||"")}};exports.createInvisibleIframe=function _createInvisibleIframe(){var f=document.createElement("iframe");f.id=_getUniqueIdentifierStr();f.height=0;f.width=0;f.border="0px";f.hspace="0";f.vspace="0";f.marginWidth="0";f.marginHeight="0";f.style.border="0";f.scrolling="no";f.frameBorder="0";f.src="about:blank";f.style.display="none";return f};var getParameterByName=function getParameterByName(name){var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.search);if(results===null){return""}return decodeURIComponent(results[1].replace(/\+/g," "))};exports.hasValidBidRequest=function(paramObj,requiredParamsArr,adapter){var found=false;function findParam(value,key){if(key===requiredParamsArr[i]){found=true}}for(var i=0;i<requiredParamsArr.length;i++){found=false;this._each(paramObj,findParam);if(!found){this.logError("Params are missing for bid request. One of these required paramaters are missing: "+requiredParamsArr,adapter);return false}}return true};exports.addEventHandler=function(element,event,func){if(element.addEventListener){element.addEventListener(event,func,true)}else if(element.attachEvent){element.attachEvent("on"+event,func)}};exports.isA=function(object,_t){return toString.call(object)==="[object "+_t+"]"};exports.isFn=function(object){return this.isA(object,t_Fn)};exports.isStr=function(object){return this.isA(object,t_Str)};exports.isArray=function(object){return this.isA(object,t_Arr)};exports.isNumber=function(object){return this.isA(object,t_Numb)};exports.isEmpty=function(object){if(!object)return true;if(this.isArray(object)||this.isStr(object)){return!(object.length>0)}for(var k in object){if(hasOwnProperty.call(object,k))return false}return true};exports.isEmptyStr=function(str){return this.isStr(str)&&(!str||0===str.length)};exports._each=function(object,fn){if(this.isEmpty(object))return;if(this.isFn(object.forEach))return object.forEach(fn,this);var k=0;var l=object.length;if(l>0){for(;k<l;k++){fn(object[k],k,object)}}else{for(k in object){if(hasOwnProperty.call(object,k))fn.call(this,object[k],k)}}};exports.contains=function(a,obj){if(this.isEmpty(a)){return false}if(this.isFn(a.indexOf)){return a.indexOf(obj)!==-1}var i=a.length;while(i--){if(a[i]===obj){return true}}return false};exports.indexOf=function(){if(Array.prototype.indexOf){return Array.prototype.indexOf}}();exports._map=function(object,callback){if(this.isEmpty(object))return[];if(this.isFn(object.map))return object.map(callback);var output=[];this._each(object,function(value,key){output.push(callback(value,key,object))});return output};var hasOwn=function hasOwn(objectToCheck,propertyToCheckFor){if(objectToCheck.hasOwnProperty){return objectToCheck.hasOwnProperty(propertyToCheckFor)}else{return typeof objectToCheck[propertyToCheckFor]!=="undefined"&&objectToCheck.constructor.prototype[propertyToCheckFor]!==objectToCheck[propertyToCheckFor]}};exports.createTrackPixelHtml=function(url){if(!url){return""}var escapedUrl=encodeURI(url);var img='<div style="position:absolute;left:0px;top:0px;visibility:hidden;">';img+='<img src="'+escapedUrl+'"></div>';return img};exports.getIframeDocument=function(iframe){if(!iframe){return}var doc=void 0;try{if(iframe.contentWindow){doc=iframe.contentWindow.document}else if(iframe.contentDocument.document){doc=iframe.contentDocument.document}else{doc=iframe.contentDocument}}catch(e){this.logError("Cannot get iframe document",e)}return doc};exports.getValueString=function(param,val,defaultValue){if(val===undefined||val===null){return defaultValue}if(this.isStr(val)){return val}if(this.isNumber(val)){return val.toString()}this.logWarn("Unsuported type for param: "+param+" required type: String")};function uniques(value,index,arry){return arry.indexOf(value)===index}function flatten(a,b){return a.concat(b)}function getBidRequest(id){return pbjs._bidsRequested.map(function(bidSet){return bidSet.bids.find(function(bid){return bid.bidId===id})}).find(function(bid){return bid})}function getKeys(obj){return Object.keys(obj)}function getValue(obj,key){return obj[key]}function getBidderCodes(){var adUnits=arguments.length>0&&arguments[0]!==undefined?arguments[0]:pbjs.adUnits;return adUnits.map(function(unit){return unit.bids.map(function(bid){return bid.bidder}).reduce(flatten,[])}).reduce(flatten).filter(uniques)}function isGptPubadsDefined(){if(window.googletag&&exports.isFn(window.googletag.pubads)&&exports.isFn(window.googletag.pubads().getSlots)){return true}}function getHighestCpm(previous,current){if(previous.cpm===current.cpm){return previous.timeToRespond>current.timeToRespond?current:previous}return previous.cpm<current.cpm?current:previous}function shuffle(array){var counter=array.length;while(counter>0){var index=Math.floor(Math.random()*counter);counter--;var temp=array[counter];array[counter]=array[index];array[index]=temp}return array}function adUnitsFilter(filter,bid){return filter.includes(bid&&bid.placementCode||bid&&bid.adUnitCode)}},function(module,exports){module.exports={JSON_MAPPING:{PL_CODE:"code",PL_SIZE:"sizes",PL_BIDS:"bids",BD_BIDDER:"bidder",BD_ID:"paramsd",BD_PL_ID:"placementId",ADSERVER_TARGETING:"adserverTargeting",BD_SETTING_STANDARD:"standard"},REPO_AND_VERSION:"prebid_prebid_0.17.0",DEBUG_MODE:"pbjs_debug",STATUS:{GOOD:1,NO_BID:2},CB:{TYPE:{ALL_BIDS_BACK:"allRequestedBidsBack",AD_UNIT_BIDS_BACK:"adUnitBidsBack",BID_WON:"bidWon"}},objectType_function:"function",objectType_undefined:"undefined",objectType_object:"object",objectType_string:"string",objectType_number:"number",EVENTS:{AUCTION_INIT:"auctionInit",AUCTION_END:"auctionEnd",BID_ADJUSTMENT:"bidAdjustment",BID_TIMEOUT:"bidTimeout",BID_REQUESTED:"bidRequested",BID_RESPONSE:"bidResponse",BID_WON:"bidWon"},EVENT_ID_PATHS:{bidWon:"adUnitCode"},ORDER:{RANDOM:"random"},GRANULARITY_OPTIONS:{LOW:"low",MEDIUM:"medium",HIGH:"high",AUTO:"auto",DENSE:"dense",CUSTOM:"custom"},TARGETING_KEYS:["hb_bidder","hb_adid","hb_pb","hb_size"]}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasNonVideoBidder=exports.videoAdUnit=undefined;var _adaptermanager=__webpack_require__(5);var videoAdUnit=exports.videoAdUnit=function videoAdUnit(adUnit){return adUnit.mediaType==="video"};var nonVideoBidder=function nonVideoBidder(bid){return!_adaptermanager.videoAdapters.includes(bid.bidder)};var hasNonVideoBidder=exports.hasNonVideoBidder=function hasNonVideoBidder(adUnit){return adUnit.bids.filter(nonVideoBidder).length}},function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _utils=__webpack_require__(2);var _sizeMapping=__webpack_require__(6);var _baseAdapter=__webpack_require__(7);var utils=__webpack_require__(2);var CONSTANTS=__webpack_require__(3);var events=__webpack_require__(8);var _bidderRegistry={};exports.bidderRegistry=_bidderRegistry;var _analyticsRegistry={};var _bidderSequence=null;function getBids(_ref){var bidderCode=_ref.bidderCode,requestId=_ref.requestId,bidderRequestId=_ref.bidderRequestId,adUnits=_ref.adUnits;return adUnits.map(function(adUnit){return adUnit.bids.filter(function(bid){return bid.bidder===bidderCode}).map(function(bid){var sizes=adUnit.sizes;if(adUnit.sizeMapping){var sizeMapping=(0,_sizeMapping.mapSizes)(adUnit);if(sizeMapping===""){return""}sizes=sizeMapping}return _extends(bid,{placementCode:adUnit.code,mediaType:adUnit.mediaType,sizes:sizes,bidId:utils.getUniqueIdentifierStr(),bidderRequestId:bidderRequestId,requestId:requestId})})}).reduce(_utils.flatten,[]).filter(function(val){return val!==""})}exports.callBids=function(_ref2){var adUnits=_ref2.adUnits,cbTimeout=_ref2.cbTimeout;var requestId=utils.generateUUID();var auctionStart=Date.now();var auctionInit={timestamp:auctionStart,requestId:requestId};events.emit(CONSTANTS.EVENTS.AUCTION_INIT,auctionInit);

var bidderCodes=(0,_utils.getBidderCodes)(adUnits);if(_bidderSequence===CONSTANTS.ORDER.RANDOM){bidderCodes=(0,_utils.shuffle)(bidderCodes)}bidderCodes.forEach(function(bidderCode){var adapter=_bidderRegistry[bidderCode];if(adapter){var bidderRequestId=utils.getUniqueIdentifierStr();var bidderRequest={bidderCode:bidderCode,requestId:requestId,bidderRequestId:bidderRequestId,bids:getBids({bidderCode:bidderCode,requestId:requestId,bidderRequestId:bidderRequestId,adUnits:adUnits}),start:(new Date).getTime(),auctionStart:auctionStart,timeout:cbTimeout};if(bidderRequest.bids&&bidderRequest.bids.length!==0){utils.logMessage("CALLING BIDDER ======= "+bidderCode);pbjs._bidsRequested.push(bidderRequest);events.emit(CONSTANTS.EVENTS.BID_REQUESTED,bidderRequest);adapter.callBids(bidderRequest)}}else{utils.logError("Adapter trying to be called which does not exist: "+bidderCode+" adaptermanager.callBids")}})};exports.registerBidAdapter=function(bidAdaptor,bidderCode){if(bidAdaptor&&bidderCode){if(_typeof(bidAdaptor.callBids)===CONSTANTS.objectType_function){_bidderRegistry[bidderCode]=bidAdaptor}else{utils.logError("Bidder adaptor error for bidder code: "+bidderCode+"bidder must implement a callBids() function")}}else{utils.logError("bidAdaptor or bidderCode not specified")}};exports.aliasBidAdapter=function(bidderCode,alias){var existingAlias=_bidderRegistry[alias];if((typeof existingAlias==="undefined"?"undefined":_typeof(existingAlias))===CONSTANTS.objectType_undefined){var bidAdaptor=_bidderRegistry[bidderCode];if((typeof bidAdaptor==="undefined"?"undefined":_typeof(bidAdaptor))===CONSTANTS.objectType_undefined){utils.logError('bidderCode "'+bidderCode+'" is not an existing bidder.',"adaptermanager.aliasBidAdapter")}else{try{var newAdapter=null;if(bidAdaptor instanceof _baseAdapter.BaseAdapter){utils.logError(bidderCode+" bidder does not currently support aliasing.","adaptermanager.aliasBidAdapter")}else{newAdapter=bidAdaptor.createNew();newAdapter.setBidderCode(alias);this.registerBidAdapter(newAdapter,alias)}}catch(e){utils.logError(bidderCode+" bidder does not currently support aliasing.","adaptermanager.aliasBidAdapter")}}}else{utils.logMessage('alias name "'+alias+'" has been already specified.')}};exports.registerAnalyticsAdapter=function(_ref3){var adapter=_ref3.adapter,code=_ref3.code;if(adapter&&code){if(_typeof(adapter.enableAnalytics)===CONSTANTS.objectType_function){adapter.code=code;_analyticsRegistry[code]=adapter}else{utils.logError('Prebid Error: Analytics adaptor error for analytics "'+code+'"\n        analytics adapter must implement an enableAnalytics() function')}}else{utils.logError("Prebid Error: analyticsAdapter or analyticsCode not specified")}};exports.enableAnalytics=function(config){if(!utils.isArray(config)){config=[config]}utils._each(config,function(adapterConfig){var adapter=_analyticsRegistry[adapterConfig.provider];if(adapter){adapter.enableAnalytics(adapterConfig)}else{utils.logError("Prebid Error: no analytics adapter found in registry for\n        "+adapterConfig.provider+".")}})};exports.setBidderSequence=function(order){_bidderSequence=order};var AppnexusAdapter=__webpack_require__(9);exports.registerBidAdapter(new AppnexusAdapter,"appnexus");var FanAdapter=__webpack_require__(15);exports.registerBidAdapter(new FanAdapter,"fan");exports.videoAdapters=[];null},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setWindow=exports.getScreenWidth=exports.mapSizes=undefined;var _utils=__webpack_require__(2);var utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}}var _win=void 0;function mapSizes(adUnit){if(!isSizeMappingValid(adUnit.sizeMapping)){return adUnit.sizes}var width=getScreenWidth();if(!width){var _mapping=adUnit.sizeMapping.reduce(function(prev,curr){return prev.minWidth<curr.minWidth?curr:prev});if(_mapping.sizes){return _mapping.sizes}return adUnit.sizes}var sizes="";var mapping=adUnit.sizeMapping.find(function(sizeMapping){return width>sizeMapping.minWidth});if(mapping&&mapping.sizes){sizes=mapping.sizes;utils.logMessage("AdUnit : "+adUnit.code+" resized based on device width to : "+sizes)}else{utils.logMessage("AdUnit : "+adUnit.code+" not mapped to any sizes for device width. This request will be suppressed.")}return sizes}function isSizeMappingValid(sizeMapping){if(utils.isArray(sizeMapping)&&sizeMapping.length>0){return true}utils.logInfo("No size mapping defined");return false}function getScreenWidth(win){var w=win||_win||window;var d=w.document;if(w.innerWidth){return w.innerWidth}else if(d.body.clientWidth){return d.body.clientWidth}else if(d.documentElement.clientWidth){return d.documentElement.clientWidth}return 0}function setWindow(win){_win=win}exports.mapSizes=mapSizes;exports.getScreenWidth=getScreenWidth;exports.setWindow=setWindow},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var BaseAdapter=exports.BaseAdapter=function(){function BaseAdapter(code){_classCallCheck(this,BaseAdapter);this.code=code}_createClass(BaseAdapter,[{key:"getCode",value:function getCode(){return this.code}},{key:"setCode",value:function setCode(code){this.code=code}},{key:"callBids",value:function callBids(){throw"adapter implementation must override callBids method"}}]);return BaseAdapter}()},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(2);var CONSTANTS=__webpack_require__(3);var slice=Array.prototype.slice;var push=Array.prototype.push;var allEvents=utils._map(CONSTANTS.EVENTS,function(v){return v});var idPaths=CONSTANTS.EVENT_ID_PATHS;var eventsFired=[];module.exports=function(){var _handlers={};var _public={};function _dispatch(eventString,args){utils.logMessage("Emitting event for: "+eventString);var eventPayload=args[0]||{};var idPath=idPaths[eventString];var key=eventPayload[idPath];var event=_handlers[eventString]||{que:[]};var eventKeys=utils._map(event,function(v,k){return k});var callbacks=[];eventsFired.push({eventType:eventString,args:eventPayload,id:key});if(key&&utils.contains(eventKeys,key)){push.apply(callbacks,event[key].que)}push.apply(callbacks,event.que);utils._each(callbacks,function(fn){if(!fn)return;try{fn.apply(null,args)}catch(e){utils.logError("Error executing handler:","events.js",e)}})}function _checkAvailableEvent(event){return utils.contains(allEvents,event)}_public.on=function(eventString,handler,id){if(_checkAvailableEvent(eventString)){var event=_handlers[eventString]||{que:[]};if(id){event[id]=event[id]||{que:[]};event[id].que.push(handler)}else{event.que.push(handler)}_handlers[eventString]=event}else{utils.logError("Wrong event name : "+eventString+" Valid event names :"+allEvents)}};_public.emit=function(event){var args=slice.call(arguments,1);_dispatch(event,args)};_public.off=function(eventString,handler,id){var event=_handlers[eventString];if(utils.isEmpty(event)||utils.isEmpty(event.que)&&utils.isEmpty(event[id])){return}if(id&&(utils.isEmpty(event[id])||utils.isEmpty(event[id].que))){return}if(id){utils._each(event[id].que,function(_handler){var que=event[id].que;if(_handler===handler){que.splice(utils.indexOf.call(que,_handler),1)}})}else{utils._each(event.que,function(_handler){var que=event.que;if(_handler===handler){que.splice(utils.indexOf.call(que,_handler),1)}})}_handlers[eventString]=event};_public.get=function(){return _handlers};_public.getEvents=function(){var arrayCopy=[];utils._each(eventsFired,function(value){var newProp=utils.extend({},value);arrayCopy.push(newProp)});return arrayCopy};return _public}()},function(module,exports,__webpack_require__){"use strict";var _utils=__webpack_require__(2);var CONSTANTS=__webpack_require__(3);var utils=__webpack_require__(2);var adloader=__webpack_require__(10);var bidmanager=__webpack_require__(11);var bidfactory=__webpack_require__(13);var Adapter=__webpack_require__(14);var AppNexusAdapter;AppNexusAdapter=function AppNexusAdapter(){var baseAdapter=Adapter.createNew("appnexus");var usersync=false;baseAdapter.callBids=function(params){var anArr=params.bids;for(var i=0;i<anArr.length;i++){var bidRequest=anArr[i];var callbackId=bidRequest.bidId;adloader.loadScript(buildJPTCall(bidRequest,callbackId))}};function buildJPTCall(bid,callbackId){var placementId=utils.getBidIdParameter("placementId",bid.params);var memberId=utils.getBidIdParameter("memberId",bid.params);var member=utils.getBidIdParameter("member",bid.params);var inventoryCode=utils.getBidIdParameter("invCode",bid.params);var query=utils.getBidIdParameter("query",bid.params);var referrer=utils.getBidIdParameter("referrer",bid.params);var altReferrer=utils.getBidIdParameter("alt_referrer",bid.params);var jptCall="http"+(document.location.protocol==="https:"?"s://secure.adnxs.com/jpt?":"://ib.adnxs.com/jpt?");jptCall=utils.tryAppendQueryString(jptCall,"callback","pbjs.handleAnCB");jptCall=utils.tryAppendQueryString(jptCall,"callback_uid",callbackId);jptCall=utils.tryAppendQueryString(jptCall,"psa","0");jptCall=utils.tryAppendQueryString(jptCall,"id",placementId);if(member){jptCall=utils.tryAppendQueryString(jptCall,"member",member)}else if(memberId){jptCall=utils.tryAppendQueryString(jptCall,"member",memberId);utils.logMessage('appnexus.callBids: "memberId" will be deprecated soon. Please use "member" instead')}jptCall=utils.tryAppendQueryString(jptCall,"code",inventoryCode);var sizeQueryString="";var parsedSizes=utils.parseSizesInput(bid.sizes);var parsedSizesLength=parsedSizes.length;if(parsedSizesLength>0){sizeQueryString="size="+parsedSizes[0];if(parsedSizesLength>1){sizeQueryString+="&promo_sizes=";for(var j=1;j<parsedSizesLength;j++){sizeQueryString+=parsedSizes[j]+=","}if(sizeQueryString&&sizeQueryString.charAt(sizeQueryString.length-1)===","){sizeQueryString=sizeQueryString.slice(0,sizeQueryString.length-1)}}}if(sizeQueryString){jptCall+=sizeQueryString+"&"}var targetingParams=utils.parseQueryStringParameters(query);if(targetingParams){jptCall+=targetingParams}var paramsCopy=utils.extend({},bid.params);delete paramsCopy.placementId;delete paramsCopy.memberId;delete paramsCopy.invCode;delete paramsCopy.query;delete paramsCopy.referrer;delete paramsCopy.alt_referrer;delete paramsCopy.member;var queryParams=utils.parseQueryStringParameters(paramsCopy);if(queryParams){jptCall+=queryParams}if(referrer===""){referrer=utils.getTopWindowUrl()}jptCall=utils.tryAppendQueryString(jptCall,"referrer",referrer);jptCall=utils.tryAppendQueryString(jptCall,"alt_referrer",altReferrer);if(jptCall.lastIndexOf("&")===jptCall.length-1){jptCall=jptCall.substring(0,jptCall.length-1)}utils.logMessage("jpt request built: "+jptCall);bid.startTime=(new Date).getTime();return jptCall}pbjs.handleAnCB=function(jptResponseObj){var bidCode;if(jptResponseObj&&jptResponseObj.callback_uid){var responseCPM;var id=jptResponseObj.callback_uid;var placementCode="";var bidObj=(0,_utils.getBidRequest)(id);if(bidObj){bidCode=bidObj.bidder;placementCode=bidObj.placementCode;bidObj.status=CONSTANTS.STATUS.GOOD}utils.logMessage("JSONP callback function called for ad ID: "+id);var bid=[];if(jptResponseObj.result&&jptResponseObj.result.cpm&&jptResponseObj.result.cpm!==0){responseCPM=parseInt(jptResponseObj.result.cpm,10);responseCPM=responseCPM/1e4;var adId=jptResponseObj.result.creative_id;bid=bidfactory.createBid(1,bidObj);bid.creative_id=adId;bid.bidderCode=bidCode;bid.cpm=responseCPM;bid.adUrl=jptResponseObj.result.ad;bid.width=jptResponseObj.result.width;bid.height=jptResponseObj.result.height;bid.dealId=jptResponseObj.result.deal_id;bidmanager.addBidResponse(placementCode,bid)}else{utils.logMessage("No prebid response from AppNexus for placement code "+placementCode);bid=bidfactory.createBid(2,bidObj);bid.bidderCode=bidCode;bidmanager.addBidResponse(placementCode,bid)}if(!usersync){var iframe=utils.createInvisibleIframe();iframe.src="//acdn.adnxs.com/ib/static/usersync/v3/async_usersync.html";try{document.body.appendChild(iframe)}catch(error){utils.logError(error)}usersync=true}}else{utils.logMessage("No prebid response for placement %%PLACEMENT%%")}};return{callBids:baseAdapter.callBids,setBidderCode:baseAdapter.setBidderCode,createNew:AppNexusAdapter.createNew,buildJPTCall:buildJPTCall}};AppNexusAdapter.createNew=function(){return new AppNexusAdapter};module.exports=AppNexusAdapter},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(2);var _requestCache={};exports.loadScript=function(tagSrc,callback,cacheRequest){if(!tagSrc){utils.logError("Error attempting to request empty URL","adloader.js:loadScript");return}if(cacheRequest){if(_requestCache[tagSrc]){if(callback&&typeof callback==="function"){if(_requestCache[tagSrc].loaded){callback()}else{_requestCache[tagSrc].callbacks.push(callback)}}}else{_requestCache[tagSrc]={loaded:false,callbacks:[]};if(callback&&typeof callback==="function"){_requestCache[tagSrc].callbacks.push(callback)}requestResource(tagSrc,function(){_requestCache[tagSrc].loaded=true;try{for(var i=0;i<_requestCache[tagSrc].callbacks.length;i++){_requestCache[tagSrc].callbacks[i]()}}catch(e){utils.logError("Error executing callback","adloader.js:loadScript",e)}})}}else{requestResource(tagSrc,callback)}};function requestResource(tagSrc,callback){var jptScript=document.createElement("script");jptScript.type="text/javascript";jptScript.async=true;if(callback&&typeof callback==="function"){if(jptScript.readyState){jptScript.onreadystatechange=function(){if(jptScript.readyState==="loaded"||jptScript.readyState==="complete"){jptScript.onreadystatechange=null;callback()}}}else{jptScript.onload=function(){callback()}}}jptScript.src=tagSrc;var elToAppend=document.getElementsByTagName("head");elToAppend=elToAppend.length?elToAppend:document.getElementsByTagName("body");if(elToAppend.length){elToAppend=elToAppend[0];elToAppend.insertBefore(jptScript,elToAppend.firstChild)}}exports.trackPixel=function(pixelUrl){var delimiter=void 0;var trackingPixel=void 0;if(!pixelUrl||typeof pixelUrl!=="string"){utils.logMessage("Missing or invalid pixelUrl.");return}delimiter=pixelUrl.indexOf("?")>0?"&":"?";trackingPixel=pixelUrl+delimiter+"rnd="+Math.floor(Math.random()*1e7);(new Image).src=trackingPixel;return trackingPixel}},function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _utils=__webpack_require__(2);var _cpmBucketManager=__webpack_require__(12);var CONSTANTS=__webpack_require__(3);var AUCTION_END=CONSTANTS.EVENTS.AUCTION_END;var utils=__webpack_require__(2);var events=__webpack_require__(8);var objectType_function="function";var externalCallbacks={byAdUnit:[],all:[],oneTime:null,timer:false};var _granularity=CONSTANTS.GRANULARITY_OPTIONS.MEDIUM;var _customPriceBucket=void 0;var defaultBidderSettingsMap={};exports.setCustomPriceBucket=function(customConfig){_customPriceBucket=customConfig};exports.getTimedOutBidders=function(){return pbjs._bidsRequested.map(getBidderCode).filter(_utils.uniques).filter(function(bidder){return pbjs._bidsReceived.map(getBidders).filter(_utils.uniques).indexOf(bidder)<0})};function timestamp(){return(new Date).getTime()}function getBidderCode(bidSet){return bidSet.bidderCode}function getBidders(bid){return bid.bidder}function bidsBackAdUnit(adUnitCode){var _this=this;var requested=pbjs._bidsRequested.map(function(request){return request.bids.filter(_utils.adUnitsFilter.bind(_this,pbjs._adUnitCodes)).filter(function(bid){return bid.placementCode===adUnitCode})}).reduce(_utils.flatten).map(function(bid){return bid.bidder==="indexExchange"?bid.sizes.length:1}).reduce(add,0);var received=pbjs._bidsReceived.filter(function(bid){return bid.adUnitCode===adUnitCode}).length;return requested===received}function add(a,b){return a+b}function bidsBackAll(){var requested=pbjs._bidsRequested.map(function(request){return request.bids}).reduce(_utils.flatten).filter(_utils.adUnitsFilter.bind(this,pbjs._adUnitCodes)).map(function(bid){return bid.bidder==="indexExchange"?bid.sizes.length:1}).reduce(function(a,b){return a+b},0);var received=pbjs._bidsReceived.filter(_utils.adUnitsFilter.bind(this,pbjs._adUnitCodes)).length;return requested===received}exports.bidsBackAll=function(){return bidsBackAll()};function getBidderRequest(bidder,adUnitCode){return pbjs._bidsRequested.find(function(request){return request.bids.filter(function(bid){return bid.bidder===bidder&&bid.placementCode===adUnitCode}).length>0})||{start:null,requestId:null}}exports.addBidResponse=function(adUnitCode,bid){if(bid){var _getBidderRequest=getBidderRequest(bid.bidderCode,adUnitCode),requestId=_getBidderRequest.requestId,start=_getBidderRequest.start;_extends(bid,{requestId:requestId,responseTimestamp:timestamp(),requestTimestamp:start,cpm:bid.cpm||0,bidder:bid.bidderCode,adUnitCode:adUnitCode});bid.timeToRespond=bid.responseTimestamp-bid.requestTimestamp;if(bid.timeToRespond>pbjs.cbTimeout+pbjs.timeoutBuffer){var timedOut=true;exports.executeCallback(timedOut)}events.emit(CONSTANTS.EVENTS.BID_ADJUSTMENT,bid);events.emit(CONSTANTS.EVENTS.BID_RESPONSE,bid);var priceStringsObj=(0,_cpmBucketManager.getPriceBucketString)(bid.cpm,_customPriceBucket);bid.pbLg=priceStringsObj.low;bid.pbMg=priceStringsObj.med;bid.pbHg=priceStringsObj.high;bid.pbAg=priceStringsObj.auto;bid.pbDg=priceStringsObj.dense;bid.pbCg=priceStringsObj.custom;var keyValues={};if(bid.bidderCode&&(bid.cpm>0||bid.dealId)){keyValues=getKeyValueTargetingPairs(bid.bidderCode,bid);if(bid.dealId){keyValues["hb_deal_"+bid.bidderCode]=bid.dealId}}bid.adserverTargeting=keyValues;pbjs._bidsReceived.push(bid)}if(bid&&bid.adUnitCode&&bidsBackAdUnit(bid.adUnitCode)){triggerAdUnitCallbacks(bid.adUnitCode)}if(bidsBackAll()){exports.executeCallback()}};function getKeyValueTargetingPairs(bidderCode,custBidObj){var keyValues={};var bidder_settings=pbjs.bidderSettings;if(custBidObj&&bidder_settings){var standardSettings=getStandardBidderSettings();setKeys(keyValues,standardSettings,custBidObj)}if(bidderCode&&custBidObj&&bidder_settings&&bidder_settings[bidderCode]&&bidder_settings[bidderCode][CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING]){setKeys(keyValues,bidder_settings[bidderCode],custBidObj);custBidObj.alwaysUseBid=bidder_settings[bidderCode].alwaysUseBid;custBidObj.sendStandardTargeting=bidder_settings[bidderCode].sendStandardTargeting}else if(defaultBidderSettingsMap[bidderCode]){setKeys(keyValues,defaultBidderSettingsMap[bidderCode],custBidObj);custBidObj.alwaysUseBid=defaultBidderSettingsMap[bidderCode].alwaysUseBid;custBidObj.sendStandardTargeting=defaultBidderSettingsMap[bidderCode].sendStandardTargeting}return keyValues}exports.getKeyValueTargetingPairs=function(){return getKeyValueTargetingPairs.apply(undefined,arguments)};function setKeys(keyValues,bidderSettings,custBidObj){var targeting=bidderSettings[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING];custBidObj.size=custBidObj.getSize();utils._each(targeting,function(kvPair){var key=kvPair.key;var value=kvPair.val;if(keyValues[key]){utils.logWarn("The key: "+key+" is getting ovewritten")}if(utils.isFn(value)){try{value=value(custBidObj)}catch(e){utils.logError("bidmanager","ERROR",e)}}if(typeof bidderSettings.suppressEmptyKeys!=="undefined"&&bidderSettings.suppressEmptyKeys===true&&(utils.isEmptyStr(value)||value===null||value===undefined)){utils.logInfo("suppressing empty key '"+key+"' from adserver targeting")}else{keyValues[key]=value}});return keyValues}exports.setPriceGranularity=function setPriceGranularity(granularity){var granularityOptions=CONSTANTS.GRANULARITY_OPTIONS;if(Object.keys(granularityOptions).filter(function(option){return granularity===granularityOptions[option]})){_granularity=granularity}else{utils.logWarn("Prebid Warning: setPriceGranularity was called with invalid setting, using"+" `medium` as default.");_granularity=CONSTANTS.GRANULARITY_OPTIONS.MEDIUM}};exports.registerDefaultBidderSetting=function(bidderCode,defaultSetting){defaultBidderSettingsMap[bidderCode]=defaultSetting};exports.executeCallback=function(timedOut){if(!timedOut&&externalCallbacks.timer){clearTimeout(externalCallbacks.timer)}if(externalCallbacks.all.called!==true){processCallbacks(externalCallbacks.all);externalCallbacks.all.called=true;if(timedOut){var timedOutBidders=exports.getTimedOutBidders();if(timedOutBidders.length){events.emit(CONSTANTS.EVENTS.BID_TIMEOUT,timedOutBidders)}}}if(externalCallbacks.oneTime){events.emit(AUCTION_END);try{processCallbacks([externalCallbacks.oneTime])}finally{externalCallbacks.oneTime=null;externalCallbacks.timer=false;pbjs.clearAuction()}}};exports.externalCallbackReset=function(){externalCallbacks.all.called=false};function triggerAdUnitCallbacks(adUnitCode){var singleAdUnitCode=[adUnitCode];processCallbacks(externalCallbacks.byAdUnit,singleAdUnitCode)}function processCallbacks(callbackQueue,singleAdUnitCode){var _this2=this;if(utils.isArray(callbackQueue)){callbackQueue.forEach(function(callback){var adUnitCodes=singleAdUnitCode||pbjs._adUnitCodes;var bids=[pbjs._bidsReceived.filter(_utils.adUnitsFilter.bind(_this2,adUnitCodes)).reduce(groupByPlacement,{})];callback.apply(pbjs,bids)})}}function groupByPlacement(prev,item,idx,arr){if(item.adUnitCode in Object.keys(prev)){return prev}else{prev[item.adUnitCode]={bids:arr.filter(function(bid){return bid.adUnitCode===item.adUnitCode})};return prev}}exports.addOneTimeCallback=function(callback,timer){externalCallbacks.oneTime=callback;externalCallbacks.timer=timer};exports.addCallback=function(id,callback,cbEvent){callback.id=id;if(CONSTANTS.CB.TYPE.ALL_BIDS_BACK===cbEvent){externalCallbacks.all.push(callback)}else if(CONSTANTS.CB.TYPE.AD_UNIT_BIDS_BACK===cbEvent){externalCallbacks.byAdUnit.push(callback)}};events.on(CONSTANTS.EVENTS.BID_ADJUSTMENT,function(bid){adjustBids(bid)});function adjustBids(bid){var code=bid.bidderCode;var bidPriceAdjusted=bid.cpm;if(code&&pbjs.bidderSettings&&pbjs.bidderSettings[code]){if(_typeof(pbjs.bidderSettings[code].bidCpmAdjustment)===objectType_function){try{bidPriceAdjusted=pbjs.bidderSettings[code].bidCpmAdjustment.call(null,bid.cpm,utils.extend({},bid))}catch(e){utils.logError("Error during bid adjustment","bidmanager.js",e)}}}if(bidPriceAdjusted>=0){bid.cpm=bidPriceAdjusted}}exports.adjustBids=function(){return adjustBids.apply(undefined,arguments)};function getStandardBidderSettings(){var bidder_settings=pbjs.bidderSettings;if(!bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD]){bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD]={adserverTargeting:[{key:"hb_bidder",val:function val(bidResponse){return bidResponse.bidderCode}},{key:"hb_adid",val:function val(bidResponse){return bidResponse.adId}},{key:"hb_pb",val:function val(bidResponse){if(_granularity===CONSTANTS.GRANULARITY_OPTIONS.AUTO){return bidResponse.pbAg}else if(_granularity===CONSTANTS.GRANULARITY_OPTIONS.DENSE){return bidResponse.pbDg}else if(_granularity===CONSTANTS.GRANULARITY_OPTIONS.LOW){return bidResponse.pbLg}else if(_granularity===CONSTANTS.GRANULARITY_OPTIONS.MEDIUM){return bidResponse.pbMg}else if(_granularity===CONSTANTS.GRANULARITY_OPTIONS.HIGH){return bidResponse.pbHg}else if(_granularity===CONSTANTS.GRANULARITY_OPTIONS.CUSTOM){return bidResponse.pbCg}}},{key:"hb_size",val:function val(bidResponse){return bidResponse.size}}]}}return bidder_settings[CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD]}function getStandardBidderAdServerTargeting(){return getStandardBidderSettings()[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING]}exports.getStandardBidderAdServerTargeting=getStandardBidderAdServerTargeting},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defaultPrecision=2;var _lgPriceConfig={buckets:[{min:0,max:5,increment:.5}]};var _mgPriceConfig={buckets:[{min:0,max:20,increment:.1}]};var _hgPriceConfig={buckets:[{min:0,max:20,increment:.01}]};var _densePriceConfig={buckets:[{min:0,max:3,increment:.01},{min:3,max:8,increment:.05},{min:8,max:20,increment:.5}]};var _autoPriceConfig={buckets:[{min:0,max:5,increment:.05},{min:5,max:10,increment:.1},{min:10,max:20,increment:.5}]};function getPriceBucketString(cpm,customConfig){var cpmFloat=0;cpmFloat=parseFloat(cpm);if(isNaN(cpmFloat)){cpmFloat=""}return{low:cpmFloat===""?"":getCpmStringValue(cpm,_lgPriceConfig),med:cpmFloat===""?"":getCpmStringValue(cpm,_mgPriceConfig),high:cpmFloat===""?"":getCpmStringValue(cpm,_hgPriceConfig),auto:cpmFloat===""?"":getCpmStringValue(cpm,_autoPriceConfig),dense:cpmFloat===""?"":getCpmStringValue(cpm,_densePriceConfig),custom:cpmFloat===""?"":getCpmStringValue(cpm,customConfig)}}function getCpmStringValue(cpm,config){var cpmStr="";if(!isValidePriceConfig(config)){return cpmStr}var cap=config.buckets.reduce(function(prev,curr){if(prev.max>curr.max){return prev}return curr},{max:0});var bucket=config.buckets.find(function(bucket){if(cpm>cap.max){var precision=bucket.precision||_defaultPrecision;cpmStr=bucket.max.toFixed(precision)}else if(cpm<=bucket.max&&cpm>=bucket.min){return bucket}});if(bucket){cpmStr=getCpmTarget(cpm,bucket.increment,bucket.precision)}return cpmStr}function isValidePriceConfig(config){if(!config||!config.buckets||!Array.isArray(config.buckets)){return false}var isValid=true;config.buckets.forEach(function(bucket){if(typeof bucket.min==="undefined"||!bucket.max||!bucket.increment){isValid=false}});return isValid}function getCpmTarget(cpm,increment,precision){if(!precision){precision=_defaultPrecision}var bucketSize=1/increment;return(Math.floor(cpm*bucketSize)/bucketSize).toFixed(precision)}exports.getPriceBucketString=getPriceBucketString;exports.isValidePriceConfig=isValidePriceConfig},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(2);function Bid(statusCode,bidRequest){var _bidId=bidRequest&&bidRequest.bidId||utils.getUniqueIdentifierStr();var _statusCode=statusCode||0;this.bidderCode="";this.width=0;this.height=0;this.statusMessage=_getStatus();this.adId=_bidId;function _getStatus(){switch(_statusCode){case 0:return"Pending";case 1:return"Bid available";case 2:return"Bid returned empty or error response";case 3:return"Bid timed out"}}this.getStatusCode=function(){return _statusCode};this.getSize=function(){return this.width+"x"+this.height}}exports.createBid=function(){return new(Function.prototype.bind.apply(Bid,[null].concat(Array.prototype.slice.call(arguments))))}},function(module,exports){"use strict";function Adapter(code){var bidderCode=code;function setBidderCode(code){bidderCode=code}function getBidderCode(){return bidderCode}function callBids(){}return{callBids:callBids,setBidderCode:setBidderCode,getBidderCode:getBidderCode}}exports.createNew=function(bidderCode){return new Adapter(bidderCode)}},function(module,exports,__webpack_require__){"use strict";var events=__webpack_require__(8);var bidmanager=__webpack_require__(11);var bidfactory=__webpack_require__(13);var utils=__webpack_require__(2);var CONSTANTS=__webpack_require__(3);var AudienceNetworkAdapter=function AudienceNetworkAdapter(){"use strict";function _callBids(params){if(!params.bids&&params.bids[0]){return}var getPlacementSize=function getPlacementSize(bid){var warn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var adWidth=0,adHeight=0;var sizes=bid.sizes||{};if(sizes.length===2&&typeof sizes[0]==="number"&&typeof sizes[1]==="number"){adWidth=sizes[0];adHeight=sizes[1]}else if(sizes.length>=1){adWidth=sizes[0][0];adHeight=sizes[0][1];if(warn&&sizes.length>1){utils.logInfo("AudienceNetworkAdapter supports only one size per "+("impression, but "+sizes.length+" sizes passed for ")+("placementId "+bid.params.placementId+". Using first only."))}}return{height:adHeight,width:adWidth}};var getPlacementWebAdFormat=function getPlacementWebAdFormat(bid){if(bid.params.native){return"native"}if(bid.params.fullwidth){return"fullwidth"}var size=getPlacementSize(bid);if(size.width===320&&size.height===50||size.width===300&&size.height===250||size.width===728&&size.height===90){return size.width+"x"+size.height}};var url="https://an.facebook.com/v2/placementbid.json?sdk=5.3.web&";var wwwExperimentChance=Number(params.bids[0].params.wwwExperiment);if(wwwExperimentChance>0&&wwwExperimentChance<=100&&Math.floor(Math.random()*wwwExperimentChance)===0){url=url.replace("an.facebook.com","www.facebook.com/an")}var adPlacementIdToBidMap=new Map;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=params.bids[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var pbjsBidReq=_step.value;if(adPlacementIdToBidMap[pbjsBidReq.params.placementId]===undefined){adPlacementIdToBidMap[pbjsBidReq.params.placementId]=[]}adPlacementIdToBidMap[pbjsBidReq.params.placementId].push(pbjsBidReq);url+="placementids[]="+encodeURIComponent(pbjsBidReq.params.placementId)+"&"+("adformats[]="+encodeURIComponent(getPlacementWebAdFormat(pbjsBidReq))+"&")}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}if(params.bids[0].params.testMode){url+="testmode=true&"}var http=new HttpClient;var requestTimeMS=(new Date).getTime();http.get(url,function(response){var placementIDArr=[];var anBidRequestId=response.request_id;for(var placementId in adPlacementIdToBidMap){var anBidArr=response.bids[placementId];var anBidReqArr=adPlacementIdToBidMap[placementId];for(var idx=0;idx<anBidReqArr.length;idx++){var pbjsBid=anBidReqArr[idx];if(anBidArr===null||anBidArr===undefined||anBidArr[idx]===null||anBidArr[idx]===undefined){var noResponseBidObject=bidfactory.createBid(2);noResponseBidObject.bidderCode=params.bidderCode;bidmanager.addBidResponse(pbjsBid.placementCode,noResponseBidObject);continue}var anBid=anBidArr[idx];var bidObject=bidfactory.createBid(1);bidObject.bidderCode=params.bidderCode;bidObject.cpm=anBid.bid_price_cents/100;var size=getPlacementSize(pbjsBid);bidObject.width=size.width;bidObject.height=size.height;bidObject.fbBidId=anBid.bid_id;bidObject.fbPlacementId=placementId;placementIDArr.push(placementId);bidObject.fbFormat=getPlacementWebAdFormat(pbjsBid);if(getPlacementWebAdFormat(pbjsBid)==="native"){bidObject.ad='\n          <html>\n            <head>\n              <script type="text/javascript">\n                window.onload = function() {\n                    if (parent) {\n                        var oHead = document.getElementsByTagName("head")[0];\n                        var arrStyleSheets = parent.document.getElementsByTagName("style");\n                        for (var i = 0; i < arrStyleSheets.length; i++)\n                            oHead.appendChild(arrStyleSheets[i].cloneNode(true));\n                    }\n                }\n              </scr"+"ipt>\n            </head>\n            <body>\n              <div style="display:none; position: relative;">\n                <iframe style="display:none;"></iframe>\n                <script type="text/javascript">\n                  var data = {\n                    placementid: \''+placementId+"',\n                    bidid: '"+anBid.bid_id+"',\n                    format: 'native',\n                    testmode: false,\n                    onAdLoaded: function(element) {\n                      console.log('Audience Network ["+placementId+"] ad loaded');\n                      element.style.display = 'block';\n                    },\n                    onAdError: function(errorCode, errorMessage) {\n                      console.log('Audience Network ["+placementId+"] error (' + errorCode + ') ' + errorMessage);\n                    }\n                  };\n                  (function(w,l,d,t){var a=t();var b=d.currentScript||(function(){var c=d.getElementsByTagName('script');return c[c.length-1];})();var e=b.parentElement;e.dataset.placementid=data.placementid;var f=function(v){try{return v.document.referrer;}catch(e){}return'';};var g=function(h){var i=h.indexOf('/',h.indexOf('://')+3);if(i===-1){return h;}return h.substring(0,i);};var j=[l.href];var k=false;var m=false;if(w!==w.parent){var n;var o=w;while(o!==n){var h;try{m=m||(o.$sf&&o.$sf.ext);h=o.location.href;}catch(e){k=true;}j.push(h||f(n));n=o;o=o.parent;}}var p=l.ancestorOrigins;if(p){if(p.length>0){data.domain=p[p.length-1];}else{data.domain=g(j[j.length-1]);}}data.url=j[j.length-1];data.channel=g(j[0]);data.width=screen.width;data.height=screen.height;data.pixelratio=w.devicePixelRatio;data.placementindex=w.ADNW&&w.ADNW.Ads?w.ADNW.Ads.length:0;data.crossdomain=k;data.safeframe=!!m;var q={};q.iframe=e.firstElementChild;var r='https://www.facebook.com/audiencenetwork/web/?sdk=5.3';for(var s in data){q[s]=data[s];if(typeof(data[s])!=='function'){r+='&'+s+'='+encodeURIComponent(data[s]);}}q.iframe.src=r;q.tagJsInitTime=a;q.rootElement=e;q.events=[];w.addEventListener('message',function(u){if(u.source!==q.iframe.contentWindow){return;}u.data.receivedTimestamp=t();if(this.sdkEventHandler){this.sdkEventHandler(u.data);}else{this.events.push(u.data);}}.bind(q),false);q.tagJsIframeAppendedTime=t();w.ADNW=w.ADNW||{};w.ADNW.Ads=w.ADNW.Ads||[];w.ADNW.Ads.push(q);w.ADNW.init&&w.ADNW.init(q);})(window,location,document,Date.now||function(){return+new Date;});\n                </scr"+"ipt>\n                <script type=\"text/javascript\" src=\"https://connect.facebook.net/en_US/fbadnw.js\" async></scr"+"ipt>\n                <div class=\"thirdPartyRoot\">\n                  <a class=\"fbAdLink\">\n                    <div class=\"fbAdMedia thirdPartyMediaClass\"></div>\n                    <div class=\"fbAdSubtitle thirdPartySubtitleClass\"></div>\n                    <div class=\"fbDefaultNativeAdWrapper\">\n                      <div class=\"fbAdCallToAction thirdPartyCallToActionClass\"></div>\n                      <div class=\"fbAdTitle thirdPartyTitleClass\"></div>\n                    </div>\n                  </a>\n                </div>\n              </div>\n            </body>\n          </html>";

}else{bidObject.ad='\n         <html>\n           <body>\n             <div style="display:none; position: relative;">\n               <iframe style="display:none;"></iframe>\n               <script type="text/javascript">\n                 var data = {\n                   placementid: \''+placementId+"',\n                   format: '"+size.width+"x"+size.height+"',\n                   bidid: '"+anBid.bid_id+"',\n                   testmode: false,\n                   onAdLoaded: function(element) {\n                     console.log('Audience Network ["+placementId+"] ad loaded');\n                     element.style.display = 'block';\n                   },\n                   onAdError: function(errorCode, errorMessage) {\n                     console.log('Audience Network ["+placementId+"] error (' + errorCode + ') ' + errorMessage);\n                   }\n                 };\n                 (function(w,l,d,t){var a=t();var b=d.currentScript||(function(){var c=d.getElementsByTagName('script');return c[c.length-1];})();var e=b.parentElement;e.dataset.placementid=data.placementid;var f=function(v){try{return v.document.referrer;}catch(e){}return'';};var g=function(h){var i=h.indexOf('/',h.indexOf('://')+3);if(i===-1){return h;}return h.substring(0,i);};var j=[l.href];var k=false;var m=false;if(w!==w.parent){var n;var o=w;while(o!==n){var h;try{m=m||(o.$sf&&o.$sf.ext);h=o.location.href;}catch(e){k=true;}j.push(h||f(n));n=o;o=o.parent;}}var p=l.ancestorOrigins;if(p){if(p.length>0){data.domain=p[p.length-1];}else{data.domain=g(j[j.length-1]);}}data.url=j[j.length-1];data.channel=g(j[0]);data.width=screen.width;data.height=screen.height;data.pixelratio=w.devicePixelRatio;data.placementindex=w.ADNW&&w.ADNW.Ads?w.ADNW.Ads.length:0;data.crossdomain=k;data.safeframe=!!m;var q={};q.iframe=e.firstElementChild;var r='https://www.facebook.com/audiencenetwork/web/?sdk=5.3';for(var s in data){q[s]=data[s];if(typeof(data[s])!=='function'){r+='&'+s+'='+encodeURIComponent(data[s]);}}q.iframe.src=r;q.tagJsInitTime=a;q.rootElement=e;q.events=[];w.addEventListener('message',function(u){if(u.source!==q.iframe.contentWindow){return;}u.data.receivedTimestamp=t();if(this.sdkEventHandler){this.sdkEventHandler(u.data);}else{this.events.push(u.data);}}.bind(q),false);q.tagJsIframeAppendedTime=t();w.ADNW=w.ADNW||{};w.ADNW.Ads=w.ADNW.Ads||[];w.ADNW.Ads.push(q);w.ADNW.init&&w.ADNW.init(q);})(window,location,document,Date.now||function(){return+new Date;});\n               </scr"+"ipt>\n               <script type=\"text/javascript\" src=\"https://connect.facebook.net/en_US/fbadnw.js\" async></scr"+"ipt>\n             </div>\n           </body>\n         </html>"}bidmanager.addBidResponse(pbjsBid.placementCode,bidObject)}}var responseTimeMS=(new Date).getTime();var bidLatencyMS=responseTimeMS-requestTimeMS;var latencySincePageLoad=responseTimeMS-performance.timing.navigationStart;var existingEvents=events.getEvents();var timeout=existingEvents.some(function(event){return event.args&&event.eventType===CONSTANTS.EVENTS.BID_TIMEOUT&&event.args.bidderCode===params.bidderCode});var latencyUrl="https://an.facebook.com/placementbidlatency.json?";latencyUrl+="bid_request_id="+anBidRequestId;latencyUrl+="&latency_ms="+bidLatencyMS.toString();latencyUrl+="&bid_returned_time_since_page_load_ms="+latencySincePageLoad.toString();latencyUrl+="&timeout="+timeout.toString();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=placementIDArr[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var placement_id=_step2.value;latencyUrl+="&placement_ids[]="+placement_id}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}var httpRequest=new XMLHttpRequest;httpRequest.open("GET",latencyUrl,true);httpRequest.withCredentials=true;httpRequest.send(null)})}var HttpClient=function HttpClient(){this.get=function(aUrl,aCallback){var anHttpRequest=new XMLHttpRequest;anHttpRequest.onreadystatechange=function(){if(anHttpRequest.readyState===4&&anHttpRequest.status===200){var resp=JSON.parse(anHttpRequest.responseText);utils.logInfo("ANAdapter: "+aUrl+" ==> "+JSON.stringify(resp));aCallback(resp)}};anHttpRequest.open("GET",aUrl,true);anHttpRequest.withCredentials=true;anHttpRequest.send(null)}};return{callBids:_callBids}};module.exports=AudienceNetworkAdapter},function(module,exports){"use strict";if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function value(predicate){if(this===null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0;i<length;i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return value}}return undefined}})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function value(searchElement){var O=Object(this);var len=parseInt(O.length,10)||0;if(len===0){return false}var n=parseInt(arguments[1],10)||0;var k;if(n>=0){k=n}else{k=len+n;if(k<0){k=0}}var currentElement;while(k<len){currentElement=O[k];if(searchElement===currentElement||searchElement!==searchElement&&currentElement!==currentElement){return true}k++}return false}})}Number.isInteger=Number.isInteger||function(value){return typeof value==="number"&&isFinite(value)&&Math.floor(value)===value}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.parseQS=parseQS;exports.formatQS=formatQS;exports.parse=parse;exports.format=format;function parseQS(query){return!query?{}:query.replace(/^\?/,"").split("&").reduce(function(acc,criteria){var _criteria$split=criteria.split("="),_criteria$split2=_slicedToArray(_criteria$split,2),k=_criteria$split2[0],v=_criteria$split2[1];if(/\[\]$/.test(k)){k=k.replace("[]","");acc[k]=acc[k]||[];acc[k].push(v)}else{acc[k]=v||""}return acc},{})}function formatQS(query){return Object.keys(query).map(function(k){return Array.isArray(query[k])?query[k].map(function(v){return k+"[]="+v}).join("&"):k+"="+query[k]}).join("&")}function parse(url){var parsed=document.createElement("a");parsed.href=decodeURIComponent(url);return{protocol:(parsed.protocol||"").replace(/:$/,""),hostname:parsed.hostname,port:+parsed.port,pathname:parsed.pathname,search:parseQS(parsed.search||""),hash:(parsed.hash||"").replace(/^#/,""),host:parsed.host}}function format(obj){return(obj.protocol||"http")+"://"+(obj.host||obj.hostname+(obj.port?":"+obj.port:""))+(obj.pathname||"")+(obj.search?"?"+formatQS(obj.search||""):"")+(obj.hash?"#"+obj.hash:"")}},function(module,exports,__webpack_require__){"use strict";var _url=__webpack_require__(17);var AdServer=function AdServer(attr){this.name=attr.adserver;this.code=attr.code;this.getWinningBidByCode=function(){var _this=this;var bidObject=pbjs._bidsReceived.find(function(bid){return bid.adUnitCode===_this.code});return bidObject}};exports.dfpAdserver=function(options,urlComponents){var adserver=new AdServer(options);adserver.urlComponents=urlComponents;var dfpReqParams={env:"vp",gdfp_req:"1",impl:"s",unviewed_position_start:"1"};var dfpParamsWithVariableValue=["output","iu","sz","url","correlator","description_url","hl"];var getCustomParams=function getCustomParams(targeting){return encodeURIComponent((0,_url.formatQS)(targeting))};adserver.appendQueryParams=function(){var bid=adserver.getWinningBidByCode();this.urlComponents.search.description_url=encodeURIComponent(bid.vastUrl);this.urlComponents.search.cust_params=getCustomParams(bid.adserverTargeting);this.urlComponents.correlator=Date.now()};adserver.verifyAdserverTag=function(){for(var key in dfpReqParams){if(!this.urlComponents.search.hasOwnProperty(key)||this.urlComponents.search[key]!==dfpReqParams[key]){return false}}for(var i in dfpParamsWithVariableValue){if(!this.urlComponents.search.hasOwnProperty(dfpParamsWithVariableValue[i])){return false}}return true};return adserver}}])},{}],2:[function(require,module,exports){(function(global){"use strict";var _AdsRefresher=require("./ads-tracking/AdsRefresher");var _AdsRefresher2=_interopRequireDefault(_AdsRefresher);var _MessageBroker=require("./ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var adListLoader=require("../src/ads-loading/AdListLoader.js");var adsTrackers=require("../src/ads-tracking/AdsTrackers.js");var adsDescriptions=require("./ads-loading/conf/AdsDescriptions.js");var _require=require("./ads-rendering/renderedAds.js"),onRendered=_require.on,getRendered=_require.getRendered;var tooSmall=false;var pushdown=false;var ccSiteWidths={UK:1252,US:1332};var requestedAds=[];var adArr=[];var testSize=function testSize(cc){if(!tooSmall){var rightAdContainer=document.getElementById("js-sky-right");var leftAdContainer=document.getElementById("js-sky-left");if(!rightAdContainer&&!leftAdContainer){return}if(miniDom.getPageSize()[0]<ccSiteWidths[cc]){tooSmall=true}else{if(rightAdContainer){rightAdContainer.style.display="block"}if(leftAdContainer){leftAdContainer.style.display="block"}}}return tooSmall};var isFFF=function(){var fffInlineModuleId="62032338";var isFFFCached=void 0;return function(){if(typeof isFFFCached==="undefined"){isFFFCached=false;if(window.inlineModules){var inlines=window.inlineModules.split(/\s+/);for(var i=0;i<inlines.length;i++){if(inlines[i]===fffInlineModuleId){isFFFCached=true;break}}}}return isFFFCached}}();function getScriptContainer(){return _.filter(document.documentElement.childNodes,function(element){return element.nodeType===1})[0]||document.body}function getAdContainer(ad){var scripts=document.scripts;var adContainer=ad.id&&document.getElementById(ad.id);if(!adContainer){var parent=scripts[scripts.length-1].parentNode;var id=ad.pos+"_"+(new Date).getTime();if(parent===document.body){document.write('<div id="'+id+'"></div>');var item=document.getElementById(id);if(item){adContainer=item.parentNode;adContainer.removeChild(item)}else{adContainer=document.body}}else{adContainer=parent}}return adContainer}var postbox=_MessageBroker2.default.postbox("AdsManager");var googletag=global.googletag=global.googletag||{};googletag.cmd=googletag.cmd||[];postbox.on("system ready",function(){return googletag.cmd.push(function(){return postbox.emit("gtp loaded")})});var adsRefresher=new _AdsRefresher2.default;postbox.on("slot defined",function(ad){ad.pos=ad.pos==="interstitial"||ad.pos==="fff"?ad.id:ad.pos;_.extend(ad,adsDescriptions.get(ad.pos)||{});ad=adsDescriptions.overrideAdWithCljAdmConfiguration(ad);if(ad.pos.slice(0,7)==="native_"&&ad.pos!=="native_fff_overlay_accessorise"&&ad.pos!=="native_fff_accessorise"){ad.pos=ad.pos+"_dfp";ad.type="2x2"}ad.extraZoneOptions=ad.extraZoneOptions||{};if(isFFF()){ad.extraZoneOptions.fff=true}var adContainer=getAdContainer(ad);if(!adContainer.id)adContainer.id=ad.id||ad.pos+"_"+(new Date).getTime();ad.parentId=adContainer.id;requestedAds.push(ad);adsDescriptions.update(ad.pos,ad);if(adListLoader.isAdEnabled(ad)){if(ad.wide){if(!testSize(DM.adsCC||"UK")){postbox.emit("slot ready",ad)}}else{postbox.emit("slot ready",ad)}}});_.extend(exports,{getScriptContainer:getScriptContainer,setStickyBannerZoomThresholds:function setStickyBannerZoomThresholds(ipad,iphone){},requestSlotConfig:adListLoader.requestSlotConfig,initEmergencyRules:adListLoader.initEmergencyRules,initSlots:function initSlots(slotsConfig){var switchConfig=void 0;try{switchConfig=window.adTrackingConfig.geoConfig[window.PageCriteria.geo].filter(function(e){return e.name==="switch"})[0]}catch(e){}if(!switchConfig){switchConfig=window.adTrackingConfig.geoConfig.default.filter(function(e){return e.name==="switch"})[0]}if(switchConfig&&switchConfig.enabled){var switchWrapper=require("./ads-tracking/wrappers/switch.js");switchWrapper.init()}adListLoader.initSlots(slotsConfig);adsRefresher.init()},stopRefreshingAds:function stopRefreshingAds(){return adsRefresher.stop()},setSupportedSlots:adListLoader.setSupportedSlots,getRsiValues:adsTrackers.getRsiValues,addToArray:function addToArray(ad){postbox.emit("slot defined",ad)},getArray:function getArray(){return requestedAds},reg:function reg(id){adArr.push(id)},togglePushdown:function togglePushdown(expand){var element=document.getElementById("pushdown");if(element){if(arguments.length===0||expand!==pushdown){pushdown=arguments.length===0?!pushdown:expand;miniDom.animate(element,{height:pushdown?250:40})}}},init:function init(){if(!document.getElementById("content")){return}for(var i=0;i<adArr.length;i++){var adElement=document.getElementById(adArr[i]);var transferElement=document.getElementById(adArr[i]);var style=transferElement.getAttribute("style");adElement.className=transferElement.className;if(style){adElement.setAttribute("style",transferElement.getAttribute("style"))}}},show:function show(el,anim,height){if(!el){return}height=height||el._origHeight;anim?miniDom.animate(el,{height:parseInt(height,10)+"px"},.45,"ease-out"):el.style.height=parseInt(height,10)+"px";this.addClass("hdn");el.removeClass("js-collapsed")},requestGoogleAd:function requestGoogleAd(){var script=document.createElement("script");script.async=true;script.src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js";document.getElementsByTagName("head")[0].appendChild(script);global.adsbygoogle=global.adsbygoogle||[];global.adsbygoogle.push({})},requestBingAd:function requestBingAd(type){if(type==="sky"&&!adListLoader.isAdEnabled({pos:"search_engine_sky"}))return;adListLoader.loadScriptSync("//adsyndication.msn.com/delivery/getads.js")},q:function q(fn){return googletag.cmd.push(fn)},on:onRendered,getRendered:getRendered})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../src/ads-loading/AdListLoader.js":4,"../src/ads-tracking/AdsTrackers.js":23,"./ads-loading/conf/AdsDescriptions.js":6,"./ads-rendering/renderedAds.js":15,"./ads-tracking/AdsRefresher":21,"./ads-tracking/wrappers/switch.js":59,"./ads-utils/MessageBroker":64}],3:[function(require,module,exports){(function(global){"use strict";var _MessageBroker=require("./ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var adStickyConfig=window.adStickyConfig||{};var adListLoader=require("./ads-loading/AdListLoader.js");var adsRenderer=require("./ads-rendering/AdsRenderer.js");var AdImpression=require("./ads-utils/AdImpression.js");var _require=require("./dom"),onBodyAvailable=_require.onBodyAvailable;var postbox=_MessageBroker2.default.postbox("StickyBanner");function overrideStickyBannerStylesOnEvent(){var element=document.getElementById(adStickyConfig.banner.parentId);var stickyWrapper=element&&miniDom.closest(element,function(node){return miniDom.hasClass(node,adStickyConfig.miniDom.cssClass)});if(!element||!stickyWrapper)return;if(MobileUtils.isLandscape()||MobileUtils.getZoom()>1){element.style.display="none";stickyWrapper.style.paddingTop="0"}else{setTimeout(function(){var stickyBanner=element;var advertElement=miniDom.walk(stickyBanner.firstChild,function(node){return node&&node.nextSibling},function(node){return miniDom.isElement(node)&&(node.tagName==="IMG"||node.tagName==="DIV")});if(!advertElement){stickyWrapper.style.paddingTop="";stickyBanner.style.height=""}else{stickyBanner.style.display="block";stickyBanner.style.height="auto";var advertHeight=advertElement.offsetHeight;stickyBanner.style.height=advertHeight+"px";stickyWrapper.style.paddingTop=advertHeight+10+"px"}removeStickyBannerStyleOverrides();if(isStickyBannerVisible())registerStickyBannerImpression()},adStickyConfig.initStickySetTimeoutMs)}}function removeStickyBannerStyleOverrides(){var element=document.getElementById(adStickyConfig.banner.parentId);if(!element)return;miniDom.removeClass(element,adStickyConfig.miniDom.bannerOverrideCssClass);var stickyWrapper=miniDom.closest(element,function(node){return miniDom.hasClass(node,adStickyConfig.miniDom)});miniDom.removeClass(stickyWrapper,adStickyConfig.miniDom.pageOverrideCssClass)}function onImpressionRegistered(advert){advert.removeAttribute(AdImpression.DATA_IMPRESSION_URL)}var registerStickyBannerImpression=function registerStickyBannerImpression(){DM.later("DOM_READY",function(){isStickyBannerVisible()?AdImpression.registerImpression(document.getElementById(adStickyConfig.banner.parentId),onImpressionRegistered):setupStickyBannerImpressionEvents()})};function isStickyBannerVisible(){var sb=document.getElementById(adStickyConfig.banner.parentId);return sb?sb.style.display==="none"||sb.style.visibility==="hidden":false}function setupStickyBannerImpressionEvents(){miniDom.on(document.body,"orientationchange",function(){if(isStickyBannerVisible())registerStickyBannerImpression()},false)}function onOrientationChange(event){overrideStickyBannerStylesOnEvent(event)}function refreshMobileAdvertAfterHalfPageScroll(pos){if(adStickyConfig.stopStickyBannerRefresh)return;if(adListLoader.getEnabledRenderedSlots().indexOf(pos)<0)return;var scrollableContent=miniDom.getElementsByClassName(document,"scrollable-content")[0];var article=scrollableContent&&scrollableContent.getElementsByTagName("article")[0];var triggerPosition=article&&miniDom.getOffset(article).top+article.scrollHeight/2;function check(){var offset=Math.abs(miniDom.getOffset(article).top);if(offset>=triggerPosition){adsRenderer.refreshAdvert({pos:pos});document.removeEventListener("scroll",check);document.removeEventListener("touchmove",check)}}if(triggerPosition){miniDom.on(document,"scroll",check);miniDom.on(document,"touchmove",check)}}function onAdLoaded(event){var ad=event.slot?event.slot.molAd:{};if(ad.pos===adStickyConfig.banner.position&&ad.parentId===adStickyConfig.banner.id){toggleBanner(adStickyConfig.banner.toggleCssClassPrefix,!event.isEmpty);overrideStickyBannerStylesOnEvent()}}function affix(element,onOffset,offOffset,hooks,apiObject){if(!window.getComputedStyle)return;hooks=hooks||function(){};var OFF_CLASS="affix-off";var ON_CLASS="affix-on";var styles=window.getComputedStyle(element,null);var position=styles.getPropertyValue("position");var top=styles.getPropertyValue("top");var apiEnabled=!!adStickyConfig.stickyApiEnabled;var scrollingDisabled=apiEnabled&&apiObject&&apiObject.scrollingDisabled||false;var isOn=function isOn(){return miniDom.hasClass(element,ON_CLASS)};var isOff=function isOff(){return miniDom.hasClass(element,OFF_CLASS)};var handler={isOn:isOn,isOff:isOff,isActive:function isActive(){return isOn()||isOff()}};function on(){if(!handler.isOn()){miniDom.removeClass(element,OFF_CLASS);miniDom.addClass(element,ON_CLASS);element.style.position="fixed";element.style.top="0";hooks(handler)}}function off(){if(!handler.isOff()){miniDom.removeClass(element,ON_CLASS);miniDom.addClass(element,OFF_CLASS);element.style.position="absolute";element.style.top=offOffset+"px";hooks(handler)}}function cancel(){if(handler.isActive()){miniDom.removeClass(element,ON_CLASS);miniDom.removeClass(element,OFF_CLASS);element.style.position=position;element.style.top=top;hooks(handler)}}function check(){var offset=window.pageYOffset;if(!scrollingDisabled&&offOffset&&offOffset<offset){off()}else if(!scrollingDisabled&&onOffset<offset){on()}else{cancel()}}if(typeof apiObject!=="undefined"){apiObject.scrolling={on:function on(){if(apiEnabled){scrollingDisabled=false}},off:function off(){if(apiEnabled){scrollingDisabled=true;cancel()}}};apiObject.updateSettings=function(newOnOffset,newOffOffset,newHooks){if(typeof newOnOffset!=="undefined")onOffset=newOnOffset;if(typeof newOffOffset!=="undefined")offOffset=newOffOffset;if(typeof newHooks!=="undefined")hooks=newHooks;styles=window.getComputedStyle(element,null);styles.getPropertyValue("position");top=styles.getPropertyValue("top");check()}}miniDom.on(document,"scroll",check);check();return handler}function toggleBanner(prefix,enable){var on=prefix+"on";var off=prefix+"off";var body=document.documentElement;miniDom.removeClass(body,on+" "+off);miniDom.addClass(body,enable?on:off)}function initLeaderTop(){var prefix=adStickyConfig.leader.prefix;toggleBanner(prefix,false);if(adListLoader.isAdEnabled({pos:adStickyConfig.leader.position})){adsRenderer.addLoadListener(function(event){var ad=event.slot?event.slot.molAd:{};if(ad.pos===adStickyConfig.leader.position&&ad.parentId===adStickyConfig.leader.parentId){var element=document.getElementById(ad.parentId);toggleBanner(prefix,!event.isEmpty,element)}})}}function initStickyBanner(){if(adListLoader.isAdEnabled({pos:adStickyConfig.banner.position})){adsRenderer.addLoadListener(onAdLoaded);toggleBanner(false);onBodyAvailable(function(){miniDom.on(document.body,"orientationchange",onOrientationChange,false);miniDom.on(document.body,"touchend",function(){MobileUtils.onTouchEnd(overrideStickyBannerStylesOnEvent)},false);DM.later("DOM_READY",onOrientationChange);if(adStickyConfig.channels[PageCriteria.channel][PageCriteria.geo.toLowerCase()].autoRefreshBanner){DM.onDocReady(refreshMobileAdvertAfterHalfPageScroll.bind(null,adStickyConfig.banner.position))}registerStickyBannerImpression()})}}function initStickyRightSky(element){if(!window.getComputedStyle)return;var content=document.getElementById("content");if(!content)return;var elementStyles=window.getComputedStyle(element,null);var elementRight=parseInt(elementStyles.getPropertyValue("right"));var elementWidth=parseInt(elementStyles.getPropertyValue("width"));var contentStyles=window.getComputedStyle(content,null);var contentWidth=parseInt(contentStyles.getPropertyValue("width"));var gap=Math.abs(elementRight)-elementWidth;var contentTop=miniDom.getOffset(content).top;var offElement=document.getElementById("mpu_puff_20");var offPosition=offElement?miniDom.getOffset(offElement).top:contentTop+5e3;function position(handler){if(handler.isOn()){var left=miniDom.getOffset(content).left+contentWidth+gap;element.style.left=left+"px"}else if(handler.isOff()){element.style.left="auto";element.style.top=offPosition-contentTop+"px"}else{element.style.left="auto"}}var handler=affix(element,contentTop,offPosition,position);miniDom.on(window,"resize",_.debounce(function(){return position(handler)},300))}function initStickyLeftSky(element){if(!window.getComputedStyle)return;var content=document.getElementById("content");if(!content)return;var elementStyles=window.getComputedStyle(element,null);var elementLeft=parseInt(elementStyles.getPropertyValue("left"));var elementWidth=parseInt(elementStyles.getPropertyValue("width"));var gap=15;var contentTop=miniDom.getOffset(content).top;var offElement=document.getElementById("mpu_puff_20");var offPosition=offElement?miniDom.getOffset(offElement).top:contentTop+5e3;function position(handler){if(handler.isOn()){var left=miniDom.getOffset(content).left-elementWidth-gap;element.style.left=left+"px"}else if(handler.isOff()){element.style.left=elementLeft+"px";element.style.top=offPosition-contentTop+"px"}else{element.style.left=elementLeft+"px"}}var handler=affix(element,contentTop,offPosition,position);miniDom.on(window,"resize",_.debounce(function(){return position(handler)},300))}function initSky(){if(adListLoader.isAdEnabled({pos:"right_sky_top"})){adsRenderer.addLoadListener(function(event){var ad=event.slot?event.slot.molAd:{};if(ad.pos===adStickyConfig.rightSky.position){var rightParent=document.getElementById(adStickyConfig.rightSky.parentTarget);if(rightParent)initStickyRightSky(rightParent)}})}if(adListLoader.isAdEnabled({pos:"left_sky_top"})){adsRenderer.addLoadListener(function(event){var ad=event.slot?event.slot.molAd:{};if(ad.pos===adStickyConfig.leftSky.position){var leftParent=document.getElementById(adStickyConfig.leftSky.parentTarget);if(leftParent)initStickyLeftSky(leftParent)}})}}function computeSlidingMpuStyles(element,parent){var parentStyles=window.getComputedStyle(parent,null);var parentTop=miniDom.getOffset(parent).top;var parentHeight=parseInt(parentStyles.getPropertyValue("height"));var parentBottom=parentTop+parentHeight;var elementStyles=window.getComputedStyle(element,null);var elementHeight=parseInt(elementStyles.getPropertyValue("height"));var elementTop=miniDom.getOffset(element).top;return{elementTop:elementTop,parentBottom:parentBottom,parentHeight:parentHeight,elementHeight:elementHeight,parentTop:parentTop}}function makeMpuSliding(element,parent,position){if(!window.getComputedStyle)return;var styles=computeSlidingMpuStyles(element,parent);var mpuSlidingApi={};affix(element,styles.elementTop,styles.parentBottom-styles.elementHeight,function(handler){if(handler.isOff()){element.style.top=styles.parentHeight-styles.elementHeight+"px"}},mpuSlidingApi);adsRenderer.addSlotVisibilityChangeListener(function recomputeMpuStyles(event){var ad=event.slot?event.slot.molAd:{};if(!event.isEmpty&&event.inViewPercentage&&ad.pos===position&&styles.parentTop!==miniDom.getOffset(parent).top){styles=computeSlidingMpuStyles(element,parent);mpuSlidingApi.updateSettings(styles.elementTop,styles.parentBottom-styles.elementHeight,function(handler){if(handler.isOff()){element.style.top=styles.parentHeight-styles.elementHeight+"px"}})}})}function doesCreativeHaveSize(renderingEvent,width,height){return renderingEvent&&!renderingEvent.isEmpty&&renderingEvent.size&&renderingEvent.size.length===2&&renderingEvent.size[0]===width&&renderingEvent.size[1]===height}function isDoubleMpu(mpuRenderingEvent){return doesCreativeHaveSize(mpuRenderingEvent,300,600)}function initSlidingMpu(position){if(adListLoader.isAdEnabled({pos:position})){adsRenderer.addLoadListener(function(event){var ad=event.slot?event.slot.molAd:{};if(!event.isEmpty&&ad.pos===position&&!isDoubleMpu(event)){var container=document.getElementById(position);if(container){var parent=miniDom.closest(container,function(n){return miniDom.hasClass(n,"mpu_puff_wrapper")});if(parent){miniDom.addClass(parent,"sliding_mpu");makeMpuSliding(container,parent,position)}}}})}}function initSlidingMpus(){if(adStickyConfig&&adStickyConfig.slidingMpus){_.each(adStickyConfig.slidingMpus,initSlidingMpu)}}function initStickyBillboard(element){if(global["$"]){initStickyBillboardAfterJQuery(element)}else{postbox.on("jquery ready",function(){return initStickyBillboardAfterJQuery(element)})}}function initStickyBillboardAfterJQuery(element){var MAX_THRESHOLD=300;var thresholdElement=$("#fff-hub-banner").get(0)||$(".article-text h1").get(0)||$("#sciencetech, #arts, #you, #promotions, #tvshowbizheadlines, #food, #gardening, #femailblogs").get(0)&&$(".lead-alpha:first .beta:first .item:nth-child(1)").get(0)||$(".gamma:eq(1) .tim-tools").get(0)||$(".gamma:first .tim-tools").get(0)||$(".gamma:first .sport.item:nth-child(2)").get(0)||$(".gamma:first .article-tri-headline:first h2").get(0)||$(".lead-alpha:first .alpha:first .article.article-tri-headline:nth-child(1) h2").get(0)||$(".lead-alpha:first .football-team-news:first .article.article-large:first h2").get(0)||$(".lead-alpha:first .sport:first .article-large:first h2").get(0)||$(".lead-alpha:first .health:first .health-archive:first h2").get(0)||$(".lead-alpha:first .travel:first .travel-banner:first h1").get(0)||$(".lead-alpha:first .beta:first .item:nth-child(1) .puff ul li:nth-child(1)").get(0)||$(".lead-alpha:first .beta:first .item:nth-child(1) .fff-hub .fff-search").get(0)||$(".lead-alpha:first .alpha:first .item:first h3:not(.usability)").get(0)||$(".lead-alpha:first .beta:first .item:nth-child(2)").get(0)||$(".lead-alpha:first .alpha:first .item:first h6").get(0);if(thresholdElement){var elementTopOffset=miniDom.getOffset(element).top;var on=elementTopOffset;var off=miniDom.getOffset(thresholdElement).top+thresholdElement.scrollHeight-element.scrollHeight;if(off-on>MAX_THRESHOLD)return;affix(element,on,off,function(handler){if(handler.isOff()){element.style.position="relative";element.style.top=off-parseInt(elementTopOffset)+"px"}},adStickyConfig&&adStickyConfig.billboard)}}function initLeaderboardFromWithinBillboard(element,parent,makeSticky){var body=miniDom.getElementsByClassName(document,"molads_billboard_on")[0];if(body){miniDom.addClass(body,"molads_ldr_billboard_on");if(makeSticky){miniDom.on(document,"scroll",check)}}var parentBottom=parseInt(miniDom.getOffset(parent).top)+parent.scrollHeight;function check(){var elementBottom=parseInt(miniDom.getOffset(element).top)+element.scrollHeight;if(parentBottom<elementBottom){miniDom.addClass(element,"affix-past-parent")}else{miniDom.removeClass(element,"affix-past-parent")}}}function isLeaderboardEvent(event){return event.size[0]===728&&event.size[1]===90}function initBillboard(makeSticky){if(adListLoader.isAdEnabled({pos:adStickyConfig.position})){adsRenderer.addLoadListener(function(event){var ad=event.slot?event.slot.molAd:{};if(!event.isEmpty&&ad.pos===adStickyConfig.billboard.position&&ad.parentId===adStickyConfig.billboard.parentId){var adElement=document.getElementById(ad.parentId);var parent=adElement.parentNode;if(!parent)return;if(isLeaderboardEvent(event)){initLeaderboardFromWithinBillboard(adElement,parent,makeSticky)}if(makeSticky){setTimeout(function(){if(parent.scrollHeight>1){initStickyBillboard(adElement,parent)}},adStickyConfig.initBillboardSetTimeoutMs)}}})}}function init(){var DM=DM||{log:function log(){}};initBillboard(PageCriteria.device==="other");try{adStickyConfig.banner.position;initStickyBanner()}catch(e){DM.log("Missing configuration for sticky banner.")}try{adStickyConfig.leader.position;initLeaderTop()}catch(e){DM.log("Missing configuration for leaderboard")}initSky();initSlidingMpus()}module.exports={init:init};postbox.on("slots initialized",function(){init()})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ads-loading/AdListLoader.js":4,"./ads-rendering/AdsRenderer.js":8,"./ads-utils/AdImpression.js":62,"./ads-utils/MessageBroker":64,"./dom":71}],4:[function(require,module,exports){"use strict";var _MessageBroker=require("../ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var adsDefaults=require("../ads-loading/conf/AdsDefaults.js");var adsDescriptions=require("./conf/AdsDescriptions");var enabledAds=[];var disabledAds=[];var emergencyRules=[];var loadingSettings={};var IMMEDIATE="immediate";var LAZY="lazy";var DELAYED="delayed";var postbox=_MessageBroker2.default.postbox("AdListLoader");var supportedSlots=["adx_page_skins","adx_tracking","banner_top","billboard","fff","halfsky_left_bottom","halfsky_left_middle","halfsky_left_top","halfsky_right_bottom","halfsky_right_middle","halfsky_right_top","interstitial","ldr_top","puff_ad_1","puff_ad_2","puff_ad_3","mpu_bottom_zero","mpu_bottom_right_zero","mpu_middle_zero","mpu_mobile","mpu_top_zero","mpu_bottom_300x600","mpu_bottom_right_300x600","mpu_middle_300x600","mpu_top_300x600","mpu_bottom","mpu_bottom_right","mpu_middle","mpu_puff_10","mpu_puff_20","mpu_puff_30","mpu_puff_top_right","mpu_top","native_puff_dfp","network_banner","search_engine_sky","skinny_belly_top","sky_left_top","sky_right_top","sticky_banner","video_carousel"];

function getCssClass(position,state){return"molads_"+position+"_"+state}function initCssClasses(){var clsOff=_.map(disabledAds,function(item){return getCssClass(item,"off")}).join(" ");var clsOn=_.map(enabledAds,function(item){return getCssClass(item,"on")}).join(" ");miniDom.addClass(document.documentElement,clsOff+" "+clsOn)}function isAdEnabled(ad){var position=ad&&(ad.dfpPos||ad.pos);if(window.disableAds){return false}return!position||supportedSlots.indexOf(position)===-1||enabledAds.indexOf(position)>-1}function initEmergencyRules(){generateEmergencyList();miniDom.addClass(document.documentElement,emergencyRules.join(" "));function generateEmergencyList(){var defaultValues=adsDefaults.defaultValues,defaultLoadingSettings=adsDefaults.defaultLoadingSettings;for(var slot in defaultValues){if(defaultValues.hasOwnProperty(slot)){emergencyRules.push(getCssClass(slot,defaultValues[slot]))}loadingSettings[slot]=extractLoadingSettings(defaultLoadingSettings[slot]||defaultLoadingSettings["*"])}}}function clearEmergencyRules(){miniDom.removeClass(document.documentElement,emergencyRules.join(" "))}function extractLoadingSettings(slotConfig){var settings={};settings.type=slotConfig.loadingType||IMMEDIATE;settings.trigger=slotConfig.loadingTrigger||undefined;settings.offset=isNaN(slotConfig.loadingOffset)?0:Number(slotConfig.loadingOffset);if(settings.type!==IMMEDIATE&&settings.type!==DELAYED&&(settings.type!==LAZY||!settings.trigger)){DM.log("ads","Unknown loading type or invalid loading trigger, falling back to immediate loading :",settings);settings.type=IMMEDIATE}return settings}function getLoadingSettings(position){return loadingSettings[position]||{type:IMMEDIATE,trigger:undefined,offset:0}}function _initSlots(slotsConfig){clearEmergencyRules();for(var slot in slotsConfig){if(slotsConfig.hasOwnProperty(slot)){if(!window.disableAds){if(slotsConfig[slot].enabled){enabledAds.push(slot)}else{disabledAds.push(slot)}loadingSettings[slot]=extractLoadingSettings(slotsConfig[slot])}}}postbox.emit("slots initialized",enabledAds);initCssClasses()}function writePageInfoClasses(){if(MobileUtils.isMobile()){writeOrientationClass()}miniDom.addClass(document.documentElement,PageCriteria.geo.toLowerCase()+"_country");function writeOrientationClass(){DM.later("DOM_READY",function(){var orientationTimeout=void 0;var classes=["portrait","landscape"];function setOrientation(){var isLandscape=MobileUtils.isLandscape();var html=document.documentElement;miniDom.addClass(html,classes[+isLandscape]);miniDom.removeClass(html,classes[+!isLandscape]);orientationTimeout=0}function onOrientationChange(){if(orientationTimeout){clearTimeout(orientationTimeout)}orientationTimeout=setTimeout(setOrientation,200)}miniDom.on(window,"orientationchange",onOrientationChange);miniDom.on(window,"resize",onOrientationChange);setOrientation()})}}function getEnabledRenderedSlots(){return enabledAds.slice()}function loadScriptSync(url){var script="script";document.write("<"+script+' src="'+url+'"></'+script+">")}function getEnabledDescriptions(){var ads=adsDescriptions.ads;return Object.keys(ads).reduce(function(acc,pos){if(isAdEnabled(ads[pos]))acc[pos]=ads[pos];return acc},{})}postbox.on("system ready",function(){DM.later("DOM_READY",function(){document.write=document.writeln=function(url){try{throw new Error(url)}catch(e){DM.log("ads","Error: there was an attempt to document.write in a rendered page: ",e)}}})});_.extend(module.exports,{isAdEnabled:isAdEnabled,initSlots:function initSlots(slotsConfig){_initSlots(slotsConfig);writePageInfoClasses()},initEmergencyRules:initEmergencyRules,requestSlotConfig:loadScriptSync,loadScriptSync:loadScriptSync,setSupportedSlots:function setSupportedSlots(slots){supportedSlots=slots},getEnabledSlots:getEnabledRenderedSlots,getEnabledRenderedSlots:getEnabledRenderedSlots,getEnabledDescriptions:getEnabledDescriptions,getLoadingSettings:getLoadingSettings,IMMEDIATE:IMMEDIATE,LAZY:LAZY,DELAYED:DELAYED})},{"../ads-loading/conf/AdsDefaults.js":5,"../ads-utils/MessageBroker":64,"./conf/AdsDescriptions":6}],5:[function(require,module,exports){"use strict";exports.defaultValues={adx_page_skins:"off",adx_tracking:"off",fff:"off",sticky_banner:"off",network_banner:"off",ldr_top:"off",banner_top:"off",sky_left_top:"off",sky_right_top:"off",search_engine_sky:"off",skinny_belly_top:"off",billboard:"off",inread_player:"off",interstitial:"off",mpu_top:"on",mpu_middle:"on",mpu_bottom:"on",mpu_mobile:"on",mpu_bottom_right:"on",mpu_top_300x600:"on",mpu_middle_300x600:"on",mpu_bottom_300x600:"on",mpu_bottom_right_300x600:"on",mpu_top_zero:"on",mpu_middle_zero:"on",mpu_bottom_zero:"on",mpu_bottom_right_zero:"on",mpu_puff_10:"on",mpu_puff_20:"on",mpu_puff_30:"on",mpu_puff_top_right:"off",puff_ad_1:"off",puff_ad_2:"off",puff_ad_3:"off",halfsky_left_top:"off",halfsky_left_middle:"off",halfsky_left_bottom:"off",halfsky_right_top:"off",halfsky_right_middle:"off",halfsky_right_bottom:"off",video_carousel:"off"};exports.defaultLoadingSettings={"*":{loadingType:"immediate"},inread_player:{loadingType:"lazy",loadingTrigger:"#inread-player",loadingOffset:0},interstitial:{loadingType:"delayed"},native_fff_overlay_accessorise:{loadingType:"delayed"},puff_ad_2:{loadingType:"delayed"},puff_ad_3:{loadingType:"delayed"}}},{}],6:[function(require,module,exports){(function(global){"use strict";var _browser=require("../../ads-utils/browser");var US=PageCriteria.geo==="US";var GB=PageCriteria.geo==="GB";var AU=PageCriteria.geo==="AU";var NZ=PageCriteria.geo==="NZ";var ROW=!US&&!GB;var TABLET=PageCriteria.isTablet;var PHONE=PageCriteria.isMobile&&!TABLET;var ARTICLE=PageCriteria.pageType==="article";var _getBrowserSize=(0,_browser.getSize)(),BROWSER_WIDTH=_getBrowserSize.width;var WIDE_SKIES=BROWSER_WIDTH>1440;function when(){for(var _len=arguments.length,criteria=Array(_len),_key=0;_key<_len;_key++){criteria[_key]=arguments[_key]}for(var i=0;i<criteria.length;i++){var item=criteria[i];if(Array.isArray(item)){if(item[0])return item[1]}else{return item}}}var ads={banner_top:{id:"banner",size:[468,60],target:"NON_LEADERBOARD",pos:"banner_top",dcopt:true,bidding:GB?[{sizes:[[468,60]],bidders:[{bidder:"appnexus",params:{placementId:7289710}}]}]:[]},native_puff:{size:[[308,150],[300,120]],id:"native_puff"},sticky_banner:{size:PHONE?[320,50]:[980,90],command:"pfadj",adProbe:true,dcopt:true,id:"stickyBanner",bidding:[{sizes:GB?[[320,50],[300,50]]:[[300,50]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521308],[US,5758132],5756628)}}]}]},ldr_top:{size:[[468,60],[728,90],[900,125]],adProbe:true,dcopt:true,id:"superBanner",bidding:[{sizes:[[728,90]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521258],[US,5758119],5756609)}}]}]},leader_middle:{size:[[970,250],[900,250],[728,90]],id:"leader_middle",bidding:[{sizes:[[728,90],[900,250],[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,9528218],[US,9366546],9372761)}}]}].concat(US||ROW?[{sizes:[[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([US,9719504],9758687)}}]}]:[])},leader_lower_middle:{size:[[970,250],[900,250],[728,90]],id:"leader_lower_middle",bidding:[{sizes:[[728,90],[900,250],[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,9457779],[US,9416597],9458469)}}]}].concat(US||ROW?[{sizes:[[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([US,9719516],9758690)}}]}]:[])},leader_bottom:{size:[[970,250],[900,250],[728,90]],id:"leader_bottom",bidding:[{sizes:[[728,90],[900,250],[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,9528221],[US,9366645],9372778)}}]}].concat(US||ROW?[{sizes:[[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([US,9719509],9758688)}}]}]:[])},leader_very_bottom:{size:[[970,250],[900,250],[728,90]],id:"leader_very_bottom",bidding:[{sizes:[[728,90],[900,250],[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,9528222],[US,9366772],9372781)}}]}].concat(US||ROW?[{sizes:[[970,250]],bidders:[{bidder:"appnexus",params:{placementId:when([US,9719513],9758689)}}]}]:[])},billboard:{size:[[970,250],[900,250],[728,90]],dcopt:true,adProbe:true,id:"billBoard",bidding:[{sizes:[[970,250],[728,90]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,ARTICLE?5521274:5521267],[US,7493637],7516412)}}]}]},halfsky_left_top:{size:[[120,240]],wide:true,id:"halfsky_left_top"},halfsky_left_middle:{size:[[120,240]],wide:true,id:"halfsky_left_middle"},halfsky_left_bottom:{size:[[120,240]],wide:true,id:"halfsky_left_bottom"},sky_left_top:{size:when([WIDE_SKIES,[[300,600],[160,600],[120,600]]],[true,[[160,600],[120,600]]]),target:"MOL_SKY_ART",id:"sky-left",wide:true,bidding:[{sizes:when([GB,[[120,600],[160,600]]],[US,[[120,600]]]),bidders:[{bidder:"appnexus",params:{placementId:when([GB,7289713],[US,8826005])}}]},{sizes:[[160,600]],bidders:US?[{bidder:"appnexus",params:{placementId:8825890}}]:[]},{sizes:[[300,600]],bidders:WIDE_SKIES?[{bidder:"appnexus",params:{placementId:when([GB,9979924],[US,10022139],9984102)}}]:[]}]},sky_right_top:{size:when([WIDE_SKIES,[[300,600],[160,600],[120,600]]],[true,[[160,600],[120,600]]]),target:"MOL_SKY_WIDE_ART",wide:true,id:"sky-right",bidding:[{sizes:GB?[[120,600],[160,600]]:[[120,600]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521285],[US,5758127],5756620)}}]},{sizes:[[160,600]],bidders:US?[{bidder:"appnexus",params:{placementId:8825983}}]:[]},{sizes:[[300,600]],bidders:WIDE_SKIES?[{bidder:"appnexus",params:{placementId:when([GB,9979923],[US,10022128],9984093)}}]:[]}]},halfsky_right_top:{size:[120,240],wide:true,id:"textAd"},halfsky_right_middle:{size:[120,240],wide:true,id:"h-sky-a"},halfsky_right_bottom:{size:[120,240],wide:true,id:"h-sky-b"},inread_player:{size:[636,1],id:"inread-player"},mpu_bottom:{size:[300,250],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521214],[US,5758112],5756585)}}]}]},mpu_bottom_right:{size:[300,250],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521244],[US,5758111],5756584)}}]}]},mpu_home:{size:[300,250],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521220],[US,5758107],5756583)}}]}]},mpu_channel:{id:"mpu_channel",size:[300,250],bidding:[{sizes:[[300,250]],bidders:GB?[{bidder:"appnexus",params:{placementId:5521253}}]:[]}]},mpu_mobile:{id:"mpu_mobile",size:["fluid",[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521298],[US,5758115],5756602)}},{bidder:"fan",params:{placementId:"547880618750071_547888738749259"}}]}]},mpu_mobile_top:{size:["fluid",[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,7289716],[US,7493634],7492376)}},{bidder:"fan",params:{placementId:"547880618750071_547881238750009"}}]}]},mpu_mobile_upper_middle:{size:["fluid",[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"fan",params:{placementId:"547880618750071_547886642082802"}}]}]},mpu_mobile_lower_middle:{size:["fluid",[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"fan",params:{placementId:"547880618750071_547888382082628"}}]}]},mpu_mobile_bottom:{size:["fluid",[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521304],[US,5758116],5756603)}},{bidder:"fan",params:{placementId:"547880618750071_547888885415911"}}]}]},half_mpu_top:{id:"half_mpu_top",size:[[300,150]]},mpu_top:{size:[[300,600],[300,250]],bidding:[{sizes:[[300,250],[300,600]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521234],[US,5758117],5756606)}}]}]},mpu_top_zero:{size:[[300,600],[300,250]],bidding:[{sizes:[[300,250],[300,600]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521289],[US,5758117],5756606)}}]}]},mpu_puff_10:{id:"mpu_puff_10",size:AU||NZ||US?[[300,250]]:[[300,600],[300,250]],bidding:[{sizes:GB?[[300,250],[300,600]]:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521226],[US,5758113],5756591)}}]}]},mpu_puff_15:{id:"mpu_puff_15",size:[[300,600],[300,250]],bidding:[{sizes:GB?[[300,250],[300,600]]:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,6575939],[US,7199838],7199824)}}]}]},mpu_puff_20:{id:"mpu_puff_20",size:[[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521238],[US,5758114],5756595)}}]}]},mpu_puff_30:{id:"mpu_puff_30",size:[[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,6575947],[US,7199851],7199825)}}]}]},mpu_puff_45:{id:"mpu_puff_45",size:[[300,250]],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,6575951],[US,7199858],7199826)}}]}]},mpu_middle:{size:[300,250],bidding:[{sizes:[[300,250]],bidders:[{bidder:"appnexus",params:{placementId:when([GB,5521212],[US,5758104],5756578)}}]}]},video_ad:{id:"video_ad",size:[[300,365]]},puff_ad_1:{id:"puff_ad_1",size:[[356,114],[316,114]]},puff_ad_2:{id:"puff_ad_2",size:[[356,114],[316,114]]},puff_ad_3:{id:"puff_ad_3",size:[[356,114],[316,114]]},native_mpu:{size:[2,2],id:"native_mpu"},native_related:{size:[2,2],id:"native-related",delayed:false},network_banner:{size:[320,50],id:"networkBanner",command:"pfadj",adProbe:true,dcopt:true},"interstitial-0-ad":{size:[980,90],dfpPos:"interstitial",id:"interstitial-0-ad",command:"pfadj",adProbe:true,dcopt:true},"interstitial-1-ad":{size:[980,90],dfpPos:"interstitial",id:"interstitial-1-ad",command:"pfadj",adProbe:true,dcopt:true},fff:{size:[840,114],dfpPos:"fff",id:"fff"},fff_overlay:{size:[964,114],dfpPos:"fff",id:"fff_overlay",command:"pfadj",dcopt:true}};_.forEach(ads,function(ad,position){ad.pos=position;ad.parentId=ad.parentId||ad.id;ad.slots=ad.slots||[];overrideAdWithCljAdmConfiguration(ad);serializeAdSizes(ad)});function overrideAdWithCljAdmConfiguration(ad){var _cfg=adStickyConfig.overwrite;var _channel=global.PageCriteria.channel;var _geo=global.PageCriteria.geo.toLowerCase();var _ptype=global.PageCriteria.pageType;var overwrite={};try{_.extend(overwrite,_cfg["allChannels"]["allGeos"]["allTypes"])}catch(e){}try{_.extend(overwrite,_cfg["allChannels"]["allGeos"][_ptype])}catch(e){}try{_.extend(overwrite,_cfg["allChannels"][_geo]["allTypes"])}catch(e){}try{_.extend(overwrite,_cfg["allChannels"][_geo][_ptype])}catch(e){}try{_.extend(overwrite,_cfg[_channel]["allGeos"]["allTypes"])}catch(e){}try{_.extend(overwrite,_cfg[_channel]["allGeos"][_ptype])}catch(e){}try{_.extend(overwrite,_cfg[_channel][_geo]["allTypes"])}catch(e){}try{_.extend(overwrite,_cfg[_channel][_geo][_ptype])}catch(e){}try{_.extend(ad,overwrite[ad.pos])}catch(e){}return ad}function serializeAdSizes(ad){if(ad.type)return;var sizes=[];if(ad.size){sizes=Array.isArray(ad.size[0])&&ad.size||typeof ad.size[0]==="string"?ad.size:[ad.size]}ad.type=sizes.map(function(size){return Array.isArray(size)?size.join("x"):size}).join(", ")}function getBiddingParams(pos,bidder){var bidding=(getDescription(pos)||{}).bidding||[];var params={};outerLoop:for(var i=0;i<bidding.length;i++){var bidders=bidding[i].bidders||[];for(var j=0;j<bidders.length;j++){var bidderConfig=bidders[j];if(bidderConfig.bidder===bidder){params=bidderConfig.params;break outerLoop}}}return params}var getDescription=function getDescription(position){var description=ads[position];if(description&&!description.pos){description.pos=position}return description};var updateDescription=function updateDescription(position,description){ads[position]=description};module.exports={ads:ads,get:getDescription,update:updateDescription,getBiddingParams:getBiddingParams,overrideAdWithCljAdmConfiguration:overrideAdWithCljAdmConfiguration}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../ads-utils/browser":69}],7:[function(require,module,exports){"use strict";module.exports=function(name){function log(){var args=["ads",(new Date).toISOString(),"["+name+"]"].concat([].concat(Array.prototype.slice.call(arguments)));DM.log.apply(null,args)}return{log:log}}},{}],8:[function(require,module,exports){"use strict";var _MessageBroker=require("../ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var utils=require("./utils.js");var adsDescriptions=require("../ads-loading/conf/AdsDescriptions.js");var DfpServer=require("./servers/dfp/DfpServer.js");var AD_ATTRIBUTE="data-adverts-ad";var TAGS_ATTRIBUTE="data-adverts-tags";var loadListeners=require("./adsLoadListener.js");var addLoadListener=require("./addLoadListener.js");var visibilityChangeListeners=[];function getServer(){return DfpServer}function requestAdvert(ad){if(ad.parentId){var container=document.getElementById(ad.parentId);if(container){container.setAttribute(AD_ATTRIBUTE,utils.stringify(ad));miniDom.addClass(container,"adHolder")}}return getServer().requestAd(ad)}function refreshAdvert(ad){getServer().refreshAdvert(ad)}function refreshAdvertsWithNewTags(ids,plugins){var ads=ids.map(getAdTupleById).filter(Boolean).map(function(tuple){return tuple.ad});getServer().refreshAdvertsWithNewTags(ads,plugins)}function refreshAdverts(ids,isPageChange){var serverAds={};ids.forEach(function(id){var adTuple=getAdTupleById(id);if(adTuple){var serverClass=DfpServer;var serverName=serverClass.name;if(!(serverName in serverAds)){serverAds[serverName]={serverClass:serverClass,ads:[]}}serverAds[serverName].ads.push(adTuple.ad)}});Object.keys(serverAds).forEach(function(serverName){var server=serverAds[serverName];var serverClass=serverAds[serverName].serverClass;if(serverClass.refreshAdverts){serverClass.refreshAdverts(server.ads,isPageChange)}})}function getAdTupleById(id){var container=document.getElementById(id);if(container){var adData=container.getAttribute(AD_ATTRIBUTE);var tagsData=container.getAttribute(TAGS_ATTRIBUTE);var ad=void 0;var deserializedAd=void 0;var tags=void 0;if(adData){deserializedAd=utils.parse(adData);ad=adsDescriptions.get(deserializedAd.pos)||deserializedAd;tags=tagsData?utils.parse(tagsData):null;return{ad:ad,tags:tags,container:container}}}return null}function requestDelayedAdvert(id){var adTuple=getAdTupleById(id);var requested=false;if(adTuple&&adTuple.ad&&adTuple.tags){var server=getServer();if(server.requestDelayedAd){server.requestDelayedAd(adTuple.ad,adTuple.tags);requested=true}adTuple.container.removeAttribute(TAGS_ATTRIBUTE)}return requested}function onAdLoaded(event){for(var i=0,l=loadListeners.length;i<l;i++){loadListeners[i](event)}}function addSlotVisibilityChangeListener(callback){if(typeof callback==="function"){visibilityChangeListeners.push(callback)}}function onSlotVisibilityChange(event){for(var i=0,l=visibilityChangeListeners.length;i<l;i++){visibilityChangeListeners[i](event)}}var postbox=_MessageBroker2.default.postbox("AdsRenderer");postbox.on("slot ready",function(ad){requestAdvert(ad)});module.exports={requestAdvert:requestAdvert,refreshAdvert:refreshAdvert,refreshAdverts:refreshAdverts,refreshAdvertsWithNewTags:refreshAdvertsWithNewTags,requestDelayedAdvert:requestDelayedAdvert,addLoadListener:addLoadListener,onAdLoaded:onAdLoaded,addSlotVisibilityChangeListener:addSlotVisibilityChangeListener,onSlotVisibilityChange:onSlotVisibilityChange,stringify:utils.stringify,parse:utils.parse,AD_ATTRIBUTE:AD_ATTRIBUTE,TAGS_ATTRIBUTE:TAGS_ATTRIBUTE,reset:function reset(){loadListeners.length=0}}},{"../ads-loading/conf/AdsDescriptions.js":6,"../ads-utils/MessageBroker":64,"./addLoadListener.js":12,"./adsLoadListener.js":13,"./servers/dfp/DfpServer.js":16,"./utils.js":19}],9:[function(require,module,exports){"use strict";var HomepageRenderer=require("../ads-rendering/HomepageRenderer.js");var trackedElements=[];var rotatorAds=[];var checkTimeout=0;var trackingInitialized=false;function initTracking(){if(trackingInitialized)return;trackingInitialized=true;miniDom.on(window,"scroll",onScroll);miniDom.on(document.body,"touchmove",onScroll);onScroll()}function onScroll(){if(!checkTimeout){checkTimeout=setTimeout(checkAndLoad,200)}}function shouldLoad(element,offset,currentScrollingPosition){return element&&element.style.display!=="none"&&currentScrollingPosition>=miniDom.getOffset(element).top-offset}function checkAndLoad(){var screenBottom=window.pageYOffset+miniDom.getPageSize()[3];var trackedElement=void 0;for(var i=trackedElements.length;i--;){trackedElement=trackedElements[i];if(shouldLoad(trackedElement.element,trackedElement.offset,screenBottom)){adsRenderer.requestDelayedAdvert(trackedElement.id);trackedElements.splice(i,1)}}checkTimeout=trackedElements.length?0:-1}function isImmediatelyLoaded(ad){return adListLoader.getLoadingSettings(ad.dfpPos||ad.pos).type===adListLoader.IMMEDIATE}function getLazyLoadingSettings(ad){var settings=adListLoader.getLoadingSettings(ad.dfpPos||ad.pos);return settings.type===adListLoader.LAZY?settings:undefined}function getTrackingDetails(ad){var settings=getLazyLoadingSettings(ad);if(settings&&settings.trigger){var triggerDOM=null;try{triggerDOM=document.querySelector(settings.trigger)}catch(e){DM.log("ads","Invalid css selector in the loading trigger:",settings.trigger)}return{id:ad.parentId,element:triggerDOM||document.getElementById(ad.parentId),offset:settings.offset}}return null}function initRotatorTracking(ad){var adContainer,rotator,pager;var clickTimeout=0;if(ad.pos.slice(0,14)==="native_related"){adContainer=document.getElementById(ad.parentId);if(adContainer){rotator=miniDom.closest(adContainer,isRotator);if(rotator&&!_.contains(rotatorAds,rotator)){pager=miniDom.getElementsByClassName(rotator,"rotator-pages")[0];if(pager){rotatorAds.push(rotator);miniDom.on(pager,"click",function(event){var target=event.target||event.srcElement;if(!clickTimeout&&miniDom.closest(target,isPagerLink)){clickTimeout=setTimeout(requestDelayedAdOnActivePage,50)}})}}}}function isRotator(node){return miniDom.hasClass(node,"rotator")}function isPagerLink(node){return node.nodeName==="A"&&node.hasAttribute("data-page")}function requestDelayedAdOnActivePage(){var adsRenderer=require("../ads-rendering/AdsRenderer.js");var pageItem=miniDom.getElementsByClassName(pager,"active")[0];clickTimeout=0;if(pageItem){var page=Number(pageItem.getElementsByTagName("a")[0].getAttribute("data-page"));if(page){var children=miniDom.getElementsByClassName(rotator,"rotator-panels")[0].getElementsByTagName("li")[page-1].childNodes;var child;for(var i=children.length;i--;){child=children[i];if(child.nodeType===1&&child.hasAttribute(adsRenderer.TAGS_ATTRIBUTE)){adsRenderer.requestDelayedAdvert(child.id);break}}}}}}function isDelayedAd(ad){return HomepageRenderer.isDelayedAd(ad)||!isImmediatelyLoaded(ad)||ad.delayed}function trackAd(ad){var trackingDetails=getTrackingDetails(ad);if(trackingDetails){trackedElements.push(trackingDetails);if(checkTimeout===-1){checkTimeout=0}initTracking()}else if(!HomepageRenderer.isMobileHomepage()){initRotatorTracking(ad)}}function delayRequestAd(ad,tags){var adsRenderer=require("../ads-rendering/AdsRenderer.js");var container=document.getElementById(ad.parentId);if(container){container.setAttribute(adsRenderer.TAGS_ATTRIBUTE,JSON.stringify(tags));trackAd(ad)}}module.exports={isDelayedAd:isDelayedAd,delayRequestAd:delayRequestAd,reset:function reset(){trackingInitialized=false}}},{"../ads-rendering/AdsRenderer.js":8,"../ads-rendering/HomepageRenderer.js":10}],10:[function(require,module,exports){"use strict";var _MessageBroker=require("../ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var AdsPlugin=require("../ads-tracking/AdsPlugin");var homepageCookieValue=null;var homepages=["home","ushome","auhome","mailonsunday"];var panelClass="hp-panel";var panels=[];var panelNames={news:0,showbiz:1};_MessageBroker2.default.postbox("HomepageRenderer").on("system ready",function(){if(isHomepage()){if(isMobile()){var pageEvents=DM&&DM.pageEvents;setHomepageCookieValue(fetchHomepageCookieValue());if(isMobileHomepage()&&pageEvents){pageEvents.listen(pageEvents.MOBILE_HOME_PAGE_VIEW,onMobileHomePageView)}}}});function onMobileHomePageView(observable,eventName,target){var panelName=target.swipe||setHomepageCookieValue(fetchHomepageCookieValue());var panel=getPanel(panelName);if(panel){updateArea(panelName);var adsToRefresh=[];var ads=miniDom.getElementsByClassName(document.documentElement,"adHolder");var adsRenderer=require("../ads-rendering/AdsRenderer.js");for(var i=ads.length;i--;){var container=ads[i];if(miniDom.closest(container,isCurrentPanel)||!miniDom.closest(container,isPanel)){if(!adsRenderer.requestDelayedAdvert(container.id)){adsToRefresh.push(container.id)}}}if(adsToRefresh.length){adsRenderer.refreshAdverts(adsToRefresh,true)}}function isCurrentPanel(node){return node===panel}}function fetchHomepageCookieValue(){return AdsPlugin.prototype.getCookie("mol-home")}function setHomepageCookieValue(value){updateArea(value);homepageCookieValue=value;return value}function updateArea(value){if(value in panelNames){window.adSubareaId=panelNames[value]?"dontmiss":window.adAreaId||"home"}}function getPanel(name){if(!panels.length){panels=Array.prototype.slice.call(miniDom.getElementsByClassName(document.documentElement,panelClass))}return panels[panelNames[name]]}function isAdDelayed(ad){if(isMobileHomepage()){if(!homepageCookieValue){return true}else{var panel=getPanel(homepageCookieValue);var container=document.getElementById(ad.parentId);if(panel&&container){var adPanel=miniDom.closest(container,isPanel);if(adPanel&&adPanel!==panel){return true}}}}return false}function isHomepage(){return PageCriteria.pageType==="channel"&&homepages.indexOf(PageCriteria.channel)!==-1&&PageCriteria.subchannel===PageCriteria.channel}function isPanel(node){return miniDom.hasClass(node,panelClass)}function isMobile(){var body=document.body;return body&&body.className?miniDom.hasClass(body,"mol-mobile"):!!MobileUtils.isMobile()}function isMobileHomepage(){return isHomepage()&&isMobile()&&(!homepageCookieValue||homepageCookieValue!=="desktop")}_.extend(exports,{isDelayedAd:isAdDelayed,isMobileHomepage:isMobileHomepage,isHomepage:isHomepage,_setHomepageCookieValue:setHomepageCookieValue,_onMobileHomePageView:onMobileHomePageView})},{"../ads-rendering/AdsRenderer.js":8,"../ads-tracking/AdsPlugin":20,"../ads-utils/MessageBroker":64}],11:[function(require,module,exports){"use strict";var _MessageBroker=require("../ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var addLoadListener=require("./addLoadListener.js");var utils=require("./utils.js");var adListLoader=require("../ads-loading/AdListLoader.js");var adsTrackers=require("../ads-tracking/AdsTrackers.js");var AdIntegrator=require("../ads-utils/AdIntegrator.js");var forcedSlot;_MessageBroker2.default.postbox("NativeRenderer").on("system ready",function(){var href=window.location.href;var matches=href.match(/[&?]enable_native=([^&]+)/);var slot=matches&&matches[1];if(slot){var loader=adListLoader;var initSlots=loader.initSlots;loader.initSlots=function(slotsConfig){slotsConfig[slot]={enabled:true,state:"on"};initSlots.apply(loader,arguments)}}var hashIndex=href.indexOf("#");var hash=hashIndex!==-1?href.slice(hashIndex+1):"";if(hash.slice(0,4)==="cid="&&/\d+/.test(hash.slice(4))){adsTrackers.setNativeId(hash.slice(4))}forcedSlot=slot;addLoadListener(function(event){if(!event.isEmpty){var slot=event.slot;var ad=slot&&slot.molAd;if(ad.pos.slice(0,7)==="native_"&&ad.pos.slice(-4)==="_dfp"){onNativeAdLoaded(ad)}}})});var MESSAGE_HEADER="\f	";var MESSAGE_HEADER_LENGTH=MESSAGE_HEADER.length;addLoadListener(function(event){if(!event.isEmpty){var slot=event.slot;var ad=slot&&slot.molAd;if(ad.pos.slice(0,7)==="native_"&&ad.pos.slice(-4)==="_dfp"){onNativeAdLoaded(ad)}}});function onNativeAdLoaded(ad){var container=document.getElementById(ad.parentId);var adContainer=AdIntegrator.getAdContainer(container);var loaded=false;if(adContainer.body){miniDom.on(adContainer.defaultView||adContainer.parentWindow,"load",onLoad);setTimeout(onLoad,2e3)}function onLoad(){if(!loaded){loaded=true;try{onNativeLoaded(ad,container,adContainer.body.innerHTML)}catch(e){console.error("Error moving native article: ",e)}}}}function onNativeLoaded(ad,container,innerHTML){var div=document.createElement("div");div.innerHTML=innerHTML;var children=div.childNodes;if(container.style.display!=="none"){container.style.display="none";var adContainer=container;var child;var parent=container.parentNode;var position=ad.pos.replace(/_dfp$/,"");for(var i=children.length;i--;){child=children[i];if(child.nodeType===1&&child.nodeName!=="SCRIPT"){parent.insertBefore(child,container);adContainer=child}}var trackingContainer=adContainer;var trackingLink=adContainer;switch(ad.pos){case"native_puff_dfp":parent.parentNode.insertBefore(adContainer,parent);parent.style.display="none";adContainer.className=ad.parentId;trackingContainer=adContainer;trackingLink=adContainer.getElementsByTagName("a")[0];trackingContainer.setAttribute("data-track-module","ap-nativead_puff_article^nativead");break;case"native_related_dfp":var trackingValue=PageCriteria.device==="iphone"||PageCriteria.device==="androidMobile"?"am-read_more_sponsored^read_more-mobile":"am-related_sponsored^related_carousel";trackingLink=adContainer.getElementsByTagName("a")[0];trackingContainer=adContainer;trackingContainer.setAttribute("data-track-module",trackingValue);break;case"native_fff_overlay_accessorise":parent.style.display="none";case"native_fff_accessorise":miniDom.addClass(document.body,"fff-has-accessorise");break}if(trackingLink&&trackingContainer.hasAttribute("data-track-module")&&DM&&DM.externalLinkTracker){trackingLink.setAttribute("data-track-type","cl");DM.externalLinkTracker(trackingContainer.id,"cl")}if(forcedSlot&&window.opener&&window.opener!==window&&window.opener.postMessage){miniDom.on(window,"message",handleMessage.bind(null,adContainer,position));sendResponse(window.opener,"isLoaded",true,position)}}}function handleMessage(container,position,event){if(event.data.slice(0,MESSAGE_HEADER_LENGTH)===MESSAGE_HEADER){var fieldNameAttribute="data-native-ad-field";var data;try{data=utils.parse(event.data.slice(MESSAGE_HEADER_LENGTH))}catch(e){console.error("Invalid message",e)}if(data&&data.type){var fields=[].slice.call(container.querySelectorAll("["+fieldNameAttribute+"]"));var response;switch(data.type){case"getValues":response=fields.map(function(field){return{name:field.getAttribute(fieldNameAttribute),value:field.textContent}});break;case"setValues":fields.forEach(function(field){var fieldName=field.getAttribute(fieldNameAttribute);if(fieldName in data.values){field.textContent=data.values[fieldName]}});break}if(response){sendResponse(event.source,data.type,response,position,event.origin)}}}}function sendResponse(target,type,message,position,origin){var data={type:"response",query:type,position:position,value:message};target.postMessage(MESSAGE_HEADER+utils.stringify(data),origin||"*")}module.exports=onNativeLoaded},{"../ads-loading/AdListLoader.js":4,"../ads-tracking/AdsTrackers.js":23,"../ads-utils/AdIntegrator.js":63,"../ads-utils/MessageBroker":64,"./addLoadListener.js":12,"./utils.js":19}],12:[function(require,module,exports){"use strict";var loadListeners=require("./adsLoadListener.js");module.exports=function addLoadListener(callback){if(typeof callback==="function"){loadListeners.push(callback)}}},{"./adsLoadListener.js":13}],13:[function(require,module,exports){"use strict";module.exports=[]},{}],14:[function(require,module,exports){"use strict"},{}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.on=undefined;exports.getRendered=getRendered;exports.add=add;var _emitter=require("../emitter");var _emitter2=_interopRequireDefault(_emitter);

function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var emitter=new _emitter2.default;var rendered=[];function getRendered(){return rendered}function add(position,event){if(position&&event){if(event.slot&&event.slot.molAd){rendered.push(event.slot.molAd)}emitter.emit("rendered",event);emitter.emit("rendered."+position,event)}}var on=exports.on=emitter.on.bind(emitter)},{"../emitter":72}],16:[function(require,module,exports){"use strict";var dfpConfig=require("./conf/config.js");var trackersRan;function getHandler(){if(!trackersRan){trackersRan=true;var adsTrackers=require("../../../ads-tracking/AdsTrackers.js");adsTrackers.runTrackingPlugins()}var dfpAsyncHandler=require("../../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js");return dfpAsyncHandler}function requestAd(ad){var request=getHandler().requestAd;if(ad.pos&&dfpConfig.dfpPosValues[ad.pos]){ad.pos=dfpConfig.dfpPosValues[ad.pos]}var adsTrackers=require("../../../ads-tracking/AdsTrackers.js");if(ad.pos==="billboard"&&PageCriteria.geo!=="US"){adsTrackers.getTags(ad,request,adsTrackers.getInitialTrackers().map(function(name){return{name:name}}))}else{adsTrackers.getTags(ad,request)}}function requestDelayedAd(ad,tags){var handler=getHandler();if(handler.requestDelayedAd){handler.requestDelayedAd(ad,tags)}}function refreshAdvert(ad){var handler=getHandler();if(handler.refreshAdvert){handler.refreshAdvert(ad.pos)}}function refreshAdvertsWithNewTags(ads,plugins){var adsTrackers=require("../../../ads-tracking/AdsTrackers.js");var results=[];ads.forEach(function(ad){adsTrackers.getTags(ad,function(_,tags){results.push({ad:ad,tags:tags});if(results.length===ads.length){getHandler().refreshAdvertsWithNewTags(results)}},plugins)})}function refreshAdverts(ads,isPageChange){var handler=getHandler();if(handler.refreshAdverts){handler.refreshAdverts(ads,isPageChange)}}module.exports={requestAd:requestAd,refreshAdvert:refreshAdvert,refreshAdverts:refreshAdverts,refreshAdvertsWithNewTags:refreshAdvertsWithNewTags,requestDelayedAd:requestDelayedAd,name:"DfpServer"}},{"../../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js":18,"../../../ads-tracking/AdsTrackers.js":23,"./conf/config.js":17}],17:[function(require,module,exports){"use strict";module.exports={baseURL:"http://ad.uk.doubleclick.net/",dfpPosValues:{mpu_top_zero:"mpu_top",mpu_middle_zero:"mpu_middle",mpu_bottom_zero:"mpu_bottom",mpu_bottom_right_zero:"mpu_bottom_right",mpu_top_300x600:"mpu_top",mpu_middle_300x600:"mpu_middle",mpu_bottom_300x600:"mpu_bottom",mpu_bottom_right_300x600:"mpu_bottom_right"}}},{}],18:[function(require,module,exports){(function(global){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _MessageBroker=require("../../../../ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);var _emitter=require("../../../../emitter");var _emitter2=_interopRequireDefault(_emitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var adsDescriptions=require("../../../../ads-loading/conf/AdsDescriptions.js");var adsRenderer=require("../../../../ads-rendering/AdsRenderer.js");var delayedRender=require("../../../DelayedRenderer.js");var homepageRenderer=require("../../../HomepageRenderer.js");var addLoadListener=require("../../../addLoadListener.js");var renderedAds=require("../../../renderedAds.js");var _require=require("../../../../dom"),onBodyAvailable=_require.onBodyAvailable;var emitter=new _emitter2.default;var postbox=_MessageBroker2.default.postbox("DfpAsyncHandler");var googletag=global.googletag=global.googletag||{};var DFP_NETWORK_CODE=5765;var requestedAds={};var blackListedSlots=["sky_right_top","sky_left_top","halfsky_right_top","halfsky_left_top","halfsky_right_middle","halfsky_left_middle","halfsky_right_bottom","halfsky_left_bottom","mpu_top","mpu_top_300x600","mpu_top_zero","billboard","sticky_banner"];var noOopSlots=["sticky_banner","network_banner"];var gptLoading=false;function addSlotTargeting(ad,tags){if(!ad||!ad.slots||!ad.slots.length){return}_.each(ad.slots,function(slotConfig){slotConfig.slot.addService(googletag.pubads()).setTargeting("pos",ad.dfpPos||ad.pos).setCollapseEmptyDiv(true,shouldCollapseBeforeLoading(ad.pos));if(ad.custom&&ad.custom.length){setCustomParams(slotConfig.slot,ad.custom)}if(typeof window.orientation==="number"){slotConfig.slot.setTargeting("orientation",MobileUtils.isLandscape()?"landscape":"portrait")}if(MobileUtils.isMobile()){slotConfig.slot.setTargeting("lat",PageCriteria.latitude||"").setTargeting("lon",PageCriteria.longitude||"")}includeExtraZoneOptions(slotConfig.slot,ad);module.exports.includeTrackingTags(slotConfig.slot,tags)});return ad}function requestAd(ad,tags,force){if(!force&&delayedRender.isDelayedAd(ad)){delayedRender.delayRequestAd(ad,tags);return}ad.parentId=ad.parentId||ad.id;ad.slots=ad.slots||[];_.each(ad.slots,function(slotConfig){slotConfig.parentId=slotConfig.parentId||slotConfig.id||ad.parentId});adverts.q(setSlotParameters);function setSlotParameters(){getGPTSlotForAd(ad);addSlotTargeting(ad,tags);sendGPTRequest(ad)}function sendGPTRequest(ad){_.each(ad.slots,function(slotConfig){if(slotConfig.type==="gptSlot"){requestedAds[ad.pos]=slotConfig.slot}slotConfig.slot.molAd={pos:ad.pos,type:ad.type,parentId:slotConfig.parentId,adUnit:ad.adUnit};googletag.display(slotConfig.parentId);postbox.emit("ad requested",ad.pos)})}}function refreshAdvertsWithNewTags(tuples){tuples.forEach(function(t){return addSlotTargeting(t.ad,t.tags)});refreshAdverts(tuples.map(function(t){return t.ad}))}function getGPTSlotForAd(ad){var description=adsDescriptions.get(ad.pos);if(description&&description.slots&&description.slots.length){return description.slots}return createGPTSlotForAd(ad)}function createGPTSlotForAd(ad){var adUnit=require("../../../../ads-utils/adUnit.js")(ad.pos);ad.adUnit=adUnit;ad.slots=ad.slots||[];if(!ad.dcopt||ad.command!=="pfadj"||noOopSlots.indexOf(ad.pos)!==-1){var _slot=googletag.defineSlot("/"+DFP_NETWORK_CODE+"/"+adUnit,getSizes(ad),ad.parentId);ad.slots.push({type:"gptSlot",slot:_slot,parentId:ad.parentId});emitter.emit("createdSlot",_slot)}if(ad.dcopt){var oopId=ad.command==="pfadj"&&noOopSlots.indexOf(ad.pos)===-1?ad.parentId:createOOPSlot(ad);var slot=googletag.defineOutOfPageSlot("/"+DFP_NETWORK_CODE+"/"+adUnit,oopId);ad.slots.push({type:"oopGptSlot",slot:slot,parentId:oopId});emitter.emit("createdSlot",slot)}adsDescriptions.update(ad.pos,ad);if(ad.slots.length){addSlotTargeting(ad,[])}return ad}function prepareGPTSlots(positions){adverts.q(function(){var pubads=googletag.pubads();pubads.setTargeting("page",adPageType).setTargeting("article",adArticleId).setTargeting("area",adAreaId).setTargeting("subarea",adSubareaId).setTargeting("environment",adEnvironment).setTargeting("country",PageCriteria.geo.toLowerCase()).addEventListener("slotRenderEnded",adsRenderer.onAdLoaded).addEventListener("slotRenderEnded",function(event){return postbox.emit("ad rendered",event)}).addEventListener("impressionViewable",function(event){return postbox.emit("ad viewable",event)}).addEventListener("slotVisibilityChanged",adsRenderer.onSlotVisibilityChange).setCentering(PageCriteria.isMobile&&!PageCriteria.isTablet);addLoadListener(onAdLoaded);if(homepageRenderer.isHomepage()){pubads.setTargeting("mobile",homepageRenderer.isMobileHomepage().toString())}});positions.forEach(prepareGPTSlot);adverts.q(function(){googletag.pubads().enableAsyncRendering();googletag.enableServices()})}function prepareGPTSlot(position){adverts.q(function(){var description=adsDescriptions.get(position);if(description&&!description.gptSlot&&!description.oopGptSlot){createGPTSlotForAd(description)}})}function shouldCollapseBeforeLoading(adPos){var isBillboardInHome=adPos==="billboard"&&PageCriteria.channel.slice(-4)==="home";return!_.contains(blackListedSlots,adPos)&&!isBillboardInHome}function getSizes(ad){return ad.size||_.map(ad.type.split(","),function(size){return _.map(size.split("x"),Number)})}function createOOPSlot(ad){var oopId=ad.parentId+"-oop";var adElement=document.getElementById(ad.parentId);var oop=document.createElement("div");oop.id=oopId;if(adElement){adElement.parentNode.insertBefore(oop,adElement.nextSibling)}else{onBodyAvailable(function(){document.body.appendChild(oop)})}return oopId}function includeTrackingTags(gptSlot,tags){tags.forEach(function(tag){if(tag&&(typeof tag==="undefined"?"undefined":_typeof(tag))==="object"){Object.keys(tag).forEach(function(key){gptSlot.setTargeting(key,tag[key])})}})}function includeExtraZoneOptions(gptSlot,ad){Object.keys(ad.extraZoneOptions||{}).forEach(function(key){gptSlot.setTargeting(key,ad.extraZoneOptions[key])})}function setCustomParams(gptSlot,paramList){_.each(paramList,function(param){_.keys(param).forEach(function(paramKey){gptSlot.setTargeting(paramKey,param[paramKey])})})}function requestDelayedAd(ad,tags){requestAd(ad,tags,true)}function refreshAdvert(adPos){var gptSlot=getRequestedSlot(adPos);if(gptSlot){gptSlot.setTargeting("refresh","true");googletag.pubads().refresh([gptSlot])}}function refreshAdverts(ads,isPageChange){var slots=ads.map(function(ad){return getRequestedSlot(ad.pos)});var pubads=googletag.pubads();if(isPageChange){pubads.setTargeting("subarea",adSubareaId)}pubads.refresh(slots,isPageChange)}function onAdLoaded(event){if(event.serviceName==="publisher_ads"&&!event.isEmpty){var gptSlot=event.slot;var ad=gptSlot&&gptSlot.molAd;if(ad){var AdIntegrator=require("../../../../ads-utils/AdIntegrator.js");AdIntegrator.centerAlign(ad.parentId,getSizes(ad));renderedAds.add(ad.pos,event)}}}function getRequestedSlot(adPos){return requestedAds[adPos]}postbox.on("slots initialized",function(p){prepareGPTSlots(p)});_.extend(module.exports,emitter.clone(),{requestAd:requestAd,getRequestedSlot:getRequestedSlot,getGPTSlotForAd:getGPTSlotForAd,createGPTSlotForAd:createGPTSlotForAd,refreshAdvert:refreshAdvert,refreshAdverts:refreshAdverts,refreshAdvertsWithNewTags:refreshAdvertsWithNewTags,requestDelayedAd:requestDelayedAd,includeTrackingTags:includeTrackingTags,loadGpt:function loadGpt(){if(!gptLoading){gptLoading=true;DM.log("ads","Loading GPT");if(!global["_googleTagAlreadyIncluded"]){createAsyncTracker("//www.googletagservices.com/tag/js/gpt.js","googletag")}}},NETWORK_CODE:DFP_NETWORK_CODE})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../../../ads-loading/conf/AdsDescriptions.js":6,"../../../../ads-rendering/AdsRenderer.js":8,"../../../../ads-utils/AdIntegrator.js":63,"../../../../ads-utils/MessageBroker":64,"../../../../ads-utils/adUnit.js":65,"../../../../dom":71,"../../../../emitter":72,"../../../DelayedRenderer.js":9,"../../../HomepageRenderer.js":10,"../../../addLoadListener.js":12,"../../../renderedAds.js":15}],19:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var omit=function omit(obj,excluded){var clone={};excluded=excluded||[];if((typeof obj==="undefined"?"undefined":_typeof(obj))==="object"){for(var key in obj){if(obj.hasOwnProperty(key)&&excluded.indexOf(key)===-1){clone[key]=_.clone(obj[key])}}}return clone};var stringify=function stringify(obj){return jsonStringify(omit(obj,["slots"]))};var jsonStringify=JSON&&typeof JSON.stringify==="function"?JSON.stringify:function(value){switch(typeof value==="undefined"?"undefined":_typeof(value)){case"string":return'"'+value.replace(/("|\\)/g,"\\$1")+'"';case"boolean":case"number":return value.toString();case"object":if(Object.prototype.toString.call(value)==="[object Array]"){return"["+value.map(stringify).join(",")+"]"}else if(value){return"{"+Object.keys(value).map(function(key){return stringify(key)+":"+stringify(value[key])}).join(",")+"}"}case"undefined":case"function":return"null"}};var parse=JSON&&typeof JSON.parse==="function"?JSON.parse:function(value){return eval("data="+value)};module.exports={stringify:stringify,parse:parse}},{}],20:[function(require,module,exports){"use strict";var IsBotDetected=require("./isBotDetected.js");var createAsyncTracker=require("./AsyncTracker.js");function AdsPlugin(baseUrl,isAsync,trackingVariable,asyncChecker){this._baseUrl=baseUrl;this._isAsync=!!isAsync;this._trackingVariable=trackingVariable;this._asyncChecker=asyncChecker;this.initialized=false}AdsPlugin.prototype={constructor:AdsPlugin,init:function init(){var startLoading=(new Date).getTime();if(!this.isBotDetected()&&typeof this._baseUrl!=="undefined"){this.initialized=true;if(this._isAsync){this._asyncTracker=createAsyncTracker(this._baseUrl,this._trackingVariable,null,this._asyncChecker);var self=this;this._asyncTracker.addCallback(function(){var elapsed=(new Date).getTime()-(startLoading||ABE.startTime);self._asyncLoadTime=Math.max(elapsed,self._asyncLoadTime?self._asyncLoadTime:0)})}else{var script="script";document.write("<"+script+' type="text/java'+script+'" src="'+this._baseUrl+'"></'+script+">")}}},getTags:function getTags(){throw new Error("A getTags method needs to be implemented passing the right arguments")},isBotDetected:function isBotDetected(){return IsBotDetected.isBotDetected},getCookie:function getCookie(cookieName){var result="";var parts=("; "+document.cookie).split("; "+cookieName+"=");var decode=/(%[0-9A-Z]{2})+/g;if(parts.length>1){var value=parts.pop().split(";").shift();result=(value.charAt(0)==='"'?value.slice(1,-1):value).replace(decode,decodeURIComponent)}return result},getTagName:function getTagName(){return this._trackingVariable},_asyncTracker:null,_baseUrl:"",_isAsync:false,_trackingVariable:"",_asyncLoadTime:0,_loadTime:0};module.exports=AdsPlugin},{"./AsyncTracker.js":24,"./isBotDetected.js":29}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _UserInactivityMonitor=require("./UserInactivityMonitor");var _UserInactivityMonitor2=_interopRequireDefault(_UserInactivityMonitor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var adListLoader=require("../ads-loading/AdListLoader.js");var adsTrackers=require("../ads-tracking/AdsTrackers.js");var adsRenderer=require("./../ads-rendering/AdsRenderer");var adsDescriptions=require("../ads-loading/conf/AdsDescriptions.js");var logger=require("../ads-logging/AdsLogger.js")("AdsRefresher");var INTERVAL=3e4;var refreshablePlugins=["appnexusPlugin","rubicon"];var refreshables=[];if(~["IE","GB","US","AU"].indexOf(PageCriteria.geo)){refreshables.push("sky_right_top");refreshables.push("sky_left_top")}if(~["IE","GB","AU"].indexOf(PageCriteria.geo)){refreshables.push("sticky_banner")}var AdsRefresher=function(){function AdsRefresher(){_classCallCheck(this,AdsRefresher)}_createClass(AdsRefresher,[{key:"init",value:function init(){var _this=this;logger.log("Starting");googletag.cmd.push(function(){googletag.pubads().addEventListener("impressionViewable",function(){try{_this.startTimer()}catch(e){logger.log("Error setting up refreshing timer",e)}})})}},{key:"startTimer",value:function startTimer(){if(this.stopped||this.positionsToRefresh){return}this.positionsToRefresh=adListLoader.getEnabledSlots().filter(function(s){return~refreshables.indexOf(s)});if(this.positionsToRefresh.length>0){logger.log("The positions",this.positionsToRefresh,"will be refreshed every",Math.trunc(INTERVAL/1e3),"seconds.");this.idsToRefresh=this.positionsToRefresh.map(function(s){return adsDescriptions.ads[s].id});this.inactivityMonitor=new _UserInactivityMonitor2.default;this.scheduleRefreshing()}}},{key:"scheduleRefreshing",value:function scheduleRefreshing(){var _this2=this;this.timer=setInterval(function(){return _this2.tryRefreshingAds()},INTERVAL)}},{key:"tryRefreshingAds",value:function tryRefreshingAds(){var _this3=this;if(this.inactivityMonitor.run(function(){return _this3.refreshAds()})){return}logger.log("Delaying refreshing",this.positionsToRefresh,"until user becomes active again");clearInterval(this.timer);this.timer=undefined;this.inactivityMonitor.run(function(){_this3.scheduleRefreshing()})}},{key:"refreshAds",value:function refreshAds(){logger.log("Refreshing",this.positionsToRefresh);this.prepareToRefreshAds(this.positionsToRefresh);adsRenderer.refreshAdvertsWithNewTags(this.idsToRefresh,this.getRefreshablePlugins())}},{key:"prepareToRefreshAds",value:function prepareToRefreshAds(positions){var plugins=this.getRefreshablePlugins();for(var name in plugins){var plugin=plugins[name];plugin&&plugin.prepareToRefreshAds&&plugin.prepareToRefreshAds(positions)}}},{key:"getRefreshablePlugins",value:function getRefreshablePlugins(){return adsTrackers.getEnabledPlugins().map(function(p){return p.name}).filter(function(p){return~refreshablePlugins.indexOf(p)}).reduce(function(hash,name){hash[name]=adsTrackers.getPluginByName(name);return hash},{})}},{key:"stop",value:function stop(){logger.log("Stopping");if(this.timer){clearInterval(this.timer);this.timer=undefined}this.stopped=true}}]);return AdsRefresher}();exports.default=AdsRefresher},{"../ads-loading/AdListLoader.js":4,"../ads-loading/conf/AdsDescriptions.js":6,"../ads-logging/AdsLogger.js":7,"../ads-tracking/AdsTrackers.js":23,"./../ads-rendering/AdsRenderer":8,"./UserInactivityMonitor":25}],22:[function(require,module,exports){(function(global){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var utils=require("../ads-rendering/utils.js");var plugins=require("../ads-tracking/plugins/index.js");var requestedAds=require("./requestedAds.js");var getErrorReport=require("./getErrorReport.js");var adsTracker=require("./AdsTrackers.js");var startTime=(new Date).valueOf();var sampleRate=1e3;var errors=[];var nativeId="";function feelingLucky(){return Math.floor(Math.random()*sampleRate+1)===1}function tedReportOnUnload(cb){var DM=window.DM;var ted=DM&&DM.ted;var sponsored="sponsored";if(ted){var data={};var adUnit=global.adAreaSiteId+"_"+global.adAreaSiteId+global.adAreaId+"_"+global.adSubareaId+global.adPageType;var index=0;Object.keys(requestedAds).forEach(function(id){var value=requestedAds[id];if(value){if(!value[2]){value[2]=adUnit}if(value[0]){var pos=id.split("|")[0];data["ad"+index++]=value.concat(pos).join("|")}}});if(index||nativeId){data.dev=PageCriteria.device;data.time=(new Date).valueOf()-startTime;data.adUnit=adUnit;data.page=(PageCriteria.sponsored||"").toString()==="true"?sponsored:PageCriteria.pageType;if(nativeId&&data.page===sponsored){data.nid=nativeId}data.aid=PageCriteria.articleId||"";data.ch=PageCriteria.channel;data.sch=PageCriteria.subchannel;if(nativeId){var ccs=plugins.audienceMembershipPlugin.getIds();if(ccs.length){data.cc=ccs.map(function(id){return Number(id).toString(36)}).join("-")}}data.uptime=(new Date).getTime()-ABE.startTime;data.plugins={};data.pluginsAsyncLoad={};adsTracker.getEnabledPlugins().map(function(p){return[p.name,plugins[p.name]]}).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),name=_ref2[0],p=_ref2[1];var shortName=name.replace(/^(.*)Plugin$/,"$1");data.plugins[shortName]=p._loadTime;if(p._asyncLoadTime>0){data.pluginsAsyncLoad[shortName]=p._asyncLoadTime}});tedEvent("ad_report",data)}if(errors.length&&feelingLucky()){var sources=[];var reports=errors.map(function(error){var report=getErrorReport(error,"plugin-failed");var source=report.source;delete source.lid;delete source.cid;source.st=error.plugins;sources.push(report.source);return report});var report=reports[0];report.sources=sources;delete report.source;tedEvent("ad-errors",report)}}typeof cb==="function"&&cb()}function tedEvent(type,params){var url=["http://t.dailymail.co.uk/s/","http://ted.dailymail.co.uk/s/"];params=params||{};params.r=document.referrer;params.g=DM.ted.g||"GB";var urlParams=Object.keys(params).map(function(key){var value=params[key];if((typeof value==="undefined"?"undefined":_typeof(value))==="object"){value=utils.stringify(value)}return[key,value].map(encodeURIComponent).join("=")});url.forEach(function(u){var pixel=new Image(1,1);pixel.src=[u,"l?t=",type,"&",urlParams.join("&"),"&_cb="+Math.random()*1e7].join("")})}module.exports={tedReportOnUnload:tedReportOnUnload,tedEvent:tedEvent,feelingLucky:feelingLucky,errors:errors,setNativeId:function setNativeId(nid){nativeId=nid}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../ads-rendering/utils.js":19,"../ads-tracking/plugins/index.js":46,"./AdsTrackers.js":23,"./getErrorReport.js":27,"./requestedAds.js":58}],23:[function(require,module,exports){"use strict";var _MessageBroker=require("../ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var adsTedReport=require("./AdsTedReport.js");var adTrackingConfig=require("./conf/config.js");var addLoadListener=require("../ads-rendering/addLoadListener.js");var postbox=_MessageBroker2.default.postbox("AdsTracker");var COLLECTION_TIMEOUT=2e3;var initializedPlugins=[];var plugins=require("./plugins/index.js");var requestedAds=require("./requestedAds.js");var getRequestedAds=require("./getRequestedAds.js");var getErrorReport=require("./getErrorReport.js");var loadingPluginsSince={};function collapsePluginConfig(){var finalConfig=_.clone(adTrackingConfig.geoConfig["default"],true);var particularConfig=adTrackingConfig.geoConfig[PageCriteria.geo];if(particularConfig){particularConfig.forEach(function(particularPlugin){finalConfig.forEach(function(plugin){if(plugin.name===particularPlugin.name){plugin.enabled=particularPlugin.enabled}})})}return finalConfig}function isPluginEnabled(plugin){return plugins[plugin.name]&&plugin.enabled===true}function getEnabledPlugins(){return collapsePluginConfig().filter(isPluginEnabled)}function isPluginConfiguredOn(name){var plugin=collapsePluginConfig().find(function(p){return p.name===name});return plugin&&plugin.enabled}function runTrackingPlugins(){getEnabledPlugins().forEach(function(plugin){initPlugin(plugin.name)});addLoadListener(onAdLoaded)}function getEnabledPluginByName(name){var p=getEnabledPlugins().find(function(p){return p.name===name});return p&&plugins[p.name]}function getPluginByName(name){return plugins[name]}function initPlugin(name){var plugin=getEnabledPluginByName(name);if(plugin&&plugin.init&&!plugin.initialized&&initializedPlugins.indexOf(name)===-1){plugin.init();initializedPlugins.push(name)}}function getTags(ad,cb,adPlugins){var collectedTags=[];var enabledPlugins=adPlugins||getEnabledPlugins();requestedAds[[ad.pos,ad.parentId,ad.type||"1x1"].join("|")]=null;if(!enabledPlugins.length){return cb(ad,collectedTags)}postbox.emit("start bidding",ad.pos);var handledPlugins=[];var collectionCompleted=false;function done(pluginName){return function(){postbox.emit("plugin done",ad.pos,pluginName);var p=plugins[pluginName];if(p){var elapsed=(new Date).getTime()-loadingPluginsSince[ad.pos];p._loadTime=Math.max(elapsed,p._loadTime?p._loadTime:0)}if(!collectionCompleted){handledPlugins.push(pluginName);if(handledPlugins.length===enabledPlugins.length){allDone()}}}}function allDone(){postbox.emit("bidding ended",ad.pos);collectionCompleted=true;cb(ad,collectedTags);dfpAsyncHandler.loadGpt()}setTimeout(function(){if(!collectionCompleted){var unhandledPlugins=enabledPlugins.map(function(plugin){return plugin.name}).filter(function(pluginName){var matches=handledPlugins.indexOf(pluginName)===-1;if(matches){var tag={};collectedTags.push(tag)}return matches});unhandledPlugins.forEach(function(pluginName){if(plugins[pluginName].cancel){plugins[pluginName].cancel()}});DM.log("ads",'Fetching tags timed out, skipping "%s" plugins for ad: ',unhandledPlugins.join('", "'),ad);adsTedReport.errors.push({id:ad.parentId,plugins:unhandledPlugins});allDone()}},COLLECTION_TIMEOUT);if(!loadingPluginsSince[ad.pos]){loadingPluginsSince[ad.pos]=(new Date).getTime()}enabledPlugins.forEach(function(plugin){if(!collectionCompleted){plugins[plugin.name].getTags(ad,done(plugin.name),{push:function push(item){postbox.emit("plugin response",ad.pos,plugin.name,item);collectedTags.push(item)}})}})}function onAdLoaded(event){if(event.serviceName==="publisher_ads"&&!event.isEmpty){var ad=event.slot.molAd;var id=[ad.pos,ad.parentId,ad.type||"1x1"].join("|");requestedAds[id]=[event.creativeId,event.lineItemId,ad.adUnit.split("/")[1]]}}miniDom.on(window,"beforeunload",adsTedReport.tedReportOnUnload);function getObjectRequestedAds(){return requestedAds}function sendAlert(html,label){var report=getErrorReport(html,label);if(report){if(DM.later){DM.later("bundle",function(){adsTedReport.tedEvent("ad-errors",report)})}else{adsTedReport.tedEvent("ad-errors",report)}}}function getInitialTrackers(){var initialPlugins=["article","adxChannelPlugin","impIDPlugin","botsPlugin","increaseOnline","devicePlugin","browserResolutionPlugin","criteoPlugin","audienceMembershipPlugin","appnexusPlugin","grapeshotPlugin","mediaDirectPlugin","casaleIndexPlugin","technorati"];var plugins=[];getEnabledPlugins().forEach(function(plugin){if(initialPlugins.indexOf(plugin.name)!==-1){plugins.push(plugin.name)}});return plugins}postbox.on("slots initialized",function(){getInitialTrackers().forEach(initPlugin)});_.extend(module.exports,{AdsPlugin:require("./AdsPlugin.js"),COLLECTION_TIMEOUT:COLLECTION_TIMEOUT,setNativeId:adsTedReport.setNativeId,getRsiValues:function getRsiValues(){return{asi:plugins.audienceSciencePlugin.getRsiValues(),dartCCKey:plugins.audienceMembershipPlugin.getRsiValues(),grapeshot:plugins.grapeshotPlugin.getRsiValues(),prebidtoken:plugins.fanVideo.getRsiValues()}},sendAlert:sendAlert,tedEvent:adsTedReport.tedEvent,feelingLucky:adsTedReport.feelingLucky,getErrorReport:getErrorReport,getTags:getTags,getRequestedAds:getRequestedAds,getObjectRequestedAds:getObjectRequestedAds,runTrackingPlugins:runTrackingPlugins,resetTrackingPlugins:function resetTrackingPlugins(){initializedPlugins.length=0},getEnabledPlugins:getEnabledPlugins,getInitialTrackers:getInitialTrackers,initPlugin:initPlugin,isPluginConfiguredOn:isPluginConfiguredOn,plugins:plugins,isBotDetected:require("./isBotDetected.js"),isPluginEnabled:isPluginEnabled,getPluginByName:getPluginByName})},{"../ads-rendering/addLoadListener.js":12,"../ads-utils/MessageBroker":64,"./AdsPlugin.js":20,"./AdsTedReport.js":22,"./conf/config.js":26,"./getErrorReport.js":27,"./getRequestedAds.js":28,"./isBotDetected.js":29,"./plugins/index.js":46,"./requestedAds.js":58}],24:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var container=_.filter(document.documentElement.childNodes,function(element){return element.nodeType===1})[0]||document.body;function AsyncTracker(name,customChecker){this.name=name;this.callbacks=[];this.customChecker=customChecker}AsyncTracker.prototype={constructor:AsyncTracker,retryCounter:100,retryTimeout:0,check:function check(){var tracker=this;if(tracker.checker()){while(tracker.callbacks.length){tracker.callbacks.shift()(null,window[tracker.name])}}else{if(tracker.retryCounter<0){while(tracker.callbacks.length){tracker.callbacks.shift()(true)}}else if(!tracker.retryTimeout){tracker.retryCounter--;tracker.retryTimeout=setTimeout(function(){tracker.retryTimeout=0;tracker.check()},50)}}return this},checker:function checker(){return this.customChecker?this.customChecker():window[this.name]!==void 0},addCallback:function addCallback(callback){this.callbacks.push(callback);return this.check()},stopRetry:function stopRetry(){this.retryCounter=-1}};function createAsyncTracker(url,name,attributes,customChecker){var tracker=new AsyncTracker(name,customChecker);if(url){var tag=document.createElement("script");tag.async=true;if((typeof attributes==="undefined"?"undefined":_typeof(attributes))==="object"){for(var attribute in attributes){if(attributes.hasOwnProperty(attribute)){tag.setAttribute(attribute,attributes[attribute])}}}tag.src=url;miniDom.on(tag,"error",function(){tracker.stopRetry()});container.appendChild(tag)}return tracker}createAsyncTracker.reset=function reset(){};module.exports=createAsyncTracker},{}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var logger=require("../ads-logging/AdsLogger.js")("UserInactivityMonitor");var USER_INACTIVE_TIME_IN_MS=1e4;var UserInactivityMonitor=function(){function UserInactivityMonitor(){_classCallCheck(this,UserInactivityMonitor);this.queue=[];this.userActivityDetected();try{var cb=this.userActivityDetected.bind(this);$(document).mousemove(cb);$(document).keypress(cb);$(window).scroll(cb);$(document).on("mousewheel",cb);$("body").bind("touchmove",cb);$(window).focus(cb)}catch(e){logger.log("Error setting up user activity monitor",e)}}_createClass(UserInactivityMonitor,[{key:"isUserActive",value:function isUserActive(){return new Date-this.lastActive<USER_INACTIVE_TIME_IN_MS}},{key:"userActivityDetected",value:function userActivityDetected(e){this.lastActive=new Date;if(this.queue.length>0){logger.log("Firing",this.queue.length,"events waiting for user activity triggered by",e&&e.type||"unknown","event");var q=this.queue;this.queue=[];q.forEach(function(fn){return fn()})}}},{key:"run",value:function run(fn){if(this.isUserActive()){fn();return true}this.queue.push(fn);return false}}]);return UserInactivityMonitor}();exports.default=UserInactivityMonitor},{"../ads-logging/AdsLogger.js":7}],26:[function(require,module,exports){
"use strict";module.exports=window.adTrackingConfig&&_&&_.keys(window.adTrackingConfig).length?window.adTrackingConfig:{geoConfig:{AU:[{name:"realTimePricingPlugin",enabled:false}],US:[{name:"amazonPlugin",enabled:true},{name:"openXBidderPlugin",enabled:true}],GB:[{name:"realTimePricingPlugin",enabled:false}],"default":[{name:"criteoPlugin",enabled:true},{name:"audienceSciencePlugin",enabled:true},{name:"audienceMembershipPlugin",enabled:false},{name:"amazonPlugin",enabled:false},{name:"realTimePricingPlugin",enabled:true},{name:"grapeshotPlugin",enabled:true},{name:"mediaDirectPlugin",enabled:true},{name:"sonobiPlugin",enabled:true},{name:"casaleIndexPlugin",enabled:true},{name:"openXBidderPlugin",enabled:true},{name:"yieldbot",enabled:false},{name:"pageFairPlugin",enabled:true},{name:"forensiqPlugin",enabled:false},{name:"botsPlugin",enabled:true}]}}},{}],27:[function(require,module,exports){"use strict";var getRequestedAds=require("./getRequestedAds.js");module.exports=function getErrorReport(html,label){var requestedAds=getRequestedAds();var report;for(var i=requestedAds.length;!report&&i--;){var ad=requestedAds[i];if(ad.id===html.id){report={error:label,ch:PageCriteria.channel,sch:PageCriteria.subchannel,page:(PageCriteria.sponsored||"").toString()==="true"?"sponsored":PageCriteria.pageType,dev:PageCriteria.device,aid:PageCriteria.articleId,source:ad}}}return report}},{"./getRequestedAds.js":28}],28:[function(require,module,exports){"use strict";var requestedAds=require("./requestedAds.js");module.exports=function getRequestedAds(){return Object.keys(requestedAds).map(function(key){var values=requestedAds[key];var ad=key.split("|");var result={pos:ad[0],id:ad[1],sz:ad[2]};if(values){result.cid=values[0];result.lid=values[1]}return result})}},{"./requestedAds.js":58}],29:[function(require,module,exports){"use strict";module.exports={isBotDetected:false}},{}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);var _number=require("../../ads-utils/number");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var plugin=new _AdsPlugin2.default;var MAX_CHANNELS=20;var channels;function createChannels(){channels=[];for(var i=1;i<=MAX_CHANNELS;i++){channels.push(i)}}function getRandomChannelIndex(){return(0,_number.random)(0,channels.length-1)}function getAdxChannel(){if(channels.length){var index=getRandomChannelIndex();return channels.splice(index,1)}}createChannels();plugin.reset=createChannels;plugin.getTagName=function(){return"adxChannel"};plugin.getTags=function(ad,done,tags){var channel=getAdxChannel();if(!plugin.isBotDetected()&&channel){tags.push({adx_channel:channel})}done()};exports.default=plugin},{"../../ads-utils/number":70,"../AdsPlugin":20}],31:[function(require,module,exports){(function(global){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var URL="//c.amazon-adsystem.com/aax2/amzn_ads.js";var TRACKING_VARIABLE="amznadsLoaded";var PHONE=PageCriteria.isMobile&&!PageCriteria.isTablet;var AmazonPlugin=function(_Plugin){_inherits(AmazonPlugin,_Plugin);function AmazonPlugin(){_classCallCheck(this,AmazonPlugin);return _possibleConstructorReturn(this,(AmazonPlugin.__proto__||Object.getPrototypeOf(AmazonPlugin)).call(this,URL,true,TRACKING_VARIABLE))}_createClass(AmazonPlugin,[{key:"init",value:function init(){var configVariable="amznads";this.config=global[configVariable]=global[configVariable]||{};this.config.asyncParams={id:"3065",callbackFn:function callbackFn(){global[TRACKING_VARIABLE]=1},timeout:2e3,data:{mt:"D"}};_get(AmazonPlugin.prototype.__proto__||Object.getPrototypeOf(AmazonPlugin.prototype),"init",this).call(this)}},{key:"getTokenName",value:function getTokenName(size){if(PHONE){switch(size){case"300x250":return"3x2";case"320x50":return"3x5";default:return size}}else{switch(size){case"120x600":case"160x600":return"1x6";case"300x600":return"3x6";case"970x250":return"9x2";default:return size}}}},{key:"tag",value:function tag(ad,done,tags){var _this2=this;var sizes=(ad.type||"1x1").split(",");var tokens=sizes.reduce(function(tokens,size){return tokens.concat(_this2.config.getTokens(_this2.getTokenName(size)))},[]);if(tokens.length){tags.push(_defineProperty({},this.getTagName(),tokens))}done()}},{key:"getTags",value:function getTags(ad,done,tags){var _this3=this;if(this.isBotDetected()){done()}else{this._asyncTracker.addCallback(function(err){if(err){done()}else{_this3.tag(ad,done,tags)}})}}},{key:"getTagName",value:function getTagName(){return"amznslots"}}]);return AmazonPlugin}(_AdsPlugin2.default);module.exports=new AmazonPlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../AdsPlugin":20}],32:[function(require,module,exports){"use strict";var Plugin=require("../AdsPlugin");var plugin=new Plugin;plugin.getTags=function(ad,done,tags){if(PageCriteria.articleStyle){tags.push({style:PageCriteria.articleStyle})}done()};module.exports=plugin},{"../AdsPlugin":20}],33:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var AdsPlugin=require("../AdsPlugin.js");var audienceMembershipPlugin=function(domain,clientId,trackingVariable){var plugin=new AdsPlugin("",true,trackingVariable);var MAX_TAGS=40;function getNoDomainCookieUrl(){var domain=plugin.getCookie("_cc_domain");if(domain){return composeUrl(domain)}}function getIdCookieUrl(){var id=plugin.getCookie("_cc_id");if(id){return composeUrl(domain,id)}}function composeUrl(domain,id,portNumber){var url="//ad"+domain;if(portNumber){url+=":"+portNumber}url+="/5/c="+clientId+"/pe=y/var="+trackingVariable;if(id){url+="/pid="+id}return url}function toAbbr(segment){return segment&&segment.abbr}function isValidKey(name){return name&&name.slice(0,2)==="DM"}plugin.init=function(){plugin._baseUrl=getNoDomainCookieUrl()||getIdCookieUrl()||composeUrl(domain);AdsPlugin.prototype.init.call(plugin)};plugin.getTags=function(ad,done,tags){if(plugin.isBotDetected()){done()}else{plugin._asyncTracker.addCallback(onLoaded)}function onLoaded(err,data){if(!err&&(typeof data==="undefined"?"undefined":_typeof(data))==="object"){var ccTags=plugin.getRsiValues(data);var tag={};if(ccTags.length){tag[plugin.getTagName()]=ccTags}else{tag.lt=["none"]}tag.lpid=[data.Profile.pid];tags.push(tag)}done()}};plugin.getTagName=function(){return"dartCCKey"};plugin.getRsiValues=function(data){if(!data){data=window[trackingVariable]}return(data&&data.Profile.Audiences.Audience||[]).map(toAbbr).filter(isValidKey).slice(0,MAX_TAGS)};plugin.getIds=function(){var tracking=window[trackingVariable];var audiences=tracking&&tracking.Profile.Audiences.Audience||[];return audiences.map(function(audience){return audience&&audience.id})};return plugin}(".crwdcntrl.net",991,"ccauds");module.exports=audienceMembershipPlugin},{"../AdsPlugin.js":20}],34:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var audienceSciencePlugin=function(baseUrl,isAsync,trackingVariable){var plugin=new AdsPlugin(baseUrl,isAsync,trackingVariable);var rsiSegs=[];var MAX_TAGS=5;plugin.getTags=function(ad,done,tags){if(!plugin.isBotDetected()){var name=plugin.getTagName();var segQS={};rsiSegs=plugin.getCookie(name+"_segs").split("|");segQS[name]=rsiSegs.length?rsiSegs.slice(0,MAX_TAGS):["null"];tags.push(segQS)}done()};plugin.getTagName=function(){return"asi"};plugin.getRsiValues=function(){return rsiSegs.slice()};return plugin}("http://js.revsci.net/gateway/gw.js?csid=D05509&auto=t",true,"rsi_csid");module.exports=audienceSciencePlugin},{"../AdsPlugin.js":20}],35:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var adverts=require("../../AdsManager.js");var isBotDetected=require("../../ads-tracking/isBotDetected.js");var plugin=new AdsPlugin;function parseConfiguration(config){config=config.split("|");return{ip:config[0],userAgent:config[1]==="*"?undefined:config[1]}}function getConfiguredBotFilters(){var filters=[];if(adverts&&adverts.botIPs){var currentHour=(new Date).getUTCHours();var botIPs=adverts.botIPs[currentHour]||[];filters=botIPs.map(parseConfiguration)}return filters}function isConfiguredBot(){var configuredBotFilters=getConfiguredBotFilters();var isBotDetected=false;var filter;for(var i=0;i<configuredBotFilters.length;i++){filter=configuredBotFilters[i];isBotDetected=PageCriteria.clientIP===filter.ip;if(filter.userAgent){isBotDetected=isBotDetected&&navigator.userAgent===filter.userAgent}if(isBotDetected)break}return isBotDetected}plugin.init=function(){isBotDetected.isBotDetected=isConfiguredBot()||/(?:[bB]ot|BOT|GrapeshotCrawler)s?\b/.test(navigator.userAgent);AdsPlugin.prototype.init.call(plugin)};plugin.getTags=function(ad,done,tags){if(plugin.isBotDetected()){var tag={};tag[plugin.getTagName()]=["true"];tags.push(tag)}done()};plugin.getTagName=function(){return"bot"};module.exports=plugin},{"../../AdsManager.js":2,"../../ads-tracking/isBotDetected.js":29,"../AdsPlugin.js":20}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);var _browser=require("../../ads-utils/browser");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var plugin=new _AdsPlugin2.default;var CONFIG={min_1244px:{min:{width:1244}},large_android_device:{android_min:[{width:720,height:1280}],android_max:[{width:2e3,height:5e3}]}};var resolutions;function between(value,min,max){return value>=min&&value<=max}function screenInRange(minimum,maximum){if(!minimum&&!maximum){return false}var min=minimum||{};var max=maximum||{};var minWidth=min.width||-1;var minHeight=min.height||-1;var screenSize=(0,_browser.getSize)({usePixelRatio:true});var maxWidth=max.width||screenSize.width;var maxHeight=max.height||screenSize.height;return between(screenSize.width,minWidth,maxWidth)&&between(screenSize.height,minHeight,maxHeight)}function findResolutions(){if(resolutions)return;resolutions=[];_.forEach(CONFIG,function(range,name){if(screenInRange(range.min,range.max)&&!PageCriteria.isMobile){resolutions.push(name)}else if(screenInRange(range.android_min,range.android_max)&&PageCriteria.isMobile){resolutions.push(name)}})}plugin.reset=function(){resolutions=void 0;findResolutions()};plugin.getTagName=function(){return"browserResolution"};plugin.getTags=function(ad,done,tags){if(!plugin.isBotDetected()){findResolutions();var tag={};tag[plugin.getTagName()]=resolutions;tags.push(tag)}done()};miniDom.on(window,"resize",plugin.reset);exports.default=plugin},{"../../ads-utils/browser":69,"../AdsPlugin":20}],37:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};require("../../vendor/cygnus");var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);var _AdsDescriptions=require("../../ads-loading/conf/AdsDescriptions");var _AdsDescriptions2=_interopRequireDefault(_AdsDescriptions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var IS_COUNTER=/^_\d+$/;var SITE_IDS={desktop:158654,smartphone:159312,tablet:159313};var DEVICE_MAP={iphone:"smartphone",androidMobile:"smartphone",ipad:"tablet",androidTablet:"tablet",other:"desktop"};var getDevice=function getDevice(){return DEVICE_MAP[PageCriteria.device]||DEVICE_MAP.other};var CasaleIndexPlugin=function(_Plugin){_inherits(CasaleIndexPlugin,_Plugin);function CasaleIndexPlugin(config){_classCallCheck(this,CasaleIndexPlugin);var _this=_possibleConstructorReturn(this,(CasaleIndexPlugin.__proto__||Object.getPrototypeOf(CasaleIndexPlugin)).call(this,"",true,"index_slots"));_this.config=config;_this.cygnusInitialized=false;return _this}_createClass(CasaleIndexPlugin,[{key:"getIndexSlots",value:function getIndexSlots(availableSlots){var _this2=this;var slots=[];var usedSlots={};availableSlots.forEach(function(slotName){if(slotName in _this2.config.mapping){_this2.config.mapping[slotName].forEach(function(indexSlot){if(!(indexSlot in usedSlots)){usedSlots[indexSlot]=1;slots.push(_this2.config.slots[indexSlot])}})}});return slots}},{key:"hasIndexSlotInMapping",value:function hasIndexSlotInMapping(indexSlot,adSlots){var found=false;for(var i=adSlots.length;!found&&i--;){var slot=adSlots[i];var slotLength=slot.length;found=indexSlot.slice(0,slotLength)===slot&&IS_COUNTER.test(indexSlot.slice(slotLength))}return found}},{key:"prepareToRefreshAds",value:function prepareToRefreshAds(){if(global.index_slots){global.index_slots=undefined;this.init()}}},{key:"init",value:function init(){var _this3=this;global.cygnus_index_ready_state=function(){_this3.cygnusInitialized=true};var indexSlots=this.getIndexSlots(adListLoader.getEnabledRenderedSlots());if(indexSlots.length){global.IndexArgs={siteID:SITE_IDS[getDevice()],slots:indexSlots};global.cygnus_index_start(true);_get(CasaleIndexPlugin.prototype.__proto__||Object.getPrototypeOf(CasaleIndexPlugin.prototype),"init",this).call(this)}}},{key:"getTags",value:function getTags(ad,done,tags){var _this4=this;var onLoaded=function onLoaded(err){var indexSlots=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(err){return done(err)}var found=false;if(indexSlots.length){var privateSlots=[];var mappedSlots=[];DM.log("ads","casale slots",indexSlots);for(var i=indexSlots.length;i--;){var indexSlot=indexSlots[i];var key=indexSlot.slice(0,2);var value=indexSlot.slice(2);if(_this4.hasIndexSlotInMapping(value,adSlots)){found=true;if(key==="O_"){mappedSlots.push(value)}if(key==="P_"){privateSlots.push(value)}}}if(mappedSlots.length){tags.push(_defineProperty({},"index_"+getDevice(),mappedSlots))}if(privateSlots.length){tags.push({P:privateSlots})}}done(found)};var adSlots=this.config.mapping[ad.pos];if(adSlots&&(this.cygnusInitialized||this._asyncTracker)&&!this.isBotDetected()){if(this.cygnusInitialized){onLoaded(null,global[this._trackingVariable])}else{this._asyncTracker.addCallback(onLoaded)}}else{done()}}}]);return CasaleIndexPlugin}(_AdsPlugin2.default);exports.default=new CasaleIndexPlugin({slots:{mail_banner_top:{id:"mail_banner_top",width:468,height:60},mail_billboard:{id:"mail_billboard",width:970,height:250},mail_billboard_728:{id:"mail_billboard_728",width:728,height:90},mail_ldr_top:{id:"mail_ldr_top",width:728,height:90},mail_leader_middle:{id:"mail_leader_middle",width:728,height:90},mail_leader_middle_970:{id:"mail_leader_middle_970",width:970,height:250},mail_leader_lower_middle:{id:"mail_leader_lower_middle",width:728,height:90},mail_leader_lower_middle_970:{id:"mail_leader_lower_middle_970",width:970,height:250},mail_leader_bottom:{id:"mail_leader_bottom",width:728,height:90},mail_leader_bottom_970:{id:"mail_leader_bottom_970",width:970,height:250},mail_leader_very_bottom:{id:"mail_leader_very_bottom",width:728,height:90},mail_leader_very_bottom_970:{id:"mail_leader_very_bottom_970",width:970,height:250},mail_mpu_puff_10:{id:"mail_mpu_puff_10",width:300,height:250},mail_mpu_puff_10_600:{id:"mail_mpu_puff_10_600",width:300,height:600},mail_mpu_puff_15:{id:"mail_mpu_puff_15",width:300,height:250},mail_mpu_puff_15_600:{id:"mail_mpu_puff_15_600",width:300,height:600},mail_mpu_top_zero:{id:"mail_mpu_top_zero",width:300,height:600},mail_mpu_top:{id:"mail_mpu_top",width:300,height:250},mail_mpu_mobile_lower_middle:{id:"mail_mpu_mobile_lower_middle",width:300,height:250},mail_mpu_mobile_upper_middle:{id:"mail_mpu_mobile_upper_middle",width:300,height:250},mail_sky_right_top:{id:"mail_sky_right_top",width:120,height:600},mail_sky_right_top_160:{id:"mail_sky_right_top_160",width:160,height:600},mail_sky_right_top_300:{id:"mail_sky_right_top_300",width:300,height:600},mail_sky_left_top:{id:"mail_sky_left_top",width:120,height:600},mail_sky_left_top_160:{id:"mail_sky_left_top_160",width:160,height:600},mail_sky_left_top_300:{id:"mail_sky_left_top_300",width:300,height:600},mail_sticky_banner:PageCriteria.isMobile&&!PageCriteria.isTablet?{id:"mail_sticky_banner",width:320,height:50}:{id:"mail_sticky_banner",width:980,height:90},mail_mpu_middle:{id:"mail_mpu_middle",width:300,height:250},mail_mpu_bottom:{id:"mail_mpu_bottom",width:300,height:250},mail_mpu_home:{id:"mail_mpu_home",width:300,height:250},mail_mpu_puff_20:{id:"mail_mpu_puff_20",width:300,height:250},mail_mpu_puff_30:{id:"mail_mpu_puff_30",width:300,height:250},mail_mpu_puff_45:{id:"mail_mpu_puff_45",width:300,height:250},mail_mpu_bottom_right:{id:"mail_mpu_bottom_right",width:300,height:250},mail_mpu_mobile:{id:"mail_mpu_mobile",width:300,height:250},mail_mpu_mobile_top:{id:"mail_mpu_mobile_top",width:300,height:250},mail_mpu_middle_600:{id:"mail_mpu_middle_600",width:300,height:600},mail_mpu_bottom_600:{id:"mail_mpu_bottom_600",width:300,height:600},mail_mpu_mobile_bottom:{id:"mail_mpu_bottom",width:300,height:250}},mapping:{banner_top:["mail_banner_top"],ldr_top:["mail_ldr_top"],leader_middle:["mail_leader_middle","mail_leader_middle_970"],leader_lower_middle:["mail_leader_lower_middle","mail_leader_lower_middle_970"],leader_bottom:["mail_leader_bottom","mail_leader_bottom_970"],leader_very_bottom:["mail_leader_very_bottom","mail_leader_very_bottom_970"],sky_right_top:["mail_sky_right_top_300","mail_sky_right_top","mail_sky_right_top_160"],sky_left_top:["mail_sky_left_top_300","mail_sky_left_top","mail_sky_left_top_160"],sticky_banner:["mail_sticky_banner"],billboard:~_AdsDescriptions2.default.get("billboard").type.indexOf("728x90")?["mail_billboard","mail_billboard_728"]:["mail_billboard"],mpu_home:["mail_mpu_home"],mpu_top:["mail_mpu_top"],mpu_top_zero:["mail_mpu_top","mail_mpu_top_zero"],mpu_puff_10:["mail_mpu_puff_10","mail_mpu_puff_10_600"],mpu_puff_15:["mail_mpu_puff_15","mail_mpu_puff_15_600"],mpu_mobile_top:["mail_mpu_mobile_top"],mpu_mobile:["mail_mpu_mobile"],mpu_middle:["mail_mpu_middle"],mpu_middle_zero:["mail_mpu_middle","mail_mpu_middle_600"],mpu_bottom:["mail_mpu_bottom"],mpu_bottom_zero:["mail_mpu_bottom","mail_mpu_bottom_600"],mpu_bottom_right:["mail_mpu_bottom_right"],mpu_bottom_right_zero:["mail_mpu_bottom_right"],mpu_mobile_lower_middle:["mail_mpu_mobile_lower_middle"],mpu_mobile_upper_middle:["mail_mpu_mobile_upper_middle"],mpu_puff_20:["mail_mpu_puff_20"],mpu_puff_30:["mail_mpu_puff_30"],mpu_puff_45:["mail_mpu_puff_45"],mpu_mobile_bottom:["mail_mpu_mobile_bottom"]}})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../ads-loading/conf/AdsDescriptions":6,"../../vendor/cygnus":75,"../AdsPlugin":20}],38:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("../AdsPlugin");var adsManager=require("../../AdsManager");global.Criteo=global.Criteo||{};global.Criteo.events=global.Criteo.events||[];var CriteoGooglePlugin=function(_Plugin){_inherits(CriteoGooglePlugin,_Plugin);function CriteoGooglePlugin(){_classCallCheck(this,CriteoGooglePlugin);return _possibleConstructorReturn(this,(CriteoGooglePlugin.__proto__||Object.getPrototypeOf(CriteoGooglePlugin)).call(this,"//static.criteo.net/js/ld/publishertag.js",true,"Criteo"))}_createClass(CriteoGooglePlugin,[{key:"init",value:function init(){_get(CriteoGooglePlugin.prototype.__proto__||Object.getPrototypeOf(CriteoGooglePlugin.prototype),"init",this).call(this);DM.log("ads","CriteoGoogle plugin will replace all calls to `adsManager.requestGoogleAd`");adsManager.requestGoogleAd=function(_ref){var containerid=_ref.containerid;global.Criteo.events.push(function(){global.Criteo.DisplayAd({zoneid:484567,containerid:containerid})})}}},{key:"getTags",value:function getTags(ad,done){done()}}]);return CriteoGooglePlugin}(Plugin);exports.default=new CriteoGooglePlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../AdsManager":2,"../AdsPlugin":20}],39:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var criteoPlugin=function(trackingVariable){var escape=encodeURIComponent;var nid="1867";var cookieName="cto_dailymail";var baseUrl=["//rtax.criteo.com/delivery/rta/rta.js?netId=",escape(nid),"&cookieName=",escape(cookieName),"&rnd=",Math.floor(Math.random()*1e11),"&varName=",escape(trackingVariable)].join("");var plugin=new AdsPlugin(baseUrl,true,trackingVariable);plugin.init=function(){AdsPlugin.prototype.init.call(this);window[trackingVariable]=plugin.getCookie(cookieName)||void 0};plugin.getTags=function(ad,done,tags){if(!plugin.isBotDetected()){plugin._asyncTracker.addCallback(function(err,content){if(err){return done(err)}var found=false;if(content){content.split(";").forEach(function(tuple){if(tuple){var criteoTags={};var info=tuple.split("=");criteoTags[info[0]]=[info[1]];found=true;tags.push(criteoTags)}})}done(found)})}else{done()}};return plugin}("crtg_content");module.exports=criteoPlugin},{"../AdsPlugin.js":20}],40:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var plugin=new AdsPlugin;var device,deviceFeatures;var screenSizes=[window.screen.width,window.screen.height];if(MobileUtils.isLandscape())screenSizes.reverse();var devices={iphone:{iphone6:function iphone6(){return deviceSizeMatches([375,667])},iphone6p:function iphone6p(){return deviceSizeMatches([414,736])},iphone5:function iphone5(){return deviceSizeMatches([320,568])}},other:{windows10:isWindows10}};var possibleFeatures={touch:isTouchDevice};plugin.getTags=function(ad,done,tags){device=device||findDevice();deviceFeatures=deviceFeatures||findDeviceFeatures();var tag={};tag[plugin.getTagName()]=[device];tag[plugin.getTagName()+"_features"]=deviceFeatures;tags.push(tag);done()};plugin.getTagName=function(){return"device"};function deviceSizeMatches(sizes){return sizes[0]===screenSizes[0]&&sizes[1]===screenSizes[1]}function findDevice(){var device;var predicates=devices[PageCriteria.device];if(predicates){var deviceNames=Object.keys(predicates);for(var i=0;i<deviceNames.length;i++){var deviceName=deviceNames[i];if(predicates[deviceName]()){device=deviceName;break}}}if(!device){device=PageCriteria.device}return device}function findDeviceFeatures(){var deviceFeatures=[];_.each(possibleFeatures,function(predicate,name){if(predicate())deviceFeatures.push(name)});return deviceFeatures}function isWindows10(){var re=/(Windows\s*[a-zA-Z]*)\s+([^;\s)]+)/i;var match=re.exec(navigator.userAgent);return match&&match[1].toLowerCase()==="windows nt"&&parseFloat(match[2])>=6.4}function isTouchDevice(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}module.exports=plugin},{"../AdsPlugin.js":20}],41:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TABLET=PageCriteria.isTablet;var PHONE=PageCriteria.isMobile&&!TABLET;var PLACEMENT_ID=function(geo){switch(geo){case"GB":if(PHONE)return"794319217371456_799794430157268";else if(TABLET)return"794319217371456_800745703395474";else return"794319217371456_799795073490537";case"US":if(PHONE)return"1364540910239965_1420936821267040";else if(TABLET)return"1364540910239965_1420941611266561";else return"1364540910239965_1420936204600435"}}(PageCriteria.geo);var FanVideoPlugin=function(_Plugin){_inherits(FanVideoPlugin,_Plugin);function FanVideoPlugin(){_classCallCheck(this,FanVideoPlugin);var _this=_possibleConstructorReturn(this,(FanVideoPlugin.__proto__||Object.getPrototypeOf(FanVideoPlugin)).call(this,"//connect.facebook.com/en_US/AudienceNetworkPrebid.js",true,"AudienceNetworkPrebid"));_this.token=undefined;return _this}_createClass(FanVideoPlugin,[{key:"init",value:function init(){var _this2=this;if(!PLACEMENT_ID)return;_get(FanVideoPlugin.prototype.__proto__||Object.getPrototypeOf(FanVideoPlugin.prototype),"init",this).call(this);this._asyncTracker.addCallback(function(){var video=document.querySelector(".vjs-video-container .video-js");if(video){var prebid=new global.AudienceNetworkPrebid(PLACEMENT_ID,video);

prebid.getProfile(function(profile){_this2.token=profile.token})}})}},{key:"getRsiValues",value:function getRsiValues(){return this.token||"nobid"}},{key:"getTags",value:function getTags(ad,done){done()}}]);return FanVideoPlugin}(_AdsPlugin2.default);exports.default=new FanVideoPlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../AdsPlugin":20}],42:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var createAsyncTracker=require("../AsyncTracker.js");var plugin=new AdsPlugin;var initialized=false;plugin.getTags=function(ad,done){done();if(!plugin.isBotDetected()&&!initialized){initialized=true;DM.later("DOM_READY",function(){createAsyncTracker(plugin.getUrl(),"SecurePaths")})}};plugin.getUrl=function(requestType){if(!plugin.url){var pc=PageCriteria;var queryString=[["org","vu3aqazeyE3acUwAzu7r"],["p",pc.channel],["a",pc.subchannel],["c1",pc.geo],["c2",pc.pageType],["c3",pc.device],["c4",pc.articleId||""],["rt",requestType||"display"],["sl","1"],["fmt","banner"]].map(function(pair){return pair.map(encodeURIComponent).join("=")});plugin.url="//c.fqtag.com/tag/implement-r.js?"+queryString.join("&")}return plugin.url};module.exports=plugin},{"../AdsPlugin.js":20,"../AsyncTracker.js":24}],43:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var grapeshotPlugin=function(trackingVariable,url,global){var gsurl=global.location!==global.top.location?document.referrer:global.location;var plugin=new AdsPlugin(url+encodeURIComponent(gsurl),true,trackingVariable);plugin.getTags=function(ad,done,tags){if(plugin.isBotDetected()){done()}else{plugin._asyncTracker.addCallback(onLoaded)}function onLoaded(err,data){tags.push({grapeshot:!err&&data?data:["DEFAULT"]});done()}};plugin.getRsiValues=function(){var defaultValue="DEFAULT";return[window[trackingVariable]||defaultValue,window["gs_us_channels"]||defaultValue]};return plugin}("gs_channels","//gs.dailymail.co.uk/main/channels-gpt.cgi?url=",window);module.exports=grapeshotPlugin},{"../AdsPlugin.js":20}],44:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var ID_TEMPLATE="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";var plugin=new AdsPlugin;plugin.generate=function(){this.id=generateID()};plugin.getTags=function(ad,done,tags){if(!plugin.isBotDetected()){tags.push({random:[this.id],impid:[generateID()]})}done()};plugin.generate();function generateID(){return ID_TEMPLATE.replace(/[xy]/g,transformTemplate)}function transformTemplate(templateChar){return charToNumber(templateChar).toString(16)}function generateNumber(){return Math.random()*16|0}function charToNumber(char){var randomNumber=generateNumber();return char==="x"?randomNumber:randomNumber&3|8}module.exports=plugin},{"../AdsPlugin.js":20}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _number=require("../../ads-utils/number");exports.default={init:function init(){this.initialized=true;var date=new Date;this.hour=date.getUTCHours();this.minutes=date.getUTCMinutes()},getTags:function getTags(ad,done,tags){tags.push({ncrse_hod:this.hour,ncrse_moh:this.minutes,ncrse_segment:(0,_number.random)(-1,99)});done()},getTagName:function getTagName(){return"increase-online"}}},{"../../ads-utils/number":70}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.openx=exports.openXBidderPlugin=exports.yieldbot=exports.technorati=exports.sonobiPlugin=exports.shareThrough=exports.rubicon=exports.realTimePricingPlugin=exports.prizel=exports.pageFairPlugin=exports.mediaDirectPlugin=exports.impIDPlugin=exports.grapeshotPlugin=exports.forensiqPlugin=exports.fanVideo=exports.fan=exports.increaseOnline=exports.devicePlugin=exports.criteoGooglePlugin=exports.criteoPlugin=exports.casaleIndexPlugin=exports.browserResolutionPlugin=exports.botsPlugin=exports.audienceSciencePlugin=exports.audienceMembershipPlugin=exports.article=exports.appnexusPlugin=exports.amazonPlugin=exports.adxChannelPlugin=undefined;var _adxchannel=require("./adxchannel");Object.defineProperty(exports,"adxChannelPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_adxchannel).default}});var _amazon=require("./amazon");Object.defineProperty(exports,"amazonPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_amazon).default}});var _prebid=require("./prebid");Object.defineProperty(exports,"appnexusPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_prebid).default}});var _article=require("./article");Object.defineProperty(exports,"article",{enumerable:true,get:function get(){return _interopRequireDefault(_article).default}});var _audiencemembership=require("./audiencemembership");Object.defineProperty(exports,"audienceMembershipPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_audiencemembership).default}});var _audiencescience=require("./audiencescience");Object.defineProperty(exports,"audienceSciencePlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_audiencescience).default}});var _bots=require("./bots");Object.defineProperty(exports,"botsPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_bots).default}});var _browsersResolution=require("./browsersResolution");Object.defineProperty(exports,"browserResolutionPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_browsersResolution).default}});var _casaleindex=require("./casaleindex");Object.defineProperty(exports,"casaleIndexPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_casaleindex).default}});var _criteo=require("./criteo");Object.defineProperty(exports,"criteoPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_criteo).default}});var _criteoGoogle=require("./criteo-google");Object.defineProperty(exports,"criteoGooglePlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_criteoGoogle).default}});var _device=require("./device");Object.defineProperty(exports,"devicePlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_device).default}});var _increaseOnline=require("./increaseOnline");Object.defineProperty(exports,"increaseOnline",{enumerable:true,get:function get(){return _interopRequireDefault(_increaseOnline).default}});Object.defineProperty(exports,"fan",{enumerable:true,get:function get(){return _interopRequireDefault(_prebid).default}});var _fanVideo=require("./fanVideo");Object.defineProperty(exports,"fanVideo",{enumerable:true,get:function get(){return _interopRequireDefault(_fanVideo).default}});var _forensiq=require("./forensiq");Object.defineProperty(exports,"forensiqPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_forensiq).default}});var _grapeshot=require("./grapeshot");Object.defineProperty(exports,"grapeshotPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_grapeshot).default}});var _impid=require("./impid");Object.defineProperty(exports,"impIDPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_impid).default}});var _mediadirect=require("./mediadirect");Object.defineProperty(exports,"mediaDirectPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_mediadirect).default}});var _pagefair=require("./pagefair");Object.defineProperty(exports,"pageFairPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_pagefair).default}});var _prizel=require("./prizel");Object.defineProperty(exports,"prizel",{enumerable:true,get:function get(){return _interopRequireDefault(_prizel).default}});var _realtimepricing=require("./realtimepricing");Object.defineProperty(exports,"realTimePricingPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_realtimepricing).default}});var _rubicon=require("./rubicon");Object.defineProperty(exports,"rubicon",{enumerable:true,get:function get(){return _interopRequireDefault(_rubicon).default}});var _sharethrough=require("./sharethrough");Object.defineProperty(exports,"shareThrough",{enumerable:true,get:function get(){return _interopRequireDefault(_sharethrough).default}});var _sonobi=require("./sonobi");Object.defineProperty(exports,"sonobiPlugin",{enumerable:true,get:function get(){return _interopRequireDefault(_sonobi).default}});var _technorati=require("./technorati");Object.defineProperty(exports,"technorati",{enumerable:true,get:function get(){return _interopRequireDefault(_technorati).default}});var _yieldbot=require("./yieldbot");Object.defineProperty(exports,"yieldbot",{enumerable:true,get:function get(){return _interopRequireDefault(_yieldbot).default}});var _openx=require("./openx");var _openx2=_interopRequireDefault(_openx);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var openXBidderPlugin=exports.openXBidderPlugin=new _openx2.default;var openx=exports.openx=new _openx2.default(true)},{"./adxchannel":30,"./amazon":31,"./article":32,"./audiencemembership":33,"./audiencescience":34,"./bots":35,"./browsersResolution":36,"./casaleindex":37,"./criteo":39,"./criteo-google":38,"./device":40,"./fanVideo":41,"./forensiq":42,"./grapeshot":43,"./impid":44,"./increaseOnline":45,"./mediadirect":47,"./openx":48,"./pagefair":49,"./prebid":50,"./prizel":51,"./realtimepricing":52,"./rubicon":53,"./sharethrough":54,"./sonobi":55,"./technorati":56,"./yieldbot":57}],47:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var AdsPlugin=require("../AdsPlugin.js");var adListLoader=require("../../ads-loading/AdListLoader.js");var mediaDirectPlugin=function(trackingVariable){var IE_970_250="hX4wRQ";var config={AU:{mpu_puff_10:"oYn8ql"},IE:{mpu_top:"I4X5ub",mpu_puff_10:"I4X5ub",mpu_mobile:undefined,sticky_banner:"xdPJRf",mpu_mobile_top:"yK5yKz",billboard:IE_970_250,leader_middle:IE_970_250,leader_lower_middle:IE_970_250,leader_bottom:IE_970_250,leader_very_bottom:IE_970_250},"default":{mpu_top:"ABDijE",mpu_puff_10:"ABDijE",mpu_mobile:"pVUSTC",mpu_mobile_top:"pVUSTC",ldr_top:"JaNgyj",billboard:"WjxERZ",sticky_banner:"MP40j5"}};var mediaDirectPlacements=_.extend({},config.default,config[PageCriteria.geo]||{});Object.keys(mediaDirectPlacements).forEach(function(key){var value=mediaDirectPlacements[key];if(value===undefined){delete mediaDirectPlacements[key]}});function getUrl(){var url="";var codes=[];if(!window[trackingVariable]){var enabledSlots=adListLoader.getEnabledRenderedSlots();var mediaDirectSlots=Object.keys(mediaDirectPlacements);var i=enabledSlots.length;var mediaDirectSlot=void 0;var slot=void 0;while(i--){slot=enabledSlots[i];for(var j=mediaDirectSlots.length;j--;){mediaDirectSlot=mediaDirectSlots[j];if(slot.slice(0,mediaDirectSlot.length)===mediaDirectSlot){codes.push(mediaDirectPlacements[mediaDirectSlot])}}}}if(codes.length){var set=[];for(var _i=codes.length-1;_i>=0;_i--){var id=codes[_i];set.indexOf(id)===-1&&set.push(id)}url="//pq-direct.revsci.net/pql?placementIdList="+set.join(",")+"&cb="+(new Date).getTime()}return url}var plugin=new AdsPlugin("",true,trackingVariable);plugin.init=function(){this._baseUrl=getUrl();AdsPlugin.prototype.init.call(this)};plugin.prepareToRefreshAds=function(){if(typeof window[trackingVariable]!=="undefined"){window[trackingVariable]=undefined;this.init()}};plugin.getTags=function(ad,done,tags){if(!plugin.isBotDetected()&&plugin._asyncTracker){plugin._asyncTracker.addCallback(onLoaded)}else{done()}function onLoaded(err,data){if(!err&&(typeof data==="undefined"?"undefined":_typeof(data))==="object"){var placementName="ASPQ_"+mediaDirectPlacements[ad.pos];if(mediaDirectPlacements[ad.pos]){if(!(placementName in window)){createMediaDirectVars(data)}if(window[placementName]){tags.push(window[placementName])}}}done();function createMediaDirectVars(asiPlacements){for(var p in asiPlacements){var placementName="ASPQ_"+p;window[placementName]="";for(var key in asiPlacements[p].data){var map={};map["PQ_"+p]=[key];window[placementName]=map}}}}};return plugin}("asiPlacements");module.exports=mediaDirectPlugin},{"../../ads-loading/AdListLoader.js":4,"../AdsPlugin.js":20}],48:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);var _AdListLoader=require("../../ads-loading/AdListLoader");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NETWORK_CODE=5765;var URL="//mailonline-d.openx.net/w/1.0/jstag?nc="+NETWORK_CODE+"-dailymail";var ZONE="dailymail.uk";var MAP={mpu_mobile:{size:["300x250"]},mpu_mobile_bottom:{size:["300x250"]},mpu_mobile_lower_middle:{size:["300x250"]},mpu_mobile_top:{size:["300x250"]},mpu_mobile_upper_middle:{size:["300x250"]},mpu_top_zero:{pos:"dmpu"}};var OpenXPlugin=function(_Plugin){_inherits(OpenXPlugin,_Plugin);function OpenXPlugin(fullFlush){_classCallCheck(this,OpenXPlugin);var _this=_possibleConstructorReturn(this,(OpenXPlugin.__proto__||Object.getPrototypeOf(OpenXPlugin)).call(this,URL,true,"OX"));_this.queue=[];_this.queue.flush=function(){var call=function call(fn){return fn()};_this.queue.forEach(call);if(fullFlush){_this.queue.push=call}};return _this}_createClass(OpenXPlugin,[{key:"init",value:function init(){var descriptions=(0,_AdListLoader.getEnabledDescriptions)();var getSize=function getSize(pos){return MAP[pos]&&MAP[pos].size||descriptions[pos].type.split(",")};var getID=function getID(pos){return descriptions[pos].id||pos};var getPos=function getPos(pos){return MAP[pos]&&MAP[pos].pos||pos};global.OX_dfp_ads=Object.keys(descriptions).map(function(pos){return["/"+NETWORK_CODE+"/"+ZONE,getSize(pos),getID(pos),{pos:getPos(pos)}]});global.OX_dfp_options={callback:this.queue.flush};_get(OpenXPlugin.prototype.__proto__||Object.getPrototypeOf(OpenXPlugin.prototype),"init",this).call(this)}},{key:"prepareToRefreshAds",value:function prepareToRefreshAds(){if(global.OX){global.OX.dfp_bidder.refresh()}}},{key:"getTags",value:function getTags(ad,done,tags){this.queue.push(function(){var id=ad.id||ad.pos;var dfp_bidder=global.OX.dfp_bidder;var price=dfp_bidder.getPrice(id);var size=dfp_bidder.getSize(id);if(price&&size){tags.push({oxb:size+"_"+price})}done()})}},{key:"getTagName",value:function getTagName(){return"oxb"}}]);return OpenXPlugin}(_AdsPlugin2.default);exports.default=OpenXPlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../ads-loading/AdListLoader":4,"../AdsPlugin":20}],49:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var createAsyncTracker=require("../AsyncTracker.js");var plugin=new AdsPlugin;var initialized=false;plugin.init=function(){AdsPlugin.prototype.init.call(plugin);if(!plugin.isBotDetected()){var pageEvents=DM&&DM.pageEvents;if(pageEvents){pageEvents.listen(pageEvents.VIDEO_PLAYER_READY,initPageFair)}}};plugin.getTags=function(ad,done){done()};function initPageFair(){if(!initialized){var win=window;initialized=true;win.bm_website_code="E3541077297D40C4";win.pf_notify=function(det){win.adBlockerActive=det?"true":"false"};createAsyncTracker("//asset.pagefair.com/measure.min.js","PageFairMeasure");createAsyncTracker("//asset.pagefair.net/ads.min.js","PageFairAds")}}module.exports=plugin},{"../AdsPlugin.js":20,"../AsyncTracker.js":24}],50:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};require("prebid.js/build/dev/prebid");var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);var _AdListLoader=require("../../ads-loading/AdListLoader");var _AdsTrackers=require("../AdsTrackers");var _emitter=require("../../emitter");var _emitter2=_interopRequireDefault(_emitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var bidsHandled=false;var emitter=new _emitter2.default;var pbjs=global.pbjs=global.pbjs||{};pbjs.que=pbjs.que||[];function getConfig(ads){var enabledPlugins=(0,_AdsTrackers.getEnabledPlugins)().map(function(p){return p.name});var isPluginEnabled=function isPluginEnabled(name){return~enabledPlugins.indexOf(name)||~enabledPlugins.indexOf(name+"Plugin")};return Object.keys(ads).reduce(function(config,pos){return(ads[pos].bidding||[]).reduce(function(config,bidConfig){config.push({code:pos,sizes:bidConfig.sizes,bids:(bidConfig.bidders||[]).filter(function(b){return isPluginEnabled(b.bidder)})});return config},config)},[])}function bidsBackHandler(){bidsHandled=true;emitter.emit("bids handled")}function tag(ad,tags,done){var targeting=pbjs.getAdserverTargetingForAdUnitCode(ad.pos);if(targeting)tags.push(targeting);done()}var TRACKING_VARIABLE="prebid_initialized";pbjs.que.push(function(){global[TRACKING_VARIABLE]=true;pbjs.setPriceGranularity("high")});var PrebidPlugin=function(_Plugin){_inherits(PrebidPlugin,_Plugin);function PrebidPlugin(){_classCallCheck(this,PrebidPlugin);return _possibleConstructorReturn(this,(PrebidPlugin.__proto__||Object.getPrototypeOf(PrebidPlugin)).call(this,"",true,TRACKING_VARIABLE))}_createClass(PrebidPlugin,[{key:"init",value:function init(){var _this2=this;_get(PrebidPlugin.prototype.__proto__||Object.getPrototypeOf(PrebidPlugin.prototype),"init",this).call(this);pbjs.que.push(function(){pbjs.addAdUnits(_this2.lastConfig=getConfig((0,_AdListLoader.getEnabledDescriptions)()));pbjs.requestBids({bidsBackHandler:bidsBackHandler})})}},{key:"prepareToRefreshAds",value:function prepareToRefreshAds(positions){var _this3=this;if(bidsHandled){bidsHandled=false;pbjs.que.push(function(){_this3.lastConfig.map(function(c){return c.code}).forEach(pbjs.removeAdUnit);var allPositions=(0,_AdListLoader.getEnabledDescriptions)();var rPositions=Object.keys(allPositions).filter(function(pos){return~positions.indexOf(pos)}).reduce(function(enabled,pos){enabled[pos]=allPositions[pos];return enabled},{});pbjs.addAdUnits(_this3.lastConfig=getConfig(rPositions));pbjs.requestBids({bidsBackHandler:bidsBackHandler})})}}},{key:"getTagName",value:function getTagName(){return"prebid"}},{key:"getTags",value:function getTags(ad,done,tags){if(bidsHandled)tag(ad,tags,done);else emitter.once("bids handled",function(){return tag(ad,tags,done)})}}]);return PrebidPlugin}(_AdsPlugin2.default);exports.default=new PrebidPlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../ads-loading/AdListLoader":4,"../../emitter":72,"../AdsPlugin":20,"../AdsTrackers":23,"prebid.js/build/dev/prebid":1}],51:[function(require,module,exports){(function(global){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Plugin=require("../AdsPlugin");var adsManager=require("../../AdsManager");var PrizelPlugin=function(_Plugin){_inherits(PrizelPlugin,_Plugin);function PrizelPlugin(){_classCallCheck(this,PrizelPlugin);var _this=_possibleConstructorReturn(this,(PrizelPlugin.__proto__||Object.getPrototypeOf(PrizelPlugin)).call(this,"//www.prizel.com/js/embed/v3/portal.js",true,"Prizel_Embed"));_this.display=_this.display.bind(_this);return _this}_createClass(PrizelPlugin,[{key:"init",value:function init(){global.Prizel_Embed={cmd:[]};adsManager.requestGoogleAd=this.display;_get(PrizelPlugin.prototype.__proto__||Object.getPrototypeOf(PrizelPlugin.prototype),"init",this).call(this)}},{key:"getTags",value:function getTags(_,done){done()}},{key:"display",value:function display(_ref){var containerid=_ref.containerid;miniDom.addClass(document.getElementById(containerid),"prizel-container");global.Prizel_Embed.cmd.push(function(){global.Prizel_Embed.load_prizel({maxHeight:250,maxWidth:964,partnerID:"57e87906-7ff4-497b-957e-1cbe6ee8708e",driver:true,driverLayout:"horizontal",iframeID:"prizel_embed_widget"},containerid)})}}]);return PrizelPlugin}(Plugin);module.exports=new PrizelPlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../AdsManager":2,"../AdsPlugin":20}],52:[function(require,module,exports){(function(global){"use strict";var AdsPlugin=require("../AdsPlugin.js");var plugin=new AdsPlugin("",false);var usConfig={mpu_top_300x600:{desktop:"186786-15",smartphone:"188276-15",tablet:"187350-15"},sticky_banner:{smartphone:"186816-43"},ldr_top:{desktop:"186788-2",smartphone:"188278-2",tablet:"187348-2"},sky_right_top:{desktop:"186790-9"},sky_left_top:{desktop:"186790-9"},billboard:{desktop:"186792-57",tablet:"187346-57"},mpu_channel:{desktop:"186804-15",smartphone:"188272-15",tablet:"187360-15"},mpu_top:{desktop:"186786-15",smartphone:"188276-15",tablet:"187350-15"},mpu_middle:{desktop:"186806-15",smartphone:"188262-15",tablet:"187362-15"},mpu_bottom:{desktop:"186800-15",smartphone:"187352-15",tablet:"187354-15"},mpu_bottom_right:{desktop:"186802-15",smartphone:"187356-15",tablet:"187358-15"},mpu_puff_10:{desktop:"186808-15",smartphone:"188266-15",tablet:"187364-15"},mpu_puff_20:{desktop:"186810-15",smartphone:"188268-15",tablet:"187368-15"},mpu_home:{desktop:"187370-15",smartphone:"188264-15",tablet:"187366-15"}};var gbConfig={mpu_top_300x600:{desktop:"210124-10",tablet:"210146-10"},sticky_banner:{smartphone:"210168-43"},ldr_top:{desktop:"210118-2",smartphone:"210166-2",tablet:"210142-2"},sky_right_top:{desktop:"210122-8"},sky_left_top:{desktop:"210122-8"},billboard:{desktop:"210120-57",tablet:"210144-57"},mpu_channel:{desktop:"210116-15",smartphone:"210164-15",tablet:"210140-15"},mpu_top:{desktop:"210110-15",smartphone:"210156-15",tablet:"210134-15"},mpu_middle:{desktop:"210100-15",smartphone:"210148-15",tablet:"210126-15"},mpu_bottom:{desktop:"210102-15",smartphone:"210150-15",tablet:"210128-15"},mpu_bottom_right:{desktop:"210114-15",smartphone:"210160-15",tablet:"210138-15"},mpu_puff_10:{desktop:"210108-15",smartphone:"210154-15",tablet:"210132-15"},mpu_puff_20:{desktop:"210112-15",smartphone:"210158-15",tablet:"210136-15"},mpu_home:{desktop:"210104-15",smartphone:"210152-15",tablet:"210130-15"},mpu_mobile:{smartphone:"210162-15"}};var defaultConfig={mpu_top_300x600:{desktop:"210232-10",tablet:"210254-10"},sticky_banner:{smartphone:"210276-43"},ldr_top:{desktop:"210226-2",smartphone:"210274-2",tablet:"210250-2"},sky_right_top:{desktop:"210230-8"},sky_left_top:{desktop:"210230-8"},billboard:{desktop:"210228-57",tablet:"210252-57"},mpu_channel:{desktop:"210224-15",smartphone:"210272-15",tablet:"210248-15"},mpu_top:{desktop:"210218-15",smartphone:"210264-15",tablet:"210242-15"},mpu_middle:{desktop:"210210-15",smartphone:"210256-15",tablet:"210234-15"},mpu_bottom:{desktop:"210212-15",smartphone:"210258-15",tablet:"210236-15"},mpu_bottom_right:{desktop:"210222-15",smartphone:"210268-15",tablet:"210246-15"},mpu_puff_10:{desktop:"210216-15",smartphone:"210262-15",tablet:"210240-15"},mpu_puff_20:{desktop:"210220-15",smartphone:"210266-15",tablet:"210244-15"},mpu_home:{desktop:"210214-15",smartphone:"210260-15",tablet:"210238-15"},mpu_mobile:{smartphone:"210262-15"}};var slotConfig={US:usConfig,GB:gbConfig,"default":defaultConfig};var rpSiteConfig={US:{desktop:"43384",smartphone:"43388",tablet:"43392"},GB:{desktop:"46690",smartphone:"46694",tablet:"46692"},"default":{desktop:"46698",smartphone:"46702",tablet:"46700"}};var deviceCategories={other:"desktop",iphone:"smartphone",androidMobile:"smartphone",ipad:"tablet",androidTablet:"tablet"};var rpAccountConfig={US:"9929",GB:"9840","default":"8625"};plugin.getTags=function(ad,done,tags){if(plugin.isBotDetected()){return done()}try{var geo=slotConfig[PageCriteria.geo]?PageCriteria.geo:"default";var devCategory=deviceCategories[PageCriteria.device]||deviceCategories.other;var config=devCategory&&ad.pos&&slotConfig[geo]&&slotConfig[geo][ad.pos];if(!config||!config[devCategory]){return done()}global.rp_api="valuation";global.oz_ad_server="gpt";global.oz_async=true;global.rp_account=rpAccountConfig[geo];global.rp_site=rpSiteConfig[geo][devCategory];global.rp_zonesize=config[devCategory];global.rp_visitor={};global.rp_inventory={area:adAreaId};global.oz_callback=function(rpValuation){var tier;try{tier=rpValuation&&rpValuation.estimate&&rpValuation.estimate.tier;if(tier){tags.push({tier:[tier]})}}catch(e){console.log("Error with Rubicon plugin: ",e)}finally{done(tier&&tier>0)}};var accountIdentifier=global.rp_account+"/"+global.rp_site;var dorothySrc="http://tap-cdn.rubiconproject.com/partner/scripts/rubicon/dorothy.js?pc="+accountIdentifier;var rtpSrc="http://ads.rubiconproject.com/ad/9840.js";var script="script";document.write(["<",script,' type="text/java',script,"\" src='",dorothySrc,"'></",script,">"].join(""));document.write(["<",script,' type="text/java',script,"\" src='",rtpSrc,"'></",script,">"].join(""))}catch(e){console.log("Error when running RTP: ",e);done()}};plugin.getTagName=function(){return"tier"};module.exports=plugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../AdsPlugin.js":20}],53:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);var _DfpAsyncHandler=require("../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler");var _DfpAsyncHandler2=_interopRequireDefault(_DfpAsyncHandler);var _adUnit=require("../../ads-utils/adUnit.js");var _adUnit2=_interopRequireDefault(_adUnit);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{
"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ACCOUNT_ID=function(geo){switch(geo){case"GB":return 9840;case"US":return 9929;default:return 8625}}(PageCriteria.geo);var BASE_URL="//ads.rubiconproject.com/header/"+ACCOUNT_ID+".js";var RUBYCON_COMMAND_QUEUE="rubicontag";var TRACKING_VARIABLE="rubicon_initialized";global[RUBYCON_COMMAND_QUEUE]={cmd:[function(){global[TRACKING_VARIABLE]=true}]};function rubicon(){return global[RUBYCON_COMMAND_QUEUE]}function intersect(a,b){return a.filter(function(i){return b.indexOf(i)!==-1})}function pauseLoadingOfGPT(){var loadGpt=_DfpAsyncHandler2.default.loadGpt;var loadGptRequested=false;_DfpAsyncHandler2.default.loadGpt=function(){loadGptRequested=true;DM.log("ads","Rubicon FastLane is preventing GPT from loading")};return function(){DM.log("ads","Rubicon FastLane will no longer prevent GPT from loading");_DfpAsyncHandler2.default.loadGpt=loadGpt;if(loadGptRequested){loadGpt()}}}var RubiconPlugin=function(_Plugin){_inherits(RubiconPlugin,_Plugin);function RubiconPlugin(){_classCallCheck(this,RubiconPlugin);var _this=_possibleConstructorReturn(this,(RubiconPlugin.__proto__||Object.getPrototypeOf(RubiconPlugin)).call(this,BASE_URL,true,TRACKING_VARIABLE));_this.slots={};_this.defineSlot=_this.defineSlot.bind(_this);return _this}_createClass(RubiconPlugin,[{key:"init",value:function init(){var _this2=this;if(!this.isBotDetected()){_get(RubiconPlugin.prototype.__proto__||Object.getPrototypeOf(RubiconPlugin.prototype),"init",this).call(this);this.unpause=pauseLoadingOfGPT();rubicon().cmd.push(function(){_this2.defineSlots();DM.log("ads",{rubiconSlots:_.map(_this2.slots,function(a){return a})});rubicon().run(_this2.unpause)})}}},{key:"prepareToRefreshAds",value:function prepareToRefreshAds(positions){var _this3=this;if(global[TRACKING_VARIABLE]){rubicon().cmd=[];rubicon().run(function(){var call=function call(fn){return fn()};rubicon().cmd.forEach(call);rubicon().cmd.push=call},{slots:Object.keys(this.slots).filter(function(p){return~positions.indexOf(p)}).map(function(p){return _this3.slots[p]})})}}},{key:"cancel",value:function cancel(){if(this.unpause)this.unpause()}},{key:"defineSlot",value:function defineSlot(_ref){var id=_ref.id,pos=_ref.pos,size=_ref.size;this.slots[pos]=rubicon().defineSlot("/"+_DfpAsyncHandler.NETWORK_CODE+"/"+(0,_adUnit2.default)(pos),size,id).addKW(pos).setFPI("pos",pos)}},{key:"defineSlots",value:function defineSlots(){var descriptions=this.descriptions;var r=rubicon();DM.log("ads",{rubiconDescriptions:descriptions});descriptions.forEach(this.defineSlot);_DfpAsyncHandler2.default.on("createdSlot",function(slot){DM.log("ads","Attaching slot to rubicon",slot);r.setTargetingForGPTSlot(slot)})}},{key:"getTags",value:function getTags(ad,done){rubicon().cmd.push(done)}},{key:"descriptions",get:function get(){var positions=intersect(adListLoader.getEnabledSlots(),Object.keys(adsDescriptions.ads));return positions.map(function(pos){return _.extend({},adsDescriptions.get(pos))})}}]);return RubiconPlugin}(_AdsPlugin2.default);exports.default=new RubiconPlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler":18,"../../ads-utils/adUnit.js":65,"../AdsPlugin":20}],54:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _AdsPlugin=require("../AdsPlugin");var _AdsPlugin2=_interopRequireDefault(_AdsPlugin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _global=global,PageCriteria=_global.PageCriteria;var BASE_URL="//native.sharethrough.com/assets/sfp.js";function keyFactory(pos){var channel=PageCriteria.channel,geo=PageCriteria.geo,isTablet=PageCriteria.isTablet;var isPhone=PageCriteria.isMobile&&!isTablet;var isDesktop=!isPhone&&!isTablet;switch(geo){case"GB":if(isTablet){switch(pos){case"mpu_puff_10":return"QKkefaHxQbiP9oryoC4B1B32";case"mpu_puff_20":return"QBuUVgusQjR1suv5CpksXhx5";case"mpu_puff_30":return"AJ7WcSTwuFkJ8LyGeZkSVKz9";case"inread_player":return"Z1oXCDC8LwkRD75cF72jtkY5";case"half_mpu_top":return"cXoDXT2CKcGaSbXCYUBiYEvu"}}else if(isPhone&&/^mpu/.test(pos)){return"JAzTcH985JsNM4ADJjTHLUrf"}else if(isDesktop){switch(pos){case"mpu_puff_10":return"EbLZ7JdVeKFhX2gNES321EMv";case"mpu_puff_20":return"CHVePuDfP7xBkddY9QMsqqqE";case"mpu_puff_30":return"sptEoPbpaZpVmbMShNSWk4kq";case"inread_player":return"sMXg2K7PUuGxGcoNRDVQhdbL";case"half_mpu_top":return"zsoPcTiSXLyYoZ69gRdFM1wN"}}switch(channel){case"tvshowbiz":return"Dzo5RKPV6dgZPHXEiDEdivUo";case"auhome":return"QRK2Ea9PQLhkt12KyX2SuQTu";case"femail":return"HBchqmKTcS5dg1dDsmwRAEkA";case"health":return"vYpekHj1dHHrNfiSzB1x9FDR";case"home":case"news":return"6QQfNPZKnCm3WLZVS6pP45C7";case"money":return"u9zdWMijVRHKoVc6RFKekQCL";case"sciencetech":return"XxUgUJRxj5Qwhat7dazFXh6n";case"sport":return"cg4wvKgRXjAHYVUc6xVnMLbG";case"travel":return"HySsgLjkYmEnLteuQcPdFSaE";case"ushome":return"K1qPEefGq5pveGvvG4FA8Lye";case"video":return"q5E8ZqxNMTtvKHp9XCdzUhFd"}break;case"AU":if(isDesktop){return"PGkxtq8dznqaNYgyDcbrzFmy"}else if(isPhone){return"cmhmDXyxVn2wT3G7tXyLpoqF"}break;case"US":if(isTablet){switch(pos){case"mpu_puff_10":return"hH3B44JWxcwjvpcwqbxfU513";case"mpu_puff_20":return"5QmcEwg7EP6Xi1zb5YctcZHS";case"mpu_puff_30":return"GxJ87He1AJnQeD5pJBqKV9wo";case"inread_player":return"D5UTh59xz5Wmqht5cDsEvzJg";case"half_mpu_top":return"ure8JJqFnCbiTZNdvb3JHAr6"}}else if(isPhone&&/^mpu/.test(pos)){return"m479NcyiPHEYJq14NifW2cKq"}else if(isDesktop){switch(pos){case"mpu_puff_10":return"cF8t9ju2yfGKHHzhLVtmXUhs";case"mpu_puff_20":return"Kgw7Aw4Shpm2mtgXLWZA14zW";case"mpu_puff_30":return"4pmcRUVcBnmjGUaw2ZieHcdk";case"inread_player":return"K68SZVDxgcZJm8H7PKzUoMKn";case"half_mpu_top":return"cyQjHUxV1D3mUXdCN37rpBDU"}}}}var ShareThrough=function(_Plugin){_inherits(ShareThrough,_Plugin);function ShareThrough(){_classCallCheck(this,ShareThrough);return _possibleConstructorReturn(this,(ShareThrough.__proto__||Object.getPrototypeOf(ShareThrough)).call(this,BASE_URL,true,"STR"))}_createClass(ShareThrough,[{key:"getTags",value:function getTags(ad,done,tags){tags.push({strnativekey:keyFactory(ad.pos)});done()}}]);return ShareThrough}(_AdsPlugin2.default);exports.default=new ShareThrough}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../AdsPlugin":20}],55:[function(require,module,exports){(function(global){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var AdsPlugin=require("../AdsPlugin.js");var adListLoader=require("../../ads-loading/AdListLoader.js");var descriptions=require("../../ads-loading/conf/AdsDescriptions");var sonobiPlugin=function(trackingVariable){var plugin=new AdsPlugin("",true,trackingVariable);var sortedTrinity=void 0;function includeSlot(slot,unit){var prefix=unit.prefix;var prefixLength=prefix.length;var ignoreSuffix=unit.ignoreSuffix;var include=false;var suffix=void 0;if(slot.slice(0,prefixLength)===prefix){include=true;if(ignoreSuffix){for(var i=ignoreSuffix.length;include&&i--;){suffix=ignoreSuffix[i];include=slot.slice(-suffix.length)!==suffix}}}return include}function matchesAdType(ad){return function(sonobiObject){return!!(ad.type&&!sonobiObject.used&&sonobiObject.sbi_size&&_.contains(ad.type.split(","),sonobiObject.sbi_size))}}function getSonobiComponents(){var units=[{prefix:"mpu_",ignoreSuffix:["_300x600","_zero"],size:"300x250",id:"b9a6ec42ce8c4377ec61",max:5},{prefix:"mpu_top_zero",size:"300x600",id:"b9a6ec42ce8c4377ec61"},{prefix:"ldr_top",size:"728x90",id:"927254c8f19bf6166446"},{prefix:"sky_",size:"120x600",id:"528d7f755a3cb9f1820e"},{prefix:"mpu_mobile",size:"300x250",id:"a25e27915231e4e4f3af"},{prefix:"sticky_banner",size:PageCriteria.isMobile&&!PageCriteria.isTablet?"320x50":"980x90",id:"c31ea9f6434c4cbfb5d9"},{prefix:"billboard",size:"970x250",id:"9c0e5a1cd7003a9f8706"}];if(~descriptions.get("billboard").type.indexOf("728x90")){units.find(function(_ref){var size=_ref.size;return size==="728x90"}).prefix="billboard"}var enabledSlots=adListLoader.getEnabledRenderedSlots();var data=[];var hash={};var i=void 0;var j=void 0;for(j=units.length;j--;){var unit=units[j];var max=unit.max||Infinity;var counter=1;for(i=enabledSlots.length;counter<=max&&i--;){if(includeSlot(enabledSlots[i],unit)){while(hash[unit.size+"_"+counter+"_"+unit.id]){counter++}hash[unit.size+"_"+counter+"_"+unit.id]=true;data.push('"mailonline_'+unit.size+"_"+counter++ +'":"'+unit.id+'"')}}}return data}plugin.init=function(){var components=getSonobiComponents();sortedTrinity=null;if(components.length){this._baseUrl="//apex.go.sonobi.com/trinity.js?key_maker={"+components.join(",")+"}"}AdsPlugin.prototype.init.call(this)};plugin.prepareToRefreshAds=function(){if(global[trackingVariable]){global[trackingVariable]=undefined;AdsPlugin.prototype.init.call(this)}};plugin.getTags=function(ad,done,tags){if(!plugin.isBotDetected()&&plugin._asyncTracker){plugin._asyncTracker.addCallback(onLoaded)}else{done()}function onLoaded(err,data){var tagName=plugin.getTagName();var sonobiObject;var sbiDc=window[tagName];if(!err&&(typeof data==="undefined"?"undefined":_typeof(data))==="object"){if(!sortedTrinity){sortedTrinity=Object.keys(data).map(function(key){return data[key]}).sort(function(a,b){var value1=a.sbi_apoc||"x";var value2=b.sbi_apoc||"x";if(value1===value2){return 0}else if(value1<value2){return-1}else{return 1}})}sonobiObject=_.filter(sortedTrinity,matchesAdType(ad))[0];if(sonobiObject){sonobiObject.used=true;Object.keys(sonobiObject).forEach(function(key){if(key!=="used"&&key!==tagName){var obj={};obj[key]=[sonobiObject[key]];tags.push(obj)}});var tag={};tag[tagName]=[sbiDc];tags.push(tag)}}done(!!sonobiObject)}};plugin.getTagName=function(){return"sbi_dc"};return plugin}("sbi_trinity");module.exports=sonobiPlugin}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../ads-loading/AdListLoader.js":4,"../../ads-loading/conf/AdsDescriptions":6,"../AdsPlugin.js":20}],56:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var AdsPlugin=require("../AdsPlugin.js");var adListLoader=require("../../ads-loading/AdListLoader.js");var dfpAsyncHandler=require("../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js");var technorati=function(global,pubID,swID){var plugins=require("./index.js");var url="http://ad-cdn.technoratimedia.com/smartwrapper/"+pubID+"/"+swID+"/sw.js";var plugin=new AdsPlugin(url,true,"TN8",function(){return global.TN8&&global.TN8.SmartWrapper});var dmuskv=global.dmuskv={area:PageCriteria.channel,subarea:PageCriteria.subchannel,device:function(){switch(true){case PageCriteria.isMobile:return"mobile";case PageCriteria.isTablet:return"tablet";default:return"desktop"}}()};if(PageCriteria.articleId){dmuskv.article=PageCriteria.articleId}var TN8=global.TN8=global.TN8||{};TN8.q=TN8.q||[];plugin.init=function(){DM.log("ads","WARNING: The Technorati plugin may conflict with other bidder plugins");TN8.q.push(prefetchSlots);if(plugins.impIDPlugin&&plugins.impIDPlugin.id){dmuskv.pageViewID=plugins.impIDPlugin.id}if(plugins.audienceMembershipPlugin&&plugins.audienceMembershipPlugin._asyncTracker){plugins.audienceMembershipPlugin._asyncTracker.addCallback(setLotameID)}AdsPlugin.prototype.init.call(plugin)};plugin.prepareToRefreshAds=function(){DM.log("ads","WARNING: The refresh ads capability of the Technorati plugin wasn't implemented yet")};plugin.getTags=function(ad,done){adverts.q(function(){dfpAsyncHandler.getGPTSlotForAd(ad);try{if(ad.gptSlot){TN8.SmartWrapper.attachSlot(ad.pos,ad.gptSlot,true)}if(ad.oopGptSlot){TN8.SmartWrapper.attachSlot(ad.pos+"-oop",ad.oopGptSlot,true)}}catch(e){DM.log("ads","TN8: "+e.message)}});done()};return plugin;function prefetchSlots(){var slots=adListLoader.getEnabledRenderedSlots();DM.log("ads","TN8: "+slots);TN8.SmartWrapper.prefetch(slots)}function setLotameID(err,data){if(!err&&(typeof data==="undefined"?"undefined":_typeof(data))==="object"){dmuskv.uid=data.Profile.pid}}}(window,81119,1039);module.exports=technorati},{"../../ads-loading/AdListLoader.js":4,"../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js":18,"../AdsPlugin.js":20,"./index.js":46}],57:[function(require,module,exports){"use strict";var AdsPlugin=require("../AdsPlugin.js");var adListLoader=require("../../ads-loading/AdListLoader.js");var dfpAsyncHandler=require("../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js");var descriptions=require("../../ads-loading/conf/AdsDescriptions");window.ybotq=window.ybotq||[];var yieldbot=function(baseUrl,isAsync,trackingVariable){var plugin=new AdsPlugin(baseUrl,isAsync,trackingVariable,asyncTracker);var config={desktop:{id:"809a",slots:[["ldr_top"],["mpu_top",{sizes:[[300,250],[300,600]]}],["sky_right_top"],["mpu_puff_10"],["mpu_puff_20"]]},phone:{id:"7d10",slots:[["sticky_banner"],["mpu_mobile"]]}};var slots=[];var initialized;if(~descriptions.get("billboard").type.indexOf("728x90")){config.desktop.slots.push(["billboard",{sizes:[[728,90]]}])}plugin.init=function(){overrideQ();AdsPlugin.prototype.init.call(this);this._asyncTracker.addCallback(function(){window.ybotq.push(getYieldbot);window.ybotq.push(replaceHandlers)})};plugin.prepareToRefreshAds=function(){DM.log("ads","WARNING: The refresh ads capability of the Yieldbot plugin wasn't implemented yet")};plugin.getTags=function(ad,done){done()};function overrideQ(){var q=window.adverts.q;window.adverts.q=function(fn){window.ybotq.push(function(){return q(fn)})}}function asyncTracker(){return window[trackingVariable]&&dfpAsyncHandler}function replaceHandlers(){var includeTrackingTags=dfpAsyncHandler.includeTrackingTags;var refreshAdvert=dfpAsyncHandler.refreshAdvert;var requestAd=dfpAsyncHandler.requestAd;dfpAsyncHandler.includeTrackingTags=function(gptSlot){var yieldbot=getYieldbot();var pos=gptSlot.getTargetingMap().pos[0];var slotName=getSlotName(pos);if(slotName&&!gptSlot.getOutOfPage()){yieldbot.setSlotTargeting(slotName,gptSlot)}includeTrackingTags.apply(this,arguments)};dfpAsyncHandler.refreshAdvert=function(adPos){var slotName=getSlotName(adPos);var adSlot=slotName&&dfpAsyncHandler.getRequestedSlot(adPos);if(adSlot){getYieldbot().setSlotTargeting(slotName,adSlot)}refreshAdvert.apply(this,arguments)};dfpAsyncHandler.requestAd=function(){var args=arguments;window.ybotq.push(function(){requestAd.apply(dfpAsyncHandler,args)})}}function getSlotName(adPos){return slots.indexOf(adPos)!==-1?adPos:null}function initYieldBot(yieldbot){var deviceConfig=config[window.PageCriteria.device==="iphone"||window.PageCriteria.device==="androidMobile"?"phone":"desktop"];var enabledSlots=adListLoader.getEnabledSlots();yieldbot.pub(deviceConfig.id);slots=deviceConfig.slots.map(function(slot){var slotName=slot[0];var filteredSlots=enabledSlots.filter(function(enabledSlot){return enabledSlot.slice(0,slotName.length)===slotName});if(filteredSlots.length){yieldbot.defineSlot.apply(yieldbot,slot);return slotName}});yieldbot.enableAsync();yieldbot.go()}function getYieldbot(){var yieldbot=window[trackingVariable];if(!initialized){initYieldBot(yieldbot);initialized=true}return yieldbot}return plugin}("//cdn.yldbt.com/js/yieldbot.intent.js",true,"yieldbot");module.exports=yieldbot},{"../../ads-loading/AdListLoader.js":4,"../../ads-loading/conf/AdsDescriptions":6,"../../ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js":18,"../AdsPlugin.js":20}],58:[function(require,module,exports){"use strict";module.exports={}},{}],59:[function(require,module,exports){"use strict";function config(pc){var enabled=pc.channel==="sciencetech"||pc.channel==="health";var desktop=pc.device==="other";var tablet=pc.isTablet;var smartphone=pc.isMobile;var indexPage=pc.pageType==="channel"&&pc.subchannel===pc.channel;var subIndexPage=pc.pageType==="channel"&&pc.subchannel!==pc.channel;var articlePage=pc.pageType==="article";if(desktop&&enabled&&indexPage){return{website_id:21,zones:[{id:46},{id:51},{id:77}]}}if(desktop&&enabled&&subIndexPage){return{website_id:21,zones:[{id:64},{id:58}]}}if(desktop&&enabled&&articlePage){return{website_id:21,zones:[{id:50},{id:51},{id:52},{id:53},{id:56},{id:57},{id:59},{id:76}]}}if(tablet&&enabled&&indexPage){return{website_id:21,zones:[{id:60},{id:61}]}}if(tablet&&enabled&&subIndexPage){return{website_id:21,zones:[{id:64},{id:58}]}}if(tablet&&enabled&&articlePage){return{website_id:21,zones:[{id:62},{id:65},{id:66},{id:63},{id:67},{id:54},{id:55}]}}if(smartphone&&enabled&&indexPage){return{website_id:21,zones:[{id:68}]}}if(smartphone&&enabled&&articlePage){return{website_id:21,zones:[{id:71},{id:70},{id:69}]}}}function extendConfig(config){return _.extend(config,{variables:{asi:"asi_value",article:"article_value",environment:"environment_value",dartCCKey:"dartCCKey_value",grapeshot:"grapeshot_value",adx_channel:"adx_channel_value",browserResolution:"browserResolution_value",url:"url_value",page:"page_value",device:"device_value",country:"country_value",p:"p_value",O:"O_value"}})}function init(){(window.__schwid=window.__schwid||[]).push(extendConfig(config(window.PageCriteria)));var baseUrl="//delivery.demo.heavyhearted.com/adserver/adserver/cat.js";var script=document.createElement("script");script.async=true;script.type="text/javascript";var useSSL=document.location.protocol==="https: ";script.src=(useSSL?"https: ":"http: ")+baseUrl;var node=document.getElementsByTagName("script")[0];node.parentNode.insertBefore(script,node)}module.exports={init:init}},{}],60:[function(require,module,exports){"use strict";var AdEvents=require("./AdEvents.js");var AdIntegrator=require("./AdIntegrator.js");var adActionsEventHandler=new AdEvents("click",function(id){var element=AdIntegrator.getElementOrIframeById(id);var slideElement=miniDom.hasClass(element,"slide")?element:miniDom.closest(element,function(n){return miniDom.hasClass(n,"slide")});var results;if(document.querySelectorAll){results=slideElement.querySelectorAll(".adLinkLabel a")}else{results=slideElement.getElementsByTagName("a");results=Array.prototype.filter.call(results,function(res){return miniDom.closest(res,function(n){return miniDom.hasClass(n,"adLinkLabel")})})}return results[0]});var adDeactivationEventHandler=new AdEvents("adDeactivate",function(id){var element=miniDom.closest(AdIntegrator.getElementOrIframeById(id),function(e){return e.id==="mobileGalleryModal"});return element});module.exports={onClick:function onClick(){var args=Array.prototype.slice.call(arguments);var target=args[1];args[1]=function(){window.open(target,"_blank")};adActionsEventHandler.registerEvent.apply(adActionsEventHandler,args)},onDeactivate:function onDeactivate(id,callback){adDeactivationEventHandler.registerEvent(id,callback)},isClickThrough:function isClickThrough(advert){if(typeof advert==="string"){advert=AdIntegrator.getElementById(advert)}else if(!miniDom.isElement(advert)){advert=advert[0]}advert=AdIntegrator.getAdContainer(advert);var divs=advert.getElementsByTagName("div");divs=Array.prototype.filter.call(divs,function(element){var event=adActionsEventHandler.getEvent(element.id);return event&&event.toString().indexOf("window.open")!==-1});return divs.length>0},onInteraction:function onInteraction(){adActionsEventHandler.registerEvent.apply(adActionsEventHandler,arguments)}}},{"./AdEvents.js":61,"./AdIntegrator.js":63}],61:[function(require,module,exports){"use strict";var AdIntegrator=require("./AdIntegrator.js");var AdEventClass=function AdEventClass(eventName,getDOMCallback){this.eventsMap={};this.eventName=eventName;this.getDomCallback=getDOMCallback;this.domElement={};var self=this;DM.later("DOM_READY",function(){attachAllEvents.call(self)})};function attachEvent(id){var ioCallback=this.eventsMap[id];this.domElement[id]=this.getDomCallback(id);if(this.domElement[id]!==null){this.on(this.domElement[id],this.eventName,function(event){event.stopPropagation();var position=MobileUtils.isLandscape()?"landscape":"portrait";ioCallback.call(this,position)})}}function checkAndAttachEvent(id){var element=AdIntegrator.getElementById(id);if(!element){delete this.eventsMap[id]}else if(id in this.eventsMap){attachEvent.call(this,id)}}function attachAllEvents(){for(var id in this.eventsMap){checkAndAttachEvent.call(this,id)}}AdEventClass.on=function(element,event,fn){miniDom.on(element,event,fn)};AdEventClass.fireEvent=function(){return document.createEvent?function(element,eventName){var event=element.ownerDocument.createEvent("HTMLEvents");event.initEvent(eventName,true,true);element.dispatchEvent(event)}:function(element,eventName){var event=element.ownerDocument.createEventObject();event.eventType=eventName;element.fireEvent("on"+event.eventType,event)}}();AdEventClass.prototype={constructor:AdEventClass,registerEvent:function registerEvent(id,callback){this.eventsMap[id]=callback;checkAndAttachEvent.call(this,id)},getEvent:function getEvent(id){return this.eventsMap[id]},on:AdEventClass.on,fireEvent:AdEventClass.fireEvent};module.exports=AdEventClass},{"./AdIntegrator.js":63}],62:[function(require,module,exports){"use strict";var AdEvents=require("./AdEvents.js");var AdIntegrator=require("./AdIntegrator.js");var IMPRESSION_EVENT_NAME="onImpression";var DATA_IMPRESSION_URL="data-impression-url";var TED_TRACKING="data-ted-tracking";var adImpressionEventHandler=new AdEvents("onImpression",function(id){return getElementById(id)});function registerMOLImpression(advert){var impressionUrl=advert.getAttribute(DATA_IMPRESSION_URL);var impression=new Image;impression.src=impressionUrl;if(advert.getAttribute(TED_TRACKING)){if(DM.later){DM.later("bundle",function(){DM.pageEvents.fireEvent(DM.pageEvents.PAGE_AD_DISPLAYED,{type:"dfp-impression"})})}else{DM.pageEvents.fireEvent(DM.pageEvents.PAGE_AD_DISPLAYED,{type:"dfp-impression"})}}}function registerThirdPartyImpression(advert){setTimeout(function(){fireEvent(advert,IMPRESSION_EVENT_NAME);if(advert.getAttribute(TED_TRACKING)){if(DM.later){DM.later("bundle",function(){DM.pageEvents.fireEvent(DM.pageEvents.PAGE_AD_DISPLAYED,{type:"3rd-party-impression"})})}else{DM.pageEvents.fireEvent(DM.pageEvents.PAGE_AD_DISPLAYED,{type:"3rd-party-impression"})}}},0)}function fireEvent(){adImpressionEventHandler.fireEvent.apply(adImpressionEventHandler,arguments)}function getElementById(id){return AdIntegrator.getElementById(id)}module.exports={DATA_IMPRESSION_URL:DATA_IMPRESSION_URL,onImpression:function onImpression(){adImpressionEventHandler.registerEvent.apply(adImpressionEventHandler,arguments)},registerImpression:function registerImpression(advert,callback){var target=Array.prototype.filter.call(AdIntegrator.getAdContainer(advert).getElementsByTagName("div"),function(elem){return elem.getAttribute(DATA_IMPRESSION_URL)});if(target.length){registerMOLImpression(target[0]);registerThirdPartyImpression(target[0]);callback.call(this,advert)}}}},{"./AdEvents.js":61,"./AdIntegrator.js":63}],63:[function(require,module,exports){(function(global){"use strict";var adsRenderer=require("../ads-rendering/AdsRenderer.js");var onNativeLoaded=require("../ads-rendering/NativeRenderer.js");function appendStyle(content){if(!content){return}var style=document.createElement("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=content}else if("textContent"in style){style.textContent=content}else{style.innerText=content}document.body.appendChild(style)}function getIframeDocument(iframe){var doc;try{doc=iframe.contentDocument||iframe.contentWindow.document}catch(e){}return doc||document}function getElementInIframeById(id){return function(iframe){return iframe&&getIframeDocument(iframe).getElementById(id)}}function getAdIframes(context){var iframes=(context||document).getElementsByTagName("iframe");return Array.prototype.filter.call(iframes,isAdIframe)}function centerAlignIframe(parentId,sizes){var minWidth=Infinity;var maxWidth=0;var i=void 0;var width=void 0;var parent=void 0;if(sizes.length>1){for(i=sizes.length;i--;){width=sizes[i][0];if(width>maxWidth){maxWidth=width}if(width<minWidth){minWidth=width}}if(maxWidth!==minWidth){parent=document.getElementById(parentId);if(parent){getIframe()}}}function getIframe(){var iframes=getAdIframes(parent);var iframe=void 0;var checkCounter=5;if(iframes.length){iframe=iframes.filter(function(ifr){var width=+ifr.getAttribute("width");return width===minWidth||width===maxWidth})[0];if(iframe){iframeLoaded()}}function iframeLoaded(){var doc=getIframeDocument(iframe);var body=doc.body;var containers=["iframe","img","object","a","div"];var children=[];var i=void 0;if(body===global.document.body)return;for(i=containers.length;i--;){children.push.apply(children,Array.prototype.slice.call(body.getElementsByTagName(containers[i])))}for(i=children.length;i--;){if(children[i].offsetWidth===minWidth){body.style.marginLeft=body.style.marginRight=(body.clientWidth-minWidth>>1)+"px";return}}if(checkCounter||!children.length){checkCounter--;setTimeout(iframeLoaded,500)}}}}function getElementOrIframeById(id){var getElement=getElementInIframeById(id);return find(getAdIframes(),function(iframe){return getElement(iframe)&&iframe})}function isAdIframe(element){return element.id&&element.id.slice(0,18)==="google_ads_iframe_"&&element.width!=="0"}function find(items,predicate){for(var i=0,length=items.length;i<length;i++){if(predicate(items[i])){return items[i]}}}function isEmpty(id){var container=document.getElementById(id);var tags=["a","iframe","object","img","video"];var empty=true;if(container){for(var i=tags.length;empty&&i--;){empty=!container.getElementsByTagName(tags[i]).length}}return empty}function getElementContainerById(id){var element=getElementOrIframeById(id);var isHolder=/\badHolder\b/;if(!element){return}var container=element;while(container&&!isHolder.test(container.className||"")){container=container.parentNode}if(!container){container=element}return container}function disableSlot(adPos){var moladsClass="molads_"+adPos;var body=document.documentElement;miniDom.removeClass(body,moladsClass+"_on");miniDom.addClass(body,moladsClass+"_off");var DM=window.DM;if(adPos==="billboard"&&DM&&DM.Rotator){DM.Rotator.initMiniCarousel()}}function enableSlot(adPos){var moladsClass="molads_"+adPos;var body=document.documentElement;miniDom.removeClass(body,moladsClass+"_off");miniDom.addClass(body,moladsClass+"_on")}function nativeLoaded(contentWindow,id,innerHTML){var iframe=find(getAdIframes(),function(iframe){return iframe.contentWindow.name===contentWindow.name});if(iframe){var container=miniDom.closest(iframe,function(node){return node.hasAttribute(adsRenderer.AD_ATTRIBUTE)});if(container){var ad=adsRenderer.parse(container.getAttribute(adsRenderer.AD_ATTRIBUTE)||"{}");if(ad){onNativeLoaded(ad,container,innerHTML)}}}}module.exports={log:function log(){console.log.apply(console,arguments)},appendStyles:function appendStyles(html){var styles=html.match(/<style[^>]*\sclass="?integrate"?[^>]*>[^\f]*?<\/style>/gi);for(var i=0,l=styles?styles.length:0;i<l;i++){appendStyle(styles[i].slice(styles[i].indexOf(">")+1,-8))}},getElementById:function getElementById(id){var element=null;var iframes=getAdIframes();var finder=getElementInIframeById(id);for(var i=0;!element&&i<iframes.length;i++){element=finder(iframes[i])}return element},getElementOrIframeById:getElementOrIframeById,getAdContainer:function getAdContainer(adContainer){var iframe;iframe=getAdIframes(adContainer)[0];return iframe?getIframeDocument(iframe):adContainer},getElementContainerById:getElementContainerById,collapseAd:function collapseAd(id){var container=getElementContainerById(id);if(container){var ad=adsRenderer.parse(container.getAttribute(adsRenderer.AD_ATTRIBUTE)||"{}");if(ad&&ad.pos){disableSlot(ad.pos)}else{container.style.display="none"}}},openAd:function openAd(id){var container=getElementContainerById(id);var ad=adsRenderer.parse(container.getAttribute(adsRenderer.AD_ATTRIBUTE)||"{}");if(ad&&ad.pos){enableSlot(ad.pos)}else{container.style.height="auto";container.style.display="block"}},enableSlot:enableSlot,disableSlot:disableSlot,centerAlign:centerAlignIframe,stickyToBottom:function stickyToBottom(cb){var stickyBanner=document.getElementById("stickyBanner");if(stickyBanner){setTimeout(function(){var divs=document.getElementsByTagName("div");var isPageBanner=/\bpage-banner\b/;var i=void 0;stickyBanner.id="superBanner";stickyBanner.className=(stickyBanner.className||"").replace(/(\s*)sticky_banner_overrides(\s*)/g,"$1$2");document.documentElement.className=document.documentElement.className.replace(/(\s*molads_ldr_top_)off(\s*)/,"$1on$2").replace(/(\s*molads_sticky_banner_)on(\s*)/,"$1off$2");for(i=divs.length;i--;){if(isPageBanner.test(divs[i].className||"")){divs[i].style.paddingTop="125px"}}typeof cb==="function"&&cb()},100)}else{typeof cb==="function"&&cb()}},isEmpty:isEmpty,nativeLoaded:nativeLoaded}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../ads-rendering/AdsRenderer.js":8,"../ads-rendering/NativeRenderer.js":11}],64:[function(require,module,exports){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver);

}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Postbox=function(){function Postbox(system,id){_classCallCheck(this,Postbox);this.system=system;this.id=id}_createClass(Postbox,[{key:"emit",value:function emit(){var _system;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_system=this.system).emit.apply(_system,[this].concat(args))}},{key:"on",value:function on(){var _system2;for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}(_system2=this.system).on.apply(_system2,[this].concat(args))}}]);return Postbox}();var MessageBroker=exports.MessageBroker=function(){function MessageBroker(){_classCallCheck(this,MessageBroker);this.subscriptions=[];this.started=false;this.dispatcher=function(sender,msg,done){return done()}}_createClass(MessageBroker,[{key:"setDispatcher",value:function setDispatcher(dispatcher){this.dispatcher=dispatcher}},{key:"postbox",value:function postbox(id){return new Postbox(this,id)}},{key:"emit",value:function emit(sender){var _this=this;for(var _len3=arguments.length,msg=Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){msg[_key3-1]=arguments[_key3]}if(!this.started){console.warn("[MessageBroker]",sender.id,"is emitting",msg[0],"before setup is completed. This message might get lost.")}this.dispatcher(sender,msg,function(){for(var _len4=arguments.length,_msg=Array(_len4),_key4=0;_key4<_len4;_key4++){_msg[_key4]=arguments[_key4]}if(_msg&&_msg.length>0){_this.emitImmediately.apply(_this,[sender].concat(_msg))}else{_this.emitImmediately.apply(_this,[sender].concat(msg))}})}},{key:"emitImmediately",value:function emitImmediately(sender){var _this2=this;for(var _len5=arguments.length,msg=Array(_len5>1?_len5-1:0),_key5=1;_key5<_len5;_key5++){msg[_key5-1]=arguments[_key5]}var args=msg.splice(1);this.subscriptions.forEach(function(subscription){if(subscription.msg[0]===msg[0]){_this2.callSubscriber(subscription.postbox,args,subscription.callback)}})}},{key:"callSubscriber",value:function callSubscriber(subscriber,args,callback){callback.apply(subscriber.postbox,args)}},{key:"on",value:function on(postbox){for(var _len6=arguments.length,msg=Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++){msg[_key6-1]=arguments[_key6]}var callback=msg[msg.length-1];msg=msg.splice(0,msg.length-1);this.subscribe(postbox,msg,callback)}},{key:"subscribe",value:function subscribe(postbox,msg,callback){this.subscriptions.push({postbox:postbox,msg:msg,callback:callback})}},{key:"start",value:function start(){this.started=true;var postbox=this.postbox("MessageBroker");postbox.emit("system ready");global.DM.later("bundle",function(){postbox.emit("jquery ready")});global.DM.later.go("mol-adverts")}}]);return MessageBroker}();var LoggingMessageBroker=exports.LoggingMessageBroker=function(_MessageBroker){_inherits(LoggingMessageBroker,_MessageBroker);function LoggingMessageBroker(){_classCallCheck(this,LoggingMessageBroker);return _possibleConstructorReturn(this,(LoggingMessageBroker.__proto__||Object.getPrototypeOf(LoggingMessageBroker)).apply(this,arguments))}_createClass(LoggingMessageBroker,[{key:"emit",value:function emit(sender){for(var _len7=arguments.length,msg=Array(_len7>1?_len7-1:0),_key7=1;_key7<_len7;_key7++){msg[_key7-1]=arguments[_key7]}console.group(sender.id,"emit",msg);try{var _get2;(_get2=_get(LoggingMessageBroker.prototype.__proto__||Object.getPrototypeOf(LoggingMessageBroker.prototype),"emit",this)).call.apply(_get2,[this,sender].concat(msg))}finally{console.groupEnd()}}},{key:"callSubscriber",value:function callSubscriber(subscriber,args,callback){console.group("calling",subscriber.id);try{_get(LoggingMessageBroker.prototype.__proto__||Object.getPrototypeOf(LoggingMessageBroker.prototype),"callSubscriber",this).call(this,subscriber,args,callback)}finally{console.groupEnd()}}},{key:"subscribe",value:function subscribe(postbox,msgs,callback){console.log(postbox.id,"subscribed to",msgs);_get(LoggingMessageBroker.prototype.__proto__||Object.getPrototypeOf(LoggingMessageBroker.prototype),"subscribe",this).call(this,postbox,msgs,callback)}},{key:"start",value:function start(){_get(LoggingMessageBroker.prototype.__proto__||Object.getPrototypeOf(LoggingMessageBroker.prototype),"start",this).call(this)}}]);return LoggingMessageBroker}(MessageBroker);var messageBroker=~window.location.search.indexOf("logbroker")?new LoggingMessageBroker:new MessageBroker;exports.default=messageBroker}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],65:[function(require,module,exports){(function(global){"use strict";module.exports=function(pos){return pos.slice(0,7)==="native_"?"dailymail.uk/dm_native":global.dartSiteId+"/"+global.adAreaSiteId+"_"+global.adAreaSiteId+global.adAreaId+"_"+global.adSubareaId+global.adPageType}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],66:[function(require,module,exports){"use strict";var _MessageBroker=require("../../ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var checkers={MpuVideoChecker:require("./MpuVideoChecker.js")};var adCheckerConfig=require("./config/config.js");var adsRenderer=require("../../ads-rendering/AdsRenderer.js");var adsTrackers=require("../../ads-tracking/AdsTrackers.js");var duration=3e4;var frequency=2e3;var done=false;var enabledCheckers=[];var adverts=[];var wrongAds={};function startChecking(){_.each(adCheckerConfig,function(info,checker){if(info.enabled&&validGeo(info.geos)){enabledCheckers.push(checker)}});if(_.isEmpty(enabledCheckers)){return}DM.later("DOM_READY",initChecking);function validGeo(geoList){return!geoList||_.contains(geoList,"_")||_.contains(geoList,PageCriteria.geo)}}function initChecking(){adverts=Array.prototype.slice.call(miniDom.getElementsByClassName(document,"adHolder")).filter(isRenderable);checkForWrongAdverts();setTimeout(stopAdsChecking,duration)}function isRenderable(ad){return ad.hasAttribute(adsRenderer.AD_ATTRIBUTE)}function checkForWrongAdverts(){setTimeout(function(){_.each(enabledCheckers,function(checker){wrongAds[checker]=checkers[checker].check(adverts,adCheckerConfig[checker])});if(!done){checkForWrongAdverts()}},frequency)}function stopAdsChecking(){done=true;_.each(wrongAds,function(ads,checker){if(adCheckerConfig[checker].alert){notifyError(checker,ads)}})}function notifyError(checker){var reportError=adsTrackers.feelingLucky();wrongAds[checker].forEach(function(html){var errorMsg=adCheckerConfig[checker].alertMsg||"wrong advert - no given reason";console.error("Wrong advert:",html,errorMsg);if(reportError){adsTrackers.sendAlert(html,errorMsg)}})}var postbox=_MessageBroker2.default.postbox("AdsChecker");postbox.on("system ready",function(){startChecking()});module.exports={startChecking:startChecking,checkers:checkers}},{"../../ads-rendering/AdsRenderer.js":8,"../../ads-tracking/AdsTrackers.js":23,"../../ads-utils/MessageBroker":64,"./MpuVideoChecker.js":67,"./config/config.js":68}],67:[function(require,module,exports){"use strict";var msecsToKill;var DEFAULT_SECS=30;function check(ads,checkerConfig){msecsToKill=(checkerConfig.allowedSecs||DEFAULT_SECS)*1e3;var out=Array.prototype.filter.call(getUncheckedMpus(),byFinishedLoading);out=Array.prototype.filter.call(out,byContainingRiskyVideo);out=Array.prototype.map.call(out,destroyElement);out=Array.prototype.map.call(out,toCheckedMpus);return out;function getUncheckedMpus(){return Array.prototype.filter.call(ads,function(item){return isMPU(item)&&!miniDom.hasClass(item,checkerConfig.checkClass)})}function toCheckedMpus(mpu){miniDom.addClass(mpu,checkerConfig.checkClass);return mpu}}function isMPU(element){var mpuClasses=(element.className||"").split(" ").filter(function(cssClass){return cssClass.slice(0,3)==="mpu"});return!!mpuClasses.length}function byFinishedLoading(mpu){var children=searchElement(mpu.childNodes,"DIV");return children.length>0}function byContainingRiskyVideo(mpu){var riskyProvidersRegex=/liverail|adap\.tv|ybrant|adaptv|ybpangea|underdogmedia|brightcove|brightroll|spotxchange|reelfeed\.tv|tidaltv|btrll\.com|tubemogul|jwplayer|scanscout/i;var gptDiv=searchElement(mpu.childNodes,"DIV")[0];if(!gptDiv)return false;var iframe=searchElement(gptDiv.childNodes,"IFRAME")[0];var iframeContent=iframe.contentDocument.getElementsByTagName("body")[0].innerHTML;return riskyProvidersRegex.test(iframeContent)}function destroyElement(mpu){miniDom.addClass(mpu,"risky-video");setTimeout(kill,msecsToKill);return mpu;function kill(){mpu.style.display="none";mpu.innerHTML=""}}function searchElement(origin,target){return Array.prototype.filter.call(origin,function(n){return miniDom.isElement(n)&&n.tagName===target})}module.exports={check:check}},{}],68:[function(require,module,exports){"use strict";module.exports={MpuVideoChecker:{enabled:true,alert:false,alertMsg:"mpu containing a video",checkClass:"mpu-video-checked",geos:["US"],allowedSecs:30}}},{}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSize=getSize;function getDimensionSize(dimension){return window["inner"+dimension]||document.documentElement["client"+dimension]||document.body["client"+dimension]}function getSize(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},usePixelRatio=_ref.usePixelRatio;var ratio=usePixelRatio&&window.devicePixelRatio||1;return{width:getDimensionSize("Width")*ratio,height:getDimensionSize("Height")*ratio}}},{}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.random=random;function random(from,to){var variable=to-from+1+from;return Math.floor(Math.random()*variable)}},{}],71:[function(require,module,exports){"use strict";var onBodyAvailable=function onBodyAvailable(fn){if(document.body){fn()}else{setTimeout(onBodyAvailable.bind(null,fn),10)}};exports.onBodyAvailable=onBodyAvailable},{}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function getSubscriptionSet(emitter,message){if(!emitter.subscriptions[message]){emitter.subscriptions[message]=[]}return emitter.subscriptions[message]}var Emitter=function(){function Emitter(){_classCallCheck(this,Emitter);this.subscriptions={}}_createClass(Emitter,[{key:"clone",value:function clone(){return{emit:this.emit.bind(this),off:this.off.bind(this),on:this.on.bind(this),once:this.once.bind(this)}}},{key:"emit",value:function emit(message){for(var _len=arguments.length,data=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){data[_key-1]=arguments[_key]}getSubscriptionSet(this,message).forEach(function(callback){callback.apply(undefined,data)})}},{key:"off",value:function off(message,callback){var set=getSubscriptionSet(this,message);if(callback){var index=set.indexOf(callback);if(index!==-1)set.splice(index,1)}else{set.length=0}}},{key:"on",value:function on(message,callback){getSubscriptionSet(this,message).push(callback)}},{key:"once",value:function once(message,callback){var _this=this;var subscription=function subscription(){_this.off(message,subscription);callback.apply(undefined,arguments)};this.on(message,subscription)}}]);return Emitter}();exports.default=Emitter},{}],73:[function(require,module,exports){(function(global){"use strict";var _MessageBroker=require("./ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}global.messageBroker=_MessageBroker2.default;window.adverts=require("./AdsManager.js");window.adListLoader=require("./ads-loading/AdListLoader.js");window.adsDescriptions=require("./ads-loading/conf/AdsDescriptions.js");window.adsDefaults=require("./ads-loading/conf/AdsDefaults.js");window.adServerConfig=require("./ads-rendering/conf/config.js");window.adsRenderer=require("./ads-rendering/AdsRenderer.js");window.dfpAsyncHandler=require("./ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js");window.DfpServer=require("./ads-rendering/servers/dfp/DfpServer.js");window.adsTedReport=require("./ads-tracking/AdsTedReport.js");window.adsTrackers=require("./ads-tracking/AdsTrackers.js");window.createAsyncTracker=require("./ads-tracking/AsyncTracker.js");window.AdIntegrator=require("./ads-utils/AdIntegrator.js");window.AdBehaviour=require("./ads-utils/AdBehaviour.js");window.AdImpression=require("./ads-utils/AdImpression.js");window.AdEvents=require("./ads-utils/AdEvents.js");window.sticky=require("./StickyBanner.js");window.AdsChecker=require("./ads-utils/ads-checking/AdsChecker.js");require("./performance.js");_MessageBroker2.default.start()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./AdsManager.js":2,"./StickyBanner.js":3,"./ads-loading/AdListLoader.js":4,"./ads-loading/conf/AdsDefaults.js":5,"./ads-loading/conf/AdsDescriptions.js":6,"./ads-rendering/AdsRenderer.js":8,"./ads-rendering/conf/config.js":14,"./ads-rendering/servers/dfp/DfpServer.js":16,"./ads-rendering/servers/dfp/handlers/DfpAsyncHandler.js":18,"./ads-tracking/AdsTedReport.js":22,"./ads-tracking/AdsTrackers.js":23,"./ads-tracking/AsyncTracker.js":24,"./ads-utils/AdBehaviour.js":60,"./ads-utils/AdEvents.js":61,"./ads-utils/AdImpression.js":62,"./ads-utils/AdIntegrator.js":63,"./ads-utils/MessageBroker":64,"./ads-utils/ads-checking/AdsChecker.js":66,"./performance.js":74}],74:[function(require,module,exports){(function(global){"use strict";var _MessageBroker=require("./ads-utils/MessageBroker");var _MessageBroker2=_interopRequireDefault(_MessageBroker);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var postbox=_MessageBroker2.default.postbox("performance");var triggers=["billboard","banner_top","sky_right_top","sky_left_top"];var criticalScriptsSources=["taboola.com","crwdcntrl.net"];var perf=adverts.performance={};var slots=perf.slots={};var plugins=perf.plugins={};function now(){return(new Date).getTime()}global.ABE=global.ABE||{startTime:(new Date).getTime()};function elapsed(){var from=arguments.length>0&&arguments[0]!==undefined?arguments[0]:ABE.startTime;return parseFloat(((now()-from)/1e3).toFixed(1))}function add(pos,measure){if(!slots[pos]){slots[pos]={}}if(!slots[pos][measure]){slots[pos][measure]=elapsed()}}var timeoutLoaCritical=setTimeout(function(){continueLoading()},5e3);postbox.on("ad rendered",function(event){add(event.slot.molAd.pos,"ad rendered");if(~triggers.indexOf(event.slot.molAd.pos)){continueBidding()}clearTimeout(timeoutLoaCritical);setTimeout(continueLoading,5e3)});postbox.on("ad viewable",function(event){add(event.slot.molAd.pos,"ad viewable");continueLoading()});postbox.on("slot defined",function(slot){return add(slot.pos,"slot defined")});var started={};postbox.on("start bidding",function(slot){add(slot,"start bidding");started[slot]=now()});postbox.on("ready to request",function(slot){return add(slot,"ready to request")});postbox.on("ad requested",function(slot){return add(slot,"ad requested")});postbox.on("bidding ended",function(slot){return add(slot,"bidding ended")});postbox.on("plugin done",function(slot,plugin){if(!plugins[slot]){plugins[slot]={}}plugins[slot][plugin]=elapsed(started[slot])});var tags=perf.tags={};function sanitize(v){if(Array.isArray(v)){if(v.length===1){return sanitize(v[0])}else{return v.join(", ")}}else{return isNaN(v)?v:parseFloat(v)}}postbox.on("plugin response",function(slot,plugin,bid){Object.keys(bid).forEach(function(key){if(!tags[slot]){tags[slot]={}}tags[slot][key+" ("+plugin+")"]=sanitize(bid[key])})});perf.print=function(){console.group("Slots performance");console.table(perf.slots);console.groupEnd();console.group("Plugins performance");console.table(perf.plugins);console.groupEnd();console.group("Plugins key+values");console.table(perf.tags);console.groupEnd()};var queue=[];adverts.afterCriticalQueue=[];function createElement(url,async){var tag=document.createElement("script");tag.src=url;tag.async=async;return tag}adverts.loadScriptAfterCritical=function(url){var async=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var call=function call(){DM.log("ads","Loading async script:",url);document.body.appendChild(createElement(url,async))};if(criticalScriptsSources.find(function(needle){return~url.indexOf(needle)})){call()}else{DM.log("ads","Delaying the load of:",url);adverts.afterCriticalQueue.push(call)}};function isRunningInNode(){return typeof module!=="undefined"&&module.exports}if(!isRunningInNode()&&!PageCriteria.isMobile&&!~window.location.search.indexOf("no-delay")){_MessageBroker2.default.setDispatcher(function(sender,msg,done){if(queue===undefined){done();return}if(msg[0]==="slot defined"){if(~triggers.indexOf(msg[1].pos)){done()}else{queue.push(done)}}else{done()}})}function continueBidding(){queue.forEach(function(cb){return cb()});queue=undefined}function continueLoading(){var run=function run(cb){try{cb()}catch(e){DM.log("ads","Error running delayed async script",e)}};adverts.afterCriticalQueue.forEach(run);adverts.afterCriticalQueue=[];adverts.afterCriticalQueue.push=run}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ads-utils/MessageBroker":64}],75:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function cygnus_index_start(e){started=Date.now(),cygnus_index_initialize(e)}window.cygnus_index_start=cygnus_index_start;function cygnus_index_initialize(e){function t(e){var t=n[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}function r(e){return i.lastIndex=0,i.test(e)?e.replace(i,t):e}function s(e){if(this.initialized=!1,"number"!=typeof e||e%1!==0||0>e)throw"Invalid Site ID";this.siteID=e,this.impressions=[],top===self?(this.sitePage=location.href,this.topframe=1):(this.sitePage=document.referrer,this.topframe=0),_IndexRequestData.requestCounter="undefined"==typeof _IndexRequestData.requestCounter?Math.floor(256*Math.random()):(_IndexRequestData.requestCounter+1)%256,this.requestID=String((new Date).getTime()%2592e3*256+_IndexRequestData.requestCounter+256),this.initialized=!0}"object"==_typeof(window.index_slots)&&delete window.index_slots,window.index_slots_render=[],window.index_slots_add=[];var i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};s.prototype.serialize=function(){var e='{"id":'+this.requestID+',"site":{"page":"'+r(this.sitePage)+'"';"string"==typeof document.referrer&&(e+=',"ref":"'+r(document.referrer)+'"'),e+='},"imp":[';for(var t=0;t<this.impressions.length;t++){var s=this.impressions[t],i=[];e+='{"id":"'+s.id+'","banner":{"w":'+s.w+',"h":'+s.h+',"topframe":'+String(this.topframe)+"}","number"==typeof s.bidfloor&&(e+=',"bidfloor":'+s.bidfloor,"string"==typeof s.bidfloorcur&&(e+=',"bidfloorcur":"'+r(s.bidfloorcur)+'"')),"string"!=typeof s.slotID||s.slotID.match(/^\s*$/)||i.push('"sid":"'+r(s.slotID)+'"'),"number"==typeof s.siteID&&i.push('"siteID":'+s.siteID),i.length>0&&(e+=',"ext":{'+i.join()+"}"),e+=t+1==this.impressions.length?"}":"},"}return e+="]}"},s.prototype.setPageOverride=function(e){return"string"!=typeof e||e.match(/^\s*$/)?!1:(this.sitePage=e,!0)},s.prototype.addImpression=function(e,t,r,s,i,n){var o={id:String(this.impressions.length+1)};if("number"!=typeof e||1>=e)return null;if("number"!=typeof t||1>=t)return null;if(("string"==typeof i||"number"==typeof i)&&String(i).length<=50&&(o.slotID=String(i)),o.w=e,o.h=t,void 0!=r&&"number"!=typeof r)return null;if("number"==typeof r){if(0>r)return null;if(o.bidfloor=r,void 0!=s&&"string"!=typeof s)return null;o.bidfloorcur=s}if("undefined"!=typeof n){if(!("number"==typeof n&&n%1===0&&n>=0))return null;o.siteID=n}return this.impressions.push(o),o.id},s.prototype.sendRequestAsync=function(e){var t=e?"/headertag?v=9":"/cygnus?v=7";if(0!=this.impressions.length&&this.initialized===!0){var r=encodeURIComponent(this.serialize()),s="https:"===window.location.protocol?"https://as-sec.casalemedia.com":"http://as.casalemedia.com";s+=t+"&fn=cygnus_index_parse_res&s="+this.siteID+"&r="+r;var i=document.createElement("script");i.setAttribute("src",s),i.setAttribute("type","text/javascript");var n=document.getElementsByTagName("script")[0];return n.parentNode&&n.parentNode.insertBefore(i,n),this.requestID}};try{if("undefined"==typeof window.IndexArgs||"undefined"==typeof window.IndexArgs.siteID||"undefined"==typeof window.IndexArgs.slots)return;"undefined"==typeof window._IndexRequestData&&(window._IndexRequestData={},window._IndexRequestData.impIDToSlotID={},window._IndexRequestData.reqOptions={});var o=new s(window.IndexArgs.siteID);window.IndexArgs.url&&"string"==typeof window.IndexArgs.url&&o.setPageOverride(window.IndexArgs.url),window._IndexRequestData.impIDToSlotID[o.requestID]={},window._IndexRequestData.reqOptions[o.requestID]={};for(var u,a,d=0;d<window.IndexArgs.slots.length;d++){u=window.IndexArgs.slots[d],a=o.addImpression(u.width,u.height,u.bidfloor,u.bidfloorcur,u.id,u.siteID),a&&(window._IndexRequestData.impIDToSlotID[o.requestID][a]=String(u.id))}return"number"==typeof window.IndexArgs.targetMode&&(window._IndexRequestData.reqOptions[o.requestID].targetMode=window.IndexArgs.targetMode),"function"==typeof window.IndexArgs.callback&&(window._IndexRequestData.reqOptions[o.requestID].callback=window.IndexArgs.callback),o.sendRequestAsync(e)}catch(f){}}window.cygnus_index_initialize=cygnus_index_initialize;var tierone2tiertwo={158654:164110,159312:164111,159313:164112},started=0},{}],"/src/page-utils/PageCriteria.js":[function(require,module,exports){"use strict";if(!window.PageCriteria){window.PageCriteria=function(criteria){window.PageCriteria=criteria}}},{}]},{},[73]);