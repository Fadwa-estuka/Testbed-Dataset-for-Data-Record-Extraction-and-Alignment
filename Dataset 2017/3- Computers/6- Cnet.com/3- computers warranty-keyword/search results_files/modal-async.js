define(["jquery","version!fly/managers/debug","version!fly/managers/components","components/global-modal","components/loading","version!fly/components/form-validate"],function(t,e,n){e=e.init("modalAsync");var o=t.support.touch?"vclick":"click";t.widget("cnet.modalAsync",t.cnet.globalModal,{options:{url:null,data:null},_create:function(){this._super(),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){this.loader=t.cnet.loading(),this.loader.$element.addClass("modal-content")},open:function(){if(!this.isOpen&&this.options.url){var e=this;this.setContent(""),this.loader.$element.appendTo(this.$element),this.loader.add(),t.ajax({dataType:"text",url:this.options.url,data:this.options.data}).done(function(o){e.loader.remove();try{e.setContent(t.parseJSON(o).html)}catch(t){e.setContent(o)}e.position(),n.process(e.$element),e._trigger("contentLoaded",null,t.extend({},this.eventData,{content:o}))}).always(function(){e.loader.remove()}),this._super()}}}),t(document).on(o+".modalAsync-api.data-api",'[data-open="modalAsync"]',function(e){var n,o=t(this),a=o.data(),s=a.$modal;e.preventDefault(),s?s.open():(n=o.data("modalAsyncOptions")||o.dataPrefix("modalAsync"),o.data("$modal",t.cnet.modalAsync(t.extend(n,{openOnInit:!0,destroy:function(){o.data("$modal",null)}}))))})});