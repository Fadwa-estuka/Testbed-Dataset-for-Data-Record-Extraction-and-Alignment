/*! scripts/search/utils/search_session_log.js */
Tumblr.Search||(Tumblr.Search={}),function(){var t=Tumblr.log_lady,e=t.Log.extend({log_key:"search_session_v1",defaults:{init_event:!0,keep_counts:!0},initialize:function(){var e=t.watching.search_session_v1;this.listenTo(Tumblr.Events,"search-post:logging-event",this.trigger,this),this.options.init_event&&e&&(this.options.init_event=!1,this.trigger("init",{previous:{env:e.env,uuid:e.uuid}})),t.watch(this)},before_replaced:function(t){this.unloaded({next:{env:t.env,uuid:t.uuid}})}},{trigger:function(){var t=this.log_instance();return t?t.trigger.apply(t,arguments):(this._trigger_q||(this._trigger_q=[]),this._trigger_q.push([].slice.apply(arguments)),!1)},set_search_model:function(t){this.search_model&&this.search_model.off("query:change:posts",this.new_log_instance),this.search_model=t,this.search_model.on("query:change:posts",this.new_log_instance,this);var e=this.log_instance();e&&_.each(this._trigger_q,function(t){e.trigger.apply(t)})},new_log_instance:function(){this._log_instance=null,this.log_instance()},log_instance:function(){if(!this._log_instance&&this.search_model){var t=this.search_model.log_lady_env(),s=this.search_model.generate_search_session_id();this._log_instance=new e({uuid:s,env:t}),Tumblr.Events.trigger("search:session:change:uuid",{uuid:s})}return this._log_instance}});Tumblr.Search.SearchSessionLog=e}();/*! scripts/vendor/iscroll/iscroll-probe.custom.js */
/*! iScroll v5.0.5 ~ (c) 2008-2013 Matteo Spinelli ~ http://cubiq.org/license */
var IScroll=function(t,e,s){function i(t,s){this.wrapper="string"==typeof t?e.querySelector(t):t,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeIndicator:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0,reverseHorizontalScroll:!0};for(var i in s)this.options[i]=s[i];this.translateZ=this.options.HWCompositing&&l.hasPerspective?" translateZ(0)":"",this.options.useTransition=l.hasTransition&&this.options.useTransition,this.options.useTransform=l.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?l.ease[this.options.bounceEasing]||l.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,3==this.options.probeType&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function o(t,s,i){var o=e.createElement("div"),n=e.createElement("div");return i===!0&&(o.style.cssText="position:absolute;z-index:9999",n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),n.className="iScrollIndicator","h"==t?(i===!0&&(o.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",n.style.height="100%"),o.className="iScrollHorizontalScrollbar"):(i===!0&&(o.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",n.style.width="100%"),o.className="iScrollVerticalScrollbar"),s||(o.style.pointerEvents="none"),o.appendChild(n),o}function n(s,i){this.wrapper="string"==typeof i.el?e.querySelector(i.el):i.el,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=s,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,speedRatioX:0,speedRatioY:0};for(var o in i)this.options[o]=i[o];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(l.addEvent(this.indicator,"touchstart",this),l.addEvent(this.indicator,"MSPointerDown",this),l.addEvent(this.indicator,"mousedown",this),l.addEvent(t,"touchend",this),l.addEvent(t,"MSPointerUp",this),l.addEvent(t,"mouseup",this))}var r=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},l=function(){function i(t){return r===!1?!1:""===r?t:r+t.charAt(0).toUpperCase()+t.substr(1)}var o={},n=e.createElement("div").style,r=function(){for(var t,e=["t","webkitT","MozT","msT","OT"],s=0,i=e.length;i>s;s++)if(t=e[s]+"ransform",t in n)return e[s].substr(0,e[s].length-1);return!1}();o.getTime=Date.now||function(){return(new Date).getTime()},o.extend=function(t,e){for(var s in e)t[s]=e[s]},o.addEvent=function(t,e,s,i){t.addEventListener(e,s,!!i)},o.removeEvent=function(t,e,s,i){t.removeEventListener(e,s,!!i)},o.momentum=function(t,e,i,o,n){var r,l,a=t-e,h=s.abs(a)/i,c=6e-4;return r=t+h*h/(2*c)*(0>a?-1:1),l=h/c,o>r?(r=n?o-n/2.5*(h/8):o,a=s.abs(r-t),l=a/h):r>0&&(r=n?n/2.5*(h/8):0,a=s.abs(t)+r,l=a/h),{destination:s.round(r),duration:l}};var l=i("transform");return o.extend(o,{hasTransform:l!==!1,hasPerspective:i("perspective")in n,hasTouch:"ontouchstart"in t,hasPointer:navigator.msPointerEnabled,hasTransition:i("transition")in n}),o.isAndroidBrowser=/Android/.test(t.navigator.appVersion)&&/Version\/\d/.test(t.navigator.appVersion),o.extend(o.style={},{transform:l,transitionTimingFunction:i("transitionTimingFunction"),transitionDuration:i("transitionDuration"),transformOrigin:i("transformOrigin")}),o.hasClass=function(t,e){var s=new RegExp("(^|\\s)"+e+"(\\s|$)");return s.test(t.className)},o.addClass=function(t,e){if(!o.hasClass(t,e)){var s=t.className.split(" ");s.push(e),t.className=s.join(" ")}},o.removeClass=function(t,e){if(o.hasClass(t,e)){var s=new RegExp("(^|\\s)"+e+"(\\s|$)","g");t.className=t.className.replace(s," ")}},o.offset=function(t){for(var e=-t.offsetLeft,s=-t.offsetTop;t=t.offsetParent;)e-=t.offsetLeft,s-=t.offsetTop;return{left:e,top:s}},o.preventDefaultException=function(t,e){for(var s in e)if(e[s].test(t[s]))return!0;return!1},o.extend(o.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),o.extend(o.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(t){return t*(2-t)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(t){return s.sqrt(1- --t*t)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(t){var e=4;return(t-=1)*t*((e+1)*t+e)+1}},bounce:{style:"",fn:function(t){return(t/=1)<1/2.75?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}},elastic:{style:"",fn:function(t){var e=.22,i=.4;return 0===t?0:1==t?1:i*s.pow(2,-10*t)*s.sin((t-e/4)*(2*s.PI)/e)+1}}}),o.tap=function(t,s){var i=e.createEvent("Event");i.initEvent(s,!0,!0),i.pageX=t.pageX,i.pageY=t.pageY,t.target.dispatchEvent(i)},o.click=function(t){var s,i=t.target;"SELECT"!=i.tagName&&"INPUT"!=i.tagName&&"TEXTAREA"!=i.tagName&&(s=e.createEvent("MouseEvents"),s.initMouseEvent("click",!0,!0,t.view,1,i.screenX,i.screenY,i.clientX,i.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),s._constructed=!0,i.dispatchEvent(s))},o}();return i.prototype={version:"5.0.5",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(t){t.target==this.scroller&&(this._transitionTime(0),this.resetPosition(this.options.bounceTime)||this._execEvent("scrollEnd"))},_start:function(t){if((1==l.eventType[t.type]||0===t.button)&&this.enabled&&(!this.initiated||l.eventType[t.type]===this.initiated)){!this.options.preventDefault||l.isAndroidBrowser||l.preventDefaultException(t.target,this.options.preventDefaultException)||t.preventDefault();var e,i=t.touches?t.touches[0]:t;this.initiated=l.eventType[t.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.isAnimating=!1,this.startTime=l.getTime(),this.options.useTransition&&this.isInTransition&&(e=this.getComputedPosition(),this._translate(s.round(e.x),s.round(e.y)),this.isInTransition=!1),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=i.pageX,this.pointY=i.pageY,this._execEvent("scrollStart")}},_move:function(t){if(this.enabled&&l.eventType[t.type]===this.initiated){this.options.preventDefault&&t.preventDefault();var e,i,o,n,r=t.touches?t.touches[0]:t,a=this.hasHorizontalScroll?r.pageX-this.pointX:0,h=this.hasVerticalScroll?r.pageY-this.pointY:0,c=l.getTime();if(this.pointX=r.pageX,this.pointY=r.pageY,this.distX+=a,this.distY+=h,o=s.abs(this.distX),n=s.abs(this.distY),!(c-this.endTime>300&&10>o&&10>n)){if(this.directionLocked||this.options.freeScroll||(o>n+this.options.directionLockThreshold?this.directionLocked="h":n>=o+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)t.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);h=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)t.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);a=0}e=this.x+a,i=this.y+h,(e>0||e<this.maxScrollX)&&(e=this.options.bounce?this.x+a/3:e>0?0:this.maxScrollX),(i>0||i<this.maxScrollY)&&(i=this.options.bounce?this.y+h/3:i>0?0:this.maxScrollY),this.directionX=a>0?-1:0>a?1:0,this.directionY=h>0?-1:0>h?1:0,this.moved=!0,this._translate(e,i),c-this.startTime>300&&(this.startTime=c,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent("scroll")),this.options.probeType>1&&this._execEvent("scroll")}}},_end:function(t){if(this.enabled&&l.eventType[t.type]===this.initiated){this.options.preventDefault&&!l.preventDefaultException(t.target,this.options.preventDefaultException)&&t.preventDefault();var e,i,o=(t.changedTouches?t.changedTouches[0]:t,l.getTime()-this.startTime),n=s.round(this.x),r=s.round(this.y),a=s.abs(n-this.startX),h=s.abs(r-this.startY),c=0,_="";if(this.scrollTo(n,r),this.isInTransition=0,this.initiated=0,this.endTime=l.getTime(),!this.resetPosition(this.options.bounceTime)){if(!this.moved)return this.options.tap&&l.tap(t,this.options.tap),void(this.options.click&&l.click(t));if(this._events.flick&&200>o&&100>a&&100>h)return void this._execEvent("flick");if(this.options.momentum&&300>o&&(e=this.hasHorizontalScroll?l.momentum(this.x,this.startX,o,this.maxScrollX,this.options.bounce?this.wrapperWidth:0):{destination:n,duration:0},i=this.hasVerticalScroll?l.momentum(this.y,this.startY,o,this.maxScrollY,this.options.bounce?this.wrapperHeight:0):{destination:r,duration:0},n=e.destination,r=i.destination,c=s.max(e.duration,i.duration),this.isInTransition=1),this.options.snap){var d=this._nearestSnap(n,r);this.currentPage=d,c=this.options.snapSpeed||s.max(s.max(s.min(s.abs(n-d.x),1e3),s.min(s.abs(r-d.y),1e3)),300),n=d.x,r=d.y,this.directionX=0,this.directionY=0,_=this.options.bounceEasing}return n!=this.x||r!=this.y?((n>0||n<this.maxScrollX||r>0||r<this.maxScrollY)&&(_=l.ease.quadratic),void this.scrollTo(n,r,c,_)):void this._execEvent("scrollEnd")}}},_resize:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){t.refresh()},this.options.resizePolling)},resetPosition:function(t){var e=this.x,s=this.y;return t=t||0,!this.hasHorizontalScroll||this.x>0?e=0:this.x<this.maxScrollX&&(e=this.maxScrollX),!this.hasVerticalScroll||this.y>0?s=0:this.y<this.maxScrollY&&(s=this.maxScrollY),e==this.x&&s==this.y?!1:(this.scrollTo(e,s,t,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=l.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)},_execEvent:function(t){if(this._events[t]){var e=0,s=this._events[t].length;if(s)for(;s>e;e++)this._events[t][e].call(this)}},scrollBy:function(t,e,s,i){t=this.x+t,e=this.y+e,s=s||0,this.scrollTo(t,e,s,i)},scrollTo:function(t,e,s,i){i=i||l.ease.circular,!s||this.options.useTransition&&i.style?(this._transitionTimingFunction(i.style),this._transitionTime(s),this._translate(t,e)):this._animate(t,e,s,i.fn)},scrollToElement:function(t,e,i,o,n){if(t=t.nodeType?t:this.scroller.querySelector(t)){var r=l.offset(t);r.left-=this.wrapperOffset.left,r.top-=this.wrapperOffset.top,i===!0&&(i=s.round(t.offsetWidth/2-this.wrapper.offsetWidth/2)),o===!0&&(o=s.round(t.offsetHeight/2-this.wrapper.offsetHeight/2)),r.left-=i||0,r.top-=o||0,r.left=r.left>0?0:r.left<this.maxScrollX?this.maxScrollX:r.left,r.top=r.top>0?0:r.top<this.maxScrollY?this.maxScrollY:r.top,e=void 0===e||null===e||"auto"===e?s.max(s.abs(this.x-r.left),s.abs(this.y-r.top)):e,this.scrollTo(r.left,r.top,e,n)}},_transitionTime:function(t){t=t||0,this.scrollerStyle[l.style.transitionDuration]=t+"ms",this.indicator1&&this.indicator1.transitionTime(t),this.indicator2&&this.indicator2.transitionTime(t)},_transitionTimingFunction:function(t){this.scrollerStyle[l.style.transitionTimingFunction]=t,this.indicator1&&this.indicator1.transitionTimingFunction(t),this.indicator2&&this.indicator2.transitionTimingFunction(t)},_translate:function(t,e){this.options.useTransform?this.scrollerStyle[l.style.transform]="translate("+t+"px,"+e+"px)"+this.translateZ:(t=s.round(t),e=s.round(e),this.scrollerStyle.left=t+"px",this.scrollerStyle.top=e+"px"),this.x=t,this.y=e,this.indicator1&&this.indicator1.updatePosition(),this.indicator2&&this.indicator2.updatePosition()},_initEvents:function(e){var s=e?l.removeEvent:l.addEvent,i=this.options.bindToWrapper?this.wrapper:t;s(t,"orientationchange",this),s(t,"resize",this),this.options.disableMouse||(s(this.wrapper,"mousedown",this),s(i,"mousemove",this),s(i,"mousecancel",this),s(i,"mouseup",this)),l.hasPointer&&(s(this.wrapper,"MSPointerDown",this),s(i,"MSPointerMove",this),s(i,"MSPointerCancel",this),s(i,"MSPointerUp",this)),l.hasTouch&&(s(this.wrapper,"touchstart",this),s(i,"touchmove",this),s(i,"touchcancel",this),s(i,"touchend",this)),s(this.scroller,"transitionend",this),s(this.scroller,"webkitTransitionEnd",this),s(this.scroller,"oTransitionEnd",this),s(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var e,s,i=t.getComputedStyle(this.scroller,null);return this.options.useTransform?(i=i[l.style.transform].split(")")[0].split(", "),e=+(i[12]||i[4]),s=+(i[13]||i[5])):(e=+i.left.replace(/[^-\d]/g,""),s=+i.top.replace(/[^-\d]/g,"")),{x:e,y:s}},_initIndicators:function(){var t,e,s=this.options.interactiveScrollbars,i=("object"!=typeof this.options.scrollbars,"string"!=typeof this.options.scrollbars);this.options.scrollbars?(this.options.scrollY&&(t={el:o("v",s,this.options.scrollbars),interactive:s,defaultScrollbars:!0,customStyle:i,resize:this.options.resizeIndicator,listenX:!1},this.wrapper.appendChild(t.el)),this.options.scrollX&&(e={el:o("h",s,this.options.scrollbars),interactive:s,defaultScrollbars:!0,customStyle:i,resize:this.options.resizeIndicator,listenY:!1},this.wrapper.appendChild(e.el))):(t=this.options.indicators.length?this.options.indicators[0]:this.options.indicators,e=this.options.indicators[1]&&this.options.indicators[1]),t&&(this.indicator1=new n(this,t)),e&&(this.indicator2=new n(this,e)),this.on("refresh",function(){this.indicator1&&this.indicator1.refresh(),this.indicator2&&this.indicator2.refresh()}),this.on("destroy",function(){this.indicator1&&(this.indicator1.destroy(),this.indicator1=null),this.indicator2&&(this.indicator2.destroy(),this.indicator2=null)})},_initWheel:function(){l.addEvent(this.wrapper,"mousewheel",this),l.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){l.removeEvent(this.wrapper,"mousewheel",this),l.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(t){if(this.enabled){var e,i,o,n,r=this;if(clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){r.directionLocked=0,r._execEvent("scrollEnd")},400),"wheelDeltaX"in t)e=t.wheelDeltaX/120,i=t.wheelDeltaY/120;else if("wheelDelta"in t)e=i=t.wheelDelta/120;else{if(!("detail"in t))return;e=i=-t.detail/3}if("axis"in t&&(1===t.axis?i=0:e=0),e*=this.options.mouseWheelSpeed,i*=this.options.mouseWheelSpeed,!this.hasVerticalScroll&&this.options.reverseHorizontalScroll&&(e=i,i=0),this.options.snap)return o=this.currentPage.pageX,n=this.currentPage.pageY,e>0?o--:0>e&&o++,i>0?n--:0>i&&n++,void this.goToPage(o,n);if(absDistX=s.abs(e),absDistY=s.abs(i),this.directionLocked||this.options.freeScroll||(absDistX>absDistY+this.options.directionLockThreshold?this.directionLocked="h":absDistY>=absDistX+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)t.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);i=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)t.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);e=0}o=s.round(this.x+(this.hasHorizontalScroll?e*this.options.invertWheelDirection:0)),n=s.round(this.y+(this.hasVerticalScroll?i*this.options.invertWheelDirection:0)),o>0?o=0:o<this.maxScrollX&&(o=this.maxScrollX),n>0?n=0:n<this.maxScrollY&&(n=this.maxScrollY),this.scrollTo(o,n,0),this.options.probeType>1&&this._execEvent("scroll")}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var t,e,i,o,n,r,l=0,a=0,h=0,c=this.options.snapStepX||this.wrapperWidth,_=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(this.options.snap===!0)for(i=s.round(c/2),o=s.round(_/2);h>-this.scrollerWidth;){for(this.pages[l]=[],t=0,n=0;n>-this.scrollerHeight;)this.pages[l][t]={x:s.max(h,this.maxScrollX),y:s.max(n,this.maxScrollY),width:c,height:_,cx:h-i,cy:n-o},n-=_,t++;h-=c,l++}else for(r=this.options.snap,t=r.length,e=-1;t>l;l++)(0===l||r[l].offsetLeft<=r[l-1].offsetLeft)&&(a=0,e++),this.pages[a]||(this.pages[a]=[]),h=s.max(-r[l].offsetLeft,this.maxScrollX),n=s.max(-r[l].offsetTop,this.maxScrollY),i=h-s.round(r[l].offsetWidth/2),o=n-s.round(r[l].offsetHeight/2),this.pages[a][e]={x:h,y:n,width:r[l].offsetWidth,height:r[l].offsetHeight,cx:i,cy:o},h>this.maxScrollX&&a++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=s.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=s.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var t=this.options.snapSpeed||s.max(s.max(s.min(s.abs(this.x-this.startX),1e3),s.min(s.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,t)})},_nearestSnap:function(t,e){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var i=0,o=this.pages.length,n=0;if(s.abs(t-this.absStartX)<this.snapThresholdX&&s.abs(e-this.absStartY)<this.snapThresholdY)return this.currentPage;for(t>0?t=0:t<this.maxScrollX&&(t=this.maxScrollX),e>0?e=0:e<this.maxScrollY&&(e=this.maxScrollY);o>i;i++)if(t>=this.pages[i][0].cx){t=this.pages[i][0].x;break}for(o=this.pages[i].length;o>n;n++)if(e>=this.pages[0][n].cy){e=this.pages[0][n].y;break}return i==this.currentPage.pageX&&(i+=this.directionX,0>i?i=0:i>=this.pages.length&&(i=this.pages.length-1),t=this.pages[i][0].x),n==this.currentPage.pageY&&(n+=this.directionY,0>n?n=0:n>=this.pages[0].length&&(n=this.pages[0].length-1),e=this.pages[0][n].y),{x:t,y:e,pageX:i,pageY:n}},goToPage:function(t,e,i,o){o=o||this.options.bounceEasing,t>=this.pages.length?t=this.pages.length-1:0>t&&(t=0),e>=this.pages[t].length?e=this.pages[t].length-1:0>e&&(e=0);var n=this.pages[t][e].x,r=this.pages[t][e].y;i=void 0===i?this.options.snapSpeed||s.max(s.max(s.min(s.abs(n-this.x),1e3),s.min(s.abs(r-this.y),1e3)),300):i,this.currentPage={x:n,y:r,pageX:t,pageY:e},this.scrollTo(n,r,i,o)},next:function(t,e){var s=this.currentPage.pageX,i=this.currentPage.pageY;s++,s>=this.pages.length&&this.hasVerticalScroll&&(s=0,i++),this.goToPage(s,i,t,e)},prev:function(t,e){var s=this.currentPage.pageX,i=this.currentPage.pageY;s--,0>s&&this.hasVerticalScroll&&(s=0,i--),this.goToPage(s,i,t,e)},_initKeys:function(e){var s,i={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(s in this.options.keyBindings)"string"==typeof this.options.keyBindings[s]&&(this.options.keyBindings[s]=this.options.keyBindings[s].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(s in i)this.options.keyBindings[s]=this.options.keyBindings[s]||i[s];l.addEvent(t,"keydown",this),this.on("destroy",function(){l.removeEvent(t,"keydown",this)})},_key:function(t){if(this.enabled){var e,i=this.options.snap,o=i?this.currentPage.pageX:this.x,n=i?this.currentPage.pageY:this.y,r=l.getTime(),a=this.keyTime||0,h=.25;switch(this.options.useTransition&&this.isInTransition&&(e=this.getComputedPosition(),this._translate(s.round(e.x),s.round(e.y)),this.isInTransition=!1),this.keyAcceleration=200>r-a?s.min(this.keyAcceleration+h,50):0,t.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?o+=i?1:this.wrapperWidth:n+=i?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?o-=i?1:this.wrapperWidth:n-=i?1:this.wrapperHeight;break;case this.options.keyBindings.end:o=i?this.pages.length-1:this.maxScrollX,n=i?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:o=0,n=0;break;case this.options.keyBindings.left:o+=i?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:n+=i?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:o-=i?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:n-=i?1:5+this.keyAcceleration>>0}if(i)return void this.goToPage(o,n);o>0?(o=0,this.keyAcceleration=0):o<this.maxScrollX&&(o=this.maxScrollX,this.keyAcceleration=0),n>0?(n=0,this.keyAcceleration=0):n<this.maxScrollY&&(n=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(o,n,0),this.keyTime=r}},_animate:function(t,e,s,i){function o(){var d,u,p,g=l.getTime();return g>=_?(n.isAnimating=!1,n._translate(t,e),void(n.resetPosition(n.options.bounceTime)||n._execEvent("scrollEnd"))):(g=(g-c)/s,p=i(g),d=(t-a)*p+a,u=(e-h)*p+h,n._translate(d,u),n.isAnimating&&r(o),void(3==n.options.probeType&&n._execEvent("scroll")))}var n=this,a=this.x,h=this.y,c=l.getTime(),_=c+s;this.isAnimating=!0,o()},handleEvent:function(t){switch(t.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(t);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(t);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(t);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(t);break;case"DOMMouseScroll":case"mousewheel":this._wheel(t);break;case"keydown":this._key(t)}}},n.prototype={handleEvent:function(t){switch(t.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(t);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(t);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(t)}},destroy:function(){this.options.interactive&&(l.removeEvent(this.indicator,"touchstart",this),l.removeEvent(this.indicator,"MSPointerDown",this),l.removeEvent(this.indicator,"mousedown",this),l.removeEvent(t,"touchmove",this),l.removeEvent(t,"MSPointerMove",this),l.removeEvent(t,"mousemove",this),l.removeEvent(t,"touchend",this),l.removeEvent(t,"MSPointerUp",this),l.removeEvent(t,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(e){var s=e.touches?e.touches[0]:e;e.preventDefault(),e.stopPropagation(),this.transitionTime(0),this.initiated=!0,this.moved=!1,this.lastPointX=s.pageX,this.lastPointY=s.pageY,this.startTime=l.getTime(),l.addEvent(t,"touchmove",this),l.addEvent(t,"MSPointerMove",this),l.addEvent(t,"mousemove",this),this.scroller._execEvent("scrollStart")},_move:function(t){var e,s,i,o,n=t.touches?t.touches[0]:t;l.getTime();this.moved=!0,e=n.pageX-this.lastPointX,this.lastPointX=n.pageX,s=n.pageY-this.lastPointY,this.lastPointY=n.pageY,i=this.x+e,o=this.y+s,this._pos(i,o),this.scroller._execEvent("scroll"),t.preventDefault(),t.stopPropagation()},_end:function(e){if(this.initiated){if(this.initiated=!1,e.preventDefault(),e.stopPropagation(),l.removeEvent(t,"touchmove",this),l.removeEvent(t,"MSPointerMove",this),l.removeEvent(t,"mousemove",this),this.scroller.options.snap){var i=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),o=this.options.snapSpeed||s.max(s.max(s.min(s.abs(this.scroller.x-i.x),1e3),s.min(s.abs(this.scroller.y-i.y),1e3)),300);this.scroller.x==i.x&&this.scroller.y==i.y||(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=i,this.scroller.scrollTo(i.x,i.y,o,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(t){t=t||0,this.indicatorStyle[l.style.transitionDuration]=t+"ms"},transitionTimingFunction:function(t){this.indicatorStyle[l.style.transitionTimingFunction]=t},refresh:function(){this.transitionTime(0),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(l.addClass(this.wrapper,"iScrollBothScrollbars"),l.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(l.removeClass(this.wrapper,"iScrollBothScrollbars"),l.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=s.max(s.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=s.max(s.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var t=s.round(this.sizeRatioX*this.scroller.x)||0,e=s.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(0>t?t=0:t>this.maxPosX&&(t=this.maxPosX),0>e?e=0:e>this.maxPosY&&(e=this.maxPosY)),this.x=t,this.y=e,this.scroller.options.useTransform?this.indicatorStyle[l.style.transform]="translate("+t+"px,"+e+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=t+"px",this.indicatorStyle.top=e+"px")},_pos:function(t,e){0>t?t=0:t>this.maxPosX&&(t=this.maxPosX),0>e?e=0:e>this.maxPosY&&(e=this.maxPosY),t=this.options.listenX?s.round(t/this.sizeRatioX):this.scroller.x,e=this.options.listenY?s.round(e/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(t,e)}},i.ease=l.ease,i}(window,document,Math);/*! scripts/pagebox.js */
/*!
 * Tumblr.Pagebox
 * Create lightboxes and overlays from URLs or html fragments.
 * Features:
 *   - Easily talk from the url or html fragment using Tumblr.PageboxLink
 *   - Optional glass and loader
 *   - Lots of callbacks
 */
!function(t,e){var s=Backbone.View.extend({defaults:{has_glass:!0,glass_close:!0,glass_load:!0,glass_color:"#000",glass_opacity:.67,load_timeout:5e3,destroy_on_close:!0,post_message_scope:"*"},events:{},initialize:function(t){this.options=t||{},this.options=_.extend(this.defaults,this.options),this.callback={},this.built=!1,this.visible=!1,this.t_visible_timeout=null,this.t_focus_timeout=null,this.callback.on_payload=this._set_callback(this.options.on_payload),this.callback.before_show=this._set_callback(this.options.before_show),this.callback.on_show=this._set_callback(this.options.on_show),this.callback.before_hide=this._set_callback(this.options.before_hide),this.callback.on_hide=this._set_callback(this.options.on_hide),this.callback.before_destroy=this._set_callback(this.options.before_destroy),this.callback.on_destroy=this._set_callback(this.options.on_destroy),this.callback.on_error=this._set_callback(this.options.on_error),this._listen(),this.options.glass_close&&this._setup_keys()},_set_callback:function(t){return _.isFunction(t)?t:function(){}},open_url:function(e){return this._can_set()?(this.$iframe=t("<iframe>",{scrolling:"yes",frameborder:"0",style:"opacity:0;",src:e,"class":"ui_pagebox"}),t("body").append(this.$iframe),void this._finish_building()):!1},open_html:function(){return this._can_set()?(alert("HTML fragments are not yet implemented."),void this._finish_building()):!1},change_url:function(t){this.$iframe.css({opacity:"0"}),this._do_loader(),this.$iframe.attr("src",t)},_can_set:function(){return 0===t(".ui_pagebox").length},_finish_building:function(){this.built||(this.options.has_glass&&(this.$glass=t("<div/>").addClass("ui_pagebox_glass"),t("body").append(this.$glass),this.options.glass_close&&this.$glass.click(_.bind(this.close,this)),this.$glass.css("background-color",this.options.glass_color),this.$glass.css("opacity",this.options.glass_opacity),this._do_loader()),t("html").css("overflow","hidden"),this.built=!0,this.t_visible_timeout=setTimeout(_.bind(this.callback.on_error,this),this.options.load_timeout))},_listen:function(){var e=this._listen_handler;t(window).on("message.pagebox",_.bind(e,this))},_listen_handler:function(t){var e=t.originalEvent,s=!1,i=!1;if(_.isString(e.data)&&(s=e.data),s){if(0===s.indexOf("page_payload:")&&(i=s.substring(13),s="page_payload",i))try{i=JSON.parse(i)}catch(e){i=!1}switch(s){case"close_glass":case"page_close":this.close();break;case"page_ready":this.show();break;case"page_load":break;case"page_payload":this.callback.on_payload(i)}}},show:function(){_.isObject(this.loader)&&this.loader.destroy(),clearTimeout(this.t_visible_timeout),this.callback.before_show(),t("html").css("overflow","hidden"),this._show_glass(),this._show_iframe(),this.visible=!0,this.callback.on_show()},_do_loader:function(){if(this.options.glass_load){var t={color:"#fff"};this.loader=new Tumblr.Loader(t),this.loader.start(this.$glass)}},_show_glass:function(){this.options.has_glass&&_.isObject(this.$glass)&&this.$glass.show()},_show_iframe:function(){_.isObject(this.$iframe)&&(this.$iframe.css({opacity:"1"}),this.t_focus_timeout=setTimeout(t.proxy(function(){this.$iframe[0].contentWindow.blur(),this.$iframe[0].contentWindow.focus(),this.t_focus_timeout=null},this),100))},_setup_keys:function(){t(document).on("keydown.pagebox",_.bind(function(t){var e=t.charCode?t.charCode:t.keyCode,s=(t.shiftKey,t.altKey,t.ctrlKey||t.shiftKey||t.metaKey);this.visible&&!s&&27===e&&this.close()},this))},close:function(){this.hide(),this.options.destroy_on_close&&this.destroy()},hide:function(){this.callback.before_hide(),t("html").css("overflow","auto"),_.isObject(this.loader)&&this.loader.destroy(),_.isObject(this.$glass)&&this.$glass.hide(),_.isObject(this.$iframe)&&this.$iframe.css({opacity:"0"}),this.visible=!1,this.callback.on_hide()},destroy:function(){this.callback.before_destroy(),t(window).off("message.pagebox"),t(document).off("keydown.pagebox"),this.hide(),_.isObject(this.$glass)&&this.$glass.remove(),_.isObject(this.$iframe)&&this.$iframe.remove(),this.t_focus_timeout&&clearTimeout(this.t_focus_timeout),this.callback.on_destroy()},test:function(){this.open_url("http://t.dev/hello_lightbox/dissap0inted/48664050807")},post_message:function(t,e){var s;s=e?t+":"+JSON.stringify(e):t,this.$iframe[0].contentWindow.postMessage(s,this.options.post_message_scope)}});e.Pagebox=s}(jQuery,Tumblr),function(t,e){var s={init:function(){return t(document).ready(this._ready),t(window).load(this._load),this},payload:function(t){var e=JSON.stringify(t);parent.postMessage("page_payload:"+e,"*")},close:function(){parent.postMessage("page_close","*")},_ready:function(){parent.postMessage("page_ready","*")},_load:function(){parent.postMessage("page_load","*")}};e.PageboxLink=s}(jQuery,Tumblr),/*! scripts/color_utilities.js */
function(t,e,s){var i={rgb_to_hex:function(t,e,s){return"#"+((1<<24)+(t<<16)+(e<<8)+s).toString(16).slice(1)},hex_to_rgb:function(t){t=new String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},rgb_to_hsv:function(t,e,s){var i=Math.min(Math.min(t,e),s),o=Math.max(Math.max(t,e),s),n=o-i,r={h:6,s:o?(o-i)/o:0,v:o/255};return n?o===t?r.h+=(e-s)/n:o===e?r.h+=2+(s-t)/n:r.h+=4+(t-e)/n:r.h=0,r.h=60*r.h%360,r},hsv_to_rgb:function(t,e,s){var i,o,n;if(e){i=o=n=0;var r=(t+360)%360/60,l=s*e,a=s-l,h=l*(1-Math.abs(r%2-1));1>r?(i=l,o=h):2>r?(i=h,o=l):3>r?(o=l,n=h):4>r?(o=h,n=l):5>r?(n=l,i=h):(n=h,i=l),i+=a,o+=a,n+=a}else i=o=n=s;return{r:Math.round(255*i),g:Math.round(255*o),b:Math.round(255*n)}},hex_to_hsv:function(t){t=new String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var i=s.ColorUtilities.hex_to_rgb(t),o=s.ColorUtilities.rgb_to_hsv.apply(s.ColorUtilities,e.toArray(i));return o},hsv_to_hex:function(t,i,o){var n=s.ColorUtilities.hsv_to_rgb(t,i,o),r=s.ColorUtilities.rgb_to_hex.apply(s.ColorUtilities,e.toArray(n));return r},hex_brightness:function(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var s,i,o,n=parseInt(t,16),r=0>e?0:255,l=0>e?-e:e,a=n>>16,h=n>>8&255,c=255&n;return s=Math.round((r-a)*l)+a,i=Math.round((r-h)*l)+h,o=Math.round((r-c)*l)+c,"#"+(16777216+65536*s+256*i+o).toString(16).slice(1)},hsv_to_readable:function(t){return"string"==typeof t&&(t=s.ColorUtilities.hex_to_hsv(t)),t.s<.2&&t.v>.8?"#444":"#FFF"},compare_colors:function(t,s,i){var o={upper_bound:.8,lower_bound:.2,diff_bound:.1,hue_bound:15};e.extend(o,i);var n=o.upper_bound,r=o.lower_bound,l=o.diff_bound,a=o.hue_bound,h=Math.abs(t.h-s.h),c=Math.abs(t.s-s.s),_=Math.abs(t.v-s.v);return l>=h&&l>=c&&l>=_?!0:l>=c&&l>=_&&(c>=n||r>=c&&_>=n||r>=_&&a>=h)}};s.ColorUtilities=i}(jQuery,_,Tumblr),/*! scripts/indash_blog/views/header/popover.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,s,i){var o=s.View.extend({className:"indash_header_popover",defaults:{direction:"left",edit_field:null,template:!1,template_data:{},trigger:null,glassless:!0},__close:function(){this.hide()},initialize:function(s){this.options=e.extend({},this.defaults,s),this.template=this.options.template,this.template_data=this.options.template_data,this.checkbox_template=e.template(t("#tumblelog_header_checkbox_template").html()),this.color_picker_template=e.template(t("#tumblelog_header_color_picker_template").html()),this.is_showing=!1,this.$popover=null,this.popover_view=null,i.Popover.register(this)},render:function(){var s=this.template(this.template_data);return this.$popover=t(s).appendTo(this.$el).hide(),this.popover_view=new Tumblr.Popover({el:this.options.trigger,popover:this.$popover,glassless:this.options.glassless,glassless_options:this.options.glassless_options,auto_show:!1,direction:this.options.direction,skip_offset:!0,on_show:e.bind(function(){this.is_showing||(Tumblr.Events.trigger("indashblog:popover:show",this,this.options.edit_field),this.is_showing=!0)},this),on_hide:e.bind(function(){this.is_showing&&(Tumblr.Events.trigger("indashblog:popover:hide",this,this.options.edit_field),this.is_showing=!1)},this)}),this},show:function(){this.popover_view.show()},hide:function(){this.is_showing&&(Tumblr.Events.trigger("indashblog:popover:hide",this,this.options.edit_field),this.is_showing=!1,this.popover_view.hide())}});o.instances=[],o.register=function(t){this.instances.push(t)},o.hide_all=function(){for(var t=0,e=this.instances.length;e>t;t++)this.instances[t].hide()},i.Popover=o}(jQuery,_,Backbone,Tumblr.IndashBlog.Header),/*! scripts/indash_blog/views/header/info_popover.js */
Tumblr.IndashBlog||(Tumblr.IndashBlog={}),Tumblr.IndashBlog.Header||(Tumblr.IndashBlog.Header={}),function(t,e,s,i){var o=i.Popover.extend({template:e.template(t("#tumblelog_header_info_popover_template").html()),defaults:{show_flag_button:!0},events:{"click .ask_menu_item":"__ask_menu_item_clicked","click .fan_mail_menu_item":"__fan_mail_menu_item_clicked","click .archive_menu_item":"__archive_menu_item_clicked","click .block":"__block_click","click .toggle_spam":"__toggle_spam_click","click .toggle_nsfw":"__toggle_nsfw_click","click .toggle_suspended":"__toggle_suspended_click","click .panel_menu_item":"__panel_menu_item_clicked"},__panel_menu_item_clicked:function(t){this.hide()},__ask_menu_item_clicked:function(t){t.preventDefault(),Tumblr.Events.trigger("indashblog:tumblelog:ask",{recipient:this.model.get("name"),anonymous_asks:this.model.get("anonymous_asks")}),this.hide()},__fan_mail_menu_item_clicked:function(t){t.preventDefault(),Tumblr.Events.trigger("indashblog:tumblelog:fan_mail",{recipient:this.model.get("name")}),this.hide()},__archive_menu_item_clicked:function(){this.hide()},__block_click:function(t){t.preventDefault();var s={blockedTumblelog:this.model.get("name")};Tumblr.Prima.Block.confirmBlock(s).then(e.bind(this.__onBlockConfirm,this)),Tumblr.Events.trigger("TumblelogPopover:navigation_menu_item_clicked"),this.hide()},__onBlockConfirm:function(){var t=new Tumblr.Prima.Models.Tumblelog({name:this.model.get("name")});t.block().then(e.bind(this._afterBlock,this))},__toggle_spam_click:function(t){t.preventDefault();var s=this.model.toggle_spam();s.success(e.bind(function(t){this.model.set("spam",!!t.spammer)},this))},__toggle_nsfw_click:function(t){t.preventDefault();var s=this.model.toggle_nsfw();s.success(e.bind(function(t){this.model.set("nsfw",t.nsfw)},this))},__toggle_suspended_click:function(t){t.preventDefault();var s=this.model.toggle_suspended();s.success(e.bind(function(t){this.model.set("suspended",t.suspended)},this))},__model_change:function(){var t=this.model.toJSON();this.$(".toggle_spam").toggleClass("is_flagged",!!t.spam),this.$(".toggle_nsfw").toggleClass("is_flagged",!!t.nsfw),this.$(".toggle_suspended").toggleClass("is_flagged",!!t.suspended)},_afterIgnore:function(){this.model.set("ignoring",!0),this.model.set("following",!1)},_afterBlock:function(){this.model.set("blocking",!0),this.model.set("following",!1)},_open_dialog:function(t,s){s=s||e.noop,this.is_disabled=!0,t.fail(e.bind(function(){this.is_disabled=this.is_menu_open},this)),t.done(e.bind(function(){this.is_disabled=this.is_menu_open,s()},this))},initialize:function(s){if(this.$trigger=s.trigger,this.targetPost=s.targetPost,this.model){var i=this.model.toJSON();e.defaults(i,s,this.defaults),this.$popover=t(this.template(i)).appendTo(this.$el).hide(),this.tumblelog=new Tumblr.Prima.Models.Tumblelog({name:this.model.get("name")}),this.listenTo(this.model,"change",this.__model_change),s=e.extend(s,{popover:this.$popover}),Tumblr.Popover.prototype.initialize.call(this,s)}},show:function(){this.position_popover(),this.listenTo(Tumblr.Events,"DOMEventor:flatresize",this.position_popover),Tumblr.Popover.prototype.show.call(this)},hide:function(){this.stopListening(Tumblr.Events,"DOMEventor:flatresize"),Tumblr.Popover.prototype.hide.call(this)},position_popover:function(){var t=this.$trigger.offset().left+"px";this.$popover.css({right:"auto",left:t})}});i.InfoPopover=o}(jQuery,_,Backbone,Tumblr.IndashBlog.Header);/*! scripts/indash_blog/views/header_view_compact.js */
var TumblrData=TumblrData||{},Events=Tumblr.Events;Tumblr.IndashBlog||(Tumblr.IndashBlog={}),function(t,e,s,i){"use strict";var o=s.View.extend({className:"indash_header_compact",defaults:{current_data:{},unfollow_data:{},follow_data:{},template_data:{},on_render:t.noop,hide_posts_on_unfollow:!1,strip_description_line_breaks:!1,include_info_popover:!0},events:{"click .customize_button":"__customize_button_clicked","click .description a":"__description_link_click","click .follow":"__on_follow_click","click .unfollow":"__on_follow_click",'click [data-post-action="remove"]':"__on_remove_click"},__customize_button_clicked:function(t){t.preventDefault(),t.stopPropagation(),Events.trigger("peepr-open-request",{tumblelog_name:this.model.get("name"),editing_appearance:!0})},__on_follow_click:function(t){if(t.preventDefault(),t.stopPropagation(),!Tumblr.Flags.bool("is_logged_in"))return void window.open("/follow/"+this.model.get("name"),"_self");if(this.model.get("following")){var s=Tumblr.TumblelogActions.confirm_unfollow({tumblelog:this.model.get("name"),avatar_url:this.model.get("avatar_url")||""});this._open_dialog(s,e.bind(function(){this.model.save_following({following:!1},this.options.unfollow_data),this.hide_posts_on_unfollow&&this._hide_posts()},this))}else this.model.save_following({following:!0},this.options.follow_data)},__on_remove_click:function(t){t.preventDefault(),this.destroy()},__description_link_click:function(e){e.preventDefault();var s=t(e.currentTarget).attr("href");try{if(Tumblr.Prima.Url&&Tumblr.Prima.Url.hasAllowedProtocol(s)){if(!Tumblr.Prima.Url.isAbsoluteUrl(s)){var i="http://"+this.model.get("name")+".tumblr.com/";s="/"===s.charAt(0)?s.substr(1):s,s=i+s}window.open(s,"_blank")}}catch(o){}},_render_follow_button:function(){this.model.get("following")?(this.$el.find(".follow").hide(),this.$el.find(".unfollow").show()):(this.$el.find(".unfollow").hide(),this.$el.find(".follow").show())},_hide_posts:function(){Tumblr.Posts.whereBy({tumblelog:this.model.get("name"),sponsored:!1}).invoke("dismiss")},_open_dialog:function(s,i){i=i||t.noop,this.is_disabled=!0,s.fail(e.bind(function(){this.is_disabled=this.is_menu_open},this)),s.done(e.bind(function(){this.is_disabled=this.is_menu_open,i()},this))},_render_inline_styles:function(){var t=this.model.get("global_theme_params"),e=this.model.get("has_default_header")&&Tumblr.Flags.bool("hide_default_headers_blog_cards"),s=!(!(t.header_image_focused&&t.header_stretch&&t.show_header_image)||e),i=Tumblr.ColorUtilities.hex_to_hsv(t.background_color),o=Tumblr.ColorUtilities.hex_to_hsv(t.link_color),n=t.link_color;return Tumblr.ColorUtilities.compare_colors(o,i)&&(n=Tumblr.ColorUtilities.hsv_to_readable(i)),s||(this.$(".navigation .nav_icon").css("color",n),this.$(".navigation .blog_name").css("color",n),this.$(".navigation .post_dismiss").css("color",n),this.$(".navigation .dismiss_icon").css("color",n),this.$(".navigation button").css({color:t.background_color,"background-color":n})),this.$(".description a").css("color",t.link_color),this},_render_font_styles:function(){if(Tumblr.webfonts){var s=this.model.get("global_theme_params");if(e.has(Tumblr.webfonts,s.title_font)){var i=e.result(Tumblr.webfonts,s.title_font),o="webfont_"+i.path;if(i.path&&!t("head #"+o).length){var n=this.assets_host+"/fonts/"+i.path+"/stylesheet.css";n+=e.has(i,"_v")?"?v="+i._v:"",t("<link>",{id:o,rel:"stylesheet",type:"text/css",href:n}).appendTo(t("head"))}}}},__log_recommendation_dismissal:function(){t.ajax({method:"POST",url:"/svc/search/log_dismissal",data:{tumblelog_name:this.model.get("name")},withFormKey:!0})},__addSnowMan:function(){var t={el:this.$("[data-snowman-container]"),tumblelogName:this.model.get("name")};Tumblr.Flags.bool("is_logged_in")&&this.options.include_info_popover&&(t.infoPopover={el:this.$el,auto_show:!1,trigger:this.$el.find(".info_popover_button"),useRecipient:!0,showAsks:!0,showAnonymousAsks:!0,skip_glass:!0,targetPost:this.targetPost||this.$el,show_flag_button:!Tumblr.IndashBlog.is_peepr}),this.snowman=new Tumblr.Prima.Snowman(t)},initialize:function(s){if(this.options=e.extend({},this.defaults,s),this.hide_posts_on_unfollow=this.options.hide_posts_on_unfollow,this.current_data=this.options.current_data,this.on_render=this.options.on_render,this.targetPost=this.options.targetPost,this.is_rendered=!1,this.assets_host=Tumblr.Prima.Lib.hosts.get("assets")||"",this.template=e.template(t("#tumblelog_header_template").html()),this.$description=null,this.$description_inner=null,this.listenTo(this.model,"add:global_theme_params",this.render),this.listenTo(this.model,"change:global_theme_params",this.render),this.listenTo(this.model,"change:following",this._render_follow_button),!e.isEmpty(this.current_data)){var i=e.extend({},this.current_data,this.model.toJSON());this.model.set(i,{silent:!0})}},render:function(){var t=this.model.toJSON();if(t.following||(t.following=!1),this.is_rendered||!t.global_theme_params)return this;var s=e.result(Tumblr.webfonts,t.global_theme_params.title_font),i=Tumblr.ColorUtilities.hex_to_rgb(t.global_theme_params.title_color);return this.$el.html(this.template(e.merge({},t,{hide_headers_flag:Tumblr.Flags.bool("hide_default_headers_blog_cards"),show_navigation:!0,show_share_controls:!1,show_user_controls:!0,show_follow_button:!0,show_dismiss_controls:!1,title_font_family:s?s.family:!1,title_color_rgb:String(e.values(i).join(",")),is_verified:!1},this.options.template_data))),this.$description=this.$(".description"),this.$description_inner=this.$(".description .description_inner"),this._render_font_styles(),this._render_inline_styles(),this.__addSnowMan(),this.is_rendered=!0,this.on_render(),this.$description.length&&(e.delay(e.bind(this.truncate_description,this),100),this.options.strip_description_line_breaks&&this.strip_description_line_breaks()),this},strip_description_line_breaks:function(){this.$description_inner.find("br").remove();var t=this.$description_inner.html(),e=t.replace(/[\n\r]/g," ");this.$description_inner.html(e)},destroy:function(){this.$el.fadeOut(500,e.bind(function(){this.unbind(),this.$el.parent().hasClass("post_container")&&this.$el.parent().remove(),this.__log_recommendation_dismissal(),Events.trigger("DOMEventor:updateRect"),Events.trigger("posts:destroyed",this.$el),this.remove()},this))},truncate_description:function(){var t=this.$description_inner.get(0);if(!(t.scrollHeight<=t.clientHeight)){var s=this.model.get("global_theme_params"),i=s.background_color,o=Tumblr.ColorUtilities.hex_to_rgb(i);this.$description.append(this.description_gradient_template({background_color:String(e.values(o).join(","))}))}},description_gradient_template:e.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom, rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')});i.HeaderCompact=o}(jQuery,_,Backbone,Tumblr.IndashBlog),/*! scripts/search/utils/search_autopager.js */
function(t,e){"use strict";var s=Backbone.View.extend({options:{polling:!0,offset:300,buffer:0},initialize:function(t){_.extend(this.options,t),this.listenTo(Tumblr.Events,"DOMEventor:flatscroll",this.should_auto_paginate,this),this.listenTo(Tumblr.Events,"DOMEventor:flatresize",this.should_auto_paginate,this),this.listenTo(Tumblr.Events,"Autopager:stop",this.stop_polling,this),this.listenTo(Tumblr.Events,"Autopager:start",this.start_polling,this)},should_auto_paginate:function(){this.near_bottom()&&this.options.polling&&(Tumblr.Events.trigger("Autopager:trigger"),this.stop_polling())},get_buffer:function(){var t=Tumblr.Prima.DOMEventor.rect().windowHeight;return _.isNull(t)?!1:Math.round(.666*t)},set_buffer:function(t){this.options.buffer=t},near_bottom:function(){this.options.buffer||(this.options.buffer=this.get_buffer());var t=Tumblr.Prima.DOMEventor.rect(),e=this.options.offset||300;if(_.isNull(t.windowScrollTop))return!1;var s=t.windowScrollTop+t.windowHeight-this.options.buffer;return s>-e},stop_polling:function(){this.options.polling=!1},start_polling:function(){this.options.polling=!0}});e.Autopager=s}(jQuery,Tumblr),/*! scripts/search/models/search_model.js */
function(t,e){"use strict";function s(t,e){return function(s,i){null!=s._previousAttributes[t]&&s._previousAttributes[t]!==s.attributes[t]&&e.apply(this,arguments)}}var i=Tumblr.Search.SearchSessionLog,o=Backbone.Model.extend({url:function(){var t="/search/"+this.encoded_query();return this.get("post_page")>1&&(t+="/post_page/"+this.get("post_page")),"web"!==this.get("post_mode")&&"recent"!==this.get("post_mode")||(t+="/"+this.get("post_mode")),t+=window.location.search},defaults:{logged_in:!Tumblr.Flags.bool("logged_out_search"),filter_post_type:!1,post_page:2,blog_page:2,filter_nsfw:Tumblr.Flags.bool("filter_nsfw"),lightbox_post:!1,show_road_block:Tumblr.Flags.bool("logged_out_search")&&Tumblr.Flags.bool("search_logged_out_block"),paginations_loaded:0,set_pagination_limit:!1,isFollowing:!1},initialize:function(){this.initially_discovery_hub=this.is_discovery_mode(),this.history_api=!(!window.history||!window.history.pushState),i.set_search_model(this),this.listenTo(Tumblr.Events,"SearchModel:fetch_all",this.fetch_all,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_posts",this.fetch_posts,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_blogs",this.fetch_blogs,this),this.on("change:before change:blogs_before",this.on_change_before,this),this.on("change:query change:post_mode change:filter_nsfw change:filter_post_type change:filter_time_range change:post_view",this.on_change_query,this),this.on("change:post_mode",this.update_path,this),this.listenTo(Tumblr.Prima.Models.Tumblelog.collection,"change:following",s("following",this.on_follow),this),this.listenTo(Tumblr.Prima.Events,"SearchModel:setPostMode",this.setPostMode),this.get("show_road_block")&&this.listenTo(Tumblr.Prima.Events,"Autopaginate:set_pagination",this.setPagination),Tumblr.Events.trigger("SearchModel:initialized",this)},setPostMode:function(t){this.set("post_mode",t)},on_change_before:function(t){this.get("before")<0&&Tumblr.Events.trigger("SearchModel:fetch_posts:end"),_.has(t.changed,"before")&&(this.get("before")>0?this.set("post_page",this.get("post_page")+1):this.set("post_page",1)),this.get("blogs_before")<0&&Tumblr.Events.trigger("SearchModel:fetch_blogs:end"),_.has(t.changed,"blogs_before")&&(this.get("blogs_before")>0?this.set("blog_page",this.get("blog_page")+1):this.set("blog_page",1))},encode_query:function(t){return t.replace(/\s/g,"+").replace(/#/g,"%23").replace(/\?/g,"%3F").replace(/\//g,"%2F")},encoded_query:function(){return this.encode_query(this.get("query"))},decode_query:function(t){return t.replace(/\+/g," ").replace(/%23/g,"#").replace(/%3F/g,"?").replace(/%2F/g,"/")},update_path:function(){var t="/search/"+this.encode_query(this.get("query"));switch(this.get("post_mode")){case"web":case"recent":t+="/"+this.get("post_mode")}this.is_discovery_mode()&&(t+=window.location.search),this.history_api?Tumblr.Prima.Events.trigger("SearchRouter:navigateTo",t,{trigger:!0}):window.location.pathname!==t&&(window.location.href=t)},is_discovery_mode:function(){var t=Tumblr.Flags.bool("discovery_hub_poc"),e=-1!==this.get("query").indexOf("discoveryhub");return t&&e},on_change_query:function(t){this.set("previous_query",t.previous("query")),this.set("before",0),this.set("next_ad_offset",0),this.set("ad_placement_id",0),this.set("post_page",1),this.set("num_posts_shown",0);var e=this.is_discovery_mode()&&t.get("previous_query")!==t.get("query");(_.has(t.changed,"filter_nsfw")||_.has(t.changed,"query")||e)&&(this.set("blogs_before",0),this.set("blog_page",1),this.set("num_blogs_shown",0),this.trigger("query:change:blogs")),this.abort_updating(),this.trigger("query:change:posts"),this.trigger("results:refresh",t),Tumblr.Prima.Events.trigger("SearchModel:change:query",this,this.get("query"))},on_follow:function(t,e,s){if(s||(s={source:"SEARCH_UNKNOWN"}),_.isBoolean(e)){var o={initiator:s.source,context:s.context,name:t.get("name"),is_follow:e},n=["col","row"];o=_.extend(o,_.pick(s,n)),Tumblr.Events.trigger("Capture:push","search_page_usage","follow",o),i.trigger("follow",o)}},should_fetch:function(){return-1!==this.get("before")},fetch_all:function(t){this.should_fetch()&&(t=_.extend({more_blogs:!0,more_posts:!0},t),Tumblr.Flags("search_combined_requests")(_.bind(function(){this.fetch({data:t})},this),_.bind(function(){t.more_blogs&&this.fetch_blogs(),this.fetch_posts()},this)))},setPagination:function(t){this.set("max_paginations",t.max_autopaginates)},fetch_posts:function(){this.should_fetch()&&this.fetch({data:{more_posts:!0}})},fetch_blogs:function(){this.fetch({data:{more_blogs:!0}})},fetch:function(t){if(this.get("show_road_block")&&!t.data.more_blogs&&(this.get("set_pagination_limit")||(Tumblr.Events.trigger("Autopaginate:check_pagination",t),this.set("set_pagination_limit",!0)),this.get("paginations_loaded")>=this.get("max_paginations")&&1!==this.get("post_page")))return!1;Tumblr.Events.trigger("SearchModel:fetch:before",t),t.data.more_posts&&Tumblr.Events.trigger("SearchModel:fetch_posts:before",t),t.data.more_blogs&&Tumblr.Events.trigger("SearchModel:fetch_blogs:before",t),t=t||{};var e={method:"POST",emulateHTTP:!0,withFormKey:!0,beforeSend:_.bind(this.on_before,this),success:_.bind(this.on_success,this),error:_.bind(this.on_error,this),complete:_.bind(this.on_complete,this)},s={q:this.get("query"),sort:this.get("post_mode"),post_view:this.get("post_view"),blogs_before:this.get("blogs_before"),num_blogs_shown:this.get("num_blogs_shown"),num_posts_shown:this.get("num_posts_shown"),before:this.get("before"),blog_page:this.get("blog_page"),post_page:this.get("post_page"),filter_nsfw:this.get("filter_nsfw"),filter_post_type:this.get("filter_post_type"),filter_time_range:this.get("filter_time_range"),next_ad_offset:this.get("next_ad_offset"),ad_placement_id:this.get("ad_placement_id")};t=_.extend({},e,t),t.data=_.extend({},s,t.data),Backbone.Model.prototype.fetch.call(this,t)},log_lady_env:function(){return{q:this.get("query"),mode:this.get("post_mode"),flags:this.get("flags"),post_view:this.get("post_view"),has_blogs:this.get("has_blogs"),filter_nsfw:this.get("filter_nsfw"),filter_post_type:this.get("filter_post_type")}},generate_search_session_id:function(){return"ssid"+Tumblr.log_lady.new_uuid()},on_before:function(t){this.current_request=t},validate_res:function(t){var e=parseInt(t.getResponseHeader("X-next-offset"),10),s=parseInt(t.getResponseHeader("X-next-blogs-offset"),10),i=parseInt(t.getResponseHeader("X-post-page"),10),o=parseInt(t.getResponseHeader("X-blog-page"),10),n=parseInt(t.getResponseHeader("X-next-ad-offset"),10),r=parseInt(t.getResponseHeader("X-ad-placement-id"),10),l=t.getResponseHeader("X-has-blogs"),a={};return _.isNaN(e)||(a.before=e),_.isNaN(s)||(a.blogs_before=s),_.isNaN(i)||(a.post_page=i),_.isNaN(r)||(a.ad_placement_id=r),_.isNaN(n)||(a.next_ad_offset=n),_.isNaN(o)||(a.blog_page=o),a.has_blogs=l,a},on_success:function(t,e,s){s.data.more_posts&&1!==this.get("post_page")&&this.set("paginations_loaded",this.get("paginations_loaded")+1),this.current_request=null,Tumblr.Events.trigger("SearchModel:fetch_success",t,e,s),this.set(this.validate_res(s.xhr)),this.set({isFollowing:e.response&&e.response.tracked_tag}),Tumblr.Prima.Events.trigger("SearchModel:change:isFollowing",this),s.data.more_posts&&(Tumblr.Events.trigger("SearchModel:fetch_posts:success",t,e,s),Tumblr.Events.trigger("Capture:push","search_page_usage","pages"),this.get("post_page")>2&&i.trigger("page",{no:this.get("post_page")-1})),s.data.more_blogs&&(Tumblr.Events.trigger("SearchModel:fetch_blogs:success",t,e,s),Tumblr.Events.trigger("Capture:push","search_page_usage","carousel_blog_add"),i.trigger("carousel_blog_add",{no:this.get("blog_page")}))},on_error:function(t,e){var s=e.statusText;"abort"!==s&&this.set({before:-1,blogs_before:-1,ad_placement_id:0,next_ad_offset:0}),Tumblr.Events.trigger("SearchModel:fetch_error",t,e,s)},on_complete:function(t,e){Tumblr.Events.trigger("SearchModel:fetch_complete",t,e)},abort_updating:function(){this.current_request&&(4!==this.current_request.readyState&&this.current_request.abort(),this.current_request=null)}});e.SearchResultsModel=o}(jQuery,Tumblr),/*! scripts/search/collections/search_tumblelogs.js */
function(t,e){"use strict";var s=Backbone.Collection.extend({model:Tumblr.Prima.Models.Tumblelog,initialize:function(){this.on("change:followed",_.bind(this.update_follow_status,this)),this.listenTo(Tumblr.Events,"follow:success:tumblelog",_.bind(this.update_follow_status_by_name,this))},update_follow_status:function(t,e){var s=this.where_by({tumblelog:t.get("tumblelog")});s.invoke("set",{followed:t.get("followed")}),t.get("followed")?s.invoke("trigger","follow:success"):s.invoke("trigger","unfollow:success")},update_follow_status_by_name:function(t){var e=this.where_by({tumblelog:t});e.invoke("trigger","follow:success")},where_by:function(t){return new s(this.where(t))}});e.SearchTumblelogs=s}(jQuery,Tumblr),/*! scripts/prima_post_views_legacy_bridge.js */
function(t,e){"use strict";e.Events.on("tumblelogPopover:init",function(){e.Lightbox.init.apply(null,arguments)}),e.Events.on("sponsoredPosts:checkRings",function(){e.SponsoredPosts&&e.SponsoredPosts.check_for_rings()})}(window.jQuery,window.Tumblr),function(t,e){"use strict";var s=t(window),i=Tumblr.Search.SearchSessionLog,o=window.Masonry,n=Backbone.View.extend({id:"search_posts",events:{"click [data-wai-link]":"_handle_ad_click","click [data-remnant]":"_remnant_click"},attributes:function(){return{"class":"posts posts_view_"+this.model.get("post_view"),"data-view-posts":""}},required_controls:["filter_popover","post_layout","post_mode_control","filter_post_type_control","post_view_control","nsfw_lock_icon","filter_time_range_control"],collection:Tumblr.Posts,subviews:{},first_page:!0,_handle_ad_click:function(t){Tumblr.Events.trigger("Capture:push","search_page_usage","ad_click",{source:"yahoo_grid_ad"}),i.trigger("ad_click",{source:"yahoo_grid_ad"})},_remnant_click:function(e){var s=t(e.currentTarget).closest(".remnant_ad");Tumblr.Events.trigger("useraction:search_click:remnant",{loggingData:{pt:s.data("pt"),userAction:"click_thru",logIndex:s.data("log-index")}})},_updateLayout:function(){this.$masonryContainer&&(Tumblr.Flags.bool("search_carousel_align")&&this.$carousel_align_parent.css("width",""),this.masonry=new o(this.$masonryContainer.get(0),{itemSelector:".post_brick",columnWidth:this.columnWidth,isFitWidth:!0,transitionDuration:0,isResizeBound:!1,gutter:this.gutterWidth}),this.get_highest_bottom_post_position(),Tumblr.Flags.bool("search_carousel_align")&&this.$carousel_align_parent.css("width",this.$masonryContainer.width()),Tumblr.Events.trigger("search:layout:updated"))},_onAfterResize:function(){this._updateLayout()},setup_ghostlist:function(){this.handle_ad_block()||(this.search_posts_gl=new Tumblr.GhostList({nonlinear:"masonry"===this.model.get("post_view"),container:this.$el,pages:[1,1.5],eventor:Tumblr.Events,onBeforeDetach:function(e){var s=t(e).children(".post").first();return 0===s.length&&(s=t(e)),s.hasClass("is_audio")?"hide":s.hasClass("is_video")?!1:t(e).hasClass("remnant_ad")?"hide":!s.hasClass("is_persistent")}}))},setup_masonry:function(){this.columnWidth=300,this.gutterWidth=20,this.postWidth=this.columnWidth+this.gutterWidth,this.$masonryContainer=this.$el,Tumblr.Flags.bool("search_carousel_align")&&(this.$carousel_align_parent=this.$masonryContainer.closest(".search_results")),this.listenTo(Tumblr.Events,"DOMEventor:flatresize",_.debounce(_.bind(this._onAfterResize,this),300)),this._updateLayout()},initialize:function(e){if(this.options=_.extend({},e),this.form_key=t("#tumblr_form_key").attr("content"),this.body_class="search_results_mode_"+this.model.get("post_mode"),this.$body=t("body"),this.$body.addClass(this.body_class),this.is_reflow=this.options.is_reflow||!1,this.listenTo(Tumblr.Events,"posts:load",this.create_posts,this),this.listenTo(Tumblr.Events,"search:post:photo_expanded",this._updateLayout,this),this.listenTo(Tumblr.Events,"posts:destroyed",this._updateLayout),this.listenTo(Tumblr.Events,"posts:change:text_size",this._updateLayout),this.setup_ghostlist(),this.disable_keycommands(),Tumblr.Flags("dashboard_refresh")||(this.subviews.elevator=new Tumblr.Elevator),Tumblr.Flags.bool("search_results_scroll_logging")){var s=_(this._log_scroll_y).bind(this).throttle(1e3,{leading:!1}).value();this.listenTo(Tumblr.Events,"DOMEventor:flatscroll",s)}this.create_posts(),"list"===this.model.get("post_view")?this.enable_keycommands():this.setup_masonry()},_log_scroll_y:function(t){i.trigger("search_scroll",{document_height:t.documentHeight,window_scroll_top:t.windowScrollTop,columns:this.get_columns(),num_posts:this.collection.length})},enable_keycommands:function(){_.isObject(Tumblr.KeyCommands)&&Tumblr.KeyCommands.resume()},disable_keycommands:function(){_.isObject(Tumblr.KeyCommands)&&Tumblr.KeyCommands.suspend()},render:function(){return this},_remove_subviews:function(){_.each(this.subviews,function(t){t.remove()}),this.collection.reset()},remove:function(){this.removed=!0,this.$body.removeClass(this.body_class),this._remove_subviews(),this.search_posts_gl&&this.search_posts_gl.remove(),Backbone.View.prototype.remove.call(this)},create_post:function(e,s){var i=t(e),o=i.find("[data-tumblelog-popover]").data("tumblelog-popover"),n=i.data();"object"!=typeof o&&(o={},Tumblr.Flags.bool("is_dev")&&console.warn("Unable to find popover data for "+n.tumblelogName));var r,l=new Tumblr.Prima.Models.Post(i.data("json"));if(r="masonry"===this.model.get("post_view")?Tumblr.Prima.SearchExplorePostViewBuilder(l,{el:i}):new Tumblr.SearchPostListView({el:i,model:l}),Tumblr.Prima&&Tumblr.Prima.Events&&"video"===l.get("type")){var a=i.find("video[data-crt-video]");if(a.length){var h=!0;"masonry"===this.model.get("post_view")&&(h=!1),Tumblr.Prima.Events.trigger("CrtControl:newPlayer",a,{attributes:{autoplay:h}})}}return r.search_post_view="post_"+this.model.get("post_view"),this.collection.add(l),this.subviews[l.get("id")]=r,i.attr("data-view-exists",!0),i.removeClass("post_fade"),this.model.set("num_posts_shown",this.model.get("num_posts_shown")+1),r},append_post_html:function(e){if(e){if("list"!==this.model.get("post_view")){var s=t(e).filter(".post_brick");Tumblr.Flags.bool("search_no_imageload_waiting")?(this.$masonryContainer.append(s),this.create_posts(),this.masonry.appended(s),this.get_highest_bottom_post_position()):this.$masonryContainer.imagesLoaded(_.bind(function(){this.removed||(this.$masonryContainer.append(s),this.create_posts(),this.masonry.appended(s),this.get_highest_bottom_post_position())},this)),this.is_reflow&&(this._updateLayout(),this.is_reflow=!1)}else this.$el.append(e),this.create_posts(),this.get_highest_bottom_post_position();Tumblr.AutoPaginator.flushQueue()}},create_posts:function(){var t=_.map(this.$(".post:not(.new_post_buttons):not([data-view-exists])"),this.create_post,this);_.each(this.$(".display-ad--yahoo:not([data-view-exists])"),this.fade_in_ad,this),Tumblr.Events.trigger("search:posts:fade-in"),this.$(".display-ad--yahoo").length&&Tumblr.SponsoredPosts&&Tumblr.SponsoredPosts.check_for_rings(),Tumblr.Events.trigger("SearchView:addPostsBatch",t),_(t).filter("attachedToDOM").invoke("attachedToDOM").value()},fade_in_ad:function(e,s){var i=t(e);i.removeClass("post_fade"),this.handle_ad_block()},scroll_to_post:function(e){var i=this.$el.find(".post[data-post-id="+e.post_id+"]");if(i.length){var o=i.offset().top-.5*s.height()+.5*i.outerHeight();t("html, body").stop(!0,!0).animate({scrollTop:o})}},focus_post:function(e){var s=this.$el.find(".post[data-post-id="+e+"]");if(s.length){var i=t("<div>",{id:"post_focus_glass"});Tumblr.Flags.bool("indash_blogs")&&i.addClass("blue"),this.$el.append(i),s.addClass("focus"),i.delay(200).fadeOut(500,function(){i.remove(),s.removeClass("focus")})}},get_columns:function(){var t=this.$el.width(),e=300;return this.columns=Math.floor(t/e),this.columns},get_highest_bottom_post_position:function(){this.get_columns();for(var t=this.columns,e=Number.MAX_VALUE,s={},i=this.$el.children(),o=i.length-1;t&&o>=0;){var n=i.eq(o),r=n.offset();if(!s[r.left]){--t,s[r.left]=!0;var l=r.top+n.height();e=Math.min(e,l)}--o}Tumblr.Events.trigger("search:results:last_row_updated",e)},handle_ad_block:function(){if("masonry"===!this.model.get("post_view"))return!1;var t=this.$(".remnant_ad");return t.length&&t.is(":hidden")?(this.search_posts_gl&&this.search_posts_gl.destroy(),!0):!1}});e.SearchPostsView=n}(jQuery,Tumblr),/*! scripts/search/views/posts/base_post.js */
function(t,e){"use strict";var s=!Tumblr.Flags.bool("is_logged_in"),i=Tumblr.PostView.extend({events:{"click .post_control.like:not(.liked)":"search_like","click .post_control.liked":"search_unlike","click .post_control.reblog":"search_reblog","click .post_control.reply":"reply","click .post_control.share":"search_share","click .post_control.block":"ignore","click .reblog_follow_button":"follow","click .post_tag":"click_tag","click .icon.icon_flag":"flag","click .post_media":"media_click","click .post_body a":"caption_click","click .post_permalink":"permalink_click","click .note_count":"notes_click","click .note .follow":"note_follow"},initialize:function(){Tumblr.PostView.prototype.initialize.apply(this,arguments),this.follow_toggle=this.$el.find(".reblog_follow_button"),this.tumblelog=this.model.tumblelog||(this.model.tumblelog=new Tumblr.Prima.Models.Tumblelog(this.model.get("tumblelog-data"))),this.listenTo(this.tumblelog,"change:following",this.follow_success),this.listenTo(Tumblr.Events,"flagged:"+this.tumblelog.get("name"),this.on_flagged),_.result(this,"after_initialize"),scrollMonitor&&Tumblr.Flags.bool("search_post_impression_logging")&&(this.scrollMonitor=scrollMonitor.create(this.$el,-(this.$el.height()/2)),this.scrollMonitor.enterViewport(_.bind(this.onViewportEnter,this)))},onViewportEnter:function(t){var e={loggingData:{id:this.model.get("id"),tumblelog:this.model.get("tumblelog")}};Tumblr.Events.trigger("search:post:impression",e),this.scrollMonitor.destroy()},on_flagged:function(t){this.$el.addClass("is_flagged")},search_like:function(e){if(s){var i=document.location.pathname+"/post/"+this.model.get("tumblelog")+"/"+this.model.get("id"),o=t(e.currentTarget),n=o.attr("href");return o.attr("href",i),void o.attr("href",n)}return this.capture_event("like"),this.like(e)},search_unlike:function(t){return s?void 0:(this.capture_event("unlike"),this.unlike(t))},search_reblog:function(t){return s?void 0:(this.capture_event("reblog"),this.reblog(t))},search_share:function(e){var s=t(e.currentTarget);return new Tumblr.Prima.Messaging.SharePost({postId:s.attr("data-post-id"),blogUuid:s.attr("data-tumblelog-uuid"),favoritesNames:_.compact([s.attr("data-tumblelog-name"),s.attr("data-parent-tumblelog-name")]),externalNetworksData:this.model.get("share_popover_data"),pinnedTarget:s,popoverContainer:this.$el}).render()},follow:function(t){t.preventDefault();var e="FOLLOW_SOURCE_UNKNOWN";"post_list"===this.search_post_view?e="FOLLOW_SOURCE_SEARCH_RESULTS_POSTS_LIST":"post_masonry"===this.search_post_view&&(e="FOLLOW_SOURCE_SEARCH_RESULTS_POSTS_GRID"),this.tumblelog.save_following({following:!0},{source:e,pt:this.model.get("pt")})},follow_success:function(t){t.changed&&(t.changed.following?(this.follow_toggle.addClass("animating is-following"),window.setTimeout(_.bind(function(){this.follow_toggle.removeClass("animating")},this),300)):this.follow_toggle.removeClass("animating is-following"))},click_tag:function(e){e.preventDefault();var s=t(e.target).text();"#"===s[0]&&(s=s.substring(1,s.length)),Tumblr.Events.trigger("search:change:query",s),Tumblr.Events.trigger("search:submit"),this.capture_event("tag_click")},_generic_event_data:function(){var t={};return _.extend(t,_.result(this,"position")),t.post_id=this.model.get("id"),t.blog=this.tumblelog.get("name"),t.initiator=this.search_post_view,t},capture_event:function(t,e){e||(e={}),e=_.extend(this._generic_event_data(),e),this.ads_team_logging(t,e),Tumblr.Events.trigger("Capture:push","search_page_usage",t,e),Tumblr.Search.SearchSessionLog.trigger(t,e)},ads_team_logging:function(t,e){this.ads_should_track_event(t)&&Tumblr.Events.trigger("useraction:search_click:"+t,this.ads_prep_loggingData(t,e))},ads_should_track_event:function(t){return!!this.model.get("pt")},ads_prep_loggingData:function(t,e){return{oldData:e,loggingData:{postData:this.model.toJSON(),userAction:t}}},flag:function(t){Tumblr.Events.trigger("abuseform:open",{mode:"post",post:this.model})},permalink_click:function(){this.ads_team_logging("permalink",this._generic_event_data())},caption_click:function(t){this.ads_team_logging("caption",this._generic_event_data())},media_click:function(t){var e=this.model.get("type");"photo"!==e&&"photoset"!==e||this.ads_team_logging("media",this._generic_event_data())},notes_click:function(){this.ads_team_logging("notes",this._generic_event_data()),Tumblr.Prima.postActivityLoader(_.bind(function(t){return new t({pinnedTarget:this.$(".note_link_current"),postModel:this.model}).render()},this))},note_follow:function(e){e.preventDefault();var i="FOLLOW_SOURCE_SEARCH_NOTES_POPOVER",o=t(e.currentTarget),n=o.closest(".note"),r=n.data("tumblelog");if(r){if(s)return void window.open("/follow/"+r);var l=new Tumblr.Prima.Models.Tumblelog({name:r});n.addClass("is_following"),l.save_following({following:!0},{source:i}).fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)}),this.capture_event("follow",{initiator:i,blog:r})}}});e.SearchBasePostView=i}(jQuery,Tumblr),/*! scripts/search/views/posts/list_post.js */
function(t,e){"use strict";var s=Tumblr.SearchBasePostView.extend({events:_.extend({},Tumblr.SearchBasePostView.prototype.events,{"click .photo_exif_flipper":"showExif"}),row_num:function(){var t=this.$el.closest(".post_container").index();return this.row_num=t,t},position:function(){var t=_.result(this,"row_num");return{col:0,row:t,col_count:1,type:"list"}},showExif:function(e){e.preventDefault(),e.stopImmediatePropagation();var s=t(e.currentTarget).parents(".flipcard");s.addClass("initialized"),_.defer(function(){s.toggleClass("reveal_back")})}});e.SearchPostListView=s}(jQuery,Tumblr),/*! scripts/search/views/posts/masonry_post.js */
function(t,e){"use strict";var s=Tumblr.SearchBasePostView.extend({events:_.extend({},Tumblr.SearchBasePostView.prototype.events,{"mouseenter .photoset_photos":"cycle_photoset","mouseleave .photoset_photos":"stop_cycle_photoset","click .expand":"__expand_clicked","click .photoset_photos":"__photoset_clicked","click .photoset_count":"__photoset_clicked","click .post_media[data-lightbox]":"__photo_clicked","click .video_poster":"toggle_video_player","click .post_header .tumblelog_info":"__header_url_clicked","click .reblog_follow_button":"follow"}),initialize:function(t){this.options=_.defaults(t,this.defaults),this.base_log_data={is_blog:!1,initiator:"post_masonry",post_id:this.model.get("id")},this.listenTo(Tumblr.Events,"search:layout:updated",this._on_layout_update),Tumblr.SearchBasePostView.prototype.initialize.call(this,this.options)},follow:function(t){Tumblr.Flags.bool("is_logged_in")&&Tumblr.SearchBasePostView.prototype.follow.apply(this,arguments)},cycle_photoset:function(t){_.isNumber(t)||(t=1300),this._photoset_cycle_rate||this.show_next_photoset_photo(),this._photoset_cycle_rate=t,this.$photoset().css("background-color","#000"),this._photoset_cycle_timeout=setTimeout(_.bind(function(){this.show_next_photoset_photo(),this.cycle_photoset()},this),this._photoset_cycle_rate)},show_next_photoset_photo:function(){var t=this.$shown().next();t.length||(t=this.$photoset().find(".photoset_photo:first")),this.$shown().removeClass("shown"),t.addClass("shown"),this._$shown=t},stop_cycle_photoset:function(){clearTimeout(this._photoset_cycle_timeout),this._photoset_cycle_rate=!1,this.$photoset().css("background-color","")},$photoset:function(){return"_$photoset"in this||(this._$photoset=this.$(".photoset_photos")),this._$photoset},$shown:function(){return this._$shown&&this._$shown.length||(this._$shown=this.$photoset().find(".photoset_photo.shown")),this._$shown&&this._$shown.length||(this._$shown=this.$photoset().find(".photoset_photo:last").addClass("shown")),this._$shown},__photoset_clicked:function(e){var s=this.$shown().data("lightbox"),i=_.collect(this.$photoset().find("[data-lightbox]"),function(e){return t(e).data("lightbox")}),o=_.indexOf(i,s);Tumblr.Lightbox.init(i,o+1),this.stop_cycle_photoset(),this.capture_event("photo_lightbox",this.base_log_data)},__photo_clicked:function(e){var s=t(e.currentTarget).data("lightbox");s&&(Tumblr.Lightbox.init([s]),this.capture_event("photo_lightbox",this.base_log_data))},__expand_clicked:function(t){this.expand_photo()},toggle_video_player:function(e){var s=this.$(".video_embed"),i=s.data("render-context"),o=this.$("script.embed_source");return"blank"===i?void window.open(s.data("post-url")):void(o.length&&(t(e.currentTarget).hide(),o.parent().html(o.html())))},expand_photo:function(){var t=this.$el.find(".post_media.truncated"),e=t.find("img.photo"),s=50,i=_.bind(function(){Tumblr.Events.trigger("search:post:photo_expanded",this.$el)},this);this.$el.find(".expand").remove(),t.removeClass("truncated"),t.velocity({"max-height":e.attr("height")},s,i),this.scrollMonitor&&this.scrollMonitor.recalculateSize()},__header_url_clicked:function(t){t.preventDefault(),t.stopPropagation(),this.lightbox_pop(t,"post_masonry")}});e.SearchPostMasonryView=s}(jQuery,Tumblr),/*! scripts/search/views/blogs/tumblelogs.js */
function(t,e){"use strict";e.Search||(e.Search={});var s=Backbone.View.extend({use_indash_tumblelogs:e.Flags.bool("search_indash_blog_cards"),className:"blogs_wrapper_carousel_inner",attributes:{"data-view-tumblelogs":""},subviews:[],initialize:function(){this.use_indash_tumblelogs?this.listenTo(e.Events,"SearchModel:fetch_blogs:success",this.parse_indash_blog_data):this.listenTo(e.Events,"SearchModel:fetch_blogs:success",this.parse_blog_data),this.listenTo(e.Events,"search:bloglightbox:close",this.focus_tumblelog,this)},render:function(){return this.use_indash_tumblelogs?this.create_indash_tumblelogs():this.create_tumblelogs(),this},parse_blog_data:function(t,s,i){var o=s.response;o.blogs_html&&o.blogs_html.length&&(this.$el.append(o.blogs_html),this.create_tumblelogs(),e.Events.trigger("SearchTumblelogs:append:after"))},parse_indash_blog_data:function(t,s,i){var o=s.response;o.blogs_html&&o.blogs_html.length&&(this.$el.append(o.blogs_html),this.create_indash_tumblelogs(),e.Events.trigger("SearchTumblelogs:append:after"))},create_tumblelogs:function(){var t=_.map(this.$el.find(".tumblelog_compact:not([data-view-exists])"),this.create_tumblelog,this);e.Events.trigger("SearchTumblelogs:add:batch",t)},create_indash_tumblelogs:function(){var s=t(".tumblelogs_json"),i=s.data("search-tumblelogs-json");s.remove();var o=_.map(i,this.create_indash_tumblelog,this);e.Events.trigger("SearchTumblelogs:add:batch",o)},create_indash_tumblelog:function(s,i){var o=new e.Prima.Models.Tumblelog(s),n=new e.Search.indashTumblelogCompactView({model:o,include_posts:!0,follow_data:{col:this.subviews.length,row:0,pt:o.get("pt")||""},unfollow_data:{col:this.subviews.length,row:0},blog_position:i}),r=n.render().el;return t(".search_blogs_row").last().append(r),n.$el.attr("data-view-exists",!0),n.$el.attr("data-tumblelog-url",o.get("url")),this.subviews.push(n),this.collection.add(o),e.Events.trigger("SearchTumblelogs:add",n),n},create_tumblelog:function(s,i){var o=t(s),n=new e.Prima.Models.Tumblelog({name:o.data("tumblelog-name").toString(),following:o.find(".tumblelog_follow_toggle").hasClass("followed")});return this.subviews[i]=new e.Search.tumblelogCompactView({model:n,el:s}),o.attr("data-view-exists",!0),this.collection.add(n),e.Events.trigger("SearchTumblelogs:add",this.subviews[i]),this.subviews[i]},clear_tumblelogs:function(){_.each(this.subviews,function(t){t.remove()})},focus_tumblelog:function(e){var s=this.$el.find(".tumblelog_compact[data-tumblelog-name="+e+"]");if(s.length){s.addClass("focus");var i=t("<div>",{id:"post_focus_glass"}).appendTo(this.$el);i.delay(200).fadeOut(500,function(){i.remove(),s.removeClass("focus")})}}});e.Search.tumblelogsView=s}(jQuery,Tumblr),/*! scripts/search/views/blogs/tumblelog_compact.js */
function(t,e){e.Search||(e.Search={});var s=(e.Search.SearchSessionLog,Backbone.View.extend({events:{"click .tumblelog_follow_toggle":"__click_follow_toggle"},__click_follow_toggle:function(t){if(e.Flags.bool("is_logged_in")){t.preventDefault();var s=!0,i="FOLLOW_SOURCE_SEARCH_RESULTS_BLOG_CAROUSEL";(this.model.get("following")||this.follow_toggle.hasClass("followed"))&&(s=!1,i="UNFOLLOW_SOURCE_SEARCH_RESULTS_BLOG_CAROUSEL");var o=this.$el.closest("[data-view-tumblelogs]").find(".tumblelog_compact");this.model.save_following({following:s},{source:i,col:o.index(this.el),row:0})}},_toggle_follow:function(){this.model.get("following")?this.follow_toggle.addClass("followed"):this.follow_toggle.removeClass("followed")},initialize:function(){this.follow_toggle=this.$(".tumblelog_follow_toggle"),this.listenTo(this.model,"change:following",this._toggle_follow,this)}}));e.Search.tumblelogCompactView=s}(jQuery,Tumblr),/*! scripts/search/views/blogs/indash_tumblelog_compact.js */
function(t,e){"use strict";e.Search||(e.Search={});var s=e.IndashBlog.HeaderCompact.extend({className:"indash_blog indash_tumblelog_compact",events:function(){return _.extend({},e.IndashBlog.HeaderCompact.prototype.events,{"click .indash_header_wrapper .customize_button":"__on_customize_click","click .indash_header_wrapper":"_on_blog_click"})},subviews:[],defaults:{follow_data:{source:"FOLLOW_SOURCE_SEARCH_RESULTS_BLOG_CAROUSEL"},unfollow_data:{source:"UNFOLLOW_SOURCE_SEARCH_RESULTS_BLOG_CAROUSEL"},hide_posts_on_unfollow:!1,include_posts:!1,template_data:{search_blog_card:!0,show_navigation:!0,show_user_controls:e.Flags.bool("is_logged_in"),show_share_controls:!1,show_follow_button:!0},strip_description_line_breaks:!0,fade_in:!0,include_info_popover:!0},initialize:function(t){this.options=_.defaults({},t,this.defaults),this.options.follow_data.source=this.defaults.follow_data.source,this.options.unfollow_data.source=this.defaults.unfollow_data.source,this.options.on_render=_.bind(this._setup_posts,this),this.options.fade_in&&this.$el.addClass("hidden fade_in"),e.IndashBlog.HeaderCompact.prototype.initialize.call(this,this.options)},render:function(){return setTimeout(_.bind(function(){this.$el.removeClass("hidden")},this),100),e.IndashBlog.HeaderCompact.prototype.render.call(this),this},_on_blog_click:function(s){if(!t(s.target).closest(".indash_header_wrapper .navigation").length){s.preventDefault();var i="blog_carousel",o=t(s.target).parents(".post").data("post-id"),n=this.model.get("name");this.options.blog_position,t(s.target).closest("[data-context-path]").data("context-path");o&&(i+="_post");e.Flags.bool("is_logged_in")?o||e.Events.trigger("peepr-open-request",{tumblelog_name:n}):window.open(this.model.get("url")),e.Events.trigger("search:blog:click:posts_click",this.ads_generate_payload("posts"))}},ads_generate_payload:function(t){return{loggingData:{postData:{"serve-id":this.model.get("pt"),pt:this.model.get("pt")},userAction:t}}},show_posts:function(){this.$(".recent_posts")&&this.$el.addClass("show_posts")},hide_posts:function(){this.$el.removeClass("show_posts")},_setup_posts:function(){this.subviews.highlighted_posts=new e.TumblelogPopover.Posts({model:this.model,on_bottom:!0,parent:this.$el.find(".indash_header_wrapper")})},__on_customize_click:function(e){var s=t(e.currentTarget),i=s.data("url");i&&(e.preventDefault(),e.stopPropagation(),window.open(i))}});e.Search.indashTumblelogCompactView=s}(jQuery,Tumblr),/*! scripts/search/views/blogs/tumblelog_compact_placeholder.js */
function(t,e){e.Search||(e.Search={});var s=Backbone.View.extend({use_indash_tumblelogs:e.Flags.bool("search_indash_blog_cards"),className:"tumblelog_placeholders",initialize:function(){var e=this.use_indash_tumblelogs?"tmpl_indash_tumblelog_placeholder":"tmpl_tumblelog_placeholder";this.template=_.template(t("#"+e).html())},render:function(){return this.$el.html(this.template()),this},show:function(t){t.left&&(this.el.style.left=t.left+"px",this.set_opacity(1),this.el.classList.add("animated"))},hide:function(){_.delay(_.bind(this.set_opacity,this),1e3,0),this.el.classList.remove("animated")},set_opacity:function(t){this.el.style.opacity=t}});e.Search.tumblelogCompactPlaceholder=s}(jQuery,Tumblr),/*! scripts/search/views/blogs/tumblelogs_carousel.js */
function(t,e){"use strict";e.Search||(e.Search={});var s=Backbone.View.extend({use_indash_tumblelogs:e.Flags.bool("search_indash_blog_cards"),options:{blogs_per_page:10,blog_width:295,blog_margin:15,selectors:{scroller:".blogs_wrapper_carousel",slide_wrapper:".blogs_wrapper_carousel_inner",slides:".tumblelog_compact",pages:".search_blogs_row",left_mask:"[data-bss-mask-left]",right_mask:"[data-bss-mask-right]",controls:"[data-bss-control]"}},indash_blog_options:{blog_width:320,blog_margin:20,selectors:{scroller:".blogs_wrapper_carousel",slide_wrapper:".blogs_wrapper_carousel_inner",slides:".indash_tumblelog_compact",pages:".search_blogs_row",left_mask:"[data-bss-mask-left]",right_mask:"[data-bss-mask-right]",controls:"[data-bss-control]"}},defaults:{subviews:{},page_count:0,current_page:0,scroll_left:0,slide_count:0,new_page_left:0,fetching:!1,complete:!1,_cache:{left_blog_index:!1,right_blog_index:!1,scroll_left:0},snapping:!1,snap_speed:200,scroll_speed:500,controls_clicked:!1},_last_impressed_blog_index:0,_max_impressed_blog_index:0,initialize:function(t){this.use_indash_tumblelogs&&_.extend(this.options,this.indash_blog_options),_.defaults(this,this.options,t),_.defaults(this,this.defaults)},render:function(){return this.listenTo(e.Events,"DOMEventor:flatresize",_.debounce(this._on_resize,200),this),this.listenTo(e.Events,"SearchModel:fetch_blogs:before",this.pre_fetch,this),this.listenTo(e.Events,"SearchTumblelogs:append:after",this.post_fetch,this),this.listenTo(e.Events,"SearchModel:fetch_blogs:end",this.no_more_blogs,this),this.template&&this.$el.append(this.template),this.$el.on("click",this.selectors.controls,_.bind(this._on_click_controls,this)),this.tumblelogs_collection=new e.SearchTumblelogs,this._create_subviews(),this._refresh(),this.start_iscroll(),this},_create_subviews:function(){var t=this.$("[data-view-tumblelogs]");this.subviews.tumblelogs=new e.Search.tumblelogsView({collection:this.tumblelogs_collection}),t[0]?this.subviews.tumblelogs.setElement(t).render():this.$(this.selectors.scroller).prepend(this.subviews.tumblelogs.render().el),this.subviews.placeholder=new e.Search.tumblelogCompactPlaceholder,this.$(this.selectors.slide_wrapper).append(this.subviews.placeholder.render().el)},_remove_subviews:function(){this.subviews.placeholder.remove(),this.subviews.tumblelogs.remove(),this.tumblelogs_collection.reset(),this.iScroll&&this.iScroll.destroy()},_cache_selectors:function(){this.$slides=this.$(this.selectors.slides),this.$scroller=this.$(this.selectors.scroller),this.$slide_wrapper=this.$(this.selectors.slide_wrapper),this.$pages=this.$(this.selectors.pages),this.$left_mask=this.$(this.selectors.left_mask),this.$right_mask=this.$(this.selectors.right_mask),this.$left_mask_fader=this.$left_mask.find("[data-bss-mask-fader]"),this.$right_mask_fader=this.$right_mask.find("[data-bss-mask-fader]"),this.slide_count=this.$slides.length,this.page_count=this.$pages.length,this.scroller_width=this.$slide_wrapper.width()},_refresh:function(t){this._cache_selectors(),t=t?t:this.$slides,this._set_rect(),this.get_outer_blogs(),this.cache_current_blogs(),this.position_slides(t),this.detach_blogs(),this.blog_fader(),this.toggle_control_visibility()},start_iscroll:function(){var t=1===this.page_count&&this.$pages.eq(0).width()<this.rect.containerWidth,e=!("addEventListener"in document);return t?void this.el.classList.add("no_scroll"):e?void this.el.classList.add("natural_scroll"):(this.scroller_width=this.blog_width*(this.slide_count+2)-this.blog_margin,this.$slide_wrapper[0].style.width=this.scroller_width+"px",this.iScroll=new IScroll(this.$scroller[0],{startX:0,startY:0,scrollX:!0,scrollY:!1,directionLockThreshold:5,freeScroll:!1,mouseWheel:!0,momentum:!0,eventPassthrough:!0,probeType:3,scrollbars:"custom",interactiveScrollbars:!0,reverseHorizontalScroll:!1}),this.iScroll.on("scroll",_.bind(this._on_scroll,this)),void this.iScroll.on("scrollEnd",_.bind(this._on_scroll_end,this)))},_get_iscroll_x:function(){return this.iScroll?-1*this.iScroll.x:0},_set_rect:function(){_.isNull(e.Prima.DOMEventor.rect().documentHeight)&&e.Events.trigger("DOMEventor:updateRect"),this.rect=_.clone(e.Prima.DOMEventor.rect()),this.rect.containerWidth=this.$el.width(),this.rect.buffer=Math.round(.666*this.rect.containerWidth)},_on_resize:function(t){this._refresh()},_on_click_controls:function(e){e.preventDefault(),e.stopPropagation(),this.controls_clicked=!0;var s,i,o=t(e.currentTarget).data();switch(o.bssControl){case"left":i=this.left_blog_index-3,0>i?(i=0,s=this.$slides.eq(0)[0]):s=this.$slides.eq(i)[0];break;case"right":i=this.left_blog_index+3,s=this.$slides.eq(i)[0],s||(i=this.slide_count-1,s=this.$slides.eq(i)[0])}s&&this.iScroll.scrollToElement(s,this.scroll_speed,-this.blog_width,0,IScroll.ease.quadratic)},toggle_control_visibility:function(){0===this.left_blog_index?(this.$el.addClass("carousel_pinned_left"),this.pinned_left=!0):this.pinned_left&&(this.$el.removeClass("carousel_pinned_left"),this.pinned_left=!1),this.right_blog_index+1>=this.slide_count&&this.complete?(this.$el.addClass("carousel_pinned_right"),this.pinned_right=!0):this.pinned_right&&(this.$el.removeClass("carousel_pinned_right"),this.pinned_right=!1)},_on_scroll:function(){this.is_scrolling||this.el.classList.add("is_scrolling"),this.is_scrolling=!0,this.scroll_left=this._get_iscroll_x(),this.scroll_remaining=this.scroller_width-(this.scroll_left+this.rect.containerWidth),this.direction=this._cache.scroll_left>this.scroll_left?"left":"right",this.blog_scroller(),!this.fetching&&!this.complete&&this.scroll_remaining<this.rect.buffer&&(this.fetching=!0,e.Events.trigger("SearchModel:fetch_blogs"))},_on_scroll_end:function(){this.el.classList.remove("is_scrolling"),this.blog_fader(),!e.Flags.bool("search_carousel_snap")||this.snapping||this.controls_clicked?this.snapping=!1:this.snap(),this.is_scrolling=!1,this.controls_clicked=!1},snap:function(){var t,e=this.get_blog_pos(this.left_blog_index),s=Math.abs(e/this.blog_width-1),i=this.$left_blog[0];s>.5&&this.$slides.length>this.left_blog_index+1?(i=this.$slides[this.left_blog_index+1],t=1-2*(s-.5)):t=2*s,this.iScroll.scrollToElement(i,this.snap_speed*t,-this.blog_width,0,IScroll.ease.quadratic),this.snapping=!0},position_slides:function(e){_.each(e,_.bind(function(e,s){var i=s*this.blog_width,o=t(e);o.data("in_position")||(o.data("in_position",!0),o.css({position:"absolute",left:i}))},this))},get_blog_pos:function(t){var e=this._get_iscroll_x(),s=-(e-this.blog_width*(t+1));return s},get_outer_blogs:function(){this.left_blog_index=Math.floor(this.scroll_left/this.blog_width),this.right_blog_index=Math.floor((this.scroll_left+this.rect.containerWidth)/this.blog_width)},cache_current_blogs:function(){this.$left_blog=this.$slides.eq(this.left_blog_index),this.$right_blog=this.$slides.eq(this.right_blog_index),this.$inner_blogs=this.$slides.slice(this.left_blog_index+1,this.right_blog_index);var t=5;this.$attached_blogs=this.$slides.filter(_.bind(function(e){return e>this.left_blog_index-t&&e<this.right_blog_index+t},this)),this.$detached_blogs=this.$slides.not(this.$attached_blogs),e.Flags.bool("search_results_carousel_logging")&&this.right_blog_index>this._max_impressed_blog_index&&(this._max_impressed_blog_index=this.right_blog_index,_.defer(_.bind(this._log_impressed_blogs,this)))},detach_blogs:function(){_.each(this.$detached_blogs,function(t){t.style.display="none"}),_.each(this.$attached_blogs,_.bind(function(t,e){t.style.display="block"},this))},blog_scroller:function(){this.get_outer_blogs(),this._cache.left_blog_index===this.left_blog_index&&this._cache.right_blog_index===this.right_blog_index||(this.cache_current_blogs(),this.detach_blogs(),this.toggle_control_visibility()),this.blog_fader(),this._cache.right_blog_index=this.right_blog_index,this._cache.left_blog_index=this.left_blog_index,this._cache.scroll_left=this.scroll_left},blog_fader:function(){var t=this.rect.containerWidth,e=this.get_blog_pos(this.left_blog_index),s=Math.abs(e/this.blog_width-1),i=this.get_blog_pos(this.right_blog_index),o=i-this.rect.containerWidth,n=(i-t)/this.blog_width;this.$left_mask.css("transform","translateX("+e+"px)"),this.$left_mask_fader[0].style.opacity=s,this.$right_mask.css("transform","translateX("+o+"px)"),this.$right_mask_fader[0].style.opacity=n},pre_fetch:function(){if(this.page_count){var t=this.$pages.last();this.new_page_left=t.position().left+t.width(),this.show_placeholder()}else this.new_page_left=this.use_indash_tumblelogs?300:280},post_fetch:function(){this.hide_placeholder(),this._cache_selectors(),_.defer(_.bind(this.handle_new_page,this))},handle_new_page:function(){var t=this.$scroller.find(".is_new");this.scroller_width=this.blog_width*(this.slide_count+2)-this.blog_margin,this.complete&&(this.scroller_width=this.scroller_width-this.blog_width),this.$slide_wrapper[0].style.width=this.scroller_width+"px",t[0].style.width=this.new_page_width+"px",t[0].style.left=this.new_page_left+"px",t[0].classList.add("fade_in"),t[0].classList.remove("is_new"),this.refresh_iscroll(),_.defer(_.bind(this._refresh,this),t.find(this.selectors.slides)),this.fetching=!1},show_placeholder:function(){this.subviews.placeholder.show({left:this.new_page_left})},hide_placeholder:function(){this.subviews.placeholder.hide()},refresh_iscroll:function(){this.iScroll?this.iScroll.refresh():this.start_iscroll()},no_more_blogs:function(){this.complete=!0},_log_impressed_blogs:function(){var t=this.tumblelogs_collection.slice(this._last_impressed_blog_index,this._max_impressed_blog_index);_.each(t,function(t){var s=t.get("name"),i=this.tumblelogs_collection.indexOf(t);e.Search.SearchSessionLog.trigger("carousel_blog_impression",{name:s,position:i})},this),this._last_impressed_blog_index=this._max_impressed_blog_index}});e.Search.tumblelogsCarousel=s}(jQuery,Tumblr),/*! scripts/search/views/controls/search_control_view_popover.js */
Tumblr.Search||(Tumblr.Search={}),function(t,e){"use strict";var s=Backbone.View.extend({events:{"click .menu_item":"action_control_click"},initialize:function(t){if(this.options=t||{},this.$popover=this.$(".filter_popover"),this.$popover.length){this.$button_text=this.$(".launch_button .control_text"),this.$popover_arrow=this.$(".filter_popover_arrow"),this.$nipple=this.$(".filter_popover_nipple"),this.$default_button=this.$button_text.clone(),this.action_type=this.$el.data("searchActionType");var e=this.model.get(this.action_type);this.$items=this.$(".menu_item");var s=this.$button_text;e&&(s=this.$items.filter('[data-search-action-value="'+e+'"]')),this.set_current_to_el(s),this.listenTo(this.model,"change:"+this.action_type,this.action_type_changed),this.popover=new Tumblr.Popover({el:this.$(".launch_button"),popover:this.$popover,on_show:_.bind(this.on_show,this),on_hide:_.bind(this.on_hide,this),prevent_default_click:!0,glassless:!0})}},action_type_changed:function(t,e){"all"===e?this.set_current_to_el(this.$default_button):this.set_current_to_el()},on_show:function(){this.set_nipple_position(),this.$el.addClass("open")},on_hide:function(){this.$el.removeClass("open")},action_control_click:function(e){e.preventDefault();var s=t(e.currentTarget).data("searchActionValue");this.model.set(this.action_type,s)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},set_nipple_position:function(){var t=this.$popover_arrow.position().left+16,e=this.$popover.width(),s=t/2-e/2,i=t/2+e/2;this.$nipple.css("left",parseInt(i)),this.$popover.css("left",parseInt(s))},set_current_to_el:function(e){if(!e){var s=this.model.get(this.action_type);e=this.$items.filter('[data-search-action-value="'+s+'"]')}var i=t(e);this.$items.removeClass("active"),i.addClass("active"),this.$button_text.text(i.text()||"Error")}});e.SearchControlView=s}(jQuery,Tumblr.Search),/*! scripts/search/views/controls/search_control_view_layout.js */
Tumblr.Search||(Tumblr.Search={}),function(t,e){"use strict";var s=Tumblr.Search.SearchSessionLog,i=Backbone.View.extend({events:{"click .icon":"mode_click"},initialize:function(t){this.options=_.extend({},t),this.listenTo(this.model,"change:post_view",this.update),this._should_log=!1,this.update(),this._should_log=!0},mode_click:function(e){e.preventDefault(),this.model.set("post_view",t(e.currentTarget).data("postView"))},update:function(){var t=this.model.get("post_view");this.$(".icon").removeClass("active"),this.$("[data-post-view="+t+"]").addClass("active"),this.log_to_session("control_click",{control:"post_view",value:t})},log_to_session:function(t,e){this._should_log&&(Tumblr.Events.trigger("Capture:push","search_page_usage",t,e),s.trigger(t,e))},show:function(){this.$el.show()},hide:function(){this.$el.hide()}});e.PostLayoutView=i}(jQuery,Tumblr.Search),/*! scripts/search/views/controls/search_control_nsfw.js */
function(t,e){var s=Backbone.View.extend({events:{click:"on_click"},initialize:function(t){this.options=_.extend({},t),this.listenTo(this.model,"change:filter_nsfw",this.update,this)},update:function(){this.$el.toggleClass("nsfw_filter_enabled",this.model.get("filter_nsfw"))},on_click:function(e){e.preventDefault();var s=!t(e.currentTarget).hasClass("nsfw_filter_enabled");this.model.set("filter_nsfw",s),this.options.force_toggle&&Tumblr.Events.trigger("tag:filter:toggle_nsfw")},show:function(){this.$el.show()},hide:function(){this.$el.hide()}});e.SearchNSFWLockIcon=s}(jQuery,Tumblr),/*! scripts/search/views/results/search_view.js */
function(t,e){"use strict";var s=Tumblr.Search.SearchSessionLog,i=Backbone.View.extend({el:".l-content .search_results_container",subviews:{},scroll_timer:null,scrolling:!1,below_header:!1,use_indash_tumblelogs:Tumblr.Flags.bool("search_indash_blog_cards"),search_with_explore_tab:Tumblr.Flags.bool("discovery_hub_access"),events:{"click .related_searches .search_control_link":"__related_searches_click","click .post_mode .search_control_link":"__post_mode_click","click .post_view .search_control_link":"__post_view_click"},__related_searches_click:function(e){var i=t(e.currentTarget),o=i.parent();Tumblr.Events.trigger("Capture:push","search_page_usage","related_search",{position:o.index(),query:this.$search_query.val()}),s.trigger("related_search",{position:o.index(),query:this.$search_query.val()}),this.history_api?(e.preventDefault(),this.fill_search(i)):(Event.returnValue=!1,window.location.href=t(e.currentTarget).attr("href")+"/"+this.model.get("post_mode"))},__post_mode_click:function(e){if(this.history_api){e.preventDefault();var s=t(e.currentTarget),i=s.data("sort-by");this.update_url(i)}},__search_form_submit:function(t){this.history_api&&(t.preventDefault(),this.set_query(this.$search_query.val()))},__window_resize:function(t){Tumblr.documentWidth(t.windowWidth)},initialize:function(t){this.options=t||{},this.cache_selectors(),this.setup_autopager(),this.listenTo(Tumblr.Events,"search:results:last_row_updated",this.update_autopager),this.listenTo(Tumblr.Events,"search:lightbox:raised",this.after_lightbox,this),this.init_posts(),Tumblr.Flags.bool("is_logged_in")||this.init_logged_out(),this.listenTo(Tumblr.Events,"DOMEventor:flatresize",this.__window_resize,this),this.listenTo(Tumblr.Events,"DOMEventor:flatscroll",this.scroll_watcher,this),this.listenTo(this.model,"change:query change:post_mode",this.on_url_change,this),this.listenTo(this.model,"results:refresh",this.reflow_results,this),this.listenTo(Tumblr.Events,"SearchModel:fetch:before",this.search_fetch_before,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_posts:success",this.search_fetch_posts_success,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_blogs:success",this.search_fetch_blogs_success,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_error",this.search_fetch_error,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_complete",this.search_fetch_complete,this),this.listenTo(Tumblr.Events,"SearchView:addPostsBatch",this.search_posts_added,this),this.listenTo(Tumblr.Events,"SearchTumblelogs:add:batch",this.search_insert_blog_views,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_posts:end",this.on_end_posts,this),this.listenTo(Tumblr.Events,"SearchModel:fetch_blogs:end",this.on_end_blogs,this),this.listenTo(Tumblr.Prima.Events,"SearchRouter:routeChange",this.route_change,this),this.history_api=!(!window.history||!window.history.pushState),this.subviews.related=new Tumblr.SearchRelatedView;var e=this.$("[data-view-tumblelogcarousel]");e[0]&&(this.subviews.tumblelog_carousel=new Tumblr.Search.tumblelogsCarousel({el:e,className:"blogs_wrapper_inner",attributes:{"data-view-tumblelogcarousel":""}}).render()),new Tumblr.BinarySwitch({el:"html:not(.ie) .filter_popover_option_explicit_content"}).render(),this.controls={},this.$(".filter_popover_menu[data-search-action-type]").each(_.bind(function(t,e){var s=new Tumblr.Search.SearchControlView({model:this.model,el:e});this.subviews[s.action_type+"_control"]=this.controls[s.action_type+"_control"]=s},this)),this.controls.nsfw_lock_icon=this.subviews.nsfw_lock_icon=new Tumblr.SearchNSFWLockIcon({el:this.$("[data-action-toggle-nsfw]"),model:this.model}),this.controls.post_layout=this.subviews.post_layout=new Tumblr.Search.PostLayoutView({el:this.$(".search_control.post_layout"),model:this.model}),Tumblr.Flags.bool("prevent-search-ajax-refresh")||this.$search_form.on("submit",_.bind(this.__search_form_submit,this)),this.subviews.point_follow=new Tumblr.Prima.PointerFollow,this.render_required_controls()},init_posts:function(){this.listenTo(Tumblr.Events,"Autopager:trigger",this.on_pager_trigger,this),this.subviews.posts=new Tumblr.SearchPostsView({el:this.$("[data-view-posts]"),model:this.model}).render(),this.model.get("has_pages")||this.handle_no_more_posts(),this.display_controls()},init_logged_out:function(){var e=t(".l-header");this.listenTo(Tumblr.Events,"SearchPopover:focus",function(){e.addClass("active")}),this.listenTo(Tumblr.Events,"SearchPopover:blur",function(){e.removeClass("active")})},cache_selectors:function(){this.$body=t("body"),this.$blogs_view=this.$("[data-view-tumblelogs]"),this.$carousel_view_parent=this.$(".blogs_wrapper"),this.$blogs_view_parent=this.$(".blogs_wrapper_carousel"),this.$posts_view_parent=this.$("#posts"),this.$posts_view=this.$("[data-view-posts]"),this.$web_view=this.$("[data-view-web]"),this.$posts_bottom=this.$("[data-view-bottom]"),this.$post_modes=this.$(".post_mode .search_control_link"),this.$post_views=this.$(".post_view .search_control_link"),this.$search_query=t("#search_query"),this.$search_form=t("#search_form")},__:function(t){return this.options.strings[t]||t},setup_autopager:function(){this.auto_pager=new Tumblr.Autopager({el:"#search_posts"}),_.defer(_.bind(this.check_autopager_fetch,this))},update_autopager:function(t){this.auto_pager.set_buffer(t)},check_autopager_fetch:function(){this.auto_pager.near_bottom()&&this.model.fetch_posts()},on_pager_trigger:function(){this.model.fetch_posts()},reflow_results:function(){var e=!1,s=!0;this.reflow_posts();var i=Tumblr.Flags.bool("discovery_hub_poc");if(i){var o=this.model.is_discovery_mode(),n=this.model.initially_discovery_hub;if(n!==o)return void(window.location="/search/"+this.model.get("query"));o&&(_.has(this.model.changed,"filter_time_range")||_.has(this.model.changed,"post_mode"))&&(this.model.set("blogs_before",0),this.model.set("blog_page",1),this.model.set("num_blogs_shown",0),this.model.set("num_posts_shown",0),this.model.set("next_ad_offset",0),this.model.set("ad_placement_id",0))}(_.has(this.model.changed,"filter_nsfw")||_.has(this.model.changed,"query")||this.model.is_discovery_mode())&&(this.reflow_blogs(),this.reflow_related_searches(),e=!0),_.has(this.model.changed,"query")&&(this.query_change=!0,t(window).scrollTop(0)),_.has(this.model.changed,"filter_nsfw")&&Tumblr.Events.trigger("search:change:filter_nsfw",this.model),this.model.fetch_all({more_posts:s,more_blogs:e})},reflow_blogs:function(t){if(this.subviews.tumblelog_carousel){this.subviews.tumblelog_carousel._remove_subviews();var e=this.$("[data-view-tumblelogcarousel]").html();this.subviews.tumblelog_carousel.remove(),this.subviews.tumblelog_carousel=new Tumblr.Search.tumblelogsCarousel({template:e,className:"blogs_wrapper_inner",attributes:{"data-view-tumblelogcarousel":""}}),this.$carousel_view_parent.append(this.subviews.tumblelog_carousel.render().el),t&&this.model.fetch_blogs()}},reflow_related_searches:function(){this.subviews.related&&(this.subviews.related.should_reflow=!0,this.subviews.related.empty())},display_blogs:function(){this.model.get("has_blogs")?this.$carousel_view_parent.removeClass("empty"):this.$carousel_view_parent.addClass("empty")},reflow_posts:function(t){this.clear_content(),this.subviews.posts=new Tumblr.SearchPostsView({model:this.model,is_reflow:!0}),this.$posts_view_parent.append(this.subviews.posts.render().el),this.subviews.posts.load_next_images=!0,t&&this.model.fetch_posts(),this.render_required_controls()},clear_content:function(){this.subviews.posts&&(this.subviews.posts.remove(),this.subviews.posts=null),this.render_required_controls()},render_required_controls:function(){_.each(this.controls,function(t){t.hide()});var t=this.subviews.posts;if(t){var e=t.required_controls;Tumblr.Flags.bool("is_logged_in")||(e=_.without(e,"nsfw_lock_icon","post_layout")),e&&_.each(e,function(t){var e=this.controls[t];e&&e.show()},this)}},search_fetch_before:function(t){this.subviews.posts_loader=new Tumblr.SearchLoaderView,this.$posts_bottom.html(this.subviews.posts_loader.el),this.subviews.posts_loader.render(),Tumblr.Popover.hide_all_after(150)},search_insert_blog_views:function(t){var e=this.model.get("num_blogs_shown")||0;this.model.set("num_blogs_shown",e+t.length)},search_posts_added:function(){Tumblr.Events.trigger("DOMEventor:updateRect"),Tumblr.Events.trigger("Autopager:start"),this.subviews.posts_loader&&this.subviews.posts_loader.remove()},search_fetch_posts_success:function(t,e,s){var i=e.response;return this.query_change&&i&&i.show_psa?(Tumblr.Prima.Events.trigger("SearchRouter:navigateTo","/search/"+encodeURIComponent(this.model.get("previous_query"))),void(window.location="/psa/search/"+encodeURIComponent(this.model.get("query")))):(i.posts_html&&i.posts_html.length&&(this.subviews.posts.append_post_html(i.posts_html),i.tracking_html&&this.$body.append(i.tracking_html)),this.subviews.related.should_reflow&&i.related_searches&&!this.search_with_explore_tab&&(this.subviews.related.render(i.related_searches),this.subviews.related.should_reflow=!1),this.query_change&&(this.query_change=!1),this.subviews.no_results&&this.subviews.no_results.remove(),-1===this.model.get("before")&&this.handle_no_more_posts(),this.display_controls(),void this.cache_selectors())},display_controls:function(){Tumblr.Flags.bool("no_results_landing")&&this.$(".search_controls").toggleClass("empty",0===t("#search_posts").children().length)},search_fetch_blogs_success:function(t,e,s){var i=e.response;Tumblr.Flags.bool("yahoo_view_promotion")&&Tumblr.Prima.Events.trigger("search:yahoo-view:change",i.yahoo_view_data||{}),this.display_blogs(),this.subviews.related.should_reflow&&i.related_searches&&this.search_with_explore_tab&&(this.subviews.related.render(i.related_searches),this.subviews.related.should_reflow=!1)},search_fetch_error:function(t,e,s){this.model.get("more_posts")&&this.handle_no_more_posts(),this.display_controls()},search_fetch_complete:function(t,e,s){},on_end_posts:function(){Tumblr.Events.trigger("Autopager:stop")},on_end_blogs:function(){},handle_no_more_posts:function(){this.subviews.posts_loader&&this.subviews.posts_loader.remove();var e={placeholder:this.__("search tumblr"),query:this.model.get("query"),noPostsEver:0===t("#search_posts").children().length};this.subviews.no_results=new Tumblr.SearchEndingView(e),this.$posts_bottom.html(this.subviews.no_results.render().el)},scroll_watcher:function(t){null!==this.scroll_timer&&(this.scrolling||(Tumblr.Events.trigger("search:scroller:start"),this.scrolling=!0),clearTimeout(this.scroll_timer)),this.scroll_timer=setTimeout(_.bind(function(){Tumblr.Events.trigger("search:scroller:stop"),this.scrolling=!1},this),350)},encode_query:function(t){return t.replace(/\s/g,"+").replace(/#/g,"%23").replace(/\?/g,"%3F").replace(/\//g,"%2F")},decode_query:function(t){return t.replace(/\+/g," ").replace(/%23/g,"#").replace(/%3F/g,"?").replace(/%2F/g,"/")},set_query:function(e){this.model.get("query")!==e&&""!==t.trim(e)&&(this.model.set("query",e),this.update_url(this.model.get("post_mode")))},fill_search:function(t){var e=t.text();Tumblr.Events.trigger("search:change:query",e),Tumblr.Events.trigger("search:submit")},update_url:function(t,e){if(this.history_api){e=_.extend({trigger:!0},e);var s="/search/"+this.encode_query(this.model.get("query"));"recent"===t&&(s+="/recent"),Tumblr.Prima.Events.trigger("SearchRouter:navigateTo",s,e)}},after_lightbox:function(t){this.update_url(this.model.get("post_mode"),{trigger:!1,replace:!1})},change_post_mode_class:function(){var t=this.$body.attr("class").split(" "),e=_.filter(t,function(t){return!t.lastIndexOf("search_results_mode")});this.$body.removeClass(e),this.$body.addClass("search_results_mode_"+this.model.get("post_mode"))},on_url_change:function(){var e=this.decode_query(this.model.get("query"));document.title=e+" | Tumblr",this.$search_query.val(e),this.change_post_mode_class(),this.$post_modes.removeClass("active"),_.each(this.$post_modes,_.bind(function(e){var s=t(e),i=s.data("sort-by"),o="/search/"+this.encode_query(this.model.get("query"));"recent"===s.data("sort-by")&&(o+="/recent"),s.attr("href",o),i===this.model.get("post_mode")&&s.addClass("active")},this))},route_change:function(){var t=decodeURIComponent(Backbone.history.fragment.split("/")[0]);t===this.encode_query(this.model.get("query"))||this.model.hasChanged("post_mode")||this.model.set("query",this.decode_query(t))}}),o=Backbone.View.extend({template:"#tmpl_search_loader",className:"search_flex_loader",initialize:function(e){this.options=e||{},this.template=_.template(t(this.template).html())},render:function(){this.$el.append(this.template);var e=this.$el.offset().top,s=t(document).height();return this.$el.css("height",s-e),this}}),n=Backbone.View.extend({el:".related_searches",template:"#tmpl_search_related",initialize:function(){},render:function(e){if(e&&e.length){var s=_.template(t(this.template).html());this.$el.html(s({related_searches:e}))}return this.$el.css("opacity",0),this.$el.velocity({opacity:1},{duration:500}),this},empty:function(){this.$el.empty()}}),r=Backbone.View.extend({className:"search_results_end search_form_active",template:"#tmpl_search_results_end",is_focused:!1,search_input:"[data-search-input]",options:{body:"",placeholder:"",query:""},events:{"submit [data-search-input]":"submit","focus [data-search-input]":"on_focus","focusout [data-search-input]":"on_focusout","keydown [data-search-input]":"on_keydown","keyup [data-search-input]":"on_keyup"},initialize:function(t){this.options=t||{},_.defaults(this.options,t)},render:function(){var e=_.template(t(this.template).html());if(Tumblr.Flags.bool("no_results_landing")){var s=_.sample(t(this.template).data("no-result-messages").messages),i=_.extend({message:s},this.options);this.$el.append(t(e(i)))}else this.$el.append(t(e(this.options)));return this},on_focus:function(t){this.is_focused=!0},on_focusout:function(t){this.is_focused=!1},on_keyup:function(t){Tumblr.Events.trigger("search:change:query",this.$(this.search_input).val())},on_keydown:function(t){return 13==t.keyCode&&this.is_focused?void this.submit():void 0},submit:function(t){Tumblr.Events.trigger("search:submit")}});e.SearchRelatedView=n,e.SearchLoaderView=o,e.SearchEndingView=r,e.SearchResultsView=i}(jQuery,Tumblr);