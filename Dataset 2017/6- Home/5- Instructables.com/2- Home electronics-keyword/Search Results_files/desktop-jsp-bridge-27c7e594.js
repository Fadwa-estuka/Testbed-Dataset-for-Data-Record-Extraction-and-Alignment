window.Ibles.JST=window.Ibles.JST||{};var template=function(str){var fn=new Function("obj","var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');");return fn};window.Ibles.JST["svg"]='<svg title="<< id >>" class="svg-icon << id >>" width="24" height="24">\n    <use xlink:href="<< Ibles.staticUrl(\'svg/sprite.svg\') >>#<< id >>"/>\n</svg>';window.Ibles.JST["alert"]='<div class="alert alert-block << alertType >>" id="alertDiv">\n    <button type="button" class="close">&times;</button>\n    <h4><< alertTitle >></h4>\n    << alertMessage >>\n</div>';window.Ibles.JST["alert-label"]='<div class="alert << alertType >> <[ if (showClose) { ]> alert-dismissible <[ } ]>">\n	<< alertMessage >>\n    <[ if (showClose) { ]>\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    <[ } ]>\n</div>';window.Ibles.JST["confirm"]='<div class="alert alert-block" id="alertDiv">\n    <button type="button" class="close">&times;</button>\n    <p><< confirmationMessage >></p>\n    <p>\n        <button class="btn confirm_cancel">Cancel</button>\n        <button class="btn btn-danger confirm_action">Confirm</button>\n    </p>\n</div>';window.Ibles.JST["verify-email-header"]='<div class="verify-header-contents">\n	Hey << screenName >>, you still need to <a href="#" class="send-verification">verify your account.</a>\n</div>';window.Ibles.JST["verify-email-modal"]='<div class="modal-header">\n	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n	<h3>verify your email</h3>\n</div>\n<div class="modal-body">\n	<span class="label">Email:</span> <input class="email-input" type="email" placeholder="Enter an email address" value="<< email >>"/>\n	<div class="btn btn-orange send-email" data-loading-text="Sending Email..." data-finished-text="Email Sent!">Send Verification Email</div>\n	<span class="label label-important send-error">There was an error, try again later.</span>\n</div>';window.Ibles.JST["you-menu"]='<[ if (!Ibles.session.authenticated()) { ]>\n    <div id=\'login-menu\'>\n        <a class="login-link" data-sourcea="header" href="<< Ibles.reverseUrls.loginUrl() >>">Login</a>\n        <span class="pipe">|</span>\n        <a class="signup-link" data-sourcea="header" href="<< Ibles.reverseUrls.goproUrl() >>" data-sourcea="header">Sign Up</a>\n    </div>\n<[ } else { ]>\n    <div id="you-menu" class="dropdown">\n        <a class="you-menu-toggle" href="/you/" data-toggle="dropdown"><img id="you-image" src="<< session.get(\'tinyUrl\') >>" width="20" height="20" /> You <b class="caret"></b></a>\n        <ul id="you-menu-dropdown" class="dropdown-menu pull-right">\n        </ul>\n    </div>\n<[ } ]>';window.Ibles.JST["you-menu-dropdown"]="<li><a href=\"<< Ibles.reverseUrls.memberUrl(session.get('screenName')) >>\"><< Ibles.svg('user') >>You</a></li>\n\n<li>\n    <a href=\"<< Ibles.reverseUrls.memberInboxUrl(session.get('screenName')) >>\"><< Ibles.svg('email') >>Inbox\n    <[ if (session.get('inboxNewMessageCount') > 0) { ]>\n        <span class=\"badge badge-important\"><< session.get('inboxNewMessageCount') >></span>\n    <[ } ]>\n    </a>\n</li>\n\n<li><a class=\"feed-link\" href=\"/feed/\"><< Ibles.svg('follower') >>Feed</a></li>\n\n<li class=\"divider\"></li>\n\n<[ if (session.get('courseEnrollmentCount') > 0) { ]>\n<li>\n    <a href=\"<< Ibles.reverseUrls.memberClassesUrl(session.get('screenName')) >>\"><< Ibles.svg('book') >>Your Classes\n        <span class=\"badge\"><< session.get('courseEnrollmentCount') >></span>\n    </a>\n</li>\n<[ } ]>\n    \n<li class=\"multi-link\">\n    <[ if (session.get('instructablesCount') > 0) { ]>\n        <a class=\"published-link\" href=\"<< Ibles.reverseUrls.memberIblesUrl(session.get('screenName')) >>\"><< Ibles.svg('instructable') >>Instructables\n            <span class=\"badge\"><< session.get('instructablesCount') >></span>\n        </a>\n    <[ } ]>\n    <[ if (session.get('draftsCount') > 0) { ]>\n        <a class=\"draft-link\" href=\"<< Ibles.reverseUrls.memberDraftsUrl(session.get('screenName')) >>\">\n            <[ if (!(session.get('instructablesCount') > 0)) { ]>\n                << Ibles.svg('instructable') >>Draft Instructables\n            <[ } else { ]>\n                Drafts\n            <[ } ]>\n            <span class=\"badge badge-important\"><< session.get('draftsCount') >></span>\n        </a>\n    <[ } ]>\n</li>\n\n<li class=\"multi-link\">\n    <[ if (session.get('publishedCollectionsCount') > 0) { ]>\n        <a class=\"published-link\" href=\"<< Ibles.reverseUrls.memberGuidesUrl(session.get('screenName')) >>\"><< Ibles.svg('collections') >>Collections\n            <span class=\"badge\"><< session.get('publishedCollectionsCount') >></span>\n        </a>\n    <[ } ]>\n    <[ if (session.get('draftCollectionsCount') > 0) { ]>\n        <a class=\"draft-link\" href=\"<< Ibles.reverseUrls.memberDraftGuidesUrl(session.get('screenName')) >>\">\n            <[ if (!(session.get('publishedCollectionsCount') > 0)) { ]>\n                << Ibles.svg('collections') >>Draft Collections\n            <[ } else { ]>\n                Drafts\n            <[ } ]>\n            <span class=\"badge badge-important\"><< session.get('draftCollectionsCount') >></span>\n        </a>\n    <[ } ]>\n</li>\n\n<li>\n    <div class=\"button-actions\">\n        <a class=\"btn btn-default btn-logout\" href=\"/account/logout\">Logout</a>\n        <a class=\"btn btn-orange btn-block btn-large create-btn\" href=\"<< Ibles.reverseUrls.editorCreate() >>\">New Instructable &raquo;</a>\n    </div>\n</li>";window.Ibles.JST["appserver-header"]='<div class="appserver-header-contents">\n    <button class="close">&times;</button>\n	You\'re currently accessing <b><< appserver>></b> directly. <button class="btn btn-blue btn-mini remove-cookie"> Delete Cookie </button> to browse normally.\n</div>';window.Ibles.JST["modal-wrapper"]='<[ if (Ibles.isDesktop()) { ]>\n    <div class="modal fade hide << modalClass >>">\n        << modalContent >>\n    </div>\n<[ } else { ]>\n    <div class="modal fade << modalClass >>">\n        <div class="modal-dialog modal-sm">\n            <div class="modal-content">\n            << modalContent >>\n            </div>\n        </div>\n    </div>\n<[ } ]>\n';!function(root,factory){if(typeof define==="function"&&define.amd){define(["underscore","backbone"],function(_,Backbone){factory(_,Backbone)})}else if(typeof exports!=="undefined"&&typeof require==="function"){var _=require("underscore"),Backbone=require("backbone");factory(_,Backbone)}else{factory(root._,root.Backbone)}}(this,function factory(_,Backbone){Backbone.Model.extend=Backbone.Collection.extend=Backbone.Router.extend=Backbone.View.extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child};var unImplementedSuper=function(method){throw"Super does not implement this method: "+method};var fnTest=/\b_super\b/;var makeWrapper=function(parentProto,name,fn){var wrapper=function(){var tmp=this._super;this._super=parentProto[name]||unImplementedSuper(name);var ret;try{ret=fn.apply(this,arguments)}finally{this._super=tmp}return ret};for(var prop in fn){wrapper[prop]=fn[prop];delete fn[prop]}return wrapper};var ctor=function(){},inherits=function(parent,protoProps,staticProps){var child,parentProto=parent.prototype;if(protoProps&&protoProps.hasOwnProperty("constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);ctor.prototype=parentProto;child.prototype=new ctor;if(protoProps){_.extend(child.prototype,protoProps);for(var name in protoProps){if(typeof protoProps[name]=="function"&&fnTest.test(protoProps[name])){child.prototype[name]=makeWrapper(parentProto,name,protoProps[name])}}}if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parentProto;return child};return inherits});!function(Model){Model.fullExtend=function(protoProps,staticProps){var extended=Model.extend.call(this,protoProps,staticProps);if(protoProps.defaults){if(typeof this.prototype.defaults==="function"&&typeof extended.prototype.defaults==="function"){var parentDefaults=this.prototype.defaults,childDefaults=extended.prototype.defaults;extended.prototype.defaults=function(){return _.extend({},parentDefaults.apply(this),childDefaults.apply(extended))}}else{for(var k in this.prototype.defaults){if(!extended.prototype.defaults[k]){extended.prototype.defaults[k]=this.prototype.defaults[k]}}}}return extended}}(Backbone.Model);!function(View){View.fullExtend=function(protoProps,staticProps){var extended=View.extend.call(this,protoProps,staticProps);if(protoProps.events){for(var k in this.prototype.events){if(!extended.prototype.events[k]){extended.prototype.events[k]=this.prototype.events[k]}}}return extended}}(Backbone.View);!function($){window.Ibles=window.Ibles||{};window.Ibles=_.extend(window.Ibles,{namespaces:{},Events:_.extend({},Backbone.Events),"package":function(){var namespaces=arguments;for(var i=0;i<namespaces.length;i++){var ns=namespaces[i].trim();if(!this.namespaces[ns]){this.exportPath(ns);this.namespaces[ns]=true}}},exportPath:function(namespace){var nsparts=namespace.split(".");var parent=window.Ibles;if(nsparts[0]==="Ibles"){nsparts=nsparts.slice(1)}for(var i=0;i<nsparts.length;i++){var partname=nsparts[i];if(typeof parent[partname]==="undefined"){parent[partname]={}}parent=parent[partname]}},attemptTranslationOfString:Ibles.T=function(translateString){if(Ibles.locale.messages[translateString]!=undefined){return Ibles.locale.messages[translateString]}if(Ibles.locale.iblesAPIResponses[translateString]!=undefined){return Ibles.locale.iblesAPIResponses[translateString]}return translateString},toLocaleError:function(json,defaultMessage){var errorMessage;if(json&&json["error"]&&typeof json["error"]!=="function"){errorMessage=Ibles.attemptTranslationOfString(json["error"])}else{errorMessage=defaultMessage}return errorMessage},toLocaleSuccess:function(json,defaultMessage){var successMessage;if(json&&json["message"]){successMessage=Ibles.attemptTranslationOfString(json["message"])}else{successMessage=defaultMessage}return successMessage},prepareIbleForTemplate:function(json){var member=json.author.screenName,title=json.title,urlString=json.urlString;if(!_.isUndefined(member)){json.shortScreenName=member.length>40?member.slice(0,40)+"...":member;json.memberUrl=Ibles.reverseUrls.memberUrl(member)}if(!_.isUndefined(title)){json.shortTitle=title.length>38?title.slice(0,38)+"...":title}if(!_.isUndefined(urlString)){json.ibleUrl=Ibles.reverseUrls.ibleUrl(urlString)}return this.addUiTranslations(json)},getCurrentUrl:function(){return window.location.pathname+window.location.search},getCurrentPath:function(){return window.location.pathname},getQueryStringParam:Ibles.Q=function(name){return Ibles.getUrlParam(window.location.search,name)},getUrlParam:function(url,name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(url);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "))},updateQueryParameter:function(uri,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=uri.indexOf("?")!==-1?"&":"?";if(uri.match(re)){return uri.replace(re,"$1"+key+"="+value+"$2")}else{return uri+separator+key+"="+value}},appendUrlParams:function(url,options){if(options){_.each(_.keys(options),function(key){if(!_.isEmpty(options[key])){url+=(url.split("?")[1]?"&":"?")+key+"="+encodeURIComponent(options[key])}})}return url},addUiTranslations:function(dictionary){dictionary.trans=Ibles.locale.uiElements;return dictionary},toTitle:function(str){return str.replace(/\b\w+/g,function(s){return s.charAt(0).toLocaleUpperCase()+s.substr(1).toLocaleLowerCase()})},isMobile:function(){return Ibles.pageContext.mobile},isDesktop:function(){return!Ibles.pageContext.mobile},isAndroid:function(){return navigator.userAgent.match(/Android/i)},isiOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},isWindows:function(){return navigator.userAgent.match(/IEMobile/i)},isMobileSafari:function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)&&!navigator.userAgent.match(/CriOS/)},lazyLoadImages:function($lazyImages,opts){if(!$lazyImages.length)return;var defaults={effect:"fadeIn",threshold:800,load:function(){$(this).parent().removeClass("loading")}};opts=opts||defaults;$lazyImages.removeClass("lazy-img").wrap("<div class='lazy loading'></div>").each(function(){var aspectRatio=$(this).data("aspect");$(this).parent().css("padding-bottom",aspectRatio*100+"%")});$lazyImages.lazyload(opts)},staticUrl:function(path){return Ibles.pageContext.staticRoot+path},svg:function(id){var template=_.template(Ibles.JST["svg"]);return template({id:id})},getLocation:function(url){var anchor=document.createElement("a");anchor.href=url;return anchor},onPreviewPage:function(){return!_.isNull(window.location.pathname.match(/^\/preview/))},formatNumber:function(num){if(num<1e3){return"{0}".format(num)}else if(num<1e4){return"{0}K".format((num/1e3).toFixed(1))}else if(num<1e6){return"{0}K".format((num/1e3).toFixed(0))}else{return"{0}M".format((num/1e6).toFixed(1))}},redirectToNativeApp:function(path,queryDict){var pathAndComponents="";if(!_.isEmpty(path))pathAndComponents+=path;if(!_.isEmpty(queryDict))pathAndComponents+="?"+$.param(queryDict);if(window.location.pathname.indexOf("iosregister"))window.location="ibleiossignup://instructables.com/auth"+pathAndComponents;else window.location="instructables://instructables.com/auth"+pathAndComponents},gotoUrl:function(url){if(!_.isEmpty(url)){window.location=url}else{window.location="/"}},showLogin:function(options){Ibles.showLoginPage(options)},checkLoginThen:function(callback,loginOptions){sessionReady(function(sessionModel){if(sessionModel.authenticated()){if(callback){callback()}}else{Ibles.showLoginPage(loginOptions)}})},showSignupModal:function(options){var opts=options||{};if(!Ibles.session.authenticated()){Ibles.setSourceCookie(options);if(_.isEmpty(options.template)){_.extend(options,{template:_.template(Ibles.JST[Ibles.isMobile()?"signup-modal-mobile":"signup-modal"])})}new Ibles.views.SignupModal(options).render()}},showLoginPage:function(options){var opts=options||{};if(!Ibles.session.authenticated()){Ibles.setSourceCookie(options);window.location=Ibles.reverseUrls.loginUrl()}},showAuthPrompt:function(options){var opts=options||{};if(!Ibles.session.authenticated()){Ibles.setSourceCookie(options);new Ibles.views.AuthPrompt(options).render()}},showPremiumAuthPrompt:function(options){var opts=options||{};if(!Ibles.session.authenticated()){Ibles.setSourceCookie(options);new Ibles.views.AuthPrompt(_.extend({premium:true},options)).render()}},showGoproModal:function(options){var opts=options||{};if(Ibles.session.authenticated()){Ibles.setSourceCookie(options);if(_.isEmpty(options.template)){_.extend(options,{template:_.template(Ibles.JST[Ibles.isMobile()?"gopro-modal-mobile":"gopro-modal"])})}new Ibles.views.BaseModalView(options).render()}},getSourceCookie:function(){return JSON.parse($.cookie("iblesource")||"{}")},setSourceCookie:function(options){var options=options||{};if(!_.isEmpty(options["sourceUrl"])){Ibles.setCookie("iblesource",JSON.stringify({sourceUrl:options["sourceUrl"]}))}else if(!_.isEmpty(options["sourcea"])){var attributes=_.extend(Ibles.getSourceCookie()||{},_.omit({sourcea:options["sourcea"],sourceaUrl:Ibles.getCurrentUrl(),returnUrl:options["returnUrl"],roles:options["roles"],paymentPlan:options["paymentPlan"]},_.isEmpty));Ibles.setCookie("iblesource",JSON.stringify(attributes))}},logout:function(e){if(typeof e!=="undefined")e.preventDefault();Ibles.session.clear();Ibles.removeCookie("iblesource");Ibles.API.postRequest("logout").always(function(){window.location.href="/"})},setCookie:function(name,value){var host=window.location.host;if(host.indexOf("localhost")>=0||host.indexOf("127.0.0.1")>=0){$.cookie(name,value,{path:"/"})}else{$.cookie(name,value,{path:"/",domain:".instructables.com"})}},getCookieRaw:function(name){$.cookie.raw=true;var cookie=$.cookie(name);$.cookie.raw=false;return cookie},setCookieRaw:function(name,value,expires){$.cookie.raw=true;var host=window.location.host;if(host.indexOf("localhost")>=0||host.indexOf("127.0.0.1")>=0){$.cookie(name,value,{path:"/",expires:expires})}else{$.cookie(name,value,{path:"/",domain:".instructables.com",expires:expires})}$.cookie.raw=false},removeCookie:function(name){$.removeCookie(name,{path:"/"});$.removeCookie(name,{path:"/",domain:".instructables.com"})},setContestOffsetsCookie:function(contestId,offset){var contestOffsetsCookie=$.cookie("contestOffsets");if(!contestOffsetsCookie){var offsetObj={};offsetObj[contestId]=offset;Ibles.setCookie("contestOffsets",JSON.stringify(offsetObj))}else{var contestOffsets=JSON.parse(contestOffsetsCookie);contestOffsets[contestId]=offset;Ibles.setCookie("contestOffsets",JSON.stringify(contestOffsets))}},getContestOffsetsCookie:function(contestId){var contestOffsetsCookie=$.cookie("contestOffsets");if(contestOffsetsCookie&&contestId){var contestOffsets=JSON.parse(contestOffsetsCookie);return contestOffsets[contestId]}else{return null}},createFragment:function(html){var frag=document.createDocumentFragment(),tmp=document.createElement("body"),child;tmp.innerHTML=html;while(child=tmp.firstElementChild)frag.appendChild(child);return frag},appendViews:function(viewsArray,appendToContainer){var fragment=document.createDocumentFragment();_.each(viewsArray,function(view){fragment.appendChild(view instanceof Backbone.View?view.el:view)});appendToContainer.append(fragment)},fadeInViews:function(viewsArray,appendToContainer){var fragment=document.createDocumentFragment(),visibilityDelay=0;_.each(viewsArray,function(view){var $el=view instanceof Backbone.View?view.$el:$(view);$el.css({opacity:0});fragment.appendChild($el.get(0))});appendToContainer.append(fragment);_.each(viewsArray,function(view){var $el=view instanceof Backbone.View?view.$el:$(view);$el.delay(visibilityDelay).animate({opacity:1},200);visibilityDelay+=100})},fetchUploader:function(callback){Ibles.fetchUploaderTemplates(function(){Ibles.fetchUploaderScripts(callback)})},fetchUploaderTemplates:function(callback){if(!_.isEmpty(this._uploaderTemplatesPromise)){return this._uploaderTemplatesPromise.done(callback)}var loadTemplate=function(templateUrl){return $.ajax({url:templateUrl,success:function(data){$("body").append(data)}})};return this._uploaderTemplatesPromise=$.when(loadTemplate("/static/drag_editor/html/js_templates.html"),loadTemplate("/static/drag_editor/html/js_uploaderTemplates.html"),loadTemplate("/static/drag_editor/html/uploader_prod.html")).done(callback)},fetchUploaderScripts:function(callback){if(!_.isEmpty(this._uploaderScriptsPromise)){return this._uploaderScriptsPromise.done(callback)}var deferred=$.Deferred();var uploaderCss=["/static/drag_editor/dependencies/uploader_depends/jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.min.css"];var uploaderScripts=["/static/drag_editor/dependencies/uploader_depends/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js","/static/drag_editor/js/editor_locale_en_US.js",window.UPLOAD_SCRIPT];head.load(uploaderCss);head.load(uploaderScripts,function(){deferred.resolve()});var promise=deferred.promise();promise.done(callback);return this._uploaderScriptsPromise=promise},paragraphize:function(text){var arrText=_.reject(text.split("\n"),function(str){return _.isEmpty(str)}),arrResult=[];_.each(arrText,function(line){arrResult.push("<p>"+line+"</p>")});return arrResult.join("")},stripHtml:function(content){var tmp=document.createElement("DIV");tmp.innerHTML=content;return tmp.textContent||tmp.innerText||""}})}(jQuery);!function($){Ibles.API={baseURL:"/json-api/",isMockApiUrl:function(){return window.location.search.indexOf("mockApi")>=0},getMockApiParam:function(append){return this.isMockApiUrl()?"?mockApi=true":""},postRequest:function(method,opts,callbacks,requiredKeys){var self=this;var promise=$.ajax({url:this.baseURL+method+this.getMockApiParam(),dataType:"json",type:"POST",data:opts||{}}).done(function(data){if(self.containsRequiredKeys(data,requiredKeys)){if(callbacks&&"success"in callbacks)callbacks.success(data)}}).fail(function(jqXHR){if(callbacks&&"error"in callbacks)callbacks.error(jqXHR.responseJSON)}).always(function(jqXHR){if(callbacks&&"complete"in callbacks)callbacks.complete(jqXHR.responseJSON)});return promise},jsonPostRequest:function(method,opts,callbacks,requiredKeys){var self=this;var promise=$.ajax({url:this.baseURL+method+this.getMockApiParam(),dataType:"json",type:"POST",data:"json="+encodeURIComponent(JSON.stringify(opts||{}))}).done(function(data){if(self.containsRequiredKeys(data,requiredKeys)){if(callbacks&&"success"in callbacks)callbacks.success(data)}}).fail(function(jqXHR){if(callbacks&&"error"in callbacks)callbacks.error(jqXHR.responseJSON)}).always(function(jqXHR){if(callbacks&&"complete"in callbacks)callbacks.complete(jqXHR.responseJSON)});return promise},baseAjaxPostRequest:function(baseUrl,method,opts,callbacks){var promise=$.ajax({url:baseUrl+method+this.getMockApiParam(),type:"POST",data:opts||{}}).done(function(data){if(callbacks&&"success"in callbacks)callbacks.success(data)}).fail(function(jqXHR){if(callbacks&&"error"in callbacks)callbacks.error(jqXHR.responseJSON)}).always(function(jqXHR){if(callbacks&&"complete"in callbacks)callbacks.complete(jqXHR.responseJSON)});return promise},ajaxRequest:function(method,opts,callbacks){return this.baseAjaxPostRequest("/ajax/",method,opts,callbacks)},contestAjaxRequest:function(method,opts,callbacksDict){return this.baseAjaxPostRequest("/contest/",method,opts,callbacksDict)},adminAjaxRequest:function(method,opts,callbacksDict){return this.baseAjaxPostRequest("/admin/",method,opts,callbacksDict)},getRequest:function(method,opts,callbacks,requiredKeys){var opts=opts||{},self=this;if(this.isMockApiUrl())_.extend(opts,{mockApi:true});var promise=$.ajax({url:this.baseURL+method+"?"+$.param(opts),dataType:"json",type:"GET"}).done(function(data){if(self.containsRequiredKeys(data,requiredKeys)){if(callbacks&&"success"in callbacks)callbacks.success(data)}}).fail(function(jqXHR){if(callbacks&&"error"in callbacks)callbacks.error(jqXHR.responseJSON)}).always(function(jqXHR){if(callbacks&&"complete"in callbacks)callbacks.complete(jqXHR.responseJSON)});return promise},getError:function(data){var errorMessage="";if(!_.isUndefined(data["error"])){errorMessage=errorMessage+Ibles.attemptTranslationOfString(data.error)+"<br/>"}if(!_.isUndefined(data["validationErrors"])){_.each(_.values(data.validationErrors),function(error){errorMessage=errorMessage+Ibles.attemptTranslationOfString(error)+"<br/>"})}return errorMessage||"Something went wrong!"},containsRequiredKeys:function(data,requiredKeys){var requiredKeys=_.isUndefined(requiredKeys)?[]:requiredKeys,hasKeys;if(typeof requiredKeys==="string")requiredKeys=[requiredKeys];hasKeys=_.reduce(requiredKeys,function(memo,key){return _.has(data,key)&&memo},true);if(hasKeys===false){this.errorAlert(Ibles.locale.errors.missingKeys)}return hasKeys},errorAlert:function(errorMessage){new Ibles.views.AlertView({model:new Ibles.models.AlertModel({alertType:"error",alertMessage:errorMessage})})}}}(jQuery);!function($){Ibles.package("Ibles.views","Ibles.models");Ibles.models.AlertModel=Backbone.Model.extend({defaults:{alertTitle:"",alertMessage:"",alertType:"info"},types:["error","info","warning","success"],initialize:function(){var alertType=this.get("alertType");if(_.contains(this.types,alertType)){if(alertType==="error"){this.set({alertType:"alert-error alert-danger"})}else{this.set({alertType:"alert-"+this.get("alertType")})}}}});Ibles.views.AlertView=Backbone.View.extend({model:null,tagName:"div",template:_.template(Ibles.JST["alert"]),initialize:function(){this.render()},events:{"click .close":"closeAlert"},closeAlert:function(){var that=this;$("#alertWrapper").fadeOut(200,function(){that.remove()})},render:function(){var container=$("#alertWrapper");if(!container.length){container=$('<div id="alertWrapper"/>');$("body").append(container)}this.$el.html(this.template(this.model.toJSON()));container.empty().append(this.$el);container.fadeIn(200)}});Ibles.views.AlertView.callbackFactory=function(type){return function(data){var alertMessage="";if(data&&data.responseJSON)data=data.responseJSON;if(type==="error"){alertMessage=Ibles.toLocaleError(data,Ibles.locale.errors.somethingWentWrong)}else if(type==="success"){alertMessage=Ibles.toLocaleSuccess(data,Ibles.locale.success.genericSuccess)}new Ibles.views.AlertView({model:new Ibles.models.AlertModel({alertType:type,alertMessage:alertMessage})})}};Ibles.views.AlertLabelView=Backbone.View.extend({showClose:true,template:_.template(Ibles.JST["alert-label"]),initialize:function(options){var opts=options||{};if(!_.isUndefined(opts.showClose))this.showClose=opts.showClose;this.render()},render:function(){this.$el.html(this.template(_.extend(this.model.toJSON(),{showClose:this.showClose})));this.$el.fadeIn(200)}});Ibles=_.extend(Ibles,{alertWhen:function(deferred){deferred.done(Ibles.views.AlertView.callbackFactory("success")).fail(Ibles.views.AlertView.callbackFactory("error"))},alertWhenError:function(deferred){deferred.fail(Ibles.views.AlertView.callbackFactory("error"))},alertWhenSuccess:function(deferred){deferred.done(Ibles.views.AlertView.callbackFactory("success"))}})}(jQuery);!function($){Ibles.package("Ibles.views","Ibles.models");Ibles.models.ConfirmationModel=Backbone.Model.extend({defaults:{confirmationMessage:""}});Ibles.views.ConfirmationView=Backbone.View.extend({model:null,onConfirmFn:null,tagName:"div",template:_.template(Ibles.JST["confirm"]),initialize:function(options){this.onConfirmFn=options.callbackFn;this.render()},events:{"click .close":"closeConfirmation","click .confirm_cancel":"closeConfirmation","click .confirm_action":"confirmAction"},closeConfirmation:function(){var that=this;$("#alertWrapper").fadeOut(200,function(){that.remove()})},confirmAction:function(){if(this.onConfirmFn()){this.closeConfirmation()}},render:function(){var container=$("#alertWrapper");if(!container.length){container=$('<div id="alertWrapper"/>');$("body").append(container)}this.$el.html(this.template(this.model.toJSON()));container.empty().append(this.$el);container.fadeIn(200)}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.GlobalHeader=Backbone.View.extend({youMenuTemplate:_.template(Ibles.JST["you-menu"]),youMenuDropdownTemplate:_.template(Ibles.JST["you-menu-dropdown"]),el:"#gbl-header",menuView:null,searchView:null,events:{"click .share-motto":"shareMottoClicked","click .btn-logout":"logout","click .you-menu-toggle":"updateSessionModel"},initialize:function(){this.menuView=new Ibles.views.GlobalHeaderMenu({el:this.$el});this.searchView=new Ibles.views.GlobalHeaderSearch({el:this.$el});sessionReady(_.bind(this.renderYouMenu,this));this.listenTo(Ibles.session,"change",this.renderYouMenuDropdown)},shareMottoClicked:function(e){e.preventDefault();this.menuView.togglePublishMenu()},renderYouMenu:function(session){$("#you-menu-container").html(this.youMenuTemplate({session:session}));if(session.authenticated()){this.renderYouMenuDropdown()}},renderYouMenuDropdown:function(){$("#you-menu-dropdown").html(this.youMenuDropdownTemplate({session:Ibles.session}))},updateSessionModel:function(){var that=this;if(!$("#you-menu").hasClass("open")){Ibles.session.updatedChangedAttributes()}},logout:function(e){e.preventDefault();Ibles.logout()}});Ibles.views.GlobalHeaderMenu=Backbone.View.extend({loadingTemplate:'<div class="menu-load">Loading...</div>',errorTemplate:'<div class="menu-load-error">An error occurred while loading this content.</div>',exploreMenuScrollThreshold:355,events:{"click .header-nav.btn":"toggleMenuFromNavClick"},initialize:function(){_.bindAll(this,"onScroll")},onScroll:_.throttle(function(e){var $win=$(window),scrollPos=$win.scrollTop(),oldScrollPos=this.scrollPos||scrollPos,scrollDelta=scrollPos-oldScrollPos;if(scrollDelta!==0){if(scrollDelta<0){if(scrollPos<this.exploreMenuScrollThreshold&&oldScrollPos>this.exploreMenuScrollThreshold&&!this.menuVisible()){this.showExploreMenu()}}}this.scrollPos=scrollPos},500),menuVisible:function(){return this.$(".header-menu").hasClass("open")},getMenuEl:function(menuKey){return $("#{0}-menu".format(menuKey))},togglePublishMenu:function(){this.toggleMenuByKey("publish")},toggleExploreMenu:function(){this.toggleMenuByKey("explore")},showMenuByKey:function(menuKey){this.toggleMenuByKey(menuKey,true)},showExploreMenu:function(){this.showMenuByKey("explore")},showPublishMenu:function(){this.showMenuByKey("publish")},toggleMenuFromNavClick:function(e){e.preventDefault();this.toggleMenuByKey($(e.currentTarget).attr("id"))},toggleMenuByKey:function(menuKey,keepOpen){var navMenu=this.getMenuEl(menuKey);this.loadMenuContent(menuKey);this.$("#you-menu").removeClass("open");this.$(".header-menu").not(navMenu).removeClass("open");if(keepOpen)navMenu.addClass("open");else navMenu.toggleClass("open")},loadMenuContent:function(menuKey){if(menuKey==="explore"){var navMenu=this.getMenuEl(menuKey);if(!navMenu.data("loaded")){navMenu.data("loaded",true);this.fetchMenuContent(navMenu,menuKey)}}},fetchMenuContent:function(menuContainer,menuKey){var self=this;menuContainer.html(this.loadingTemplate);$.ajax("/dynjsp/nav_{0}.jsp".format(menuKey),{success:function(data){menuContainer.html(data)},error:function(){menuContainer.html(self.errorTemplate)}})}});Ibles.views.GlobalHeaderSearch=Backbone.View.extend({events:{"submit #header-search-form":"searchSubmit","click #header-search-btn":"searchSubmit"},initialize:function(){this.initSearchAutoComplete()},initSearchAutoComplete:function(){this.$("#header-search input").one("focus",function(){head.load("/static/css/search-autocomplete.css");head.load("/static/js/jquery.swiftype.autocomplete.js","/static/js/search-autocomplete.js",function(){$.get("/static/templates/search-autocomplete-item.html").done(function(data){$("body").append(data);new SearchAutoComplete({el:"#header-search"})})})})},searchSubmit:function(e){e.preventDefault();var searchForm=this.$("#header-search-form"),action=searchForm.attr("action"),input=encodeURIComponent(searchForm.find("input").val().trim().replace(/\s+/g," ")).replace(/%20/g,"+");window.location=action+input+"/"}})}(jQuery);!function($){$(".adspot-item").each(function(index,adspotItem){var $item=$(adspotItem),$spotLink=$item.find(".spot-link"),$spotImage=$item.find(".ad-image"),href=$spotLink.attr("href"),title=$spotLink.attr("title");$spotImage.replaceWith('<a class="ad-image" href="'+href+'" title="'+title+'">'+$spotImage.html()+"</a>")})}(window.jQuery);!function($){var referrer=document.referrer,sourceCookie=Ibles.getSourceCookie();if(!referrer&&(!sourceCookie||!sourceCookie.sourceUrl)||referrer&&referrer.indexOf(location.protocol+"//"+location.host)===-1&&referrer.indexOf(".instructables.com")===-1){Ibles.setSourceCookie({sourceUrl:Ibles.getCurrentUrl()})}}(jQuery);!function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");
2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}}(document,window.mixpanel||[]);mixpanel.init("7181660458b19710240cbfb48c28f305");!function($){Ibles.package("Ibles.views");Ibles.views.AppserverHeader=Backbone.View.extend({className:"appserver-header",template:_.template(Ibles.JST["appserver-header"]),events:{"click .remove-cookie":"removeAppserverCookie","click .close":"hideHeader"},initialize:function(){if(!_.isUndefined($.cookie("FORCE_APPSERVER"))){this.render()}},render:function(){var options={appserver:$.cookie("FORCE_APPSERVER")};this.$el.html(this.template(options));this.$el.appendTo("body");this.$el.show()},removeAppserverCookie:function(){Ibles.removeCookie("FORCE_APPSERVER");this.hideHeader()},hideHeader:function(){this.$el.hide()}})}(jQuery);!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){a.extend(a.fn,{validate:function(b){if(!this.length)return void(b&&b.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));var c=a.data(this[0],"validator");return c?c:(this.attr("novalidate","novalidate"),c=new a.validator(b,this[0]),a.data(this[0],"validator",c),c.settings.onsubmit&&(this.validateDelegate(":submit","click",function(b){c.settings.submitHandler&&(c.submitButton=b.target),a(b.target).hasClass("cancel")&&(c.cancelSubmit=!0),void 0!==a(b.target).attr("formnovalidate")&&(c.cancelSubmit=!0)}),this.submit(function(b){function d(){var d;return c.settings.submitHandler?(c.submitButton&&(d=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(a(c.submitButton).val()).appendTo(c.currentForm)),c.settings.submitHandler.call(c,c.currentForm,b),c.submitButton&&d.remove(),!1):!0}return c.settings.debug&&b.preventDefault(),c.cancelSubmit?(c.cancelSubmit=!1,d()):c.form()?c.pendingRequest?(c.formSubmitted=!0,!1):d():(c.focusInvalid(),!1)})),c)},valid:function(){var b,c;return a(this[0]).is("form")?b=this.validate().form():(b=!0,c=a(this[0].form).validate(),this.each(function(){b=c.element(this)&&b})),b},removeAttrs:function(b){var c={},d=this;return a.each(b.split(/\s/),function(a,b){c[b]=d.attr(b),d.removeAttr(b)}),c},rules:function(b,c){var d,e,f,g,h,i,j=this[0];if(b)switch(d=a.data(j.form,"validator").settings,e=d.rules,f=a.validator.staticRules(j),b){case"add":a.extend(f,a.validator.normalizeRule(c)),delete f.messages,e[j.name]=f,c.messages&&(d.messages[j.name]=a.extend(d.messages[j.name],c.messages));break;case"remove":return c?(i={},a.each(c.split(/\s/),function(b,c){i[c]=f[c],delete f[c],"required"===c&&a(j).removeAttr("aria-required")}),i):(delete e[j.name],f)}return g=a.validator.normalizeRules(a.extend({},a.validator.classRules(j),a.validator.attributeRules(j),a.validator.dataRules(j),a.validator.staticRules(j)),j),g.required&&(h=g.required,delete g.required,g=a.extend({required:h},g),a(j).attr("aria-required","true")),g.remote&&(h=g.remote,delete g.remote,g=a.extend(g,{remote:h})),g}}),a.extend(a.expr[":"],{blank:function(b){return!a.trim(""+a(b).val())},filled:function(b){return!!a.trim(""+a(b).val())},unchecked:function(b){return!a(b).prop("checked")}}),a.validator=function(b,c){this.settings=a.extend(!0,{},a.validator.defaults,b),this.currentForm=c,this.init()},a.validator.format=function(b,c){return 1===arguments.length?function(){var c=a.makeArray(arguments);return c.unshift(b),a.validator.format.apply(this,c)}:(arguments.length>2&&c.constructor!==Array&&(c=a.makeArray(arguments).slice(1)),c.constructor!==Array&&(c=[c]),a.each(c,function(a,c){b=b.replace(new RegExp("\\{"+a+"\\}","g"),function(){return c})}),b)},a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(a){this.lastActive=a,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(a)))},onfocusout:function(a){this.checkable(a)||!(a.name in this.submitted)&&this.optional(a)||this.element(a)},onkeyup:function(a,b){(9!==b.which||""!==this.elementValue(a))&&(a.name in this.submitted||a===this.lastElement)&&this.element(a)},onclick:function(a){a.name in this.submitted?this.element(a):a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).addClass(c).removeClass(d):a(b).addClass(c).removeClass(d)},unhighlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).removeClass(c).addClass(d)}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date ( ISO ).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function b(b){var c=a.data(this[0].form,"validator"),d="on"+b.type.replace(/^validate/,""),e=c.settings;e[d]&&!this.is(e.ignore)&&e[d].call(c,this[0],b)}this.labelContainer=a(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm),this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var c,d=this.groups={};a.each(this.settings.groups,function(b,c){"string"==typeof c&&(c=c.split(/\s/)),a.each(c,function(a,c){d[c]=b})}),c=this.settings.rules,a.each(c,function(b,d){c[b]=a.validator.normalizeRule(d)}),a(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox']","focusin focusout keyup",b).validateDelegate("select, option, [type='radio'], [type='checkbox']","click",b),this.settings.invalidHandler&&a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler),a(this.currentForm).find("[required], [data-rule-required], .required").attr("aria-required","true")},form:function(){return this.checkForm(),a.extend(this.submitted,this.errorMap),this.invalid=a.extend({},this.errorMap),this.valid()||a(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(b){var c=this.clean(b),d=this.validationTargetFor(c),e=!0;return this.lastElement=d,void 0===d?delete this.invalid[c.name]:(this.prepareElement(d),this.currentElements=a(d),e=this.check(d)!==!1,e?delete this.invalid[d.name]:this.invalid[d.name]=!0),a(b).attr("aria-invalid",!e),this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),e},showErrors:function(b){if(b){a.extend(this.errorMap,b),this.errorList=[];for(var c in b)this.errorList.push({message:b[c],element:this.findByName(c)[0]});this.successList=a.grep(this.successList,function(a){return!(a.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){a.fn.resetForm&&a(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue").removeAttr("aria-invalid")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b,c=0;for(b in a)c++;return c},hideErrors:function(){this.hideThese(this.toHide)},hideThese:function(a){a.not(this.containers).text(""),this.addWrapper(a).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}},findLastActive:function(){var b=this.lastActive;return b&&1===a.grep(this.errorList,function(a){return a.element.name===b.name}).length&&b},elements:function(){var b=this,c={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&b.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in c||!b.objectLength(a(this).rules())?!1:(c[this.name]=!0,!0)})},clean:function(b){return a(b)[0]},errors:function(){var b=this.settings.errorClass.split(" ").join(".");return a(this.settings.errorElement+"."+b,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=a([]),this.toHide=a([]),this.currentElements=a([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(a){this.reset(),this.toHide=this.errorsFor(a)},elementValue:function(b){var c,d=a(b),e=b.type;return"radio"===e||"checkbox"===e?a("input[name='"+b.name+"']:checked").val():"number"===e&&"undefined"!=typeof b.validity?b.validity.badInput?!1:d.val():(c=d.val(),"string"==typeof c?c.replace(/\r/g,""):c)},check:function(b){b=this.validationTargetFor(this.clean(b));var c,d,e,f=a(b).rules(),g=a.map(f,function(a,b){return b}).length,h=!1,i=this.elementValue(b);for(d in f){e={method:d,parameters:f[d]};try{if(c=a.validator.methods[d].call(this,i,b,e.parameters),"dependency-mismatch"===c&&1===g){h=!0;continue}if(h=!1,"pending"===c)return void(this.toHide=this.toHide.not(this.errorsFor(b)));if(!c)return this.formatAndAdd(b,e),!1}catch(j){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+b.id+", check the '"+e.method+"' method.",j),j}}if(!h)return this.objectLength(f)&&this.successList.push(b),!0},customDataMessage:function(b,c){return a(b).data("msg"+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase())||a(b).data("msg")},customMessage:function(a,b){var c=this.settings.messages[a];return c&&(c.constructor===String?c:c[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a];return void 0},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customDataMessage(b,c),!this.settings.ignoreTitle&&b.title||void 0,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(b,c){var d=this.defaultMessage(b,c.method),e=/\$?\{(\d+)\}/g;"function"==typeof d?d=d.call(this,c.parameters,b):e.test(d)&&(d=a.validator.format(d.replace(e,"{$1}"),c.parameters)),this.errorList.push({message:d,element:b,method:c.method}),this.errorMap[b.name]=d,this.submitted[b.name]=d},addWrapper:function(a){return this.settings.wrapper&&(a=a.add(a.parent(this.settings.wrapper))),a},defaultShowErrors:function(){var a,b,c;for(a=0;this.errorList[a];a++)c=this.errorList[a],this.settings.highlight&&this.settings.highlight.call(this,c.element,this.settings.errorClass,this.settings.validClass),this.showLabel(c.element,c.message);if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);if(this.settings.unhighlight)for(a=0,b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(b,c){var d,e,f,g=this.errorsFor(b),h=this.idOrName(b),i=a(b).attr("aria-describedby");g.length?(g.removeClass(this.settings.validClass).addClass(this.settings.errorClass),g.html(c)):(g=a("<"+this.settings.errorElement+">").attr("id",h+"-error").addClass(this.settings.errorClass).html(c||""),d=g,this.settings.wrapper&&(d=g.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.length?this.labelContainer.append(d):this.settings.errorPlacement?this.settings.errorPlacement(d,a(b)):d.insertAfter(b),g.is("label")?g.attr("for",h):0===g.parents("label[for='"+h+"']").length&&(f=g.attr("id"),i?i.match(new RegExp("\b"+f+"\b"))||(i+=" "+f):i=f,a(b).attr("aria-describedby",i),e=this.groups[b.name],e&&a.each(this.groups,function(b,c){c===e&&a("[name='"+b+"']",this.currentForm).attr("aria-describedby",g.attr("id"))}))),!c&&this.settings.success&&(g.text(""),"string"==typeof this.settings.success?g.addClass(this.settings.success):this.settings.success(g,b)),this.toShow=this.toShow.add(g)},errorsFor:function(b){var c=this.idOrName(b),d=a(b).attr("aria-describedby"),e="label[for='"+c+"'], label[for='"+c+"'] *";return d&&(e=e+", #"+d.replace(/\s+/g,", #")),this.errors().filter(e)},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},validationTargetFor:function(a){return this.checkable(a)&&(a=this.findByName(a.name).not(this.settings.ignore)[0]),a},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(b){return a(this.currentForm).find("[name='"+b+"']")},getLength:function(b,c){switch(c.nodeName.toLowerCase()){case"select":return a("option:selected",c).length;case"input":if(this.checkable(c))return this.findByName(c.name).filter(":checked").length}return b.length},depend:function(a,b){return this.dependTypes[typeof a]?this.dependTypes[typeof a](a,b):!0},dependTypes:{"boolean":function(a){return a},string:function(b,c){return!!a(b,c.form).length},"function":function(a,b){return a(b)}},optional:function(b){var c=this.elementValue(b);return!a.validator.methods.required.call(this,c,b)&&"dependency-mismatch"},startRequest:function(a){this.pending[a.name]||(this.pendingRequest++,this.pending[a.name]=!0)},stopRequest:function(b,c){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[b.name],c&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(a(this.currentForm).submit(),this.formSubmitted=!1):!c&&0===this.pendingRequest&&this.formSubmitted&&(a(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:!0,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(b,c){b.constructor===String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(b){var c={},d=a(b).attr("class");return d&&a.each(d.split(" "),function(){this in a.validator.classRuleSettings&&a.extend(c,a.validator.classRuleSettings[this])}),c},attributeRules:function(b){var c,d,e={},f=a(b),g=b.getAttribute("type");for(c in a.validator.methods)"required"===c?(d=b.getAttribute(c),""===d&&(d=!0),d=!!d):d=f.attr(c),/min|max/.test(c)&&(null===g||/number|range|text/.test(g))&&(d=Number(d)),d||0===d?e[c]=d:g===c&&"range"!==g&&(e[c]=!0);return e.maxlength&&/-1|2147483647|524288/.test(e.maxlength)&&delete e.maxlength,e},dataRules:function(b){var c,d,e={},f=a(b);for(c in a.validator.methods)d=f.data("rule"+c.charAt(0).toUpperCase()+c.substring(1).toLowerCase()),void 0!==d&&(e[c]=d);return e},staticRules:function(b){var c={},d=a.data(b.form,"validator");return d.settings.rules&&(c=a.validator.normalizeRule(d.settings.rules[b.name])||{}),c},normalizeRules:function(b,c){return a.each(b,function(d,e){if(e===!1)return void delete b[d];if(e.param||e.depends){var f=!0;switch(typeof e.depends){case"string":f=!!a(e.depends,c.form).length;break;case"function":f=e.depends.call(c,c)}f?b[d]=void 0!==e.param?e.param:!0:delete b[d]}}),a.each(b,function(d,e){b[d]=a.isFunction(e)?e(c):e}),a.each(["minlength","maxlength"],function(){b[this]&&(b[this]=Number(b[this]))}),a.each(["rangelength","range"],function(){var c;b[this]&&(a.isArray(b[this])?b[this]=[Number(b[this][0]),Number(b[this][1])]:"string"==typeof b[this]&&(c=b[this].replace(/[\[\]]/g,"").split(/[\s,]+/),b[this]=[Number(c[0]),Number(c[1])]))}),a.validator.autoCreateRanges&&(b.min&&b.max&&(b.range=[b.min,b.max],delete b.min,delete b.max),b.minlength&&b.maxlength&&(b.rangelength=[b.minlength,b.maxlength],delete b.minlength,delete b.maxlength)),b},normalizeRule:function(b){if("string"==typeof b){var c={};a.each(b.split(/\s/),function(){c[this]=!0}),b=c}return b},addMethod:function(b,c,d){a.validator.methods[b]=c,a.validator.messages[b]=void 0!==d?d:a.validator.messages[b],c.length<3&&a.validator.addClassRules(b,a.validator.normalizeRule(b))},methods:{required:function(b,c,d){if(!this.depend(d,c))return"dependency-mismatch";if("select"===c.nodeName.toLowerCase()){var e=a(c).val();return e&&e.length>0}return this.checkable(c)?this.getLength(b,c)>0:a.trim(b).length>0},email:function(a,b){return this.optional(b)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)},url:function(a,b){return this.optional(b)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a).toString())},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(a)},number:function(a,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},creditcard:function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9 \-]+/.test(a))return!1;var c,d,e=0,f=0,g=!1;if(a=a.replace(/\D/g,""),a.length<13||a.length>19)return!1;for(c=a.length-1;c>=0;c--)d=a.charAt(c),f=parseInt(d,10),g&&(f*=2)>9&&(f-=9),e+=f,g=!g;return e%10===0},minlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||e>=d},maxlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||d>=e},rangelength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||e>=d[0]&&e<=d[1]},min:function(a,b,c){return this.optional(b)||a>=c},max:function(a,b,c){return this.optional(b)||c>=a},range:function(a,b,c){return this.optional(b)||a>=c[0]&&a<=c[1]},equalTo:function(b,c,d){var e=a(d);return this.settings.onfocusout&&e.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(c).valid()}),b===e.val()},remote:function(b,c,d){if(this.optional(c))return"dependency-mismatch";var e,f,g=this.previousValue(c);return this.settings.messages[c.name]||(this.settings.messages[c.name]={}),g.originalMessage=this.settings.messages[c.name].remote,this.settings.messages[c.name].remote=g.message,d="string"==typeof d&&{url:d}||d,g.old===b?g.valid:(g.old=b,e=this,this.startRequest(c),f={},f[c.name]=b,a.ajax(a.extend(!0,{url:d,mode:"abort",port:"validate"+c.name,dataType:"json",data:f,context:e.currentForm,success:function(d){var f,h,i,j=d===!0||"true"===d;e.settings.messages[c.name].remote=g.originalMessage,j?(i=e.formSubmitted,e.prepareElement(c),e.formSubmitted=i,e.successList.push(c),delete e.invalid[c.name],e.showErrors()):(f={},h=d||e.defaultMessage(c,"remote"),f[c.name]=g.message=a.isFunction(h)?h(b):h,e.invalid[c.name]=!0,e.showErrors(f)),g.valid=j,e.stopRequest(c,j)}},d)),"pending")}}}),a.format=function(){throw"$.format has been deprecated. Please use $.validator.format instead."};var b,c={};a.ajaxPrefilter?a.ajaxPrefilter(function(a,b,d){var e=a.port;"abort"===a.mode&&(c[e]&&c[e].abort(),c[e]=d)}):(b=a.ajax,a.ajax=function(d){var e=("mode"in d?d:a.ajaxSettings).mode,f=("port"in d?d:a.ajaxSettings).port;return"abort"===e?(c[f]&&c[f].abort(),c[f]=b.apply(this,arguments),c[f]):b.apply(this,arguments)}),a.extend(a.fn,{validateDelegate:function(b,c,d){return this.bind(c,function(c){var e=a(c.target);return e.is(b)?d.apply(e,arguments):void 0})}})});!function($){Ibles.package("Ibles.mixins");Ibles.mixins.SourceMixin={sourceOptions:["source","sourceUrl","sourcea","sourceaUrl"],getSourceProperties:function(){return{source:this.getSource(),sourceUrl:this.getSourceUrl(),sourcea:this.getSourceAction(),sourceaUrl:this.getSourceActionUrl()}},getSource:function(){var platform="";if(!Ibles.isMobile()){platform="desktop"}else{platform="mobile_web_";if(Ibles.isAndroid())platform+="andriod";else if(Ibles.isiOS())platform+="ios";else platform+="other"}return platform},getSourceUrl:function(){var sourceUrl=this.options.sourceUrl||Ibles.Q("sourceUrl");if(_.isEmpty(sourceUrl)){var sourceCookie=Ibles.getSourceCookie();if(!_.isEmpty(sourceCookie)){sourceUrl=sourceCookie["sourceUrl"]}}return sourceUrl},getSourceAction:function(){var sourcea=this.options["sourcea"]||Ibles.Q("sourcea");if(_.isEmpty(sourcea)){var sourceCookie=Ibles.getSourceCookie();if(!_.isEmpty(sourceCookie)){sourcea=sourceCookie["sourcea"]}}return sourcea},getSourceActionUrl:function(){var sourceaUrl=this.options["sourceaUrl"]||Ibles.Q("sourceaUrl");if(_.isEmpty(sourceaUrl)){var sourceCookie=Ibles.getSourceCookie();if(!_.isEmpty(sourceCookie)){sourceaUrl=sourceCookie["sourceaUrl"]}}return sourceaUrl}}}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.BaseModalView=Backbone.View.extend({template:null,callbacks:[],initialize:function(options){this.options=_.extend({dismissable:true},window.Ibles.pageContext||{},options||{});_.bindAll(this,"onShown","onHidden","continueOnClose");if(!_.isEmpty(this.callbacks)){_.bindAll.apply(_,[this].concat(this.callbacks))}this.$el.html(this.getModalHtml());$("body").append(this.$el);this.modal=this.$el.children().first();this.subViews=[]},getModalHtml:function(){var options=this.options,contentTemplate=this.getTemplate(),templateContext=this.getTemplateContext(),wrapperTemplate,modalHtml;if(!options.wrapContent){modalHtml=contentTemplate(templateContext)}else{wrapperTemplate=_.template(Ibles.JST["modal-wrapper"]);modalHtml=wrapperTemplate(_.extend({modalContent:contentTemplate(templateContext),modalClass:options.modalClass||""},templateContext))}return modalHtml},getTemplate:function(){return this.options.template||this.template},getTemplateContext:function(){return this.options},isDismissable:function(){return this.options.dismissable===true},onShown:function(e){this.modal.find("input:first").focus();this.modalShown();var onOpen=this.options.onOpen;if(_.isFunction(onOpen)){onOpen()}},onHidden:function(){this.modal.off();_.each(this.subViews,function(subView){subView.remove()});this.remove();this.modalHidden();var onClose=this.options.onClose;if(_.isFunction(onClose)){onClose()}this.continueOnClose()},continueOnClose:function(){if(this.options.continueOnClose&&!_.isEmpty(this.options.nxtPg)){window.location=this.options.nxtPg}},modalShown:function(){},modalHidden:function(){},render:function(){var self=this;$(".modal").modal("hide");if(Ibles.isMobile()){this.modal.one("hidden.bs.modal",this.onHidden);this.modal.one("shown.bs.modal",this.onShown)}else{this.modal.one("hidden",this.onHidden);this.modal.one("shown",this.onShown)}if(!Ibles.isMobile())this.scrollModalWithPage();if(!this.isDismissable()){this.modal.removeData("modal").removeData("bs.modal").modal({backdrop:"static",keyboard:false})}else{this.modal.modal("show")}return this},scrollModalWithPage:function(){var modal=this.modal,self=this;modal.one("hide",function(){modal.css({display:"",position:"",top:""})});modal.one("shown",function(){if(!self.isDismissable())self.capHeightOfPage();modal.removeClass("fade").removeClass("in");var offset=modal.offset();modal.css({display:"block",position:"absolute",top:offset.top});setTimeout(function(){modal.addClass("fade").addClass("in")},500)})},capHeightOfPage:function(){var maxHeightWrapper=$('<div id="max-height-wrapper"></div>').css({height:Math.max(this.modal.offset().top+this.modal.height()+50,$(window).height())+"px",overflow:"hidden"});$("body").wrapInner(maxHeightWrapper)},dismiss:function(){this.modal.modal("hide")}})}(jQuery);!function($){Ibles.package("Ibles.models");Ibles.models.SessionModel=Backbone.Model.extend({defaults:{logged_in:false,id:null,screenName:null,locale:null,pro:null,staff:null,admin:false,role:null,instructablesCount:null,draftsCount:null,publishedCollectionsCount:null,draftCollectionsCount:null,favoritesCount:null,commentCount:null,tinyUrl:"/static/defaultIMG/user.TINY.gif",emailVerified:true,email:"",showAllSteps:false,contestOffsets:null,subscriptionsCount:0,shortcuts:[],inboxNewMessageCount:null,courseEnrollmentCount:0},initialize:function(){this.loadSession();this.listenTo(this,"change",this.serializeToCookie);this.listenTo(this,"change:logged_in",this.onLoginChange)},loadSession:function(){var resolveSessionReady=_.bind(function(){return Ibles.sessionReady.resolve(this)},this);if(this.hasLoggedInCookie()){this.loadUser(resolveSessionReady)}else{this.removeCookies();resolveSessionReady()}},onLoginChange:function(){this.setProUserCookie();this.setAdminUserCookie();this.setAllStepsCookie();this.setAdCookies()},getCookieAttributes:function(){return _.omit(this.attributes,["logged_in"])},updateModel:function(data){this.set(_.pick(data,_.keys(this.attributes)))},serializeToCookie:function(){Ibles.setCookie("ibleuser",JSON.stringify(this.getCookieAttributes()))},cookieHasMissingUserInfo:function(ibleUserCookie){var cookieAttributes=this.getCookieAttributes();var ibleUser=JSON.parse(ibleUserCookie);for(var key in cookieAttributes){if(typeof ibleUser[key]==="undefined"){return true}}if(window.Ibles.pageContext.pro&&!ibleUser["pro"])return true;return false},clear:function(){this.set(this.defaults,{silent:true});this.removeCookies()},resetForCurrentUser:function(cb){this.clear();this.loadUser(cb)},removeCookies:function(){_.each(["ibleuser","proUser","nonProUser","adminUser","nonAdminUser","ibleAllSteps","hideAds"],function(cookie){Ibles.removeCookie(cookie)})},setProUserCookie:function(){var proUserCookie=$.cookie("proUser"),nonProUserCookie=$.cookie("nonProUser");if(this.get("pro")){if(nonProUserCookie){Ibles.removeCookie("nonProUser")}if(!proUserCookie){Ibles.setCookie("proUser","true")}}else{if(proUserCookie){Ibles.removeCookie("proUser")}if(!nonProUserCookie){Ibles.setCookie("nonProUser","true")}}},setAdCookies:function(){var hideAdsCookie=$.cookie("hideAds");if(this.authenticated()&&!hideAdsCookie){Ibles.setCookie("hideAds","true")}else if(hideAdsCookie){Ibles.removeCookie("hideAds")}},setAdminUserCookie:function(){var adminUserCookie=$.cookie("adminUser"),nonAdminUserCookie=$.cookie("nonAdminUser");if(this.isAdmin()){if(nonAdminUserCookie){Ibles.removeCookie("nonAdminUser")}if(!adminUserCookie){Ibles.setCookie("adminUser","true")}}else{if(adminUserCookie){Ibles.removeCookie("adminUser")}if(!nonAdminUserCookie){Ibles.setCookie("nonAdminUser","true")}}},setAllStepsCookie:function(){var allStepsCookie=$.cookie("ibleAllSteps"),allStepsValue=allStepsCookie?parseInt(allStepsCookie):0;if(this.get("showAllSteps")&&allStepsValue===0){Ibles.setCookie("ibleAllSteps",1)}else if(allStepsCookie){Ibles.removeCookie("ibleAllSteps")}},authenticated:function(){return this.get("logged_in")},isAdmin:function(){return this.authenticated()&&(this.get("admin")||this.get("role")==="ADMIN")},isStaff:function(){return this.authenticated()&&(this.get("staff")||this.get("role")==="STAFF")},isPro:function(){return this.authenticated()&&this.get("pro")},isOld:function(){return this.authenticated()&&this.get("role")==="OLD"},isAdminProOrOld:function(){return this.isAdmin()||this.isPro()||this.isOld()},isAdminOrPro:function(){return this.isAdmin()||this.isPro()},notInRole:function(roleString){if(this.authenticated()){if(roleString==="*")return false;var userRoles=this.get("role").toLowerCase();return _.every(roleString.toLowerCase().split(","),function(roleRequired){return userRoles.indexOf(roleRequired.trim())===-1})}return true},hasLoggedInCookie:function(){return!_.isUndefined($.cookie(Ibles.pageContext.loggedInCookie))},loadUser:function(cb){if(!this.hasLoggedInCookie()){if(cb)cb()}else{var ibleUser=$.cookie("ibleuser"),cbWrapper=_.bind(function(){if(_.isFunction(cb))cb()},this);if(!ibleUser||this.cookieHasMissingUserInfo(ibleUser)){this.loadRemainingUserData(cbWrapper)}else{this.updateModel(_.extend(JSON.parse(ibleUser),{logged_in:true}));cbWrapper()}}},loadFullAuthor:function(){var self=this;return Ibles.API.getRequest("showAuthor",{lite:"true",cb:Math.round((new Date).getTime()/1e3)},{success:function(data){data.admin=typeof data.role==="string"&&data.role.indexOf("ADMIN")>-1;data.staff=typeof data.role==="string"&&data.role.indexOf("STAFF")>-1;data.courseEnrollmentCount=data.courseEnrollment?data.courseEnrollment.length:0;self.updateModel(_.extend(data,{logged_in:true}))}})},updatedChangedAttributes:function(){return $.when(this.updateInboxCount())
},updateInboxCount:function(){var self=this;return Ibles.API.getRequest("getPrivateMessageStats",{},{success:function(data){self.updateModel(data)}})},loadRemainingUserData:function(cb){return this.loadFullAuthor().done(function(){if(cb)cb()})}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.SocialAuthFormView=Backbone.View.extend({events:{"click .facebook-login, .btn-facebook":"doFacebookLogin","click .twitter-login, .btn-twitter":"doTwitterLogin","click .google-login, .btn-google":"doGoogleLogin","click .autodesk-login, .btn-autodesk":"doAutodeskLogin"},initialize:function(options){this.options=_.extend({},window.Ibles.pageContext||{},options||{})},getProviderOptions:function(){return _.extend({},this.options,{socialAuthError:this.socialAuthError})},doFacebookLogin:function(e){new Ibles.views.FacebookLogin(this.getProviderOptions()).performOauthLogin(e)},doTwitterLogin:function(e){new Ibles.views.TwitterLogin(this.getProviderOptions()).performOauthLogin(e)},doGoogleLogin:function(e){new Ibles.views.GoogleLogin(this.getProviderOptions()).performOauthLogin(e)},doAutodeskLogin:function(e){new Ibles.views.AutodeskLogin(this.getProviderOptions()).performOauthLogin(e)},socialAuthError:function(data){this.$(".social-error-label").text("Something went wrong!").slideDown();var options=this.options,errorCallback=options["socialAuthError"];if(_.isFunction(errorCallback))errorCallback(data,options)}});Ibles.views.SocialAuthProvider=Backbone.View.extend({name:"",windowSize:{width:800,height:400},oauthTokenKey:"code",initialize:function(options){this.options=_.extend({provider:this.name},options)},performOauthLogin:function(event){this.trigger=$(event.currentTarget);event.preventDefault();this.oauthPreLogin()},oauthPreLogin:function(){var options=this.options,isSecure=!!window.location.protocol.match(/^https/),popupUrl=options.oauthGetAuthUrl.replace(/^https?\:/i,""),callbackUrl=isSecure?options.oauthCallbackUrl.replace(/^http:/i,"https:"):options.oauthCallbackUrl.replace(/^https:/i,"http:"),openCallback=options["socialAuthOpen"];Ibles.Events.trigger("socialAuth:open",{options:options});if(_.isFunction(openCallback))openCallback({options:options});this.oauthPopup(popupUrl+"?"+$.param({provider:options.provider,callback:callbackUrl,rand:parseInt(Math.random()*99999999)}));window.Ibles.oauthPostLogin=_.bind(this.oauthPostLogin,this)},oauthPopup:function(url){var options={windowName:"ConnectWithOAuth",windowOptions:"location=0,status=0,width="+this.windowSize.width+",height="+this.windowSize.height};window.open(url,options.windowName,options.windowOptions)},oauthPostLogin:function(callbackUrl){var oauthVerifier=Ibles.getUrlParam(callbackUrl,this.oauthTokenKey),params=_.extend({verifier:oauthVerifier},this.getSourceProperties()),options=this.options,eventData={options:options,params:params},self=this;this.trigger.button("loading");Ibles.Events.trigger("socialAuth:start",eventData);var startCallback=options["socialAuthStart"];if(_.isFunction(startCallback))startCallback(eventData);$.ajax({url:"/json-api/loginSocialUser",dataType:"json",type:"POST",data:params,statusCode:{200:function(data){Ibles.session.loadUser(function(){_.extend(eventData,{response:data});Ibles.Events.trigger("socialAuth:loginSuccess",eventData);var loginSuccessCallback=options["socialAuthLoginSuccess"];if(_.isFunction(loginSuccessCallback))loginSuccessCallback(eventData)})},201:function(data){Ibles.session.loadUser(function(){_.extend(eventData,{response:data});Ibles.Events.trigger("socialAuth:signupSuccess",eventData);var signupSuccessCallback=options["socialAuthSignupSuccess"];if(_.isFunction(signupSuccessCallback))signupSuccessCallback(eventData)})}},success:function(data){Ibles.session.loadUser(function(){_.extend(eventData,{response:data});Ibles.Events.trigger("socialAuth:success",eventData);var successCallback=options["socialAuthSuccess"];if(_.isFunction(successCallback))successCallback(eventData)})},error:function(jqXHR){_.extend(eventData,{response:jqXHR.responseJSON});Ibles.Events.trigger("socialAuth:error",eventData);var errorCallback=options["socialAuthError"];if(_.isFunction(errorCallback))errorCallback(eventData)},complete:function(jqXHR){_.extend(eventData,{response:jqXHR.responseJSON});Ibles.Events.trigger("socialAuth:complete",eventData);var completeCallback=options["socialAuthComplete"];if(_.isFunction(completeCallback))completeCallback(eventData);self.trigger.button("reset")}})}});_.extend(Ibles.views.SocialAuthProvider.prototype,Ibles.mixins.SourceMixin);Ibles.views.FacebookLogin=Ibles.views.SocialAuthProvider.extend({name:"facebook",windowSize:{width:400,height:350},oauthTokenKey:"code"});Ibles.views.TwitterLogin=Ibles.views.SocialAuthProvider.extend({name:"twitter",oauthTokenKey:"oauth_verifier"});Ibles.views.GoogleLogin=Ibles.views.SocialAuthProvider.extend({name:"google",windowSize:{width:500,height:500},oauthTokenKey:"code"});Ibles.views.AutodeskLogin=Ibles.views.SocialAuthProvider.extend({name:"autodesk",oauthTokenKey:"oauth_verifier"})}(jQuery);Ibles.socialLogin={getActiveProvider:function(){return{oauthPostLogin:window.Ibles.oauthPostLogin}}};!function($){Ibles.package("Ibles.views");Ibles.views.BaseFormView=Backbone.View.extend({initialize:function(options){this.options=_.extend({},window.Ibles.pageContext||{},options||{})},registerFormSubmitHandler:function(submitHandler){var showErrors=function(errorMap,errorList){_.each(errorList,function(error){$(error.element).tooltip({title:error.message,trigger:"manual"}).on("show",function(e){e.stopPropagation()}).on("hidden",function(e){e.stopPropagation()});$(error.element).tooltip("show");$(error.element).next(".tooltip").css({left:"auto",right:"20px"});window.setTimeout(function(){$(error.element).tooltip("hide").tooltip("destroy")},3e3)})};var form=this.$el.is("form")?this.$el:this.$("form");form.validate({submitHandler:submitHandler,showErrors:showErrors})},makeErrorMessage:function(data){var compiledErrors;if(!_.isEmpty(data.error)){compiledErrors=Ibles.T(data["error"])}else if(!_.isEmpty(data.validationErrors)){var errors=data["validationErrors"],compiledErrors=_.reduce(_.keys(errors),function(memo,key){return memo+" "+Ibles.T(errors[key])},"")}if(_.isEmpty(compiledErrors))compiledErrors=Ibles.locale.errors.somethingWentWrong;return compiledErrors},renderAuthError:function(data){var message=this.makeErrorMessage(data),$label=this.$(".error-label").last();$label.text(message);$label.slideDown()}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.LoginFormView=Ibles.views.BaseFormView.extend({userFields:{screenName:"input[name=u]",password:"input[name=p]"},initialize:function(options){_.bindAll(this,"loginStart","loginSuccess","loginError","loginComplete","submitLogin");Ibles.views.BaseFormView.prototype.initialize.apply(this,arguments);this.registerFormSubmitHandler(this.submitLogin)},submitLogin:function(){this.login().done(this.loginSuccess).fail(this.loginError).always(this.loginComplete)},login:function(params){var params=this.getApiParams();this.loginStart();return Ibles.API.postRequest("login",{u:params.screenName,p:params.password,RememberME:"true"})},getApiParams:function(){this.params=_.mapObject(this.userFields,function(selector,fieldName){return this.$(selector).val()},this);return this.params},loginStart:function(){var options=this.options,params=this.params,eventData={options:options,params:params},startCallback=options["loginStart"];Ibles.Events.trigger("login:start",eventData);if(_.isFunction(startCallback))startCallback(eventData);this.$("button[type=submit]").button("loading")},loginSuccess:function(response){var options=this.options,params=this.params,eventData={options:options,params:params,response:response},successCallback=options["loginSuccess"];Ibles.session.loadUser(function(){Ibles.Events.trigger("login:success",eventData);if(_.isFunction(successCallback))successCallback(eventData)})},loginError:function(jqXHR){var options=this.options,params=this.params,response=jqXHR.responseJSON,eventData={options:options,params:params,response:response},errorCallback=options["loginError"];Ibles.Events.trigger("login:error",eventData);if(_.isFunction(errorCallback))errorCallback(eventData);this.renderAuthError(response);var loginButton=this.$("button[type=submit]");loginButton.button("reset");if(response&&typeof response.error=="string"&&response.error.includes("reset your password")){loginButton.addClass("forgot-link").removeClass("login").text("Reset Password")}},loginComplete:function(jqXHR){var options=this.options,params=this.params,response=jqXHR.responseJSON,eventData={options:options,params:params,response:response},completeCallback=options["loginComplete"];Ibles.Events.trigger("login:complete",eventData);if(_.isFunction(completeCallback))completeCallback(eventData)}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.SignupFormView=Ibles.views.BaseFormView.extend({userFields:{email:"input[name=email]",screenName:"input[name=screenName]",password:"input[name=password]",passRT:"input[name=password]"},initialize:function(options){_.bindAll(this,"signupStart","signupSuccess","signupError","signupComplete","submitSignup","postSignupLogin");Ibles.views.BaseFormView.prototype.initialize.apply(this,arguments);this.registerUsernameCheck();this.registerFormSubmitHandler(this.submitSignup);this.loadCaptcha()},loadCaptcha:function(){var self=this;if(window.recaptchaJsLoaded){this.renderCaptcha()}else{window["recaptchaReady"]=function(){self.renderCaptcha()};head.load("https://www.google.com/recaptcha/api.js?onload=recaptchaReady&render=explicit")}},renderCaptcha:function(){var recaptchaContainer=this.$(".recaptcha-container").get(0),recaptchaWidgetId=grecaptcha.render(recaptchaContainer,{sitekey:this.options.recaptchaSiteKey});this.recaptchaWidgetId=recaptchaWidgetId;window.recaptchaJsLoaded=true;delete window["recaptchaReady"]},registerUsernameCheck:function(){var self=this;this.$(this.userFields.screenName).keyup(_.throttle(function(){var username=$(this).val().trim();if(!username.length)return;self.usernameCheck(username,function(data){self.$(".signup-error-label").empty().hide()},function(data){var usernameField=self.$(self.userFields.screenName),validationMessage=usernameField.data("validation-username-message");self.$(".signup-error-label").html(validationMessage).show()})},1e3,{leading:false}))},usernameCheck:function(username,successCallback,errorCallback){$.ajax({type:"GET",url:"/ajax/AjaxUserNameChecker/",data:{userName:username},dataType:"json",success:function(data){if(data.error){if(errorCallback)errorCallback(data)}else{if(successCallback)successCallback(data)}},error:function(jqXhr){if(errorCallback)errorCallback(jqXhr)}})},submitSignup:function(){this.signup().done(this.postSignupLogin).fail(this.signupError)},signup:function(){var params=this.getApiParams();this.signupStart();return Ibles.API.postRequest("recaptchaRegister",params)},getApiParams:function(){this.params=_.mapObject(this.userFields,function(selector,fieldName){return this.$(selector).val()},this);_.extend(this.params,{sendNewsletter:"true",RememberME:"true","g-recaptcha-response":grecaptcha.getResponse(this.recaptchaWidgetId)},this.getSourceProperties());return this.params},postSignupLogin:function(){var params=this.params;Ibles.API.postRequest("login",{u:params.screenName,p:params.password,RememberME:"true"}).done(this.signupSuccess).fail(this.signupError).always(this.signupComplete)},signupStart:function(){var options=this.options,params=this.params,eventData={options:options,params:params},startCallback=options["signupStart"];Ibles.Events.trigger("signup:start",eventData);if(_.isFunction(startCallback))startCallback(eventData);this.$("button[type=submit]").button("loading")},signupSuccess:function(response){var options=this.options,params=this.params,eventData={options:options,params:params,response:response},successCallback=options["signupSuccess"];Ibles.session.loadUser(function(){Ibles.Events.trigger("signup:success",eventData);if(_.isFunction(successCallback))successCallback(eventData)})},signupError:function(jqXHR){var options=this.options,params=this.params,response=jqXHR.responseJSON,eventData={options:options,params:params,response:response},errorCallback=options["signupError"];Ibles.Events.trigger("signup:error",eventData);if(_.isFunction(errorCallback))errorCallback(eventData);this.renderAuthError(response);grecaptcha.reset(this.recaptchaWidgetId);this.$("button[type=submit]").button("reset")},signupComplete:function(jqXHR){var options=this.options,params=this.params,response=jqXHR.responseJSON,eventData={options:options,params:params,response:response},completeCallback=options["signupComplete"];Ibles.Events.trigger("signup:complete",eventData);if(_.isFunction(completeCallback))completeCallback(eventData)}});_.extend(Ibles.views.SignupFormView.prototype,Ibles.mixins.SourceMixin)}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.ForgotPasswordFormView=Ibles.views.BaseFormView.extend({userFields:{email:"input[name=email]"},initialize:function(options){_.bindAll(this,"forgotPasswordStarted","forgotPasswordSuccess","forgotPasswordError","forgotPasswordComplete","submitForgot");Ibles.views.BaseFormView.prototype.initialize.apply(this,arguments);this.registerFormSubmitHandler(this.submitForgot)},submitForgot:function(){this.forgotPassword().done(this.forgotPasswordSuccess).fail(this.forgotPasswordError).always(this.forgotPasswordComplete)},forgotPassword:function(){var params=this.getApiParams();this.forgotPasswordStarted();return Ibles.API.postRequest("forgotPassword",params)},getApiParams:function(){this.params=_.mapObject(this.userFields,function(selector,fieldName){return this.$(selector).val()},this);return this.params},forgotPasswordStarted:function(){var options=this.options,params=this.params,startedCallback=options["forgotPasswordStarted"];if(_.isFunction(startedCallback)){startedCallback({options:options,params:params})}this.$("button[type=submit]").button("loading")},forgotPasswordSuccess:function(data){var options=this.options,params=this.params,successCallback=options["forgotPasswordSuccess"];if(_.isFunction(successCallback)){successCallback({options:options,params:params,response:data})}},forgotPasswordError:function(jqXHR){var options=this.options,params=this.params,data=jqXHR.responseJSON,errorCallback=options["forgotPasswordError"];if(_.isFunction(errorCallback)){errorCallback({options:options,params:params,response:data})}this.renderAuthError(data)},forgotPasswordComplete:function(jqXHR){var options=this.options,params=this.params,data=jqXHR.responseJSON,completeCallback=options["forgotPasswordComplete"];if(_.isFunction(completeCallback)){completeCallback({options:options,params:params,response:data})}this.$("button[type=submit]").button("reset")}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.ResetPasswordFormView=Ibles.views.BaseFormView.extend({userFields:{email:"input[name=screenName]",password:"input[name=newPassword]",passRT:"input[name=newPassword]",resetCode:"input[name=tempCode]"},initialize:function(options){_.bindAll(this,"resetPasswordStarted","resetPasswordSuccess","resetPasswordError","resetPasswordComplete","submitReset","postResetPasswordLogin");Ibles.views.BaseFormView.prototype.initialize.apply(this,arguments);this.registerFormSubmitHandler(this.submitReset)},setEmail:function(email){this.$(this.userFields.email).val(email)},submitReset:function(){this.resetPassword().done(this.postResetPasswordLogin).fail(this.resetPasswordError).always(this.resetPasswordComplete)},resetPassword:function(){var params=this.getApiParams();this.resetPasswordStarted();return Ibles.API.postRequest("resetPassword",params)},getApiParams:function(){this.params=_.mapObject(this.userFields,function(selector,fieldName){return this.$(selector).val()},this);return this.params},postResetPasswordLogin:function(){var params=this.params;Ibles.API.postRequest("login",{u:params.email,p:params.password,RememberME:"true"}).done(this.resetPasswordSuccess).fail(this.resetPasswordError).always(this.resetPasswordComplete)},resetPasswordStarted:function(){var options=this.options,params=this.params,startedCallback=options["resetPasswordStarted"];if(_.isFunction(startedCallback)){startedCallback({options:options,params:params})}this.$("button[type=submit]").button("loading")},resetPasswordSuccess:function(data){var options=this.options,params=this.params,successCallback=options["resetPasswordSuccess"];Ibles.session.loadUser(function(){if(_.isFunction(successCallback)){successCallback({options:options,params:params,response:data})}})},resetPasswordError:function(jqXHR){var options=this.options,params=this.params,data=jqXHR.responseJSON,errorCallback=options["resetPasswordError"];if(_.isFunction(errorCallback)){errorCallback({options:options,params:params,response:data})}this.renderAuthError(data)},resetPasswordComplete:function(jqXHR){var options=this.options,params=this.params,data=jqXHR.responseJSON,completeCallback=options["resetPasswordComplete"];if(_.isFunction(completeCallback)){completeCallback({options:options,params:params,response:data})}this.$("button[type=submit]").button("reset")}})}(jQuery);!function($){Ibles.package("Ibles.view");Ibles.views.AuthMiddleware=Backbone.View.extend({initialize:function(){if(_.isFunction(this.beforeLogin)){this.listenTo(Ibles.Events,"login:start",this.beforeLogin)}if(_.isFunction(this.afterLogin)){this.listenTo(Ibles.Events,"login:success",this.afterLogin)}if(_.isFunction(this.beforeSignup)){this.listenTo(Ibles.Events,"signup:start",this.beforeSignup)}if(_.isFunction(this.afterSignup)){this.listenTo(Ibles.Events,"signup:success",this.afterSignup)}if(_.isFunction(this.beforeSocialAuth)){this.listenTo(Ibles.Events,"socialAuth:start",this.beforeSocialAuth)}if(_.isFunction(this.afterSocialAuth)){this.listenTo(Ibles.Events,"socialAuth:success",this.afterSocialAuth)}else{if(_.isFunction(this.afterSocialLogin)){this.listenTo(Ibles.Events,"socialAuth:loginSuccess",this.afterSocialLogin)}if(_.isFunction(this.afterSocialSignup)){this.listenTo(Ibles.Events,"socialAuth:signupSuccess",this.afterSocialSignup)}}}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.UtmzTrackingMiddleware=Ibles.views.AuthMiddleware.extend({beforeSocialAuth:function(){this.setUTMZCookie()},beforeSignup:function(){this.setUTMZCookie()},setUTMZCookie:function(){var maxChannel,maxCategory,utmzCookie=Ibles.getCookieRaw("__utmz"),maxString="",expires=6*30;try{if(!_.isUndefined(localStorage["ibleCategories"])){var categories=JSON.parse(localStorage["ibleCategories"]);maxCategory=_.max(_.pairs(categories),function(pair){return pair[1]})[0];maxString+=maxCategory}if(!_.isUndefined(localStorage["ibleChannels"])){var channels=JSON.parse(localStorage["ibleChannels"]);maxChannel=_.max(_.pairs(channels),function(pair){return pair[1]})[0];maxString=maxString?maxString+"_"+maxChannel:maxChannel}if(maxString!==""){if(utmzCookie){if(utmzCookie.match("utmcm=")){utmzCookie.replace(/utmcm=[^\|]+(?=$|\|)/g,"utmcm="+maxString)}else{utmzCookie=utmzCookie+"|utmcm="+maxString}}else{utmzCookie="utmcm="+maxString}}else{utmzCookie="utmcm=unidentified_category"}Ibles.setCookieRaw("__utmz",utmzCookie,expires)}catch(e){try{localStorage.clear()}catch(clearError){Ibles.setCookieRaw("__utmz","utmcm=corrupt_localstorage",expires)}}}})}(jQuery);Ibles.package("Ibles.views");Ibles.views.PaymentMiddleware=Backbone.View.extend({initialize:function(){if(_.isFunction(this.beforePaypalPayment)){this.listenTo(Ibles.Events,"paypalPayment:start",this.beforePaypalPayment)}if(_.isFunction(this.afterPaypalPayment)){this.listenTo(Ibles.Events,"paypalPayment:success",this.afterPaypalPayment)}if(_.isFunction(this.beforeCreditCardPayment)){this.listenTo(Ibles.Events,"creditCardPayment:start",this.beforeCreditCardPayment)}if(_.isFunction(this.afterCreditCardPayment)){this.listenTo(Ibles.Events,"creditCardPayment:success",this.afterCreditCardPayment)}if(_.isFunction(this.afterCreditCardError)){this.listenTo(Ibles.Events,"creditCardPayment:error",this.afterCreditCardError)}}});!function($){Ibles.package("Ibles.views");Ibles.views.MixPanelMiddleware=Ibles.views.AuthMiddleware.extend({initialize:function(options){this.options=_.extend({},window.Ibles.pageContext||{},options||{});Ibles.views.AuthMiddleware.prototype.initialize.apply(this,arguments);Ibles.views.PaymentMiddleware.prototype.initialize.apply(this,arguments);this.registerUserFromCampaign()},afterSignup:function(){if(!_.isEmpty(mixpanel)){mixpanel.alias(Ibles.session.get("id"))}},afterLogin:function(){if(!_.isEmpty(mixpanel)){mixpanel.identify(Ibles.session.get("id"))}},registerUserFromCampaign:function(){var campaign=Ibles.Q("utm_campaign"),source=Ibles.Q("utm_source"),medium=Ibles.Q("utm_medium"),memberId=Ibles.Q("distinct_id");if(_.some([campaign,source,medium])&&!_.isEmpty(mixpanel)){if(Ibles.session.authenticated()){this.afterLogin()}else if(!_.isEmpty(memberId)){Ibles.API.getRequest("getAuthorsStats",{id:memberId}).then(function(data){if(data["authorsStats"]&&data["authorsStats"][memberId]&&_.isEmpty(data["authorsStats"][memberId]["error"])){mixpanel.identify(memberId)}})}}},beforePaypalPayment:function(data){var options=_.extend(_.pick(data.options,"sourcea, sourceaUrl","nextPg","newUser"),_.pick(data.params,"paymentPlan"),{type:"Paypal"});this.trackEvent("Start Payment",options)},afterPaypalPayment:function(){this.trackEvent("Finish Payment")},beforeCreditCardPayment:function(data){var options=_.extend(_.pick(data.options,"sourcea, sourceaUrl","nextPg","newUser"),_.pick(data.params,"paymentPlan"),{type:"Credit Card"});this.trackEvent("Start Payment",options)},afterCreditCardError:function(data){var options=_.extend(_.pick(data.options,"sourcea, sourceaUrl","nextPg","newUser"),data.response,_.pick(data.params,"paymentPlan"),{type:"Credit Card"});this.trackEvent("Credit Card Error",options)},registerUserDetails:function(){var categoryDetails,channelDetails,memberDetails={};try{categoryDetails=JSON.parse(localStorage["ibleCategories"]);channelDetails=JSON.parse(localStorage["ibleChannels"]);if(!_.isEmpty(categoryDetails)){memberDetails["totalIbleViews"]=_.reduce(_.values(categoryDetails),function(a,b){return a+b},0);memberDetails["category"]=_.max(_.pairs(categoryDetails),function(pair){return pair[1]})[0];memberDetails["categoryBreakdown"]=categoryDetails}if(!_.isEmpty(channelDetails)){memberDetails["channel"]=_.max(_.pairs(channelDetails),function(pair){return pair[1]})[0];memberDetails["channelBreakdown"]=channelDetails}}catch(e){try{localStorage.clear()}catch(clearError){}}if(Ibles.session.authenticated()){var loggedInInfo={screenName:Ibles.session.get("screenName"),email:Ibles.session.get("email"),emailVerified:Ibles.session.get("emailVerified"),favorites:Ibles.session.get("favoritesCount"),comments:Ibles.session.get("commentCount"),subscriptions:Ibles.session.get("subscriptionsCount"),instructables:Ibles.session.get("instructablesCount"),drafts:Ibles.session.get("draftsCount"),pro:Ibles.session.get("pro"),mobile:Ibles.isMobile()};_.extend(memberDetails,loggedInInfo)}mixpanel.register(memberDetails)},trackEvent:function(eventName,options){if(!_.isEmpty(mixpanel)){this.registerUserDetails();var options=_.extend(options,this.getSourceProperties());mixpanel.track(eventName,options)}}});_.extend(Ibles.views.MixPanelMiddleware.prototype,Ibles.mixins.SourceMixin)}(jQuery);window.Ibles.JST=window.Ibles.JST||{};var template=function(str){var fn=new Function("obj","var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');");return fn};window.Ibles.JST["login-modal"]='<div class="auth-module modal fade hide auth-modal auth-login">\n    <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <h3>login</h3>\n    </div>\n    <div class="modal-body">\n        <div class="social-login-options clearfix">\n            <button class="btn btn-large pull-left btn-facebook" data-loading-text="<span class=\'grey-spinner\'></span>">Facebook</button>\n            <button class="btn btn-large pull-right btn-google btn-danger" data-loading-text="<span class=\'grey-spinner\'></span>">Google+</button>\n            <button class="btn btn-large pull-left btn-twitter" data-loading-text="<span class=\'grey-spinner\'></span>">Twitter</button>\n            <button class="btn btn-large pull-right btn-default btn-autodesk" data-loading-text="<span class=\'grey-spinner\'></span>">Autodesk</button>\n            <div class="social-error-label error-label label label-important"></div>\n        </div>\n        <div class="divider"><span>OR</span></div>\n        <form class="auth-form login-form" action="<< Ibles.reverseUrls.loginUrl() >>" method="post">\n            <!--[if IE]>\n            <input type="text" name="u" value="Username" data-msg-required="Please enter your username." data-rule-required="true"/>\n            <span class="label ie-password-label">Password</span><input type="password" class="ie-password-input" name="p" data-msg-required="Please enter your password" data-rule-required="true"/>\n            <![endif]-->\n            <!--[if !IE]> -->\n            <input type="text" name="u" placeholder="Username" data-msg-required="Please enter your username." data-rule-required="true"/>\n            <input type="password" name="p" placeholder="Password" data-msg-required="Please enter your password" data-rule-required="true"/>\n            <!-- <![endif]-->\n            <div class="login-error-label error-label label label-important"></div>\n            <button type="submit" class="btn btn-large btn-primary btn-orange auth-action login" data-loading-text="<span class=\'orange-grey-spinner\'></span>">Login</button>\n        </form>\n        <div class="gopro-banner">\n            <a class="payment-interest" data-sourcea="login-modal" href="<< Ibles.reverseUrls.goproUrl() >>" title="upgrade to premium"><img class="upgrade-image" src="<< Ibles.staticUrl(\'img/gopro/cta-banner-premium-push.jpg\') >>" alt="upgrade to premium"/></a>\n        </div>\n    </div>\n    <div class="modal-footer clearfix">\n        <a class="pull-left signup-link" href="<< Ibles.reverseUrls.goproUrl() >>">Sign Up &raquo;</a>\n        <a class="pull-right forgot-link">Forgot Username/Password &raquo;</a>\n    </div>\n</div>';window.Ibles.JST["signup-modal"]='<div class="auth-module modal fade hide auth-modal auth-signup">\n    <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <h3>sign up</h3>\n    </div>\n    <div class="modal-body">\n        <div class="social-login-options clearfix">\n            <button class="btn btn-large pull-left btn-facebook" data-loading-text="<span class=\'grey-spinner\'></span>">Facebook</button>\n            <button class="btn btn-large pull-right btn-google btn-danger" data-loading-text="<span class=\'grey-spinner\'></span>">Google+</button>\n            <button class="btn btn-large pull-left btn-twitter" data-loading-text="<span class=\'grey-spinner\'></span>">Twitter</button>\n            <button class="btn btn-large pull-right btn-default btn-autodesk" data-loading-text="<span class=\'grey-spinner\'></span>">Autodesk</button>\n            <div class="social-error-label error-label label label-important"></div>\n        </div>\n        <div class="divider"><span>OR</span></div>\n        <form class="auth-form register-form" action="<< Ibles.reverseUrls.signupUrl() >>" method="post">\n            <!--[if !IE]><!-->\n            <input type="email" name="email" placeholder="Email" data-msg-required="Please enter your email." data-rule-required="true" value=""/>\n            <input class="username-field" data-validation-username-message="Username is already in use" type="text" name="screenName" placeholder="Username" data-msg-required="Please enter your username." data-rule-required="true"/>\n            <input type="password" name="password" placeholder="Password" data-msg-maxlength="Your password must be fewer than 100 characters long." data-msg-minlength="Your password must be at least 3 characters long." data-msg-required="Please enter your password" data-rule-maxlength="100" data-rule-minlength="3" data-rule-required="true"/>\n            <!--<![endif]-->\n            <!--[if IE]>\n            <input type="email" name="email" data-msg-required="Please enter your email." data-rule-required="true" value=""/>\n            <input class="username-field" data-validation-username-message="Username is already in use" type="text" name="screenName" value="Username" data-msg-required="Please enter your username." data-rule-required="true"/>\n            <span class="label ie-password-label">Password</span><input class="ie-password-input"type="password" name="password" placeholder="Password" data-msg-maxlength="Your password must be fewer than 100 characters long." data-msg-minlength="Your password must be at least 3 characters long." data-msg-required="Please enter your password" data-rule-maxlength="100" data-rule-minlength="3" data-rule-required="true"/>\n            <![endif]-->\n            <div class="recaptcha-container"></div>\n            <p class="muted legal">\n                By clicking "Sign me up!" you agree to our <a target="_blank" title="Terms of service" href="http://usa.autodesk.com/adsk/servlet/item?siteID=123112&amp;id=21959721">Terms</a>\n                and to our <a target="_blank" title="Privacy Statement" href="http://www.autodesk.com/company/legal-notices-trademarks/privacy-statement">Privacy Statement</a>.\n            </p>\n            <div class="signup-error-label error-label label label-important"></div>\n            <button type="submit" class="btn btn-large btn-primary btn-orange auth-action register" data-loading-text="<span class=\'orange-grey-spinner\'></span>">Create Account &raquo;</button>\n        </form>\n    </div>\n    <div class="modal-footer">\n        <p class="login-footer">Already a member? <a class="login-link" href="<< Ibles.reverseUrls.loginUrl() >>">Login &raquo;</a></p>\n    </div>\n</div>';window.Ibles.JST["auth-prompt"]='<div class="auth-module modal fade hide auth-modal auth-prompt">\n    <div class="modal-header">\n        <[ if (dismissable) { ]>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <[ } ]>\n        <[ if (premium) { ]>\n            <h3 class="center">upgrade to premium</h3>\n        <[ } else { ]>\n            <h3 class="center">login or signup</h3>\n        <[ } ]>\n    </div>\n    <div class="modal-body">\n        <[ if (premium) { ]>\n        <div class="robot-speech-bubble auth-speech-bubble">\n          <div class="bubble">\n            <p class="strong">That\'s a premium feature!</p>\n            <p>Want to upgrade to premium? First step is to sign up.</p>\n          </div>\n        </div>\n        <[ } ]>\n        <form class="email-form" method="post">\n            <div class="field-with-btn">\n                <input type="text" class="form-control email-field" placeholder="Email...">\n                <button type="submit" class="btn btn-orange submit-btn">Sign Up &raquo;</button>\n            </div>\n        </form>\n        <p class="login-footer">Already a member? <a class="login-link" href="<< Ibles.reverseUrls.loginUrl() >>">Login &raquo;</a></p>\n    </div>\n</div>';window.Ibles.JST["gopro-modal"]='<div class="auth-module modal fade hide auth-modal auth-gopro-prompt">\n    <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <h3>go premium</h3>\n    </div>\n    <div class="modal-body">\n        <div class="robot-speech-bubble">\n            <div class="bubble">\n                <span>That\'s a premium feature! Want to upgrade to premium?</span>\n            </div>\n        </div>\n        <a class="btn btn-large btn-primary btn-orange auth-action pay-link" href="<< Ibles.reverseUrls.payUrl() >>">I want to upgrade to premium!</a>\n        <a class="btn btn-large" data-dismiss="modal">No thanks</a>\n    </div>\n</div>\n\n';
window.Ibles.JST["gopro-signup-modal"]='<div class="auth-module modal fade hide auth-modal auth-gopro-signup">\n    <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <h3>upgrade to premium</h3>\n    </div>\n    <div class="modal-body">\n        <div class="robot-speech-bubble">\n          <div class="bubble">\n            <p class="strong">That\'s a premium feature!</p>\n            <p>Want to upgrade to premium?</p>\n            <p>First step is to sign up.</p>\n          </div>\n        </div>\n        <div class="social-login-options clearfix">\n          <button class="btn btn-large pull-left btn-facebook" data-loading-text="<span class=\'grey-spinner\'></span>">Facebook</button>\n          <button class="btn btn-large pull-right btn-danger btn-google" data-loading-text="<span class=\'grey-spinner\'></span>">Google+</button>\n          <button class="btn btn-large pull-left btn-twitter" data-loading-text="<span class=\'grey-spinner\'></span>">Twitter</button>\n          <button class="btn btn-large pull-right btn-default btn-autodesk" data-loading-text="<span class=\'grey-spinner\'></span>">Autodesk</button>\n        </div>\n        <div class="divider"><span>OR</span></div>\n        <form class="auth-form register-form" action="<< Ibles.reverseUrls.signupUrl() >>" method="post">\n            <!--[if !IE]><!-->\n            <input type="email" name="email" placeholder="Email" data-msg-required="Please enter your email." data-rule-required="true" value=""/>\n            <input class="username-field" data-validation-username-message="Username is already in use" type="text" name="screenName" placeholder="Username" data-msg-required="Please enter your username." data-rule-required="true"/>\n            <input type="password" name="password" placeholder="Password" data-msg-maxlength="Your password must be fewer than 100 characters long." data-msg-minlength="Your password must be at least 3 characters long." data-msg-required="Please enter your password" data-rule-maxlength="100" data-rule-minlength="3" data-rule-required="true"/>\n            <!--<![endif]-->\n            <!--[if IE]>\n            <input type="email" name="email" data-msg-required="Please enter your email." data-rule-required="true" value=""/>\n            <input class="username-field" data-validation-username-message="Username is already in use" type="text" name="screenName" value="Username" data-msg-required="Please enter your username." data-rule-required="true"/>\n            <span class="label ie-password-label">Password</span><input class="ie-password-input"type="password" name="password" placeholder="Password" data-msg-maxlength="Your password must be fewer than 100 characters long." data-msg-minlength="Your password must be at least 3 characters long." data-msg-required="Please enter your password" data-rule-maxlength="100" data-rule-minlength="3" data-rule-required="true"/>\n            <![endif]-->\n            <div class="recaptcha-container"></div>\n            <p class="muted legal">\n                By clicking "Sign me up!" you agree to our <a target="_blank" title="Terms of service" href="http://usa.autodesk.com/adsk/servlet/item?siteID=123112&amp;id=21959721">Terms</a>\n                and to our <a target="_blank" title="Privacy Statement" href="http://www.autodesk.com/company/legal-notices-trademarks/privacy-statement">Privacy Statement</a>.\n            </p>\n            <div class="signup-error-label error-label label label-important"></div>\n            <button type="submit" class="btn btn-large btn-primary btn-orange auth-action register" data-loading-text="<span class=\'orange-grey-spinner\'></span>">Sign me up!</button>\n        </form>\n        <p class="login-footer">Already a member? <a class="login-link">Login &raquo;</a></p>\n    </div>\n</div>';window.Ibles.JST["forgot-password-modal"]='<div class="auth-module modal fade hide auth-modal auth-forgot-password">\n    <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <h3>forgot password</h3>\n    </div>\n    <div class="modal-body">\n        <div class="robot-speech-bubble">\n            <div class="bubble">\n                <span>Need a new password? <br/>It happens.</span>\n            </div>\n        </div>\n        <p class="muted">Enter the email associated with your account and we will send you your username and a temporary password.</p>\n        <form class="auth-form forgot-form" action="/account/forgot" method="post">\n            <input type="email" name="email" placeholder="Enter email" data-msg-required="Please enter your email." data-rule-required="true"/>\n            <div class="forgot-error-label error-label label label-important"></div>\n            <button type="submit" class="btn btn-large btn-primary btn-orange auth-action forgot" data-loading-text="<span class=\'orange-grey-spinner\'></span>">Send it now, please!</button>\n        </form>\n    </div>\n    <div class="modal-footer clearfix">\n        <p>Not a member? <a href="<< Ibles.reverseUrls.goproUrl() >>">Sign Up &raquo;</a></p>\n    </div>\n</div>';window.Ibles.JST["reset-password-modal"]='<div class="auth-module modal fade hide auth-modal auth-reset-password">\n    <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <h3>reset password</h3>\n    </div>\n    <div class="modal-body">\n        <div class="robot-speech-bubble">\n            <div class="bubble">\n                <span>We have sent you an email with a password reset code. Please enter it below.</span>\n            </div>\n        </div>\n        <form class="auth-form reset-form" action="/account/reset" method="post">\n            <input type="text" name="screenName" placeholder="Email" data-msg-required="<< email >>" data-rule-required="true"/>\n            <input type="text" name="tempCode" placeholder="Reset Code" data-msg-required="Please enter your reset code" data-rule-required="true"/>\n            <input type="password" name="newPassword" placeholder="New Password" data-msg-maxlength="Your password must be fewer than 100 characters long." data-msg-minlength="Your password must be at least 3 characters long." data-msg-required="Please enter your password" data-rule-maxlength="100" data-rule-minlength="3" data-rule-required="true"/>\n            <input type="hidden" name="rememberMe" value="on"/>\n            <div class="reset-error-label error-label label label-important"></div>\n            <button type="submit" class="btn btn-large btn-primary btn-orange auth-action reset" data-loading-text="<span class=\'orange-grey-spinner\'></span>">Reset and Sign In</button>\n        </form>\n    </div>\n    <div class="modal-footer clearfix">\n        <p>Not a member? <a href="<< Ibles.reverseUrls.goproUrl() >>">Sign Up &raquo;</a></p>\n    </div>\n</div>';window.Ibles.JST["downloadPDF-prompt"]='<div class="modal fade hide pdf-modal">\n    <div class="modal-body">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>\n        <img src="<< Ibles.staticUrl(\'img/premium-burst.png\') >>" class="pro-feature-burst" />\n        <h2>Download PDF</h2>\n        <p>All Instructables are available in PDF format for easy printing and offline viewing.</p>\n        <label><input type="checkbox" name="show_comments" value="true" />Include Comments</label>\n        <a class="btn btn-large download-pdf" href="#" data-dismiss="modal">\n            <i class="bg-icon pdf"></i> Download PDF\n        </a>\n        <p>Be patient, it may take a minute.</p>\n    </div>\n</div>\n';!function($){Ibles.package("Ibles.mixins");Ibles.mixins.AfterAuthMixin={afterLogin:function(options){var options=options||{};if(!_.isEmpty(Ibles.Q("nxtPg"))){window.location=Ibles.Q("nxtPg")}else{var sourceCookie=Ibles.getSourceCookie();if(_.isEmpty(sourceCookie)){window.location="/"}else{var roles=sourceCookie.roles;if(!_.isEmpty(roles)&&Ibles.session.notInRole(sourceCookie.roles)&&roles.indexOf("pro")>=0){window.location=Ibles.reverseUrls.payUrl({paymentPlan:sourceCookie.paymentPlan})}else{window.location=sourceCookie.returnUrl||sourceCookie.sourceaUrl||"/"}}}},afterLoginMobile:function(data){var options=data.options,params=data.params;if(options.nativeApp){Ibles.redirectToNativeApp("login",{screenName:params.screenName,password:params.password})}else{this.afterLogin(data)}},afterSignup:function(data){var sourcea=Ibles.Q("sourcea"),sourceaUrl=Ibles.Q("sourceaUrl"),nextPageUrl=Ibles.Q("nxtPg"),goPro=Ibles.Q("gopro"),paymentPlan=Ibles.Q("paymentPlan");Ibles.setCookie("newUser","true");setTimeout(function(){if(goPro||paymentPlan){window.location=Ibles.reverseUrls.payUrl({paymentPlan:paymentPlan,sourcea:sourcea,sourceaUrl:sourceaUrl,nxtPg:nextPageUrl,newUser:true})}else if(!_.isEmpty(nextPageUrl)){window.location=nextPageUrl}else{var sourceCookie=Ibles.getSourceCookie();if(_.isEmpty(sourceCookie)){window.location=Ibles.reverseUrls.feedOnboardingUrl({nxtPg:nextPageUrl||sourceaUrl})}else{var roles=sourceCookie.roles;if(!_.isEmpty(roles)&&Ibles.session.notInRole(sourceCookie.roles)&&roles.indexOf("pro")>=0){window.location=Ibles.reverseUrls.payUrl({paymentPlan:sourceCookie.paymentPlan})}else{window.location=sourceCookie.returnUrl||sourceCookie.sourceaUrl||"/"}}}},100)},afterSignupMobile:function(data){var options=data.options,params=data.params,response=data.response;if(options.nativeApp){Ibles.redirectToNativeApp("signup",{screenName:params.screenName,password:params.password})}else{this.afterSignup(data)}}}}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.LoginModal=Ibles.views.BaseModalView.extend({template:null,callbacks:["loginSuccess","signupSuccess"],events:{"click .forgot-link":"showForgotPasswordModal"},modalShown:function(){this.loginFormView=new Ibles.views.LoginFormView(_.extend({},this.options,{el:this.$("form"),loginError:this.loginError,loginSuccess:this.loginSuccess}));this.socialAuthFormView=new Ibles.views.SocialAuthFormView(_.extend({},this.options,{el:this.$(".social-login-options"),socialAuthLoginSuccess:this.loginSuccess,socialAuthSignupSuccess:this.signupSuccess}));this.subViews.push(this.loginFormView,this.socialAuthFormView)},loginSuccess:function(data){this.afterLogin(data)},signupSuccess:function(data){this.afterSignup(data)},showForgotPasswordModal:function(e){e.preventDefault();new Ibles.views.ForgotPasswordModal({template:_.template(Ibles.JST[Ibles.isMobile()?"forgot-password-modal-mobile":"forgot-password-modal"])}).render()}});_.extend(Ibles.views.LoginModal.prototype,Ibles.mixins.AfterAuthMixin)}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.LoginModalDesktop=Ibles.views.LoginModal.fullExtend({template:_.template(Ibles.JST["login-modal"])})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.ForgotPasswordModal=Ibles.views.BaseModalView.extend({template:null,callbacks:["forgotPasswordSuccess"],modalShown:function(){this.forgotPasswordFormView=new Ibles.views.ForgotPasswordFormView(_.extend({},this.options,{el:this.$("form"),forgotPasswordSuccess:this.forgotPasswordSuccess}));this.subViews.push(this.forgotPasswordFormView)},forgotPasswordSuccess:function(data){window.location=Ibles.reverseUrls.resetPasswordUrl()}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.ResetPasswordModal=Ibles.views.BaseModalView.extend({template:null,callbacks:["resetPasswordSuccess"],modalShown:function(){this.resetPasswordFormView=new Ibles.views.ResetPasswordFormView(_.extend({},this.options,{el:this.$("form"),resetPasswordSuccess:this.resetPasswordSuccess}));if(this.options.email){this.resetPasswordFormView.setEmail(this.options.email)}this.subViews.push(this.resetPasswordFormView)},resetPasswordSuccess:function(data){this.afterLogin(data)}});_.extend(Ibles.views.ResetPasswordModal.prototype,Ibles.mixins.AfterAuthMixin)}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.SignupModal=Ibles.views.BaseModalView.extend({template:null,callbacks:["loginSuccess","signupSuccess"],modalShown:function(){this.signupFormView=new Ibles.views.SignupFormView(_.extend({},this.options,{el:this.$("form"),signupSuccess:this.signupSuccess}));this.socialAuthFormView=new Ibles.views.SocialAuthFormView(_.extend({},this.options,{el:this.$(".social-login-options"),socialAuthLoginSuccess:this.loginSuccess,socialAuthSignupSuccess:this.signupSuccess}));this.subViews.push(this.signupFormView,this.socialAuthFormView)},loginSuccess:function(data){this.afterLogin(data)},signupSuccess:function(data){this.afterSignup(data)}});_.extend(Ibles.views.SignupModal.prototype,Ibles.mixins.AfterAuthMixin)}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.AuthPrompt=Ibles.views.BaseModalView.fullExtend({events:{"click .submit-btn":"submitEmail"},getTemplate:function(){return _.template(Ibles.JST[Ibles.isDesktop()?"auth-prompt":"auth-prompt-mobile"])},getTemplateContext:function(){var options=_.clone(this.options);if(_.isUndefined(options.premium))options.premium=false;return options},modalShown:function(){this.subViews.push(new Ibles.views.SocialAuthFormView(_.extend({},this.options,{el:this.$(".social-login-options"),socialAuthLoginSuccess:this.loginSuccess,socialAuthSignupSuccess:this.signupSuccess})))},submitEmail:function(e){e.preventDefault();window.location=Ibles.reverseUrls.signupUrl({email:this.$(".email-field").val()})}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.EmailVerificationHeader=Backbone.View.extend({id:"sticky-email-verification",template:_.template(Ibles.JST["verify-email-header"]),events:{"click .send-verification":"showVerificationModal"},initialize:function(){this.render();this.verificationModal=new Ibles.views.EmailVerificationModal;this.verificationModal.render().insertAfter(this.$el)},showVerificationModal:function(e){e.preventDefault();this.verificationModal.$el.modal("show")},render:function(){this.$el.html(this.template(Ibles.session.toJSON()));this.$el.insertBefore("#gbl-header");return this}});Ibles.views.EmailVerificationModal=Backbone.View.extend({template:_.template(Ibles.JST["verify-email-modal"]),className:"modal fade verification-modal",events:{"click .send-email":"verify"},render:function(){this.$el.html(this.template(Ibles.session.toJSON()));return this.$el},verify:function(e){e.preventDefault();this.$(".send-email").button("loading");var promise,that=this;if(this.$(".email-input").val()===Ibles.session.get("email")){promise=this.sendVerificationEmail()}else{promise=this.saveProfile()}promise.then(function(data){$.cookie("verifyHeader","false",{path:"/"});$("#sticky-email-verification").hide();that.$(".send-email").button("finished");setTimeout(function(){that.$el.modal("hide")},1e3)}).fail(function(jqXHR){that.$(".send-email").button("reset");if(!_.isUndefined(jqXHR.responseJSON)&&!_.isUndefined(jqXHR.responseJSON.error)){that.$(".send-error").text(jqXHR.responseJSON.error)}that.$(".send-error").css("display","inline-block")})},saveProfile:function(){return Ibles.API.postRequest("saveProfile",{email:this.$(".email-input").val()})},sendVerificationEmail:function(){return Ibles.API.getRequest("emailVerificationSend")}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.EmailVerificationTrigger=Backbone.View.extend({initialize:function(options){_.bindAll(this,"showEmailVerificationModal");$(document).on("click",".verification-required",this.showEmailVerificationModal);sessionReady(_.bind(function(session){this.showEmailVerificationHeader(options)},this))},showEmailVerificationHeader:function(options){var session=Ibles.session;if(session.authenticated()&&!session.get("emailVerified")&&$.cookie("verifyHeader")!=="false"&&!options.disableEmailVerifyWidget){new Ibles.views.EmailVerificationHeader}},showEmailVerificationModal:function(e){var session=Ibles.session;if(session.authenticated()&&session.get("emailVerified")===false){e.preventDefault();$(".modal").modal("hide");$(".verification-modal").modal("show")}}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.RoleRequiredAction=Backbone.View.extend({roleGroups:{pdf:{roles:"admin,pro,old",paymentPlan:"TWO_YEAR_SINGLE_PAYMENT"}},initialize:function(options){var that=this;$(document).on("click.authTrigger","[data-sourcea]",function(e){e.delegateTarget=$(this);if(e.isDefaultPrevented())return false;that.triggered(e)})},triggered:function(e){var target=$(e.delegateTarget),options=this.getTargetOptions(target);if(this.requiresSourceCookie(options))Ibles.setSourceCookie(options);if(this.requiresLogin(options)){e.preventDefault();window.location=Ibles.reverseUrls.loginUrl()}else if(this.requiresSignup(options)){e.preventDefault();window.location=Ibles.reverseUrls.signupUrl()}else if(this.requiresPremiumSignup(options)){e.preventDefault();Ibles.showPremiumAuthPrompt(options)}else if(this.requiresPremiumPayment(options)){e.preventDefault();Ibles.showGoproModal(options)}},requiresSourceCookie:function(options){return!this.isAuthLinkOnAuthPage(options)},requiresLogin:function(options){return!Ibles.session.authenticated()&&(options.hasLoginRequired||options.isLoginLink||options.hasProRequiredForClasses)},requiresSignup:function(options){return!Ibles.session.authenticated()&&(options.hasSignupRequired||options.isSignupLink)},requiresPremiumSignup:function(options){return!Ibles.session.authenticated()&&this.requiresProRole(options)},requiresPremiumPayment:function(options){return Ibles.session.authenticated()&&this.requiresProRole(options)&&Ibles.session.notInRole(options.roles)},requiresProRole:function(options){return options.hasProRequired||options.roles&&options.roles.indexOf("pro")>=0},isAuthLinkOnAuthPage:function(options){var normalize=function(url){return url.replace(/\/$/,"")},currentPath=normalize(window.location.pathname),urlLookup=Ibles.reverseUrls,authUrls=[normalize(urlLookup.loginUrl()),normalize(urlLookup.signupUrl()),normalize(urlLookup.goproUrl())],isAuthPage=_.contains(authUrls,currentPath),isAuthLink=options.isLoginLink||options.isSignupLink||options.targetUrl&&_.contains(authUrls,options.targetUrl);return isAuthLink&&isAuthPage},getTargetOptions:function(target){var defaults={roles:"*"},roleGroup=target.data("role-group"),groupOptions=roleGroup&&_.clone(this.roleGroups[roleGroup])||{},targetOptions=_.omit({roles:target.data("roles"),sourcea:target.data("sourcea"),returnUrl:target.data("return-url")||Ibles.getCurrentUrl(),isLoginLink:target.hasClass("login-link"),isSignupLink:target.hasClass("signup-link"),hasLoginRequired:target.hasClass("login-required"),hasSignupRequired:target.hasClass("signup-required"),hasProRequired:target.hasClass("pro-required"),hasProRequiredForClasses:target.hasClass("pro-required-course"),targetUrl:target.attr("href")},_.isUndefined);return _.extend(defaults,groupOptions,targetOptions)}})}(jQuery);!function($){Ibles.package("Ibles.views");Ibles.views.DownloadPDFView=Ibles.views.BaseModalView.extend({template:_.template(Ibles.JST["downloadPDF-prompt"]),events:{"click .download-pdf":"downloadPDF"},downloadPDF:function(e){e.preventDefault();var pdfId=Ibles.pageContext.ibleData.id;var pdfUrl="/json-api/viewPdf?id="+pdfId+"&forceOverwrite=true";window.open(pdfUrl)}})}(jQuery);