BOM.AjaxDialog=function(oConf,options){if($("div#modalDialog").length!==0){$("div#modalDialog").remove()}var targetElm=$('<div/>',{'id':'modalDialog'});targetElm.appendTo('body');$.each(oConf.trigger,function(index,triggerItem){var triggerElm=(0<$('#'+triggerItem).length)?$('#'+triggerItem):$('.'+triggerItem);triggerElm.live('click',function(e){if(triggerElm.attr('rel')){var reloadUrl=triggerElm.attr('rel')}targetElm.load($(e.target).attr('href'),function(response,textStatus,XMLHttpRequest){if(XMLHttpRequest.getResponseHeader("content-type")==='application/json; charset=utf-8'){response=$.parseJSON(response);if(!response.success){document.location.href=reloadUrl;return false}}else{targetElm.html(response);options=$.extend({width:450,height:'auto',minHeight:false,dialogClass:'modalDefault',modal:true,resizable:false,finalUrl:triggerElm.attr('rel'),close:function(){BOM.UI.oDialog.pop();var modale=$(this);$('.btAjaxSubmit, .bomdialog-follow, a, button').die('click');$(modale).remove()}},options||{});options=$.extend({open:function(){var modale=$(this);$(modale).find('.closeModal').live('click',function(e){e.preventDefault();$(modale).dialog('close')})},close:function(){var modale=$(this);$('.btAjaxSubmit, .bomdialog-follow').die('click');BOM.UI.oDialog.pop();$(modale).remove()}},options||{});if(oConf.ajaxForm){options=$.extend({open:function(){var modale=$(this);var form=$(this).children('form');$(form).bind('submit',function(e){e.preventDefault();var urlForm=$(e.target).attr('action');$.ajax({type:'POST',url:urlForm,data:$(e.target).serialize(),success:function(response){if(true===response.success&&options.finalUrl!==''){document.location.href=options.finalUrl}else{$(modale).html(e)}}})})},close:function(){var modale=$(this);$('.btAjaxSubmit, .bomdialog-follow').die('click');BOM.UI.oDialog.pop();$(modale).remove()}},options||{})}targetElm.dialog(options);BOM.UI.oDialog.push(targetElm)}});return false});return true});$('.ui-widget-overlay').live('click',function(){$(BOM.UI.oDialog[0]).dialog('close')})};