!function(){define("models/Filters",["jquery","lodash","Backbone"],function(a,b,c){"use strict";function d(a){return b.isArray(a)&&(a=b.pluck(a,"value")),b.isPlainObject(a)&&(a=a.value),a}var e=c.Model.extend({getValue:function(a){return d(this.get(a))},toJSON:function(){return b.cloneDeep(this.attributes)},toValues:function(){return b.zipObject(b.map(this.toJSON(),function(a,b){return[b,d(a)]}))},unsetAllExcept:function(a,c){a=a||[],c=c||{};var d=b.omit(b.clone(this.attributes),a);if(!b.isEmpty(d)){for(var e in d)d[e]=void 0;this.set(d,b.extend({},c,{unset:!0}))}return this}});return e}),define("hbs/underscore",{}),function(window){var JSON=window.JSON||{};!function(){"use strict";function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;c<f;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",{load:function(a){throw new Error("Dynamic load not allowed: "+a)}}),define("templates/helpers/icon",["Handlebars"],function(a){"use strict";function b(a,b,d){return a=c(a),b=c(b),d=c(d),'<i class="icon icon_'+a+" "+(d||"")+'">'+(b?"<span class=screen-reader-text>"+b+"</span>":"")+"</i>"}var c=a.Utils.escapeExpression;return a.registerHelper("icon",function(c,d,e){return new a.SafeString(b(c,d,e))}),b}),define("hbs!templates/stub",["hbs","hbs/handlebars","templates/helpers/icon"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<span class="stub '+this.escapeExpression((e=null!=(e=b.class||(null!=a?a.class:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"class",hash:{},data:d}):e))+'" data-name="'+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+'" data-value="'+this.escapeExpression((e=null!=(e=b.value||(null!=a?a.value:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"value",hash:{},data:d}):e))+'">\n  <span class="stub__label">'+this.escapeExpression((e=null!=(e=b.label||(null!=a?a.label:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"label",hash:{},data:d}):e))+'</span>\n  <a class="stub__remove" href="#">\n    '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"close-small","Remove","stub__icon",{name:"icon",hash:{},data:d}))+"\n  </a>\n</span>\n"},useData:!0});return b.registerPartial("templates/stub",c),c}),define("templates/helpers/stub",["Handlebars","hbs!templates/stub"],function(a,b){"use strict";function c(a,c,d,e){return b({label:a,name:c,value:d,classes:e||""})}return a.registerHelper("stub",function(b,d,e,f){return new a.SafeString(c(b,d,e,f))}),c}),define("utils/applyAll",["jquery"],function(a){"use strict";function b(c,d,e){var f,g;for(f=0,g=d.length;f<g;f++)a.isArray(d[f])?b(c,d[f],e):d[f].apply(c,e)}return b}),define("utils/throwError",[],function(){"use strict";return function(a){throw new Error("Error in TED: "+a)}}),define("lib/pubSub",["jquery","utils/applyAll","utils/throwError"],function(a,b,c){"use strict";function d(a){var d={publish:a.fire,subscribe:a.add,unsubscribe:a.remove},e=null;a.add(function(a){e=a}),d.read=function(){return e};var f;return d.publishUnique=function(){if(!window.JSON)return c("JSON object not available. You may need to shim it on this client."),!1;var b=Array.prototype.slice.call(arguments,0),d=JSON.stringify(b);d!==f&&(a.fire.apply(a,b),f=d)},d.once=function(){function c(){b(a,d,arguments),a.remove(c)}var d=arguments;return a.add(c)},d.future=function(){function c(){f&&b(a,e,arguments)}var d,e=arguments,f=!1;return d=a.add(c),f=!0,d},d}function e(b){var c,e=b&&f[b];return e||(c=a.Callbacks("memory"),e=d(c),b&&(f[b]=e)),e}var f={};return e._reset=function(){f={}},e}),define("utils/is_mobile",[],function(){"use strict";function a(){return a.isIOS()||a.isAndroid()}function b(b){return!!a.ua.match(b)}var c=/Android/g,d=/(iPad|iPhone|iPod)/g;return a.isIOS=function(){return b(d)},a.isAndroid=function(){return b(c)},a.ua=window.navigator&&window.navigator.userAgent||"",a}),define("jqueryui/core",["jquery"],function(a){return function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,!(!b.href||!f||"map"!==e.nodeName.toLowerCase())&&(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g))):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"@VERSION",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0||(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(a),a}),define("hbs!templates/comboPopup",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="combo__query">\n  <input class="form-control combo__input" placeholder="'+this.escapeExpression((e=null!=(e=b.inputPlaceholder||(null!=a?a.inputPlaceholder:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"inputPlaceholder",hash:{},data:d}):e))+'">\n  <div class="combo__indicator"></div>\n</div>\n\n<div class="combo__results">\n</div>\n\n<div class="combo__no-results">\n</div>\n\n<div class="combo__defaults">\n</div>\n'},useData:!0});return b.registerPartial("templates/comboPopup",c),c}),define("hbs!templates/comboList",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'  <h4 class="m5 combo__label">'+this.escapeExpression((e=null!=(e=b.label||(null!=a?a.label:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"label",hash:{},data:d}):e))+"</h4>\n"},3:function(a,b,c,d){var e;return'    <li class="combo__item">\n      <a class="l3 combo__link" href="#" data-value="'+this.escapeExpression((e=null!=(e=b.value||(null!=a?a.value:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"value",hash:{},data:d}):e))+'">\n        '+this.escapeExpression((e=null!=(e=b.label||(null!=a?a.label:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"label",hash:{},data:d}):e))+"\n      </a>\n    </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"\n"+(null!=(e=b.if.call(a,null!=a?a.label:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'\n<ul class="sl combo__list">\n'+(null!=(e=b.each.call(a,null!=a?a.items:a,{name:"each",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+"</ul>\n"},useData:!0});return b.registerPartial("templates/comboList",c),c}),define("hbs!templates/comboNoResults",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return"\nSorry, no matches for <q>"+this.escapeExpression(this.lambda(null!=(e=null!=a?a.request:a)?e.term:e,a))+"</q>\n"},useData:!0});return b.registerPartial("templates/comboNoResults",c),c}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("spinjs",b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;b<c;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",n.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c;if(void 0!==e[b])return b}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a,b){return"string"==typeof a?a:a[b%a.length]}function i(a){return"undefined"==typeof this?new i(a):void(this.opts=f(a||{},i.defaults,o))}function j(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}n.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function g(a,g,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:h(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)g(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)g(i);return b(a,m)},i.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};i.defaults={},f(i.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),j=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+j)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+j)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!k){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function a(){m++;for(var b=0;b<h.lines;b++)l=Math.max(1-(m+(h.lines-b)*r)%p*q,h.opacity),f.opacity(i,b*h.direction+n,l,h);f.timeout=f.el&&setTimeout(a,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*j+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,j=0,l=(f.lines-1)*(1-f.direction)/2;j<f.lines;j++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:k&&c(f.opacity,f.trail,l+j*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,g(h(f.color,j),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var p=e(a("group"),{behavior:"url(#default#VML)"});return!d(p,"transform")&&p.adj?j():k=d(p,"animation"),i}),define("jqueryui/widget",["jquery"],function(a){return function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(a){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;h<i;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(a.isPlainObject(f)?c[e]=a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):c[e]=f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,h?this.each(function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}):this.each(function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),1===arguments.length)return f[c]===b?null:f[c];f[c]=d}else{if(1===arguments.length)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){if(b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled"))return("string"==typeof g?f[g]:g).apply(f,arguments)}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(a),a}),define("widgets/filterable",["jquery","lodash","jqueryui/core","jqueryui/widget"],function(a,b){"use strict";a.widget("ted.filterable",{options:{results:null,source:null,max:5},search:function(a){this.source&&this.source({term:a},b.bind(this._response,this))},_abort:function(){this._filterableLastQuery&&(this._filterableLastQuery.abort(),this._filterableLastQuery=null)},_create:function(){this._createSource()},_createSource:function(){var c=this;if(b.isObject(this.options.source)){var d=[];b.forOwn(this.options.source,function(c,e){d.push(a.extend({value:c.value||c.label||e,label:c.label||c.value||c},b.isObject(c)?c:{}))}),this.options.source=d}this.options.source||(this.options.source=b.compact(this.element.find("option").map(function(){var b=a(this),c=b.attr("value");return!!c&&{value:c,label:b.text()}}).toArray())),b.isArray(this.options.source)&&(this.source=function(b,c){c(a.ted.filterable.filter(this.options.source,b.term),b)}),b.isString(this.options.source)&&(this.source=function(b,d){return b.term?(c._abort(),void(c._filterableLastQuery=a.ajax({url:this.options.source,data:{term:b.term},dataType:"json"}).done(function(a){d(a,b)}))):void d()}),b.isFunction(this.options.source)&&(this.source=this.options.source)},_setResults:function(a){this.options.results=b.map(a,function(a){return b.isObject(a)?a:{value:a,label:a}}).slice(0,this.options.max)},_response:function(a){this._setResults(a)},_setOption:function(a,b){this._super(a,b),"source"===a&&this._createSource()}}),a.extend(a.ted.filterable,{escapeRegex:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(b,c){if(c){var d=new RegExp(a.ted.filterable.escapeRegex(c),"i");return a.grep(b,function(a){return!!d.test(a.label||a.value||a)&&a})}}})}),define("jqueryui/position",["jquery"],function(a){return function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:d<0?"left":c>0?"right":"center",vertical:f<0?"top":e>0?"bottom":"middle"};n<l&&h(c+d)<n&&(i.horizontal="center"),p<m&&h(e+f)<p&&(i.vertical="middle"),g(h(c),h(d))>g(h(e),h(f))?i.important="horizontal":i.important="vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&j<=0?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):j>0&&i<=0?a.left=e:i>j?a.left=e+f-b.collisionWidth:a.left=e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&j<=0?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):j>0&&i<=0?a.top=e:i>j?a.top=e+f-b.collisionHeight:a.top=e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];k<0?(c=a.left+m+n+o+b.collisionWidth-g-f,(c<0||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];k<0?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(d<0||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,
c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&e<11,b.innerHTML="",c.removeChild(b)}()}(a),a}),define("widgets/popup",["jquery","lodash","jqueryui/widget","jqueryui/position"],function(a,b){"use strict";function c(a,b){this.element.removeClass(g).css(a).addClass(e+b.horizontal+" "+e+("center"===b.vertical?"middle":b.vertical))}for(var d=300,e="popup--tailed--",f=["center","left","middle","right","bottom","top"],g="",h=f.length;h--;)g+=e+f[h]+" ";return a.widget("ted.popup",{options:{position:{my:"center bottom-20",at:"center top",of:window,collision:"fit flip"},inverse:!1,tail:!0},_create:function(){this.options.position.using||(this.options.position.using=b.bind(c,this)),this.element.addClass("popup"+(this.options.tail?" popup--tailed":"")+(this.options.inverse?" popup--inverse":" inverse"))},_isOpen:!1,open:function(a){var b=this;b._trigger("beforeOpen",a)!==!1&&(b.position(),b._isOpen=!0,b.element.removeClass("popup--hide").addClass("popup--show"),b._trigger("open"))},close:function(a){var b=this,c=b.element;b._trigger("beforeClose",a)!==!1&&(b._isOpen=!1,c.addClass("popup--hide"),setTimeout(function(){b._isOpen||c.removeClass("popup--show")},d),b._trigger("close"))},position:function(){this.element.addClass("popup--positioning").position(this.options.position).removeClass("popup--positioning")}}),function(b,c){return a(b).popup(c)}}),define("lib/resize",["jquery","lodash","lib/pubSub"],function(a,b,c){"use strict";function d(a){for(var b,d=m;d--;)!b&&a>=l[d].at&&(b=l[d].its);c("sizeGroup").publishUnique(b)}function e(){var a=0,b=k;if(f=window.innerHeight,g=window.innerWidth||document.documentElement.clientWidth,j)a=i;else for(;b--;)!a&&g>=h[b]&&(a=h[b]);c("breakpoint").publishUnique(a),c("height").publishUnique(f),c("width").publishUnique(g)}var f,g,h=[320,480,600,768,1024,1200],i=1024,j=a("html").is(".oldie"),k=h.length,l=[{at:0,its:"oh"},{at:480,its:"xs"},{at:768,its:"sm"},{at:1024,its:"lg"}],m=l.length;return a(window).on("resize",b.throttle(e,100)),e(),c("breakpoint").subscribe(d),c}),define("widgets/combo",["jquery","lodash","hbs!templates/comboPopup","hbs!templates/comboList","hbs!templates/comboNoResults","lib/pubSub","spinjs","jqueryui/core","jqueryui/widget","widgets/filterable","widgets/popup","lib/resize"],function(a,b,c,d,e,f,g){"use strict";function h(){this.close()}function i(a,b){a.left=this.opener.position().left,this.popup.css(a),"top"===b.vertical?this.root.removeClass(n).addClass(m):this.root.removeClass(m).addClass(n)}function j(a,b){return{value:b,label:a}}var k="combo",l=k+"--open",m=k+"--dropped-up",n=k+"--dropped-down",o=k+"--with-results",p=k+"--no-results",q=k+"--with-defaults",r=k+"__opener",s=k+"__popup",t=k+"__link",u=t+"--active";a.widget("ted.combo",a.ted.filterable,{options:{defaults:null,defaultsLabel:null,listTempl:null,noResultsTempl:null,inputPlaceholder:null,results:null,source:null,max:5,position:{my:"left top-1px",at:"left bottom",collision:"none none"}},open:function(a){a&&a.preventDefault(),this._createPopup(),this.popup.width(this.opener.outerWidth()-2).popup("open"),this._isOpen=!0,this.root.addClass(l),this.input.focus()},clear:function(a){a&&a.preventDefault();var b=this.element.find('option:not([value]),option[value=""]').prop("selected",!0).text();this.label(b)},close:function(b){this._abort(),!this.popup||!this._isOpen||b&&a(b.target).closest(this.popup).length||b&&a(b.target).closest(this.opener).length||(b&&b.preventDefault(),this.popup.find("a."+u).removeClass(u),this.popup.popup("close"),this._isOpen=!1,this.root.removeClass(l))},collapse:function(){this.close(),this.opener.focus()},label:function(a){this.opener.text(a)},search:function(a){this.spinner||(this.spinner=new g({lines:9,length:2,width:2,radius:4,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:50,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"})),this.spinner.spin(this.indicator.get(0)),this._trigger("search",null,{term:a}),this._superApply(arguments)},_isOpen:!1,_clickItem:function(b){b.preventDefault(),this._select(a(b.target),b)},_create:function(){this.options.listTempl||(this.options.listTempl=d),this.options.noResultsTempl||(this.options.noResultsTempl=e),this.options.inputPlaceholder||(this.options.inputPlaceholder=this.element.data("combo-placeholder")||"Search…"),this._createSource(),this._search=b.throttle(b.bind(this._search,this),300),this._createOpener(),this.element.hide(),this.label(this.element.find("option:selected").text()),this._on(this.opener,{click:this.open}),this._on(document.body,{click:this.close}),f("width").subscribe(b.bind(h,this))},_createRoot:function(){this.root||(this.root=a("<span></span>").addClass(k).insertAfter(this.element))},_createOpener:function(){this.opener||(this._createRoot(),this.opener=a('<a href="#"></a>').addClass(this.element.attr("class")+" form-control form-control--dropdown "+r).appendTo(this.root))},_createPopup:function(){if(!this.popup){var d=a.extend({of:this.opener,using:b.bind(i,this)},this.options.position);if(this.options.defaults)b.isArray(this.options.defaults)||(this.options.defaults=b.map(this.options.defaults,j));else{var e=this.element.find("option").map(function(){var c=a(this),d=c.attr("value");return b.isEmpty(d)?null:{label:c.text(),value:d}}).toArray();this.options.defaults=b.compact(e)}null===this.options.defaultsLabel&&(this.options.defaultsLabel=this.element.find("optgroup").attr("label")),this.popup=a("<div></div>").addClass(s).html(c(this.options)).popup({inverse:!0,position:d,tail:!1}).appendTo(this.root),this.input=this.popup.find("input.combo__input"),this.results=this.popup.find("div.combo__results"),this.noResults=this.popup.find("div.combo__no-results"),this.defaults=this.popup.find("div.combo__defaults"),this.indicator=this.popup.find("div.combo__indicator"),this._renderDefaults(),this._on(this.popup,{"click a.combo__link":this._clickItem,"keydown input.combo__input":this._keyDown,"keyup input.combo__input":this._keyUp})}},_keyDown:function(b){var c=a.ui.keyCode;switch(b.keyCode){case c.TAB:b.preventDefault(),this.collapse()}},_keyUp:function(b){var c,d=a.ui.keyCode;switch(b.keyCode){case d.UP:this._move(-1);break;case d.DOWN:this._move(1);break;case d.ENTER:case d.NUMPAD_ENTER:b.preventDefault(),c=this.popup.find("a."+u),c.length&&(this._select(c,b),this.collapse());break;case d.LEFT:case d.RIGHT:break;default:this._search(b)}},_move:function(a){var b,c=this.popup.find("a."+t),d=c.filter("a."+u),e=c.index(d.get(0));c.removeClass(u),b=d.length?0===e&&a===-1?c.last():e===c.length-1&&1===a?c.first():c.eq(e+a):c.first(),b.addClass(u)},_renderDefaults:function(){this.options.defaults&&this.options.defaults.length?(this.defaults&&this.defaults.html(this.options.listTempl({items:this.options.defaults,label:this.options.defaultsLabel})),this.root.addClass(q)):this.root.removeClass(q)},_renderResults:function(a){this.options.results&&this.options.results.length?(this.results.html(this.options.listTempl({items:this.options.results})),this.root.addClass(o).removeClass(p)):a&&a.term?(this.noResults.html(this.options.noResultsTempl({request:a})),this.root.addClass(p).removeClass(o)):this.root.removeClass(o).removeClass(p)},_response:function(a,b){this.spinner.stop(),this._setResults(a),this._renderResults(b)},_search:function(b){this.search(a(b.target).val())},_select:function(a,b){var c=a.data("value"),d=this._getItem(c);this._setItem(d),this.label(d.label),this._trigger("change",b,{item:d,el:a}),this.close()},_getItem:function(a){return a+="",b.find(b.union(this.options.results,this.options.defaults),function(b){return""+b.value===a})},_setItem:function(b){var c=b.value+"",d=b.label+"";this.element.val(c),this.element.val()!==c&&(this._customOption||(this._customOption=a("<option>").appendTo(this.element)),this._customOption.text(d).attr("value",c),this.element.val(c))},_setOption:function(a,c){if(this._super(a,c),"defaults"===a&&this._renderDefaults(),"source"===a){this._createSource();var d=!0;b.isArray(this.options.source)&&(d=!b.where(c,{value:+this.element.val()}).length),d&&this.clear(),this.input&&this.input.val(""),this.results&&(this.options.results=null,this._renderResults())}}})}),define("views/FiltersView",["jquery","lodash","Backbone","templates/helpers/stub","lib/pubSub","utils/is_mobile","jqueryui/core","widgets/combo","lib/resize"],function(a,b,c,d,e,f){"use strict";function g(a){a.length&&a[0].which&&a[0].preventDefault()}function h(a){q.animate({scrollTop:a.offset().top},200)}function i(a){return b.flatten(b.map(a,function(a,c){return b.isArray(a)?b.map(a,function(a){return d(a.label,c,a.value)}):d(a.label,c,a.value)})).join(" ")}function j(a){a.data("tedCombo")?a.combo("clear"):(a.val(""),a.find('option:not([value]),option[value=""]').filter("option:not([disabled])").prop("selected",!0))}function k(a,b){a.val(b.value),a.data("tedCombo")&&a.combo("label",b.label)}function l(){return e("breakpoint").read()<768}var m="filters",n=m+"--open",o=m+"--stubbed",p=m+"__filter__stubs",q=a("html,body"),r=c.View.extend({events:{"change select.filters__sort__select":"updateModel","keydown input.filters__filter__input":"_keyDown","keyup input.filters__filter__input":"_keyUp","change select.filters__filter__select":"_setFilter","autocompletechange input.filters__filter__autocomplete":"_setFilter","combochange select.filters__filter__combo":"_setFilter","change input.filters__filter__checkbox":"_toggleCheckbox","click .filters__filter__setter":"_clickFilterSetter","click .filters__apply":"_clickApply","click .filters__clear":"clearFilters","click a.stub__remove":"_removeStub","click div.filters__opener":"toggleOpen"},applyFilters:function(){g(arguments),this.updateModel()},clearFilters:function(){g(arguments),this.$el.removeClass(n),this.$filters.each(function(){j(a(this))}),this._filters={},this.updateModel(),l()&&h(this.$el)},initialize:function(a){b.assign(this._options,a||{}),this._filters={}},setFilter:function(a){var c=a.name,d=a.value,e=a.label,f=a.isMultiple||!1;if(b.isEmpty(d))f||this.removeFilter(c,d);else{var g={value:d,label:e};if(f){var h=this._filters[c]||[];h.push(g),h=b.uniq(h,"value"),this._filters[c]=h}else this._filters[c]=g}l()&&this.renderStubs(),this.applyFilters()},removeFilter:function(a,c){var d=!b.isArray(this._filters[a]);return d||(this._filters[a]=b.reject(this._filters[a],function(a){return a.value===c}),d=!this._filters[a].length),d&&delete this._filters[a],l()?void this.renderStubs():void(b.isEmpty(this._filters)?this.clearFilters():this.applyFilters())},render:function(){var c,d=this,f=d._options.sources||{};return d.$filters=d.$el.find("input.filters__filter__input, select.filters__filter__select, select.filters__filter__combo, input.filters__filter__autocomplete"),d.$stubs=d.$el.find("div.filters__active__stubs"),d.$filterStubs=d.$filters.after("<div class="+p+"></div>").next("div."+p),d.$filters.filter("select.filters__filter__combo").each(function(){var b=a(this),c=b.attr("name");b.combo({source:f[c]||null})}),e("breakpoint").subscribe(function(a){var e=a<768;c!==e&&(c=e,d._setFieldsFromFilters(),e||b.isEmpty(this._filters)||this.applyFilters())}),d._setFilters(),this.listenTo(this.model,"change",this._updatedModel),d},renderStubs:function(){var a=this._filters,c=!b.isEmpty(this._filters),d=this,e=d.$stubs.find("a.filters__clear").remove();return d.$stubs.empty(),d.$filterStubs.empty(),d.$el[c?"addClass":"removeClass"](o),c?(b.forOwn(d._filters,function(a,c){var e={};b.isArray(a)&&(e[c]=a,d.$filters.filter("[name="+c+"]").nextAll("div."+p).html(i(e)))}),void d.$stubs.append(i(a)).append(e)):void d.$stubs.append(e)},toggleOpen:function(){g(arguments),this.$el.toggleClass(n)},updateModel:function(){var a=b.cloneDeep(this._filters),c=this._getSortValue();c&&(a.sort=c);var d=this.model.toJSON();b.extend(a,b.pick(d,this._options.stubless)),this.model.unsetAllExcept(b.keys(a)).set(a)},_options:{stubless:[]},_clickApply:function(a){a.preventDefault(),this.applyFilters(),l()&&h(this.$el.find(".filters__bottom"))},_clickFilterSetter:function(b){b.preventDefault(),b.target=a(b.target).closest(".filters__filter").find([".filters__filter__input",".filters__filter__select",".filters__filter__autocomplete",".filters__filter__combo",".filters__filter__checkbox"].join(", ")).first().get(0),this._setFilter(b)},_getSortValue:function(){return this.$el.find("select.filters__sort__select").find("option:selected").attr("value")},_keyDown:function(b){var c=a.ui.keyCode;switch(b.keyCode){case c.TAB:this._setFilter(b)}},_keyUp:function(b){var c=a.ui.keyCode;switch(b.keyCode){case c.ENTER:case c.NUMPAD_ENTER:b.preventDefault(),this._setFilter(b),(l()||f())&&a(b.target).hasClass("filters__filter__input")&&(a(b.target).blur(),this._clickApply(b))}},_removeStub:function(b){g(arguments);var c=a(b.target).closest("span.stub");this.removeFilter(c.data("name"),c.data("value"))},_setFieldsFromFilters:function(){var c=e("breakpoint").read()<768,d=this;d.$filters.each(function(){var e=a(this),f=d._filters[e.attr("name")];c&&f&&!b.isArray(f)?k(e,f):j(e)})},_toggleCheckbox:function(b){var c=a(b.target),d=c.closest("label"),e=c.attr("name"),f=c.attr("value");c.is(":checked")?this._filters[e]={value:f,label:d.text().trim()}:this.removeFilter(e,f),l()?this.renderStubs():this.applyFilters()},_setFilter:function(b){var c=a(b.target),d=c.find("option:selected"),e=c.attr("name"),f=!!c.data("filter-multiple"),g=d.text(),h=d.attr("value");d.length||(g=h=c.val()),d.hasClass("modalized-select__custom-option")&&d.remove(),l()&&!f||j(c),this.setFilter({name:e,value:h,label:g,isMultiple:f})},_setFilters:function(){var c,d={};c=this.$filters.filter("select[data-filter-multiple=true]").map(function(){return this.name}).toArray(),this.$stubs.find("span.stub").each(function(){var e,f=a(this),g=f.data("name"),h=f.data("value");e={label:f.find("span.stub__label").text(),value:h},b.contains(c,g)?(d[g]=d[g]||[],d[g].push(e)):d[g]=e}),this._filters=d,this.renderStubs();var e=this.model.toJSON();b.extend(d,b.pick(e,this._options.stubless));var f=this._getSortValue();f&&(d.sort=f),this.model.set(d)},_updatedModel:function(){this._filters=b.omit(this.model.toJSON(),b.union(["sort"],this._options.stubless)),this._setFieldsFromFilters(),this.renderStubs()}});return r}),define("Modernizr",[],function(){"use strict";return window.Modernizr}),define("views/ResultsView",["jquery","lodash","Modernizr","Backbone","spinjs"],function(a,b,c,d,e){"use strict";function f(){return window.location.pathname+window.location.search}var g="results",h=g+"--loading",i=d.View.extend({events:{"click div.pagination a":"clickPage"},initialize:function(d){b.assign(this,d||{}),this._beforeSend=b.bind(this._beforeSend,this),this._popState=b.bind(this._popState,this),this.filtersModel&&this.listenTo(this.filtersModel,"change",this._updatedModel),c.history&&window.history.replaceState(this._getState(),null,f()),a(window).on("popstate",this._popState)},clickPage:function(b){b.preventDefault(),window.scroll(0,this.$el.offset().top-60),this.fetch({beforeSend:this._beforeSend,url:a(b.target).attr("href")})},endLoadingState:function(){this.getSpinner().stop(),this.$el.removeClass(h)},fetch:function(c){return this.$el.empty().addClass(h),this.getSpinner().spin(this.$el.get(0)),a.ajax(c).always(b.bind(this.endLoadingState,this)).then(b.bind(this.renderResult,this),b.bind(this.renderError,this))},fetchFresh:function(){var a=this.filtersModel.toValues(),b=window.location.pathname;return this.fetch({beforeSend:this._beforeSend,data:a,url:b})},getSpinner:function(){return this._spinner||(this._spinner=new e({className:"spinner spinner--centered"})),this._spinner},render:function(a){this.$el.html(a)},renderError:function(){this.render("<p class=p1>There was an error.</p>")},renderResult:function(b){this.render(a(b).find("#"+this.$el.attr("id")).html())},_suppressRefresh:!1,_beforeSend:function(a,b){b.url!==f()&&(this.trigger("loadUrl",b.url),c.history&&window.history.pushState(this._getState(),null,b.url))},_getState:function(){return{filters:this.filtersModel.toJSON()}},_popState:function(a){var b=a.originalEvent.state;b&&b.filters&&(this._suppressRefresh=!0,this.filtersModel.clear().set(b.filters),this._suppressRefresh=!1,this.fetch({url:window.location.href}))},_updatedModel:function(){this._suppressRefresh||this.fetchFresh()}});return i}),define("search/browse",["jquery","lodash","Backbone","models/Filters","views/FiltersView","views/ResultsView","exports"],function(a,b,c,d,e,f,g){"use strict";function h(a){var c=new d,f=new e(b.extend({el:document.getElementById("filters"),model:c},a));f.render(),g.filtersModel=c,g.filtersView=f}function i(){var a=new f({el:document.getElementById("browse-results"),filtersModel:g.filtersModel});g.resultsView=a}g.init=function(a){h(a),i()}}),define("search/results",["jquery","exports"],function(a,b){"use strict";b.init=function(){window.g("mainNav.addSubmenuToHamburger")}}),define("deferLink",["jquery"],function(a){"use strict";function b(a){return function(b){return c.call(this,b,a)}}function c(b,c){function d(){var a=+e.data(h)-1;e.data(h,a),a<=0&&!e.data(j)&&(e.removeData(i),k.location.href=l)}var e="A"===this.nodeName?a(this):a(b.target).closest("a"),l=e.attr("href"),m=e.attr("target"),n=e.length&&l&&1===b.which&&!b.metaKey&&!b.shiftKey,o=c;if(a.isFunction(c)&&(o=c.call(this,b),o===!1))return!1;n&&b.isDefaultPrevented()&&!e.data(h)&&(n=!1),n&&m&&"_self"!==m&&(n=!1),n&&g&&e.is("[download]")&&(n=!1),n&&e.hasClass(f)&&(n=!1);var p=+(e.data(h)||0);n&&(e.data(h,p+1),o.when?("resolved"===o.state()&&d(),o.done(d)):a.isNumeric(o)?k.setTimeout(d,o):(n=!1,e.data(h,p))),n&&!p&&(b.preventDefault(),e.data(i,!0))}function d(d){return d.when||a.isNumeric(d)||a.isFunction(d)?b(d):void c.call(this,d,e)}var e=50,f="no-defer",g="download"in document.createElement("a"),h="defer-link-pends",i="defer-link-preventable",j="defer-link-prevented",k=window,l=a.Event.prototype.preventDefault;return a.Event.prototype.preventDefault=function(){var b=a(this.target);return b.data(i)&&b.data(j,!0),l.apply(this,Array.prototype.slice.call(arguments))},d}),define("utils/ted",[],function(){"use strict";var a=function(){var a=window.navigator,b=a?a.userAgent.toLowerCase():"";if(b.indexOf("chrome")!==-1)return!1;var c=b.match(/macintosh.*os x.*applewebkit.*version\/([\d]+).*safari/);return!!c&&!(+c[1]<7)};return function(b){return window.TED?"playerPath"===b?a()?window.TED.playerPathLocal:window.TED.playerPathRemote:window.TED[b]:""}}),define("lib/browserDetect",["exports"],function(a){"use strict";function b(a){for(var b=0;b<a.length;b++){var c=a[b].string,e=a[b].prop;if(d=a[b].versionSearch||a[b].identity,c){if(c.indexOf(a[b].subString)!==-1)return a[b].identity}else if(e)return a[b].identity}}function c(a){var b=a.indexOf(d);if(b!==-1)return parseFloat(a.substring(b+d.length+1))}var d,e=window.navigator,f=[{string:e.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:e.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"}];a.browser=b(f)||"Unknown Browser",a.version=c(window.navigator.userAgent)||c(window.navigator.appVersion)||"Unknown Version"}),function(a){"use strict";var b=function(a,c,d){return 1===arguments.length?b.get(a):b.set(a,c,d)};b._document=document,b._navigator=navigator,b.defaults={path:"/"},b.get=function(a){return b._cachedDocumentCookie!==b._document.cookie&&b._renewCache(),b._cache[a]},b.set=function(c,d,e){return e=b._getExtendedOptions(e),e.expires=b._getExpiresDate(d===a?-1:e.expires),b._document.cookie=b._generateCookieString(c,d,e),b},b.expire=function(c,d){return b.set(c,a,d)},b._getExtendedOptions=function(c){return{path:c&&c.path||b.defaults.path,domain:c&&c.domain||b.defaults.domain,expires:c&&c.expires||b.defaults.expires,secure:c&&c.secure!==a?c.secure:b.defaults.secure}},b._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},b._getExpiresDate=function(a,c){switch(c=c||new Date,typeof a){case"number":a=new Date(c.getTime()+1e3*a);break;case"string":a=new Date(a)}if(a&&!b._isValidDate(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a},b._generateCookieString=function(a,b,c){a=encodeURIComponent(a),b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),c=c||{};var d=a+"="+b;return d+=c.path?";path="+c.path:"",d+=c.domain?";domain="+c.domain:"",d+=c.expires?";expires="+c.expires.toGMTString():"",d+=c.secure?";secure":""},b._getCookieObjectFromString=function(c){for(var d={},e=c?c.split("; "):[],f=0;f<e.length;f++){var g=b._getKeyValuePairFromCookieString(e[f]);d[g.key]===a&&(d[g.key]=g.value)}return d},b._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("=");return b=b<0?a.length:b,{key:decodeURIComponent(a.substr(0,b)),value:decodeURIComponent(a.substr(b+1))}},b._renewCache=function(){b._cache=b._getCookieObjectFromString(b._document.cookie),b._cachedDocumentCookie=b._document.cookie},b._areEnabled=function(){return b._navigator.cookieEnabled||"1"===b.set("cookies.js",1).get("cookies.js")},b.enabled=b._areEnabled(),"function"==typeof define&&define.amd?define("Cookies",[],function(){return b}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Cookies=b):window.Cookies=b}(),define("lib/currentUserId",["Cookies"],function(a){"use strict";var b="_ted_user_id";return{get:function(){return a.get(b)}}}),define("lib/errorCollector",["jquery","lodash","lib/browserDetect","lib/currentUserId","utils/ted","exports"],function(a,b,c,d,e,f){"use strict";f.post=b.throttle(function(b){a.post("https://error-collector.ted.com/",{message:b})},5e3),f.log=function(b,g){g=a.extend({error:!0,message:b,context:"js",uri:window.location.href,client_name:c.browser,client_version:c.version,elapsed_seconds:Math.floor((+new Date-e("startTime"))/1e3),profile_id:d.get()||"N/A",user_agent:window.navigator?window.navigator.userAgent:"Unknown User Agent"},g||{}),f.post(g),console&&console.log&&console.error&&console[g.error?"error":"log"](b,g)}}),define("lib/ga-cookie",["Cookies"],function(a){"use strict";var b="_ga",c={};return c.get=function(){return a.get(b)},c.getClientId=function(){var a=String(c.get()),b=a.split(".")[2]+"."+a.split(".")[3];return b.indexOf("undefined")===-1?b:void 0},c}),define("lib/ga",["jquery","lodash","deferLink","utils/ted","lib/errorCollector","lib/ga-cookie","lib/currentUserId","lib/pubSub","lib/resize"],function(a,b,c,d,e,f,g,h){"use strict";function i(){(o[o.GoogleAnalyticsObject]||a.noop).apply(o,n.slice.call(arguments))}function j(){var a=n.slice.call(arguments),d=this;return function(e){if(d.apply(i,a),b.has(e,"originalEvent")&&b.has(this,"nodeName")&&"click"===e.type)return c.call(this,e)}}function k(){var a,b=0;h("breakpoint").subscribe(function(c){i.setDimension("breakpoint",c),b++&&i.sendEvent("breakpoint","change",a+"|"+c,b),a=c})}function l(){var a=f.getClientId();a&&i.setDimension("gaClientId",a);var b=g.get();b&&i.setDimension("tedUserId",b),h("auth.login").subscribe(function(a){i.setDimension("tedUserId",a.id)})}function m(b){var c=a(this),d="ga-";b=a.extend(b||{},{category:c.data(d+"category"),action:c.data(d+"action"),label:c.data(d+"label")}),i.sendEvent(b.category,b.action,b.label)}var n=[],o=window;return b.assign(i,{send:b.partial(i,"send"),set:b.partial(i,"set"),sendEvent:b.partial(i,"send","event"),sendSocial:b.partial(i,"send","social"),sendNonInteraction:b.partialRight(b.partial(i,"send","event"),{nonInteraction:1})},function(a,b){return b.recall=j,b}),i.sendTiming=function(a,c,f,g){if(b.isUndefined(f)&&(f=new Date),f&&f.constructor===Date){var h=d("headReady");if(h&&h.constructor!==Date)return void e.log("GA: headReady timing is missing");f=+f-+h}i("send","timing",a,c,f,g)},i.setDimension=function(a,b){var c=String(a);c.match(/^dimension\d+$/)||(c=(d("gaDimensions")||{})[c]),c?i.set(c,b):e.log('GA: missing dimension: "'+a+'"')},i.virtualPageview=function(a){i.set("page",a+(a.indexOf("?")===-1?"?":"&")+"vp"),i.send("pageview")},k(),l(),i.send("pageview"),i.sendTiming("performance","scriptReady"),a(function(){a(document).on("click","a.ga-link",c(function(){return m.call(this,{action:"click",category:"site.link",label:this.href}),50}))}),i}),define("components/main-nav/components/popups/views/popup",["Backbone","jqueryui/core"],function(a){"use strict";return a.View.extend({events:{keydown:"_onKeyDown",keyup:"_onKeyUp"},isOpen:!1,_onKeyDown:function(a){if(a.keyCode===$.ui.keyCode.TAB){var b=this.$el.find(":tabbable"),c=a.target,d=b.filter(":first").get(0),e=c===d&&a.shiftKey,f=b.filter(":last").get(0),g=c===f&&!a.shiftKey;(e||g)&&this.hide()}},_onKeyUp:function(a){a.keyCode===$.ui.keyCode.ESCAPE&&this.hide()},hide:function(){this.isOpen=!1,this.$el.attr("aria-hidden","true"),this.trigger("hide"),this.$el.removeClass("Main-nav/Popper__popup--visible").addClass("Main-nav/Popper__popup--hidden")},show:function(){this.isOpen=!0,this.$el.attr("aria-hidden","false"),this.trigger("show"),this.$el.removeClass("Main-nav/Popper__popup--hidden").addClass("Main-nav/Popper__popup--visible")}})}),define("components/main-nav/lib/screen-size",["lodash","lib/resize"],function(a,b){"use strict";function c(b,c){return function(){b()&&c.apply(this,a.toArray(arguments))}}function d(){return b("breakpoint").read()<1024}function e(){return!d()}return{isSmall:d,isBig:e,ifSmall:a.partial(c,d),ifBig:a.partial(c,e)}}),define("components/main-nav/components/popups/views/popper-bar",["Backbone","../../../lib/screen-size"],function(a,b){"use strict";return a.View.extend({events:{"click *[data-popper-target]":"_clickPopperTarget","mouseenter *[data-popper-root]":"_hoverPopperRoot","mouseleave *[data-popper-root]":"_unhoverPopperRoot"},_trigger:function(a,b,c){this.trigger(a,b,c.data("popper-name"),c)},_clickPopperTarget:b.ifBig(function(a){var b=$(a.currentTarget).closest("*[data-popper-root]");a.preventDefault(),this._trigger("pop",a,b)}),_hoverPopperRoot:b.ifBig(function(a){this._trigger("pop",a,$(a.currentTarget))}),_unhoverPopperRoot:b.ifBig(function(a){this._trigger("unpop",a,$(a.currentTarget))})})}),define("components/main-nav/components/popups/views/smoke",["Backbone"],function(a){"use strict";return a.View.extend({_isOpen:!1,initialize:function(){var a=this;a._hide=function(){a._isOpen||a.$el.removeClass("Main-nav/Popper__smoke--visible").addClass("Main-nav/Popper__smoke--hidden")}},hide:function(){this._isOpen=!1,window.setTimeout(this._hide,100)},show:function(){this._isOpen=!0,this.$el.removeClass("Main-nav/Popper__smoke--hidden").addClass("Main-nav/Popper__smoke--visible")}})}),define("components/main-nav/components/popups/index",["lodash","./views/popup","./views/popper-bar","./views/smoke"],function(a,b,c,d){"use strict";function e(b){a.forOwn(a.omit(h.popups,b),function(a){a.hide()})}function f(){var b;a.forOwn(h.popups,function(a){b=b||a.isOpen}),i()[b?"show":"hide"]()}function g(a,c){var d=h.popups[a];return d&&d instanceof b||(d=h.popups[a]=new b({el:c.find(".Main-nav\\/Popper__popup")}),d.on("hide",function(){f()}),d.on("show",function(){e(a),f()})),d}var h={};h.popups={};var i=a.once(function(){var a=new d({el:document.getElementById("main-nav-popper-smoke")});return a.render(),a});return h.init=function(){var a=new c({el:document.getElementById("main-nav")});a.render(),h.popperBar=a,a.on("pop",function(a,b,c){g(b,c).show()}),a.on("unpop",function(a,b,c){g(b,c).hide()})},h}),define("components/accordion/index",["lodash","Backbone"],function(a,b){"use strict";var c="Accordion__item",d="Accordion__content",e="Accordion__item--open";return b.View.extend({events:{"click .Accordion__opener":"_clickAccordionOpener"},_clickAccordionOpener:function(a){a.preventDefault();var b=$(a.target).closest("."+c);b.closest(".Accordion").find("."+c).not(b).removeClass(e).find("."+d).slideUp(150);var f=b.hasClass(e);b[f?"removeClass":"addClass"](e).find("."+d)[f?"slideUp":"slideDown"](150);var g=b.data("accordion-item-name");this.trigger("accordion-"+(f?"close":"open"),a,g)}})}),define("lib/focus-zone",["jquery","lodash","jqueryui/core"],function(a,b){"use strict";function c(b){this.$el=a(b)}function d(a){a.preventDefault()}var e=a(window);return c.__reset=function(){b.assign(c,{__active:void 0,__isListening:!1,__zones:[]})},c.__addZone=function(a){c.__zones.push(a),c.__setActive(),c.__startListening()},c.__removeZone=function(a){c.__zones=b.without(c.__zones,a),c.__setActive(),c.__stopListening()},c.__setActive=function(){c.__active=b.last(c.__zones)},c.__startListening=function(){c.__isListening||c.__active&&(c.__startListeningInner(),c.__isListening=!0)},c.__startListeningInner=function(){e.on("keydown",c.__keyDown)},c.__stopListening=function(){c.__isListening&&(c.__active||(c.__stopListeningInner(),c.__isListening=!1))},c.__stopListeningInner=function(){e.off("keydown",c.__keyDown)},c.__keyDown=function(e){var f=c.__active;if(f&&e.keyCode===a.ui.keyCode.TAB){var g=e.target,h=f.$el,i=h.find(":tabbable"),j=i.filter(":first"),k=i.filter(":last");g!==k[0]&&g!==h[0]||e.shiftKey?g!==j[0]&&g!==h[0]||!e.shiftKey?b.indexOf(i,g)===-1&&(j.focus(),d(e)):(k.focus(),d(e)):(j.focus(),d(e))}},b.assign(c.prototype,{activate:function(){return this._recordFocus(),c.__addZone(this),this},deactivate:function(){return c.__removeZone(this),this._restoreFocus(),this},_recordFocus:function(){this.$focus=a(":focus")},_restoreFocus:function(){this.$focus&&this.$focus.length&&this.$focus.focus()}}),c.__reset(),c}),define("lib/shoji",["jquery","lodash","Modernizr","lib/focus-zone","lib/resize","utils/throwError"],function(a,b,c,d,e,f){"use strict";function g(b){var c=a(b);return c.hasClass(r)||(c=c.closest("div."+r)),c.length||f("Could not find fixture "+b),c}function h(){n.removeClass(s+" "+t)}function i(){v(),a(document.activeElement).blur(),n.removeClass(s+" "+t)}function j(c,d){var e=a("<div class="+r+">"),f={};return b.defaults(f,d,{at:"left"}),v(),e.addClass(r+"--"+f.at),e.data("at",f.at),e.append(c),e.appendTo(o),e}function k(){return v(),c.csstransforms3d&&p>=320}function i(){v(),h(),q.deactivate()}function l(a){var b=g(a);v(),o.children().removeClass(u),b.addClass(u),m(b.data("at")),q.activate()}function m(a){h(),n.addClass("shoji--opened shoji--"+a)}var n,o,p,q,r="shoji__fixture",s="shoji--left",t="shoji--right",u=r+"--revealed",v=b.once(function(){n=a("#shoji"),o=a("#shoji-fixtures"),q=new d(o),a("#shoji-lattice").on("click",function(){return i(),!1}),a('<a class="shoji__closer" href="#" role="button" tabindex="0"><div class="shoji__closer__label">Close</div></a>').on("click",function(a){a.preventDefault(),i()}).appendTo(o),e("breakpoint").subscribe(function(a){p=a})});return{_getFixture:g,_init:v,addFixture:j,canSlide:k,concealFixture:i,revealFixture:l,slide:m}}),define("components/main-nav/components/slideout/views/shoji-fixture",["lodash","Backbone","lib/shoji"],function(a,b,c){"use strict";return b.View.extend({fixture:null,isShoji:!1,shojiOpenAt:"left",_renderForShoji:function(){this.fixture=c.addFixture(this.$el.detach(),{at:this.shojiOpenAt}),this.isShoji=!0},hide:function(){return this.isShoji?c.concealFixture():this.$el.hide(),this.trigger("hide"),this},show:function(){return this.isShoji?c.revealFixture(this.fixture):this.$el.show(),this.trigger("show"),this},render:function(){return c.canSlide()?this._renderForShoji():this.$el.hide(),this}})}),define("components/main-nav/components/slideout/components/drilldown/models/screen",["Backbone"],function(a){"use strict";return a.Model.extend({defaults:{tense:"present"}})}),define("components/main-nav/components/slideout/components/drilldown/views/screen",["lodash","Backbone"],function(a,b){"use strict";var c={present:"Drilldown-screen--present",
past:"Drilldown-screen--past",future:"Drilldown-screen--future"},d=a.values(c).join(" ");return b.View.extend({className:"Drilldown-screen",initialize:function(a){this.setContent(a.content),this.listenTo(this.model,"change:tense",this.renderTense)},renderTense:function(){this.$el.removeClass(d).addClass(c[this.model.get("tense")])},render:function(){return this.rendered||(this.rendered=!0,this.setContent()),this.renderTense(),this},setContent:function(a){a&&(this.content=a),this.rendered&&this.content&&(this.content.render(),this.$el.append(this.content.$el))}})}),define("components/main-nav/components/slideout/components/drilldown/index",["Backbone","./models/screen","./views/screen"],function(a,b,c){"use strict";return a.View.extend({events:{"click a[data-drilldown]":"_clickDrilldownLink"},rendered:!1,_clickDrilldownLink:function(a){a.preventDefault();var b=$(a.target),c=b.data("drilldown")||b.attr("href");"back"===c?this.openPrimary():this.secondaries[c]?this.openSecondary(this.secondaries[c]):this.trigger("spawn",this.addSecondary(c))},initialize:function(){this.primary=this.createScreen(),this.secondaries={}},render:function(){return this.rendered||(this.renderScreen(this.primary),_.forOwn(this.secondaries,_.bind(this.renderScreen,this)),this.rendered=!0),this},renderScreen:function(a){a&&(a.render(),this.$el.append(a.$el))},createScreen:function(a){return new c({model:new b,content:a})},setPrimary:function(a){this.primary.content=a,this.rendered&&this.renderScreen(this.primary)},addSecondary:function(a,b){var c=this.createScreen(b);return c.model.set("id",a),this.secondaries[a]=c,this.rendered?(c.model.set("tense","future"),this.renderScreen(c),this.openSecondary(c)):this.primary.model.set("tense","past"),c},openPrimary:function(){var a=this;_.defer(function(){a.primary.model.set("tense","present"),_.forOwn(a.secondaries,function(a){a.model.set("tense","future")})})},openSecondary:function(a){$("body").animate({scrollTop:0},200);var b=this;_.defer(function(){b.primary.model.set("tense","past"),a.model.set("tense","present")})}})}),define("components/main-nav/components/slideout/index",["lodash","components/accordion/index","./views/shoji-fixture","./components/drilldown/index"],function(a,b,c,d){"use strict";return c.extend(b.prototype).extend({initialize:function(){this.render=a.once(this.render),this.drilldown=new d,this.drilldown.on("spawn",this.onSpawn,this)},onSpawn:function(a){this.trigger("spawn",a)},render:function(){return c.prototype.render.call(this),this.drilldown.render(),this.$el.append(this.drilldown.$el),this},setPrimary:function(a){this.drilldown.setPrimary(a)},addSecondary:function(a,b){this.drilldown.addSecondary(a,b)}})}),define("components/main-nav/lib/menu-parser",["lodash","jquery"],function(a,b){"use strict";function c(a){var c=a.find("h3.submenu__heading");if(c.length)return{label:b.trim(c.text()),url:c.find("a").attr("href")||"#"}}function d(a){var c=[];return a.find("ul.submenu__list:first > li.submenu__item").each(function(){var a=b(this),e=a.find("a.submenu__link:first"),f={label:b.trim(e.text()),url:e.attr("href")||"#"},g=d(a);g.length&&(f.items=g),c.push(f)}),c}function e(b){return a.filter(a.union([c(b)],d(b)))}function f(a){var c=new b.Deferred;return b.ajax({url:a,xhrFields:{withCredentials:!0}}).then(function(a){c.resolve(e(b(a).find("#submenu")))},function(){c.reject()}),c.promise()}return{parse:e,load:f}}),define("lib/personalStorage",["lodash","Modernizr","exports","lib/currentUserId"],function(a,b,c,d){"use strict";function e(b,d){var e=a.toArray(arguments);return!!c.storageAdapter&&(e[1]=c.getKey(d),b.apply(c.storageAdapter,e.slice(1)))}c.storageAdapter=b.localstorage?window.localStorage:void 0,c.getKey=function(a){var b=d.get();return b||(b="0"),b+"-"+a},c.getItem=a.wrap(function(a){return c.storageAdapter.getItem(a)},e),c.setItem=a.wrap(function(a,b){c.storageAdapter.setItem(a,b)},e),c.removeItem=a.wrap(function(a){c.storageAdapter.removeItem(a)},e)}),define("lib/currentUser",["jquery","lodash","lib/currentUserId","lib/personalStorage"],function(a,b,c,d){"use strict";function e(a){return b.isFinite(a)?+a:null}function f(a){return a?""+a:null}function g(a){return a=b.pick(a,z),b.forOwn(a,function(b,c){a[c]=y[c](b)}),a}function h(a){return a&&JSON.parse(a)}function i(){return g(h(v.storageAdapter.getItem(w)))}function j(){return a.ajax({dataType:"json",url:"/me",data:{c:c.get()+"-"+Math.round(+new Date/1e3/120)},timeout:3e3})}function k(){r=null,v.storageAdapter.removeItem(w),a(document.documentElement).removeClass("loggedin").addClass("loggedout")}function l(a){k(),a.reject()}function m(){return v._check(r)}function n(a){var b=m();return b?a.resolve(r):(k(),a.reject()),b}function o(a,b){if(!b)return void l(a,b);if(b.unavailable&&b.unavailable.length)for(var c=i(),d=b.unavailable,e=d.length;e--;)b[d[e]]=c[d[e]]||b[d[e]];b.lastDownloaded=(new Date).getTime(),r=g(b),n(a)&&v.storageAdapter.setItem(w,JSON.stringify(r))}function p(a){j().then(b.bind(o,v,a),b.bind(l,v,a))}function q(a,b){var c=(new Date).getTime();return c-(b||0)<a}var r,s=function(a){return!!a},t=function(a){return a},u=a.Deferred,v={},w="me",x=!0,y={id:e,profileId:e,firstName:f,lastName:f,avatarUrl:f,hasConferences:s,upcomingConferences:t,isCommentModerator:s,hasEdActivity:s,isTEDxOrganizer:s,lastDownloaded:e},z=b.keys(y);return v.storageAdapter=d,v.getDetails=function(){var a=new u;return r=r||i(),m()||(r=null),r?(a.resolve(r),x&&!q(18e4,r.lastDownloaded)&&(x=!1,p(new u))):c.get()?p(a):a.reject(),a.promise()},v._check=function(a){var d=864e5;return a&&+a.id===+c.get()&&z.length===b.keys(b.pick(a,z)).length&&q(d,a.lastDownloaded)},v._reset=function(){r=void 0,x=!0},v}),define("components/main-nav/lib/current-user",["Backbone","lib/pubSub","lib/currentUser"],function(a,b,c){"use strict";function d(a){e.set(a)}var e=new a.Model;return c.getDetails().done(d),b("auth.login").subscribe(d),e}),define("components/main-nav/views/account-button",["Backbone","../lib/current-user","lib/pubSub"],function(a,b,c){"use strict";return a.View.extend({initialize:function(){this.listenTo(b,"change",this.render)},render:function(){if(b.get("id")){var a=b.get("avatarUrl");this.$el.find("div.Main-nav__account-button__avatar").css("background-image","url("+a+")"),this.renderBadge()}},renderBadge:function(){function a(){e.removeClass("Main-nav__account-button__badge--bouncing")}function b(){e.addClass("Main-nav__account-button__badge--visible").addClass("Main-nav__account-button__badge--bouncing"),window.setTimeout(a,600)}function d(){e.removeClass("Main-nav__account-button__badge--visible")}var e=this.$el.find("div.Main-nav__account-button__badge");c("favorite.add").subscribe(b),c("watchLater.add").subscribe(b),c("watchLater.remove").subscribe(d)}})}),define("components/main-nav/config",["utils/ted"],function(a){"use strict";return{urls:{yourList:"/dashboard/list",favorites:"/dashboard/favorites",watchHistory:"/dashboard/history",conferences:"/dashboard/conferences",tedEdHistory:"https://ed.ted.com/activity/lessons",tedXEvents:"https://tedx-apply.ted.com/manage",confBadge:"/dashboard/conferences/badge",confContact:"/dashboard/conferences/contact",settings:a("settingsUrl"),profile:"/profile",logOut:a("signOutUrl")}}}),define("components/main-nav/lib/menu-builder",["lodash"],function(a){"use strict";function b(b){return a.filter(b)}function c(c,d,e){var f=a.extend({condition:!0,external:!1,label:c,url:d,items:null},e||{});if(a.isArray(d)&&(f.items=b(d),f.url=void 0),f.condition)return f}return{item:c,list:b}}),define("hbs!components/main-nav/templates/account-popup-menu",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){var e,f;return'    <li>\n      <a\n        class="\n          Main-nav__fs-1\n          hover/bg:gray-ll\n          f-w:700\n          d:b\n          p-x:4\n          p-y:.7\n          undec\n        "\n        href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'"\n        '+(null!=(e=b.if.call(a,null!=a?a.external:a,{name:"if",hash:{},fn:this.program(2,d,0),inverse:this.noop,data:d}))?e:"")+"\n      >"+this.escapeExpression((f=null!=(f=b.label||(null!=a?a.label:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"label",hash:{},data:d}):f))+"</a>\n    </li>\n"},2:function(a,b,c,d){return'target="_blank"'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<div class="\n    b-b\n    b:black.9\n    p-x:4\n    p-y:.8\n  "\n>\n  <div class="Main-nav__fs-6 f-w:700">Hi, '+this.escapeExpression((f=null!=(f=b.userName||(null!=a?a.userName:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"userName",hash:{},data:d}):f))+'</div>\n</div>\n\n<ul class="\n    b-b\n    b:black.9\n    sl\n  "\n>\n'+(null!=(e=b.each.call(a,null!=a?a.menuItems:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+'</ul>\n\n<div>\n  <a\n    class="\n      hover/bg:gray-ll\n      d:b\n      f-w:700\n      p-x:4\n      p-y:2\n      Main-nav__fs-1\n      undec\n    "\n    href="'+this.escapeExpression(this.lambda(null!=(e=null!=a?a.urls:a)?e.logOut:e,a))+'"\n  >Log out</a>\n</div>\n'},useData:!0});return b.registerPartial("components/main-nav/templates/account-popup-menu",c),c}),define("components/main-nav/views/account-popup-menu",["Backbone","../config","../lib/current-user","../lib/menu-builder","hbs!../templates/account-popup-menu"],function(a,b,c,d,e){"use strict";return a.View.extend({initialize:function(){this.listenTo(c,"change",this.render)},getMenuItems:function(){var a=b.urls;return d.list([d.item("Your list",a.yourList),d.item("Favorites",a.favorites),d.item("Watch history",a.watchHistory),d.item("TEDx events",a.tedXEvents,{external:!0,condition:c.get("isTEDxOrganizer")}),d.item("Conferences",a.conferences,{condition:c.get("hasConferences")}),d.item("Your TED-Ed activity",a.tedEdHistory,{external:!0,condition:c.get("hasEdActivity")}),d.item("Settings",a.settings),d.item("Your profile",a.profile)])},render:function(){this.$el.html(e({userName:c.get("firstName"),menuItems:this.getMenuItems(),urls:b.urls}))}})}),define("hbs!components/main-nav/templates/slideout-menu-item",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(a,b,c,d){return"        b-b\n        b:black.9\n"},3:function(a,b,c,d){return"f-w:700"},5:function(a,b,c,d){return"ga-link"},7:function(a,b,c,d){return'target="_blank"'},9:function(a,b,c,d){return"data-drilldown"},11:function(a,b,c,d){var e;return'      data-ga-action="'+this.escapeExpression((e=null!=(e=b.gaAction||(null!=a?a.gaAction:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"gaAction",hash:{},data:d}):e))+'"\n      data-ga-category="navigation.item"\n      data-ga-label="'+this.escapeExpression((e=null!=(e=b.url||(null!=a?a.url:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"url",hash:{},data:d}):e))+'"\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<li>\n  <a\n    class="\n'+(null!=(e=b.if.call(a,null!=a?a.border:a,{name:"if",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"      d:b\n      "+(null!=(e=b.if.call(a,null!=a?a.bold:a,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.noop,data:d}))?e:"")+"\n      "+(null!=(e=b.if.call(a,null!=a?a.gaAction:a,{name:"if",hash:{},fn:this.program(5,d,0),inverse:this.noop,data:d}))?e:"")+'\n      p-x:5\n      p-y:.8\n      undec\n      Main-nav__fs-4\n    "\n    href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'"\n    '+(null!=(e=b.if.call(a,null!=a?a.external:a,{name:"if",hash:{},fn:this.program(7,d,0),inverse:this.noop,data:d}))?e:"")+"\n    "+(null!=(e=b.if.call(a,null!=a?a.drilldown:a,{name:"if",hash:{},fn:this.program(9,d,0),inverse:this.noop,data:d}))?e:"")+"\n"+(null!=(e=b.if.call(a,null!=a?a.gaAction:a,{name:"if",hash:{},fn:this.program(11,d,0),inverse:this.noop,data:d}))?e:"")+"  >"+this.escapeExpression((f=null!=(f=b.label||(null!=a?a.label:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"label",hash:{},data:d}):f))+"</a>\n</li>\n"},useData:!0});return b.registerPartial("components/main-nav/templates/slideout-menu-item",c),b.registerPartial("./slideout-menu-item",c),b.registerPartial("./slideout-menu-item",c),c}),define("hbs!components/main-nav/templates/slideout-menu-cascaded-item",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu-item"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-item"],a,{name:"./slideout-menu-item",data:d,indent:"      ",helpers:b,partials:c}))?e:""},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<li\n  class="\n    b-b\n    b:black.9\n  "\n>\n  <a\n    class="\n      d:b\n      f-w:700\n      p-x:5 p-y:.8\n      undec\n      Main-nav__fs-4\n    "\n    href="'+this.escapeExpression((f=null!=(f=b.url||(null!=a?a.url:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"url",hash:{},data:d}):f))+'"\n  >'+this.escapeExpression((f=null!=(f=b.label||(null!=a?a.label:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"label",hash:{},data:d}):f))+'</a>\n  <ul class="sl">\n'+(null!=(e=b.each.call(a,null!=a?a.items:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"  </ul>\n</li>\n"},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/slideout-menu-cascaded-item",c),b.registerPartial("./slideout-menu-cascaded-item",c),c}),define("hbs!components/main-nav/templates/slideout-menu-accordion-item",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu-item"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return'    data-accordion-item-name="'+this.escapeExpression((e=null!=(e=b.name||(null!=a?a.name:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"name",hash:{},data:d}):e))+'"\n'},3:function(a,b,c,d,e,f){var g;return null!=(g=this.invokePartial(c["./slideout-menu-item"],a,{name:"./slideout-menu-item",hash:{gaAction:null!=f[1]?f[1].name:f[1],border:!0},data:d,indent:"      ",helpers:b,partials:c}))?g:""},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d,e,f){var g,h;return'<li\n  class="Accordion__item"\n'+(null!=(g=b.if.call(a,null!=a?a.name:a,{name:"if",hash:{},fn:this.program(1,d,0,e,f),inverse:this.noop,data:d}))?g:"")+'>\n  <a\n    href="#"\n    class="\n      b-b\n      b:black.9\n      d:b\n      f-w:700\n      p-x:5\n      p-y:.8\n      pos:r\n      undec\n      Accordion__opener\n      Main-nav__fs-4\n    "\n  >\n    <svg\n      class="\n        m-w:4\n        pos:a\n        left:0\n        top:0\n        h:full\n        Accordion__arrow\n      "\n      xmlns="http://www.w3.org/2000/svg"\n      viewBox="-300 0 890 512"\n    >\n      <path fill="#231F20" d="M47.745 499.5v-487l416.51 243.483z"/>\n    </svg>\n    '+this.escapeExpression((h=null!=(h=b.label||(null!=a?a.label:a))?h:b.helperMissing,"function"==typeof h?h.call(a,{name:"label",hash:{},data:d}):h))+'\n  </a>\n  <ul\n    class="\n      bg:white\n      sl\n      Accordion__content\n    "\n  >\n'+(null!=(g=b.each.call(a,null!=a?a.items:a,{name:"each",hash:{},fn:this.program(3,d,0,e,f),inverse:this.noop,data:d}))?g:"")+"  </ul>\n</li>\n"},usePartial:!0,useData:!0,useDepths:!0});return b.registerPartial("components/main-nav/templates/slideout-menu-accordion-item",c),b.registerPartial("./slideout-menu-accordion-item",c),c}),define("hbs!components/main-nav/templates/slideout-menu",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu-cascaded-item","hbs!components/main-nav/templates/slideout-menu-accordion-item","hbs!components/main-nav/templates/slideout-menu-item"],function(a,b){var c=b.template({1:function(a,b,c,d){var e;return null!=(e=b.if.call(a,null!=a?a.items:a,{name:"if",hash:{},fn:this.program(2,d,0),inverse:this.program(7,d,0),data:d}))?e:""},2:function(a,b,c,d){var e;return null!=(e=b.if.call(a,null!=a?a.url:a,{name:"if",hash:{},fn:this.program(3,d,0),inverse:this.program(5,d,0),data:d}))?e:""},3:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-cascaded-item"],a,{name:"./slideout-menu-cascaded-item",data:d,indent:"        ",helpers:b,partials:c}))?e:""},5:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-accordion-item"],a,{name:"./slideout-menu-accordion-item",data:d,indent:"        ",helpers:b,partials:c}))?e:""},7:function(a,b,c,d){var e;return null!=(e=this.invokePartial(c["./slideout-menu-item"],a,{name:"./slideout-menu-item",hash:{border:!0,bold:!0},data:d,indent:"      ",helpers:b,partials:c}))?e:""},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<ul class="sl Accordion">\n'+(null!=(e=b.each.call(a,null!=a?a.menuItems:a,{name:"each",hash:{},fn:this.program(1,d,0),inverse:this.noop,data:d}))?e:"")+"</ul>\n"},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/slideout-menu",c),b.registerPartial("./slideout-menu",c),c}),define("hbs!components/main-nav/templates/account-slideout-menu",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f;return'<div\n  class="\n    b-b\n    b:black.9\n    p:.8\n  "\n>\n  <div\n    class="\n      f-w:700\n      Main-nav__fs-6\n    "\n  >\n    Hi, '+this.escapeExpression((f=null!=(f=b.userName||(null!=a?a.userName:a))?f:b.helperMissing,"function"==typeof f?f.call(a,{name:"userName",hash:{},data:d}):f))+"\n  </div>\n</div>\n\n"+(null!=(e=this.invokePartial(c["./slideout-menu"],a,{name:"./slideout-menu",data:d,helpers:b,partials:c}))?e:"")},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/account-slideout-menu",c),c}),define("components/main-nav/views/account-slideout-menu",["lodash","Backbone","../config","../lib/current-user","../lib/menu-builder","hbs!../templates/account-slideout-menu"],function(a,b,c,d,e,f){"use strict";return b.View.extend({initialize:function(){this.listenTo(d,"change",this.render)},getMenuItems:function(){var b=c.urls,f=a.map(d.get("upcomingConferences"),function(a){return e.item(a.name,"/dashboard/conferences/"+a.slug)});return e.list([e.item("Your talks",[e.item("Your list",b.yourList),e.item("Favorites",b.favorites),e.item("Watch history",b.watchHistory)]),e.item("TEDx Events",b.tedXEvents,{external:!0,condition:d.get("isTEDxOrganizer")}),e.item("Conferences",a.union(f,[e.item("Badge",b.confBadge),e.item("Contact us",b.confContact)]),{condition:d.get("hasConferences")}),e.item("Your TED-Ed activity",b.tedEdHistory,{external:!0,condition:d.get("hasEdActivity")}),e.item("Settings",b.settings,{drilldown:!0}),e.item("Your profile",b.profile),e.item("Log out",b.logOut)])},render:function(){return this.$el.html(f({userName:d.get("firstName"),menuItems:this.getMenuItems()})),this}})}),define("views/mixins/cached-find",["exports"],function(a){"use strict";a._findEls=null,a.find=function(a){if(this._findEls||(this._findEls={}),this._findEls[a])return this._findEls[a];var b=this.$el.find(a);return b.length&&(this._findEls[a]=b),b}}),define("components/main-nav/views/big-search",["lodash","Backbone","lib/focus-zone","views/mixins/cached-find"],function(a,b,c,d){"use strict";var e=b.View.extend({events:{"click a.Main-nav__search__close":"_onClickClose",keyup:"_onKeyUp"},_onClickClose:function(a){a.preventDefault(),this.hide()},_onKeyUp:function(a){this.isOpen&&a.keyCode===$.ui.keyCode.ESCAPE&&this.hide()},getFocusZone:function(){return this.focusZone=this.focusZone||new c(this.el),this.focusZone},hide:function(){this.isOpen=!1,this.getFocusZone().deactivate(),this.$el.attr("aria-hidden","true"),this.find("a.Main-nav__search__close").attr("tabindex","-1"),this.find("input.Main-nav__search__input").attr("tabindex","-1"),this.trigger("hide")},show:function(){var b=this;b.isOpen=!0,b.trigger("show"),a.delay(function(){b.getFocusZone().activate(),b.$el.removeAttr("aria-hidden"),b.find("a.Main-nav__search__close").attr("tabindex","0"),b.find("input.Main-nav__search__input").attr("tabindex","0").focus().select()},100)}});return a.extend(e.prototype,d),e}),define("hbs!components/main-nav/templates/hamburger-slideout-menu",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<form\n  class="\n    b-b\n    b:black.9\n    p:.6\n  "\n  action="/search"\n  role="search"\n>\n  <div class="pos:r">\n    <input\n      class="form-control"\n      autocorrect="off"\n      name="q"\n      placeholder="Search…"\n    />\n    <label\n      class="\n        pos:a\n        right:0\n        top:0\n      "\n    >\n      <input\n        class="d:n"\n        type="submit"\n      />\n      <svg\n        xmlns="http://www.w3.org/2000/svg"\n        width="40"\n        height="40"\n        viewBox="0 0 40 40"\n        role="button"\n        tabindex="0"\n      >\n        <title>Search</title>\n        <rect x="5" y="10" width="30" height="20" fill="#FFF"/>\n        <path d="M17.769 5.081c-7.006 0-12.708 5.695-12.708 12.693 0 6.999 5.702 12.695 12.711 12.695 2.529 0 4.886-.752 6.869-2.033l5.441 5.435a2.695 2.695 0 0 0 3.805 0 2.688 2.688 0 0 0 0-3.803l-5.44-5.431a12.59 12.59 0 0 0 2.034-6.863c-.001-6.998-5.7-12.693-12.712-12.693zm10.165 12.693c0 5.599-4.56 10.151-10.162 10.151-5.604 0-10.163-4.554-10.163-10.151 0-5.597 4.559-10.15 10.163-10.146 5.602 0 10.16 4.549 10.162 10.146z" fill="#666"/>\n      </svg>\n    </label>\n  </div>\n</form>\n\n'+(null!=(e=this.invokePartial(c["./slideout-menu"],a,{name:"./slideout-menu",data:d,helpers:b,partials:c}))?e:"")},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/hamburger-slideout-menu",c),c}),define("components/main-nav/views/hamburger-slideout-menu",["Backbone","hbs!../templates/hamburger-slideout-menu"],function(a,b){"use strict";return a.View.extend({menuItems:[],initialize:function(a){this.menuItems=a.menuItems},render:function(){return this.$el.html(b({menuItems:this.menuItems})),this}})}),define("hbs!components/main-nav/templates/slideout-secondary",["hbs","hbs/handlebars","hbs!components/main-nav/templates/slideout-menu"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'<a\n  class="\n    b-b\n    b:black.9\n    undec\n    Main-nav__fs-4\n    pos:r\n    p-y:.8\n    p-x:5\n    f-w:700\n    d:b\n  "\n  href="#"\n  role="button"\n  data-drilldown="back"\n>\n  <svg\n    class="\n      m-w:4\n      pos:a\n      left:0\n      top:0\n      h:full\n    "\n    xmlns="http://www.w3.org/2000/svg"\n    viewBox="-270 242 60 30"\n  >\n      <path d="M-226.3 269l-12-12 12-12-1.7-1.7-13.7 13.7 13.7 13.7 1.7-1.7z"/>\n    </svg>\n  Back\n</a>\n\n'+(null!=(e=this.invokePartial(c["./slideout-menu"],a,{name:"./slideout-menu",data:d,helpers:b,partials:c}))?e:"")+'\n<div class="p-y:6 pos:r">\n  <div\n    class="\n      spinner--centered\n      Main-nav__slideout-spinner\n    "\n  ></div>\n</div>\n'},usePartial:!0,useData:!0});return b.registerPartial("components/main-nav/templates/slideout-secondary",c),c}),define("components/main-nav/views/slideout-secondary",["Backbone","spinjs","hbs!../templates/slideout-secondary"],function(a,b,c){"use strict";return a.View.extend({menuItems:[],render:function(){return this._spinner&&this.menuItems.length&&this._spinner.stop(),this.$el.html(c({menuItems:this.menuItems})),this._spinner||this.menuItems.length||(this._spinner=new b,this._spinner.spin(this.$el.find("div.Main-nav__slideout-spinner").get(0))),this}})}),define("components/main-nav/index",["lodash","lib/ga","./components/popups/index","./components/slideout/index","./lib/menu-parser","./lib/screen-size","./views/account-button","./views/account-popup-menu","./views/account-slideout-menu","./views/big-search","./views/hamburger-slideout-menu","./views/slideout-secondary"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){var a=new d;return a.$el.appendTo("#main-nav-slideouts"),a.on("spawn",function(a){var b=new l;a.setContent(b);var c=a.model.get("id");e.load(c).done(function(a){b.menuItems=a,b.render()}).fail(function(){window.location.href=c})}),a}function n(){$("#main-nav-account-button").on("click",f.ifSmall(function(){r().render().show()})),r().setPrimary(new i);var a=new h({el:document.getElementById("main-nav-account-menu")});a.render();var b=new g({el:document.getElementById("main-nav-account-button")});b.render()}function o(){var a=new j({el:document.getElementById("main-nav-search-form")});a.render();var b=$("#main-nav");a.on("show",function(){b.addClass("Main-nav--searching")}),a.on("hide",function(){b.removeClass("Main-nav--searching")}),$("#main-nav-search").on("click",function(b){b.preventDefault(),a.show()})}function p(){var a=new l;return a.menuItems=e.parse($("#submenu")),a}var q={},r=a.once(function(){var a=m();return a.shojiOpenAt="right",a.on("show",function(){b.sendEvent("navigation.menu","open","account")}),a}),s=a.once(function(){var a=m();return a.on("show",function(){b.sendEvent("navigation.menu","open","hamburger")}),a.on("accordion-open",function(a,c){c&&b.sendEvent("navigation.menu","open",c)}),a});return q.openHamburger=function(){s().render().show()},q.init=function(a){n(),o(),c.init(),c.popperBar.on("pop",function(a,c){b.sendEvent("navigation.menu","open",c)}),s().setPrimary(new k({menuItems:a.menuItems})),$("#main-nav").removeClass("Main-nav--uninitialized")},q.addSubmenuToHamburger=function(){s().addSecondary("currentPage",p())},q.addSubmenuToAccount=function(){r().addSecondary("currentPage",p())},q}),define("global/links",["jquery","deferLink","lib/ga"],function(a,b,c){"use strict";function d(a){if(a.match(location.origin))return!1;for(var b=-1;++b<h;)if(a.match(g[b].re))return g[b]}function e(b,c,d){b=a.extend({},i,b);for(var e in b)b.hasOwnProperty(e)&&a.isFunction(b[e])&&(b[e]=b[e].call(c,d));return b}function f(a){var f=d(this.href);return!f||(c.send(e(f,this,a)),b.call(this,a))}var g=[{re:/^https?:\/\/(?:.*\.)tedprize\.(org|com)/,eventCategory:"link.outbound.tedPrize"},{re:/^https?:\/\/ed\.ted\.com/,eventCategory:"link.outbound.tedEd"},{re:/^https?:\/\/tedfellows\.posterous\.com/,eventCategory:"link.outbound.fellowsBlog"},{re:/^https?:\/\/(?:.*\.)universalsubtitles\.org/,eventCategory:"link.outbound.translatorDashboard"},{re:/^https?:\/\/(?:.*\.)feedburner\.com/,eventCategory:"link.outbound.feedburner"},{re:/^https?:\/\//}],h=g.length,i={hitType:"event",eventCategory:"link.outbound.other",eventAction:"click",eventLabel:function(){return this.href}};return{init:function(){a("body").on("click","a[href]",f)}}}),define("Mailcheck",["exports"],function(a){var b={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:["msn.com","bellsouth.net","telus.net","comcast.net","optusnet.com.au","earthlink.net","qq.com","sky.com","icloud.com","mac.com","sympatico.ca","googlemail.com","att.net","xtra.co.nz","web.de","cox.net","gmail.com","ymail.com","aim.com","rogers.com","verizon.net","rocketmail.com","google.com","optonline.net","sbcglobal.net","aol.com","me.com","btinternet.com","charter.net","shaw.ca"],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu"],run:function(a){a.domains=a.domains||b.defaultDomains,a.secondLevelDomains=a.secondLevelDomains||b.defaultSecondLevelDomains,a.topLevelDomains=a.topLevelDomains||b.defaultTopLevelDomains,a.distanceFunction=a.distanceFunction||b.sift3Distance;var c=function(a){return a},d=a.suggested||c,e=a.empty||c,f=b.suggest(b.encodeEmail(a.email),a.domains,a.secondLevelDomains,a.topLevelDomains,a.distanceFunction);return f?d(f):e()},suggest:function(a,b,c,d,e){a=a.toLowerCase();var f=this.splitEmail(a);if(c&&d&&c.indexOf(f.secondLevelDomain)!==-1&&d.indexOf(f.topLevelDomain)!==-1)return!1;var g=this.findClosestDomain(f.domain,b,e,this.domainThreshold);if(g)return g!=f.domain&&{address:f.address,domain:g,full:f.address+"@"+g};var h=this.findClosestDomain(f.secondLevelDomain,c,e,this.secondLevelThreshold),i=this.findClosestDomain(f.topLevelDomain,d,e,this.topLevelThreshold);if(f.domain){var g=f.domain,j=!1;if(h&&h!=f.secondLevelDomain&&(g=g.replace(f.secondLevelDomain,h),j=!0),i&&i!=f.topLevelDomain&&(g=g.replace(f.topLevelDomain,i),j=!0),1==j)return{address:f.address,domain:g,full:f.address+"@"+g}}return!1},findClosestDomain:function(a,b,c,d){d=d||this.topLevelThreshold;var e,f=99,g=null;if(!a||!b)return!1;c||(c=this.sift3Distance);for(var h=0;h<b.length;h++){if(a===b[h])return a;e=c(a,b[h]),e<f&&(f=e,g=b[h])}return f<=d&&null!==g&&g},sift3Distance:function(a,b){if(null==a||0===a.length)return null==b||0===b.length?0:b.length;if(null==b||0===b.length)return a.length;for(var c=0,d=0,e=0,f=0,g=5;c+d<a.length&&c+e<b.length;){if(a.charAt(c+d)==b.charAt(c+e))f++;else{d=0,e=0;for(var h=0;h<g;h++){if(c+h<a.length&&a.charAt(c+h)==b.charAt(c)){d=h;break}if(c+h<b.length&&a.charAt(c)==b.charAt(c+h)){e=h;break}}}c++}return(a.length+b.length)/2-f},splitEmail:function(a){var b=a.trim().split("@");if(b.length<2)return!1;for(var c=0;c<b.length;c++)if(""===b[c])return!1;var d=b.pop(),e=d.split("."),f="",g="";if(0==e.length)return!1;if(1==e.length)g=e[0];else{f=e[0];for(var c=1;c<e.length;c++)g+=e[c]+".";g=g.substring(0,g.length-1)}return{topLevelDomain:g,secondLevelDomain:f,domain:d,address:b.join("@")}},encodeEmail:function(a){var b=encodeURI(a);return b=b.replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};return"undefined"!=typeof module&&module.exports&&(module.exports=b),"function"==typeof define&&define.amd&&define("mailcheck",[],function(){return b}),"undefined"!=typeof window&&window.jQuery&&!function(a){a.fn.mailcheck=function(a){var c=this;if(a.suggested){var d=a.suggested;a.suggested=function(a){d(c,a)}}if(a.empty){var e=a.empty;a.empty=function(){e.call(null,c)}}a.email=this.val(),b.run(a)}}(jQuery),b}),define("lib/newsletter",["jquery","Mailcheck"],function(a,b){"use strict";function c(b){var c=[];return b.isDaily&&c.push("daily"),b.isWeekly&&c.push("weekly"),b.isFellows&&c.push("fellows"),a.getJSON("//www.ted.com/newsletter/signup.json?callback=?",{newsletterSignup:{email_address:b.email,subscription_list:c}})}function d(c){var d=[],e=new a.Deferred;return""===c.email&&d.push("blankemail"),(""+c.email).match(/.+@.+/)||d.push("email"),c.isDaily||c.isWeekly||c.isFellows||d.push("subscription"),b.run({email:c.email,suggested:function(a){if(d.push({type:"suggestion",data:a.full}),1===d.length){var e=c.email.match(/@(.+$)/)[1];b.defaultDomains.push(e)}}}),d.length?e.rejectWith(c,[d]):e.resolveWith(c),e.promise()}function e(b){function e(a){"error"===a.status?i.rejectWith(b,[["uncaught"]]):i.resolveWith(b)}function f(){i.rejectWith(b,[["server"]])}function g(){c(b).then(e,f)}function h(a){i.rejectWith(this,[a])}var i=new a.Deferred;return d(b).then(g,h),i}return{ajax:c,subscribe:e,validate:d}}),define("global/subscribe",["jquery","lodash","lib/newsletter","lib/ga"],function(a,b,c,d){"use strict";function e(){d.sendEvent("newsletter","success",b.filter([!!h.isDaily&&"daily",!!h.isWeekly&&"weekly"]).join(",")),a(n+"-details").slideUp(o),a(n+"-success").slideDown(o)}function f(b){var c,d,e,f=b[0];if(m.slideUp(o),"object"==typeof f?(c=f.type,d=f.data):c=f,e=a(n+"-error-"+c),e.slideDown(o),d){var g=e.find(".newsletter-signup-error__data");g.text(d),g.click(function(a){a.preventDefault(),l.val(d),m.slideUp(o)})}}function g(a){p(),d.sendEvent("newsletter","submit","footer"),h={email:l.val(),isDaily:j.is(":checked"),
isWeekly:k.is(":checked")},c.subscribe(h).then(e,f),a.preventDefault()}var h,i,j,k,l,m,n="#newsletter-signup",o="fast",p=b.once(function(){j=a(n+"-daily"),k=a(n+"-weekly"),l=a(n+"-email"),m=i.find("p.footer-newsletter__error")});return{init:function(){i=a(n),i.on("submit",g)}}}),define("global/uconf",["jquery","Cookies"],function(a,b){"use strict";var c="#";return{init:function(d,e){a(c+e).on("click",function(e){e.preventDefault(),a(c+d).slideUp("fast"),b.expire("_uconf",{domain:"ted.com",path:"/"})})}}}),define("global/keyboard",["jquery","exports","jqueryui/core"],function(a,b){"use strict";b._keyDowned=!1,b._keyDown=function(c){var d;c.keyCode!==a.ui.keyCode.SPACE||b._keyDowned||c.isPropagationStopped()||c.isDefaultPrevented()||!(d=a(c.target)).is("a[role=button]")||(c.preventDefault(),d.trigger("click",c)),b._keyDowned=!0},b._keyUp=function(){b._keyDowned=!1},b.init=function(){a(window).on({keydown:b._keyDown,keyup:b._keyUp})}}),define("utils/query_param",[],function(){"use strict";return function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}}),define("global/track-a-block",["lib/errorCollector","utils/query_param","exports"],function(a,b,c){"use strict";function d(a,b){f&&console&&console.log&&console.log("%c"+(a?"✔ ":"✘ ")+b,"color:"+(a?"green":"red"))}function e(b,c,e,f){d(b,f),b||a.log(e,{error:!1,context:"tab",library:c})}var f=!!b("tab"),g=window,h={gaLoaded:!1,gaObjectified:!1,gptLoaded:!1,gptExecuting:!1};c.onGaLoad=function(){h.gaLoaded=!0},c.onGptExecution=function(){h.gptExecuting=!0},c.onGptLoad=function(){h.gptLoaded=!0},c.checkGaObject=function(){var a=g[g.GoogleAnalyticsObject];h.gaObjectified=a!==g.__gaIn&&42===a.answer},c.checkBlox=function(){e(h.gaLoaded,"ga","noload","analytics.js loaded"),e(h.gaObjectified,"ga","norun","GA running"),e(h.gptLoaded,"gpt","noload","gpt.js loaded"),e(h.gptExecuting,"gpt","norun","GPT running")},c.init=function(){window.setTimeout(c.checkGaObject,200),window.setTimeout(c.checkBlox,500)}}),define("widgets/ad",["lodash","jquery","jqueryui/widget"],function(a,b){"use strict";b.widget("ted.ad",{_rendered:!1,$image:null,$text:null,$link:null,blocked:function(){this.element.hide()},refreshJsonAd:function(){if(this.options.blocked)return void this.blocked();if(this._rendered||(this._addAdClass(),this.element.children().addClass("ad__prefill"),this._getAppreciationText().appendTo(this.element),this.$link=b('<a class="ad__unit" href="#" rel="nofollow" target="_blank">').appendTo(this.element),this.$image=b("<img>").appendTo(this.$link),this._rendered=!0),!this.options.ad)return void this.element.hide();var a=this._getRenderDetails();this.$link.attr("href",a.click),this.$image.attr({src:a.currentCreative.url,width:a.dimensions.width,height:a.dimensions.height}),this.element[this.options.ad.hasDisplay===!1?"hide":"show"](),this._impress()},refreshHtmlAd:function(){this._addAdClass(),this._getAppreciationText().prependTo(this.element)},_init:function(){var a=String(this.options.mode);this._rendered=!1,"json"===a?this.refreshJsonAd():"html"===a&&this.refreshHtmlAd()},_fireImpression:function(a){var b=new Image;b.src=a},_impress:function(){this._fireImpression(this.options.ad.impression),a.forEach(this.options.ad.thirdPartyImpressions,this._fireImpression)},_getCreative:function(){var b=a.filter(this.options.ad.creative,function(a){return""!==a.url}),c=Math.max(window.devicePixelRatio||1,1);return a.reduce(b,function(a,b){return b.density<=c?b:a||b},{})},_getRenderDetails:function(){return a.extend({currentCreative:this._getCreative()},this.options.ad)},_getAppreciationText:function(){return this.$text=b('<div class="ad__text">TED Talks are free thanks to our partners &amp; advertisers</div>'),this.$text},_addAdClass:function(){this.element.addClass("ad")}})}),define("hbs!templates/sponsorshipBug",["hbs","hbs/handlebars"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<a class="sponsorship-bug__link" href="#" rel="nofollow" target="_blank" style="display:block"><img src="" alt=""></a>\n'},useData:!0});return b.registerPartial("templates/sponsorshipBug",c),c}),define("widgets/sponsorshipBug",["jquery","hbs!templates/sponsorshipBug","widgets/ad"],function(a,b){"use strict";a.widget("ted.sponsorshipBug",a.ted.ad,{blocked:function(){},refreshHtmlAd:function(){},refreshJsonAd:function(){return this.options.blocked?this.blocked():(this._rendered||(this.element.children().addClass("sponsorship-bug__prefill"),this.element.append(b()),this.$image=this.element.find("img"),this.$link=this.element.find("a.sponsorship-bug__link"),this._rendered=!0),void this._super())},_init:function(){this.element.closest("div.sponsorship-bug").addClass("sponsorship-bug--active"),this._super()}})}),define("lib/ads",["jquery","lodash","utils/ted","utils/query_param","exports","widgets/ad","widgets/sponsorshipBug"],function(a,b,c,d,e){"use strict";function f(a){var b=new Image;b.src=a}function g(b){var c=String(b.type),d=m[b.type];"master"===c?n.deferred.resolve(b):void 0===d?window.console&&console.log&&(console.log("Unknown ad type"),console.log(b)):a(d.id)[d.widget]({ad:b,mode:"json"})}function h(c){b.forEach(n.companionAdSlots,function(b){if(b.gptSlot.setTargeting(b.key,c.target),b.displayed){var d=a("#"+b.containerId);d.data("tedAd")?d.ad("destroy"):d.data("sponsorshipBug")&&d.sponsorshipBug("destroy"),e.refreshAd(b.gptSlot)}else e.displayAd(b.containerId);b.displayed=!0}),c.impression&&f(c.impression)}function i(a){return a.replace("{adUnit}",n.slot.adUnit)}function j(a){o.done(function(b){b.isMai||e.player.player("sendAds",{postroll:i(a.postrollURL),preroll:i(a.prerollURL)})})}function k(b){var d=e.player=b;if(d){var f=d.player("isMai"),i=e.playerMode=String(d.player("mode")),k="flash"===i,l=!f&&(k||"surprise_me"===c("controller"));if(e.setMasterDeets({isMai:d.player("isMai"),isGptProxy:l,maiAdUnitId:d.player("maiAdUnitId")}),f)d.on({playerad:function(a,b){g(b.ad)}}),n.deferred.done(h);else if(l){n.deferred.done(h),d.on({playeradblock:function(){var b=m.bug;a(b.id)[b.widget]({blocked:!0})}});var o=!0;d.on({playertalk:function(a,b){var c=String(d.player("talks")[0].id),f=String(b.id);o&&c===f?(o=!1,"flash"===i&&n.deferred.done(j)):e.refreshMasterAd({targeting:b.targeting}),o=!1}})}}}function l(){b.forEach(n.slot.targeting,function(a,c){n.slot.gptSlot.setTargeting(c,b.isArray(a)?a.join(","):a)});var a=d("dfptest");a&&n.slot.gptSlot.setTargeting("dfptest",a)}var m={bug:{id:"#sponsorship-bug-placeholder",widget:"sponsorshipBug"},companion:{id:"#ad-unit",widget:"ad"},"companion-mobile":{id:"#ad-unit-mobile",widget:"ad"},devil:{id:"#devil-ad",widget:"ad"},onPage:{id:"#ad-unit",widget:"ad"}},n={companionAdSlots:[],deferred:a.Deferred(),slot:{adUnit:null,containerId:null,gptSlot:null,targeting:{}}};e._masterAd=n,e.player=null;var o=a.Deferred();window.googletag=window.googletag||{cmd:[]},e.slotRenderEndedHandler=function(c){if(c&&c.slot&&!c.isEmpty){var d,e="ad",f="tedAd",g=b.find(n.companionAdSlots,function(a){return a.gptSlot===c.slot}),h=g&&String(g.containerId);"ad-unit"===h&&(d=a("#ad-unit")),"sponsorship-bug-placeholder"===h&&(d=a("#sponsorship-bug-placeholder"),e="sponsorshipBug",f="tedSponsorshipBug");var i=c.slot.getSlotElementId&&c.slot.getSlotElementId();if(!g&&i&&(d=a("#"+i)),"master-gpt"!==h&&"master-gpt"!==i&&d&&d.length){var j=d.data(f);j||d[e]({mode:"html"})}}},e.displayMasterAd=function(a){o.done(function(c){c.isMai||(n.slot.containerId=a.containerId,n.slot.adUnit=c.adUnitId,window.googletag.cmd.push(function(){n.slot.gptSlot=googletag.defineOutOfPageSlot(n.slot.adUnit,n.slot.containerId).addService(googletag.pubads()),b.assign(n.slot.targeting,a.targeting),l(),e.displayAd(n.slot.containerId)}))})},e.refreshMasterAd=function(c){n.slot.gptSlot&&(n.deferred=a.Deferred(),n.deferred.done(h),"flash"===e.playerMode&&n.deferred.done(j),n.slot.gptSlot.clearTargeting(),b.forEach(n.companionAdSlots,function(a){a.gptSlot.clearTargeting()}),b.assign(n.slot.targeting,c.targeting),l(),e.refreshAd(n.slot.gptSlot))},e.displayAd=function(b){a(function(){window.googletag.cmd.push(function(){googletag.display(b)})})},e.refreshAd=function(a){window.googletag.cmd.push(function(){googletag.pubads().refresh([a])})},e.createStandardSlot=function(a){window.googletag.cmd.push(function(){var b=googletag.defineSlot(a.adUnitId,a.size,a.containerId).addService(googletag.pubads()),c=d("dfptest");c&&b.setTargeting("dfptest",c),e.displayAd(a.containerId)})},e.createCompanionSlot=function(a){o.done(function(b){b.isMai||b.isGptProxy?window.googletag.cmd.push(function(){var c=googletag.defineSlot(b.adUnitId,a.size,a.containerId).addService(googletag.pubads());n.companionAdSlots.push({containerId:a.containerId,gptSlot:c,key:a.key})}):e.createStandardSlot({adUnitId:b.adUnitId,size:a.size,containerId:a.containerId})})};var p={};e.setMasterDeets=function(b){a.extend(p,b),p.hasOwnProperty("isMai")&&p.hasOwnProperty("gptAdUnitId")&&p.hasOwnProperty("maiAdUnitId")&&o.resolve({isMai:p.isMai,isGptProxy:p.isGptProxy,adUnitId:p.isMai?p.maiAdUnitId:p.gptAdUnitId})},e.initPlayer=k,e.gptAd=function(a){g(a.ad)},window.googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",e.slotRenderEndedHandler)})}),define("global/errors",["lib/errorCollector"],function(a){"use strict";window.onerror=function(b,c,d){d&&c.match(/^https?:\/\/(?:.*\.)?(?:ted|tedcdn)\.com\//)&&(!c.match(/\.js/)&&d<5||a.log(b,{file:c,line:d}))}}),define("hbs!templates/authPromptModal",["hbs","hbs/handlebars","templates/helpers/icon"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="auth-prompt__section auth-prompt__header">\n  <h2 class="auth-prompt__header__title">\n    Log in to\n    TED\n  </h2>\n\n  <a href="#" class="modal__close auth-prompt__close">\n    <i class="g-button-modal-close">Close</i>\n  </a>\n</div>\n\n<div class="auth-prompt__section auth-prompt__options">\n  <form class="auth-prompt__option auth-prompt__option--standard">\n    <div class="auth-prompt__message">\n      Your email or password was incorrect.\n    </div>\n\n    <div class="m3">\n      <label class="form-label">Email</label>\n      <input class="form-control auth-prompt__email" name="user[email]" type="email">\n    </div>\n\n    <div class="m3">\n      <label class="form-label">Password</label>\n      <input class="form-control auth-prompt__password" name="user[password]" type="password">\n    </div>\n\n    <div class="m3">\n      <label>\n        <input class="auth-prompt__remember" type="checkbox" checked name="user[remember_me]">\n        <span class="form-label" style="display:inline; margin-left: 2px;">\n          Remember me\n        </span>\n      </label>\n    </div>\n\n    <div>\n      <button class="button button--dark auth-prompt__login">Log in</button>\n      <a class="l3 auth-prompt__halp" href="'+this.escapeExpression((e=null!=(e=b.signInHelpUrl||(null!=a?a.signInHelpUrl:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"signInHelpUrl",hash:{},data:d}):e))+'" target="_blank">Need help logging in?</a>\n    </div>\n  </form>\n\n  <div class="auth-prompt__option auth-prompt__option--social">\n    <button class="button button--wide button--dark button--labeled button--facebook auth-prompt__facebook">\n      '+this.escapeExpression((b.icon||a&&a.icon||b.helperMissing).call(a,"facebook","","button__icon",{name:"icon",hash:{},data:d}))+'\n      <span class="button__label">Log in with Facebook</span>\n    </button>\n  </div>\n</div>\n\n<div class="auth-prompt__section auth-prompt__footer">\n  <span class="auth-prompt__footer__question">Don\'t have an account yet?</span>\n  <a class="l3" href="'+this.escapeExpression((e=null!=(e=b.signUpUrl||(null!=a?a.signUpUrl:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"signUpUrl",hash:{},data:d}):e))+'" target="_blank">Sign up</a>\n</div>\n\n<div class="auth-prompt__thinking"></div>\n'},useData:!0});return b.registerPartial("templates/authPromptModal",c),c}),define("templates/helpers/t",["Handlebars"],function(a){"use strict";a.registerHelper("t",function(a){return a})}),define("hbs!templates/modalDefault",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e;return'\n<div class="modal__head">\n  <a class="modal__close modal__head__close" href="#" role="button">\n    <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n  </a>\n  <h3 class="modal__head__title">'+this.escapeExpression((e=null!=(e=b.title||(null!=a?a.title:a))?e:b.helperMissing,"function"==typeof e?e.call(a,{name:"title",hash:{},data:d}):e))+"</h3>\n</div>\n"},useData:!0});return b.registerPartial("templates/modalDefault",c),c}),define("widgets/modal",["jquery","lodash","hbs!templates/modalDefault","lib/pubSub","lib/focus-zone","jqueryui/widget","lib/resize"],function(a,b,c,d,e){"use strict";function f(){l||(k=a(window),i=a(document.body),j=a("html"))}var g,h,i,j,k,l=0,m="modal-backdrop--show",n="modal--show",o="modal-open",p="modal__content",q=0;return h=["<div class=modal>","<div class=modal__outer>","<div class=modal__inner>"].join(""),d("breakpoint").subscribe(function(a){g=a<768}),a.widget("ted.modal",{options:{align:"middle",autoOpen:!0},_create:function(){var b=this;f(),this.options.title&&this.element.prepend(c(this.options)),this.modal=this.element.addClass(p).css("display","").wrap(h).closest("div.modal"),this.modal.addClass("modal--align-"+this.options.align);var d=a("<div class=modal-backdrop>");this.backdrop=d;var j=a("<div class=modal-wrapper>");this.wrapper=j,j.append(this.backdrop).append(this.modal),this.focusZone=new e(this.modal),this.wrapper.on("click",function(c){return!!g||(!!a(c.target).closest("div.modal__content").length||(c.preventDefault(),void b.close()))}),i.append(this.wrapper),this._on({"click a.modal__close":function(a){a.preventDefault(),b.close()},keyup:function(c){c.preventDefault(),c.keyCode===a.ui.keyCode.ESCAPE&&b.close()}}),this.options.autoOpen&&b.open()},_destroy:function(){var a=this;b.defer(function(){a.wrapper.remove()})},open:function(){var a=this;return this._hasOpened?(a.backdrop.addClass(m),a.openedAt={y:k.scrollTop()},q++||j.addClass(o),g&&window.scrollTo(0,0),a.modal.addClass(n),a.focusZone.activate(),this.element.attr("tabindex",0),this.element.focus(),void a._trigger("open")):void window.setTimeout(function(){a._hasOpened||(a._hasOpened=!0,a.open())},10)},close:function(){this.modal.removeClass(n),--q||j.removeClass(o),this.openedAt&&window.scrollTo(0,this.openedAt.y),this.backdrop.removeClass(m),this.element.attr("tabindex",-1),this.focusZone.deactivate(),this._trigger("close")}}),function(b,c){return a(b).modal(c)}}),define("views/AuthPromptView",["lodash","Modernizr","Backbone","lib/auth","hbs!templates/authPromptModal","utils/ted","spinjs","widgets/modal"],function(a,b,c,d,e,f,g){"use strict";function h(){d||(d=require("lib/auth"))}var i=c.View.extend({template:e,events:{"click button.auth-prompt__facebook":"facebook","click button.auth-prompt__login":"login","submit form.auth-prompt__option--standard":"login"},close:function(){this.$el.modal("close")},open:function(){this.$el.removeClass("auth-prompt--error"),this.$el.modal("open"),this.$email.focus()},login:function(a){a&&a.preventDefault(),this._startThinking(),h(),d.login(this.$email.val(),this.$password.val(),this.$remember.val()).then(this._loginSuccess,this._loginFailure).always(this._stopThinking),this.$password.val("")},facebook:function(a){a&&a.preventDefault(),this._startThinking(),h(),d.facebook().then(this._facebookSuccess,this._facebookFailure).always(this._stopThinking)},initialize:function(){var a=this;this._loginSuccess=function(){a.close(),a.trigger("login.success")},this._facebookSuccess=this._loginSuccess,this._loginFailure=function(b){b&&b.responseJSON&&a.$el.find(".auth-prompt__message").html(b.responseJSON.error),a.$el.addClass("auth-prompt--error"),a.trigger("login.failure")},this._facebookFailure=function(){a.trigger("login.failure")},this._stopThinking=function(){a.$thinkers.prop("disabled",!1),a.$el.removeClass("auth-prompt--thinking"),a._spinner&&a._spinner.stop()}},render:function(){var a=this;return this.$el.addClass("auth-prompt").html(a.template({signInHelpUrl:f("signInHelpUrl"),signUpUrl:f("signUpUrl")})).modal({autoOpen:!1}).on("modalclose",function(){a.trigger("close")}).on("modalopen",function(){a.trigger("open")}),this.$email=this.$el.find("input.auth-prompt__email"),this.$password=this.$el.find("input.auth-prompt__password"),this.$remember=this.$el.find("input.auth-prompt__remember"),this.$thinkers=this.$el.find(["form.auth-prompt__option--standard","button.auth-prompt__login","button.auth-prompt__facebook"].join(", ")).add(this.$email).add(this.$password),this},_startThinking:function(){this.$thinkers.prop("disabled",!0),this.$el.addClass("auth-prompt--thinking"),this._spinner||(this._spinner=new g({className:"spinner spinner--centered"})),this._spinner.spin(this.el)}});return i}),define("hbs!templates/authError",["hbs","hbs/handlebars","templates/helpers/t"],function(a,b){var c=b.template({compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){return'\n<div>\n  <div class="modal__head">\n    <a class="modal__close modal__head__close" href="#" role="button">\n      <i class="g-button-modal-close">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Close",{name:"t",hash:{},data:d}))+'</i>\n    </a>\n    <h3 class="modal__head__title">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Error",{name:"t",hash:{},data:d}))+"</h3>\n  </div>\n\n  <p>"+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Sorry, an error occurred. Please log in and try again.",{name:"t",hash:{},data:d}))+'</p>\n  <p><a class="l3" href="/session/new">'+this.escapeExpression((b.t||a&&a.t||b.helperMissing).call(a,"Log in",{name:"t",hash:{},data:d}))+"</a></p>\n</div>\n"},useData:!0});return b.registerPartial("templates/authError",c),c}),define("utils/callback",["lodash"],function(a){"use strict";var b=Number(new Date),c="tedc"+b,d=0;return function(b){var e=c+ ++d,f=this;return window[e]=function(){b.apply(f,a.toArray(arguments)),delete window[e]},e}}),define("utils/iframep",["jquery","utils/callback"],function(a,b){"use strict";return function(c){function d(){"pending"===f.state&&(f.reject(),delete window[g])}function e(){var a=i.contentDocument||i.contentWindow&&i.contentWindow.document;window[g]&&window.setTimeout("complete"===a.readyState?d:e,300)}var f=new a.Deferred,g=b(function(a){f.resolve(a)});c=c.replace("callback=?","callback="+g);var h=a("<iframe></iframe>").css({display:"none",width:0,height:0}).appendTo(document.body),i=h.get(0);return h.ready(e).attr("src",c),f.always(function(){h.remove()}),window.setTimeout(d,5e3),f.promise()}}),define("utils/origin",[],function(){"use strict";return window.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}),define("lib/auth",["jquery","lodash","lib/currentUser","lib/errorCollector","Modernizr","views/AuthPromptView","hbs!templates/authError","utils/callback","utils/iframep","utils/origin","lib/pubSub","utils/ted","exports"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(){var b=new a.Deferred;return b.done(function(a){k("auth.login").publish(a)}),b}function o(){v?v.modal("open"):v=a(g()).modal()}function p(){if(!y)throw new Error("lib/auth: please check auth.capable() to ensure client support before using auth methods.");if(!m.capable())throw o(),new Error("lib/auth: this client is not capable of using auth methods.")}function q(a,b){return'<meta name="'+a+'" content="'+b+'">'}function r(b){a("head").append(q("csrf-param",b.csrf.param)+q("csrf-token",b.csrf.token))}function s(){return i("/session/check?callback=?").done(r)}function t(a,b){return function(c){a.reject(c),m._reportError(b)}}function u(){f||(f=require("views/AuthPromptView"))}var v,w,x,y=!1;window.console;m._openPrompt=function(){x||(u(),x=new f,x.on("close",function(){b.defer(function(){w&&"pending"!==w.state()&&w.reject()})}).on("login.success",function(){m._resolveDetails(w).fail(o)}).render()),x.open()},m._reportError=function(a){d.log(a,{context:"auth"})},m._reset=function(){v&&v.remove(),x&&x.remove(),v=void 0,y=!1,w=void 0,x=void 0},m._resolveDetails=function(a){return c.getDetails().done(function(b){a.resolve(b)})},m.getAuthenticityToken=function(){var b=new a.Deferred;return a.ajax({url:l("authHost")+"/session/new.json",timeout:3e3,type:"GET",xhrFields:{withCredentials:!0}}).then(function(a){b.resolve(a.authenticity_token)},b.reject),b.promise()},m.capable=function(){return y=!0,e.cors},m.facebook=function(){function a(a){a&&a.csrf&&r(a),"pending"===d.state()&&(m._resolveDetails(d).fail(t(d,"unable to corroborate Facebook authentication")),c&&c.close())}p();var b=h(a),c=window.open("/users/new?facebook=true&referer="+encodeURIComponent(j+"/session/check?callback="+b),"authfb",["scrollbars=1","resizable=1","height=480","width=640"].join(",")),d=n(),e=0,f=300,g=1e4,i=window.setInterval(function(){e++,(c&&c.closed||!c&&e*f>g)&&(a(),window[b]&&delete window[b],window.clearInterval(i),i=null)},f);return d.promise()},m.login=function(b,c,d){p();var e=n();return m._resolveDetails(e).then(function(a){e.resolve(a)},function(){m.getAuthenticityToken().then(function(f){a.ajax({url:l("authHost")+"/session.json",timeout:3e3,type:"POST",data:{authenticity_token:f,user:{email:b,password:c,remember_me:d}},xhrFields:{withCredentials:!0}}).then(function(){s().then(function(){m._resolveDetails(e).fail(t(e,"unable to corroborate authentication"))},t(e,"session check timed out"))},t(e,"credentials rejected"))},t(e,"could not obtain token"))}),e.promise()},m.logout=function(){p()},m.prompt=function(){p();var a=n();return w=a,m._resolveDetails(a).fail(m._openPrompt),a.promise()},k("auth.login").subscribe(function(){a(document.documentElement).addClass("loggedin").removeClass("loggedout")}),a(function(){a(document).on("click","a.auth-login",function(a){m.capable()&&(a.preventDefault(),m.prompt())})})}),define("lib/instaplay",["jquery","utils/is_mobile","exports"],function(a,b,c){"use strict";var d="instaplay",e=50,f=15e3;c.capable=function(){return!b()&&this._storage()},c.set=function(b,d){if(c.capable()){var e=c._getStore()||{history:[]};d=a.extend({clearHistory:!0},d||{}),e.url=b,e.time=+new Date,d.clearHistory&&(e.history=[]),c._setStore(e)}},c.check=function(a){if(!c.capable())return!1;var b=c._getStore();return b&&a.indexOf(b.url)!==-1&&+new Date-b.time<f?(b.history=b.history.slice(0,e-1),b.history.push(a),c._setStore(b),!0):(c._clearStore(),!1)},c.history=function(){if(!c.capable())return[];var a=c._getStore();return a?a.history:[]},c.recentMatches=function(a){if(!c.capable())return[];var b=c.history(),d=b.length,e=[];if(d)for(var f=0;f<d&&b[f].match(a);f++)e.push(b[f]);return e},c._getStore=function(){var a=c._storage();if(a){var b=a.getItem(d);if(b&&(b=window.JSON.parse(b),b&&b.url&&b.history&&b.time))return b}},c._setStore=function(a){var b=c._storage();b&&b.setItem(d,window.JSON.stringify(a))},c._clearStore=function(){var a=c._storage();a&&a.removeItem(d)},c._storage=function(){try{var a=window.sessionStorage,b=d+"-test",c="1";if(a.setItem(b,c),a.getItem(b)===c)return a.removeItem(b),a}catch(a){}return null},a(function(){a(document).on("click","a.instaplay-link",function(){c.set(a(this).attr("href"))})})}),require(["jquery","lodash","dq","components/main-nav/index","global/links","global/subscribe","global/uconf","global/keyboard","global/track-a-block","lib/ads","lib/ga","global/errors","lib/auth","lib/instaplay","jqueryujs"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";b.defer(function(){e.init(),f.init(),h.init(),i.init()});var l=window.console;l&&l.log&&l.log(["%cAre you a web tinkerer? Join us at TED!","https://www.ted.com/jobs"].join("\n"),"color:#E62B1E"),c({q:_g,modules:{ads:j,tab:i,ga:k,mainNav:d,uconf:g}})}),define("global",function(){}),define("search",["dq","search/browse","search/results","global"],function(a,b,c){"use strict";a({modules:{browse:b,results:c}})})}();