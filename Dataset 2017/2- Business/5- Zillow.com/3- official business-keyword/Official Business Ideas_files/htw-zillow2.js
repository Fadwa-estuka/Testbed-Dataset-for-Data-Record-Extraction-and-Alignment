function cygnus_index_start(){}window.headertag=window.headertag||{},/homes/.test(window.location.pathname)?window.headertag.pagetype="searchResults":/b/.test(window.location.pathname)?window.headertag.pagetype="buildingDetailsPage":/homedetails/.test(window.location.pathname)?window.headertag.pagetype="homeDetailsPage":/advice/.test(window.location.pathname)?window.headertag.pagetype="advicePage":/^\/$/.test(window.location.pathname)?window.headertag.pagetype="homePage":/how-much-is-my-home-worth/.test(window.location.pathname)?window.headertag.pagetype="sellPage":window.headertag.pagetype="default",window.headertagconfig=window.headertagconfig||{},window.headertagconfig={timeout:1e3,siteId:183339,enableSingleRequest:!1,disableInitialLoad:!1,partners:{}},window.headertagconfig.partners.INDX={targetingType:"slot",timeout:1e3,idType:"adUnit",prefetch:{enabled:!0,info:{searchResults:{requiredIndexSlots:["4"]},buildingDetailsPage:{requiredIndexSlots:["1","4","6"]},homeDetailsPage:{requiredIndexSlots:["1","2","3","4","5","6"]},advicePage:{requiredIndexSlots:["4","6"]},homePage:{requiredIndexSlots:[]},sellPage:{requiredIndexSlots:[]},"default":{requiredIndexSlots:["1","2","3","4","5","6"]}}},publicKey:"O",privateKey:"P"},window.headertagconfig.partners.DISM={share:.9,targetingType:"slot",timeout:1e3,idType:"adUnit",disabled:!1,adUnits:[{code:"b_right_p2",sizes:[[300,250]],bids:[{params:{placementId:"6457931"}}]},{code:"b_right_p3",sizes:[[300,250]],bids:[{params:{placementId:"6457931"}}]},{code:"b_right_p4",sizes:[[300,250]],bids:[{params:{placementId:"6457931"}}]},{code:"b_main_p1",sizes:[[728,90]],bids:[{params:{placementId:"6457957"}}]},{code:"b_right_p1",sizes:[[300,250],[300,600]],bids:[{params:{placementId:"6457929"}},{params:{placementId:"6459938"}}]}],prefetch:{enabled:!0,info:{searchResults:{divIds:["b_right_p1"]},buildingDetailsPage:{divIds:["b_right_p1","b_main_p1"]},homeDetailsPage:{divIds:["b_right_p1","b_right_p2","b_right_p3","b_right_p4","b_main_p1"]},advicePage:{divIds:["b_right_p1","b_main_p1"]}}},roundingBuckets:{type:1,buckets:[{range:[0,20],granularity:.05},{range:[20,50],granularity:1}]}},"searchResults"!=window.headertag.pagetype&&"advicePage"!=window.headertag.pagetype||(window.headertagconfig.partners.DISM.adUnits=[{code:"b_right_p2",sizes:[[300,250]],bids:[{params:{placementId:"6457931"}}]},{code:"b_right_p3",sizes:[[300,250]],bids:[{params:{placementId:"6457931"}}]},{code:"b_right_p4",sizes:[[300,250]],bids:[{params:{placementId:"6457931"}}]},{code:"b_main_p1",sizes:[[728,90]],bids:[{params:{placementId:"6457957"}}]},{code:"b_right_p1",sizes:[[300,250]],bids:[{params:{placementId:"6457929"}}]}]),window.headertagconfig.partners.APNX={targetingType:"slot",timeout:1e3,idType:"adUnit",adUnits:[{code:"b_right_p2",sizes:[[300,250]],bids:[{bidder:"appnexus",params:{placementId:"8500479"}}]},{code:"b_right_p3",sizes:[[300,250]],bids:[{bidder:"appnexus",params:{placementId:"8500479"}}]},{code:"b_right_p4",sizes:[[300,250]],bids:[{bidder:"appnexus",params:{placementId:"8500479"}}]},{code:"b_main_p1",sizes:[[728,90]],bids:[{bidder:"appnexus",params:{placementId:"8500692"}}]},{code:"b_right_p1",sizes:[[300,250],[300,600]],bids:[{bidder:"appnexus",params:{placementId:"8500178"}},{bidder:"appnexus",params:{placementId:"8500931"}}]}],roundingBuckets:{type:1,buckets:[{range:[0,20],granularity:.05},{range:[20,50],granularity:1}]},prefetch:{enabled:!0,info:{searchResults:{divIds:["b_right_p1"]},buildingDetailsPage:{divIds:["b_right_p1","b_main_p1"]},homeDetailsPage:{divIds:["b_right_p1","b_right_p2","b_right_p3","b_right_p4","b_main_p1"]},advicePage:{divIds:["b_right_p1","b_main_p1"]}}}},"searchResults"==window.headertag.pagetype&&(window.headertagconfig.partners.APNX.adUnits=[{code:"b_right_p2",sizes:[[300,250]],bids:[{bidder:"appnexus",params:{placementId:"8500479"}}]},{code:"b_right_p3",sizes:[[300,250]],bids:[{bidder:"appnexus",params:{placementId:"8500479"}}]},{code:"b_right_p4",sizes:[[300,250]],bids:[{bidder:"appnexus",params:{placementId:"8500479"}}]},{code:"b_main_p1",sizes:[[728,90]],bids:[{bidder:"appnexus",params:{placementId:"8500692"}}]},{code:"b_right_p1",sizes:[[300,250]],bids:[{bidder:"appnexus",params:{placementId:"8500178"}}]}]),function(){"use strict";window.headertag.Q=function(){function e(e){return function(){return W.apply(e,arguments)}}function t(e){return e===Object(e)}function r(e){return"[object StopIteration]"===re(e)||e instanceof F}function n(e,t){if(L&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(ne)){for(var r=[],n=t;n;n=n.source)n.stack&&r.unshift(n.stack);r.unshift(e.stack);var a=r.join("\n"+ne+"\n");e.stack=i(a)}}function i(e){for(var t=e.split("\n"),r=[],n=0;n<t.length;++n){var i=t[n];s(i)||a(i)||!i||r.push(i)}return r.join("\n")}function a(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function o(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(r)return[r[1],Number(r[2])];var n=/.*@(.+):(\d+)$/.exec(e);return n?[n[1],Number(n[2])]:void 0}function s(e){var t=o(e);if(!t)return!1;var r=t[0],n=t[1];return r===K&&n>=H&&de>=n}function d(){if(L)try{throw new Error}catch(e){var t=e.stack.split("\n"),r=t[0].indexOf("@")>0?t[1]:t[2],n=o(r);if(!n)return;return K=n[0],n[1]}}function p(e,t,r){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+r+" instead.",new Error("").stack),e.apply(e,arguments)}}function u(e){return e instanceof h?e:v(e)?D(e):_(e)}function l(){function e(e){t=e,a.source=e,Q(r,function(t,r){u.nextTick(function(){e.promiseDispatch.apply(e,r)})},void 0),r=void 0,n=void 0}var t,r=[],n=[],i=Z(l.prototype),a=Z(h.prototype);if(a.promiseDispatch=function(e,i,a){var o=X(arguments);r?(r.push(o),"when"===i&&a[1]&&n.push(a[1])):u.nextTick(function(){t.promiseDispatch.apply(t,o)})},a.valueOf=function(){if(r)return a;var e=m(t);return y(e)&&(t=e),e},a.inspect=function(){return t?t.inspect():{state:"pending"}},u.longStackSupport&&L)try{throw new Error}catch(o){a.stack=o.stack.substring(o.stack.indexOf("\n")+1)}return i.promise=a,i.resolve=function(r){t||e(u(r))},i.fulfill=function(r){t||e(_(r))},i.reject=function(r){t||e(O(r))},i.notify=function(e){t||Q(n,function(t,r){u.nextTick(function(){r(e)})},void 0)},i}function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=l();try{e(t.resolve,t.reject,t.notify)}catch(r){t.reject(r)}return t.promise}function f(e){return c(function(t,r){for(var n=0,i=e.length;i>n;n++)u(e[n]).then(t,r)})}function h(e,t,r){void 0===t&&(t=function(e){return O(new Error("Promise does not support operation: "+e))}),void 0===r&&(r=function(){return{state:"unknown"}});var n=Z(h.prototype);if(n.promiseDispatch=function(r,i,a){var o;try{o=e[i]?e[i].apply(n,a):t.call(n,i,a)}catch(s){o=O(s)}r&&r(o)},n.inspect=r,r){var i=r();"rejected"===i.state&&(n.exception=i.reason),n.valueOf=function(){var e=r();return"pending"===e.state||"rejected"===e.state?n:e.value}}return n}function g(e,t,r,n){return u(e).then(t,r,n)}function m(e){if(y(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function y(e){return e instanceof h}function v(e){return t(e)&&"function"==typeof e.then}function b(e){return y(e)&&"pending"===e.inspect().state}function w(e){return!y(e)||"fulfilled"===e.inspect().state}function I(e){return y(e)&&"rejected"===e.inspect().state}function T(){ie.length=0,ae.length=0,se||(se=!0)}function S(e,t){se&&("object"==typeof process&&"function"==typeof process.emit&&u.nextTick.runAfter(function(){-1!==$(ae,e)&&(process.emit("unhandledRejection",t,e),oe.push(e))}),ae.push(e),t&&"undefined"!=typeof t.stack?ie.push(t.stack):ie.push("(no stack) "+t))}function P(e){if(se){var t=$(ae,e);-1!==t&&("object"==typeof process&&"function"==typeof process.emit&&u.nextTick.runAfter(function(){var r=$(oe,e);-1!==r&&(process.emit("rejectionHandled",ie[t],e),oe.splice(r,1))}),ae.splice(t,1),ie.splice(t,1))}}function O(e){var t=h({when:function(t){return t&&P(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return S(t,e),t}function _(e){return h({when:function(){return e},get:function(t){return e[t]},set:function(t,r){e[t]=r},"delete":function(t){delete e[t]},post:function(t,r){return null===t||void 0===t?e.apply(void 0,r):e[t].apply(e,r)},apply:function(t,r){return e.apply(t,r)},keys:function(){return te(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function D(e){var t=l();return u.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(r){t.reject(r)}}),t.promise}function x(e){return h({isDef:function(){}},function(t,r){return N(e,t,r)},function(){return u(e).inspect()})}function R(e,t,r){return u(e).spread(t,r)}function E(e){return function(){function t(e,t){var o;if("undefined"==typeof StopIteration){try{o=n[e](t)}catch(s){return O(s)}return o.done?u(o.value):g(o.value,i,a)}try{o=n[e](t)}catch(s){return r(s)?u(s.value):O(s)}return g(o,i,a)}var n=e.apply(this,arguments),i=t.bind(t,"next"),a=t.bind(t,"throw");return i()}}function k(e){u.done(u.async(e)())}function A(e){throw new F(e)}function U(e){return function(){return R([this,j(arguments)],function(t,r){return e.apply(t,r)})}}function N(e,t,r){return u(e).dispatch(t,r)}function j(e){return g(e,function(e){var t=0,r=l();return Q(e,function(n,i,a){var o;y(i)&&"fulfilled"===(o=i.inspect()).state?e[a]=o.value:(++t,g(i,function(n){e[a]=n,0===--t&&r.resolve(e)},r.reject,function(e){r.notify({index:a,value:e})}))},void 0),0===t&&r.resolve(e),r.promise})}function q(e){if(0===e.length)return u.resolve();var t=u.defer(),r=0;return Q(e,function(n,i,a){function o(e){t.resolve(e)}function s(){r--,0===r&&t.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function d(e){t.notify({index:a,value:e})}var p=e[a];r++,g(p,o,s,d)},void 0),t.promise}function z(e){return g(e,function(e){return e=J(e,u),g(j(J(e,function(e){return g(e,Y,Y)})),function(){return e})})}function M(e){return u(e).allSettled()}function C(e,t){return u(e).then(void 0,void 0,t)}function B(e,t){return u(e).nodeify(t)}var L=!1;try{throw new Error}catch(G){L=!!G.stack}var K,F,H=d(),Y=function(){},V=function(){function e(){for(var e,n;r.next;)r=r.next,e=r.task,r.task=void 0,n=r.domain,n&&(r.domain=void 0,n.enter()),t(e,n);for(;s.length;)e=s.pop(),t(e);i=!1}function t(t,r){try{t()}catch(n){if(o)throw r&&r.exit(),setTimeout(e,0),r&&r.enter(),n;setTimeout(function(){throw n},0)}r&&r.exit()}var r={task:void 0,next:null},n=r,i=!1,a=void 0,o=!1,s=[];if(V=function(e){n=n.next={task:e,domain:o&&process.domain,next:null},i||(i=!0,a())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)o=!0,a=function(){process.nextTick(e)};else if("function"==typeof setImmediate)a="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var d=new MessageChannel;d.port1.onmessage=function(){a=p,d.port1.onmessage=e,e()};var p=function(){d.port2.postMessage(0)};a=function(){setTimeout(e,0),p()}}else a=function(){setTimeout(e,0)};return V.runAfter=function(e){s.push(e),i||(i=!0,a())},V}(),W=Function.call,X=e(Array.prototype.slice),Q=e(Array.prototype.reduce||function(e,t){var r=0,n=this.length;if(1===arguments.length)for(;;){if(r in this){t=this[r++];break}if(++r>=n)throw new TypeError}for(;n>r;r++)r in this&&(t=e(t,this[r],r));return t}),$=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),J=e(Array.prototype.map||function(e,t){var r=this,n=[];return Q(r,function(i,a,o){n.push(e.call(t,a,o,r))},void 0),n}),Z=Object.create||function(e){function t(){}return t.prototype=e,new t},ee=e(Object.prototype.hasOwnProperty),te=Object.keys||function(e){var t=[];for(var r in e)ee(e,r)&&t.push(r);return t},re=e(Object.prototype.toString);F="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var ne="From previous event:";u.resolve=u,u.nextTick=V,u.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(u.longStackSupport=!0),u.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(t,r){t?e.reject(t):arguments.length>2?e.resolve(X(arguments,1)):e.resolve(r)}},u.Promise=c,u.promise=c,c.race=f,c.all=j,c.reject=O,c.resolve=u,u.passByCopy=function(e){return e},h.prototype.passByCopy=function(){return this},u.join=function(e,t){return u(e).join(t)},h.prototype.join=function(e){return u([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},u.race=f,h.prototype.race=function(){return this.then(u.race)},u.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(e,t,r){function i(t){try{return"function"==typeof e?e(t):t}catch(r){return O(r)}}function a(e){if("function"==typeof t){n(e,s);try{return t(e)}catch(r){return O(r)}}return O(e)}function o(e){return"function"==typeof r?r(e):e}var s=this,d=l(),p=!1;return u.nextTick(function(){s.promiseDispatch(function(e){p||(p=!0,d.resolve(i(e)))},"when",[function(e){p||(p=!0,d.resolve(a(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,r=!1;try{t=o(e)}catch(n){if(r=!0,!u.onerror)throw n;u.onerror(n)}r||d.notify(t)}]),d.promise},u.tap=function(e,t){return u(e).tap(t)},h.prototype.tap=function(e){return e=u(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},u.when=g,h.prototype.thenResolve=function(e){return this.then(function(){return e})},u.thenResolve=function(e,t){return u(e).thenResolve(t)},h.prototype.thenReject=function(e){return this.then(function(){throw e})},u.thenReject=function(e,t){return u(e).thenReject(t)},u.nearer=m,u.isPromise=y,u.isPromiseAlike=v,u.isPending=b,h.prototype.isPending=function(){return"pending"===this.inspect().state},u.isFulfilled=w,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},u.isRejected=I,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ie=[],ae=[],oe=[],se=!0;u.resetUnhandledRejections=T,u.getUnhandledReasons=function(){return ie.slice()},u.stopUnhandledRejectionTracking=function(){T(),se=!1},T(),u.reject=O,u.fulfill=_,u.master=x,u.spread=R,h.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},u.async=E,u.spawn=k,u["return"]=A,u.promised=U,u.dispatch=N,h.prototype.dispatch=function(e,t){var r=this,n=l();return u.nextTick(function(){r.promiseDispatch(n.resolve,e,t)}),n.promise},u.get=function(e,t){return u(e).dispatch("get",[t])},h.prototype.get=function(e){return this.dispatch("get",[e])},u.set=function(e,t,r){return u(e).dispatch("set",[t,r])},h.prototype.set=function(e,t){return this.dispatch("set",[e,t])},u.del=u["delete"]=function(e,t){return u(e).dispatch("delete",[t])},h.prototype.del=h.prototype["delete"]=function(e){return this.dispatch("delete",[e])},u.mapply=u.post=function(e,t,r){return u(e).dispatch("post",[t,r])},h.prototype.mapply=h.prototype.post=function(e,t){return this.dispatch("post",[e,t])},u.send=u.mcall=u.invoke=function(e,t){return u(e).dispatch("post",[t,X(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(e){return this.dispatch("post",[e,X(arguments,1)])},u.fapply=function(e,t){return u(e).dispatch("apply",[void 0,t])},h.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},u["try"]=u.fcall=function(e){return u(e).dispatch("apply",[void 0,X(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},u.fbind=function(e){var t=u(e),r=X(arguments,1);return function(){return t.dispatch("apply",[this,r.concat(X(arguments))])}},h.prototype.fbind=function(){var e=this,t=X(arguments);return function(){return e.dispatch("apply",[this,t.concat(X(arguments))])}},u.keys=function(e){return u(e).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},u.all=j,h.prototype.all=function(){return j(this)},u.any=q,h.prototype.any=function(){return q(this)},u.allResolved=p(z,"allResolved","allSettled"),h.prototype.allResolved=function(){return z(this)},u.allSettled=M,h.prototype.allSettled=function(){return this.then(function(e){return j(J(e,function(e){function t(){return e.inspect()}return e=u(e),e.then(t,t)}))})},u.fail=u["catch"]=function(e,t){return u(e).then(void 0,t)},h.prototype.fail=h.prototype["catch"]=function(e){return this.then(void 0,e)},u.progress=C,h.prototype.progress=function(e){return this.then(void 0,void 0,e)},u.fin=u["finally"]=function(e,t){return u(e)["finally"](t)},h.prototype.fin=h.prototype["finally"]=function(e){return e=u(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},u.done=function(e,t,r,n){return u(e).done(t,r,n)},h.prototype.done=function(e,t,r){var i=function(e){u.nextTick(function(){if(n(e,a),!u.onerror)throw e;u.onerror(e)})},a=e||t||r?this.then(e,t,r):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),a.then(void 0,i)},u.timeout=function(e,t,r){return u(e).timeout(t,r)},h.prototype.timeout=function(e,t){var r=l(),n=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),r.reject(t)},e);return this.then(function(e){clearTimeout(n),r.resolve(e)},function(e){clearTimeout(n),r.reject(e)},r.notify),r.promise},u.delay=function(e,t){return void 0===t&&(t=e,e=void 0),u(e).delay(t)},h.prototype.delay=function(e){return this.then(function(t){var r=l();return setTimeout(function(){r.resolve(t)},e),r.promise})},u.nfapply=function(e,t){return u(e).nfapply(t)},h.prototype.nfapply=function(e){var t=l(),r=X(e);return r.push(t.makeNodeResolver()),this.fapply(r).fail(t.reject),t.promise},u.nfcall=function(e){var t=X(arguments,1);return u(e).nfapply(t)},h.prototype.nfcall=function(){var e=X(arguments),t=l();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},u.nfbind=u.denodeify=function(e){var t=X(arguments,1);return function(){var r=t.concat(X(arguments)),n=l();return r.push(n.makeNodeResolver()),u(e).fapply(r).fail(n.reject),n.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var e=X(arguments);return e.unshift(this),u.denodeify.apply(void 0,e)},u.nbind=function(e,t){var r=X(arguments,2);return function(){function n(){return e.apply(t,arguments)}var i=r.concat(X(arguments)),a=l();return i.push(a.makeNodeResolver()),u(n).fapply(i).fail(a.reject),a.promise}},h.prototype.nbind=function(){var e=X(arguments,0);return e.unshift(this),u.nbind.apply(void 0,e)},u.nmapply=u.npost=function(e,t,r){return u(e).npost(t,r)},h.prototype.nmapply=h.prototype.npost=function(e,t){var r=X(t||[]),n=l();return r.push(n.makeNodeResolver()),this.dispatch("post",[e,r]).fail(n.reject),n.promise},u.nsend=u.nmcall=u.ninvoke=function(e,t){var r=X(arguments,2),n=l();return r.push(n.makeNodeResolver()),u(e).dispatch("post",[t,r]).fail(n.reject),n.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(e){var t=X(arguments,1),r=l();return t.push(r.makeNodeResolver()),this.dispatch("post",[e,t]).fail(r.reject),r.promise},u.nodeify=B,h.prototype.nodeify=function(e){return e?void this.then(function(t){u.nextTick(function(){e(null,t)})},function(t){u.nextTick(function(){e(t)})}):this},u.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var de=d();return u}()}(),function(){"use strict";var e={};e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.divIdToSlot=function(t){for(var r=e.getSlots(),n=0,i=r.length;i>n;n++)if(r[n].getSlotElementId()===t)return r[n];return null},e.getDivIdToSlotMap=function(t){t||(t=e.getSlots());for(var r={},n=0,i=t.length;i>n;n++)r[t[n].getSlotElementId()]=t[n];return r},e.getDivIds=function(t){t||(t=e.getSlots());for(var r=[],n=0,i=t.length;i>n;n++)r.push(t[n].getSlotElementId());return r},e.objToQueryString=function(e){var t="?";for(var r in e)e.hasOwnProperty(r)&&(t+=r+"="+e[r]+"&");return t.slice(0,-1)},e.generateCorrelator=function(){return"_"+String((new Date).getTime()%2592e6)+String(Math.floor(16384*Math.random()))},e.getSlots=function(){return window.googletag&&window.googletag.apiReady?googletag.pubads().getSlots().slice():null},e.isInteger=function(e){return"number"==typeof e&&e%1===0},e.validateNonEmptyString=function(e,t){return!!(t&&!e||e&&"string"==typeof e)},e.validateFunction=function(e,t){return!!(t&&!e||e&&"function"==typeof e)},e.validateNonEmptyArray=function(t,r){return!!(r&&!t||t&&e.isArray(t)&&t.length)},e.validateNonEmptyObject=function(t,r){return!!(r&&!t||t&&"object"==typeof t&&!e.isEmpty(t))},e.validateInteger=function(t,r,n,i){return!!(i&&"number"!=typeof t||"number"==typeof t&&e.isInteger(t)&&("number"==typeof r?t>=r:!0)&&("number"==typeof n?n>=t:!0))},e.validateBoolean=function(e,t){return!!(t&&"boolean"!=typeof e||"boolean"==typeof e)},e.isMobile=function(){return-1!==navigator.userAgent.indexOf("Mobi")},e.now=function(){return(new Date).getTime()},e.addScriptTag=function(e,t,r){var n=document.createElement("script");n.type="text/javascript",n.async=t,n.src=("https:"===document.location.protocol?"https:":"http:")+e,n.onload=r,n.readyState&&(n.onreadystatechange=function(){"loaded"!==n.readyState&&"complete"!==n.readyState||(n.onreadystatechange=null,r())});var i=document.getElementsByTagName("script")[0];return i.parentNode.insertBefore(n,i),n},e.localStorageSupported=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},e.getProtocol=function(){return"https:"===document.location.protocol?"https:":"http:"},e.getPageUrl=function(){try{return window.top.location.href}catch(e){return window.location.href}},window.headertag.Utils=e}(),function(){"use strict";function e(e){function t(e){d[e]=d[e]||{},d[e].startTime=n.now()}function r(e){d.hasOwnProperty(e)&&(d[e].stopTime=n.now())}function i(e,t,r){d[e].partners=d[e].partners||{},d[e].partners[t]=d[e].partners[t]||{},d[e].partners[t].timeout=r,d[e].partners[t].startTime=n.now()}function a(e,t){d.hasOwnProperty(e)&&(d[e].partners[t].stopTime=n.now())}function o(e,t,r,n){d.hasOwnProperty(e)&&(d[e].partners[t].targetingType=r,d[e].partners[t].returnedDemand=n)}function s(t){if(d.hasOwnProperty(t)){var r={};r.s=e,r.u=encodeURIComponent(document.location.href),r.type="RT",r.r=t.replace("_",""),r.t0=d[t].startTime,r.t1=d[t].stopTime||-1;var i=d[t].partners;for(var a in i)if(i.hasOwnProperty(a)){var o=-1,s=1;i[a].startTime&&i[a].stopTime&&(o=i[a].stopTime-i[a].startTime,s=0),r[a+".t"]=o,r[a+".to"]=s,r[a+".ts"]=i[a].timeout||-1;var p=null;if(i[a].hasOwnProperty("returnedDemand"))if("page"===i[a].targetingType)for(p in i[a].returnedDemand.page.demand)i[a].returnedDemand.page.demand.hasOwnProperty(p)&&(r[a+".p.pl."+p]=i[a].returnedDemand.page.demand[p].toString()||"");else for(var u in i[a].returnedDemand.slot)if(i[a].returnedDemand.slot.hasOwnProperty(u))for(p in i[a].returnedDemand.slot[u].demand)i[a].returnedDemand.slot[u].demand.hasOwnProperty(p)&&(r[a+".p."+u+"."+p]=i[a].returnedDemand.slot[u].demand[p].toString()||"")}var l=n.objToQueryString(r),c=("https:"===document.location.protocol?"https://as-sec.":"http://as.")+"casalemedia.com/headerstats"+l,f=new XMLHttpRequest;f.open("GET",c,!0),f.send(),delete d[t]}}var d={};this.startSessionTimer=t,this.stopSessionTimer=r,this.startPartnerTimer=i,this.stopPartnerTimer=a,this.recordReturnedDemand=o,this.sendReport=s}function t(t){function i(e,r){function i(r,i){if((!r||i)&&(x[e]=i,R[e]=t.partners[e].disabled,E[e]=t.partners[e].timeout,!C&&i.getSupportedOptions().hasOwnProperty("prefetch")&&i.getSupportedOptions().prefetch&&t.partners[e].hasOwnProperty("prefetch")&&t.partners[e].prefetch.enabled)){var a=n.generateCorrelator();q.startSessionTimer(a),q.startPartnerTimer(a,e,E[e]);var o=function(){q.stopPartnerTimer(a,e),q.stopSessionTimer(a),q.sendReport(a)},s=i.getPartnerTargetingType();"page"===s?i.prefetchDemand(a,M,o):t.partners[e].prefetch.hasOwnProperty("info")&&window.headertag.pagetype&&t.partners[e].prefetch.info.hasOwnProperty(window.headertag.pagetype)&&i.prefetchDemand(a,t.partners[e].prefetch.info[window.headertag.pagetype],o)}}var a=[];return n.validateNonEmptyString(e)||a.push("partnerId must be a non-empty string."),x.hasOwnProperty(e)&&a.push("partnerId already registered."),n.validateFunction(r)||a.push("init must be a function."),a.length?!1:(t.partners.hasOwnProperty(e)&&r(t.partners[e],i),!0)}function a(e,t){var r=[];if(n.validateNonEmptyArray(e)||r.push("partnerIds must be a non-empty array."),n.validateBoolean(t)||r.push("toggle must be a boolean."),r.length)return!1;for(var i=!1,a=0,o=e.length;o>a;a++)if(x.hasOwnProperty(e[a])){if("INDX"===e[a])continue;R[e[a]]=t,i=!0}return i}function o(e){var t=[];return n.validateInteger(e,1)||t.push("timeout must be an interger and greater than 0."),t.length?!1:(D=e,!0)}function s(e){return a(e,!1)}function d(e){return a(e,!0)}function p(e,t){var r=[];return n.validateInteger(t,0)||r.push("timeout must be an interger and greater than or equal to 0."),E.hasOwnProperty(e)||r.push("partnerId not registered and instantiated."),r.length?!1:(E[e]=t,!0)}function u(e,t){var r=[];return n.validateNonEmptyString(e)||r.push("partnerId must be a non-empty string."),x.hasOwnProperty(e)||r.push("partnerId is not registered."),n.validateNonEmptyString(t)||r.push("targetingType must be a non-empty string."),r.length?!1:x[e].setPartnerTargetingType(t)}function l(e){e||(e=n.getSlots());for(var t,r={},i=0;i<e.length;i++)t=n.getId(e[i]),r[t]=e[i];return r}function c(e,t){if(n.validateNonEmptyObject(e)){var r=l(t),i=null,a=null;for(var o in e)if(e.hasOwnProperty(o))if(e[o].hasOwnProperty("page"))for(a in e[o].page.demand)e[o].page.demand.hasOwnProperty(a)&&(googletag.pubads().setTargeting(a,e[o].page.demand[a]),z.page[a]=!0);else if(e[o].hasOwnProperty("slot"))for(i in r)if(r.hasOwnProperty(i)&&e[o].slot.hasOwnProperty(i))for(a in e[o].slot[i].demand)e[o].slot[i].demand.hasOwnProperty(a)&&(r[i].setTargeting(a,e[o].slot[i].demand[a]),z.slot[i]=z.slot[i]||{},z.slot[i][a]=!0)}}function f(e){var t=null;for(t in z.page)z.page.hasOwnProperty(t)&&(googletag.pubads().clearTargeting(t),delete z.page[t]);for(var r=0;r<e.length;r++){var i=n.getId(e[r]);if(z.slot.hasOwnProperty(i)){var a=e[r].getTargetingMap();e[r].clearTargeting();for(t in a)a.hasOwnProperty(t)&&(z.slot[i].hasOwnProperty(t)||e[r].setTargeting(t,a[t]));delete z.slot[i]}}}function h(e){f(e.slots),c(e.demand,e.slots),e.divId?googletag.display(e.divId):googletag.pubads().refresh(e.slots,e.opt)}function g(e,t,i,a){var o=[];if(n.validateNonEmptyString(e)||o.push("correlator must be a non-empty string."),n.validateNonEmptyString(i)||o.push("partnerId must be a non-empty string."),x.hasOwnProperty(i)||o.push("partnerId not registered and instantiated."),n.validateNonEmptyArray(a)||o.push("slots must be a non-empty array."),o.length)return null;var s=r.defer(),d=null,p=!1,u=x[i].getPartnerTargetingType(),l=function(t,r){if(!p){if(clearTimeout(d),x[i].getSupportedAnalytics().time&&q.stopPartnerTimer(e,i),t)return void s.reject();if(!n.validateNonEmptyObject(r))return void s.reject();x[i].getSupportedAnalytics().demand&&q.recordReturnedDemand(e,i,u,r);var a={};a[i]=r,s.resolve(a)}};return E[i]&&(d=setTimeout(function(){p=!0,s.reject()},E[i])),x[i].getSupportedAnalytics().time&&q.startPartnerTimer(e,i,E[i]),"page"===u?x[i].getDemand(e,t,l):x[i].getDemand(e,a,l),s.promise}function m(e){for(var t={},r=0,n=e.length;n>r;r++)if("fulfilled"===e[r].state){var i=e[r].value;for(var a in i)if(i.hasOwnProperty(a))if(t.hasOwnProperty(a)){if(i[a].hasOwnProperty("page"))t[a].page.timestamp<i[a].page.timestamp&&(t[a]=i[a]);else if(i[a].hasOwnProperty("slot"))for(var o in i[a].slot)i[a].slot.hasOwnProperty(o)&&(t[a].slot.hasOwnProperty(o)?t[a].slot[o].timestamp<i[a].slot[o].timestamp&&(t[a].slot[o]=i[a].slot[o]):t[a].slot[o]=i[a].slot[o])}else t[a]=i[a]}return t}function y(e,t,i,a){var o=r.defer(),s=[];if(n.validateNonEmptyString(e)||s.push("correlator must be a non-empty string."),n.validateNonEmptyArray(i)||s.push("slots must be a non-empty array."),n.validateNonEmptyString(a)||s.push("action must be a non-empty string."),s.length)return o.resolve(),o.promise;i=i.slice();var d=[],p={};for(var u in x)x.hasOwnProperty(u)&&(p[u]=i.slice());for(var l=i.length-1;l>=0;l--){var c=n.getId(i[l]);if(k.hasOwnProperty(c)){d.indexOf(k[c])<0&&d.push(k[c]);var f=n.now(),h=k[c].inspect();if("fulfilled"===h.state){var y=h.value;for(var v in y)if(y.hasOwnProperty(v))if(x[v].getPartnerDemandExpiry()<0)p[v].splice(p[v].indexOf(i[l]),1);else if(y[v].hasOwnProperty("page")){if(y[v].page.gCorrelator!==t)continue;if(f-y[v].page.timestamp>x[v].getPartnerDemandExpiry())continue;p[v].splice(p[v].indexOf(i[l]),1)}else if(y[v].hasOwnProperty("slot")){if(!y[v].slot.hasOwnProperty(c))continue;if(f-y[v].slot[c].timestamp>x[v].getPartnerDemandExpiry())continue;p[v].splice(p[v].indexOf(i[l]),1)}}else for(var b in x)x.hasOwnProperty(b)&&p[b].splice(p[b].indexOf(i[l]),1)}else k[c]=o.promise}("display"!==a||i.length)&&q.startSessionTimer(e);for(var w in x)if(x.hasOwnProperty(w)&&!R[w]&&p[w].length){var I=g(e,t,w,p[w]);d.push(I)}var T=null,S=!1;return D&&(T=setTimeout(function(){S=!0;for(var e=[],t=0,r=d.length;r>t;t++)e.push(d[t].inspect());var s=m(e);if("display"!==a||!N)for(var t=0;t<i.length;t++){var p=n.getId(i[t]);k.hasOwnProperty(p)&&delete k[p]}o.resolve(s)},D)),r.allSettled(d).then(function(t){if(!S){clearTimeout(T),("display"!==a||i.length)&&q.stopSessionTimer(e);var r=m(t);if("display"!==a||!N)for(var s=0;s<i.length;s++){var d=n.getId(i[s]);k.hasOwnProperty(d)&&delete k[d]}o.resolve(r)}}),o.promise}function v(e){var t=[];if(n.validateNonEmptyString(e)||t.push("Invalid divId."),!t.length){C=!0;var r=null;j?A?r=[n.divIdToSlot(e)]:(A=!0,r=n.getSlots()):r=[n.divIdToSlot(e)];var i=n.generateCorrelator();y(i,M,r,"display").then(function(t){if(N)return void googletag.display(e);var n={demand:t,slots:r,divId:e,correlator:i};return h(n)}).then(function(){q.sendReport(i)})["catch"](function(e){})}}function b(e,t,r,i){var a=[];if(n.validateNonEmptyString(e)||a.push("adUnitPath must be a non-empty string."),n.validateNonEmptyArray(t)||a.push("size must be a non-empty array."),n.validateNonEmptyString(r,!0)||a.push("Optional. divId must be a non-empty string."),n.validateNonEmptyString(i,!0)||a.push("Optional. clickUrl must be a non-empty string."),!a.length){var o=googletag.defineSlot(e,t,r).addService(googletag.pubads());i&&o.setClickUrl(i),v(r)}}function w(e,t){var r=[];if(n.validateNonEmptyArray(e,!0)||r.push("Optional. slots must be a non-empty array."),n.validateNonEmptyObject(t,!0)||r.push("Optional. options must be a non-empty object."),!r.length){e&&e.length||(e=n.getSlots());var i=n.generateCorrelator();N&&!U?U=!0:M=googletag.pubads().getCorrelator(),y(i,M,e,"refresh").then(function(r){if(j){var n={demand:r,slots:e,opt:t,correlator:i};h(n)}else for(var a=0,o=e.length;o>a;a++)h({demand:r,slots:[e[a]],opt:t,correlator:i})}).then(function(){q.sendReport(i)})["catch"](function(e){})}}function I(){return{display:b.bind(T),refresh:w.bind(T)}}var T=this,S=[],P=[];n.validateNonEmptyObject(t)||P.push("Config not provided."),t.hasOwnProperty("siteId")&&n.validateInteger(t.siteId,0)||(t.siteId=0,S.push("Invalid siteId, using default value of 0.")),t.hasOwnProperty("timeout")&&n.validateInteger(t.timeout,1)||(t.timeout=1e3,S.push("Invalid timeout, using default value of 1000ms.")),t.hasOwnProperty("disableInitialLoad")?n.validateBoolean(t.disableInitialLoad)||(t.disableInitialLoad=!1,S.push("Invalid disableInitialLoad, using default value of false.")):t.disableInitialLoad=!1,t.hasOwnProperty("enableSingleRequest")?n.validateBoolean(t.enableSingleRequest)||(t.enableSingleRequest=!0,
S.push("Invalid enableSingleRequest, using default value of true.")):(t.enableSingleRequest=!0,S.push("enableSingleRequest not provided, using default value of true.")),t.partners&&t.partners.hasOwnProperty("INDX")||(t.partners=t.partners||{},t.partners.INDX={});for(var O in t.partners)t.partners.hasOwnProperty(O)&&(t.partners[O].hasOwnProperty("disabled")?(n.validateBoolean(t.partners[O].disabled)||(S.push("Invalid disabled set for "+O+", using default value true."),t.partners[O].disabled=!0),"INDX"===O&&t.partners[O].disabled===!0&&(t.partners[O].disabled=!1,S.push("Cannot disable partner INDX."))):t.partners[O].disabled=!1,t.partners[O].hasOwnProperty("timeout")?n.validateInteger(t.partners[O].timeout,0)||(S.push("Invalid partner timeout set for "+O+", using default value 0 (i.e. not set)."),t.partners[O].timeout=0):t.partners[O].timeout=0);if(S.length,!P.length){var _=t.siteId,D=t.timeout,x={},R={},E={},k={},A=!1,U=!1,N=t.disableInitialLoad,j=t.enableSingleRequest,q=new e(_),z={page:{},slot:{}},M=-1,C=!1;this.apiReady=!0,this.registerPartner=i,this.setGlobalTimeout=o,this.enablePartners=s,this.disablePartners=d,this.setPartnerTimeout=p,this.setPartnerTargetingType=u,this.display=v,this.pubads=I}}var r=window.headertag.Q,n=window.headertag.Utils;if(n.getId=function(e){return e.getAdUnitPath().split("/").splice(-1)[0]},n.getIds=function(e){for(var t=[],r=0;r<e.length;r++)t.push(n.getId(e[r]));return t},window.headertag){var i=window.headertag;window.headertag=new t(window.headertagconfig);for(var a in i)i.hasOwnProperty(a)&&(window.headertag[a]=i[a])}}(),/.*/.test(location.href)&&(window.cygnus_index_args={name:"cygnus",embedMode:1,siteID:183339,slots:[{id:"1",width:300,height:600,siteID:183339},{id:"2",width:300,height:250,siteID:183340},{id:"3",width:300,height:250,siteID:183341},{id:"4",width:300,height:250,siteID:183342},{id:"5",width:300,height:250,siteID:183343},{id:"6",width:728,height:90,siteID:183344}],gpt_map:{desktop:{"300_600":{1:["b_right_p1"]},"300_250":{2:["b_lbox_p1","b_pover_p1"],3:["b_right_p2"],4:["b_right_p1","b_right_p3"],5:["b_right_p4"]},"728_90":{6:["b_main_p1"]}}},num_slots:6}),/.*\.zillow\.com\/homedetails\/.*/.test(location.href)&&(window.cygnus_index_args={name:"cygnus",embedMode:1,siteID:183339,slots:[{id:"1",width:300,height:600,siteID:183339},{id:"2",width:300,height:250,siteID:183340},{id:"3",width:300,height:250,siteID:183341},{id:"4",width:300,height:250,siteID:183342},{id:"5",width:300,height:250,siteID:183343},{id:"6",width:728,height:90,siteID:183344}],gpt_map:{desktop:{"300_600":{1:["b_right_p1"]},"300_250":{2:["b_right_p1"],3:["b_right_p2"],4:["b_right_p3"],5:["b_right_p4"]},"728_90":{6:["b_main_p1"]}}},num_slots:6}),function(){"use strict";function validateTargetingType(e){return"string"==typeof e&&SUPPORTED_TARGETING_TYPES[e]}function getKeys(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}function arrayCompare(e,t){var r,n,i={matched:0,success:!1};if(!e||!t)return i;for(r=e.length,n=0;r>n;n++){if(-1===t.indexOf(e[n]))return i;i.matched++}return i.success=!0,i}function retrieveIndexSlot(e,t,r){var n,i;for(i in t)if(!r[i]){n=t[i];for(var a in n)if(e===n[a])return i}}function mapSlots(e){var t,r,n,i,a,o,s,d,p,u,l=headerTagArgs.gptDivs,c=headerTagArgs.gptMap,f=e.length,h={};if(l)for(p=0;f>p;p++){d=Utils.getId(e[p]);for(n in l)-1!==l[n].indexOf(d)&&(h[n]||(h[n]=[]),h[n].push(d))}if(!l&&c)for(t="CSS1Compat"==window.document.compatMode?window.document.documentElement:window.document.body,r={},i=Utils.isMobile()?"mobile":"desktop",p=0;f>p;p++)for(d=Utils.getId(e[p]),a=e[p].getSizes(t.clientWidth,t.clientHeight),u=0;u<a.length;u++)"object"==typeof a[u]&&(o=a[u].getWidth()+"_"+a[u].getHeight(),c[i]&&c[i][o]&&(s=retrieveIndexSlot(d,c[i][o],r),s&&(r[s]=!0,h[s]=[d])));return h}function convertSlotDemandObject(e,t){if("slot"===targetingType)return e;var r,n,i={page:{slotIds:[],gCorrelator:t,demand:{}}};for(r in e.slot){i.page.slotIds.push(r),i.page.timestamp?i.page.timestamp=Math.min(i.page.timestamp,e.slot[r].timestamp):i.page.timestamp=e.slot[r].timestamp;for(n in e.slot[r].demand)i.page.demand[n]=i.page.demand[n]||[],i.page.demand[n]=i.page.demand[n].concat(e.slot[r].demand[n])}return i}function parseResults(e,t,r){var n,i,a,o,s,d,p=[],u={slot:{}};if(t){prefetch.demand=JSON.parse(JSON.stringify(headerTagSlots)),prefetch.state=prefetchState.READY,prefetch.analyticsCallback(prefetch.correlator);for(var l=0,c=prefetch.callbacks.length;c>l;l++)setTimeout(prefetch.callbacks[l],0);return void(prefetch.timestamp=Utils.now())}if(r?(n=prefetch.correlator,o=prefetch.demand,d=mapSlots(r)):(n=correlatorTracker[e],o=headerTagSlots,d=ixSlots[n]),(r||dSlots[n]).map(function(e){for(a=Utils.getId(e),i=0;i<o.length;i++)s=o[i].split("_"),"undefined"!=typeof d[s[1]]&&-1!==d[s[1]].indexOf(a)&&(r&&p.push(prefetch.demand[i]),u.slot[a]||(u.slot[a]={timestamp:prefetch.timestamp||Utils.now(),demand:{}}),u.slot[a].demand[s[0]]||(u.slot[a].demand[s[0]]=[]),u.slot[a].demand[s[0]].push(s[1]+"_"+s[2]))}),r){var f;for(var h in d)if(d.hasOwnProperty(h)&&-1!==prefetch.slotIds.indexOf(h)){for(i=0;i<d[h].length;i++)u.slot[d[h][i]]||(u.slot[d[h][i]]={timestamp:prefetch.timestamp,demand:{}});f=prefetch.slotIds.indexOf(h),-1!==f&&prefetch.slotIds.splice(f,1)}for(demandStore=u,i=prefetch.demand.length-1;i>=0;i--)-1!==p.indexOf(prefetch.demand[i])&&prefetch.demand.splice(i,1)}else"function"==typeof cb[n]&&(cb[n](null,u),delete cb[n]),delete correlatorTracker[e],delete ixSlots[n],delete dSlots[n]}function escapeCharacter(e){var t=META[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}function quote(e){return ESCAPABLE.lastIndex=0,ESCAPABLE.test(e)?e.replace(ESCAPABLE,escapeCharacter):e}function OpenRTBRequest(e,t){if("number"!=typeof e||e%1!==0||0>e)throw"Invalid Site ID";this.siteID=e,this.impressions=[],top===self?(this.sitePage=location.href,this.topframe=1):(this.sitePage=document.referrer,this.topframe=0),"undefined"==typeof indexRequestData.requestCounter?indexRequestData.requestCounter=Math.floor(256*Math.random()):indexRequestData.requestCounter=(indexRequestData.requestCounter+1)%256,this.requestID=String((new Date).getTime()%2592e3*256+indexRequestData.requestCounter+256),correlatorTracker[this.requestID]=t}function cygnus_index_judge(e){headerTagSlots=[];var t,r={},n="^(?:"+headerTagPublicKey+"|"+headerTagPrivateKey+")_(?:T([0-9])_)?(.*)_.*$",i=new RegExp(n),a=[];for(t=0;t<e.length;t++)if(e[t].split("_")[0]!==headerTagPrivateKey){var o=i.exec(e[t]);if("undefined"!=typeof o&&null!==o){var s,d;if(s=o[1],d=o[2],"undefined"!=typeof s&&null!==s||(s=0),r[d]=r[d]||{},"undefined"==typeof r[d].tier||r[d].tier<s){r[d].tier=s;var p=e[t];if(s>0){var u=e[t].split("_"),l=u.shift(),c=u.join("_");u.shift();var f=u.join("_");p=l+"_"+f,indexRequestData.targetIDToBid[f]=indexRequestData.targetIDToBid[c]}r[d].target=p}}}else a.push(e[t]);var h,g=[];for(h in r)r.hasOwnProperty(h)&&g.push(r[h].target);return g.concat(a)}function Partner(e){function t(e,t){if(Utils.isEmpty(e))return t;if(Utils.isEmpty(t))return e;var r,n;for(r in t.slot)if("undefined"==typeof e.slot[r])e.slot[r]=t.slot[r];else{e.slot[r].timestamp=Math.min(e.slot[r].timestamp,t.slot[r].timestamp);for(n in t.slot[r].demand){switch(typeof e.slot[r].demand[n]){case"undefined":e.slot[r].demand[n]=[];break;case"string":e.slot[r].demand[n]=[e.slot[r].demand[n]]}e.slot[r].demand[n]=e.slot[r].demand[n].concat(t.slot[r].demand[n])}}return e}function r(e,t){var r,n,i,a;try{if("undefined"==typeof headerTagArgs||"undefined"==typeof headerTagArgs.siteID||"undefined"==typeof headerTagArgs.slots)return;for("undefined"==typeof indexRequestData&&(indexRequestData={},indexRequestData.impIDToSlotID={},indexRequestData.reqOptions={}),i=new OpenRTBRequest(headerTagArgs.siteID,e),headerTagArgs.url&&"string"==typeof headerTagArgs.url&&i.setPageOverride(headerTagArgs.url),indexRequestData.impIDToSlotID[i.requestID]={},indexRequestData.reqOptions[i.requestID]={},r=0;r<headerTagArgs.slots.length;r++)a=headerTagArgs.slots[r],-1!==t.indexOf(a.id.toString())&&(n=i.addImpression(a.width,a.height,a.bidfloor,a.bidfloorcur,a.id,a.siteID),n&&(indexRequestData.impIDToSlotID[i.requestID][n]=String(a.id)));return"number"==typeof headerTagArgs.targetMode&&(indexRequestData.reqOptions[i.requestID].targetMode=headerTagArgs.targetMode),"function"==typeof headerTagArgs.callback&&(indexRequestData.reqOptions[i.requestID].callback=headerTagArgs.callback),i.sendRequestAsync(e,e===prefetch.correlator)}catch(o){}}var n=this;targetingType=e.targetingType||"slot",headerTagArgs={gptMap:cygnus_index_args.gpt_map,gptDivs:cygnus_index_args.gpt_divs,siteID:cygnus_index_args.siteID,slots:cygnus_index_args.slots,url:cygnus_index_args.url,targetMode:cygnus_index_args.targetMode,callback:cygnus_index_args.callback},cygnus_index_args=void 0;var i=e.targetingType,a=SUPPORTED_ANALYTICS,o=SUPPORTED_OPTIONS,s=SUPPORTED_OPTIONS.demandExpiry?SUPPORTED_OPTIONS.demandExpiry:-1;this.prefetchIndexSlotIds=e.prefetch.info[window.headertag.pagetype].requiredIndexSlots,this.publicKey=e.publicKey||"IOM",this.privateKey=e.privateKey||"IPM",headerTagPrivateKey=this.privateKey,headerTagPublicKey=this.publicKey,this.getPartnerTargetingType=function(){return i},this.getSupportedAnalytics=function(){return a},this.getSupportedOptions=function(){return o},this.getPartnerDemandExpiry=function(){return s},this.setPartnerTargetingType=function(e){return validateTargetingType(e)?(i=e,targetingType=i,!0):!1},this.prefetchDemand=function(e,t,n){prefetch.state=prefetchState.IN_PROGRESS,prefetch.correlator=e,prefetch.gCorrelator=t,prefetch.slotIds=this.prefetchIndexSlotIds.slice(),prefetch.slotIdsInPrefetch=this.prefetchIndexSlotIds.slice(),prefetch.analyticsCallback=n,r(e,this.prefetchIndexSlotIds)},this.getDemand=function d(e,i,a){if("page"===targetingType){var s=i;i=Utils.getSlots()}if(prefetch.state===prefetchState.IN_PROGRESS){for(var p=getKeys(mapSlots(i)),u=!1,l=0,c=p.length;c>l;l++){var f=prefetch.slotIdsInPrefetch.indexOf(p[l]);-1!==f&&(prefetch.slotIdsInPrefetch.splice(f,1),u=!0)}if(u)return void prefetch.callbacks.push(d.bind(n,e,i,a))}var h={};if(prefetch.state===prefetchState.READY&&(prefetch.demand&&prefetch.demand.length>0&&prefetch.slotIds.length&&parseResults(null,!1,i),demandStore.slot)){h.slot=h.slot||{};for(var g=i.length-1;g>=0;g--){var m=Utils.getId(i[g]);if(demandStore.slot.hasOwnProperty(m)){if((o.demandExpiry<0||Utils.now()-demandStore.slot[m].timestamp<=o.demandExpiry)&&(h.slot[m]=demandStore.slot[m],i.splice(g,1)),"page"===targetingType&&s===prefetch.gCorrelator)continue;delete demandStore.slot[m]}}if(prefetch.timestamp&&Utils.now()-prefetch.timestamp>o.demandExpiry&&(prefetch.slotIds=[],prefetch.demand=[],delete prefetch.timestamp),Utils.validateNonEmptyObject(demandStore.slot)||prefetch.slotIds.length||(prefetch.state=prefetchState.USED,delete prefetch.timestamp),!i.length)return void("page"===targetingType?a(null,convertSlotDemandObject(h,s)):a(null,h))}cb[e]=function(e,r){return e?void a(e):void("page"===targetingType?a(null,convertSlotDemandObject(t(h,r),s)):a(null,t(h,r)))},dSlots[e]=i,ixSlots[e]=mapSlots(i);var y=getKeys(ixSlots[e]);return y.length?void r(e,y):a(null,convertSlotDemandObject(h))}}function init(e,t){var r=[];return Utils=window.headertag.Utils,e.hasOwnProperty("targetingType")&&!validateTargetingType(e.targetingType)&&(r.push("targetingType either not set or invalid. Defaulting to using slot level targeting."),e.targetingType="slot"),e.hasOwnProperty("publicKey")&&!Utils.validateNonEmptyString(e.publicKey)&&(r.push("Private key is not a string. Defaulting value to IOM"),e.publicKey="IOM"),e.hasOwnProperty("privateKey")&&!Utils.validateNonEmptyString(e.privateKey)&&(r.push("Private key is not a string. Defaulting value to IPM"),e.privateKey="IPM"),r.length?t(r,new Partner(e)):void t(null,new Partner(e))}var PARTNER_ID="INDX",SUPPORTED_TARGETING_TYPES={page:!0,slot:!0},SUPPORTED_ANALYTICS={time:!0,demand:!0},SUPPORTED_OPTIONS={prefetch:!0,demandExpiry:5e4},prefetchState={NEW:1,IN_PROGRESS:2,READY:3,USED:4},prefetch={state:prefetchState.NEW,demand:null,correlator:null,slotIds:[],callbacks:[]},demandStore={},headerTagArgs,headerTagSlots,headerTagPublicKey,headerTagPrivateKey,cb={},correlatorTracker={},ESCAPABLE=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,META={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},indexRequestData,dSlots={},ixSlots={},targetingType,Utils,demandExpiry=5e4;OpenRTBRequest.prototype.serialize=function(){var e,t,r,n='{"id":'+this.requestID+',"site":{"page":"'+quote(this.sitePage)+'"';for("string"==typeof document.referrer&&(n+=',"ref":"'+quote(document.referrer)+'"'),n+='},"imp":[',r=0;r<this.impressions.length;r++)e=this.impressions[r],t=[],n+='{"id":"'+e.id+'", "banner":{"w":'+e.w+',"h":'+e.h+',"topframe":'+String(this.topframe)+"}","number"==typeof e.bidfloor&&(n+=',"bidfloor":'+e.bidfloor,"string"==typeof e.bidfloorcur&&(n+=',"bidfloorcur":"'+quote(e.bidfloorcur)+'"')),"string"!=typeof e.slotID||e.slotID.match(/^\s*$/)||t.push('"sid":"'+quote(e.slotID)+'"'),"number"==typeof e.siteID&&t.push('"siteID":'+e.siteID),t.length>0&&(n+=',"ext": {'+t.join()+"}"),n+=r+1==this.impressions.length?"}":"},";return n+="]}"},OpenRTBRequest.prototype.addImpression=function(e,t,r,n,i,a){var o={id:String(this.impressions.length+1)};if("number"!=typeof e||1>=e)return null;if("number"!=typeof t||1>=t)return null;if(("string"==typeof i||"number"==typeof i)&&String(i).length<=50&&(o.slotID=String(i)),o.w=e,o.h=t,void 0!==r&&"number"!=typeof r)return null;if("number"==typeof r){if(0>r)return null;if(o.bidfloor=r,void 0!==n&&"string"!=typeof n)return null;o.bidfloorcur=n}if("undefined"!=typeof a){if(!("number"==typeof a&&a%1===0&&a>=0))return null;o.siteID=a}return this.impressions.push(o),o.id},OpenRTBRequest.prototype.sendRequestAsync=function(correlator,isPrefetch){if(0===this.impressions.length)return void(cb.hasOwnProperty(correlator)&&(cb[correlator](null,{}),delete cb[correlator]));var jsonURI=encodeURIComponent(this.serialize()),scriptSrc="https:"===window.location.protocol?"https://as-sec.casalemedia.com":"http://as.casalemedia.com";scriptSrc+="/cygnus?v=7&fn=headertag_parse&s="+this.siteID+"&r="+jsonURI;var xhttp=new XMLHttpRequest;xhttp.withCredentials=!0,xhttp.onreadystatechange=function(){if(4===xhttp.readyState&&200===xhttp.status)try{eval(xhttp.responseText)}catch(e){cb.hasOwnProperty(correlator)&&(cb[correlator]([e.toString()]),delete cb[correlator])}},xhttp.open("GET",scriptSrc,!0),xhttp.send()},window.headertag_parse=function(e){function t(e,t){headerTagSlots.push(e+t),void 0===indexRequestData.targetIDToBid[t]?(indexRequestData.targetIDToBid[t]=[a.adm],indexRequestData.correlator[t]=[r]):(indexRequestData.targetIDToBid[t].push(a.adm),indexRequestData.correlator[t].push(r)),p={},p.impressionID=a.impid,"undefined"!=typeof a.ext.dealid&&(p.dealID=a.ext.dealid),p.bid=a.price,p.slotID=o,p.priceLevel=a.ext.pricelevel,p.target=e+t,c.push(p)}var r;try{if(headerTagSlots=[],e){if("object"!=typeof indexRequestData||"object"!=typeof indexRequestData.impIDToSlotID||"undefined"==typeof indexRequestData.impIDToSlotID[e.id])return;var n,i=0;"object"==typeof indexRequestData.reqOptions&&"object"==typeof indexRequestData.reqOptions[e.id]&&("function"==typeof indexRequestData.reqOptions[e.id].callback&&(n=indexRequestData.reqOptions[e.id].callback),"number"==typeof indexRequestData.reqOptions[e.id].targetMode&&(i=indexRequestData.reqOptions[e.id].targetMode)),indexRequestData.lastRequestID=e.id,r=correlatorTracker[e.id];var a,o,s,d,p,u,l,c=[],f="undefined"==typeof e.seatbid?0:e.seatbid.length;for(u=0;f>u;u++)for(l=0;l<e.seatbid[u].bid.length;l++)a=e.seatbid[u].bid[l],"object"==typeof a.ext&&"string"==typeof a.ext.pricelevel&&"undefined"!=typeof indexRequestData.impIDToSlotID[e.id][a.impid]&&(o=indexRequestData.impIDToSlotID[e.id][a.impid],"undefined"==typeof headerTagSlots&&(headerTagSlots=[]),"undefined"==typeof indexRequestData.targetIDToBid&&(indexRequestData.targetIDToBid={}),"undefined"==typeof indexRequestData.correlator&&(indexRequestData.correlator={}),"string"==typeof a.ext.dealid?(d=headerTagPrivateKey+"_",1===i?(s=o+a.ext.pricelevel,t(d,s)):2===i?(s=o+a.ext.pricelevel,t(d,s),s=o+"_"+a.ext.dealid,t(d,s)):(s=o+"_"+a.ext.dealid,t(d,s))):(d=headerTagPublicKey+"_",s=o+a.ext.pricelevel,t(d,s)));"function"==typeof n&&(0===c.length?n(e.id):n(e.id,c)),headerTagSlots=cygnus_index_judge(headerTagSlots.slice(0))}}catch(h){}"undefined"==typeof headerTagSlots&&(headerTagSlots=[]),parseResults(e.id,correlatorTracker[e.id]===prefetch.correlator)},window.index_render=function(e,t){var r,n,i,a,o,s,d;"undefined"==typeof index_demand&&(window.index_demand={}),d=t.split("_"),r=d[0];try{if(n=indexRequestData.targetIDToBid[t].pop(),null!==n)e.write(n),index_demand[r]=1,delete index_no_demand[r];else{for(i={},j=0;j<headerTagArgs.slots.length;j++)if(headerTagArgs.slot[j].id===r){i.s=headerTagArgs.slot[j].siteID;break}i.hasOwnProperty("s")||(i.s=0),i.u=encodeURIComponent(location.href),i.type="RT",i.r=correlator,i.blank="["+t+"]",a=Utils.objToQueryString(i),o=("https:"===location.protocol?"https://as-sec.":"http://as.")+"casalemedia.com/headerstats"+a,s=new XMLHttpRequest,s.open("GET",o,!0),s.send()}}catch(p){}},window.headertag_render=function(e,t,r){var n,i,a=r,o=t.split(",");for(n=0;n<o.length;n++)if(i=o[n].split("_"),i[0]==a)return void window.index_render(e,o[n])},window.headertag.registerPartner(PARTNER_ID,init)}(),function(){"use strict";function e(e){return"string"==typeof e&&a[e]}function t(t){function r(e){for(var t=[],r=0;r<e.length;r++)w.hasOwnProperty(e[r])&&t.push(w[e[r]]);return t}function r(e){for(var t=[],r=0,n=e.length;n>r;r++)w.hasOwnProperty(e[r])&&t.push(w[e[r]]);return t}function i(e){for(var t={},r=0,n=e.length;n>r;r++){var i=e[r];t[i.code]={},t[i.code].code=i.code,t[i.code].sizes=[];for(var a=0,o=i.sizes.length;o>a;a++){var s=i.sizes[a];t[i.code].sizes.push(s[0]+"x"+s[1])}t[i.code].placementIds=[];for(var d=0,p=i.bids.length;p>d;d++){var u=i.bids[d];t[i.code].placementIds.push(u.params.placementId)}}return t}function a(e,t){var r={},n="https:"===document.location.protocol?"//secure.adnxs.com/jpt":"//ib.adnxs.com/jpt";if(r.id=e.placementIds,r.size=e.sizes[0],e.sizes.length>1){for(var i="",a=1,o=e.sizes.length;o>a;a++){var s=e.sizes[a];i+=s+","}i=i.slice(0,-1),r.promo_sizes=i}return void 0===t&&(t="prefetch"),r.callback="dmCallbacks."+t,r.callback_uid=e.code,r.psa=0,u.getProtocol()+n+u.objToQueryString(r)}function l(e,t,r){var n=a(e,r);if(void 0===r)r="prefetch",window.dmPrefetched.push(e.code);else if(window.dmPrefetched.indexOf(e.code)>-1)return void t(null,null);dmCallbacks[r]=dmCallbacks[r]||function(e){var r=t,n=f(e);r(null,n)};var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=n,i.readyState&&(i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,onLoad())});var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(i,o)}function c(e){for(var t=parseInt(e,10)/1e4*n,r=1,i=0,a=b.buckets.length;a>i;i++){var o=b.buckets[i];if(t>=o.range[0]&&t<o.range[1]){r=1/o.granularity;break}i===a-1&&(t=o.range[1],r=1/o.granularity)}return t=(Math.floor(t*r)/r).toFixed(2)}function f(e){try{if(!e.result.ad&&0===e.result.cpm)return null;var t=c(e.result.cpm),r=S();return{id:r,divId:e.callback_uid,demand:{dm_adid:r,dm_pb:t,dm_size:e.result.width+"x"+e.result.height},ad:{creative_id:e.result.creative_id,adUrl:e.result.ad,width:e.result.width,height:e.result.height}}}catch(n){return null}}var h=this,g=t.targetingType;n=t.share;var m=o,y=s,v={state:d.NEW,correlator:null,slotIds:[],callbacks:[]},b=t.roundingBuckets?t.roundingBuckets:{type:p.FLOOR,buckets:[{range:[0,20],granularity:.5}]},w=i(t.adUnits),I={},T={},S=function(){var e=0;return function(){return"_"+e++}}();window.districtM_renderAd=function(e,t){if(e&&t)try{var r=T[t];if(r){var n=r.height,i=r.width,a=r.adUrl,o=r.ad;o?(e.write(o),e.close(),e.defaultView&&e.defaultView.frameElement&&(e.defaultView.frameElement.width=i,e.defaultView.frameElement.height=n)):a&&(e.write('<IFRAME SRC="'+a+'" FRAMEBORDER="0" SCROLLING="no" MARGINHEIGHT="0" MARGINWIDTH="0" TOPMARGIN="0" LEFTMARGIN="0" ALLOWTRANSPARENCY="true" WIDTH="'+i+'" HEIGHT="'+n+'"></IFRAME>'),e.close(),e.defaultView&&e.defaultView.frameElement&&(e.defaultView.frameElement.width=i,e.defaultView.frameElement.height=n))}}catch(s){}},this.getPartnerTargetingType=function(){return g},this.getSupportedAnalytics=function(){return m},this.getSupportedOptions=function(){return y},this.getPartnerDemandExpiry=function(){return y.demandExpiry},this.setPartnerTargetingType=function(t){return e(t)?(g=t,!0):!1},this.prefetchDemand=function(e,t,n){function i(t,r){if(o++,r&&(T[r.id]=r.ad||{},I[e].slot[r.divId]={},I[e].slot[r.divId].timestamp=u.now(),I[e].slot[r.divId].demand=r.demand||{}),o===a.length){v.state=d.READY,n(e);for(var i=0,s=v.callbacks.length;s>i;i++)setTimeout(v.callbacks[i],0)}}v.state=d.IN_PROGRESS,v.correlator=e,v.slotIds=t.divIds.slice(),I[e]={},I[e].slot={};for(var a=r(t.divIds),o=0,s=0,p=a.length;p>s;s++)setTimeout(l.bind(h,a[s],i))},this.getDemand=function P(e,t,n){function i(e,t){w++,t&&(T[t.id]=t.ad||{},f.slot[t.divId]={},f.slot[t.divId].timestamp=u.now(),f.slot[t.divId].demand=t.demand||{}),w===b.length&&n(null,f)}if(v.state===d.IN_PROGRESS){for(var a=u.getIds(t),o=!1,s=0,p=a.length;p>s;s++){var c=v.slotIds.indexOf(a[s]);-1!==c&&(v.slotIds.splice(c,1),o=!0)}if(o)return void v.callbacks.push(P.bind(h,e,t,n))}var f={slot:{}};if(v.state===d.READY){for(var g=t.length-1;g>=0;g--){var m=u.getId(t[g]);I[v.correlator].slot.hasOwnProperty(m)&&((y.demandExpiry<0||u.now()-I[v.correlator].slot[m].timestamp<=y.demandExpiry)&&(f.slot[m]=I[v.correlator].slot[m],t.splice(g,1)),delete I[v.correlator].slot[m])}if(u.validateNonEmptyObject(I[v.correlator].slot)||(v.state=d.USED),!t.length)return void n(null,f)}var b=r(u.getIds(t));if(b.length)for(var w=0,g=0,S=b.length;S>g;g++)setTimeout(l.bind(h,b[g],i,e));else n(null,f)}}function r(r,n){var i=[];if(r.hasOwnProperty("targetingType")&&e(r.targetingType)||i.push("targetingType either not provided or invalid."),r.hasOwnProperty("adUnits")&&u.isArray(r.adUnits))for(var a=0,o=r.adUnits.length;o>a;a++){var s=r.adUnits[a];if(s.hasOwnProperty("code")&&u.validateNonEmptyString(s.code)||i.push("code not provided or invalid."),s.hasOwnProperty("sizes")&&u.isArray(s.sizes)&&s.sizes.length)for(var d=0,p=s.sizes.length;p>d;d++){var l=s.sizes[d];u.isArray(l)&&2===l.length?u.isInteger(l[0])&&u.isInteger(l[1])||i.push("size not provided or invalid."):i.push("size not provided or invalid.")}else i.push("sizes not provided or invalid.");if(s.hasOwnProperty("bids")&&u.isArray(s.bids)&&s.bids.length)for(var c=0,f=s.bids.length;f>c;c++){var h=s.bids[c];h.hasOwnProperty("params")&&u.validateNonEmptyObject(h.params)?h.params.hasOwnProperty("placementId")&&u.validateNonEmptyString(h.params.placementId)||i.push("placementId not provided or invalid."):i.push("params not provided or invalid.")}else i.push("bids not provided or invalid.")}else i.push("adUnits either not provided or invalid.");if(r.hasOwnProperty("roundingBuckets")){var g=r.roundingBuckets;if((!g.hasOwnProperty("type")||!u.isInteger(g.type)||g.type>3||g.type<0)&&i.push("roundingBuckets type either not provided or invalid."),g.hasOwnProperty("buckets")&&u.isArray(g.buckets))for(var a=0,m=g.buckets.length;m>a;a++){var y=g.buckets[a];u.isArray(y.range)&&2===y.range.length?u.isInteger(y.range[0])&&u.isInteger(y.range[1])||i.push("range not provided or invalid."):i.push("range not provided or invalid."),y.hasOwnProperty("granularity")&&!isNaN(y.granularity)||i.push("granularity not provided or invalid.")}else i.push("buckets either not provided or invalid.")}if(i.length)return void n(i);window.pbjs=window.pbjs||{};var v=new t(r);n(null,v)}var n,i="DISM",a={page:!1,slot:!0},o={time:!0,demand:!1},s={prefetch:!0,demandExpiry:-1},d={NEW:1,IN_PROGRESS:2,READY:3,USED:4},p={FLOOR:1,ROUND:2,CIEL:3};window.dmPrefetched=[],window.dmCallbacks={};var u=window.headertag.Utils;window.headertag.registerPartner(i,r)}(),function(){"use strict";function validateTargetingType(e){return"string"==typeof e&&SUPPORTED_TARGETING_TYPES[e]}function Partner(config){function getRequiredAdUnits(e){for(var t=[],r=0,n=e.length;n>r;r++)adUnits.hasOwnProperty(e[r])&&t.push(adUnits[e[r]]);return t}function parseAdUnits(e){for(var t={},r=0,n=e.length;n>r;r++){var i=e[r];t[i.code]={},t[i.code].code=i.code,t[i.code].sizes=[];for(var a=0,o=i.sizes.length;o>a;a++){var s=i.sizes[a];t[i.code].sizes.push(s[0]+"x"+s[1])}t[i.code].placementIds=[];for(var d=0,p=i.bids.length;p>d;d++){var u=i.bids[d];t[i.code].placementIds.push(u.params.placementId)}}return t}function generateRequestUrl(e){var t={};if(t.id=e.placementIds,t.size=e.sizes[0],e.sizes.length>1){for(var r="",n=1,i=e.sizes.length;i>n;n++){var a=e.sizes[n];r+=a+","}r=r.slice(0,-1),t.promo_sizes=r}return t.referrer=window.location.href,t.callback="pbjs.parseApnxDemand",t.callback_uid=e.code,t.psa=0,Utils.getProtocol()+"//secure.adnxs.com/jpt"+Utils.objToQueryString(t)}function sendDemandRequest(adUnit,callback){var url=generateRequestUrl(adUnit),xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(4===xhttp.readyState)if(200===xhttp.status)try{callback(null,eval(xhttp.responseText))}catch(e){callback("Bad response.")}else callback("No demand response.")},xhttp.withCredentials=!0,xhttp.open("GET",url,!0),xhttp.send()}function round(e){for(var t=Number(e)/1e4,r=1,n=0,i=roundingBuckets.buckets.length;i>n;n++){var a=roundingBuckets.buckets[n];if(t>=a.range[0]&&t<a.range[1]){r=a.granularity;break}n===i-1&&(t=a.range[1],r=a.granularity)}return t=100*t/(100*r),roundingBuckets.type===roundingTypes.FLOOR?t=Math.floor(t):roundingBuckets.type===roundingTypes.ROUND?t=Math.round(t):roundingBuckets.type===roundingTypes.CIEL&&(t=Math.ceil(t)),(t*r).toFixed(2)}var _this=this,targetingType=config.targetingType,supportedAnalytics=SUPPORTED_ANALYTICS,supportedOptions=SUPPORTED_OPTIONS,prefetch={state:prefetchState.NEW,correlator:null,slotIds:[],callbacks:[]},roundingBuckets=config.roundingBuckets?config.roundingBuckets:{type:roundingTypes.FLOOR,buckets:[{range:[0,20],granularity:.5}]},adUnits=parseAdUnits(config.adUnits),demandStore={},ads={},getAdId=function(){var e=0;return function(){return"_"+e++}}();this.parseResponse=function(e){try{var t=round(e.result.cpm),r=getAdId();return 0===Number(t)?{id:r,divId:e.callback_uid,demand:{},ad:{}}:{id:r,divId:e.callback_uid,demand:{hb_adid:r,hb_bidder:"appnexus",hb_pb:t,hb_size:e.result.width+"x"+e.result.height},ad:{creative_id:e.result.creative_id,adUrl:e.result.ad,width:e.result.width,height:e.result.height}}}catch(n){return{}}},this.apnxRenderAd=function(e,t){if(e&&t)try{var r=ads[t];if(r){var n=r.height,i=r.width,a=r.adUrl,o=r.ad;o?(e.write(o),e.close(),e.defaultView&&e.defaultView.frameElement&&(e.defaultView.frameElement.width=i,e.defaultView.frameElement.height=n)):a&&(e.write('<IFRAME SRC="'+a+'" FRAMEBORDER="0" SCROLLING="no" MARGINHEIGHT="0" MARGINWIDTH="0" TOPMARGIN="0" LEFTMARGIN="0" ALLOWTRANSPARENCY="true" WIDTH="'+i+'" HEIGHT="'+n+'"></IFRAME>'),e.close(),e.defaultView&&e.defaultView.frameElement&&(e.defaultView.frameElement.width=i,e.defaultView.frameElement.height=n))}}catch(s){}},this.getPartnerTargetingType=function(){return targetingType},this.getSupportedAnalytics=function(){return supportedAnalytics},this.getSupportedOptions=function(){return supportedOptions},this.getPartnerDemandExpiry=function(){return supportedOptions.demandExpiry},this.setPartnerTargetingType=function(e){return validateTargetingType(e)?(targetingType=e,!0):!1},this.prefetchDemand=function(e,t,r){function n(t,n){if(a++,n&&(ads[n.id]=n.ad||{},demandStore[e].slot[n.divId]={},demandStore[e].slot[n.divId].timestamp=Utils.now(),demandStore[e].slot[n.divId].demand=n.demand||{},a===i.length)){prefetch.state=prefetchState.READY,r(e);for(var o=0,s=prefetch.callbacks.length;s>o;o++)setTimeout(prefetch.callbacks[o],0)}}prefetch.state=prefetchState.IN_PROGRESS,prefetch.correlator=e,prefetch.slotIds=t.divIds.slice(),demandStore[e]={},demandStore[e].slot={};for(var i=getRequiredAdUnits(t.divIds),a=0,o=0,s=i.length;s>o;o++)setTimeout(sendDemandRequest.bind(_this,i[o],n))},this.getDemand=function e(t,r,n){function i(e,t){h++,t&&(ads[t.id]=t.ad||{},u.slot[t.divId]={},u.slot[t.divId].timestamp=Utils.now(),u.slot[t.divId].demand=t.demand||{},h===f.length&&n(null,u))}if(prefetch.state===prefetchState.IN_PROGRESS){for(var a=Utils.getIds(r),o=!1,s=0,d=a.length;d>s;s++){var p=prefetch.slotIds.indexOf(a[s]);-1!==p&&(prefetch.slotIds.splice(p,1),o=!0)}if(o)return void prefetch.callbacks.push(e.bind(_this,t,r,n))}var u={slot:{}};if(prefetch.state===prefetchState.READY){for(var l=r.length-1;l>=0;l--){var c=Utils.getId(r[l]);demandStore[prefetch.correlator].slot.hasOwnProperty(c)&&((supportedOptions.demandExpiry<0||Utils.now()-demandStore[prefetch.correlator].slot[c].timestamp<=supportedOptions.demandExpiry)&&(u.slot[c]=demandStore[prefetch.correlator].slot[c],r.splice(l,1)),delete demandStore[prefetch.correlator].slot[c])}if(Utils.validateNonEmptyObject(demandStore[prefetch.correlator].slot)||(prefetch.state=prefetchState.USED),!r.length)return void n(null,u)}var f=getRequiredAdUnits(Utils.getIds(r));if(f.length)for(var h=0,l=0,g=f.length;g>l;l++)setTimeout(sendDemandRequest.bind(_this,f[l],i));else n(null,u)}}function init(e,t){var r=[];if(e.hasOwnProperty("targetingType")&&validateTargetingType(e.targetingType)||r.push("targetingType either not provided or invalid."),e.hasOwnProperty("adUnits")&&Utils.isArray(e.adUnits))for(var n=0,i=e.adUnits.length;i>n;n++){var a=e.adUnits[n];if(a.hasOwnProperty("code")&&Utils.validateNonEmptyString(a.code)||r.push("code not provided or invalid."),a.hasOwnProperty("sizes")&&Utils.isArray(a.sizes)&&a.sizes.length)for(var o=0,s=a.sizes.length;s>o;o++){var d=a.sizes[o];Utils.isArray(d)&&2===d.length?Utils.isInteger(d[0])&&Utils.isInteger(d[1])||r.push("size not provided or invalid."):r.push("size not provided or invalid.")}else r.push("sizes not provided or invalid.");if(a.hasOwnProperty("bids")&&Utils.isArray(a.bids)&&a.bids.length)for(var p=0,u=a.bids.length;u>p;p++){var l=a.bids[p];l.hasOwnProperty("bidder")&&"appnexus"===l.bidder||r.push("bidder not provided or invalid."),l.hasOwnProperty("params")&&Utils.validateNonEmptyObject(l.params)?l.params.hasOwnProperty("placementId")&&Utils.validateNonEmptyString(l.params.placementId)||r.push("placementId not provided or invalid."):r.push("params not provided or invalid.")}else r.push("bids not provided or invalid.")}else r.push("adUnits either not provided or invalid.");if(e.hasOwnProperty("roundingBuckets")){var c=e.roundingBuckets;if((!c.hasOwnProperty("type")||!Utils.isInteger(c.type)||c.type>3||c.type<0)&&r.push("roundingBuckets type either not provided or invalid."),c.hasOwnProperty("buckets")&&Utils.isArray(c.buckets))for(var n=0,f=c.buckets.length;f>n;n++){var h=c.buckets[n];Utils.isArray(h.range)&&2===h.range.length?Utils.isInteger(h.range[0])&&Utils.isInteger(h.range[1])||r.push("range not provided or invalid."):r.push("range not provided or invalid."),h.hasOwnProperty("granularity")&&!isNaN(h.granularity)||r.push("granularity not provided or invalid.")}else r.push("buckets either not provided or invalid.")}if(r.length)return void t(r);window.pbjs=window.pbjs||{};var g=new Partner(e);window.pbjs.parseApnxDemand=g.parseResponse,window.pbjs.renderAd=g.apnxRenderAd,t(null,g)}var PARTNER_ID="APNX",SUPPORTED_TARGETING_TYPES={page:!1,slot:!0},SUPPORTED_ANALYTICS={time:!0,demand:!1},SUPPORTED_OPTIONS={prefetch:!0,demandExpiry:-1},prefetchState={NEW:1,IN_PROGRESS:2,READY:3,USED:4},roundingTypes={FLOOR:1,ROUND:2,CIEL:3},Utils=window.headertag.Utils;window.headertag.registerPartner(PARTNER_ID,init);
}();