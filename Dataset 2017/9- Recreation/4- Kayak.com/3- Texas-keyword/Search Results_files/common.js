(function(g,h){g.define("R9.common.ads.Ad",{loadGPT:function(){if(!window.googletag){window.googletag={cmd:[]};var a=document.createElement("script");a.async=!0;a.type="text/javascript";a.src="//www.googletagservices.com/tag/js/gpt.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)}window.googletag.cmd=window.googletag.cmd||[]},loadAdsense:function(){window._googCsa||function(a,c,d,b,e,f){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)};a[b].t=1*new Date;
e=c.createElement(d);f=c.getElementsByTagName(d)[0];e.async=1;e.src="//www.google.com/adsense/search/async-ads.js";f.parentNode.insertBefore(e,f)}(window,document,"script","_googCsa")},findAdDataForType:function(a,c,d){if(!(d&&a&&c&&d[a]))return null;var b,e;for(e in d[a])if(d[a].hasOwnProperty(e)){b=d[a][e];if("string"===typeof b)try{b=JSON.parse(b)}catch(f){b=null}if(b&&b.pageLocation&&b.pageLocation===c)return b}return null}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.ads.AdBlockDetector",{init:function(d){b.ajax("/ads/dfp/banner300x250/ads.js",{complete:function(b,c){"error"===c&&a.Analytics.api.trackEvent("shields-up/detected")}})}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.ads.AfterclickAd",{options:{shouldShow:!0,errorMessage:""},init:function(a){!1===this.options.shouldShow&&console.log(this.options.errorMessage)},addEventHandlers:function(){if(this.options.shouldShow)this.element.find(".afterclickRowItem").one("click",function(){a.Analytics.api.trackEvent({category:"AfterClick",action:"click"})})}})})(R9,jQuery);(function(f,g){f.createComponentClass("common.ads.DisplayAd",{options:{gptAdID:null,gptTargetID:null,gptAdWidth:null,gptAdHeight:null,gptAdSizes:null,gptPageURL:null,adBlockOptions:null,pageOptions:null,pageLocation:null,loggingPrefix:"unknown/ads",loggingEnabled:!0,smartAdPollMSLimit:2E4,isForceSafeFrame:!1,isSmartAdWinMessage:!1,smartAdWinMessageID:null,smartAdWinMessageHosts:null,minRefreshRate:null},deferSetupCt:0,definedSlot:null,displayedSlot:!1,init:function(a){(new f.common.ads.Ad).loadGPT()},
addEventHandlers:function(){this.subscribe("resultspage.ads.update",this.onResultsPageAdsUpdate.bind(this));this.subscribe("resultspage.adinfo.empty",this.publishAdsRequest.bind(this));this.options.gptAdID?(this.addEventHandlersAfterSetup(),this.setupAdOptions()):this.publishAdsRequest()},inlineComponentsReady:function(){this.publishAdsRequest()},destroy:function(){this.base();var a=this;g(window).off(this.getWindowMessageEventName());window.googletag&&window.googletag.cmd&&window.googletag.cmd.push(function(){window.googletag.destroySlots([a.definedSlot]);
a.definedSlot=null})},publishAdsRequest:function(){f.events.publish("ads.request",{adType:"displayAd",pageLocation:this.options.pageLocation,now:!this.options.gptAdID,events:["searchform.submit","resultsHeader.changed","filters.changed","paginator.change"],minRefreshRate:this.options.minRefreshRate})},addEventHandlersAfterSetup:function(){var a=this.getWindowMessageEventName(),b;this.options&&this.options.adBlockOptions&&this.options.adBlockOptions.pos&&this.options.adBlockOptions.origin&&(b=this.options.adBlockOptions.origin.match(/\w+\.\w*\.(\w+)\./))&&
1<b.length&&b[1]&&(this.myHideData=b[1]+"."+this.options.adBlockOptions.pos+".NoAd");g(window).off(a).on(a,this.onWindowMessage.bind(this))},getWindowMessageEventName:function(){return"message.displayad-"+this.id()},onWindowMessage:function(a){var b=this.options.smartAdWinMessageHosts||"";b&&(b=b.replace(/(http(s)?:)?\/\//g,window.location.protocol+"//"));b+=","+window.location.protocol+"//"+window.location.host;a&&a.originalEvent&&(this.myHideData&&a.originalEvent.data===this.myHideData?(this.element.hide(),
g(window).off(this.getWindowMessageEventName())):this.options.isSmartAdWinMessage&&this.options.smartAdWinMessageID&&b&&b.indexOf&&a.originalEvent.origin&&0<=b.indexOf(a.originalEvent.origin)&&a.originalEvent.data[this.options.smartAdWinMessageID]&&(b=a.originalEvent.data[this.options.smartAdWinMessageID].pos)&&this.options.adBlockOptions&&b===this.options.adBlockOptions.pos&&(g(window).off(this.getWindowMessageEventName()),this.kickoffSmartAd(a.originalEvent.data[this.options.smartAdWinMessageID])))},
setupAdOptions:function(){var a=this;window.googletag&&googletag.apiReady?(this.deferSetupID&&(clearTimeout(this.deferSetupID),this.deferSetupID=null),this.setupPageTargeting(),this.setupAdTargeting(),this.enableServices(),this.setupSmartAdPoll()):(this.deferSetupID&&clearTimeout(this.deferSetupID),this.deferSetupCt++,300<this.deferSetupCt?this.loggedDeferSetupCt||(this.loggedDeferSetupCt=!0,this.logError("error/gptapi")):this.deferSetupID=setTimeout(function(){a.setupAdOptions()},200))},onResultsPageAdsUpdate:function(a){if(a=
(new f.common.ads.Ad).findAdDataForType("displayAd",this.options.pageLocation,a))g.extend(this.options,a),this.addEventHandlersAfterSetup(),this.setupAdOptions()},setupPageTargeting:function(){var a=this;!(window.googletag&&window.googletag.cmd&&this.options.pageOptions)||f.common.ads.DisplayAd.displayAdsPageTargeting&&this.sameObjectProperties(f.common.ads.DisplayAd.displayAdsPageTargeting,this.options.pageOptions,["tile"])||(f.common.ads.DisplayAd.displayAdsPageTargeting=this.options.pageOptions,
window.googletag.cmd.push(function(){var b=window.googletag,c=0;if(b&&"function"===typeof b.pubads){a.options.isForceSafeFrame&&b.pubads().setForceSafeFrame(!0);if(a.options.pageOptions)for(var d in a.options.pageOptions)d&&a.options.pageOptions.hasOwnProperty(d)&&(b.pubads().setTargeting(d,a.options.pageOptions[d]),c++);a.options.gptPageURL&&b.pubads().set("page_url",a.options.gptPageURL)}else a.logError("pageTargeting/fail")}))},setupAdTargeting:function(){var a=this;window.googletag&&window.googletag.cmd&&
window.googletag.cmd.push(function(){var b=window.googletag,c=0;if(b&&"function"===typeof b.defineSlot){var d=a.definedSlot||b.defineSlot(a.options.gptTargetID,a.getAdSizes(),a.id());if(d&&"function"===typeof d.addService){d.addService(b.pubads()).clearTargeting();if(a.options.adBlockOptions)for(var e in a.options.adBlockOptions)e&&a.options.adBlockOptions.hasOwnProperty(e)&&d&&d.setTargeting&&(d=d.setTargeting(e,a.options.adBlockOptions[e]),c++);a.definedSlot=d}else a.logError("adTargeting/slotfail")}else a.logError("adTargeting/fail")})},
enableServices:function(){var a=this;window.googletag&&window.googletag.cmd&&(this.smartAdApplied=!1,window.googletag.cmd.push(function(){var b=window.googletag;b&&"function"===typeof b.pubads&&(b.pubads().collapseEmptyDivs(),b.enableServices(),a.displayedSlot?a.definedSlot?(a.element.show(),b.pubads().refresh([a.definedSlot])):a.logError("error/badslot"):(a.displayedSlot=!0,b.display(a.id())),a.hookedSlotRender||(a.hookedSlotRender=1,googletag.pubads().addEventListener("slotRenderEnded",function(b){b&&
b.slot===a.definedSlot&&f.events.publish("displayad.loaded")})))}))},getAdSizes:function(){var a;this.options.gptAdSizes&&(a=this.validateAdSizes(this.options.gptAdSizes,"list"));return a||this.validateAdSizes([parseInt(this.options.gptAdWidth),parseInt(this.options.gptAdHeight)],"single")},validateAdSizes:function(a,b){var c=function(a){return!isNaN(a)&&0<a&&9999>a&&a===parseInt(a,10)},d=function(a){return a&&a.pop&&2===a.length&&c(a[0])&&c(a[1])};if(!a||!a.pop)return this.logError("error/size/"+
b+"/noarray",!0,{sizes:a}),null;if(d(a))return a;for(var e=0;e<a.length;e++)if(!d(a[e]))return this.logError("error/size/"+b+"/badsize",!0,{sizes:a}),null;return a},setupSmartAdPoll:function(){var a=this;this.smartAdIntervalID||(this.startedSmartAdInterval=new Date,this.smartAdIntervalID=setInterval(function(){var b=a.startedSmartAdInterval;!b||!b.getTime||!a.options||isNaN(a.options.smartAdPollMSLimit)||(new Date).getTime()-b.getTime()>a.options.smartAdPollMSLimit?(clearInterval(a.smartAdIntervalID),
a.smartAdIntervalID=null):(b=a.hasDARTResponse())&&1===b.length&&b.text&&(clearInterval(a.smartAdIntervalID),a.smartAdIntervalID=null,a.kickoffSmartAd(a.parseSmartAdInfo(b.text())))},300))},hasDARTResponse:function(){var a=null;this.element.find("iframe").each(function(){try{var b=g(this).contents().find("body #smtdiv");if(b.length)return a=b,!1}catch(c){a=-1}});return a},parseSmartAdInfo:function(a){try{return JSON.parse(a)}catch(b){}},kickoffSmartAd:function(a){if(a&&!this.smartAdApplied&&(a.searchid||
(a.searchid=this.options&&this.options.pageOptions?this.options.pageOptions.searchid:null),a.provider_code&&a.searchid)){var b=this.getSmartAdURL(a);if(b){this.subscriptions&&this.subscriptions["smartad.global.resize"]||this.subscribe("smartad.global.resize",this.onSmartAdGlobalResize.bind(this));window.resizeIframeToContents=function(){f.events.publish("smartad.global.resize")};window.R9.Ads=window.R9.Ads||{};window.R9.Ads.SmartAd=window.R9.Ads.SmartAd||{slots:{R0:{},R1:{},M0:{}},adjustBannerContainerSize:function(a,
b,c){}};var c="";"string"===typeof a.sz&&(c=(c=a.sz.split("x"))&&2===c.length&&parseInt(c[0])&&parseInt(c[1])?" width\x3d'"+c[0]+"' height\x3d'"+c[1]+"' ":"");this.smartAdApplied=!0;this.element.html("\x3ciframe class\x3d'smartad-frame' frameborder\x3d'0' "+c+" scrolling\x3d'no' src\x3d'"+b+"'\x3e\x3c/iframe\x3e")}}},onSmartAdGlobalResize:function(){if(!this.smartadSized){var a=g(this.element).find("iframe.smartad-frame").first(),b,c,d,e;if(a.length){try{b=a.contents().find("body")}catch(h){return}this.smartadSized=
1;c=a.outerWidth();d=a.outerHeight();e=b.outerWidth();b=b.outerHeight();2>e||2>b?g(this.element).hide():(c!==e&&a.attr("width",e),d!==b&&a.attr("height",b))}}},getSmartAdURL:function(a){if(!a)return null;var b=0,c,d="R0",e=a.provider_code?encodeURIComponent(a.provider_code):"",f=a.click_tracking?encodeURIComponent(a.click_tracking):"",g=a.sz?encodeURIComponent(a.sz):"";this.options&&this.options.adBlockOptions&&(c=this.options.adBlockOptions.gptAdID,"string"===typeof c&&(b=c.substr(c.length-1,1)),
c=this.options.adBlockOptions.origin,"string"===typeof c&&1<c.length&&(d=c.substr(c.length-2,2)));return"/h/ads/smartad?provider_code\x3d"+e+"\x26searchid\x3d"+a.searchid+"\x26clicktracking\x3d"+f+"\x26sz\x3d"+g+"\x26rank\x3d"+b+"\x26logimpr\x3dtrue\x26strm\x3d\x26pageorigin_location\x3d"+d+"\x26isstreaming\x3d"},sameObjectProperties:function(a,b,c){if(!a||!b)return!1;var d;c=c||[];for(d in a)if(a.hasOwnProperty(d)&&!b.hasOwnProperty(d))return!1;for(d in b)if(b.hasOwnProperty(d)){if(!a.hasOwnProperty(d))return!1;
if(!(0<=c.indexOf(d))&&a[d]!==b[d]){var e=a[d];if(e=e!==e)e=b[d],e=e!==e;if(!e)return!1}}return!0},logError:function(a,b,c){this.options.loggingEnabled&&(b&&window.Rollbar?Rollbar.error("DisplayAd error: "+a,c):f.Analytics.api.trackEvent(this.getLoggingPath()+a))},getLoggingPath:function(){var a="ads/displayAd/";this.options.loggingPrefix&&(a=this.options.loggingPrefix+"/"+a);return this.options.pageLocation?a+this.options.pageLocation+"/":a}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.ads.IntentMedia",{options:{isRP:!1,pageIdFD:"fd",pageIdRP:"rp",searchFormPrefix:"",siteName:"KAYAK",siteCurrency:null,libraryURL:"//a.cdn.intentmedia.net/javascripts/intent_media_kayak.js",searchCityId:void 0,searchCity:void 0,searchState:void 0,searchCountry:void 0,exitUnitClickSelector:null,segmentationInfo:null},explicitExitUnitClicked:null,externalShowExitUnits:null,init:function(){this.base();if(b.config.getBoolean("ui.no.popup.enabled",!1)&&"notloggedin"!==
b.globals.analytics.loginState)return!1;this.setupBasicIntentMediaProperties(this.options.isRP?this.options.pageIdRP:this.options.pageIdFD);b.common.ads.IntentMedia.isLibraryLoaded||(b.common.ads.IntentMedia.isLibraryLoaded=!0,this.loadLibrary())},addEventHandlers:function(){this.base();if(b.config.getBoolean("ui.no.popup.enabled",!1)&&"notloggedin"!==b.globals.analytics.loginState)return!1;this.subscribe("search.poll.response",this.onSearchPollResponse.bind(this));if(this.options.exitUnitClickSelector)d(document).off("click.imExit").on("click.imExit",
this.onClickedDocExplicitExitUnit.bind(this));this.options.segmentationInfo&&this.subscribe(["provider.book.click","multibook.providerClicked"],this.onClickedBooking.bind(this));this.subscribe("intentmedia.setpopups",this.onSetShowExitUnits.bind(this))},inlineComponentsReady:function(){this.base();if(b.config.getBoolean("ui.no.popup.enabled",!1)&&"notloggedin"!==b.globals.analytics.loginState)return!1;b.events.publish("intentmedia.submit.handler",{callOnSubmit:d.proxy(this.onExternalFormSubmit,this)});
var a;this.options.isRP?(a=b.question.ask(this.options.searchFormPrefix+".rp.searchform"),this.setupSearchIntentMediaProperties(a)):a=b.question.ask(this.options.searchFormPrefix+".fd.searchform");a&&this.loadSmartyCityProperties(a.cityId,this.options.isRP)},loadLibrary:function(){var a=document.createElement("script");a.src=this.options.libraryURL;a.async=!0;var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)},onSetShowExitUnits:function(a){window.IntentMediaProperties&&
(IntentMediaProperties.show_exit_units=a?"Y":"N");this.externalShowExitUnits=a},onExternalFormSubmit:function(a){this.send&&this.setupSearchIntentMediaProperties&&(this.setupSearchIntentMediaProperties(a),IntentMediaProperties.show_exit_units&&"Y"!==IntentMediaProperties.show_exit_units||(this.externalShowExitUnits&&this.explicitExitUnitClicked&&this.openExplicitExitUnit(),this.send()))},onSearchPollResponse:function(){this.options.isRP||(this.options.isRP=!0,this.setupBasicIntentMediaProperties(this.options.pageIdRP))},
send:function(){try{window.IntentMedia.Kayak.fillExitUnit()}catch(a){}},onClickedDocExplicitExitUnit:function(a){a&&this.options.exitUnitClickSelector&&d(a.target).is(this.options.exitUnitClickSelector)&&(this.explicitExitUnitClicked=1,this.openExplicitExitUnit())},openExplicitExitUnit:function(){if(!IntentMediaProperties.show_exit_units||"Y"===IntentMediaProperties.show_exit_units)try{window.IntentMedia.Kayak.openExitUnit(),document.activeElement&&document.activeElement.blur()}catch(a){}},loadSmartyCityProperties:function(a,
e){var c=this;a&&d.ajax({async:!0,dataType:"json",url:"/f/smarty?f\x3dj\x26lc\x3den\x26lc_cc\x3dUS\x26s\x3d16\x26where\x3dc"+encodeURIComponent(a),success:function(b){b&&b.length?(c.options.searchCityId=a,c.options.searchCity=b[0].cityonly,c.options.searchState=b[0].rc,c.options.searchCountry=b[0].cc):(c.options.searchCityId=void 0,c.options.searchCity=void 0,c.options.searchState=void 0,c.options.searchCountry=void 0);e&&c.setupSearchIntentMediaProperties()}})},getSiteName:function(){return this.options.siteName?
this.options.siteName:"KAYAK_"+b.globals.locale.lc_cc},setupBasicIntentMediaProperties:function(a){window.IntentMediaProperties=window.IntentMediaProperties||{};var e=a&&window.IntentMediaProperties.page_id&&a!==window.IntentMediaProperties.page_id,c=this.getSiteName();d.extend(window.IntentMediaProperties,{page_id:a,site_name:c,site:c,site_language:b.globals.locale.lc||"en",site_country:b.globals.locale.lc_cc||"US",site_currency:this.options.siteCurrency||"USD",device_format_type:{bb:"Desktop",mb:"Mobile",
tb:"Tablet"}[b.globals.platform]||"Desktop"});this.options.segmentationInfo&&d.extend(window.IntentMediaProperties,this.options.segmentationInfo);if(e)try{window.IntentMedia.page_id_updated()}catch(f){}},setupSearchIntentMediaProperties:function(){},onClickedBooking:function(a){if(window.IntentMedia&&IntentMedia.trigger&&window.IntentMediaProperties&&a&&a.resultId){a=this.hash(a.resultId+a.providerName+a.providerCode)+"";var b=this.options.searchFormPrefix;b&&(b.lastIndexOf("s")===b.length-1&&(b=
b.substr(0,b.length-1)),b+=".clickout");d.extend(window.IntentMediaProperties,{page_id:b,total_conversion_value:"100.00",order_id:a});IntentMedia.trigger("page_id_updated")}},hash:function(a){var b,c,d=0;if(!a)return d;b=a.length;for(c=0;c<b;c++)d=(d<<5)-d+a.charCodeAt(c),d|=0;return d}})})(R9,jQuery);(function(e,c){e.createComponentClass("common.ads.SmarterTravel",{options:{apiKey:"",libraryUrl:"",locale:"",currency:"",placementId:"",adVertical:"",isPoppableState:function(){return!0},suppressSelectors:[],updateSelector:"",isRP:!1},leaveBehind:null,init:function(){this.options.isPoppableState()&&(this.loadLibrary(),this.bindEvents())},loadLibrary:function(){var a=document.createElement("script");a.src=this.options.libraryUrl;a.async=!0;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,
c)},extract:function(){return{}},bindEvents:function(){var a=this;window.SmarterTravelNetwork_ready=window.SmarterTravelNetwork_ready||[];window.SmarterTravelNetwork_ready.push(function(d){function e(a){switch(a){case "e":case "p":return"economy_coach";case "b":return"business";case "f":return"first_class";default:return null}}var h={apiKey:a.options.apiKey,contextData:function(){var b={currency:a.options.currency,locale:a.options.locale,ad_vertical:a.options.adVertical};c.extend(b,a.extract());if(b.hasOwnProperty("date1")){var f=
moment(b.date1).format("MM/DD/YYYY");b.date1=d.Util.formatDate(f,"MM/DD/YYYY")}b.hasOwnProperty("date2")&&(f=moment(b.date2).format("MM/DD/YYYY"),b.date2=d.Util.formatDate(f,"MM/DD/YYYY"));b.hasOwnProperty("flight_service_class")&&(b.flight_service_class=e(b.flight_service_class));return b},popupSuppressionPeriod:24,logLevel:d.Log.LOG_LEVELS.DEBUG};window.R9Admin&&c.extend(h,{logLevel:d.Log.LOG_LEVELS.DEBUG});d.init(h);a.leaveBehind=d.createLeaveBehind({placementId:a.options.placementId,clickEventSelector:!1,
redirectPageUrl:"/s/horizon/common/ads/SmarterTravelInterstitial"});d.loadPlacements([a.leaveBehind]);c(document).on("click",g)});var g=function(d){0<c(d.target).closest(a.options.suppressSelectors.join(",")).length||!a.options.isPoppableState()||(a.options.isRP?a.leaveBehind.launch():a.leaveBehind.launchHolder(),setTimeout(function(){c(document).off("click",g)},50))};c(".searchButton").click(function(){a.launch()})},launch:function(){this.options.isPoppableState()&&this.leaveBehind.launch()}})})(R9,
jQuery);(function(b,c){b.createComponentClass("common.ads.TextAd",{options:{displayOptions:{colorBackground:"#F7F7F7",fontSizeTitle:15,colorTitleLink:"#3083F0",colorDomainLink:"#EE7A00",colorText:"#444",noTitleUnderline:!0,width:void 0},adBlockOptions:null,pageOptions:null,pageLocation:null,title:null,minRefreshRate:null},adTimeout:null,init:function(a){a=new b.common.ads.Ad;a.loadGPT();a.loadAdsense();this.title=this.getChildElement("title");this.showTitle(!1);this.publishAdsRequest()},addEventHandlers:function(){this.subscribe("resultspage.ads.update",
this.onResultsPageAdsUpdate.bind(this))},inlineComponentsReady:function(){this.publishAdsRequest();this.hasPageOptions()&&this.checkQAd()},publishAdsRequest:function(){b.events.publish("ads.request",{adType:"textAd",pageLocation:this.options.pageLocation,now:!this.hasPageOptions(),events:["searchform.submit","resultsHeader.changed","filters.changed","paginator.change"],minRefreshRate:this.options.minRefreshRate})},onResultsPageAdsUpdate:function(a){if(a=(new b.common.ads.Ad).findAdDataForType("textAd",
this.options.pageLocation,a))this.options.pageOptions=a.pageOptions,this.options.adBlockOptions=a.adBlockOptions,window.clearTimeout(this.adTimeout),this.adTimeout=window.setTimeout(this.checkQAd.bind(this),b.config.getInt("ui.horizon.ads.delay",1E3))},hasPageOptions:function(){return this.options.pageOptions&&!c.isEmptyObject(this.options.pageOptions)},getPageOptions:function(){var a=this;return c.extend({linkTarget:"_blank",adsResponseCallback:function(b){b&&a._id&&b.hasOwnProperty(a._id)&&a.options&&
a.options.impressionURL&&c.get(a.options.impressionURL+b[a._id])},adLoadedCallback:function(c,d){d&&(b.events.publish("textad.loaded"),a.showTitle(!0))}},this.options.pageOptions||{})},getTextAdSettings:function(){return c.extend({},this.options.adBlockOptions||{},this.options.displayOptions||{},{container:this.id("ads")})},checkQAd:function(){window._googCsa&&this.hasPageOptions()&&window._googCsa("ads",this.getPageOptions(),this.getTextAdSettings())},showTitle:function(a){null!==this.title&&(a?
this.title.removeClass("hidden"):this.title.addClass("hidden"))}})})(R9,jQuery);(function(l,f){function k(a){return null===a||"undefined"===typeof a}function m(a){return k(a)||"string"===typeof a&&""===a.trim()}l.createComponentClass("common.airportpicker.AirportPicker",{cacodeInputField:null,sbhintInputField:null,nearbyAirportsTable:null,customAirportMapDiv:null,radiusDropdown:null,submitButtonInput:null,dialog:null,locationSmarty:null,currentCallback:null,events:{open:"flights.airportpicker.open",submit:"flights.airportpicker.submit"},init:function(){this.base.apply(this,arguments);
this.options.events&&(this.events=f.extend(!0,{},this.events,this.options.events));this._setupLocale();this.prefetchDomElements();this.bindSmarty();this.bindRadius();this.bindDialog()},_setupLocale:function(){k(l.globals.locale)&&(l.globals.locale={lc_cc:"US",lc:"en"})},loadCustomAirports:function(){var a=this,b=function(a){var b={cacode:a.cacodeInputField.val(),calocation:a.locationInputVal(),sbhint:a.sbhintInputField.val(),radius:a.radiusDropdown.getSelectedElement().value,maxAirports:a.options.maxAirportsSearch};
m(b.calocation)&&(b.calocation="",b.cacode="");"train"===a.options.searchType&&(b.trainsOnly="true");return b}(this);2===arguments.length&&(b.startcode=arguments[0],b.startlocation=arguments[1]);this.showLoader();jq.ajax({type:"GET",url:this.options.ajaxUrl,data:b,dataType:"json",cache:!1,success:function(b){a.updateDom(b)},error:function(a,b,e){alert(b)},done:function(){a.hideLoader()}})},addEventHandlers:function(a){this.base.apply(this,arguments);var b=this;this.getChildElement("form").submit(function(a){a.preventDefault();
return b.eventTriggers().submit()});this.subscribe(this.events.open,f.proxy(this.eventListeners().open,this))},eventListeners:function(){var a=this;return{open:function(b){k(b)||b.id!==a.id()||a.dialog.isOpen()||(a.updateDom(),a.sbhintInputField.val(b.hint),a.loadCustomAirports(b.code,b.location),a.currentCallback=b.callback,a.dialog.open())}}},eventTriggers:function(){function a(){var a=b.getCheckedAirports().map(function(){return f(this).val()}).get().join(", "),c=b.sbhintInputField.val(),e=b.cacodeInputField.val();
b.radiusDropdown.getValue();m(c)||(e=c);c=3<a.length?"C-"+e+"-"+b.radiusDropdown.getValue():a;return{id:b.id(),code:c,location:a}}var b=this;return{submit:function(){try{var h=b.getAirportCheckCount();if(0>=h)throw b.options.msg.noAirportSelected;if(h>b.options.maxAirportsSelect)throw b.options.msg.tooManyAirportsSelected;var c=a();l.events.publish(b.events.submit,c);"function"===typeof b.currentCallback&&b.currentCallback(c);b.dialog.close()}catch(e){alert(e)}}}},bindDialog:function(){var a=this,
b=function(){a.dialog.calculateDimensions()};this.dialog=this.getChildElement("dialog").dialog({onOpen:function(){f(window).bind("resize",b)},onClose:function(){f(window).unbind("resize",b)}}).getWidget()},bindSmarty:function(){var a=this,b={dataSource:a.options.smartyUrl,flareSmartyType:a.options.flareSmartyType,v:"v2",clearItem:function(){},setItem:function(b,c,e){setTimeout(function(){b.elementNode.value=c.str;a.cacodeInputField.val(c.id);var d=!1,g="",e="";switch(c.type){case "ap":case "city":case "rail":d=
c.id.split("/");1<d.length&&(c.id=d[1],e=c.id);d=!0;break;case "freereg":g="F:%s".format(c.frid);break;case "reg":g="R:%s".format(c.rid);break;case "ctry":g="Y:%s".format(c.cid)}a.cacodeInputField.val(e);a.sbhintInputField.val(g);a.updateRadiusVisibility(d);a.loadCustomAirports()},1)}};this.locationSmarty="train"===this.options.searchType?this.getChildElement("calocation").trainSmarty(b).getWidget():this.getChildElement("calocation").flightSmarty(b).getWidget()},bindRadius:function(){var a=this;this.radiusDropdown=
this.getChildElement("radius").dropdown({change:function(){a.loadCustomAirports()}}).getWidget()},prefetchDomElements:function(){this.cacodeInputField=this.getChildElement("cacode");this.sbhintInputField=this.getChildElement("sbhint");this.nearbyAirportsTable=this.getChildElement("nearbyAirportsTable");this.customAirportMapDiv=this.getChildElement("customAirportMapDiv");this.submitButtonInput=this.getChildElement("submit")},updateDom:function(a){var b="",h="",c="",e=!1,d=[],g,f;k(a)||(b=a.calocation,
h=a.cacode,c=a.sbhint,f=a.radius,k(a.nearbyAirports)||(e=a.nearbyAirports.hasDistance,d=a.nearbyAirports.nearbyAirportsList),k(a.customAirportMap)||(g=a.customAirportMap));this.updateRadius(f);this.updateSmartyInputs(b,h,c);this.updateTable(e,d);this.updateMap(g);this.dialog.calculateDimensions()},updateRadius:function(a){m(a)&&(a=this.radiusDropdown.element.find("option[selected]").val());this.radiusDropdown.setValue(a)},updateRadiusVisibility:function(a){if(1>arguments.length){var b=self.sbhintInputField.val();
a=!m(b)}this.findChildElement(".gridCellRadius")},updateSmartyInputs:function(a,b,f){this.locationInputVal(a);this.cacodeInputField.val(b);this.sbhintInputField.val(f)},updateTable:function(a,b){function h(a,b){a=l.template.renderElement("airportItemRow",{airportName:b.airportName,airportDistance:b.localizedDistance,rank:b.rank,hasDistance:a,airportCode:b.airportCode,markerText:b.markerText});var d="cb"+b.airportCode,d=f(a).find("#"+d);(function(a,b,d){!0===b&&a.prop("checked",!0);a.change(function(){c()})})(d,
b.preChecked);(function(a,b){a.click(function(){b.prop("checked",!b.prop("checked"));b.change()})})(a,d);return a}function c(){0>=e.getAirportCheckCount()?e.submitButtonInput.addClass("disabled"):e.submitButtonInput.removeClass("disabled")}var e=this,d=this.nearbyAirportsTable.find("tbody");d.empty();var g=this.findChildElement(".customAirportsForm");if(0<b.length)for(g.addClass("resultsAvailable"),g=0;g<b.length;g++)d.append(h(a,b[g]));else g.removeClass("resultsAvailable");a?this.nearbyAirportsTable.removeClass("noDistance"):
this.nearbyAirportsTable.addClass("noDistance");c()},updateMap:function(a){function b(a){c.customAirportMapDiv.find(".airportPin").remove();k(a)||jq.each(a,function(a,b){a=l.template.renderElement("airportPin",{id:b.itemId,xCoord:b.xCoord+-12+"px",yCoord:b.yCoord+-25+"px",hoverText:b.hoverText,label:b.pinLabel});c.customAirportMapDiv.append(a)})}function h(){function a(a){a=f(a).attr("id").match(/^(row|pin)(.*)$/);return 3===a.length?a[2]:""}c.nearbyAirportsTable.find(".airportItemRow").off("mouseenter mouseleave").on("mouseenter mouseleave",
function(){var b=a(this);f("#pin"+b).toggleClass("active")});c.customAirportMapDiv.find(".airportPin").off("mouseenter mouseleave").on("mouseenter mouseleave",function(){var b=a(this);f("#row"+b).toggleClass("active")})}var c=this;k(a)||m(a.mapUrl)?(this.customAirportMapDiv.css("background-image",""),this.customAirportMapDiv.removeClass("mapAvailable"),b([])):(this.customAirportMapDiv.addClass("mapAvailable"),this.customAirportMapDiv.css("background-image","url("+a.mapUrl+")"),b(a.pinMarkers),h())},
getCheckedAirports:function(){return this.findChildElement(".airportCheck \x3e input:checked")},getAirportCheckCount:function(){return this.getCheckedAirports().length},showLoader:function(){this._loadingTimeout=setTimeout(f.proxy(function(){this.element.addClass("loading")},this),100)},hideLoader:function(){clearTimeout(this._loadingTimeout);this.element.removeClass("loading")},findChildElement:function(a){return this.dialog.element.find(a)},locationInputVal:function(){1===arguments.length&&(this.locationSmarty.elementNode.value=
arguments[0]);return this.locationSmarty.elementNode.value}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.authentication.DialogContainer",{options:{initialView:"login",usingCustomCallback:!1,preventClose:!1,socialApiErrorMessage:""},view:"login",dialog:null,init:function(){this.dialog=this.getChildElement("dialog").dialog({preventClose:this.options.preventClose}).getWidget();this.setView(this.options.initialView)},addEventHandlers:function(){var a=this,d=this.getChildElement("fbauth"),e=this.getChildElement("gauth");this.subscribe(["login.success","signup.success",
"fbauth.login.success","googleauth.login.success"],function(){b.authentication.needsRefresh=!0;a.options.usingCustomCallback?b.events.publish("authentication.success"):setTimeout(function(){window.location.reload(!0)},300)});this.subscribe("social.response.loaded",function(){a.dialog.close()});this.subscribe(["social.error","login.error","signup.error"],this.showError.bind(this));this.element.find(".loginLink").click(function(){a.setView("login")});this.element.find(".signupLink").click(function(){a.setView("signup")});
d.click(function(){b.authentication.external.facebook.login()});e.click(function(){b.authentication.external.google.login()});window.FB||this.handleMissingSocialAPI(d,"r9.facebook.api.loaded");window.gapi&&window.gapi.auth2||this.handleMissingSocialAPI(e,"r9.google.api.loaded")},setView:function(a){this.view!==a&&(this.view=a,this.element.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")}).addClass("vm-"+a),this.element.find(".loginLinks .active").removeClass("active"),this.element.find(".loginLinks .%sLink".format(a)).addClass("active"),
b.events.publish("authentication.viewChange",{type:a}))},handleMissingSocialAPI:function(a,b){a.addClass("disabled");this.options.socialApiErrorMessage&&a.toolTip({content:this.options.socialApiErrorMessage,position:"top",showImmediately:!1});this.subscribe(b,function(){a.removeClass("disabled");a.data("toolTip")&&a.data("toolTip").removeWidget()})},showError:function(a){if(this.options.improvedMessaging){c(".username, .pass, .auth-tooltip-hook").each(function(){c(this).data("toolTip")&&c(this).data("toolTip").removeWidget()});
var b=a.element||this.element.find(".auth-tooltip-hook:visible")}else b=a.element||this.element.find(".auth-tooltip-hook:visible");b.toolTip({content:a.message,baseClass:"loginDlgError",position:"top",showImmediately:!0,activation:"click"})}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.authentication.ExternalResponse",{typeMap:{l:"link",w:"welcome",n:"cannotLink"},options:{type:null,site:null,dialogId:null,accessToken:null,userId:null,staticSignInEnabled:!1,preventClose:!1},dialog:null,init:function(){var a=this.typeMap[this.options.type],b="fb"===this.options.site?this.makeFacebookController():this.makeGoogleController();this.dialog=c("#"+this.options.dialogId).dialog({preventClose:this.options.preventClose}).getWidget();this.dialog.open(b[a])},
addEventHandlers:function(){var a=this;b.events.subscribe("login.error",function(b){a.element.find(".credentials").toolTip({content:b.message,extraClass:"errorTip",showImmediately:!0})})},makeFacebookController:function(){var a=this;return{welcome:function(){new b.common.authentication.LoginForm(a.element.find(".Auth-LoginForm"),{onSubmit:function(c){b.authentication.external.facebook.loginAndLink(a.options.accessToken,a.options.userId,c.username,c.passwd)}});c(a.element.find(".actionlink.continue")).click(function(){b.authentication.external.facebook.login(a.options.accessToken,
a.options.userId,1)});c(a.element.find(".actionlink.link")).click(function(){a.element.addClass("loginVisible")});c(a.element.find(".notYouButton")).click(function(){a.dialog.close();b.Social.FB.logout();a.options.staticSignInEnabled?b.authentication.showDefault():b.authentication.showLogin()})},link:function(){a.element.find("[name\x3dlinkreg]").on("submit",function(){var c=a.element.find("[name\x3dpasswd]").val(),d=a.element.find("[name\x3dusername]").val();c&&0<c.length&&b.authentication.external.facebook.loginAndLink(a.options.accessToken,
a.options.userId,d,c)})},cannotLink:function(){a.element.find("a").click(function(){a.dialog.close();b.Social.FB.logout();a.options.staticSignInEnabled?b.authentication.showDefault():b.authentication.showLogin()})}}},makeGoogleController:function(){var a=this;return{welcome:function(){c(a.element.find(".actionlink.continue")).click(function(){b.authentication.external.google.login(a.options.accessToken,1)});c(a.element.find(".actionlink.link")).click(function(){a.element.addClass("loginVisible")});
c(a.element.find(".notYouButton")).click(function(){a.dialog.close();b.Social.Google.logout();a.options.staticSignInEnabled?b.authentication.showDefault():b.authentication.showLogin()})}}}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.authentication.LoginForm",{url:"/k/run/auth/login",loggingPrefix:"account-login",usernameEl:null,passwordEl:null,submitEl:null,stickyEl:null,options:{onSubmit:null,newDialog:!1,promoType:"",improvedMessaging:!1,msg:null},init:function(){this.usernameEl=this.getChildElement("username");this.passwordEl=this.getChildElement("password");this.submitEl=this.getChildElement("submit");this.stickyEl=this.getChildElement("remember");this.form=this.getChildElement("form")},
addEventHandlers:function(){var a=this;this.form.submit(this.doLogin.bind(this));this.subscribe("authentication.viewChange",function(b){a.element.toggleClass("Show","login"===b.type);""===a.usernameEl.val()?a.usernameEl.focus():""===a.passwordEl.val()&&a.passwordEl.focus()});this.getChildElement("forgot").click(function(){b.Analytics.api.trackEvent({category:"forgot-password",action:"reset-password"})});this.options.newDialog&&(this.getChildElement("cancel").click(function(){b.events.publish("authentication.setView",
{type:"default"})}),this.element.find(".footerGrid .signup").click(function(){b.events.publish("authentication.setView",{type:"signup"})}))},doLogin:function(){var a={};a.username=this.usernameEl.val();a.passwd=this.passwordEl.val();if(this.options.improvedMessaging&&8>=this.passwordEl.val().length)return b.events.publish("login.error",{formToken:null,message:this.options.msg.passwordTooShort,status:-1,uid:null,userInfo:null,element:this.passwordEl}),!1;this.stickyEl&&(a.sticky=this.stickyEl.is(":checked"));
"function"===typeof this.options.onSubmit?this.options.onSubmit.call(this,a):c.remotePostJSON({url:this.url,data:a}).done(this.success.bind(this)).fail(this.fail.bind(this));this.submitEl.focus();this.submitEl.attr("disabled",!0);return!1},success:function(a){0<=a.status?(b.storage.set("R9ScrollY",window.document.documentElement.scrollTop||window.document.body.scrollTop),b.authentication.formToken=a.formToken,b.authentication.userInfo=a.userInfo,b.events.publish("login.success",{username:this.usernameEl.val()}),
b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"login-email",label:this.options.promoType})):(this.options.improvedMessaging&&(a.element="p"===a.errorField?this.passwordEl:"u"===a.errorField?this.usernameEl:null),b.events.publish("login.error",a),this.submitEl.attr("disabled",!1))},fail:function(a){b.events.publish("login.fail");this.submitEl.attr("disabled",!1)}})})(R9,jq||jQuery);(function(b,a){b.createComponentClass("common.authentication.LoginOptionsDialog",{trackingCategory:"anon-trips-login",trackingLabel:null,init:function(){this.optionsDialog=this.element.dialog().getWidget();this.confirmationDialog=a("#"+this.id("confirmation")).dialog().getWidget()},addEventHandlers:function(){b.events.subscribe("show.login.options.dialog",a.proxy(this.openDialog,this));a("#"+this.id("regularAuth")).click(a.proxy(this.regularAuth,this));a("#"+this.id("guestAuth")).click(a.proxy(this.guestAuth,
this));a("#"+this.id("guestConfirmation")).click(a.proxy(this.continueAsGuest,this));a("#"+this.id("googleAuth")).click(a.proxy(this.googleAuth,this));a("#"+this.id("fbAuth")).click(a.proxy(this.fbAuth,this));a("#"+this.id("signUp")).click(a.proxy(this.signUp,this))},loadThirdPartyJS:function(){var c=a.Deferred();b.Social.FB.ensureAPILoaded(b.Social.Google.ensureAPILoaded(c.resolve));return c.promise()},openDialog:function(a){a=a||{};this.trackingLabel=a.trackingLabel||null;a.forceLogin||!this.stayAnon?
this.showDialog():this.continueAsGuest()},showDialog:function(){this.track("display-dialog");var a=this;this.loadThirdPartyJS().then(function(){a.optionsDialog.open()})},closeOptionsDialog:function(){b.events.unsubscribe("continue.as.guest");this.optionsDialog.close()},regularAuth:function(){this.track("use-email-address");this.closeOptionsDialog();b.authentication.showLogin()},continueAsGuest:function(){this.track("continue-as-guest");this.confirmationDialog.close();b.events.publish("continue.as.guest");
this.stayAnon=!0;this.closeOptionsDialog()},guestAuth:function(){this.track("guest-confirm");this.optionsDialog.close();b.config.getBoolean("ui.trips.anon.second-step-dialog.enabled",!1)?this.continueAsGuest():this.confirmationDialog.open()},signUp:function(){this.track("guest-sign-me-up");this.confirmationDialog.close();this.optionsDialog.open()},fbAuth:function(){this.closeOptionsDialog();b.events.subscribe("fbauth.login.success",function(){window.location.reload(!0)});b.authentication.external.facebook.login(null,
null,null,null,{category:this.trackingCategory,label:this.trackingLabel})},googleAuth:function(){this.closeOptionsDialog();b.events.subscribe("googleauth.login.success",function(){window.location.reload(!0)});b.authentication.external.google.login(null,null,null,{category:this.trackingCategory,label:this.trackingLabel})},track:function(a){b.Analytics.api.trackEvent({category:this.trackingCategory,action:a,label:this.trackingLabel})}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.authentication.NewDialogContainer",{options:{initialView:"default",usingCustomCallback:!1,promoType:""},view:"default",dialog:null,socialForm:null,loggingPrefix:"account-login",init:function(){this.dialog=this.getChildElement("dialog").dialog().getWidget();this.socialForm=this.getChildElement("socialForm");this.setView(this.options.initialView)},addEventHandlers:function(){var a=this;this.subscribe(["login.success","signup.success","fbauth.login.success",
"googleauth.login.success"],function(){a.options.usingCustomCallback?b.events.publish("authentication.success"):setTimeout(function(){window.location.reload(!0)},300)});this.subscribe("social.response.loaded",function(){a.dialog.close()});this.subscribe(["social.error","login.error","signup.error"],this.showError.bind(this));this.element.find(".signInOrUp .sign-in").click(function(){b.Analytics.api.trackEvent({category:a.loggingPrefix,action:"use-email-sign-in",label:a.options.promoType});a.setView("login")});
this.element.find(".signInOrUp .sign-up").click(function(){b.Analytics.api.trackEvent({category:a.loggingPrefix,action:"use-email-sign-up",label:a.options.promoType});a.setView("signup")});this.getChildElement("fbauth").click(function(){b.authentication.external.facebook.login(null,null,null,null,{category:a.loggingPrefix,label:a.options.promoType})});this.getChildElement("gauth").click(function(){b.authentication.external.google.login(null,null,null,null,{category:a.loggingPrefix,label:a.options.promoType})});
this.getChildElement("cancel").click(function(){a.dialog.close()});this.subscribe("authentication.setView",function(b){b.hasOwnProperty("type")&&a.setView(b.type)})},setView:function(a){this.view!==a&&(this.view=a,this.element.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")}).addClass("vm-"+a),this.element.find(".loginLinks .active").removeClass("active"),this.element.find(".loginLinks .%sLink".format(a)).addClass("active"),this.socialForm.toggleClass("Show","default"===a),b.events.publish("authentication.viewChange",
{type:a}))},showError:function(a){(a.element||this.element.find(".auth-tooltip-hook:visible")).toolTip({content:a.message,baseClass:"loginDlgError",position:"top",showImmediately:!0,activation:"click"})}})})(R9,jQuery);(function(a,c){a.createComponentClass("common.authentication.PromotedSignup",{options:{showForcedSignup:!1,isMultiLocaleMandatorySignup:!1},init:function(){var d=this.options.showForcedSignup,e=this.options.isMultiLocaleMandatorySignup;c(function(){if(d)if(e)a.authentication.showSignup({promo:"multilocale",preventClose:!0,type:"login"});else{var b=window.location.href;-1===b.lastIndexOf("/maps/hotelnew")&&-1===b.lastIndexOf("/reset/")&&-1===b.lastIndexOf("/mobile")&&setMetaCookie("forced-signup-shown",
"true",function(){a.config.getBoolean("ui.forcedsignup.enabled",!1)&&(a.config.getBoolean("ui.pushsocial.enabled",!1)?a.authentication.social.showSocialLogin():a.authentication.showSignup({promo:"promotedsignupv2"}))})}})}})})(R9,jq||jQuery);(function(b,d){b.createComponentClass("common.authentication.SignupForm",{url:"/k/run/auth/register",loggingPrefix:"account-login",usernameEl:null,passwordEl:null,airportEl:null,airportCodeEl:null,hasAirport:!1,submitEl:null,optinEl:null,form:null,legalCheck:null,options:{staticSignInEnabled:!1,improvedMessaging:!1,inline:!1,promo:null,promoType:null,msg:null},init:function(){this.usernameEl=this.getChildElement("username");this.passwordEl=this.getChildElement("password");this.airportEl=this.getChildElement("airport");
this.airportCodeEl=this.element.find("input[name\x3dairportcode]");this.hasAirport=this.airportEl.length&&this.airportCodeEl.length;this.submitEl=this.getChildElement("submit");this.optinEl=this.getChildElement("email");this.legalCheck=this.getChildElement("legalcheck");this.form=this.getChildElement("form")},bindAirportSmarty:function(){var a=this.airportCodeEl;this.airportEl.flightSmarty({setItem:function(b,c){c&&setTimeout(function(){"ap"===c.type||"rail"===c.type?(b.elementNode.value=c.short_str||
c.str,a.val(c.id)):"isl"===c.type&&(b.elementNode.value=c.str,a.val(""))},1)}})},addEventHandlers:function(){var a=this;this.hasAirport&&this.bindAirportSmarty();this.form.submit(this.doSignup.bind(this));this.options.inline||this.subscribe("authentication.viewChange",function(b){a.element.toggleClass("Show","signup"===b.type);""===a.usernameEl.val()?a.usernameEl.focus():""===a.passwordEl.val()&&a.passwordEl.focus()});this.options.staticSignInEnabled&&(this.getChildElement("cancel").click(function(){b.events.publish("authentication.setView",
{type:"default"})}),this.element.find(".footerGrid .signin").click(function(){b.events.publish("authentication.setView",{type:"login"})}))},doSignup:function(){var a=d.extend({},this.options);a.username=this.usernameEl.val();a.passwd=this.passwordEl.val();if(this.options.improvedMessaging&&8>=this.passwordEl.val().length)return b.events.publish("signup.error",{formToken:null,message:this.options.msg.passwordTooShort,status:-1,uid:null,userInfo:null,element:this.passwordEl}),!1;this.hasAirport&&(a.airport=
this.airportEl.val(),a.airportcode=this.airportCodeEl.val());a.confcode="";a.username=this.usernameEl.val();a.optin=this.optinEl.is(":checked");a.promo=this.options.promo;a.optin?b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"email-opt-in",label:this.options.promoType}):b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"email-opt-out",label:this.options.promoType});a.consent="";a.passwd=this.passwordEl.val();a.sub="";a.confirmed="";a.userInfo="";this.options.legalAuthRequired&&
this.legalCheck&&this.legalCheck.is(":checked")&&(a.consent=!0);d.remotePostJSON({url:this.url,data:a}).done(this.success.bind(this)).fail(this.fail.bind(this));this.submitEl.focus();this.submitEl.attr("disabled",!0);return!1},success:function(a){0<=a.status?(b.authentication.formToken=a.formToken,b.authentication.userInfo=a.userInfo,b.events.publish("signup.success"),b.Analytics.api.trackEvent({category:this.loggingPrefix,action:"signup-email",label:this.options.promoType})):(this.options.improvedMessaging?
b.events.publish("signup.error",{code:a.status,message:a.message,element:"p"===a.errorField?this.passwordEl:"u"===a.errorField?this.usernameEl:null}):b.events.publish("signup.error",{code:a.status,message:a.message}),this.submitEl.attr("disabled",!1))},fail:function(a){b.events.publish("signup.fail");this.submitEl.attr("disabled",!1)}})})(R9,jQuery);(function(b,e){b.createComponentClass("common.authentication.SimplifiedSignupDialog",{options:{usingCustomCallback:!1,socialApiErrorMessage:"",isV2:!1},dialog:null,init:function(){this.dialog=this.getChildElement("dialog").dialog().getWidget()},showDefault:function(a){this.dialog.show()},showLogin:function(a){this.getChildElement("signupContainer").hide();this.getChildElement("loginContainer").show();this.dialog.show()},showSignup:function(a){this.getChildElement("loginContainer").hide();this.getChildElement("signupContainer").show();
this.dialog.show()},addEventHandlers:function(){var a=this,c=this.getChildElement("facebookLogin"),d=this.getChildElement("googleLogin"),f=e.Deferred();b.Social.FB.ensureAPILoaded(b.Social.Google.ensureAPILoaded(f.resolve));c.click(function(){b.authentication.external.facebook.login()});d.click(function(){b.authentication.external.google.login()});window.FB||this.handleMissingSocialAPI(c,"r9.facebook.api.loaded");window.gapi&&window.gapi.auth2||this.handleMissingSocialAPI(d,"r9.google.api.loaded");
a.subscribe("social.response.loaded",function(){a.dialog.close()});a.getChildElement("signup").click(a.signupShow.bind(this));a.getChildElement("signup-text").click(a.signupShow.bind(this));a.getChildElement("login").click(a.signinShow.bind(this));a.getChildElement("signin-text").click(a.signinShow.bind(this));a.subscribe(["social.error","login.error","signup.error"],a.showError.bind(this));this.subscribe(["login.success","signup.success","fbauth.login.success","googleauth.login.success"],function(){a.options.usingCustomCallback?
b.events.publish("authentication.success"):setTimeout(function(){window.location.reload(!0)},300)})},signupShow:function(){this.getChildElement("loginContainer").hide();this.getChildElement("signupContainer").fadeIn("slow")},signinShow:function(){this.getChildElement("signupContainer").hide();this.getChildElement("loginContainer").fadeIn("slow")},handleMissingSocialAPI:function(a,b){a.addClass("disabled");this.options.socialApiErrorMessage&&a.toolTip({content:this.options.socialApiErrorMessage,position:"top",
showImmediately:!1});this.subscribe(b,function(){a.removeClass("disabled");a.data("toolTip")&&a.data("toolTip").removeWidget()})},showError:function(a){(a.element||this.element.find(".auth-tooltip-hook:visible")).toolTip({content:a.message,baseClass:"loginDlgError",position:"top",showImmediately:!0,activation:"click"})}})})(R9,jQuery);(function(a,c){a.createComponentClass("common.authentication.SocialSignInDialog",{options:{usingCustomCallback:!1},dialog:null,init:function(){this.dialog=this.getChildElement("dialog").dialog().getWidget()},addEventHandlers:function(){var b=this;this.subscribe(["fbauth.login.success","googleauth.login.success"],function(){b.options.usingCustomCallback?a.events.publish("authentication.success"):window.location.reload(!0)});this.subscribe("social.response.loaded",function(){b.dialog.close()});this.getChildElement("facebookLogin").click(function(){a.authentication.external.facebook.login()});
this.getChildElement("googleLogin").click(function(){a.authentication.external.google.login()});this.getChildElement("emailSignUp").click(function(){b.dialog.close();a.authentication.showSignup(b.options)});this.getChildElement("emailSignIn").click(function(){b.dialog.close();a.authentication.showLogin(b.options)})}})})(R9,jQuery);(function(a){a.createComponentClass("common.booking.AmomaKaptcha",{options:{serializedKey:"",kaptchaSessionId:""},inlineComponentsReady:function(){a.events.publish("bookit.extraBookingParam",{name:this.options.serializedKey,value:this.options.kaptchaSessionId})}})})(R9);(function(e,c){e.createComponentClass("common.booking.BookItPage",{options:{waitMilliseconds:null,requiredPixelURL:null,isFastAjaxRequest:!1,isAjaxInterstitialURL:!1,ajaxFallbackURL:null,iframeURL:null},timeoutAjaxFailedResponseID:null,iframeLinkTimeoutID:null,pixelTimeoutID:null,waitTimeoutID:null,displayShowID:null,displayTimerID:null,remainingWaitMS:0,init:function(){var a=this,b=parseInt(this.options.waitMilliseconds);!isNaN(b)&&0<b&&(this.waitTimeoutID=setTimeout(function(){a.waitTimeoutID=null;
a.displayShowID&&clearInterval(a.displayShowID);a.handleWaitTimeout()},b),2E3<b&&!this.options.isAjaxInterstitialURL?(this.remainingWaitMS=b,this.displayTimerID=setInterval(function(){var d;a.remainingWaitMS-=1E3;0<a.remainingWaitMS&&(d=Math.ceil(a.remainingWaitMS/1E3));d=0<d?d:0;c(a.element).find(".bookingWaitSeconds").text(d)},1E3)):c(a.element).find(".bookingWaitSeconds").hide());this.options.isFastAjaxRequest?c(a.element).find(".bookingDisplayContainer").show():!isNaN(b)&&(1E3<b||0>b)&&(this.displayShowID=
setTimeout(function(){c(a.element).find(".bookingDisplayContainer").show()},200));this.options.isAjaxInterstitialURL&&(c(this.element).find(".bookingSubmit").hide(),this.timeoutAjaxFailedResponseID=setTimeout(function(){a.timeoutAjaxFailedResponseID=null;a.failedRequest("/error/timeout/ajax/fallback","/error/timeout/ajax/nofallback")},28E3))},addEventHandlers:function(){var a=this,b=c(this.element).find(".requiredPixel"),d=c(this.element).find(".bookingIframe");c(this.element).find(".bookingSubmit").click(this.handleClickedSubmit.bind(this));
b.length&&this.options.requiredPixelURL&&(this.pixelTimeoutID=setTimeout(function(){a.pixelTimeoutID=null;e.Analytics.api.trackEvent("/error/timeout/reqpixel");a.checkAutoSubmitForm()},4E3),b.on("load",this.handleRequiredPixelDone.bind(this)).on("error",this.handleRequiredPixelDone.bind(this)).attr("src",this.options.requiredPixelURL));d.length&&this.options.iframeURL&&(this.iframeLinkTimeoutID=setTimeout(function(){a.iframeLinkTimeoutID=null;e.Analytics.api.trackEvent("/error/timeout/iframe");a.checkAutoSubmitForm()},
8E3),d.on("load",this.handleIframeLinkDone.bind(this)).on("error",this.handleIframeLinkDone.bind(this)).attr("src",this.options.iframeURL));e.events.subscribe("bookit.extraBookingParam",c.proxy(this.addExtraBookingParam,this))},addExtraBookingParam:function(a){var b=c(this.element).find(".bookForm"),d=b.attr("action"),d=d+"\x26"+a.name+"\x3d"+a.value;b.attr("action",d)},handleIframeLinkDone:function(){this.iframeLinkTimeoutID&&(clearTimeout(this.iframeLinkTimeoutID),this.iframeLinkTimeoutID=null);
this.checkAutoSubmitForm()},handleRequiredPixelDone:function(){this.pixelTimeoutID&&(clearTimeout(this.pixelTimeoutID),this.pixelTimeoutID=null);this.checkAutoSubmitForm()},handleWaitTimeout:function(){this.waitTimeoutID&&(clearTimeout(this.waitTimeoutID),this.waitTimeoutID=null);this.checkAutoSubmitForm()},handleClickedSubmit:function(){e.Analytics.api.trackEvent("/submit/link");this.pixelTimeoutID||this.iframeLinkTimeoutID||this.submitForm()},checkAutoSubmitForm:function(){this.waitTimeoutID||this.pixelTimeoutID||
this.iframeLinkTimeoutID||(this.options.isFastAjaxRequest?this.submitFastAjaxRequest():this.submitForm())},submitFastAjaxRequest:function(){if(!this.isFastAjaxSubmitted){this.isFastAjaxSubmitted=!0;var a=c(this.element).find(".bookForm"),b=a.serializeArray().reduce(function(a,b){a[b.name]=b.value;return a},{});e.action.execute("common/booking/BookItPage",b,function(b){b&&b.bookingURL||this.failedRequest("/error/fastajax/fallback","/error/fastajax/nofallback");if(b.requiredFormParams){a.empty();for(var c in b.requiredFormParams)b.requiredFormParams.hasOwnProperty(c)&&
a.append("\x3cinput type\x3d'hidden' name\x3d'"+c+"' value\x3d'"+b.requiredFormParams[c]+"' /\x3e");a.attr("method","POST").attr("action",b.bookingURL).submit()}else window.location.replace(b.bookingURL)})}},submitForm:function(){if(!this.isSubmitted){var a=c(this.element).find(".bookForm"),b=a.attr("method");this.isSubmitted=!0;b&&"GET"===b.toUpperCase()?window.location.replace(a.attr("action")):a.submit()}},failedRequest:function(a,b){this.options.ajaxFallbackURL?(e.Analytics.api.trackEvent(a),
window.location.replace(that.options.ajaxFallbackURL)):(e.Analytics.api.trackEvent(b),window.location.replace("/book/ajaxerror"))}})})(R9,jQuery);(function(b){b.createComponentClass("common.booking.ClickoutsPopup",{defaultSettings:{openLinksInPopup:!1,popupWidth:900,popupHeight:750,openInSamePopup:!1,popupName:"clickout_popup"},openPopup:function(a,c,b,d){if((a=a||this.defaultSettings)&&a.openLinksInPopup)return b.preventDefault(),window.open(c,a.openInSamePopup?a.popupName:d||c,"width\x3d"+(a.popupWidth||this.defaultSettings.popupWidth)+",height\x3d"+(a.popupHeight||this.defaultSettings.popupHeight))}})})(window.R9);(function(a,d){a.createComponentClass("common.booking.HorizontalMultibookProvidersList",{options:{analyticsTrackingEvent:null,resultId:"",foreignWarnTooltip:"",clickoutsPopupSettings:{},staticSignInEnabled:!1},searchIdExpirationCheckFailed:!1,init:function(){1<this.element.find(".improvedPreferredProvider").length&&this.element.addClass("showColumnDivider")},addEventHandlers:function(){var e=this,b=this;this.element.find("a.bookingLink").click(function(c){var f=d(c.currentTarget).data("splitProvider");
a.events.publish("multibook.providerClicked",{resultId:b.options.resultId},f);a.events.publish("provider.book.click",{resultId:b.options.resultId,providerName:d(c.currentTarget).data("name"),providerCode:d(c.currentTarget).data("code")});if(e.options.analyticsTrackingEvent){var g=d(c.currentTarget).data("payload");a.Analytics.api.trackEvent(e.options.analyticsTrackingEvent+(g?g:""))}if(e.searchIdExpirationCheckFailed)return a.Analytics.api.trackEvent("searchidexpired/multibooklink"),a.events.publish("results.expired"),
!1;b.clickoutsPopup().openPopup(b.options.clickoutsPopupSettings,c.currentTarget.href,c);if(f)return a.events.publish("multibook.splitProvider.click",{resultId:b.options.resultId,element:b.element}),!1});var h=this.element;this.element.find(".showMoreMultiBookOptions").click(function(){h.addClass("overflow-visible");a.events.publish("horizontal.multibook.showOverflow",{resultId:b.options.resultId});d(this).hide()});this.element.find(".foreignProvider").toolTip({content:this.options.foreignWarnTooltip,
position:"top",showImmediately:!1});this.getChildElement("privateRatesButton").click(function(){if(b.options.staticSignInEnabled){var c=d.extend({regurl:b.options.promoParams.promo,promoType:"private_rates"},b.options.promoParams);a.authentication.showDefault(c)}else a.config.getBoolean("ui.pushsocial.enabled",!1)?a.authentication.social.showSocialLogin():(c=d.extend({regurl:b.options.promoParams.promo},b.options.promoParams),a.authentication.showLogin(c))});this.subscribe("searchid.expiration.check.failed",
function(){b.searchIdExpirationCheckFailed=!0})},_clickoutsPopup:null,clickoutsPopup:function(){return this._clickoutsPopup?this._clickoutsPopup:a.common&&a.common.booking&&a.common.booking.ClickoutsPopup?this._clickoutsPopup=new a.common.booking.ClickoutsPopup:{openPopup:function(){}}}})})(R9,jQuery);(function(b,e){b.createComponentClass("common.booking.MultiBookDropdown",{templates:{multibookItem:"multibookDropdownItem",overflowLink:"multibookOverflowLink"},options:{resultId:"",overflowText:"",unrolledLabelText:"",rolledLabelText:"",maxVisibleProviders:4,showOverflow:!0,isWhiskyUnrolled:!1,bestProvider:null,loggingPrefix:"",promoParams:null,foreignWarnTooltip:"",hasPenaltyTooltip:"",clickoutsPopupSettings:{},staticSignInEnabled:!1,isPrivateUnrolled:!0,unrolledListClass:"",alignContent:"left"},
overflowProvidersCount:0,bestProvider:null,list:null,bestEl:null,searchIdExpirationCheckFailed:!1,init:function(){this.list=this.getChildElement("list");this.bestEl=this.getChildElement("best");this.dropdown=this.getChildElement("dropdown").getWidget();"undefined"!==typeof this.dropdown&&"left"===this.options.alignContent&&(this.dropdown.leftOffset=-this.bestEl.outerWidth())},addEventHandlers:function(){function c(d){if(a.bestProvider)if(a.searchIdExpirationCheckFailed)b.Analytics.api.trackEvent("searchidexpired/bestclick"),
b.events.publish("results.expired");else{!a.bestProvider.split&&b.events.publish("nps.show");var c="%s/multibook/buttonClicked%s".format(a.options.loggingPrefix,(a.bestProvider.priceInfo?"/"+a.bestProvider.priceInfo:"")+(a.options.payload?a.options.payload:""));b.Analytics.api.trackEvent(c);a.providerClicked(a.bestProvider.code,a.bestProvider.name,a.bestProvider.split);d=a.clickoutsPopup().openPopup(a.options.clickoutsPopupSettings,a.bestProvider.url,d);!d&&a.bestProvider.split&&(d=!0,b.events.publish("multibook.splitProvider.click",
{resultId:a.options.resultId,element:a.element}));d||window.open(a.bestProvider.url,a.bestProvider.target)}}var a=this;this.bestProvider=this.options.bestProvider;this.subscribe(this.getEvent("multibook.updateLinks"),function(b){b.providers&&(a.overflowProvidersCount=b.providers.length-a.options.maxVisibleProviders+1,a.renderDropdown(b.providers))});a.list.find(".bookingLink \x3e a").click(this.linkClicked.bind(this));this.handleBestClick=c;this.bestEl.off("click",c).on("click",c);this.getChildElement("overflow").click(this.overflowClicked.bind(this));
this.getChildElement("privateRatesButton").click(function(){if(a.options.staticSignInEnabled){var c=e.extend({regurl:a.options.promoParams.promo,promoType:"private_rates"},a.options.promoParams);b.authentication.showDefault(c)}else b.config.getBoolean("ui.pushsocial.enabled",!1)?b.authentication.social.showSocialLogin():(c=e.extend({regurl:a.options.promoParams.promo},a.options.promoParams),b.authentication.showLogin(c));a.closeDropdown()});this.element.find(".foreignProvider").toolTip({content:this.options.foreignWarnTooltip,
position:"right",showImmediately:!1});a.list.find(".bookingLink.hasPenalty").toolTip({content:this.options.hasPenaltyTooltip,position:"right",showImmediately:!1});this.subscribe(this.getEvent("multibook.reset"),function(){a.list.html("");a.element.removeClass("ShowDropdown").removeClass("Show")});this.subscribe("DropdownDialog.open",{id:a.id("dropdown")},function(){b.Analytics.api.trackEvent(a.options.loggingPrefix+"/multibook/open");setTimeout(function(){e(".Common-Widgets-DropdownDialog-Content").find(".bookingLink.multibookDropTemplateItem a").off("click").on("click",
function(){a.linkClicked.call(a)})},100)});this.subscribe("DropdownDialog.close",{id:a.id("dropdown"),silent:!1},function(){b.Analytics.api.trackEvent(a.options.loggingPrefix+"/multibook/close")});this.subscribe("searchid.expiration.check.failed",function(){a.searchIdExpirationCheckFailed=!0})},destroy:function(){this.base();this.list.empty();this.bestEl.off("click")},renderDropdown:function(c){var a=this;1<c.length&&a.element.addClass("ShowDropdown");0<c.length&&(a.element.removeClass("Empty").addClass("Show"),
a.bestProvider=c[0]);var d=e("\x3cul\x3e"),f=e("\x3cul class\x3d'providerList "+a.options.unrolledListClass+"'\x3e"),g=e("\x3cul class\x3d'providerList externalProviders'\x3e"),h=g;e.each(c,function(c,d){h=d.isWhisky&&a.options.isWhiskyUnrolled||d["private"]&&a.options.isPrivateUnrolled?f:g;d=b.template.renderElement(a.templates.multibookItem,d);c+1>=a.options.maxVisibleProviders&&h===g&&d.addClass("overflow");h.append(d)});0<f.children().length?[{labelText:this.options.unrolledLabelText,items:f},
{labelText:this.options.rolledLabelText,items:g}].forEach(function(a){a.items.prepend('\x3cli class\x3d"bookingLabel"\x3e'+a.labelText+"\x3c/li\x3e");a=e('\x3cli class\x3d"providerSection"\x3e').append(a.items);d.append(a)}):d=g;c.length>a.options.maxVisibleProviders&&(c=b.template.renderElement(a.templates.overflowLink,{text:a.options.overflowText.format(a.overflowProvidersCount)}),d.append(c));a.list.html(d.html());a.list.find(".bookingLink \x3e a").click(function(b){a.linkClicked.call(a,b)});this.getChildElement("overflow").on("click",
this.overflowClicked.bind(this))},overflowClicked:function(){b.events.publish("multibook.overflowLink.clicked");this.options.showOverflow?this.list.addClass("showOverflow"):this.closeDropdown()},linkClicked:function(c){var a=e(c.currentTarget),d="true"===a.attr("data-split-provider");!d&&b.events.publish("nps.show");this.providerClicked(a.data("code"),e(c.currentTarget).data("name"),d);var f=a.data("price"),a=a.data("payload"),f="%s/multibook/linkClicked%s".format(this.options.loggingPrefix,(f?"/"+
f:"")+(a?a:""));b.Analytics.api.trackEvent(f);this.closeDropdown();if(this.searchIdExpirationCheckFailed)return b.Analytics.api.trackEvent("searchidexpired/multibooklink"),b.events.publish("results.expired"),!1;this.clickoutsPopup().openPopup(this.options.clickoutsPopupSettings,c.currentTarget.href,c);if(d)return b.events.publish("multibook.splitProvider.click",{resultId:this.options.resultId,element:this.element}),!1},getEvent:function(b){return b+(this.options.resultId?"."+this.options.resultId:
"")},closeDropdown:function(){this.dropdown.close()},_clickoutsPopup:null,clickoutsPopup:function(){return this._clickoutsPopup?this._clickoutsPopup:b.common&&b.common.booking&&b.common.booking.ClickoutsPopup?this._clickoutsPopup=new b.common.booking.ClickoutsPopup:{openPopup:function(){}}},providerClicked:function(c,a,d){b.events.publish("multibook.providerClicked",{resultId:this.options.resultId,afterclickIgnore:d});b.events.publish("provider.book.click",{resultId:this.options.resultId,providerName:a,
providerCode:c})}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.booking.SearchIdExpirationChecker",{options:{},searchId:null,searchIdLikelyValid:!0,checkTimer:null,init:function(){this.options.searchId&&(this.searchId=this.options.searchId)},addEventHandlers:function(){var a=this;b.events.subscribe("resultspage.streaming.done",this.searchEnded.bind(this));b.events.subscribe("resultspage.refreshed",this.searchEndedWait.bind(this));b.events.subscribe(["search.startSearch","resultspage.searchId.changed","search.expired",
"results.expired"],this.clearCheckTimer.bind(this));d("a.bookingLink").click(function(){return a.interceptClick()})},interceptClick:function(){if(this.searchIdLikelyValid)return!0;b.Analytics.api.trackEvent("searchidexpired/booklink");b.events.publish("results.expired");return!1},clearCheckTimer:function(){this.checkTimer&&(clearTimeout(this.checkTimer),this.checkTimer=null)},searchEndedWait:function(a){var b=this;setTimeout(function(){b.searchEnded(a)},100)},searchEnded:function(a){this.clearCheckTimer();
a&&a.searchId?(this.searchId=a.searchId,this.searchIdLikelyValid=!0,this.startCheckTimer()):a&&"streaming"in a&&!a.streaming?this.startCheckTimer():this.searchId=null},startCheckTimer:function(){if(!this.checkTimer){var a=this;this.checkTimer=setTimeout(function(){a.validateFromServer();a.checkTimer=null},this.options.checkTimeout)}},validateFromServer:function(){if(this.searchId){var a=this;d.ajax({type:"POST",url:"/s/horizon/common/booking/SearchIdValidationAction",headers:{"X-CSRF":b.globals.formtoken},
data:{searchId:this.searchId},success:function(c){c&&(a.searchIdLikelyValid=!c.isExpired,c.isExpired&&b.events.publish("searchid.expiration.check.failed"))}})}}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.booking.VXValidatePNR",{inlineComponentsReady:function(){input.parse_i("validatePNR");var c={name:"validatePNR",value:b("#validatePNR").val()};a.events.publish("bookit.extraBookingParam",c)}})})(R9,jQuery);(function(d,e){d.createComponentClass("common.booking.VerticalMultibookProvidersList",{templates:{multibookItem:"multibookDropdownItem",overflowLink:"multibookOverflowLink"},options:{loggingPrefix:"",promoParams:null,featuredProvider:null,analyticsTrackingEvent:null,resultId:"",foreignWarnTooltip:"",clickoutsPopupSettings:{},staticSignInEnabled:!1,showMultibookOverflow:!0},overflowProvidersCount:0,featuredProvider:null,list:null,init:function(){this.list=this.getChildElement("list");this.featuredProvider=
this.options.featuredProvider;this.multibookOverflow=this.getChildElement("overflow")},addEventHandlers:function(){var b=this,a=this;this.subscribe(this.getEvent("multibook.updateLinks"),function(c){c.providers&&(a.overflowProvidersCount=c.providers.length-a.options.maxVisibleProviders+1,a.renderDropdown(c.providers))});this.element.find(".bookingLink").click(function(c){d.events.publish("multibook.providerClicked",{resultId:a.options.resultId});d.events.publish("provider.book.click",{resultId:a.options.resultId,
providerName:e(c.currentTarget).data("name"),providerCode:e(c.currentTarget).data("code")});b.options.analyticsTrackingEvent&&d.Analytics.api.trackEvent(b.options.analyticsTrackingEvent);a.clickoutsPopup().openPopup(a.options.clickoutsPopupSettings,c.currentTarget.href,c)});this.element.find(".foreignProvider").toolTip({content:this.options.foreignWarnTooltip,position:"top",showImmediately:!1});this.getChildElement("inlinePrivateRatesButton").click(function(){if(a.options.staticSignInEnabled){var c=
e.extend({regurl:a.options.promoParams.promo,promoType:"private_rates"},a.options.promoParams);d.authentication.showDefault(c)}else d.config.getBoolean("ui.pushsocial.enabled",!1)?d.authentication.social.showSocialLogin():(c=e.extend({regurl:a.options.promoParams.promo},a.options.promoParams),d.authentication.showLogin(c))});this.multibookOverflow.click(this.overflowClicked.bind(this));this.element.find(".foreignProvider").toolTip({content:this.options.foreignWarnTooltip,position:"right",showImmediately:!1});
a.list.find(".bookingLink.hasPenalty").toolTip({content:this.options.hasPenaltyTooltip,position:"right",showImmediately:!1});this.subscribe(this.getEvent("multibook.reset"),function(){a.list.html("");a.element.removeClass("ShowDropdown").removeClass("Show")});this.subscribe("DropdownDialog.open",{id:a.id("dropdown")},function(){d.Analytics.api.trackEvent(a.options.loggingPrefix+"/multibook/open");setTimeout(function(){e(".Common-Widgets-DropdownDialog-Content").find(".bookingLink.multibookDropTemplateItem a").off("click").on("click",
function(){a.linkClicked.call(a)})},100)});this.subscribe("DropdownDialog.close",{id:a.id("dropdown")},function(){d.Analytics.api.trackEvent(a.options.loggingPrefix+"/multibook/close")})},destroy:function(){this.list.empty()},renderDropdown:function(b){var a=this;1<b.length&&a.element.addClass("ShowDropdown");0<b.length&&(a.element.removeClass("Empty").addClass("Show"),a.bestProvider=b[0]);var c=e("\x3cul\x3e"),g=e("\x3cul class\x3d'providerList "+a.options.unrolledListClass+"'\x3e"),f=e("\x3cul class\x3d'providerList externalProviders'\x3e"),
h=f;e.each(b,function(c,b){h=b.isWhisky&&a.options.isWhiskyUnrolled||b["private"]&&a.options.isPrivateUnrolled?g:f;b=d.template.renderElement(a.templates.multibookItem,b);c+1>=a.options.maxVisibleProviders&&h===f&&b.addClass("overflow");h.append(b)});0<g.children().length?[{labelText:this.options.unrolledLabelText,items:g},{labelText:this.options.rolledLabelText,items:f}].forEach(function(a){a.items.prepend('\x3cli class\x3d"bookingLabel"\x3e'+a.labelText+"\x3c/li\x3e");a=e('\x3cli class\x3d"providerSection"\x3e').append(a.items);
c.append(a)}):c=f;b.length>a.options.maxVisibleProviders&&(b=d.template.renderElement(a.templates.overflowLink,{text:a.options.overflowText.format(a.overflowProvidersCount)}),c.append(b));a.list.html(c.html());a.list.find(".bookingLink \x3e a").click(function(b){a.linkClicked.call(a,b)});this.multibookOverflow.on("click",this.overflowClicked.bind(this))},overflowClicked:function(){d.events.publish("multibook.overflowLink.clicked");this.options.showMultibookOverflow?this.list.addClass("showOverflow"):
this.closeDropdown()},linkClicked:function(b){var a=e(b.currentTarget),c="true"===a.attr("data-split-provider");this.providerClicked(a.data("code"),e(b.currentTarget).data("name"),c);a=a.data("price");a="%s/multibook/linkClicked%s".format(this.options.loggingPrefix,a?"/"+a:"");d.Analytics.api.trackEvent(a);this.closeDropdown();this.clickoutsPopup().openPopup(this.options.clickoutsPopupSettings,b.currentTarget.href,b);if(c)return d.events.publish("multibook.splitProvider.click",{resultId:this.options.resultId,
element:this.element}),!1},getEvent:function(b){return b+(this.options.resultId?"."+this.options.resultId:"")},closeDropdown:function(){this.getChildElement("dropdown").getWidget().close()},_clickoutsPopup:null,clickoutsPopup:function(){return this._clickoutsPopup?this._clickoutsPopup:d.common&&d.common.booking&&d.common.booking.ClickoutsPopup?this._clickoutsPopup=new d.common.booking.ClickoutsPopup:{openPopup:function(){}}}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.compareTo.Core.Items",{options:{navigateToResults:!1,pageOrigin:"",keepCheckboxState:!0,radioButtons:!1,showCheckAllWhenItemsCount:3,workaround:"Core",template:{none:void 0,checked:void 0,unChecked:void 0}},items:null,init:function(){this.options.radioButtons&&(this.options.template.none=this.options.template.none||d("#"+this.id("none")).get(0).text);this.items=new c.CompareTo.Core.Items(this.element,this.options);var b=d(".smartMoveLabel",this.element);
if(null!=b&&0<b.length)d(".smartMoveLabel",this.element).on("click",function(){d(".control.check-all",this.element).click()})},shouldUpdate:function(b){return-1<this.id().indexOf(b.id)},addEventHandlers:function(){var b=this;c.events.subscribe("cmp2.getItems",function(a){b.shouldUpdate(a)&&(a._cmp2id=b.items.id(),b.items.event.publish("cmp2.getItems",[a]))});c.events.subscribe("cmp2.cleanUp",function(a){b.shouldUpdate(a)&&(a._cmp2id=b.items.id(),b.items.event.publish("cmp2.cleanUp",[a]))});c.events.subscribe("cmp2.submit",
function(a){b.shouldUpdate(a)&&(a._cmp2id=b.items.id(),b.items.event.publish("cmp2.submit",[a]))});c.events.subscribe("cmp2.update.component.options",function(a){if(a||a.navigateToResults)b.options.navigateToResults=a.navigateToResults;if(a||a.pageOrigin)b.options.pageOrigin=a.pageOrigin,b.items&&b.items.updatePageOrigin(a.pageOrigin)});b.items.on("cmp2.shown",function(a){c.events.publish("cmp2.shown",a)});b.items.on("cmp2.hidden",function(a){c.events.publish("cmp2.hidden",a)});b.items.on("form.submit",
function(a){b.shouldUpdate(a)&&(delete a._cmp2id,b.options.navigateToResults?window.location.href="/"+a.url:c.events.publish("searchform.submit",a))});b.items.on("cmp2.rendering.finished",function(a){b.items.id()===a._cmp2id&&(delete a._cmp2id,a.id=b.id(),c.events.publish("cmp2.rendering.finished",a))});b.items.on("cmp2.event.change",function(a){c.events.publish("cmp2.event.change",a)})}})})(window.R9,window.jQuery);(function(c,f){c.createComponentClass("common.compareTo.Core.ResultPage",{options:{workaround:"Core",compareTos:[]},init:function(){var b;b=c.events.subscribe("resultspage.cmp2.changed",function(a){a&&d!==a.searchId&&(b&&c.events.unsubscribe("resultspage.cmp2.changed",b),d=a.searchId,c.ajax.execute("common/compareTo/Core/ResultPage",{data:{searchId:d}}))});var a=this.options,d=a.searchId,e=new c.CompareTo.Core.ResultPage(a);this.isPropertySet(a.compareTos)?e.open({compareTos:a.compareTos}):this.isPropertySet(d)&&
e.ajaxOpen({searchId:a.searchId})},isPropertySet:function(b){return null!==b&&"undefined"!==typeof b&&0<b.length}})})(window.R9,window.jQuery);(function(a){a.createComponentClass("common.compareTo.features.price.RightRailCompareTo","common.compareTo.RightRailCompareTo",{addEventHandlers:function(){this.base();var a=this;this.subscribe("resultspage.refreshed",function(){a.update({fetchPrice:!0})})}})})(R9);(function(c,d){c.createComponentClass("common.compareTo.InlineCompareTo",{options:{searchId:null,items:[],providerNames:void 0},addEventHandlers:function(){this.searchIdChangeHandler();var a=this;d(this.elementNode).find(".providerItemWrapper").bind("click",function(b){b=d(b.currentTarget);b.hasClass("providerAll")?a.options.providerNames.each(function(a){c.events.publish("gtm.update",{event:"compareTo",providerName:a})}):c.events.publish("gtm.update",{event:"compareTo",providerName:b.data("providername")})})},
searchIdChangeHandler:function(){var a=this;this.searchIdChangedCallback=c.events.subscribe("resultspage.searchId.changed",function(b){var d=a.options.searchId;b&&d!==b.searchId&&(a.searchIdChangedCallback&&c.events.unsubscribe("resultspage.searchId.changed",a.searchIdChangedCallback),a.options.searchId=b.searchId,a.element.html(""),c.ajax.execute("common.compareTo.InlineCompareTo",{data:{searchId:a.options.searchId},appendTo:a.element,replace:!0}))})}})})(R9,jQuery);(function(d,b){var e=navigator.userAgent.match(/MSIE |Trident/);d.createComponentClass("common.compareTo.ProgressBarCmp2",{compareToElement:void 0,innerWrapper:void 0,showFunction:function(){this.innerWrapper.show()},hideFunction:function(){this.innerWrapper.hide()},options:{cmp2Id:void 0,animateToggle:!1,defaultChecked:!1,componentId:void 0},init:function(){e&&this.element.addClass("ie");this.innerWrapper=this.element.find(".extendCmp2");this.compareToElement=b(".Common-CompareTo-Core-Items",this.element);
this.options.animateToggle&&(this.showFunction=function(){this.innerWrapper.slideDown(50)},this.hideFunction=function(){this.innerWrapper.slideUp(50)})},addEventHandlers:function(){this.cmp2LoadListener();this.cmp2ClickListener();this.selectAllCmp2Listener();this.selectNoneCmp2Listener();this.cmp2VisibilityListener()},cmp2LoadListener:function(){var a=this;d.events.subscribe("cmp2.rendering.finished",function(b){b.id===a.options.cmp2Id&&a.updateExtendMessage()})},cmp2ClickListener:function(){var a=
this;b(".items",this.element).on("click",".span-button-wrapper",function(){setTimeout(function(){a.updateExtendMessage()},50)})},cmp2VisibilityListener:function(){var a=this,c;d.events.subscribe("cmp2.shown",function(){clearTimeout(c);c=setTimeout(function(){b(a.compareToElement).hasClass("compareToHidden")||(a.showFunction(),a.updateExtendMessage())},100)});d.events.subscribe("cmp2.hidden",function(){clearTimeout(c);c=setTimeout(function(){b(a.compareToElement).hasClass("compareToHidden")&&a.hideFunction()},
100)})},selectAllCmp2Listener:function(){var a=this;b(".selectAllCmp2",this.element).on("click",function(c){b(c.currentTarget).hasClass("disabled")||(d.Analytics.api.trackEvent("smartsearch/cmp2/selectall"),b(".items .input",a.compareToElement).each(function(){b(this).hasClass("checked")||b(this).trigger("click")}),a.updateExtendMessage())})},selectNoneCmp2Listener:function(){var a=this;b(".selectNoneCmp2",this.element).on("click",function(){d.Analytics.api.trackEvent("smartsearch/cmp2/selectnone");
b(".items .input",a.compareToElement).each(function(){b(this).hasClass("checked")&&b(this).trigger("click")});a.updateExtendMessage()})},updateExtendMessage:function(){var a=b(".items .input",this.compareToElement),c=a.filter(".checked"),a=Math.floor((this.options.defaultChecked?c.length+1:c.length)/(this.options.defaultChecked?a.length+1:a.length)*100);b(".extendPercent",this.element).html(a);b(".statusBarInner",this.element).css("width",a+"%");100===a?(d.events.publish("smartcmp2.select.all",{componentId:this.options.componentId}),
b(".statusBarInner",this.element).addClass("hundred")):(d.events.publish("smartcmp2.show",{componentId:this.options.componentId}),b(".statusBarInner",this.element).removeClass("hundred"))}})})(R9,jQuery);(function(d,c){d.createComponentClass("common.compareTo.RightRailCompareTo",{options:{pageOrigin:null,searchId:null,items:[],workaround:"Core"},updatePromise:null,addEventHandlers:function(){var b=this;this.subscribe("resultspage.searchId.changed",function(a){var c=b.options.searchId;a&&c!==a.searchId&&(b.destroy(),b.options.searchId=a.searchId,b.element.html(""),b.update())});c(this.elementNode).find(".provideritem").bind("click",function(a){d.events.publish("gtm.update",{event:"compareTo",providerName:c(a.currentTarget).data("providername")})});
(function(a,b){return new d.CompareTo.Core.RightRails(c.extend({},{selector:c(a)},b))})("#"+this.id("compareToCompareAllButton"),this.options)},update:function(b){var a=this;null!==a.updatePromise&&a.updatePromise.abort();a.updatePromise=d.ajax.execute("common/compareTo/RightRailCompareTo",{data:c.extend(!0,{},{pageOrigin:this.options.pageOrigin,searchId:this.options.searchId},b||{}),replace:!0,customUpdate:function(b,c){a.destroy();a.element.replaceWith(c)}})}})})(R9,jQuery);(function(a){a.createComponentClass("common.compareTo.SmarterAds",{options:{formId:"",vertical:"",pageOrigin:"",navigateToResults:!1},init:function(){var c=this;a.events.subscribe("cmp2.submit",function(b){c.shouldUpdate(b)&&(c.options.navigateToResults?window.location.href="/"+b.url:a.events.publish("searchform.submit",b))});this.options.id=this._id;new a.CompareTo.SmarterTravelMedia.SmarterAds(this.options)},shouldUpdate:function(a){return-1<this.id().indexOf(a.id)}})})(window.R9);(function(e,d){e.createComponentClass("common.core.FastlyTiming",{options:{runTest:!1,measurementUrl:"/fastly-timer",logUrl:"/s/run/fastlytimerlog"},init:function(){this.options.runTest&&this.runTimingRequest()},runTimingRequest:function(){d.ajax({type:"POST",url:this.options.measurementUrl,success:this.logResult.bind(this)})},logResult:function(c,a,b){b&&c&&c.cluster&&(a=b.getResponseHeader("x-served-by"),b=b.getResponseHeader("x-timer"),a&&b&&(a=a.split(" "),a=a[a.length-1].split("-"),d.ajax({type:"POST",
url:this.options.logUrl,data:{cluster:c.cluster,timer:b,fastlyNode:a[a.length-1]}})))}})})(R9,jQuery);(function(c){c.createComponentClass("common.core.RealUserMeasurementsComponent",{options:{fullstoryEnabled:!1},trackedSubmit:!1,addEventHandlers:function(){this.base();this.subscribe("searchform.submit",this.onSearchSubmit.bind(this))},onSearchSubmit:function(a){if(!this.trackedSubmit&&this.options.fullstoryEnabled&&window&&"FS"in window&&a&&a.vertical){this.trackedSubmit=!0;a="did"+this.fixCase(a.vertical)+"Search_bool";var b={};b[a]=!0;FS.setUserVars(b)}},fixCase:function(a){return a.toLowerCase().replace(/(^| )(\w)/g,
function(a){return a.toUpperCase()})}})})(R9);(function(a,b){a.createComponentClass("common.corporate.Menu",{menu:null,init:function(){this.menu=this.getChildElement("menu")},addEventHandlers:function(){var a=this;b(".leftMenuCover").bind("click",function(){a.menu.toggleClass("menuOpen")})}})})(R9,jQuery);(function(a){a.createComponentClass("common.crosssell.dmo.DMOCrossSellBanner","common.crosssell.dmo.DMOCrossSellBase",{analyticsPrefix:"dmo/cross_sell/banner/"})})(R9);(function(b){b.createComponentClass("common.crosssell.dmo.DMOCrossSellBase",{analyticsPrefix:"dmo/cross_sell/",analyticsLabel:"",options:{campaignCode:"",componentPosition:"",componentType:""},init:function(){this.setAnalyticsLabel()},addEventHandlers:function(){var a=this;this.element.click(function(){b.Analytics.api.trackEvent(a.analyticsLabel)});this.subscribe(["search.startSearch","search.searchFailed"],this.hide.bind(this));this.subscribe("resultspage.streaming.firstPhase.done",this.show.bind(this))},
hide:function(){this.element.addClass("hidden")},show:function(){this.element.removeClass("hidden")},setAnalyticsLabel:function(){this.analyticsLabel=this.analyticsPrefix;this.addToAnalyticsLabel(this.options.dmoTargetCode);this.addToAnalyticsLabel(this.options.componentType);this.addToAnalyticsLabel(this.options.componentPosition);this.analyticsLabel+="/clicked"},addToAnalyticsLabel:function(a){a&&(this.analyticsLabel+=a,this.analyticsLabel+="/")}})})(R9);(function(c){c.createComponentClass("common.crosssell.dmo.DMOCrossSellRailItem","common.crosssell.dmo.DMOCrossSellBase",{analyticsPrefix:"dmo/cross_sell/rail_promo/",ajaxPath:"common/crosssell/dmo/DMOCrossSellRailItem",options:{searchId:""},addEventHandlers:function(){this.base();this.subscribe("resultspage.searchId.changed",this.updateComponent.bind(this))},updateComponent:function(a){a&&a.searchId?a.searchId!==this.options.searchId?this.ajaxSelf(a):this.show():this.hide()},ajaxSelf:function(a){var b=
this;b.options.searchId=a.searchId;b.element&&b.element.length&&c.ajax.execute(this.ajaxPath,{data:{searchId:a.searchId},replace:!0,customUpdate:function(a,c){b.destroy();b.element.replaceWith(c)}})}})})(R9);(function(b,a){b.createComponentClass("common.currency.CurrencyMessage",{options:{displayLater:!1,displayImmediately:!1,cookieName:"hideCurrencyMessage"},isVisible:!1,closeBtn:void 0,init:function(b){this.closeBtn=a("#"+this.id("close"));this.options.displayImmediately?this.showMessage():this.options.displayLater&&(this.subscribe("resultspage.view.setvisible",a.proxy(this.showMessage,this)),this.subscribe("header.view.set",{view:"results"},a.proxy(this.showMessage,this)),this.subscribe("pageContainers.changed",
{state:"results"},a.proxy(this.showMessage,this)),this.subscribe("resultspage.routed",a.proxy(this.showMessage,this)))},addEventHandlers:function(){this.closeBtn.bind("click",a.proxy(this.close,this))},showMessage:function(){this.isVisible||(this.element.slideDown("slow"),window.setMetaCookie(this.options.cookieName,!0),this.isVisible=!0)},close:function(){this.element.slideUp("slow")}})})(window.R9,window.jQuery);(function(d,b){d.createComponentClass("common.destinationtiles.ajax.Tile",{useRetina:void 0,options:{isMobile:!0,suppressRetina:void 0},init:function(){this.useRetina=1<window.devicePixelRatio&&!this.options.suppressRetina;this.initTilePhoto()},initTilePhoto:function(){var c=this,a=this.element.find(".tilePhoto").first();this.options.isMobile?(a.attr("src",this.useRetina?a.data("retina"):a.data("original")),a.on("load",function(){a.closest(".tile").css("background-image","url("+a.attr("src")+")");
b("#"+c.id()).find(".content").addClass("loaded")})):(this.useRetina&&a.data("original",a.data("retina")),b(this.element).lazyLoad({skip_invisible:!0,threshold:150,load:function(){a.closest(".tile").css("background-image","url("+a.attr("src")+")");b("#"+c.id()).find(".content").addClass("loaded")}}))}})})(R9,jQuery);(function(f,d){f.createComponentClass("common.destinationtiles.BaseDestinationWrapper",{spinner:void 0,tileWrapper:void 0,tiles:void 0,loaderClass:".destinationsLoader",tilesWrapperClass:".tilesWrapper",dropdownWidget:void 0,options:{tileClass:void 0,tileComponentClass:void 0,type:void 0,ctid:void 0,destinationComponentUrl:void 0,vertical:void 0,hideTaglines:void 0,validTypes:void 0},init:function(a){var b=this;this.spinner=jq(this.loaderClass);this.initDropdown();d(window).on("load",function(){var a=
jq.grep(b.options.validTypes,function(a){return a!==b.options.type});jq.each(a,function(a,c){b.loadDestinationTilesForType(c)})})},inlineComponentsReady:function(){this._reveal(this.element);this.tileWrapper=jq(this.tilesWrapperClass);this.tiles=d(this.options.tileClass,this.tileWrapper);this.refreshDropdown(this.options.type)},_reveal:function(a,b){a.animate({opacity:1},b?b:0);a.removeClass("notLoaded")},reload:function(a,b){var c=this;this.spinner.hide();f.events.unsubscribe("destinationtiles."+
b+".loaded");b=jq(".cachedTiles ."+b);var e=jq(".cachedTiles ."+a);b.append(this.tileWrapper.children(":first"));0<b.children().length&&b.removeClass("empty").addClass("loaded");this.tileWrapper.empty().addClass("notLoaded");e.hasClass("loaded")?(this.tileWrapper.addClass("notLoaded"),this.tileWrapper.append(e.children(":first")),this.tiles=d(this.options.tileClass,this.tileWrapper),e.empty(),this._reveal(this.tileWrapper)):(this.spinner.show(),f.events.subscribe("destinationTiles."+a+".loaded",function(){c.tileWrapper.append(e.children(":first"));
c.tiles=d(this.options.tileComponentClass,c.tileWrapper);e.empty();c.spinner.hide();c._reveal(c.tileWrapper);d(window).scroll()}))},initDropdown:function(){var a=this;this.dropdownWidget=jq("#"+this.id("destinations")).dropdown({change:function(b){a.reloadComponent(b,this.getValue())}}).getWidget()},loaddestinationtilesForType:function(a){},reloadComponent:function(){},refreshDropdown:function(a){this.dropdownWidget&&this.dropdownWidget.setValue(a)}})})(R9,jQuery);(function(f,b){f.createComponentClass("common.destinationtiles.DestinationGridWrapper","common.destinationtiles.BaseDestinationWrapper",{tileWrapperSelector:".tilesWrapper",options:{activeDestinationClass:"activeDestination"},init:function(){this.base()},inlineComponentsReady:function(){this.base();this.highlightSectionListener()},addEventHandlers:function(a){b(".destinationTitle").on("click",b.proxy(this.reloadComponent,this))},highlightSectionListener:function(){var a=this,c=b(this.tileWrapperSelector).offset().top,
d=c-17;b(window).on("scroll",function(b,a){var c;return function(){var d=this,e=arguments;clearTimeout(c);c=setTimeout(function(){a.apply(d,e)},b)}}(10,function(){a.highlightContent(d,c,10)}))},highlightContent:function(a,c,d){var f=this,h=function(a){b(a).hasClass("highlight")||(f.tiles.removeClass("highlight"),b(a).addClass("highlight"))},e=b(window).scrollTop()+b(window).height()/2;if(this.showTilesInSequence()&&e>a&&e<a+b(this.tileWrapperSelector).height()){d=b(this.tileWrapperSelector).find("div.tile:first-child").first().height()+
d;for(var g=0;g<this.tiles.length;g++)if(e<a+d*(g+1)){h(this.tiles[g]);break}}else if(e>c+13&&e<c+2668){var k=[0,1,4,2,3,5,6,7,8,9,10,11,12,13,14];b.each([413,613,818,983,1148,1300,1452,1604,1756,1908,2060,2212,2364,2516,2668],function(a,b){a=f.tiles[k[a]];if(e<c+b&&a)return h(a),!1})}else this.tiles.removeClass("highlight")},showTilesInSequence:function(){},loadDestinationTilesForType:function(a){},reloadComponent:function(a,c){c?a=b("[data-action\x3d'"+c+"']"):(a=b(a.target),c=a.data("action"),
this.refreshDropdown(c));if(!a.hasClass(this.options.activeDestinationClass)){var d=b("."+this.options.activeDestinationClass);this.reload(c,d.data("action"));d.removeClass(this.options.activeDestinationClass);a.addClass(this.options.activeDestinationClass)}b(window).scroll();f.Analytics.api.trackEvent("destinationTiles/changeTabs/"+c)}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.errors.ErrorDialog",{dialog:null,dialogEl:null,title:null,messages:null,init:function(){this.dialogEl=this.getChildElement("dialog");this.dialog=this.dialogEl.dialog({}).getWidget();this.title=this.getChildElement("title");this.messages=this.getChildElement("messages")},addEventHandlers:function(){var a=this;this.subscribe("error.alert",this.show.bind(this));this.subscribe("error.dismiss",this.hide.bind(this));this.getChildElement("close").click(function(){a.dialog.close()})},
show:function(a){var b=this;a.title?(this.title.html(a.title),this.dialogEl.addClass("hasTitle")):(this.title.html(""),this.dialogEl.removeClass("hasTitle"));this.messages.html("");a.messages&&(c.isArray(a.messages)||(a.messages=[a.messages]),c.each(a.messages,function(a,d){a=c("\x3cli\x3e").html(d);b.messages.append(a)}));this.dialog.open()},hide:function(){this.dialog.close()}})})(R9,jQuery);(function(e,d){e.createComponentClass("common.frontdoor.ChallengerCoverPhoto",{imageIdentifier:void 0,locationChangeEvent:void 0,formId:void 0,options:{imageUrl:void 0,vertical:void 0,changeOnDestinationInput:!0,height:void 0,width:void 0},init:function(){d.proxy(this.loadImage,this,this.options.imageUrl,this.options.imageUrl)()},addEventHandlers:function(){var b=this;this.subscribe("frontdoor.coverphoto.change",function(a){b.imageIdentifier||setTimeout(function(){d.proxy(b.handleLocationChange,b,
a)()},7500)});this.options.changeOnDestinationInput&&("hotels"===this.options.vertical?this.addHotelEventHandler():"packages"===this.options.vertical?this.addPackageEventHandler():"cars"===this.options.vertical?this.addCarEventHandler():"flighttracker"===this.options.vertical?this.addFlightTrackerEventHandler():this.addFlightEventHandler())},addFlightEventHandler:function(){var b=this;this.subscribe([this.options.vertical+".search.rtow.form.destination",this.options.vertical+".search.multi.form.destination"],
function(a){if(!a.formtoken&&a.destinationCode){var c;-1<a.destinationCode.indexOf("/")?(c=a.destinationCode.split("/"),a.cityId=c[1]||""):-1<a.destinationCode.indexOf("-")?(c=a.destinationCode.split("-"),-1<c[1].indexOf(":")?(c=c[1].split(":"),a.countryId=c[1]||""):a.cityId=c[1]||""):(c=a.destinationCode.length,"fr"===a.destinationCode.substr(c-2,c)?a.freeRegionId=a.destinationCode.substr(0,c-2)||"":a.regionId=a.destinationCode.substr(0,c-1)||"");d.proxy(b.handleLocationChange,b,a)()}})},addCarEventHandler:function(){var b=
this;this.subscribe("cars.frontdoor.form.locations",function(a){if(!d(".formType.active").data("oneway")||a.dropoffLocation)a.cityId=a.dropoffCityId||a.pickupCityId,d.proxy(b.handleLocationChange,b,a)()})},addHotelEventHandler:function(){var b=this;this.subscribe("hotels.frontdoor.form.location",function(a){d.proxy(b.handleLocationChange,b,a)()})},addPackageEventHandler:function(){var b=this;this.subscribe("packages.frontdoor.form.destinationLocation",function(a){if(a.locationId){var c=a.locationId.substr(1);
a.locationId.startsWith("Z")?a.cityId=c:a.locationId.startsWith("X")?a.regionId=c:a.locationId.startsWith("Y")?a.freeRegionId=c:a.locationId.startsWith("U")?a.countryId=c:a.locationId.startsWith("L")?a.landmarkId=c:a.locationId.startsWith("H")?a.hotelId=c:a.locationId.startsWith("A")&&(a.airportCode=c)}d.proxy(b.handleLocationChange,b,a)()})},addFlightTrackerEventHandler:function(){var b=this;this.subscribe("flighttracker.frontdoor.form.location",function(a){!a.cityId&&a.destinationCode&&-1<a.destinationCode.indexOf("/")&&
(a.cityId=a.destinationCode.split("/")[1]||void 0);a.cityId&&0!==d(b.element).has("#"+a.id).length&&(b.formId=a.id,d.proxy(b.handleLocationChange,b,a)())})},handleLocationChange:function(b){var a=this;!this.formId&&0<d(this.element).has("#"+b.id).length&&(this.formId=b.id);var c=Object.values(b).join("").replace(/[\W_]+/g,"");c===b.id.replace(/[-]/g,"")||b.id!==this.formId&&!b.isPrefillCtid||""==b.cityId+b.hotelId+b.landmarkId+b.location||(this.getChildElement("backgroundOverlay").removeClass("noOverlay"),
this.imageIdentifier=c,b.imageId=c,this.options.height&&(b.height=this.options.height),this.options.width&&(b.width=this.options.width),e.action.execute("common/frontdoor/CoverPhotoUrlGenAction",b,function(b){""!==b.imageUrl&&b.imageId===a.imageIdentifier&&d.proxy(a.loadImage,a,b.imageUrl,b.imageId)()}))},loadImage:function(b,a){var c=this,e=d(".imagePreloader");d("#"+this.id("backgroundWrapper")).append("\x3cdiv class\x3d'coverPhotoBackground notLoaded' style\x3d'background-image: url("+b+")'\x3e\x3c/div\x3e");
var f=d(".coverPhotoBackground.notLoaded");e.attr("src",b);e.one("load",function(){a!==c.imageIdentifier&&c.imageIdentifier||(f.removeClass("notLoaded"),f.addClass("active"),setTimeout(function(){d(".coverPhotoBackground").not(".active, .notLoaded").remove();f.removeClass("active")},2E3))})}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.frontdoor.ChallengerFrontDoorContent",{options:{ctid:void 0},init:function(){}})})(R9,jQuery);(function(e,d){e.createComponentClass("common.frontdoor.CoverPhoto",{imageIdentifier:void 0,locationChangeEvent:void 0,formId:void 0,stretchHeight:void 0,coverPhotoContent:null,options:{imageUrl:void 0,vertical:void 0,changeOnDestinationInput:!0,height:void 0,width:void 0,resizeBg:!0},init:function(){this.stretchHeight=this.options.height;d.proxy(this.loadImage,this,this.options.imageUrl,this.options.imageUrl)();this.coverPhotoContent=d(".coverPhoto",this.element)},addEventHandlers:function(){var b=
this;this.subscribe("frontdoor.coverphoto.change",function(a){b.imageIdentifier||setTimeout(function(){d.proxy(b.handleLocationChange,b,a)()},7500)});this.options.changeOnDestinationInput&&("hotels"===this.options.vertical?this.addHotelEventHandler():"packages"===this.options.vertical?this.addPackageEventHandler():"cars"===this.options.vertical?this.addCarEventHandler():"flighttracker"===this.options.vertical?this.addFlightTrackerEventHandler():"cruises"===this.options.vertical?this.addCruiseEventHandler():
this.addFlightEventHandler());this.initComponentResizeListeners()},initComponentResizeListeners:function(){var b=this;this.options.resizeBg&&(this.element.on("click touchend",d.proxy(this.resizeBgImage,this)),e.events.subscribe("cmp2.shown",d.proxy(this.resizeBgImage,this)),e.events.subscribe("cmp2.hidden",d.proxy(this.resizeBgImage,this)),jq(window).on("resize",function(){e.Common.Utils.throttle(100,function(){this.resizeBgImage()},b)()}))},resizeBgImage:function(){var b=this;requestAnimationFrame(function(){b.stretchHeight=
b.coverPhotoContent.outerHeight();var a=d(".coverPhotoBackground",b.element);b.stretchHeight!==a.outerHeight()&&(b.stretchHeight>=b.options.height?a.css("height",b.stretchHeight):(a.css("height",b.options.height),b.stretchHeight=b.options.height))})},addFlightEventHandler:function(){var b=this;this.subscribe([this.options.vertical+".search.rtow.form.destination",this.options.vertical+".search.multi.form.destination"],function(a){if(!a.formtoken&&a.destinationCode){var c;-1<a.destinationCode.indexOf("/")?
(c=a.destinationCode.split("/"),a.cityId=c[1]||""):-1<a.destinationCode.indexOf("-")?(c=a.destinationCode.split("-"),-1<c[1].indexOf(":")?(c=c[1].split(":"),a.countryId=c[1]||""):a.cityId=c[1]||""):(c=a.destinationCode.length,"fr"===a.destinationCode.substr(c-2,c)?a.freeRegionId=a.destinationCode.substr(0,c-2)||"":a.regionId=a.destinationCode.substr(0,c-1)||"");d.proxy(b.handleLocationChange,b,a)()}})},addCarEventHandler:function(){var b=this;this.subscribe("cars.frontdoor.form.locations",function(a){if(!d(".formType.active").data("oneway")||
a.dropoffLocation)a.cityId=a.dropoffCityId||a.pickupCityId,d.proxy(b.handleLocationChange,b,a)()})},addHotelEventHandler:function(){var b=this;this.subscribe("hotels.frontdoor.form.location",function(a){d.proxy(b.handleLocationChange,b,a)()})},addPackageEventHandler:function(){var b=this;this.subscribe("packages.frontdoor.form.destinationLocation",function(a){if(a.locationId){var c=a.locationId.substr(1);a.locationId.startsWith("Z")?a.cityId=c:a.locationId.startsWith("X")?a.regionId=c:a.locationId.startsWith("Y")?
a.freeRegionId=c:a.locationId.startsWith("U")?a.countryId=c:a.locationId.startsWith("L")?a.landmarkId=c:a.locationId.startsWith("H")?a.hotelId=c:a.locationId.startsWith("A")&&(a.airportCode=c)}d.proxy(b.handleLocationChange,b,a)()})},addFlightTrackerEventHandler:function(){var b=this;this.subscribe("flighttracker.frontdoor.form.location",function(a){!a.cityId&&a.destinationCode&&-1<a.destinationCode.indexOf("/")&&(a.cityId=a.destinationCode.split("/")[1]||void 0);a.cityId&&0!==d(b.element).has("#"+
a.id).length&&(b.formId=a.id,d.proxy(b.handleLocationChange,b,a)())})},addCruiseEventHandler:function(){var b=this;this.subscribe("cruises.frontdoor.form.destination",function(a){a.destination&&""!==a.destination&&(a.cruiseDestination=a.destination,d.proxy(b.handleLocationChange,b,a)())})},handleLocationChange:function(b){var a=this;!this.formId&&0<d(this.element).has("#"+b.id).length&&(this.formId=b.id);var c=Object.values(b).join("").replace(/[\W_]+/g,"");c===b.id.replace(/[-]/g,"")||b.id!==this.formId&&
!b.isPrefillCtid||""==b.cityId+b.hotelId+b.landmarkId+b.location+b.cruiseDestination||(this.getChildElement("backgroundOverlay").removeClass("noOverlay"),this.imageIdentifier=c,b.imageId=c,this.options.height&&(b.height=this.options.height),this.options.width&&(b.width=this.options.width),b.vertical=this.options.vertical,e.action.execute("common/frontdoor/CoverPhotoUrlGenAction",b,function(b){""!==b.imageUrl&&b.imageId===a.imageIdentifier&&d.proxy(a.loadImage,a,b.imageUrl,b.imageId)()}))},loadImage:function(b,
a){var c=this,e=d(".imagePreloader");d("#"+this.id("backgroundWrapper")).append("\x3cdiv class\x3d'coverPhotoBackground notLoaded' style\x3d'height:"+this.stretchHeight+"px; background-image: url("+b+")'\x3e\x3c/div\x3e");var f=d(".coverPhotoBackground.notLoaded");e.attr("src",b);e.one("load",function(){a!==c.imageIdentifier&&c.imageIdentifier||(f.removeClass("notLoaded"),f.addClass("active"),setTimeout(function(){d(".coverPhotoBackground").not(".active, .notLoaded").remove();f.removeClass("active")},
2E3))})}})})(R9,jQuery);(function(b){b.createComponentClass("common.frontdoor.EmailSubscriptionPanel",{subscriptionEndpoint:"a/api/subscription/byemail",options:{hasSubscriptionCookieKey:"hasEmailSubscription"},formElement:null,inputElement:null,mainPanel:null,successPanel:null,emailTooltip:null,closeTooltipTimer:null,emailAddress:"",init:function(){this.formElement=this.getChildElement("signupForm");this.inputElement=this.getChildElement("input");this.mainPanel=this.getChildElement("mainPanel");this.successPanel=this.getChildElement("successPanel")},
addEventHandlers:function(){this.formElement.submit(this.handleSubmit.bind(this));this.inputElement.keydown(this.handleKeyDown.bind(this))},handleSubmit:function(a){a.preventDefault();b.validation.customValidate(this.inputElement,/^.+@.+\..+$/,this.onValidationSuccess.bind(this),this.onInvalidEmail.bind(this))},handleKeyDown:function(a){"13"===a.which&&this.formElement.submit()},onInvalidEmail:function(){this.showErrorTooltip("data-invalid-message")},onValidationSuccess:function(){this.emailAddress=
this.inputElement.val();var a="?email\x3d"+this.emailAddress,c=JSON.stringify(["all"]);this.disableInput();$.ajax({method:"PUT",url:this.subscriptionEndpoint+a,contentType:"application/json",data:c,headers:{"X-CSRF":b.globals.formtoken}}).done(this.onSubmitSuccess.bind(this)).fail(this.onSubmitFailure.bind(this)).always(this.enableInput.bind(this))},onSubmitSuccess:function(){this.setSubscriptionStatusCookie();this.mainPanel.addClass("hidden-fade");this.successPanel.removeClass("hidden-fade");this.successPanel.click(function(){this.element.addClass("collapsed")}.bind(this))},
onSubmitFailure:function(){this.onInvalidEmail()},setSubscriptionStatusCookie:function(){window.setMetaCookie(this.options.hasSubscriptionCookieKey,!0)},showErrorTooltip:function(a){a=this.formElement.attr(a);this.emailTooltip?this.emailTooltip.setContent(a):(window.clearTimeout(this.closeTooltipTimer),this.inputElement.toolTip({content:a,showImmediately:!0,activation:"focus",closeOnBodyClick:!0}),this.emailTooltip=this.inputElement.data("toolTip"));this.emailTooltip.open();this.closeTooltipTimer=
setTimeout(function(){this.emailTooltip.removeWidget()}.bind(this),5E3)},enableInput:function(){this.formElement.removeClass("disabled").off("submit").submit(this.handleSubmit.bind(this));this.inputElement.removeAttr("disabled");this.getChildElement("submit").removeAttr("disabled")},disableInput:function(){this.formElement.addClass("disabled").off("submit");this.inputElement.attr("disabled",!0);this.getChildElement("submit").attr("disabled",!0)}})})(R9);(function(g,c){g.createComponentClass("common.frontdoor.EventbriteFrontDoorContent",{currentCtid:0,className:".Common-Frontdoor-ChallengerFrontDoorContent",isGlobalSearch:!1,smallTilesToShow:3,mediumTilesToShow:5,options:{vertical:"hotel"},init:function(){this.setCurrentCtidFromForm();this.updateEventTiles()},addEventHandlers:function(a){var b=this;g.events.subscribe("common.frontdoor.smartyUpdated",function(a){var c=b.currentCtid;try{"city"===a.type?c=a.ctid:"ap"===a.type&&(c=a.ctid.split("/")[1])}catch(e){b.setCurrentCtidFromForm()}c!=
b.currentCtid&&(b.currentCtid=c,b.updateEventTiles())});this.getElement(".eventTileBig").click(function(a){(a=c(a.currentTarget).data("searchLink"))&&window.open(a)});this.getElement(".downwardArrow").click(function(a){a=c(b.element).offset().top;c("body").stop().animate({scrollTop:a},"500","swing",function(){})})},updateEventTiles:function(){var a=this,b=this.currentCtid;a.getElement(".spinner").show();a.isGlobalSearch=!(b&&"0"!=b);c.getJSON("/a/api/events",a.isGlobalSearch?{}:{cityId:b}).done(function(b){a.getElement(".spinner").hide();
a.populateUI(b);a.getElement(".eventTiles").show();a.toggleTitle()}).fail(function(b,c,e){a.hideComponent()})},populateUI:function(a){function b(a,b){e.find("."+a).html(b)}var f=a.events,h=9;if(!f||5>f.length)this.hideComponent();else{9>f.length&&(h=5);var e;this.resetUI();this.isGlobalSearch||this.getElement(".titleCity").html(a.city);for(a=0;a<h;a++){var d=f[a];e=this.getElement(".eventTileSmallTemplate").clone();e.removeClass("eventTileSmallTemplate");e.find(".topImage").css({"background-image":"url("+
d.logoSmall+")"});b("date",d.datesFormatted.toUpperCase());b("eventName \x3e div",d.name.substr(0,65));this.isGlobalSearch?b("eventLocation \x3e div",d.venue.city+", "+d.venue.country):b("eventLocation \x3e div",d.venue.name.substr(0,70));d.hotel&&0<d.hotel.price.length?b("price",d.hotel.price):b("price","\x26ndash;");d.hotel&&(d.hotel.distance||0===d.hotel.distance)&&10>d.hotel.distance?b("distance",Math.round(10*d.hotel.distance)/10+" miles away"):b("distance","nearby");d.url&&(e.find(".infoLink").attr("href",
d.url),e.find(".infoLink").click(function(a){a.stopPropagation()}));d.hotel&&d.hotel.url&&(0==a&&this.getElement(".eventTileBig").data("searchLink",d.hotel.url),e.data("searchLink",d.hotel.url),e.click(function(a){window.open(c(a.currentTarget).data("searchLink"))}));a>=this.smallTilesToShow&&e.addClass("hiddenSmallTile");a>=this.mediumTilesToShow&&e.addClass("hiddenMediumTile");0==a?(this.getElement(".eventTileBig .mainEventDescription").html(e.find(".eventTileSmall").clone(!0)),this.getElement(".eventTiles .bigImage").css({"background-image":"url("+
d.logoLarge+")","background-color":"white"}).show(),e.addClass("smallScreenOnly"),this.getElement(".eventTileRow.row0").append(e)):this.getElement(".eventTileRow.row"+Math.floor((a-1)/4)).append(e);this.limitHeight(e.find(".eventName"));this.limitHeight(e.find(".eventLocation"))}}},resetUI:function(){this.getElement(".eventTileRow.row0").html("");this.getElement(".eventTileRow.row1").html("");this.getElement(".eventTileBig .mainEventDescription").html("");this.getElement(".eventTiles .bigImage").hide();
this.showComponent()},hideComponent:function(){c(this.element).hide()},showComponent:function(){c(this.element).show()},toggleTitle:function(){this.isGlobalSearch?(this.getElement(".nearbyEventsTitle").hide(),this.getElement(".worldEventsTitle").show()):(this.getElement(".nearbyEventsTitle").show(),this.getElement(".worldEventsTitle").hide())},getElement:function(a){return c(a,this.element)},limitHeight:function(a){var b=a.height();for(a=a.children().eq(0);a.outerHeight()>b&&a.text().match(/\W*\s(\S)*$/);)a.text(function(a,
b){return b.replace(/\W*\s(\S)*$/,"...")})},setCurrentCtidFromForm:function(){try{"hotels"===this.options.vertical?this.currentCtid=c("[name\x3dsearchform]")[0].citycode.value:"flights"===this.options.vertical?this.currentCtid=c("[name\x3drtow-searchform]")[0].destinationcode.value.split("/")[1]:"cars"===this.options.vertical&&(c(c("[name\x3dsearchform]")[0].dropoff).is(":visible")&&c("[name\x3dsearchform]")[0].dropoff.value?this.currentCtid=c("[name\x3dsearchform]")[0].dropoffcity.value:this.currentCtid=
c("[name\x3dsearchform]")[0].pickupcity.value)}catch(a){this.currentCtid=0}}})})(R9,jQuery);(function(a,b){a.createComponentClass("sem.common.landing.FeaturesPromo",{options:{hasCarousel:!0},init:function(){this.bindLoggingEvents()},inlineComponentsReady:function(){this.options.hasCarousel&&this.initCarousel()},initCarousel:function(){var a=b(".carouselWrapper",this.element);a.slick({arrows:!1,centerMode:!0,centerPadding:"55px",slidesToShow:1,focusOnSelect:!0,autoplay:!0,autoplaySpeed:6E3,swipeToSlide:!0,speed:100});a.css("opacity",0).animate({opacity:1},300);this.bindLoggingEvents();b(".carouselWrapper a").on("click",
function(a){0!==parseInt(b(this).attr("tabindex"))&&a.preventDefault()})},bindLoggingEvents:function(){b(".features-promo-alerts:visible").on("click",function(){a.Analytics.api.trackEvent("featuresPromo/alerts")});b(".features-promo-explore:visible").on("click",function(){a.Analytics.api.trackEvent("featuresPromo/explore")});b(".features-promo-flights:visible").on("click",function(){a.Analytics.api.trackEvent("featuresPromo/flights")});b(".features-promo-trips:visible").on("click",function(){a.Analytics.api.trackEvent("featuresPromo/trips")})}})})(R9,
jQuery);(function(a){a.createComponentClass("common.frontdoor.FlightTrackerTooltip",{dialogComponent:null,autoOpenTimer:null,autoOpenDelay:1E3,options:{isToolTipEnabled:!1},init:function(){this.options.isToolTipEnabled&&(this.dialogComponent=this.getChildElement("flightTrackerTooltip").getWidget(),this.autoOpenTimer=setTimeout(this.openDialog.bind(this),this.autoOpenDelay),this.bindEvents())},bindEvents:function(){this.getChildElement("trackerLink").click(function(){a.Analytics.api.trackEvent("common/frontdoor/FlightTrackerTooltip/click")})},
openDialog:function(){this.dialogComponent.open()}})})(R9);(function(b,c){b.createComponentClass("common.frontdoor.HolidayLights",{options:{enabled:!1,lightsOn:!0,saveTimeout:500},on:!1,saveTimeout:null,META_COOKIE_KEY:"HOLIDAY_LIGHTS_DISABLED",init:function(){this.base();this.on=this.options.lightsOn;this.update()},addEventHandlers:function(){this.base();this.options.enabled&&this.getChildElement("switch").click(this.toggle.bind(this))},toggle:function(){this.on=!this.on;var a=this;this.update();null!==this.saveTimeout&&clearTimeout(this.saveTimeout);this.saveTimeout=
setTimeout(function(){a.save();a.saveTimeout=null},this.options.saveTimeout)},save:function(){this.on?deleteMetaCookie(this.META_COOKIE_KEY):setMetaCookie(this.META_COOKIE_KEY,"true")},update:function(){this.on?this.element.addClass("on"):this.element.removeClass("on")}})})(R9,jQuery);(function(a){a.createComponentClass("common.frontdoor.PrivateDealsTooltip",{disabled:a.storage.get("common.frontdoor.PrivateDealsTooltip.disabled"),dialogComponent:null,autoOpenTimer:null,autoOpenDelay:a.config.getInt("horizon.common.frontdoor.privateDealsPromo.openDelay",2E3),clickedTooltipLink:!1,options:{userHasAccount:!1,staticSignInEnabled:!1},init:function(){this.disabled||(this.dialogComponent=this.getChildElement("privateDealsTooltip").dropdownDialog({}).getWidget(),this.autoOpenTimer=setTimeout(this.openDialog.bind(this),
this.autoOpenDelay))},addEventHandlers:function(){if(!this.disabled){var b=this;this.getChildElement("login").click(function(c){b.clickedTooltipLink=!0;a.Social.WebCredentials.trySignIn(function(){b.options.staticSignInEnabled?a.authentication.showDefault({promoType:"private_rates"}):b.options.userHasAccount?a.authentication.showLogin():a.config.getBoolean("ui.pushsocial.enabled",!1)?a.authentication.social.showSocialLogin():a.authentication.showSignup()});b.closeDialog(c,!1,"clickedLogin")});this.getChildElement("close").click(this.closeDialog.bind(this,
!0));this.subscribe(["DropdownDialog.open","resultspage.routed"],this.cancelOpenTimer.bind(this));this.subscribe("resultspage.routed",this.closeDialog.bind(this,!1));this.trackLoginEvents()}},trackLoginEvents:function(){var b=this,c=["success","fail","error"];["login","signup"].forEach(function(d){c.forEach(function(c){var e=d+"."+c;b.subscribe(e,function(){a.Analytics.api.trackEvent("/hotels/frontdoor/loginPrompt/"+e+b.getLoginMethod())})})})},getLoginMethod:function(){return this.clickedTooltipLink?
".fromTooltip":".fromHeader"},cancelOpenTimer:function(){clearTimeout(this.autoOpenTimer)},openDialog:function(){this.dialogComponent.open();a.Analytics.api.trackEvent("/hotels/frontdoor/loginPrompt/opened")},closeDialog:function(b,c,d){this.dialogComponent.close();c&&a.storage.set("common.frontdoor.PrivateDealsTooltip.disabled",!0);"undefined"===typeof d&&(d="closed");a.Analytics.api.trackEvent("/hotels/frontdoor/loginPrompt/"+d)}})})(R9);(function(a,b){a.createComponentClass("common.frontdoor.SponsoredFDTile",{init:function(){},addEventHandlers:function(){this.getChildElement("sponsored-link").click(function(){a.Analytics.api.trackEvent("hollandfdclick")})}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.frontdoor.SwindleListener",{isSwindleTab:!1,swindleTabQueryKey:"syncTab",filterURL:null,options:{acceptedURLRegex:".*"},useQueryParam:function(){return b.config.getBoolean("ui.swindle.syncQueryParam",!1)},init:function(){this.isSwindleTab=!this.useQueryParam();this.filterURL=new RegExp(this.options.acceptedURLRegex);this.useQueryParam()&&(this.isSwindleTab=window.location.hash==="#"+this.swindleTabQueryKey,b.Common.Utils.URL.removeHash())},shouldReload:function(a){a=
b.Common.Utils.URL.stripHash(a);return this.useQueryParam()&&-1!==window.location.href.indexOf(a)},redirect:function(a){window.location=a;this.shouldReload(a)&&window.location.reload()},addEventHandlers:function(a){var c=this;window.addEventListener("storage",function(a){"swindle"===a.key&&c.isSwindleTab&&c.filterURL.test(a.newValue)&&setTimeout(function(){if(b.storage.get("swindle")){var e=c.useQueryParam()?b.Common.Utils.URL.addHash(a.newValue,c.swindleTabQueryKey):a.newValue;b.storage.remove("swindle");
c.launchUrl(e)}},Math.floor(500*Math.random()))},!1);b.events.subscribe(["searchform.submit","swindleTab.deactivated"],function(){c.isSwindleTab=!1});b.events.subscribe("swindleTab.activated",function(){c.isSwindleTab=!0})},launchUrl:function(a){var c=this,b=a.match(/^(https?:\/\/[^\/]+)\//);b?d.ajax(b[1]+"/s/horizon/hotels/swindle/CacheCookieAction",{data:{search:a},method:"POST",success:function(){c.redirect(a)}}):(b=(new Date(Date.now()+18E4)).toGMTString(),document.cookie="cached-search\x3d"+
encodeURIComponent(a)+";path\x3d/;expires\x3d"+b,c.redirect(a))}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.frontdoor.TopDestinationTiles",{init:function(){this.element.find("img").unveil(500,function(){b(this).on("load",function(){this.style.opacity=1})}).trigger("unveil")}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.frontdoor.WinnerClaim",{options:{moreDetailString:"",moreDetailStringLink:"",moreDetailLink:""},init:function(){this.moreDetComp=b(".details");this.bindEvents()},bindEvents:function(){this.moreDetComp.toolTip({content:this.options.moreDetailString+" \x3ca style\x3d'color:white; text-decoration:underline;' href\x3d'"+this.options.moreDetailLink+"'\x3e"+this.options.moreDetailStringLink+"\x3c/a\x3e",position:"top",show:!1,keepOpenOnContentHover:!0,closeDelay:1E3})}})})(R9,
jQuery);(function(a){a.createComponentClass("common.frontdoor.upcomingtrip.UpcomingTrip",{init:function(){(new a.fd.UpcomingTrip(this.id())).load()}})})(R9);(function(p,e){p.createComponentClass("common.gallery.DestinationCarousel",{slidesContainer:null,slidesContainerWidth:0,slideWidth:null,slidesPerPage:1,slides:null,slidesInitial:null,listContainer:null,currentPageNr:1,pageCount:1,autoSlideInterval:null,isAnimating:!1,touchHandler:null,currentOffset:0,touchOffset:0,isStopped:!1,sortedBreakpoints:[],options:{eventsNamespace:null,slidesContainerSelector:null,slideSelector:".slide",slidesPerPage:0,breakpointsEnabled:!1,breakpoints:{},slidesPerPageByBreakpoints:{},
showControls:!0,controlsContainerSelector:".slideControls",controlsClass:"Common-Gallery-DestinationCarousel-Controls",pageClass:"bullet",currentPageClass:"current",prevPageClass:"previous",nextPageClass:"next",firstPageClass:"first",lastPageClass:"last",next:null,previous:null,animationDuration:400,hideOffViewSlides:!0,autoStart:!0,autoSlide:!0,autoSlideDuration:1E4,isInfinite:!1,controlsPositionAdjustment:0,touchEvents:!0,touchSnapThreshold:0,touchSnapToPage:!0,positionAdjustment:0,relativeLastDraw:!1},
getSlides:function(){this.slides||(this.slides=e(this.options.slideSelector,this.slidesContainer));return this.slides},getUnstableSlides:function(){return e(this.options.slideSelector,this.slidesContainer)},init:function(a){var b=this.options;this.slidesContainer=b.slidesContainerSelector?e(b.slidesContainerSelector):a;this.getSlides().length&&(this.isStopped=!this.options.autoStart,this.reinit(),this.options.isInfinite&&this.initInfiniteCarousel())},reinit:function(){if(!this.isStopped){var a=this.options,
b=a.isInfinite?this.getUnstableSlides():this.getSlides(),d=this.slidesContainerWidth=this.slidesContainer.parent().width(),c;if(a.breakpointsEnabled||this.options.slidesPerPage){if(a.breakpointsEnabled){var f=[];e.each(a.breakpoints,function(a,b){f.push([a,b])});f.sort(function(a,b){return a[1]-b[1]});this.sortedBreakpoints=f;a=this.getSlidesPerPageByWindowWidth()}else a=a.slidesPerPage;this.slidesPerPage=a;c=this.slideWidth=d/a;b.css("width",c+"px")}else{c=this.slideWidth=b.first().outerWidth();
if(!c)return;a=this.slidesPerPage=Math.ceil(d/c)||1}this.pageCount=Math.ceil(b.length/a)||1;this.options.isInfinite?this.adjustInfiniteCarouselPosition():this.draw(1,!1)}},initInfiniteCarousel:function(){this.listContainer=this.slidesContainer.find(".keel-grid");this.drawControls(this.pageCount,null,null);this.cloneSlides();this.currentPageNr+=this.slides.length;this.adjustInfiniteCarouselPosition();var a=this;setTimeout(function(){a.listContainer&&a.setControlsHeight()},100)},adjustInfiniteCarouselPosition:function(){this.draw(this.currentPageNr,
!0);this.setControlsHeight()},getSlidesPerPageByWindowWidth:function(){var a=this.slidesContainerWidth,b=this.options,d=b.slidesPerPageByBreakpoints.xl||b.slidesPerPageByBreakpoints.l||1;e.each(this.sortedBreakpoints,function(c,f){c=f[0];if(a<f[1])return d=b.slidesPerPageByBreakpoints[c],!1});return d},addEventHandlers:function(){this.bindOnWindowResize();this.bindOnPageClick();this.bindAutoSlide();this.bindTouchEvents();this.bindEventListeners()},bindEventListeners:function(){var a=this,b=this.options.eventsNamespace;
b&&p.events.subscribe(b,function(b){if(void 0!==b.stop){if(a.isStopped=b.stop,a.isStopped&&(b.preserveDynamicSlideWidth||a.getSlides().css("width",""),b.removeControls))a.onAnimationEnd(function(){e(a.options.controlsContainerSelector).html("")})}else void 0!==b.start&&(a.isStopped=!b.start,b.start&&(a.options.autoStart||a.reinit(),a.startAutoSlide()))})},onAnimationEnd:function(a){this.isAnimating||a();var b=this,d=setInterval(function(){b.isAnimating||(a(),clearInterval(d))},10)},bindTouchEvents:function(){if(this.options.touchEvents&&
this.isTouch())this.slidesContainer.on("touchstart",{self:this},this.onTouchStart).on("touchmove",{self:this},this.onTouchMove).on("touchend",{self:this},this.onTouchEnd)},onTouchStart:function(a){var b=a.data.self;b.isStopped||(b.touchOffset=a.originalEvent.touches[0].pageX,b.isAnimating&&b.slidesContainer.stop(),b.stopAutoSlide())},onTouchMove:function(a){var b=a.data.self;b.isStopped||b.moveTo(b.currentOffset-(b.touchOffset-a.originalEvent.touches[0].pageX),!0,null,!1)},onTouchEnd:function(a){var b=
a.data.self;if(!b.isStopped){a=a.originalEvent.changedTouches[0].pageX-b.touchOffset;var d=Math.ceil(Math.abs(a/(b.options.isInfinite?b.slideWidth:b.slidesPerPage*b.slideWidth)));if(b.options.touchSnapToPage){if(b.options.isInfinite)Math.abs(a)>=b.options.touchSnapThreshold&&(0<a?(b.unshift(a),c=b.currentPageNr,c-=d):(b.push(a),c=b.currentPageNr,c+=d));else{var c=b.currentPageNr;Math.abs(a)>=b.options.touchSnapThreshold&&(c=0<a?c-d:c+d)}b.draw(c,!0)}else b.currentOffset+=a,b.startAutoSlide()}},bindOnWindowResize:function(){var a,
b=this;e(window).resize(function(){clearTimeout(a);a=setTimeout(function(){b.stopAutoSlide();b.reinit()},10)})},bindOnPageClick:function(){var a=this.options,b=this;if(a.showControls)e("body").on("click",a.controlsContainerSelector+" ."+a.pageClass,function(a){a.preventDefault();b.isAnimating||((a=parseInt(this.getAttribute("data-nr"),10),b.options.isInfinite)?e(this).hasClass("previous")?(b.previous(),b.drawControls(b.slides.length,this.currentPageNr,null)):e(this).hasClass("next")&&(b.next(),b.drawControls(b.slides.length,
this.currentPageNr,null)):b.draw(a,!0))})},previous:function(){var a=this.getUnstableSlides(),b=a.last(),a=a.first(),d=b.css("padding");b.clone(!0).css({width:"0",padding:"0",visibility:"visible"}).insertBefore(a).animate({width:this.slideWidth,padding:d},"fast");b.remove()},next:function(){var a=this.getUnstableSlides(),b=a.first();a.last().attr("id")===a.eq(a.length-2).attr("id")&&(a.last().remove(),a.first().clone().appendTo(this.listContainer));a=a.last();b.clone(!0).css({visibility:"visible"}).insertAfter(a);
b.hide("fast",function(){e(this).remove()})},unshift:function(a){var b=this.getUnstableSlides();a=this.currentOffset-this.slideWidth+a;b.last().insertBefore(b.first());this.slidesContainer.css({left:a});this.currentPageNr++},push:function(a){var b=this.getUnstableSlides();a=this.currentOffset+this.slideWidth+a;b.first().insertAfter(b.last());this.slidesContainer.css({left:a});this.currentPageNr--},cloneSlides:function(){this.listContainer.hide();var a=this.slides,b=a.clone(!0),a=a.clone(!0);b.prependTo(this.listContainer);
a.appendTo(this.listContainer);this.listContainer.show()},bindAutoSlide:function(){var a=this;this.options.autoSlide&&(this.startAutoSlide(),this.slidesContainer.mouseenter(function(){a.stopAutoSlide()}),this.slidesContainer.mouseleave(function(){a.startAutoSlide()}))},startAutoSlide:function(){if(this.options.autoSlide&&!this.isStopped){var a=this;this.stopAutoSlide();this.autoSlideInterval=setInterval(function(){var b=a.currentPageNr+1;b>a.pageCount&&(b=1);a.draw(b,!1)},this.options.autoSlideDuration)}},
stopAutoSlide:function(){clearInterval(this.autoSlideInterval);this.autoSlideInterval=null},draw:function(a,b){if(!this.isStopped){b&&this.stopAutoSlide();var d=this,c=this.options.isInfinite?this.getUnstableSlides():this.getSlides(),f=this.options,e=this.slidesPerPage,h=this.options.relativeLastDraw;if(f.isInfinite)g=c.length;else{var g=this.pageCount;a>g?a=g:1>a&&(a=1)}var m=parseInt(this.options.positionAdjustment)||0,n=h&&a===g?(a-2)*(this.slideWidth-m)*e+(this.slideWidth-m)*(c.length-(a-1)*this.slidesPerPage):
f.isInfinite?(a-1)*(this.slideWidth-m):(a-1)*(this.slideWidth-m)*e;f.hideOffViewSlides&&c.css("visibility","visible");f.isInfinite&&(this.currentOffset=-n);this.moveTo(-n,b,function(){if(f.hideOffViewSlides)for(var b=h&&a===g?c.length-e*(a-1):(a-1)*e,k=b+e-1,l=0;l<c.length;l++)(l<b||l>k)&&c.eq(l).css("visibility","hidden");f.showControls&&d.drawControls(g,a,function(){f.isInfinite&&d.setControlsHeight()});d.currentPageNr=a;d.currentOffset=-n},!0)}},moveTo:function(a,b,d,c){var f=this,e=this.options,
h=function(){f.isAnimating=!1;b&&f.startAutoSlide();"function"===typeof d&&d()};c?(this.isAnimating=!0,this.slidesContainer.stop().animate({left:a},e.animationDuration,h)):(this.slidesContainer.css({left:a}),h())},drawControls:function(a,b,d){var c=this.options,f=e(c.controlsContainerSelector);if(0!==f.length)if(2>a)f.html("");else{e("."+c.pageClass,f).remove();var k=[],h=0,g=this.createControlItem(1===b?a:b-1,c.prevPageClass);k.push(g[0]);if(!c.isInfinite)for(;h<a;h++)g=this.createControlItem(h+
1),0===h&&g.addClass(c.firstPageClass),b===h+1&&g.addClass(c.currentPageClass),h===a-1&&g.addClass(c.lastPageClass),k.push(g[0]);a=this.createControlItem(b===a?1:b+1,c.nextPageClass);k.push(a[0]);k=e("\x3cul/\x3e").html(k);k.addClass(c.controlsClass);c.isInfinite&&f.addClass("InfiniteCarouselControls");f.html(k);"function"===typeof d&&d()}},createControlItem:function(a,b){var d=e("\x3cli/\x3e"),c=this.options;b===c.prevPageClass&&c.previous?d.append(c.previous):b===c.nextPageClass&&c.next?d.append(c.next):
d.append('\x3ca href\x3d"#"\x3e'+a+"\x3c/a\x3e");d.addClass(c.pageClass);b&&d.addClass(b);d.attr("data-nr",a);return d},setControlsHeight:function(){var a=e(this.options.controlsContainerSelector),b=this.slidesContainer.height();a.css("top",this.options.controlsPositionAdjustment+.5*b)},isTouch:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}})})(window.R9,window.jq||window.jQuery);(function(l,c){l.createComponentClass("common.gallery.PhotoCarousel",{isTouch:c.support.touch||"undefined"!==typeof window.ontouchstart,container:null,cache:{},autoScrollInterval:null,photoCarouselControls:null,hideControlTimeout:null,photoIdx:0,firstPhoto:!0,isAnimating:!1,SHOW_HIDE_CONTROL_SPEED:200,photoCarouselPhotos:null,photoCarouselPhotosPreload:null,scrollTop:null,options:{carouselPhotos:null,retinaCarouselPhotos:null,width:100,height:100,parallax:!0,showBottomControl:!1,autoScroll:!1,rangeToPreload:2,
isCuban:!1,showRetinaImagesOnRetina:!1},init:function(a){this.cache={};this.options.showRetinaImagesOnRetina&&1<window.devicePixelRatio&&this.options.retinaCarouselPhotos&&this.options.retinaCarouselPhotos.length>=this.options.carouselPhotos.length&&(this.options.carouselPhotos=this.options.retinaCarouselPhotos);this.photoCarouselPhotos=c("\x3cdiv/\x3e",{"class":"photoCarouselPhotos"});this.photoCarouselPhotosPreload=c("\x3cdiv/\x3e",{"class":"photoCarouselPhotos offScreen"});a.append(this.photoCarouselPhotos);
a.append(this.photoCarouselPhotosPreload);this.container=a;1<this.options.carouselPhotos.length&&this.createControls();var e=this;this.scrollTop=c(document).scrollTop();this.options.parallax&&c(window).scroll(function(){e.scrollTop=c(document).scrollTop()});this.options.parallax&&window.raf(this.setParallaxOffset.bind(this));0<this.options.carouselPhotos.length&&this.setPhotoIdx(this.photoIdx,!0);this.options.autoScroll&&1<this.options.carouselPhotos.length&&this.registerAutoScrollEvents()},next:function(){this.isAnimating||
(this.isTouch&&this.unregisterAutoScrollEvents(),this.photoIdx=(this.photoIdx+1)%this.options.carouselPhotos.length,this.setPhotoIdx(this.photoIdx,!0))},previous:function(){this.isAnimating||(this.isTouch&&this.unregisterAutoScrollEvents(),this.photoIdx=(this.photoIdx-1+this.options.carouselPhotos.length)%this.options.carouselPhotos.length,this.setPhotoIdx(this.photoIdx,!0))},set:function(a){this.photoIdx===a||this.isAnimating||(this.isTouch&&this.unregisterAutoScrollEvents(),this.photoIdx=a,this.setPhotoIdx(a,
!0))},start:function(){this.registerAutoScrollEvents()},stop:function(){this.unregisterAutoScrollEvents()},updateContainer:function(a){this.container=a;this.container.append(this.photoCarouselPhotos);this.container.append(this.photoCarouselPhotosPreload);1<this.options.carouselPhotos.length&&this.createControls();return this},createControls:function(){var a=this;this.photoCarouselControls=c("\x3cdiv/\x3e",{"class":"photoCarouselControls"});this.photoCarouselControls.mouseenter(function(){a.options.autoScroll&&
1<a.options.carouselPhotos.length&&a.unregisterAutoScrollEvents()});this.photoCarouselControls.mouseleave(function(){a.options.autoScroll&&1<a.options.carouselPhotos.length&&a.registerAutoScrollEvents()});this.photoCarouselControls.append(this.createLeftControls());this.photoCarouselControls.append(this.createRightControls());this.options.showBottomControl&&this.photoCarouselControls.append(this.createBottomControls());this.container.append(this.photoCarouselControls);this.photoCarouselControls.children().each(function(c,
d){a.disableSelection(d)})},disableSelection:function(a){"undefined"!==typeof a.onselectstart?a.onselectstart=function(){return!1}:"undefined"!==typeof a.style.MozUserSelect?a.style.MozUserSelect="none":a.onmousedown=function(){return!1}},showControls:function(){this.photoCarouselControls.stop().animate({opacity:1},this.SHOW_HIDE_CONTROL_SPEED)},hideControls:function(){this.photoCarouselControls.stop().animate({opacity:0},this.SHOW_HIDE_CONTROL_SPEED)},createLeftControls:function(){var a=this,e=c("\x3cdiv/\x3e",
{"class":"photoCarouselControlContainer left"}).click(function(){a.previous()}),d=c("\x3cdiv/\x3e",{"class":"photoCarouselArrowContainer"}).append(c("\x3cdiv/\x3e",{"class":"photoCarouselArrow"}));e.append(d);return e},createRightControls:function(){var a=this,e=c("\x3cdiv/\x3e",{"class":"photoCarouselControlContainer right"}).click(function(){a.next()}),d=c("\x3cdiv/\x3e",{"class":"photoCarouselArrowContainer"}).append(c("\x3cdiv/\x3e",{"class":"photoCarouselArrow"}));e.append(d);return e},createBottomControls:function(){for(var a=
this,e=c("\x3cdiv/\x3e",{"class":"photoCarouselControlContainer bottom"}),d=c("\x3cdiv/\x3e",{"class":"photoCarouselNavContainer"}),b=0;b<this.options.carouselPhotos.length;b++)(function(b){var e=c("\x3cspan/\x3e",{"class":"photoCarouselNav"}).click(function(){a.set(b)});d.append(e)})(b);e.append(d);return e},registerAutoScrollEvents:function(){if(this.options.autoScroll){var a=this;this.unregisterAutoScrollEvents();this.autoScrollInterval=setInterval(function(){a.next()},5E3)}},unregisterAutoScrollEvents:function(){this.options.autoScroll&&
clearInterval(this.autoScrollInterval)},setParallaxOffset:function(){window.raf(this.setParallaxOffset.bind(this));var a=this.container.offset();if(a&&a.top){var a=a.top,e=c(window).height(),a=this.scrollTop+e<a?100:this.scrollTop>a+this.options.height?0:Math.round(100-100*(this.scrollTop-a+e)/(e+this.options.height));c(".parallax",this.container).css({backgroundPositionY:a+"%"})}},setPhotoIdx:function(a,e){if(e)for(var d=a-this.options.rangeToPreload;d<=Math.min(a+this.options.rangeToPreload,this.options.carouselPhotos.length);d++){for(var b=
d;0>b||b>=this.options.carouselPhotos.length;)b=(b+this.options.carouselPhotos.length)%this.options.carouselPhotos.length;b!==a&&!this.cache[b]&&this.setPhotoIdx(b,!1)}var b=this.options.carouselPhotos[a],d=l.Common.Utils.getImageToContainerSize(b.width,b.height,this.options.width,this.options.height),f=b.width>=this.options.width&&b.height>=this.options.height,g=d.finalWidth,h=d.finalHeight,m=d.shiftX,p=d.shiftY,n=b.caption;this.cache[a]?d=this.cache[a]:(d=c("\x3cdiv/\x3e",{"class":"photoCarouselBackground"}),
f=c("\x3cdiv/\x3e",{"class":"photoCarouselPhoto"+(f?"":" smallImage"),width:g>this.options.width?this.options.width:g,height:h>this.options.height?this.options.height:h}).css({backgroundImage:"url('"+encodeURI(b.url)+"')",backgroundSize:g+"px "+h+"px","margin-left":f?0:"-"+Math.round(b.width/2)+"px","margin-top":f?0:"-"+Math.round(b.height/2)+"px"}),this.options.parallax?(f.addClass("parallax"),f.css({backgroundPositionX:"-"+m+"px"})):f.css({backgroundPosition:"-"+m+"px -"+p+"px"}),d.append(f),""!==
n&&this.options.isCuban&&"true"===b.cubanMessaging&&(b=c("\x3cdiv/\x3e",{"class":"floattext",html:n}),f.append(b)),this.cache[a]=d);this.options.showBottomControl&&(b=c(".photoCarouselNavContainer .photoCarouselNav",this.photoCarouselControls),c(b).removeClass("selected"),c(b.get(a)).addClass("selected"));if(e&&!this.firstPhoto){var q=this,k=this.photoCarouselPhotos.children().first();k.before(d);this.isAnimating=!0;k.animate({opacity:0},{easing:"swing",duration:500,complete:function(){q.isAnimating=
!1;k.css({opacity:1}).remove()}})}else e?(this.firstPhoto=!1,this.photoCarouselPhotos.prepend(d)):this.photoCarouselPhotosPreload.append(d)}})})(window.R9,window.jq||window.jQuery);(function(a,b){a.createComponentClass("common.gallery.PhotoOverlay",{options:{shortenTitle:!0},init:function(a){this.options.shortenTitle&&b(".overlay h1").dotdotdot()}})})(window.R9,window.jq||window.jQuery);(function(d,a){d.createComponentClass("common.gallery.VideoCarousel",{isTouch:a.support.touch||"undefined"!==typeof window.ontouchstart,carouselContainerElement:void 0,options:{urls:[],type:"youtube",width:100,height:100,allowfullscreen:!0},init:function(b){var c=this;this.carouselContainerElement=a(".carouselContainer",this.element);this.carouselContainerElement.css("opacity",0);"youtube"===this.options.type&&a(this.options.urls).each(function(a,b){c.carouselContainerElement.append(c.initYoutubeVideo(b))});
this.carouselContainerElement.slick({dots:!0,arrows:!1,slidesToShow:1,autoplay:!1,swipeToSlide:!0});this.carouselContainerElement.animate({opacity:1},300)},initYoutubeVideo:function(b){var c=a("\x3cdiv/\x3e",{"class":"video"});b=a("\x3ciframe/\x3e",{src:b,allowfullscreen:this.options.allowfullscreen,webkitallowfullscreen:this.options.allowfullscreen,mozallowfullscreen:this.options.allowfullscreen,frameborder:"0"});c.append(b);return c}})})(window.R9,window.jq||window.jQuery);(function(d,e){d.createComponentClass("common.kayakeu.LocaleSelectForm",{options:{multiLocalesCookie:void 0,multiLocalesChangeCookie:void 0,selectedLocales:void 0,navigateToResults:!1},items:void 0,localesArray:void 0,localesArrayNew:void 0,init:function(){this.items=e(".items .input");this.localesArray=this.options.selectedLocales&&0!==this.options.selectedLocales.length&&this.options.selectedLocales.split(",")||[];this.localesArrayNew=this.localesArray.slice(0);this.updateSelectedLocales()},shouldUpdate:function(){var b=
this.localesArray;return b.length!==this.localesArrayNew.length||this.localesArrayNew.some(function(a){return-1===b.indexOf(a)})},addEventHandlers:function(){var b=this;this.items.off("click").on("click",function(){var a=e(this),c=!a.hasClass("checked");if(c||1<b.items.filter(".checked").length)a.data("value",c),a.toggleClass("checked",c),b.setLocaleSelected(a.data("code"),c)});d.events.subscribe("multilocale.search.submit",function(a){b.shouldUpdate()&&setMetaCookie(b.options.multiLocalesChangeCookie,
!0);setMetaCookie(b.options.multiLocalesCookie,b.localesArrayNew.join(","),function(){b.options.navigateToResults?window.location.href="/"+a.url:d.events.publish("searchform.submit",a)})})},setLocaleSelected:function(b,a){var c=this.localesArrayNew.indexOf(b);a&&-1===c?this.localesArrayNew.push(b):a||-1===c||this.localesArrayNew.splice(c,1)},updateSelectedLocales:function(){var b=this;this.items.each(function(a,c){a=e(c);c=-1!==b.localesArray.indexOf(a.data("code"));a.data("value",c);a.toggleClass("checked",
c)})}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.layout.features.uber.Uber",{options:{locale:null,countryCode:"",affiliate:"",placement:""},init:function(){},addEventHandlers:function(){var e=this,c=this.options.locale;this.getChildElement("language-dropdown").on("click",function(){a.Analytics.api.trackEvent({category:c+"/languagepicker",action:"display"})});b("li",this.getChildElement("languages")).on("click",function(){var d=b(this).data("lang");b(this).hasClass("active")?(a.Analytics.api.trackEvent({category:c+
"/languagepicker",action:"selectactive",label:d}),e.getChildElement("language-dropdown").getWidget().close()):a.Analytics.api.trackEvent({category:c+"/languagepicker",action:"select",label:d},function(){b.ajax({url:"/in",data:{lc:d,cc:e.options.countryCode,a:e.options.affiliate,p:e.options.placement},success:function(){window.location.reload()}})})});this.getChildElement("currencyPicker-dropdown").on("click",function(){a.Analytics.api.trackEvent({category:c+"/currencypicker",action:"display"})});
b(".currency-tooltip-item",this.getChildElement("currencyPicker")).on("click",function(){var d=b(this).data("cur");a.Analytics.api.trackEvent({category:c+"/currencypicker",action:"select",label:d})})}})})(window.R9,window.jq||window.jQuery);(function(e,c){e.createComponentClass("common.layout.CountryPicker",{dropdown:null,options:{currentLocale:"",baseUrl:"",newRedirect:!1},init:function(){},addEventHandlers:function(){var d=this;this.element.find("[data-locale]").hover(function(a){a=c(a.target).attr("data-locale");var b=c(this).find("[data-locale\x3d%s]".format(a));b.length&&b.addClass("hover");b=c(this).parent();b.is("[data-locale]")&&!b.is("[data-locale\x3d%s]".format(a))&&d.element.find("[data-locale]").removeClass("hover")},function(a){d.element.find("[data-locale]").removeClass("hover");
c(this).parent().is("[data-locale]")&&(a=c(this).parent().attr("data-locale"),a=c(this).parent().find("[data-locale\x3d%s]".format(a)),a.length&&a.addClass("hover"))});this.element.find("a").on("click",function(a){a.preventDefault();var b=c(a.target).attr("data-locale");if(b!==d.options.currentLocale){e.Analytics.api.trackEvent("countrylangpicker/change/"+b);var f=c.proxy(function(){var b=c(a.target).attr("data-href")||c(this).attr("href");window.location=b},this);d.options.baseUrl?d.makeRedirect(d.options.baseUrl,
b,f):f()}});c(".Common-Layout-CountryPicker-Trigger.DropDown").on("click",function(a){a.preventDefault();c(this).hasClass("open")&&e.Analytics.api.trackEvent("countrylangpicker/open")})},makeRedirect:function(d,a,b){this.options.newRedirect&&!e.globals.isSeo?c.ajax({url:d+"/k/run/isp/setcc",dataType:"jsonp",data:{cc:a},complete:function(){b()}}):b()}})})(window.R9,window.jq||window.jQuery);(function(d,b){d.createComponentClass("common.layout.CurrencyPicker",{dialog:null,init:function(){this.dialog=this.getChildElement("dialog").dialog({}).getWidget()},saveCurrency:function(a,c){b.ajax({type:"POST",url:"/k/ident/currency",data:{currency:a,posted:!0,save:c},dataType:"text",success:function(){location.reload()},cache:!1})},addEventHandlers:function(){var a=this;b(".currency-tooltip-item",this.element).on("click",function(){a.getChildElement("dropdown").getWidget().close();var c=b(this).data("cur"),
e=b(".saveToProfile",a.dialog.element),f=b(".visitOnly",a.dialog.element);b(".currency_holder",a.dialog.element).html(c);a.dialog.open();f.on("click",function(){a.saveCurrency(c,!1)});if(a.options.isLoggedIn)e.on("click",function(){a.saveCurrency(c,!0)});else e.on("click",function(){d.authentication.showSignup({onclose:b.noop,success:function(){a.saveCurrency(c,!0)}})})})}})})(window.R9,window.jq||window.jQuery);(function(a){a.createComponentClass("common.layout.Footer",{options:{isSeo:!1,loadContent:!1},init:function(){this.options.loadContent&&a.ajax.execute("common/layout/AjaxFooterLinks",{type:"GET",data:{id:this.id(),isSeo:this.options.isSeo},replace:!0})},addEventHandlers:function(){var b=this;a.question.answer("footer.offset",function(){return b.element.position()});a.events.subscribe("footer.show",function(){b.element.show()});a.events.subscribe("footer.hide",function(){b.element.hide()});a.events.publish("footer.init")}})})(R9);(function(a,d){a.createComponentClass("common.layout.Header",{stateClasses:{results:"results"},options:{ajaxNavMenu:!1,activeVertical:null,pageType:null},init:function(){this.options.ajaxNavMenu&&this.loadNavMenu()},addEventHandlers:function(){var b=this;b.element.find("#myAccount").click(function(c){c.stopPropagation();a.events.publish("header.account.clicked",{})});a.events.subscribe(["header.view.set","pageContainers.changed"],function(a){b.stateClasses[a.view]&&b.element.removeClass(function(a,
b){return(b.match(/vm\-(\S)*/)||[]).join(" ")}).addClass("vm-"+a.view)})},loadNavMenu:function(){a.ajax.execute("common/layout/NavMenu",{appendTo:this.getChildElement("navMenuContainer"),data:{includeContent:!0,redir:window.location.href,activeVertical:this.options.activeVertical,pageType:this.options.pageType}})}})})(R9,jQuery);(function(c,a){c.createComponentClass("common.layout.LanguagePicker",{dropdown:null,options:{currentLanguage:""},init:function(){},addEventHandlers:function(){var e=this,d=a(".language-label").on("click",function(){var b=a(this);b.hasClass("language-label-show")?b.removeClass("language-label-show"):b.addClass("language-label-show")});a("body").on("click",function(b){a(b.target).hasClass("language-label")||d.removeClass("language-label-show")});a(".languageLink").on("click",function(b){b.preventDefault();
d.removeClass("language-label-show");a(this).attr("data-lang")!==e.options.currentLanguage&&(window.location=a(this).attr("data-href"))});a(".language-picker .language-label").off("click.tracker").on("click.tracker",function(){c.Analytics.api.trackEvent({subPageId:"main",category:"langpicker/click"})});a(".language-tooltip-item").off("click").on("click",function(){jq(this).hasClass("active")||c.Analytics.api.trackEvent({subPageId:"main",category:"setlanguage/"+jq(this).data("lang")})})}})})(window.R9,
window.jq||window.jQuery);(function(a,d){a.createComponentClass("common.layout.MoreNavMenuContent",{options:{staticSignInEnabled:!1,flightTrackerV3Enabled:!1,parentId:void 0},loggingPrefix:"MoreNavMenuContent",init:function(){this.base();this.getChildElement("more-magazine").attr("target","_blank")},addEventHandlers:function(){var b=this;b.getChildElement("more-login").click(function(){b.options.staticSignInEnabled?a.authentication.showDefault({promoType:"all"}):a.config.getBoolean("ui.pushsocial.enabled",!1)?a.authentication.social.showSocialLogin():
a.authentication.showLogin()});b.getChildElement("more-logout").click(function(){a.Social.WebCredentials.requireUserMediation();document.location="/k/ident/signout?redir\x3d"+encodeURIComponent(window.location.pathname)});d(b.element).find("a").on("click",function(){a.Analytics.api.trackEvent({category:b.loggingPrefix,action:"click",label:d(this).attr("class")})});b.options.flightTrackerV3Enabled&&b.getChildElement("more-flighttracker").click(function(e){e.preventDefault();var c="#"+b.options.parentId+
"-navMoreMenu";e=d(c);c=d(c+"_content");0!==e.length&&0!==c.length&&(e.removeClass("open"),c.removeClass("open"));a.events.publish("menu.flightracker.click")})}})})(R9,jQuery);(function(a,f){a.createComponentClass("common.layout.NavLink",{loggingPrefix:"NavLink",openedSwindleTab:!1,options:{url:null,active:!1,verticalName:null},addEventHandlers:function(){var b=this;b.element.on("click",function(){a.Analytics.api.trackEvent({category:b.loggingPrefix,action:"click",label:b.options.verticalName})});if((!a.config.getBoolean("ui.no.popup.enabled",!1)||"notloggedin"===a.globals.analytics.loginState)&&a.config.getBoolean("ui.search.swindle.enabled",!0)&&a.config.getBoolean("ui.search.swindle."+
b.options.verticalName+".enabled",!0)&&(!a.config.getBoolean("ui.suppress.swindle",!1)||a.config.getBoolean("ui.suppress.swindle",!1)&&!a.storage.get("suppress_swindle")))b.element.on("click",function(d){var c=a.storage.get("lastSwindleClick"),e=a.config.getInt("ui.search.swindle.expiration",864E5);if(("/"===document.location.pathname||"/hotels"===document.location.pathname)&&!b.options.active&&(!c||c+e<Date.now()))return a.storage.set("lastSwindleClick",Date.now()),a.events.publish("swindleTab.activated"),
window.open(b.options.url,"_blank"),d.preventDefault(),!1})}})})(R9,jQuery);(function(a,d){a.createComponentClass("common.layout.NavMenu",{dropdown:null,options:{isLoggedInUser:!1,signInOutLink:"",includeContent:!1,showEmailLogin:!1,staticSignInEnabled:!1},init:function(){var b=this;window.showAlertRegRedirect=function(c){if(b.options.isLoggedInUser)window.location="/alerts";else{var e={onclose:d.noop,success:function(){b.options.isLoggedInUser=!0;window.location="/alerts"}};a.config.getBoolean("ui.sheep.campaign.pricealert.enabled",!1)&&c&&(e.promo=c);b.options.staticSignInEnabled?
a.authentication.showDefault({promoType:"all"}):a.config.getBoolean("ui.pushsocial.enabled",!1)?a.authentication.social.showSocialLogin(e):a.authentication.showSignup(e)}};this.options.includeContent||this.loadNavContent()},addEventHandlers:function(){var b=this;this.getChildElement("login").click(function(c){d("body").click();a.Social.WebCredentials.trySignIn(function(){b.options.staticSignInEnabled?a.authentication.showDefault({promoType:"all"}):a.config.getBoolean("ui.pushsocial.enabled",!1)&&
!b.options.showEmailLogin?a.authentication.social.showSocialLogin():a.authentication.showLogin()});c.preventDefault()});this.getChildElement("signup").click(function(b){d("body").click();a.authentication.showSignup({promoType:"all"});b.preventDefault()});this.getChildElement("login-icon").click(function(){a.Social.WebCredentials.trySignIn(function(){b.options.staticSignInEnabled?a.authentication.showDefault({promoType:"all"}):a.config.getBoolean("ui.pushsocial.enabled",!1)&&!b.options.showEmailLogin?
a.authentication.social.showSocialLogin():a.authentication.showLogin()})});this.getChildElement("more-logout").click(function(){a.Social.WebCredentials.requireUserMediation();document.location="/k/ident/signout?redir\x3d"+encodeURIComponent(window.location.pathname)});this.options.contentIncluded&&b.getChildElement("menuContent").find(".navmenu-more-login").click(function(){this.options.staticSignInEnabled?a.authentication.showDefault({promoType:"all"}):a.authentication.showLogin()});a.events.subscribe("DropdownDialog.open",
b.handleDropdownEvent.bind(b,!0));a.events.subscribe("DropdownDialog.close",b.handleDropdownEvent.bind(b,!1))},handleDropdownEvent:function(a,c){var b=this._id+"-dropdown";c.id&&c.id===b&&(a?d(this.element).addClass("active"):d(this.element).removeClass("active"))},loadNavContent:function(){a.ajax.execute("common/layout/NavMenuContent",{data:{signInOutLink:this.options.signInOutLink,loggedIn:this.options.isLoggedInUser,parentId:this.id()},appendTo:this.getChildElement("menuContent"),replace:!0})}})})(R9,
jQuery);(function(a,e){a.createComponentClass("common.layout.NavMenuContent",{options:{staticSignInEnabled:!1,flightTrackerV3Enabled:!1},addEventHandlers:function(){var b=this;b.getChildElement("more-login").click(function(){b.options.staticSignInEnabled?a.authentication.showDefault({promoType:"all"}):a.config.getBoolean("ui.pushsocial.enabled",!1)?a.authentication.social.showSocialLogin():a.authentication.showLogin()});b.getChildElement("more-logout").click(function(){a.Social.WebCredentials.requireUserMediation();
document.location="/k/ident/signout?redir\x3d"+encodeURIComponent(window.location.pathname)});b.options.flightTrackerV3Enabled&&a.globals.affiliate&&(0===a.globals.affiliate.indexOf("checkfelix")||0===a.globals.affiliate.indexOf("swoodoo"))&&b.getChildElement("more-flighttracker").click(function(d){d.preventDefault();var c="#"+b.options.parentId+"-navMenu";d=e(c);c=e(c+"_content");0!==d.length&&0!==c.length&&(d.removeClass("open"),c.removeClass("open"));a.events.publish("menu.flightracker.click")})}})})(R9,
jQuery);(function(b,e){b.createComponentClass("common.layout.NavMenuWhite","common.layout.NavMenu",{ajaxPath:"common/layout/NavMenuWhite",options:{tripsCount:0,alertsCount:0,showUpcomingTripNotification:!1},upcomingTripNotificationKey:"upcomingtrip-notification",upcomingTripDialog:void 0,init:function(){this.base();this.showUpcomingTripNotification()},addEventHandlers:function(){this.base();this.subscribe(["trips.add","trips.remove","trips.move.event.finished"],e.proxy(this.updateNotificationCount,this));
this.addUpcomingTripNotificationCloseHandler()},updateNotificationCount:function(){var a=this;b.ajax.execute(this.ajaxPath,{appendTo:a.element.parent(),replace:!0}).then(function(b){a.destroy()})},showUpcomingTripNotification:function(){var a=this;if(this.options.showUpcomingTripNotification){var d=b.storage.get(this.upcomingTripNotificationKey),c=!0;d&&(c=new Date,c.setDate(c.getDate()-3),(c=new Date(d)<c)&&b.storage.remove(this.upcomingTripNotificationKey));c&&(this.upcomingTripDialog=this.getChildElement("upcomingtrip-notification").getWidget(),
setTimeout(function(){a.upcomingTripDialog.open()},1E3))}},addUpcomingTripNotificationCloseHandler:function(){var a=this;this.options.showUpcomingTripNotification&&this.getChildElement("upcomingtrip-notification-close").off("click").click(function(){a.upcomingTripDialog.close();b.storage.set(a.upcomingTripNotificationKey,new Date)})}})})(R9,$);(function(a,b){a.createComponentClass("common.layout.PinnableBar",{placeholder:null,pinnedContent:null,pinned:!1,top:null,scrollPos:0,init:function(){this.placeholder=this.getChildElement("ph");this.pinnedContent=this.getChildElement("content");this.placeholder.height(this.pinnedContent.height())},addEventHandlers:function(){this.pinnedContent.mouseover(function(){a.events.publish("pinnableBar.mouseOver")}).mouseout(function(){a.events.publish("pinnableBar.mouseOut")}).click(function(){a.events.publish("pinnableBar.click")})},
inlineComponentsReady:function(){var c=this;a.question.answer("pinnedContent.height",function(){return c.placeholder.is(":visible")?c.placeholder.outerHeight():0});b(window).on("scroll",this.handleScroll.bind(this))},handleScroll:function(){this.top=this.element.offset().top;this.scrollPos=b(window).scrollTop();this.scrollPos>this.top&&!this.pinned?(this.pinned=!0,this.element.addClass("pinned"),a.events.publish("pinnableBar.pinnedChange",!0)):this.scrollPos<=this.top&&this.pinned&&(this.pinned=!1,
this.element.removeClass("pinned"),a.events.publish("pinnableBar.pinnedChange",!1))}})})(R9,jQuery);(function(a){a.createComponentClass("common.layout.SiteWideMessage",{redirectMessage:void 0,options:{redirectFromTo:void 0,redirectFromToAlt:void 0},init:function(){this.redirectMessage=new a.Common.RedirectMessage(this.id(),this.options.redirectFromTo,this.options.redirectFromToAlt)},addEventHandlers:function(){var b=this;b.redirectMessage.addEventHandlers();a.events.subscribe("frontdoor.view.changed",function(){b.redirectMessage.updateRedirectUrl()})}})})(R9);(function(a,d){a.createComponentClass("common.layout.StandardBody",{stateClasses:{results:"ResultsPageBody"},modalOverlay:null,init:function(){this.modalOverlay=this.getChildElement("modalOverlay")},addEventHandlers:function(){var b=this;a.events.subscribe("modalOverlay.visible",function(c){b.modalOverlay.toggleClass("OverlayVisible",c.open);c.event&&b.modalOverlay.click(function(){a.events.publish(c.event)})});b.modalOverlay.click(function(){d(this).removeClass("OverlayVisible")})}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.layout.TripsMenu",{tripsCounterEl:void 0,notificationTextCloseLink:void 0,tripsSummariesWrapper:void 0,tripsTextNotificationWrapper:void 0,tripsMenuContent:void 0,tripsMenuLink:void 0,tripsCounter:0,tripsMenuCloseInterval:null,tripsMenuOpenInterval:null,path:"common/layout/TripsMenu",closeDelay:300,openDelay:300,options:{tripsMenuTextNotificationKey:void 0,hasText:void 0,url:void 0,totalUpcomingTrips:void 0},init:function(){this.tripsCounterEl=this.getChildElement("tripsCounter");
this.tripsMenuLink=this.element.find(".TripsMenuItem");this.tripsMenuContent=this.getChildElement("tripsMenuContent");this.notificationTextCloseLink=this.getChildElement("notificationTextClose");this.tripsSummariesWrapper=this.getChildElement("tripsSummariesWrapper");this.tripsTextNotificationWrapper=this.getChildElement("tripsTextNotificationWrapper");this.initStickyHeader();this.tripsCounter=parseInt(this.tripsCounterEl.text())},addEventHandlers:function(){var a=this;this.subscribe("trips.add",
c.proxy(this.tripAdded,this));this.subscribe("trips.remove",c.proxy(this.tripRemoved,this));this.subscribe("trips.notificationTextClose",c.proxy(this.tripsTextNotificationClose,this));this.subscribe("trips.updateHeader",c.proxy(this.updateTripsHeader,this));(0<this.tripsCounter||0<this.options.totalUpcomingTrips)&&this.addMenuEventHandlers();this.notificationTextCloseLink.click(function(){b.events.publish("trips.notificationTextClose");setMetaCookie(a.options.tripsMenuTextNotificationKey,!0)})},initStickyHeader:function(){},
addMenuEventHandlers:function(){this.clearMenuEventHandlers();var a=this;this.tripsMenuLink.on("mouseenter",function(c){b.events.publish("trips.menu.open");a.tripsMenuOpenInterval=setTimeout(function(){a.tripsMenuContent.show();clearTimeout(a.tripsMenuCloseInterval)},a.openDelay)}).on("mouseleave",function(){clearTimeout(a.tripsMenuOpenInterval);a.tripsMenuCloseInterval=setTimeout(function(){a.tripsMenuContent.is(":visible")&&(a.tripsMenuContent.hide(),b.events.publish("trips.menu.close"))},a.closeDelay)});
this.tripsMenuContent.on("mouseenter",function(){clearTimeout(a.tripsMenuCloseInterval)}).on("mouseleave",function(){a.tripsMenuCloseInterval=setTimeout(function(){a.tripsMenuContent.is(":visible")&&(a.tripsMenuContent.hide(),b.events.publish("trips.menu.close"))},a.closeDelay)})},clearMenuEventHandlers:function(){this.tripsMenuLink.off("mouseenter mouseleave");this.tripsMenuContent.off("mouseenter mouseleave")},tripAdded:function(a){this.updateTripsHeader()},tripRemoved:function(a){this.updateTripsHeader()},
decreaseMenuCounter:function(){0>this.tripsCounter--&&(this.tripsCounter=0);this.tripsCounterEl.text(this.tripsCounter);0===this.tripsCounter&&this.disableBubble()},decreaseTripCounter:function(a){a=this.getTripById(a);0<a.length&&b.events.publish("trips.counter.decrease",{id:this.id("TripsCounter"+a.data("index"))})},increaseMenuCounter:function(){0===this.tripsCounter&&this.enableBubble();this.tripsCounter++;this.tripsCounterEl.text(this.tripsCounter)},increaseTripCounter:function(a){a=this.getTripById(a);
0<a.length?b.events.publish("trips.counter.increase",{id:this.id("TripsCounter"+a.data("index"))}):this.updateTripsHeader()},tripsTextNotificationClose:function(){this.tripsTextNotificationWrapper.remove();this.decreaseMenuCounter()},updateTripsHeader:function(){var a=this;b.ajax.execute(this.path,{data:{text:a.options.hasText,url:a.options.url},appendTo:a.element.parent(),replace:!0}).then(function(b){a.destroy()})},disableBubble:function(){this.tripsCounterEl.parent().hide();0===this.options.totalUpcomingTrips&&
(this.tripsMenuContent.hide(),this.clearMenuEventHandlers())},enableBubble:function(){this.tripsCounterEl.parent().show();this.addMenuEventHandlers()},getTripById:function(a){return this.tripsSummariesWrapper?this.tripsSummariesWrapper.find('*[data-tripId\x3d"'+a+'"]'):[]}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.layout.TripsShoppingCart",{tripsMenu:void 0,tripsCounterEl:void 0,notificationTextCloseLink:void 0,tripsSummariesWrapper:void 0,tripsTextNotificationWrapper:void 0,tripsMenuContent:void 0,tripsMenuLink:void 0,tripsMenuOpenClass:void 0,tripsCounter:0,tripsMenuCloseInterval:null,tripsMenuOpenInterval:null,path:"common/layout/TripsShoppingCart",closeDelay:300,openDelay:300,options:{tripsMenuTextNotificationKey:void 0,hasText:void 0,url:void 0,totalUpcomingTrips:void 0},
init:function(){this.tripsMenu=this.element.parent();this.tripsCounterEl=this.getChildElement("tripsCounter");this.tripsMenuLink=this.element.find(".colTripsIcon");this.tripsMenuContent=c(".TripsBubble");this.notificationTextCloseLink=this.getChildElement("notificationTextClose");this.tripsSummariesWrapper=this.getChildElement("tripsSummariesWrapper");this.tripsTextNotificationWrapper=this.getChildElement("tripsTextNotificationWrapper");this.initStickyHeader();this.tripsCounter=parseInt(this.tripsCounterEl.text());
this.tripsMenuOpenClass="dropdown-open"},addEventHandlers:function(){var a=this;this.subscribe("trips.add",c.proxy(this.tripAdded,this));this.subscribe("trips.remove",c.proxy(this.tripRemoved,this));this.subscribe("trips.notificationTextClose",c.proxy(this.tripsTextNotificationClose,this));this.subscribe("trips.updateHeader",c.proxy(this.updateTripsHeader,this));(0<this.tripsCounter||0<this.options.totalUpcomingTrips)&&this.addMenuEventHandlers();this.notificationTextCloseLink.click(function(){b.events.publish("trips.notificationTextClose");
setMetaCookie(a.options.tripsMenuTextNotificationKey,!0)})},initStickyHeader:function(){},addMenuEventHandlers:function(){this.clearMenuEventHandlers();var a=this;this.tripsMenuLink.on("mouseenter",function(c){b.events.publish("trips.menu.open");a.tripsMenuOpenInterval=setTimeout(function(){a.tripsMenu.addClass(a.tripsMenuOpenClass);clearTimeout(a.tripsMenuCloseInterval)},a.openDelay)}).on("mouseleave",function(){clearTimeout(a.tripsMenuOpenInterval);a.tripsMenuCloseInterval=setTimeout(function(){a.tripsMenuContent.is(":visible")&&
(a.tripsMenu.removeClass(a.tripsMenuOpenClass),b.events.publish("trips.menu.close"))},a.closeDelay)});this.tripsMenuContent.on("mouseenter",function(){clearTimeout(a.tripsMenuCloseInterval)}).on("mouseleave",function(){a.tripsMenuCloseInterval=setTimeout(function(){a.tripsMenuContent.is(":visible")&&(a.tripsMenu.removeClass(a.tripsMenuOpenClass),b.events.publish("trips.menu.close"))},a.closeDelay)})},clearMenuEventHandlers:function(){this.tripsMenuLink.off("mouseenter mouseleave");this.tripsMenuContent.off("mouseenter mouseleave")},
tripAdded:function(a){this.updateTripsHeader()},tripRemoved:function(a){this.updateTripsHeader()},decreaseMenuCounter:function(){0>this.tripsCounter--&&(this.tripsCounter=0);this.tripsCounterEl.text(this.tripsCounter);0===this.tripsCounter&&this._disableBubble()},decreaseTripCounter:function(a){a=this._getTripById(a);0<a.length&&b.events.publish("trips.counter.decrease",{id:this.id("TripsCounter"+a.data("index"))})},increaseMenuCounter:function(){0===this.tripsCounter&&this._enableBubble();this.tripsCounter++;
this.tripsCounterEl.text(this.tripsCounter)},increaseTripCounter:function(a){a=this._getTripById(a);0<a.length?b.events.publish("trips.counter.increase",{id:this.id("TripsCounter"+a.data("index"))}):this.updateTripsHeader()},tripsTextNotificationClose:function(){this.tripsTextNotificationWrapper.remove();this.decreaseMenuCounter()},updateTripsHeader:function(){var a=this;b.ajax.execute(this.path,{data:{text:a.options.hasText,url:a.options.url},appendTo:a.element.parent(),replace:!0}).then(function(b){a.destroy()})},
_disableBubble:function(){0===this.options.totalUpcomingTrips&&(this.tripsMenuContent.hide(),this.clearMenuEventHandlers())},_enableBubble:function(){this.addMenuEventHandlers()},_getTripById:function(a){return this.tripsSummariesWrapper?this.tripsSummariesWrapper.find('*[data-tripId\x3d"'+a+'"]'):[]}})})(R9,jQuery);(function(c,n){c.extend("common.layout.Header.prototype",{showOverlays:!1,activeBreakpoint:null,lastBreakpoint:null,colLogo:null,colVerticals:null,verticals:null,colUtils:null,resizing:!1,guardTimeout:null,guardInterval:null,exclude:null,navMenuGridVerticals:null,breakpoints:[["",0,"black"],["-xs",320,"yellow"],["-s",568,"blue"],["-m",768,"red"],["-l",1024,"cyan"],["-l",1040,"magenta"],["-xl",1280,"purple"]],init:function(){var a=this;this.options.ajaxNavMenu&&this.loadNavMenu();c.config.getBoolean("ui.smart-responsive-header.enabled",
!1)&&(this.exclude=".col-bucket-menu",this.colLogo=jq(".col-logo"),this.colVerticals=jq(".col-verticals"),this.verticals=jq(".verticalsGrid").children().not(this.exclude),this.excludeVerticals=jq(this.exclude),this.colUtils=jq(".col-utils"),this.navMenuGridVerticals=jq(".navMenuGrid").children().first().children().children(),this.verticals.each(function(){jq(this).data("original-classes",jq(this).attr("class"))}),this.navMenuGridVerticals.each(function(){jq(this).data("original-classes",jq(this).attr("class"))}),
jq(window).on("resize",function(){a.setActiveBreakpoint(jq(window).width());a.activeBreakpoint!=a.lastBreakpoint&&(clearTimeout(a.guardTimeout),a.lastBreakpoint=a.activeBreakpoint,a.resizing||(a.resizing=!0,a.guard()),a.guardTimeout=setTimeout(function(){a.resizing=!1;cancelAnimationFrame(a.guardInterval)},1E3))}))},guard:function(){var a=this;this.resizing&&(this.guardInterval=requestAnimationFrame(function(){a.guard()}));jq(".debug-vertical-div").remove();this.verticals.each(function(){jq(this).attr("class",
jq(this).data("original-classes"))});this.navMenuGridVerticals.each(function(){jq(this).attr("class",jq(this).data("original-classes"))});for(var b=a.colLogo.offset().left,l=jq("#logo").offset().left,h=a.colLogo.outerWidth(),k=a.colUtils.offset().left,g=a.colUtils.outerWidth(),c=parseInt(jq(".keel-container").css("padding-left")),d=0;d<a.breakpoints.length;d++)a.printDebugDiv(0,l-c,a.breakpoints[d][1],300,a.breakpoints[d][2],.1);a.printDebugDiv(0,b,h,57,"orange",.3);var m=0;a.excludeVerticals.each(function(){m+=
jq(this).outerWidth()});a.verticals.each(function(){var b=a.verticals.offset().left+jq(this).position().left+parseInt(jq(this).css("padding-left")),d=jq(this).outerWidth();a.printDebugDiv(0,b,d,57,"pink",.3);for(var e=!1,f=0;f<a.breakpoints.length;f++)!e&&l-c+a.breakpoints[f][1]>=b+d+g+m&&(jq(this).addClass("col-vertical"+a.breakpoints[f][0]),(e=jq(this).attr("class").match(/\w+Col/))&&e.length&&a.navMenuGridVerticals.filter("."+e[0]).addClass("col-hidden"+a.breakpoints[f][0]),e=!0)});a.printDebugDiv(0,
k,g,57,"green",.3);this.verticals.addClass("col-hidden");jq(window).trigger("resize")},setActiveBreakpoint:function(a){for(var b=0;b<this.breakpoints.length;b++)a>=this.breakpoints[b][1]&&(this.activeBreakpoint=this.breakpoints[b][1])},printDebugDiv:function(a,b,c,h,k,g){this.showOverlays&&jq("body").append(jq(document.createElement("div")).attr("class","debug-vertical-div").css({position:"absolute",top:a,left:b,width:c,height:h,"background-color":k,opacity:g,border:"1px solid red"}))}})})(R9,jQuery);(function(g,f,h){g.publish("common.maps.Geocoding",h.extend({_channel:null,_context:null,loggingBase:"/common/maps/Geocoding/",_data:{location:null,postalCode:null,address:null,addressNickname:null,lat:null,lng:null,isAddress:!1},constructor:function(a,b){this._channel=a;this._context="string"===typeof b?b:null},initGeocoder:function(a){var b=f.Deferred(),c;c="initialize/"+(g.Maps.Google.isLoaded()?"already_loaded":"api_request_made");g.Maps.Google.load(function(){b.resolve(new google.maps.Geocoder)},
this._channel);this.logAnalytics(c,"undefined"!==typeof a?a:null);return b.promise()},clear:function(){for(var a in this._data)this._data.hasOwnProperty(a)&&(this._data[a]=null)},getLastResult:function(){return this._data},makeRequest:function(a,b){var c=this,e=f.Deferred();this.initGeocoder().then(function(d){c.logAnalytics("findAddress/api_request_started",b);d.geocode({address:a},function(a,d){d===google.maps.GeocoderStatus.OK?(c.logAnalytics("findAddress/api_request_successful",b),c.formatGeometry(a),
e.resolve(c.getLastResult(),b)):(c.logAnalytics("findAddress/api_request_failed",b,"string"===typeof d?{status:"/"+d}:null),e.reject(d))})});return e.promise()},findAddress:function(a,b,c){var e=this,d=f.Deferred();this.makeRequest(a).then(function(a){e.parseResult(a,b,c)}).then(function(){d.resolve(e.getLastResult())});return d.promise()},parseResult:function(a,b,c){this._data.isAddress=!1;var e=this.getValidatedPlace(a,b);if(e){this._data.location=e.formatted_address;b=this.getAddressFragments(e,
c);this._data.location="US"===b.country||"CA"===b.country?b.city+","+b.state+","+b.country:b.city+","+b.country;var e=e.formatted_address.split(", "),d=e.length;b="US"===b.country||"CA"===b.country?3:2;d<b?this.logAnalytics("parseResult/location_length_too_short",c):(this._data.isAddress=!0,d>=b+1&&(this._data.address=e[d-b-1]),d>=b+2&&(this._data.addressNickname=e[0]),this.formatGeometry(a),this.logAnalytics("parseResult/success",c))}else this.logAnalytics("parseResult/invalid_result",c)},getValidatedPlace:function(a,
b){a=f.isArray(a)?a[0]:a||{};var c=["street_address","premise","route"];if(!a||!a.formatted_address||b&&0<=c.indexOf(a.types[0]))a=null;return a},getAddressFragments:function(a,b){for(var c={city:null,state:null,country:null},e=0;e<a.address_components.length;e++)for(var d=a.address_components[e],f=0;f<d.types.length;f++){var g=d.types[f];if("country"===g){c.country="US"===d.short_name||"UK"===d.short_name?d.short_name:d.long_name;break}else if("administrative_area_level_1"===g){c.state=d.short_name;
break}else if("locality"===g){c.city=d.long_name;break}else if("postal_code"===g){this._data.postalCode=d.long_name;break}}return"undefined"===typeof c.country||"undefined"===typeof c.city?(this.logAnalytics("parseResult/invalid_country_or_city",b),null):c},formatGeometry:function(a){a=f.isArray(a)?a[0]:a||{};var b={};if(a.geometry&&a.geometry.location){b.lat=a.geometry.location.lng();b.lng=a.geometry.location.lat();var c=a.geometry.bounds||a.geometry.viewport||null;if(c){var e=c.getNorthEast(),c=
c.getSouthWest();b.bounds={neBounds:{lat:e.lat(),lng:e.lng()},swBounds:{lat:c.lat(),lng:c.lng()}}}}this._data=f.extend({},a,b)},logAnalytics:function(a,b,c){a={category:this.loggingBase+a,channel:this._channel,parentComponent:this._context};"undefined"!==typeof b&&(a.callerComponent=b);"object"===typeof c&&(a=f.extend(a,c));g.Analytics.api.trackEvent(a)}}))})(R9,jQuery,base2.Base);(function(e,g){e.createComponentClass("common.maps.NearbyTransitDialog",{placesService:null,transitDialog:null,destroyed:!1,placeTypesToDisplay:["subway_station","train_station"],templates:{dialogContent:"dialogContent",googleAttribution:"googleAttribution"},options:{latitude:null,longitude:null,isMetricDistance:!1,proximityMessages:{shortUnits:"",longUnits:""},locationFormatString:"%l",distanceFormatString:"%d"},inlineComponentsReady:function(){this.options.latitude&&this.options.longitude&&e.events.when("hotels.results.search.finished",
this.initDialog.bind(this))},initDialog:function(){var a=this,b=this;e.events.when("horizon.hotels.maps.placesService.loaded",function(c){if(!b.destroyed){var d=a.setupRequest();b.placesService=c;b.placesService.searchNearby(d).then(b.createDialog.bind(b,d))}})},createDialog:function(a,b){this.destroyed||(a=this.sortResults(a,b),a=this.filterResults(a),0<a.length&&(a=this.generateTransitHtml(a),this.renderDialog(a)))},setupRequest:function(){var a=new google.maps.LatLng(this.options.latitude,this.options.longitude);
if(a&&a.lat()&&a.lng())return{location:a,radius:"2000",types:this.placeTypesToDisplay,rankBy:google.maps.places.RankBy.DISTANCE}},sortResults:function(a,b){return b.map(function(c){c.distance=google.maps.geometry.spherical.computeDistanceBetween(a.location,c.geometry.location);return c}).sort(function(a,b){return(a.distance||-1)-(b.distance||-1)})},filterResults:function(a){var b=a.map(function(a){return a.name});return a.filter(function(a,d){var c=null;b.some(function(b,d){return a.name.includes(b)||
b.includes(a.name)?(c=d,!0):!1});return c===d}).slice(0,4)},generateTransitHtml:function(a){var b=this,c=e.template.renderElement(this.templates.dialogContent),d=g("\x3cul\x3e").addClass("transitList"),f=this.generateAttributionHtml(a);a.forEach(function(a){var c=b.getNearbyMessage(a.distance,a.name),f=g("\x3cli\x3e").addClass("nearbyItem").attr("id",a.id).data("place",a.name);f.append("\x3cspan\x3e").addClass("nearbyName").html(a.name);f.append("\x3cspan\x3e").addClass("nearbyDistance").html(c);
d.append(f)});c.append(d);c.append(f);return c},generateAttributionHtml:function(a){var b=g("\x3cdiv\x3e").addClass("attribution"),c=e.template.renderElement(this.templates.googleAttribution);a=a.reduce(function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",b=arguments[1];return b.html_attributions&&b.html_attributions.length&&!a.includes(b.html_attributions)?a+b.html_attributions.concat():a},"");b.append(a);b.append(c);return b},getNearbyMessage:function(a,b){var c;500>a?(a=(this.options.isMetricDistance?
a:1.0936133*a).toFixed(0),c=this.options.proximityMessages.shortUnits):(a=Math.round(100*(this.options.isMetricDistance?.001*a:6.21371192E-4*a))/100,c=this.options.proximityMessages.longUnits);return this.replaceTemplatePlaceholders(c,b,a)},replaceTemplatePlaceholders:function(a,b,c){a=a.replace(this.options.locationFormatString,b);return a=a.replace(this.options.distanceFormatString,c)},renderDialog:function(a){a&&(this.transitDialog=this.element.toolTip({content:a,extraClass:"Common-Maps-NearbyTransitDialog-tooltip looseMaxWidth",
position:"right",showImmediately:!1,closeOnBodyClick:!1,keepOpenOnContentHover:!0,closeDelay:1E3}),this.element.removeClass("empty"))},destroy:function(){this.destroyed=!0;this.base()}})})(R9,$);(function(e){function d(a){this.nearbySearchRadius=600;if(!a.map)throw Error("PlacesService requires a Google Map Object to initialize");if(window.google&&window.google.maps)this.map=a.map,this.statusCode=google.maps.places.PlacesServiceStatus,this.service=new google.maps.places.PlacesService(this.map);else throw Error("Cannot initialize PlacesService. Google Maps cannot be found.");this.asyncReqQueue=new e.utils.AsyncRequestQueue({})}function g(a){if(!a.map)throw Error("PlacesService requires a Google Map Object to initialize");
var b=a.map.getDiv();return b?(f[b]||(f[b]=new d(a)),f[b]):null}var f={};d.prototype.searchNearby=function(a){var b=a.location,c=a.radius||this.nearbySearchRadius;a=a.types;var h=this;if(!b||!a)throw Error("Illegal Arguments. Please specify a valid location and types to search");return this.asyncReqQueue.createRequest(function(a,b,c){return function(d){h.service.nearbySearch({location:a,radius:b,types:c},function(a,b){h.processResult(a,b,d)});return d}}(b,c,a))};d.prototype.getPlaceDetails=function(a){var b=
this;if("undefined"===typeof a)throw Error("Illegal Arguments. Please provide a valid placeId");return this.asyncReqQueue.createRequest(function(a){return function(c){b.service.getDetails({placeId:a},function(a,d){b.processResult(a,d,c)});return c}}(a))};d.prototype.processResult=function(a,b,c){b===this.statusCode.OK?c.resolve(a):b===this.statusCode.OVER_QUERY_LIMIT?c.reject(this.asyncReqQueue.REQUEUE):b===this.statusCode.ZERO_RESULTS?c.resolve([]):c.reject(b)};e.publish("maps.PlacesService.getInstance",
g);e.events.ready("maps.PlacesService.initialized",g)})(R9);R9.events.when("common.maps.dependencies.loaded",function(){R9.Common.Widgets.Maps.InfoWindows.InfoWindowFactory.registerProduct("SEMTopAttractionDetails",{getMapElement:function(){return jq(".map")},selectLandmark:function(a){var b=this.getMapElement();b.find(".attractions .selected").removeClass("selected");b.find(".attractions [data-id\x3d"+a+"]").addClass("selected")},createProduct:function(a,b){jq.extend({},{},b);b=a.getData();var f=jq.extend(new R9.Common.Widgets.Maps.InfoWindows.Types.InfoWindowTypeBase,
{getMarker:function(){return a},getClass:function(){return"infoWindowBoxhotelMiniDetails SEMTopAttractionDetails clearfix"},canClose:function(){return c},getView:function(){return e}}),c=!0,e=jq("\x3cdiv/\x3e",{"class":"resultWrapper defaultWrapper"}).mouseenter(function(){c=!1}).mouseleave(function(){c=!0}),d=a.getData().getName?a.getData().getName():a.getData().name,d=jq("\x3cdiv/\x3e",{id:R9.Common.Utils.getId(),"class":"placeName",html:d});e.append(d);this.selectLandmark(b.getId());return f}})});(function(a,b){a.createComponentClass("common.maps.SinglePinpointMap",{map:void 0,mapElement:void 0,marker:void 0,options:{lat:void 0,lng:void 0,mapZoomLevel:void 0},init:function(){a.events.ready("common.maps.dependencies.loaded");this.mapElement=b("#"+this.id("map")).get(0);a.Maps.Google.load(b.proxy(this.initMap,this))},initMap:function(){var a={lat:this.options.lat,lng:this.options.lng};this.map=new google.maps.Map(this.mapElement,{zoom:this.options.mapZoomLevel,center:a,scrollwheel:!1,mapTypeControl:!1,
panControl:!1,scaleControl:!1,streetViewControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM}});this.marker=new google.maps.Marker({position:a,map:this.map})}})})(R9,jQuery);(function(d,e){R9.createComponentClass("common.maps.Styles",{init:function(){var b={BrownStyle:{styles:[{featureType:"landscape.man_made",elementType:"geometry",stylers:[{hue:"#996600"},{lightness:-10}]},{featureType:"administrative",elementType:"geometry",stylers:[{hue:"#996600"},{lightness:-10}]},{featureType:"poi.park",elementType:"geometry",stylers:[{hue:"#669900"},{lightness:-19}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#0099ff"},{lightness:43}]},{featureType:"poi.government",
elementType:"geometry",stylers:[{saturation:-100},{lightness:-15}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{saturation:-100},{lightness:-15}]},{featureType:"poi.attraction",elementType:"geometry",stylers:[{saturation:-100},{lightness:-15}]},{featureType:"poi.place_of_worship",elementType:"geometry",stylers:[{saturation:-100},{lightness:-15}]},{featureType:"poi.school",elementType:"geometry",stylers:[{saturation:-100},{lightness:-15}]},{featureType:"poi.sports_complex",elementType:"geometry",
stylers:[{saturation:-100},{lightness:-15}]},{featureType:"road.highway",elementType:"geometry",stylers:[{lightness:38}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{lightness:38}]}]},Satellite:{styles:[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#cdd9ea"},{saturation:-20}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#95abcc"},{lightness:15}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{saturation:-20},
{color:"#cdd9ea"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#eeeeee"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#e4e4e4"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#e4e4e4"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},{featureType:"poi.government",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},
{featureType:"poi.medical",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#e5e9db"}]},{featureType:"poi.place_of_worship",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},{featureType:"poi.school",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},{featureType:"poi.sports_complex",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#686868"}]},
{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#e4e4e4"},{visibility:"off"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#a8a8a8"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#e4e4e4"},{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#686868"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#e4e4e4"}]},{featureType:"poi",elementType:"labels.icon",
stylers:[{saturation:-100},{lightness:10},{gamma:1}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#686868"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#e4e4e4"},{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{saturation:-100},{lightness:20}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#c8c8c8"},{weight:1}]},{featureType:"administrative.land_parcel",stylers:[{color:"#e4e4e4"}]}]}};
this.getStyle=function(a,c){return new google.maps.StyledMapType(a&&b[a]&&b[a].styles,{name:c||a})}}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.marketing.Features",{unfold_speed:500,init:function(a){this.view=a},addEventHandlers:function(){a.events.subscribe("marketing.promotion.toggle",b.proxy(this.toggleView,this))},toggleView:function(){b(this.view).slideToggle(this.unfold_speed)}})})(window.R9,window.jQuery);(function(a,b){a.createComponentClass("common.marketing.MarketingFooterDisclaimers",{addEventHandlers:function(){var a=this;this.getChildElement("toggleInfo").click(function(){a.getChildElement("pricingInfo").toggleClass("visible")})}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.mobile.Dialog",{dialog:null,body:null,title:null,back:null,count:null,options:{url:null,name:null,title:null,closeOnSelection:!1,requestOnce:!1,countStringId:null,fixedHeader:!1},requested:!1,data:null,init:function(){this.dialog=this.element.dialog({onClose:this.onClose.bind(this)}).getWidget();this.body=this.getChildElement("contents");this.title=this.getChildElement("title");this.back=this.getChildElement("back");this.count=this.getChildElement("count")},
addEventHandlers:function(){this.subscribe("horizon.mobile."+this.options.name+".show",$.proxy(this.open,this));this.subscribe("horizon.mobile."+this.options.name+".hide",$.proxy(this.close,this));this.subscribe("horizon.mobile."+this.options.name+".itemOpened",$.proxy(this.itemOpened,this));this.subscribe("horizon.mobile."+this.options.name+".itemClosed",$.proxy(this.itemClosed,this));this.count&&this.subscribe("resultspage.results.count.changed",this.updateCounts.bind(this));this.handleWindowResizeEvent();
$(window).resize(this.handleWindowResizeEvent.bind(this))},open:function(a){var c=this;(this.data=a)||(a={});a.isAjax=!0;a.closeOnSelection=this.options.closeOnSelection;this.options.url&&!this.requested&&(c.element.addClass("Loading"),b.ajax.execute(this.options.url,{data:a,appendTo:this.body,replace:!0}).then(function(){c.element.removeClass("Loading");c.requested=c.isRequestOnce()}),this.title.html(this.options.title?this.options.title:a.name));this.dialog.open();this.redrawSliders();setTimeout(this.dialog.calculateDimensions(),
1)},close:function(){this.dialog.close()},onClose:function(){if(this.isRequestOnce())return!1;this.body.html("");this.title.text("")},itemOpened:function(a){this.redrawSliders();this.title.html(a.title);this.back.removeClass("hidden");this.element.addClass("itemOpened");this.back.off("click").on("click",this.goBack.bind(this));this.title.off("click").on("click",this.goBack.bind(this))},itemClosed:function(){this.title.html(this.options.title?this.options.title:this.data.name);this.element.removeClass("itemOpened");
this.back.addClass("hidden");this.title.off("click")},updateCounts:function(a){d("span",this.count).html(a.filtered)},goBack:function(){this.itemClosed();b.events.publish("filters.goBack")},isRequestOnce:function(){return this.options.requestOnce},handleWindowResizeEvent:function(){this.dialog.isOpen()&&this.redrawSliders();!b.utils.presentation.isTablet()&&this.dialog.isOpen()&&this.dialog.close();this.adjustBody(this.isFixedHeader())},adjustBody:function(a){a?(a=this.title.parent().outerHeight(),
this.body.css("padding-top",a)):this.body.css("padding-top","")},redrawSliders:function(){b.events.publish("sliders.redraw")},isFixedHeader:function(){return this.options.fixedHeader&&b.utils.presentation.isMobile()}})})(R9,window.jq||window.jQuery);(function(a){a.createComponentClass("common.personalization.PersonalizationContent",{destination:$(),source:$(),init:function(){var b=this.getChildElement("personalizationGreeting");this.destination=b.data("destination");this.source=b.data("source");a.Analytics.api.trackEvent({category:"personalized-widget",action:"showingpersonalization",label:this.destination});a.Analytics.api.trackEvent({category:"personalized-widget",action:"datasource",label:this.source})}})})(R9);(function(c,a){c.createComponentClass("common.privacy.HeaderCookiesMessage",{options:{visible:!1,isBetterUX:!1},closeBtn:void 0,init:function(b){this.closeBtn=a("#"+this.id("close"));this.options.visible&&!this.options.isBetterUX&&this.element.slideDown("slow")},addEventHandlers:function(){if(this.options.isBetterUX)a(document).on("click",a.proxy(this.close,this));else this.closeBtn.bind("click",a.proxy(this.close,this))},close:function(){var b=this;this.logCookiesConsent(function(){b.element.slideUp("slow");
window.setMetaCookie("hideCookiesMessage",!0)});this.options.isBetterUX&&a(document).off("click",a.proxy(this.close,this))},logCookiesConsent:function(b){"undefined"!=typeof b&&b||(b=a.noop);c.ajax.execute("common/privacy/LogCookiesConsentAction",{data:{}}).then(b)}})})(window.R9,window.jQuery);(function(c,b){c.createComponentClass("common.promo.ImageTextPromo",{carouselInterval:null,isCarousel:!0,carouselDots:b(),next:b(),previous:b(),options:{slideInterval:5E3},init:function(){if(this.isCarousel=this.element.hasClass("carousel"))this.carouselDots=this.element.find(".dot"),this.next=this.element.find(".arrows .next"),this.previous=this.element.find(".arrows .previous"),this.startCarousel()},addEventHandlers:function(){var a;this.isCarousel&&(a=this,this.carouselDots.click(function(){var d=
b(this).attr("data-index");a.changeSlide(d,!0)}),this.next.click(function(){a.incrementSlide();a.stopCarousel()}),this.previous.click(function(){a.decrementSlide();a.stopCarousel()}))},changeSlide:function(a,b){this.element.find(".promoImage.active, .dot.active").removeClass("active");this.getChildElement("promoDot_%s".format(a)).addClass("active");this.getChildElement("promoImage_%s".format(a)).addClass("active");this.getChildElement("promoMessage_%s".format(a)).addClass("active");b&&this.stopCarousel()},
incrementSlide:function(){var a=parseInt(this.element.find(".dot.active").attr("data-index"))+1;a>=this.carouselDots.length&&(a=0);this.changeSlide(a)},decrementSlide:function(){var a=parseInt(this.element.find(".dot.active").attr("data-index"))-1;0>a&&(a=this.carouselDots.length-1);this.changeSlide(a)},startCarousel:function(){this.isCarousel&&(this.carouselInterval=setInterval(this.incrementSlide.bind(this),this.options.slideInterval))},stopCarousel:function(){clearInterval(this.carouselInterval)}})})(R9,
jq||jQuery);(function(b,c){b.createComponentClass("common.promo.LoveFlights",{options:{},init:function(){var a=this;b.events.subscribe(["resultspage.streaming.done"],function(){a.shouldShow()&&(a.position(),b.Analytics.api.trackEvent("love-flights/shown"),a.element.fadeIn(1E3))})},remember:function(){b.storage.isAvailable()&&b.storage.set("loveflights",!0)},shouldShow:function(){return b.storage.isAvailable()?!b.storage.get("loveflights"):!1},position:function(){var a=c(".vertical-hotels"),b=a.offset(),a=a.height();
this.element.css({top:b.top+a+"px",left:b.left+"px"})},addEventHandlers:function(){var a=this;a.element.find(".lf-close").on("click",function(){a.element.hide();a.remember()});a.element.find(".lf-goto").on("click",function(){a.element.hide();a.remember();b.Analytics.api.trackEvent("love-flights/click")});c(window).on("resize",function(){a.position()})}})})(R9,jq||jQuery);(function(b,d){b.createComponentClass("common.promo.NPSDialog",{init:function(){this.dialog=this.getChildElement("dialog").dialog().getWidget()},addEventHandlers:function(){var a=this,c=!0;b.config.getBoolean("ui.leavebehind-v3",!0)?b.events.subscribe("nps.show",function(){a.shouldShow()&&(a.saveLast(),b.storage.set("prevent-afterclick","prevent"),a.showDialog())}):b.events.subscribe(["resultspage.streaming.done","filters.changed","paginator.change","result.details.opened"],function(){function f(c){if(a.shouldShow())if(d("body").click(),
a.saveLast(),"click-no-details"===a.options.type||"click"===a.options.type)a.item=d(this),c.stopPropagation(),c.stopImmediatePropagation(),c.preventDefault(),a.showDialog();else if("leave"===a.options.type||"leave-no-details"===a.options.type)b.storage.set("prevent-afterclick","prevent"),a.showDialog()}var e=[];"hotel"===a.options.vertical?e=[".Common-Booking-HorizontalMultibookProvider .bookingLink",".cheapest",".bestButton",".Common-Booking-MultiBookDropdownItem.bookingLink a"]:"flight"===a.options.vertical&&
(e=".regular .Common-Booking-HorizontalMultibookProvider .bookingLink;.regular .cheapest;.regular .bestButton;.regular .Common-Booking-MultiBookDropdownItem.bookingLink a;.regular .clickout.book-price;.regular .clickout.book-provider;.regular button.book".split(";"));e=d(e.join(", "));if(!c)try{e.off("click",f)}catch(g){console.log(g)}c=!1;a.onFirst(e,"click",f)})},getTime:function(){return 2592E6},saveLast:function(){b.storage.isAvailable()&&b.storage.set("nps-last-shown",(new Date).getTime())},
shouldShow:function(){this.shown=!b.storage.isAvailable()||null!=b.storage.get("nps-last-shown")&&(new Date).getTime()-parseInt(b.storage.get("nps-last-shown"))<this.getTime();return!this.shown},showDialog:function(){var a=this;a.dialog.open();b.Analytics.api.trackEvent("nps/impression");d(".nps-score-bubble").on("click",function(){var c=d(this),b=c.data("score");d(".nps-score-bubble").removeClass("nps-score-bubble-active");c.addClass("nps-score-bubble-active");6<b&&9>b||"click-no-details"===a.options.type||
"leave-no-details"===a.options.type?(a.recordScore(b,"none"),a.afterDialog()):d(".nps-feedback").show()});d(".nps-button").on("click",function(b){b=d(".nps-score-bubble.nps-score-bubble-active").data("score");var c=d(".nps-feedback:visible .nps-feedback-area").val();a.recordScore(b,c||"none");a.afterDialog()})},recordScore:function(a,c){b.action.execute("common/promo/SaveNPS",{vertical:this.options.vertical,text:c,score:a},function(a){})},afterDialog:function(){this.item&&(this.item[0].click(),this.item=
null);this.dialog.close()},onFirst:function(a,b,f){a.each(function(){d(this).on(b,f);var a=d._data(this,"events")[b];a.splice(0,0,a.pop())})}})})(R9,jq||jQuery);(function(b,e){b.createComponentClass("common.promo.SignupOverlay",{init:function(){},addEventHandlers:function(){var c=window.location.href,d=b.config.getString("ui.signup.promotion.regex","");if(""===d||!(new RegExp(d)).test(c)){var a=this;if(!a.options.loggedIn&&0===e(".better-landing-ux:visible div").length&&!a.options.shouldHide){var f=e(window);b.Analytics.api.trackEvent("signup/overlay/impression");a.element.show();a.startSlideshow();a.footerHider();a.getChildElement("signin").on("click",function(){b.Analytics.api.trackEvent("signup/overlay/click/signin");
b.authentication.showLogin({success:function(){b.Analytics.api.trackEvent("signup/overlay/success/signin");a.element.css("display","none");a.hider&&f.off("scroll",a.hider);window.location.reload(!0)}})});a.getChildElement("signup").on("click",function(){b.Analytics.api.trackEvent("signup/overlay/click/signup");b.authentication.showSignup({success:function(){b.Analytics.api.trackEvent("signup/overlay/success/signup");a.element.css("display","none");a.hider&&f.off("scroll",a.hider);window.location.reload(!0)}})});
e(".so-hide").on("click",function(){b.Analytics.api.trackEvent("signup/overlay/click/hide");setMetaCookie("SIGNUP_OVERLAY_HIDE","true");a.hider&&f.off("scroll",a.hider);a.element.css("display","none")})}}},startSlideshow:function(){var c=e(".so-slides .so-slide"),d=0;1<c.length&&setInterval(function(){e(c[d]).removeClass("active");d++;d===c.length&&(d=0);e(c[d]).addClass("active")},5E3)},footerHider:function(){var c=e(window),d=e("body"),a=this.element,b=!1;this.hider=function(){!b&&c.scrollTop()+
c.height()>=d.height()-60?(b=!0,a.hide("slow")):b&&c.scrollTop()+c.height()<d.height()-60&&(b=!1,a.show("slow"))};c.on("scroll",this.hider)}})})(R9,jq||jQuery);(function(c,d){c.createComponentClass("common.promo.WhyFeedback",{options:{},init:function(){this.shouldShow()&&(this.position(),this.element.show())},remember:function(){c.storage.isAvailable()&&c.storage.set("whyfeedback",!0)},shouldShow:function(){return c.storage.isAvailable()?!c.storage.get("whyfeedback"):!1},position:function(){var a=d(".vertical-hotels"),b=a.offset(),a=a.height();this.element.css({top:b.top+a+"px",left:b.left+"px"})},submit:function(){var a=this,b=a.element.find("form .wf-textarea").val();
0===b.length&&(b="none");c.action.execute("common/promo/SaveWhyFeedback",{type:a.element.find("form input[name\x3dfeedback]:checked").val(),text:b},function(b){a.remember()})},addEventHandlers:function(){var a=this;d("body").on("click",function(){a.element.hide()});a.element.find(".wf-close").on("click",function(){a.element.hide();a.remember()});this.element.on("click",function(a){a.stopPropagation()});a.getChildElement("i_like_it").on("click",function(){a.submit();a.element.hide()});a.getChildElement("dont_know").on("click",
function(){a.submit();a.element.hide()});a.getChildElement("dont_use").on("click",function(){a.element.find(".step1").hide();a.element.find(".step2").show()});a.element.find("form").on("submit",function(b){b.preventDefault();a.element.hide();a.submit()});d(window).on("resize",function(){a.position()})}})})(R9,jq||jQuery);(function(a,e){a.createComponentClass("common.results.filters.admin.ProviderDebuggingPanel",{options:{filterId:null},addEventHandlers:function(){var c=this.getChildElement("providerDataSection"),d=e(document.getElementById(this.options.filterId)),b=this;b.getChildElement("show-all-rank-debug").click(function(){a.events.publish("common.result.admin.rankingdebug.show",{})});b.getChildElement("hide-all-rank-debug").click(function(){a.events.publish("common.result.admin.rankingdebug.hide",{})});this.subscribe("searchform.submit",
function(){a.ComponentManager.remove(b.id())});this.getChildElement("type").radioButtonSet({change:function(b){"filters"===b.value?(c.addClass("hidden"),d.removeClass("hidden")):(c.removeClass("hidden"),d.addClass("hidden"));a.events.publish("filterTab.changed")}})}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.results.filters.admin.ProviderFilter","common.results.filters.ValueSetFilter",{countsEl:null,init:function(){this.base();c("\x3cdiv class\x3d'countsMessage'\x3e\x3c/div\x3e").insertAfter(this.element.find(".filterHead"));this.countsEl=this.element.find(".countsMessage")},update:function(a){this.base(a);this.countsEl.html(a.searchedProvidersMessage)}})})(R9,jQuery);(function(e,f){e.createComponentClass("common.results.filters.admin.TrueProviderFilter","common.results.filters.Filter",{chosenProvider:null,dropdown:null,infoContainer:null,init:function(){var a=this;this.base();this.dropdown=this.getChildElement("dropdown").dropdown({change:function(){a.chosenProvider=this.getValue();a.pushStateChange()}}).getWidget();this.infoContainer=this.getChildElement("info")},willReset:function(){this.dropdown.selectEl.selectedIndex=0;this.dropdown.refresh()},update:function(a){this.updateInfoFields(a.infoFields);
this.updateDropdown(a.trueProviderCounts);this.chosenProvider=a.chosenProvider},updateDropdown:function(a){var b=this.dropdown.selectEl,d=null;0<=b.selectedIndex&&b.selectedIndex<b.options.length&&(d=b.options[b.selectedIndex].value);f(b.options).remove();b.options[0]=new Option("All","ALL");a.forEach(function(a){var c=new Option(a.name+" (%s)".format(a.count),a.name);a.name===d&&(c.selected=!0,b.selectedIndex=b.options.length);b.options[b.options.length]=c});0>b.selectedIndex&&(b.selectedIndex=0);
this.dropdown.refresh()},updateInfoFields:function(a){var b="";a.forEach(function(a){var c;c="\x3cdiv\x3e\x3cb\x3e"+a.title;c=a.description&&a.description.length?c+(":\x3c/b\x3e "+a.description):c+"\x3c/b\x3e";b+=c+"\x3c/div\x3e"});this.infoContainer.html(b)},getState:function(){return this.chosenProvider&&"ALL"!==this.chosenProvider?{chosenProvider:this.chosenProvider}:null}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.filters.placeholders.FilterPlaceholderList",{topFilters:null,moreFilters:null,hasMultipleFilterLists:!1,init:function(){this.topFilters=this.getChildElement("top");(this.moreFilters=this.getChildElement("more"))&&this.moreFilters.length&&(this.hasMultipleFilterLists=!0)},addEventHandlers:function(){this.hasMultipleFilterLists&&(this.subscribe("filterTab.changed",this.switchActiveFilterList.bind(this)),this.subscribe("moreFilters.toggle",this.toggleMoreFilterList.bind(this)))},
switchActiveFilterList:function(){this.topFilters.toggleClass("hidden");this.moreFilters.toggleClass("hidden")},toggleMoreFilterList:function(a){a?this.moreFilters.removeClass("hidden"):this.moreFilters.addClass("hidden")}})})(R9);(function(d,e){d.createComponentClass("common.results.filters.DistanceFilter","common.results.filters.Filter",{landmarkInput:e(),cityOnlyCheckbox:e(),distanceDropdownWidget:void 0,distanceEl:null,landmark:null,cityIds:[],searchLandmark:null,options:{toolTipMessage:null,isMultiValueSet:null,isDisabled:!1,featureClass:"",disabledText:"",smartyUrl:"/f/smarty"},init:function(){var a=this;this.base();this.landmarkInput=this.getChildElement("landmark");a.isMobileView()||this.landmarkInput.toolTip({content:this.options.toolTipMessage,
position:"right",activation:"click",fadeIn:500,fadeOut:500,showImmediately:!1});this.distanceEl=this.getChildElement("distance");this.distanceDropdownWidget=this.distanceEl.dropdown({change:function(b,c,d,f){a.logUserInteraction("distanceFrom",e(b.currentTarget).val());a.pushStateChangeWithDistanceSorting()}}).getWidget();this.cityOnlyCheckbox=this.getChildElement("cityOnly")},logUserInteraction:function(a,b){if("ga"===this.options.loggingType){switch(a){case "reset":a="showall";break;case "distanceFrom":a=
"select-distance";break;case "smarty":a="select-location";break;case "cityOnly":a="select-cityonly"}this.base({category:this.trackCategory,action:this.name,label:a,value:b})}else this.base(a)},addEventHandlers:function(){this.base();var a=this;this.landmarkInput.landmarksSmarty({dataSource:a.options.smartyUrl,setItem:function(b,c){a.landmarkInput.val()!==c.str&&(a.landmarkInput.val(c.str),a.landmark={lat:c.lat,lon:c.lon,display:c.str,id:c.id,type:c.type},a.element.removeClass("empty"),a.pushStateChangeWithDistanceSorting(),
a.logUserInteraction("smarty",a.landmarkInput.val()))},extendRequest:function(){return{c:a.cityIds.join(",")}},appendTo:a.isMobileView()?a.landmarkInput.parent():"body",minWidth:a.isMobileView()?"auto":"250",display:a.isMobileView()?"block":"inline",dropdownClass:" smartbox "+a.options.featureClass});a.isMobileView()&&(this.landmarkInput[0].setSelectionRange(0,9999),this.landmarkInput.on("focus",function(){e(this).select()}));this.subscribe("search.startSearch",function(){a.landmark=null});this.cityOnlyCheckbox.click(function(){a.logUserInteraction("cityOnly");
a.pushStateChangeWithDistanceSorting()});this.subscribe("common.distanceFilter.renew.disable.options",function(b){a.options.isDisabled=b})},cleanupExistingState:function(){this.willReset()},willReset:function(){this.cityOnlyCheckbox.prop("checked",!1);this.distanceDropdownWidget.setValue("-1.00");this.landmarkInput.val("");this.landmark=null;this.landmarkInput.getWidget().options.swBounds=null;this.landmarkInput.getWidget().options.neBounds=null;0<arguments.length&&arguments[0].userClick&&(d.events.publish("resultsHeader.sortMode.set",
"rank_a"),d.events.publish(["resultsHeader.changed","resultsHeader.sortType.log"],{sort:{sortType:"rank",ascending:!0}}))},pushStateChangeWithDistanceSorting:function(){d.events.publish("resultsHeader.sortMode.set","distance_a");d.events.publish(["resultsHeader.changed","resultsHeader.sortType.log"],{sort:{sortType:"distance",ascending:!0}});this.pushStateChange()},update:function(a){this.adjustFilter();this.options.isDisabled||(null===this.landmark&&"null"!=a.landmarkDisplayName&&(this.landmark=
{lat:a.lat,lon:a.lon,display:a.landmarkDisplayName,type:a.lmType},this.updateDisplay(a),this.updateSmartyBounds(a)),this.cityIds=a.cityIds,this.element.removeClass("empty"),a.hasOwnProperty("cityOnly")&&(this.toggleResetLink(a.cityOnly),this.cityOnlyCheckbox.prop("checked",a.cityOnly)),a.hasOwnProperty("distance")&&(a=0===a.distance%1?"%s.0".format(a.distance):a.distance,this.distanceDropdownWidget.setValue(a)))},updateSmartyBounds:function(a){var b=this.landmarkInput.getWidget();b.options.swBounds=
{lat:a.swBoundLat,lon:a.swBoundLon};b.options.neBounds={lat:a.neBoundLat,lon:a.neBoundLon}},updateDisplay:function(a){this.landmarkInput.val(a.landmarkDisplayName);var b=this.cityOnlyCheckbox.parent().closest(".only");a.hasOwnProperty("freeRegion")?b.addClass("hidden"):(b.hasClass("hidden")&&b.removeClass("hidden"),this.cityOnlyCheckbox.parent().find("label span").text(a.searchCityName))},getState:function(){return null!==this.landmark?{lmLat:"%s".format(this.landmark.lat),lmLong:"%s".format(this.landmark.lon),
distance:"%s".format(this.distanceDropdownWidget.getValue()),lmId:this.landmark.id,lmType:this.landmark.type,lmDisplay:this.landmark.display,cityOnly:this.cityOnlyCheckbox.is(":checked")}:{cityOnly:this.cityOnlyCheckbox.is(":checked")}},adjustFilter:function(){this.landmarkInput.attr("placeholder",this.options.disabledText);this.landmarkInput.attr("disabled",this.options.isDisabled);this.distanceEl.find("select").attr("disabled",this.options.isDisabled)}})})(R9,jQuery);(function(e,f){e.createComponentClass("common.results.filters.DurationFilter","common.results.filters.Filter",{options:{min:void 0,max:void 0,maxValueSlider:!0,step:1,displayFormat:void 0,thousandsDelimiter:",",decimalDelimiter:"."},slider:void 0,init:function(){this.base();var a=this;this.slider=new e.common.results.filters.RangeFilterSlider(this.getChildElement("slider"),{min:this.options.min,max:this.options.max,step:this.options.step,displayFormat:this.formatHoursMinutes,maxValueSlider:this.options.maxValueSlider,
formatValues:function(c){return c.map(a.formatThousands.bind(a))},onStop:function(c,d,b){a.logUserInteraction(null,c,b);b&&a.pushStateChange()}})},logUserInteraction:function(a,c,d){"ga"===this.options.loggingType?(a="reset"===a?"showall":"",d&&(a=f(c.target).hasClass("right")?"max-adjust":"min-adjust"),this.base({category:this.trackCategory,action:this.name,label:a})):this.base(a)},shouldBeVisible:function(a){return!(isNaN(parseInt(a.minRange))||isNaN(parseInt(a.maxRange)))},willReset:function(){this.slider.setRightRange(this.slider.maxRange,
!0);this.options.maxValueSlider||this.slider.setLeftRange(this.slider.minRange,!0)},cleanupExistingState:function(){this.slider.leftRange=this.slider.rightRange=this.slider.minRange=this.slider.maxRange=void 0},update:function(a){var c=parseInt(a.minRange),d=parseInt(a.maxRange),b=parseInt(a.leftRange);a=parseInt(a.rightRange);var e=null===this.slider.leftRange||void 0===this.slider.leftRange||void 0===this.slider.minRange||this.slider.leftRange===this.slider.minRange,f=null===this.slider.rightRange||
void 0===this.slider.rightRange||void 0===this.slider.maxRange||this.slider.rightRange===this.slider.maxRange;isNaN(c)||isNaN(d)||(this.slider.setMinRange(c),this.slider.setMaxRange(d),isNaN(b)?e&&this.slider.setLeftRange(this.slider.minRange,!0):this.slider.setLeftRange(b,!0),isNaN(a)?f&&this.slider.setRightRange(this.slider.maxRange,!0):this.slider.setRightRange(a,!0),this.element.removeClass("empty"))},getState:function(){return{min:this.slider.leftRange,max:this.slider.rightRange}},formatThousands:function(a){if("undefined"===
typeof a)return a;var c=this.options.thousandsDelimiter,d=this.options.decimalDelimiter,b=a.toString().split(".");a=b[0];d=1<b.length?d+b[1]:"";b=/(\d+)(\d{3})/;if(0<c.length)for(;b.test(a);)a=a.replace(b,"$1"+c+"$2");return a+d},formatHoursMinutes:function(a){return"undefined"===typeof a?a:replaceArgs("{0}h {1}m",Math.floor(a/60),a%60)}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.results.filters.Filter",{name:null,data:null,options:{name:null,title:null,logUserInteraction:!0,collapsible:!1,mobileView:!1,loggingType:"ga",loggingAction:null,loggingLabel:null,triggerFilteredLabel:!1},trackCategory:"Filters",dirty:!1,resetButton:null,init:function(){this.data={};this.name=this.options.name;if(void 0===this.name||""===this.name)throw"Error initializing Javascript filter: a filter name was not provided";},addEventHandlers:function(){var a=
this;this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));var b=this.reset.bind(this);this.subscribe("filters.reset",b);this.subscribe("filter.reset",{name:this.name},b);this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed"],function(){a.element.toggleClass("hidden",a.element.hasClass("empty"))});this.subscribe("search.searchFailed",function(){a.element.addClass("hidden")});this.subscribe("filter.show",{name:this.name},function(){a.element.removeClass("hidden")});
this.subscribe("search.startSearch",function(b){a.element.removeClass("hidden");"undefined"!==typeof b&&b.preserveFilters||(a.element.addClass("empty"),a.cleanupExistingState())});c.events.subscribe("train.legChange.reset",function(){c.events.publish("filter.reset",{name:a.name})});b=this.getChildElement("reset");b.click(this.reset.bind(this,{type:"reset",userClick:!0}));if(b&&!this.isMobileView()){var d=this.getResetType();"showAll"===d?b.toolTip({content:b.data("tooltip-showall")}):"clearAll"===
d?b.toolTip({content:b.data("tooltip-clearall")}):b.toolTip({content:b.data("message")})}this.subscribe("filters.selectedprice",function(){a.reset.apply(a,arguments)});this.options.collapsible&&this.getChildElement("title").click(function(){a.element.toggleClass("open");a.isMobileView()&&(a.element.parent().addClass("hideNotOpened"),c.events.publish("horizon.mobile.FiltersDialog.itemOpened",{name:a.options.name,title:a.options.title}))});this.subscribe("filters.disabled",this.setDisabled.bind(this));
this.subscribe("filter.disabled",{name:this.name},function(b){a.setDisabled(b.disabled)});this.subscribe("filters.goBack",function(){a.element.removeClass("open");a.element.parent().removeClass("hideNotOpened")});this.options.triggerFilteredLabel&&this.subscribe("resultspage.results.count.changed",this.onResultsCountChanged.bind(this))},getResetType:function(){return!1===this.options.isMultiValueSet?"showAll":!0===this.options.isMultiValueSet?"clearAll":"custom"},pushStateChange:function(a){c.events.publish("filters.changed",
{name:this.name,state:!0===a?null:this.getState()})},logUserInteraction:function(a){"ga"===this.options.loggingType&&"object"===typeof a?c.Analytics.api.trackEvent(a):c.Analytics.api.trackEvent("/filter/"+this.name+(a?"/"+a:""))},publishHoverState:function(a,b){a=d.extend({name:this.name,hover:a},b||{});c.events.publish("filters.%s.hovering".format(this.name),a)},toggleResetLink:function(a){var b=this.getChildElement("reset");0!==b.length&&(a?b.addClass("active"):b.removeClass("active"))},reset:function(a){this.willReset.apply(this,
arguments);this.setLastUserInteraction(!0);this.pushStateChange(!0);a&&a.userClick&&this.logUserInteraction("reset")},filterDataChanged:function(a){a[this.name]&&(a=d.extend({},a[this.name]),a.hasOwnProperty("visible")&&(a.visible?this.element.hasClass("inactive")&&this.element.removeClass("inactive"):this.element.addClass("inactive"),c.events.publish("filter.visible",{name:this.name,visible:a.visible}),delete a.visible),this.dirty=a.isDirty,this.isUserManipulated=a.isUserManipulated,this.options.triggerFilteredLabel&&
this.lastUserInteraction&&(this.invalidateFilterLabelData?(this.invalidateFilterLabelData=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelCount=!0),c.events.publish("filter.dirty",{name:this.name,dirty:this.dirty}),delete a.isDirty,this.update(a),this.isUserManipulated&&c.events.publish("resultspage.filters.sync",{name:this.name,state:this.getState()}),this.element.toggleClass("empty",!this.shouldBeVisible(a)),this.element.toggleClass("isDirty",this.dirty),this.toggleResetLink(this.dirty),
this.setLastUserInteraction(!1))},onResultsCountChanged:function(a){!isNaN(this.lastTotalFilteredCount)&&!isNaN(a.filtered)&&0<=a.filtered&&(this.lastFilterCountDiff=a.filtered-this.lastTotalFilteredCount);this.lastTotalFilteredCount=a.filtered;this.invalidateFilterLabelCount?(this.invalidateFilterLabelCount=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelData=this.lastUserInteraction},updateFilteredLabels:function(a){a=parseInt(a);if(!isNaN(a)){var b=this.getChildElement("reset");
b&&b.length&&b.hasClass("active")&&(this.subscribe("filter.label.cleared."+this.name,this.onFilterLabelCleared.bind(this)),this.toggleResetLink(!1));c.events.publish("filter.label.update",{name:this.name,diff:a})}},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.dirty&&this.toggleResetLink(!0)},setLastUserInteraction:function(a){this.lastUserInteraction=a},setDisabled:function(a){this.element.toggleClass("Disabled",a)},cleanupExistingState:function(){},shouldBeVisible:function(a){return!0},
willReset:function(a){},update:function(a){},getState:function(){},isMobileView:function(){return this.options.mobileView}})})(R9,jQuery);(function(b){b.createComponentClass("common.results.filters.FilterList",{filtersSection:null,placeholderList:null,isPlaceholderEnabled:null,filterLayout:{},options:{searchCompleted:!1,primaryFilterList:[],moreFilterList:[]},init:function(){this.filtersSection=this.getChildElement("filtersSection");this.isPlaceholderEnabled=(this.placeholderList=this.getChildElement("placeholderList"))&&0<this.placeholderList.length;this.hideFilterList()},addEventHandlers:function(){this.subscribe("resultspage.streaming.done",
this.showFilterList.bind(this));this.subscribe(["search.startSearch","resultspage.streaming.start"],this.streamingStarted.bind(this));this.subscribe("resultspage.filtersData.changed",this.handleFilterResponse.bind(this));this.subscribe("search.searchFailed",this.hideAll.bind(this));this.subscribe("resultspage.filterList.show",this.showFilterList.bind(this))},handleFilterResponse:function(a){a&&Object.keys(a).length&&a[Object.keys(a)[0]].visible&&this.showFilterList()},showFilterList:function(){this.filtersSection.removeClass("hidden");
this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden")},streamingStarted:function(a){"undefined"!==typeof a&&a.preserveFilters||this.hideFilterList()},hideFilterList:function(){this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.removeClass("hidden")},hideAll:function(){this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden")}})})(R9);(function(c,e){c.createComponentClass("common.results.filters.FilterMatrixTable",{options:{xFilterName:void 0,xFilterState:void 0,xFilterDefaultSelected:1,yFilterName:void 0,yFilterState:void 0,yFilterDefaultSelected:1,firstColumnFixed:!1,xOnlyOnClick:!1,yOnlyOnClick:!1,hoverHighlight:!0,underflow:!1},xAxes:void 0,yAxes:void 0,xFilter:void 0,yFilter:void 0,isStatic:!0,init:function(){this.xAxes=this.element.find("div.x-axis");this.yAxes=this.element.find("div.y-axis");this.options.xFilterName&&(this.xFilter=
new d(this.options.xFilterName,this.xAxes.find(".matrixCheckbox"),this.options.xFilterState,this.options.xFilterDefaultSelected,this.options.xOnlyOnClick));this.options.yFilterName&&(this.yFilter=new d(this.options.yFilterName,this.yAxes.find(".matrixCheckbox"),this.options.yFilterState,this.options.yFilterDefaultSelected,this.options.yOnlyOnClick))},addEventHandlers:function(){var a=this;this.element.find(".col-cell.valid").on("click",function(b){a.handleValidCellClick.call(a,e(this),b)}).on("mouseenter",
function(b){a.onValidCellHover.call(a,e(this),b)});(this.xFilter||this.yFilter)&&this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));this.options.firstColumnFixed&&this.bindScrollBars()},bindScrollBars:function(){var a=this.element.find(".scroller.prev"),b=this.element.find(".scroller.next"),f=this.element.find(".conveyor"),c=this.element.find(".conveyor .headerRow .x-axis").eq(0).outerWidth(),h=5*c,k=Math.floor(f.outerWidth()/c),d=function(d){var m="r"===d?b:a,g=f.data("left")||
0,e=Math.floor(Math.abs(g/c)),l=("r"===d?Math.min(5,k-e):Math.min(5,e))*c;m.hasClass("noclick")||(l<h&&b.addClass("noclick"),"r"===d?(a.removeClass("noclick"),g-=l,5>k-Math.floor(Math.abs(g/c))&&b.addClass("noclick")):(b.removeClass("noclick"),5>=e?(g=0,a.addClass("noclick")):g+=l),f.data("left",g),f.css("left",g+"px"))};a.on("click",d.bind(this,"l"));b.on("click",d.bind(this,"r"));6>k&&b.addClass("noclick")},filterDataChanged:function(a){this.xFilter&&a.hasOwnProperty(this.options.xFilterName)&&
this.xFilter.update(a[this.options.xFilterName]);this.yFilter&&a.hasOwnProperty(this.options.yFilterName)&&this.yFilter.update(a[this.options.yFilterName])},handleValidCellClick:function(a){var b=a.find("a");a=b.data("x-filter-code");b=b.data("y-filter-code");this.xFilter&&void 0===a||this.yFilter&&void 0===b||(this.xFilter&&(this.options.firstColumnFixed&&"RESET"===a?c.events.publish("filter.reset",{name:this.options.xFilterName}):c.events.publish("filters.%s.%s.setchecked.force".format(this.options.xFilterName,
a),{selected:2,changeType:"only"})),this.yFilter&&c.events.publish("filters.%s.%s.setchecked.force".format(this.options.yFilterName,b),{selected:2,changeType:"only"}))},onValidCellHover:function(a){var b,c;a.hasClass("fixed")?(b=this.xAxes.eq(0),c=this.yAxes.eq(a.index()-1)):(b=this.xAxes.eq(this.options.firstColumnFixed?1+a.index():a.index()-1),c=this.yAxes.eq(a.parent().index()-1));this.options.hoverHighlight&&(b.addClass("highlight"),c.addClass("highlight"),a.addClass("highlight"),a.one("mouseleave",
function(){e(this).removeClass("highlight");b.removeClass("highlight");c.removeClass("highlight")}))}});var d=function(a,b,f,d,h){this.name=a;this.only=null;this.defaultState=d;this.onlyOnClick=h;this.items=b.toArray().map(function(a){var b=e(a).find("input").attr("name");return e(a).parent().parent().hasClass("static")?null:new c.common.results.filters.ValueSetFilterItem(a,{group:this.name,name:b,onUserChange:this.onChange.bind(this),state:f&&"object"===typeof f?f[b]:{selected:d},onlyOnClick:h})},
this).filter(function(a){return null!==a});c.events.subscribe(["filters.reset","filters.selectedprice"],this.reset.bind(this));c.events.subscribe("filter.reset",{name:this.name},this.reset.bind(this));this.items.forEach(function(a){2===a.getState()&&(this.only=a,c.events.publish("filters.%s.setonly".format(this.name),a.options.name))},this)};d.prototype.reset=function(){var a=this;this.items.forEach(function(b){b.setChecked(void 0!==a.defaultState?a.defaultState:1)});this.pushStateChange(!0)};d.prototype.pushStateChange=
function(a,b){c.events.publish("filters.changed",{name:this.name,state:!0===a?null:b})};d.prototype.update=function(a){this.items.forEach(function(b){var c=a[b.options.name];c&&b.update(c)},this)};d.prototype.onChange=function(a,b){var d={},e="only"===b;e&&"RESET"===a?c.events.publish("filter.reset",{name:this.name}):(this.only&&this.only.options.name!==a&&(c.events.publish("filters.%s.%s.setchecked".format(this.only.options.group,this.only.options.name),this.defaultState),this.only=null),this.items.forEach(function(b){e&&
b.options.name!==a&&c.events.publish("filters.%s.%s.setchecked".format(b.options.group,b.options.name),0);b.options.name===a&&c.events.publish("filters.%s.%s.setchecked".format(b.options.group,b.options.name),b.state.selected);d[b.options.name]=b.getState()},this),e&&c.events.publish("filters.%s.setonly".format(this.name),a),this.pushStateChange(!1,d))}})(R9,jQuery);(function(c,h){c.createComponentClass("common.results.filters.FilterSection",{filters:void 0,options:{filters:[],filteredLabelTargets:null},resetLink:void 0,init:function(){this.resetLink=this.getChildElement("reset")},addEventHandlers:function(){var a=this;this.subscribe("search.startSearch",function(b){"undefined"!==typeof b&&b.preserveFilters||a.element.addClass("inactive")});this.resetLink.click(function(){a.options.filters.forEach(function(b){a.skipFilter(b)||c.events.publish("filter.reset",
{name:b})});a.resetLink.hide()});this.dedupeSubscribe("filter.dirty","dirty",function(b){b?(a.resetHiddenByLabel||a.resetLink.show(),a.resetWasDirty=!0):(a.resetLink.hide(),a.resetWasDirty=!1)});this.dedupeSubscribe("filter.visible","visible",function(b){a.toggleFilterSection({visible:b})});this.subscribe("filters.disabled",function(b){b?a.resetLink.hide():a.resetLink.show()});this.subscribe("filter.label.update",this.onFilterLabelUpdate.bind(this))},dedupeSubscribe:function(a,b,c){var e=null,d=null,
f=this;this.options.filters.forEach(function(g){f.subscribe(a,{name:g},function(a){f.skipFilter(g)||(!d&&a[b]&&(d=!0),clearTimeout(e),e=setTimeout(function(){c(d);d=null},100))})})},onFilterLabelUpdate:function(a){var b=this.options.filteredLabelTargets&&this.options.filteredLabelTargets.length?this.options.filteredLabelTargets:this.options.filters;a&&a.name&&b&&b.indexOf&&!(0>b.indexOf(a.name))&&this.resetLink&&this.resetLink.length&&(this.subscribe("filter.label.cleared."+a.name,this.onFilterLabelCleared.bind(this)),
this.resetHiddenByLabel=!0,this.resetLink.is(":visible")&&(this.resetWasDirty=!0),this.resetLink.hide())},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.resetHiddenByLabel=!1;this.resetWasDirty&&(this.resetWasDirty=!1,this.resetLink.show())},toggleFilterSection:function(a){this.element.toggleClass("inactive",!a.visible)},skipFilter:function(a){return!1}})})(window.R9,window.jQuery);(function(d){d.createComponentClass("common.results.filters.FilteredLabel",{options:{targetFilters:null,filterRemovedMessage:"",filterAddedMessage:"",labelTiming:3E3},clearq:[],addEventHandlers:function(){this.subscribe("filter.label.update",this.onLabelUpdate.bind(this));this.subscribe("filters.changed",this.onLabelClear.bind(this))},onLabelUpdate:function(a){if(this.isMyData(a)){var c=this,b=Math.abs(a.diff),b=d.Common.Utils.String.formatChoice(0>a.diff?this.options.filterRemovedMessage:this.options.filterAddedMessage,
b,b);this.element.show();this.getChildElement("filteredLabel").addClass("show").text(b);this.clearq.push(a.name);this.clearLabelID=setTimeout(function(){c.clearLabelID=null;c.clearLabel()},this.options.labelTiming)}},onLabelClear:function(a){this.isMyData(a)&&this.clearLabel()},isMyData:function(a){return!!(a&&a.name&&this.options.targetFilters&&this.options.targetFilters.indexOf&&0<=this.options.targetFilters.indexOf(a.name)&&this.options.filterRemovedMessage&&this.options.filterAddedMessage)},clearLabel:function(){this.clearLabelID&&
(clearTimeout(this.clearLabelID),this.clearLabelID=null);var a=this,c=this.getChildElement("filteredLabel");c.hasClass("show")&&(c.removeClass("show"),setTimeout(function(){a.element.hide();for(var b=0;b<a.clearq.length;b++)d.events.publish("filter.label.cleared."+a.clearq[b],{name:a.clearq[b]});a.clearq=[]},400))}})})(R9);(function(e){e.createComponentClass("common.results.filters.IconSetFilter","common.results.filters.ValueSetFilter",{options:{keelColumns:3,iconUrlMap:{},smallLabelOptions:[]},itemTemplateId:"iconSetFilterItem",svgTemplateId:"svgIcons",withImage:!0,init:function(){this.base()},getIconUrl:function(b){var a=this.options.iconUrlMap[b];a||this.log.warn("no file path found for option "+b+".","iconUrlMap: ",this.options.iconUrlMap);return a},getPrerenderedSvg:function(b){var a=e.template.renderElement(this.svgTemplateId,
{}),a=$(a).filter(function(a,d){if($(d).data("option")===b)return d});return 0===a.length?"":$(a).html().trim()},makeFilterOption:function(b,a,g,d){var c=this;return new e.common.results.filters.IconSetFilterItem(b,{state:a,name:g,group:this.name,onUserChange:function(){c.filterItemDidChange.apply(c,Array.prototype.slice.call(arguments).concat(this))},heading:d})},addOptionToFilterMap:function(b,a,e,d){var c=this.getIconUrl(b),f=c&&0<=c.indexOf(".svg"),g=-1!==this.options.smallLabelOptions.indexOf(b),
c={imageUrl:c,isSvgImage:f,keelColumns:this.options.keelColumns,extraCssClass:g?"small-label":""};f&&(f=this.getPrerenderedSvg(b))&&(c.svgMarkup=f);this.base(b,a,e,d,c)}})})(R9);(function(a){a.createComponentClass("common.results.filters.IconSetFilterItem","common.results.filters.ValueSetFilterItem",{})})(R9);(function(f,e){f.createComponentClass("common.results.filters.RangeFilterSlider","common.results.filters.Filter",{options:{formatValues:function(a){return a},displayFormat:"%s",min:void 0,max:void 0,step:1,logarithmic:!1,useTextInput:!1,maxValueSlider:!1,onStop:e.noop,onSlide:void 0,onStart:void 0,onValidate:void 0},minRange:void 0,maxRange:void 0,leftRange:void 0,rightRange:void 0,displayLabel:void 0,leftDisplay:void 0,rightDisplay:void 0,textInputForm:void 0,textInputMin:void 0,textInputMax:void 0,
textInputOpen:!1,widget:void 0,init:function(){this.displayLabel=this.getChildElement("rangeLabel");this.leftDisplay=this.displayLabel.find(".min");this.rightDisplay=this.displayLabel.find(".max")},addEventHandlers:function(){var a=this;this.widget=this.getChildElement("sliderWidget").slider({range:!this.options.maxValueSlider,min:this.options.min,max:this.options.max,step:this.options.step,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput}).getWidget();this.minRange=this.options.min;
this.maxRange=this.options.max;var b=function(c){a.options.maxValueSlider?a.setRightRange(c[0]):(a.setLeftRange(c[0]),a.setRightRange(c[1]))};this.widget.setOption("stop",function(c,d,e){e&&(a.setLastUserInteraction(!0),b(d));a.options.onStop(c,d,e)});this.widget.setOption("slide",function(c,d){if(c&&(b(d),"function"===typeof a.options.onSlide))a.options.onSlide(c,d)});this.options.useTextInput&&(this.textInputForm=this.getChildElement("textInputForm"),this.textInputMin=this.getChildElement("minInput").find("input[type\x3dnumber]"),
this.textInputMax=this.getChildElement("maxInput").find("input[type\x3dnumber]"),this.addTextInputHandlers());"function"===typeof this.options.onStart&&this.widget.setOption("start",this.options.onStart)},addTextInputHandlers:function(){var a=this;this.displayLabel.click(a.openTextInput.bind(a));this.textInputForm.submit(a.submitTextInput.bind(a));e("body").on("click.exceptPriceFilter",function(c){!a.textInputOpen||0<e(a.element).find(e(c.target)).length||(a.textInputForm.trigger("submit"),a.closeTextInput())});
var b={9:function(c){c.target&&e(c.target).is(a.textInputMin)?a.textInputMax.focus():a.closeTextInput()},13:function(){a.textInputForm.trigger("submit")},27:function(){a.closeTextInput()}};this.textInputForm.keydown(function(a){"function"===typeof b[a.keyCode]&&(b[a.keyCode](a),a.preventDefault())})},setMinRange:function(a){this.minRange=a;this.options.min=a;this.widget.setOption("min",a)},setMaxRange:function(a){this.maxRange=a;this.options.max=a;this.widget.setOption("max",a)},setLeftRange:function(a,
b){this.leftRange=a;this.updateDisplay(b)},setRightRange:function(a,b){this.rightRange=a;this.updateDisplay(b)},reset:function(){this.setLeftRange(this.minRange);this.setRightRange(this.rightRange)},clearState:function(){this.leftRange=this.rightRange=this.minRange=this.maxRange=void 0},validateValues:function(a){if("function"===typeof this.options.onValidate)return this.options.onValidate(a);var b=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!b?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:
!1},updateDisplay:function(a){var b=this.options.formatValues([this.leftRange,this.rightRange]),c=b[0],b=b[1],d=this.options.displayFormat;if("function"===typeof d)c=d(c,!0),b=d(b,!1);else if("string"===typeof d)c=d.format(c),b=d.format(b);else throw"Must pass a valid display formula [function || string]";this.leftDisplay.html(c);this.rightDisplay.html(b);c=[this.leftRange,this.rightRange];this.options.maxValueSlider&&(c[0]=this.rightRange);a&&this.widget.setValues(c);this.textInputForm&&this.updateTextInput(c)},
openTextInput:function(a){a=e(a.target).is(".max")?this.textInputMax:this.textInputMin;this.resetTextInput();this.textInputForm.removeClass("hidden");this.displayLabel.addClass("hidden");this.textInputOpen=!0;a.focus()},closeTextInput:function(){this.displayLabel.removeClass("hidden");this.textInputForm.addClass("hidden");this.textInputOpen=!1},submitTextInput:function(a){a.preventDefault();var b=Math.round(Number(this.textInputMin.val())),c=Math.round(Number(this.textInputMax.val())),b=[b,c];if(!this.validateValues(b))return this.resetTextInput(),
!1;this.widget.options.stop(a,b,b[0]!==this.leftRange||b[1]!==this.rightRange);this.closeTextInput();return!1},updateTextInput:function(a){this.textInputMin.val(a[0]).attr("min",this.minRange).attr("max",a[1]);this.textInputMax.val(a[1]).attr("min",a[0]).attr("max",this.maxRange)},resetTextInput:function(){this.textInputMin.val(this.leftRange);this.textInputMax.val(this.rightRange)},destroy:function(){this.base();e("body").off("click.exceptPriceFilter")}})})(window.R9,window.jQuery);(function(g,f){g.createComponentClass("common.results.filters.RangeGraphFilter","common.results.filters.Filter",{Graph:null,legs:void 0,legCount:1,options:{min:void 0,max:void 0,step:1,showOutliers:!1,outlierDeviation:18,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",useTextInput:!1,showGraphOverlay:!1,activeLeg:-1,yAxisDisplay:"count",triggerFilteredLabel:!1},textInput:null,init:function(){var a=this;this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;
this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.element.find(".graphFilterSection").each(function(b){var c=!1;a.legs[b]={slider:new g.common.results.filters.RangeFilterSlider(a.getChildElement("slider-"+b),f.extend({},{min:a.options.min,max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(d,e){c=
!0;return a.sliderDidStart(b,e)},onSlide:function(c,e){return a.sliderDidSlide(b,e)},onStop:function(d,e,f){c=!1;a.publishHoverState(!1,{leg:b});return a.sliderDidStop(b,f)},onValidate:function(b){return a.validateValues(b)}})),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:f(this)};a.legs[b].element.on("mouseenter",a.publishHoverState.bind(a,!0,{leg:b}));a.legs[b].element.on("mouseleave",function(){c||a.publishHoverState(!1,{leg:b})})});this.confineDisplayToLeg(this.options.activeLeg)},
addEventHandlers:function(){this.base();var a=this;this.subscribe("common.results.filters.activeLeg.changed",function(b){a.confineDisplayToLeg(b)});this.subscribe("common.results.filters.legCount.set",function(b){a.legCount!==b&&(a.legCount=b,1===a.legCount?a.confineDisplayToLeg(0):2===a.legCount&&a.confineDisplayToLeg(-1))})},confineDisplayToLeg:function(a){if(!this.options.isMulticity&&0>a)this.element.find(".graphFilterSection").removeClass("inactive");else{a=0>a?0:a;for(var b=0;b<this.legs.length;b++)this.legs[b].element.toggleClass("inactive",
b!==a)}},sliderDidStop:function(a,b){this.hideGraph(a);b&&(this.pushStateChange(),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidSlide:function(a,b){void 0!==this.legs[a].graph&&this.updateGraph(a,b)},sliderDidStart:function(a){this.isGraphable(a)&&(this.showGraph(a),this.updateGraph(a,this.legs[a].slider.widget.options.values))},updateGraph:function(a,b){a=this.legs[a];a.graph.find(".bars .bar").each(function(){var a=parseInt(f(this).data("boundary"));b[0]>a||b[1]<a?f(this).addClass("inactive"):
f(this).removeClass("inactive")});var c=a.graph.find(".bars").width(),d=a.slider.minRange,d=c*(b[a.slider.widget.activeHandleIndex]-d)/(a.slider.maxRange-d);d>c-1&&(d=c-1);0>d&&(d=0);a.graph.find(".bars .cursor").css({left:d+"px"})},shouldBeVisible:function(a){if(a.legs)for(var b=0;b<a.legs.length;b++)if(!isNaN(parseInt(a.legs[b].minRange))&&!isNaN(parseInt(a.legs[b].maxRange)))return!0;return!1},setDisabled:function(a){this.base(a);this.legs.forEach(function(b){b.slider.widget.element.toggleClass("Disabled",
a)})},willReset:function(){this.legs.forEach(function(a){a.slider.reset()})},cleanupExistingState:function(){this.legs.forEach(function(a){a.slider.clearState();a.ranges=a.graph=a.maxYVal=void 0})},update:function(a){var b=this;a&&(a.legs?a.legs.forEach(b.updateLeg.bind(b)):updateLeg(a,0),a.sectionLabels?a.sectionLabels.forEach(function(a,d){b.legs[d].label.html(a)}):1===b.legs.length&&(b.legs[0].label.html(this.options.title),b.legs[0].label.addClass("only-label")))},updateLeg:function(a,b){this.updateLegSlider(a,
b);this.hideGraph(b);this.legs[b].ranges=a;this.legs[b].graph=void 0;var c=this.lookupGraphYKeys(this.options.yAxisDisplay);(a=a[c.max])&&a.length?this.legs[b].maxYVal=a[b]:f.isArray(a)||(this.legs[b].maxYVal=a)},updateLegSlider:function(a,b){var c=this.legs[b].slider,d=parseInt(a.minRange),e=parseInt(a.maxRange),f=parseInt(a.leftRange);a=parseInt(a.rightRange);var g=void 0===c.leftRange||void 0===c.minRange||c.leftRange===c.minRange,h=void 0===c.rightRange||void 0===c.maxRange||c.rightRange===c.maxRange;
isNaN(d)||isNaN(e)||(c.setMinRange(d),c.setMaxRange(e),this.minRange=d,this.maxRange=e,isNaN(f)?g&&c.setLeftRange(c.minRange,!0):c.setLeftRange(f,!0),isNaN(a)?h&&c.setRightRange(c.maxRange,!0):c.setRightRange(a,!0),this.getChildElement("section-"+b).removeClass("hidden"),this.getChildElement("legToggle").find("[name\x3d%s]".format(b+1)).addClass("active"),this.element.removeClass("hidden"))},validateValues:function(a){var b=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!b?this.minRange<=a[0]&&a[0]<=
a[1]&&a[1]<=this.maxRange:!1},formatValues:function(a){return a.map(function(a){return"undefined"===typeof a?a:g.Common.Utils.formatPrice(Math.round(a),!0)})},getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){return a.slider&&"number"===typeof a.slider.leftRange&&"number"===typeof a.slider.rightRange?{min:a.slider.leftRange.toString(),max:a.slider.rightRange.toString()}:{}})}},hideGraph:function(a){void 0!==this.legs[a].graph&&(this.legs[a].graph.find(".filterGraph").css({display:"none",
height:"0"}),this.getChildElement("section-"+a).removeClass("showGraph"))},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+a).html(this.generateGraph(a,b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").css({display:"block",height:"82px"})},isGraphable:function(a){if(!this.legs[a]||!this.legs[a].ranges||!this.legs[a].ranges.ranges)return!1;a=this.legs[a].ranges.ranges;
var b=2>a.length,c=!1,d=!1;if(!this.options.showOutliers){var e=this.getLegResultCount(a);e?c=this.getHasOutliers(a,e):d=!0}return!b&&!c&&!d},getHasOutliers:function(a,b){var c=this.calculateRangeMean(a,b);a=this.calculateRangeStdDev(a,b,c);return(this.maxRange-c)/a>this.options.outlierDeviation},getLegResultCount:function(a){var b=0;a.forEach(function(a){b+=a.count});return 1E4<b?null:b},calculateRangeMean:function(a,b){var c=0;a.forEach(function(a){c+=a.max*a.count});return c/b},calculateRangeStdDev:function(a,
b,c){var d=0,e=0;a.forEach(function(a){e=a.max*a.count;d+=(e-c)*(e-c)/b});return Math.sqrt(d/b)},generateGraph:function(a,b){return(new this.Graph({minRange:b.minRange,maxRange:b.maxRange,yKey:this.lookupGraphYKeys(this.options.yAxisDisplay).value,yMax:this.legs[a].maxYVal,ranges:b.ranges})).render()},lookupGraphYKeys:function(a){var b={count:{value:"count",max:"maxCount"},price:{value:"minPrice",max:"maxPrice"}};return"string"===typeof a&&b[a]?b[a]:b.count},makeGraphClass:function(){var a=function(a){this.options=
f.extend(this.options,a);this.init()};a.prototype=f.extend(a.prototype,{xUnitScale:1,yUnitScale:1,xLabelPixels:void 0,yLabelPixels:void 0,xPixelPadding:5,xMaxPixels:g.config.getInt("ui.range.filter.graph.xAxisMax",179),yMaxPixels:70,options:{height:72,yKey:"count",yMax:void 0,ranges:void 0,minRange:void 0,maxRange:void 0,xAxisSteps:6,yAxisTicks:4},init:function(){this.findAxisTextWidths();this.adjustXAxisSteps();this.adjustYAxisTicks()},formatX:function(a){return g.Common.Utils.formatPrice(Math.round(a),
!0)},formatY:function(a){return a},rawX:function(a){return a},rawY:function(a){return a},pixelScaleY:function(a){return 0>a?1:this.yMaxPixels/this.options.yMax*a},findAxisTextWidths:function(){if(!this.xLabelPixels||!this.yLabelPixels){var a=this.formatX(this.options.ranges[this.options.ranges.length-1]&&this.options.ranges[this.options.ranges.length-1].max),c=this.formatY(this.options.yMax),a=f("\x3cspan\x3e").html(a).addClass("xLabel").css("font-size","9px"),c=f("\x3cspan\x3e").html(c).addClass("yLabel").css("font-size",
"10px"),d=f("\x3cdiv\x3e").css("position","absolute").css("left","-9999px").css("top","-9999px").css("opacity","0");d.append(a).append(c);f("body").append(d);this.xLabelPixels=a.outerWidth()+5;this.yLabelPixels=c.outerWidth()+5;d.remove()}},adjustXAxisSteps:function(){for(;0<this.options.xAxisSteps&&!(this.xMaxPixels/(this.options.xAxisSteps+1)>this.xLabelPixels);this.options.xAxisSteps--);2>=this.options.xAxisSteps&&(this.options.xAxisSteps=2)},adjustYAxisTicks:function(){var a=this.options.yMax,
c=Number(this.options.yAxisTicks);if(0!==a%c)for(this.options.yAxisTicks=8>a?a:8;1<this.options.yAxisTicks&&0!==this.options.yMax%this.options.yAxisTicks;this.options.yAxisTicks--)1===this.options.yAxisTicks&&(this.options.yAxisTicks=8<this.options.yAxisTicks?c:this.options.yMax)},renderYAxis:function(){if(1>this.options.yAxisTicks)return"";for(var a=this.options.height/this.options.yAxisTicks,c=f("\x3cdiv class\x3d'y-axis'\x3e\x3c/div\x3e"),d,e=0;e<this.options.yAxisTicks;e++)d=this.renderYAxisLabel(e).css("height",
a+"px").css("width",this.yLabelPixels+"px"),c.append(d);c.css("width",this.yLabelPixels);c=f("\x3cdiv\x3e").append(c);for(e=0;e<this.options.yAxisTicks;e++)d=f("\x3cdiv\x3e\x3c/div\x3e").addClass(e+1===this.options.yAxisTicks?"line last":"line").css("top",e*a+"px").css("height",a-1+"px").css("left",this.yLabelPixels+this.xPixelPadding+"px"),c.append(d);return c.html()},renderYAxisLabel:function(a){return f("\x3cdiv class\x3d'label'\x3e%s\x3c/div\x3e".format(this.formatY(this.options.yMax-this.options.yMax*
a/this.options.yAxisTicks)))},renderXAxis:function(){for(var a=this.rawX(this.options.minRange),c=this.rawX(this.options.maxRange),d=Math.max(Math.ceil((c-a)/this.options.xAxisSteps),this.xUnitScale),a=Math.min((c-a)/d+1,8),c="",e=0;e<a;e++)c+=this.renderXAxisLabel(e,d);return"\x3cdiv class\x3d'x-axis' style\x3d'left: %spx'\x3e%s\x3c/div\x3e".format(this.yLabelPixels+2,c)},renderXAxisLabel:function(a,c){a=this.rawX(this.options.minRange)+a*c;a=this.formatX(a);return"\x3cspan class\x3d'x-label'\x3e%s\x3c/span\x3e".format(a)},
renderGraphBars:function(){for(var a="",c=this.yLabelPixels+this.xPixelPadding,d=0,e=this.options.ranges.length;d<e;d++)var f=this.options.ranges[d],a=a+"\x3cspan class\x3d'bar' data-boundary\x3d'%s' style\x3d'height: %spx'\x3e\x3c/span\x3e".format(f.min,this.pixelScaleY(f[this.options.yKey]));return"\x3cdiv class\x3d'bars' style\x3d'left: %spx'\x3e%s \x3cspan class\x3d'cursor'\x3e\x3c/span\x3e\x3c/div\x3e".format(c,a)},render:function(){return f("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+
this.renderGraphBars()+this.renderXAxis())}});return a}})})(R9,jQuery);(function(e,g){e.createComponentClass("common.results.filters.SimpleRangeFilter","common.results.filters.Filter",{options:{min:void 0,max:void 0,step:1,maxValueSlider:!1,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",duration:!1,durationFormat:"",logarithmic:!1,useTextInput:!1,isMultiValueSet:null,triggerFilteredLabel:!1},slider:void 0,sliding:!1,init:function(){this.base();var a=this,b=this.options.duration?this.formatDuration.bind(this):this.formatThousands.bind(this);this.slider=
new e.common.results.filters.RangeFilterSlider(this.getChildElement("slider"),{min:this.options.min,max:100,step:this.options.step,maxValueSlider:this.options.maxValueSlider,displayFormat:this.options.displayFormat,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,triggerFilteredLabel:this.options.triggerFilteredLabel,formatValues:function(a){return a.map(b)},onStart:function(){a.sliding=!0},onStop:function(b,c,f){a.logUserInteraction(null,b,f);f&&(a.setLastUserInteraction(!0),
a.pushStateChange());a.sliding=!1;a.publishHoverState(!1)}})},addEventHandlers:function(){this.base();var a=this;this.slider.element.on("mouseenter",this.publishHoverState.bind(this,!0));this.slider.element.on("mouseleave",function(){a.sliding||a.publishHoverState(!1)});this.subscribe("sliders.redraw",function(){a.slider.widget.drawActiveRange()})},logUserInteraction:function(a,b,d){if("ga"===this.options.loggingType){a="reset"===a?"showall":"";var c=null!=this.options.loggingAction?this.options.loggingAction:
this.name;d&&(a=g(b.target).hasClass("right")?"max-adjust":"min-adjust");this.base({category:this.trackCategory,action:c,label:this.options.loggingLabel||a})}else this.base(a)},setDisabled:function(a){this.base(a);this.slider.widget.element.toggleClass("Disabled",a)},shouldBeVisible:function(a){return!(isNaN(parseInt(a.minRange))||isNaN(parseInt(a.maxRange)))},willReset:function(){this.slider.setLeftRange(this.slider.minRange,!0);this.slider.setRightRange(this.slider.maxRange,!0)},cleanupExistingState:function(){this.slider.leftRange=
this.slider.rightRange=this.slider.minRange=this.slider.maxRange=void 0},update:function(a){var b=parseInt(a.minRange),d=parseInt(a.maxRange),c=parseInt(a.leftRange);a=parseInt(a.rightRange);var f=null===this.slider.leftRange||void 0===this.slider.leftRange||void 0===this.slider.minRange||this.slider.leftRange===this.slider.minRange,e=null===this.slider.rightRange||void 0===this.slider.rightRange||void 0===this.slider.maxRange||this.slider.rightRange===this.slider.maxRange;this.options.maxValueSlider&&
b!==this.slider.leftRange&&(f=!0);isNaN(b)||isNaN(d)||(this.slider.setMinRange(b),this.slider.setMaxRange(d),isNaN(c)?f&&this.slider.setLeftRange(this.slider.minRange,!0):this.slider.setLeftRange(c,!0),isNaN(a)?e&&this.slider.setRightRange(this.slider.maxRange,!0):this.slider.setRightRange(a,!0),this.element.removeClass("empty"))},getState:function(){var a={max:this.slider.rightRange};this.options.maxValueSlider||(a.min=this.slider.leftRange);return a},formatThousands:function(a){if("undefined"===
typeof a)return a;var b=this.options.thousandsDelimiter,d=this.options.decimalDelimiter,c=a.toString().split(".");a=c[0];d=1<c.length?d+c[1]:"";c=/(\d+)(\d{3})/;if(0<b.length)for(;c.test(a);)a=a.replace(c,"$1"+b+"$2");return a+d},formatDuration:function(a){var b=a%60;10>b&&(b="0"+b);return e.Common.Utils.String.replaceArgs(this.options.durationFormat,(a-b)/60,b)}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.results.filters.SpecificLegFilter","common.results.filters.Filter",{name:"specificleg",departLegSignature:null,arriveLegSignature:null,previousResultId:null,resultId:null,legSelectElementsClass:".Trains-Results-TrainsResultItem .trip-select .trip-button",init:function(){this.base()},addEventHandlers:function(){this.base();this.handleLegSelect()},handleLegSelect:function(){var a=this;c.events.subscribe("train.inline.detail.selectButton",function(b){b.initResultId?
(a.previousResultId=a.resultId,a.resultId=b.initResultId):(a.resultId=a.previousResultId,a.previousResultId=null);0===b.legNo?(a.departLegSignature=b.legSignature,b.isRoundTrip?(c.events.publish("train.legChange.reset"),a.clearOpenDetails(b.searchId),a.pushStateChange(!1,!1)):(a.arriveLegSignature=b.legSignature,a.pushStateChange(!1,!0))):1===b.legNo&&(a.arriveLegSignature=b.legSignature,a.pushStateChange(!1,!0));jq(window).scrollTop(0)});c.events.subscribe("train.selDepLeg.header.change",function(b){a.previousResultId=
null;a.resultId=null;a.departLegSignature=null;a.arriveLegSignature=null;c.events.publish("train.legChange.reset");a.clearOpenDetails(b.searchId);a.pushStateChange();jq(window).scrollTop(0)});c.events.subscribe("train.retLeg.reset",function(b){a.previousResultId?(a.resultId=a.previousResultId,a.previousResultId=null):(a.previousResultId=null,a.resultId=null,a.departLegSignature=null);a.arriveLegSignature=null;c.events.publish("train.legChange.reset");a.clearOpenDetails(b.searchId);a.pushStateChange();
jq(window).scrollTop(0)})},clearOpenDetails:function(a){c.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:a,key:"openDetails",value:""})},pushStateChange:function(a,b){c.events.publish("filters.changed",{name:this.name,state:!0===a?null:this.getState(),preventPageReset:b})},getState:function(){return{previousResultId:this.previousResultId,resultId:this.resultId,depLegSig:this.departLegSignature,arrLegSig:this.arriveLegSignature}}})})(R9,jQuery);(function(e,d){e.createComponentClass("common.results.filters.TimelineRangeFilter","common.results.filters.Filter",{minRange:void 0,maxRange:void 0,leftRange:void 0,rightRange:void 0,selectedLegSignature:null,slider:d(),leftDisplay:d(),rightDisplay:d(),options:{minRange:void 0,maxRange:void 0,step:1,timelineHours:void 0,handleTooltipText:void 0},init:function(){this.base();this.minRange=this.options.minRange;this.maxRange=this.options.maxRange;var a=this.getChildElement("rangeLabel");this.leftDisplay=
d(a.find(".min"));this.rightDisplay=d(a.find(".max"))},addEventHandlers:function(){var a=this;this.base();this.slider=this.getChildElement("slider").slider({range:!0,min:this.options.minRange,max:this.options.maxRange,step:this.options.step}).getWidget();this.slider.setOption("stop",function(c,b,f){f&&(a.setLeftRange(b[0]),a.setRightRange(b[1]),a.logUserInteraction(),a.pushStateChange())});this.slider.setOption("slide",function(c,b){a.slider.activeHandle&&jq(".r9-tooltip-wrapper.timelineHandle").hide();
a.setLeftRange(b[0]);a.setRightRange(b[1])});jq.each(this.slider.handles,function(c,b){jq(b).toolTip({delay:0,showImmediately:!1,extraClass:"timelineHandle",content:a.options.handleTooltipText})})},shouldBeVisible:function(a){return!(isNaN(parseInt(a.minRange))||isNaN(parseInt(a.maxRange)))},willReset:function(){this.setLeftRange(this.minRange,!0);this.setRightRange(this.maxRange,!0)},cleanupExistingState:function(){this.leftRange=this.rightRange=this.minRange=this.maxRange=void 0},reset:function(a){this.base(a);
for(var c in this.subscriptions)this.subscriptions.hasOwnProperty(c)&&this.unsubscribe(c)},update:function(a){var c=this,b=parseInt(a.minRange),f=parseInt(a.maxRange),d=parseInt(a.leftRange),g=parseInt(a.rightRange),e=void 0===this.leftRange||void 0===this.minRange||this.leftRange===this.minRange,h=void 0===this.rightRange||void 0===this.maxRange||this.rightRange===this.maxRange,k=a.timelineDepPoints,l=a.timelineDepTimes,m=a.timelineArrTimes,n=a.timelineHours,p=a.timelinePrices,q=a.timelineLegSignatures;
isNaN(b)||isNaN(f)||(this.slider.setOption("min",b),this.slider.setOption("max",f),this.setMinRange(b),this.setMaxRange(f),this.selectedLegSignature=a.selLegSignature,isNaN(d)?e&&this.setLeftRange(this.minRange,!0):this.setLeftRange(d,!0),isNaN(g)?h&&this.setRightRange(this.maxRange,!0):this.setRightRange(g,!0),this.setTimelinePoints(k,l,m,n,p,q),this.element.removeClass("empty"),1<this.slider.timelineElements.length&&jq.each(this.slider.timelineElements,function(a,b){jq(b).data("legSig")===c.selectedLegSignature&&
jq(b).addClass("selected");jq(b).off("click.timelinePoint").on("click.timelinePoint",function(){jq(this).hasClass("filteredOut")||(jq(this).hasClass("selected")?(c.selectedLegSignature=null,jq(this).removeClass("selected")):(c.selectedLegSignature=jq(this).data("legSig"),jq(this).addClass("selected")),c.pushStateChange())})}))},updateDisplay:function(a){a&&this.slider.setValues([this.leftRange,this.rightRange])},getState:function(){return{min:this.leftRange,max:this.rightRange,selLeg:this.selectedLegSignature}},
setMinRange:function(a){this.minRange=a;this.slider.setOption("min",a)},setMaxRange:function(a){this.maxRange=a;this.slider.setOption("max",a)},setLeftRange:function(a,c){this.leftRange=a;this.updateDisplay(c)},setRightRange:function(a,c){this.rightRange=a;this.updateDisplay(c)},setTimelinePoints:function(a,c,b,d,e,g){this.slider.setTimelinePoints(a,c,b,d,e,g)}})})(R9,jQuery);(function(h,f){h.createComponentClass("common.results.filters.ValueSetFilter","common.results.filters.Filter",{itemTemplateId:"valueSetFilterItem",content:null,renderedFilterOptions:null,options:{isMultiValueSet:!1,isDefaultChecked:!1,showAllNone:!1,onReset:null,sortInPlace:!1,flushState:!0,onDeselect:null,confineOnlyToHeading:!1,onChange:null,removeExpiredOptions:!0,visibleCount:0,preventNoneChecked:!1,showItemHoverTooltip:!1,reverseOptionOrder:!1,allowZeroCount:!1,disableOnZeroCount:!1,messages:{}},
events:{all:"filters.valueSetFilter.showall"},only:null,showOverflowLink:void 0,init:function(){this.base();this.renderedFilterOptions={};this.content=this.getChildElement("options");0<this.options.visibleCount&&(this.showOverflowLink=this.getChildElement("overflow"))},addEventHandlers:function(){this.base();var a=this;void 0!==this.showOverflowLink&&this.showOverflowLink.click(function(){a.element.hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0)});this.subscribe("filters.%s.setonly".format(this.name),
function(c){c=a.getRenderedFilterOptions()[c];a.options.preventNoneChecked&&(a.only.setSelectable(!0),c.setSelectable(!1));a.only=c});this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),this.onItemHover.bind(a));this.options.showAllNone&&(this.getChildElement("all").click(this.reset.bind(this,{type:"all",userClick:!0})),this.getChildElement("none").click(this.deselect.bind(this,{type:"none",userClick:!0})))},reset:function(a){if(!a||!(a.ignore===this.name||f.isArray(a.ignore)&&
-1<a.ignore.indexOf(this.name))){if("function"===typeof this.options.onReset)return this.options.onReset.apply(this,arguments);var c=this.options.isMultiValueSet&&!this.options.isDefaultChecked?0:1,b=this.options.flushState;this.forEachItem(function(e,d){d.state.disabled||d.state.noSelect||(void 0===d.state.showAllState||a&&"reset"===a.type?d.setChecked(void 0!==d.state.resetState?d.state.resetState:c):(b=!1,d.setChecked(d.state.showAllState)),this.options.preventNoneChecked&&d.setSelectable(!0))});
0<this.options.visibleCount&&this.hideOverflowOptions();a&&a.silent?h.events.publish("resultspage.filters.sync",{name:this.name,state:b?null:this.getState()}):this.pushStateChange(b);a&&a.userClick&&(this.setLastUserInteraction(!0),this.logUserInteraction("showall"))}},getResetType:function(){return this.options.isDefaultChecked?"showAll":this.base()},deselect:function(a){if(!a||!(a.ignore===this.name||f.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name))){if("function"===typeof this.options.onDeselect)return this.options.onDeselect.apply(this,
arguments);this.forEachItem(function(a,b){b.state.disabled||b.state.noSelect||(b.setChecked(0),this.options.preventNoneChecked&&b.setDisabled(!1))});0<this.options.visibleCount&&this.hideOverflowOptions();a&&a.silent?h.events.publish("resultspage.filters.sync",{name:this.name,state:this.getState()}):this.pushStateChange(!1);a&&a.userClick&&this.logUserInteraction(a.type)}},cleanupExistingState:function(){this.forEachItem(function(a,c){h.ComponentManager.remove(c.id())});this.renderedFilterOptions=
{};this.getOptionsContainer().empty()},sortRenderedFilterOptions:function(a){if(a.useHeadings)for(var c=Object.keys(a.headingValueMap),b=0;b<c.length;b++){var e=this.getOptionsContainer().find('.heading[data-heading\x3d"%s"]'.format(c[b])).find(".content");this.sortOptionsInPlace(e,a.headingValueMap[c[b]])}else this.sortOptionsInPlace(this.getOptionsContainer(),a.valueMap)},sortOptionsInPlace:function(a,c){var b=a.find(".Common-Results-Filters-ValueSetFilterItem");0!==b.length&&(b=b.toArray().sort(function(a,
b){a=c[f(a).data("name")];b=c[f(b).data("name")];return a&&b?a.displayOrder-b.displayOrder:0}),f(b).detach().appendTo(a))},addOptionToFilterMap:function(a,c,b,e,d){var g=this.id()+"-"+Math.floor(1E4*Math.random())+"-"+a.replace(/\W+/g,"");d=d||{};d=f.extend({id:g,name:a},c,d,{hasCount:this.options.allowZeroCount?0<=c.count:0<c.count,disabled:this.options.disableOnZeroCount?0==c.count:!1});d=h.template.renderElement(this.itemTemplateId,d);var l=c.displayOrder,k=null;this.forEachItem(function(a,b){b.state.displayOrder>
l&&(null!==k?k.state.displayOrder>b.state.displayOrder&&(k=b):k=b)},e);null===k||void 0!==b?b?(g=this.getOptionsContainer().find('.heading[data-heading\x3d"%s"]'.format(b)),g.length||(g=this.makeHeadingContainer(b),this.getOptionsContainer().append(g)),g.find(".content").append(d)):this.options.reverseOptionOrder?this.getOptionsContainer().prepend(d):this.getOptionsContainer().append(d):d.insertBefore(k.element);c=this.makeFilterOption(d,c,a,b);e[a]=c;c.element.on("mouseenter",this.publishHoverState.bind(this,
!0,{item:c.options.name}));c.element.on("mouseleave",this.publishHoverState.bind(this,!1,{item:c.options.name}))},addFilterItem:function(a,c,b){this.addOptionToFilterMap(a,c,b,this.getRenderedFilterOptions())},makeFilterOption:function(a,c,b,e){var d=this;return new h.common.results.filters.ValueSetFilterItem(a,{state:c,name:b,group:this.name,onUserChange:function(){d.filterItemDidChange.apply(d,Array.prototype.slice.call(arguments).concat(this))},heading:e,headingOnlyState:this.options.confineOnlyToHeading?
1:2,allowZeroCount:d.options.allowZeroCount,disableOnZeroCount:d.options.disableOnZeroCount,messages:this.options.messages})},makeHeadingContainer:function(a){var c="\x3cdiv class\x3d'heading' data-heading\x3d\""+a+'"\x3e%s\x3c/div\x3e';a="\x3cdiv class\x3d'title'\x3e%s\x3c/div\x3e\x3cdiv class\x3d'content'\x3e\x3c/div\x3e".format(a);return f(c.format(a))},shouldBeVisible:function(a){return(a=a.useHeadings?a.headingValueMap:a.valueMap)&&0<Object.keys(a).length},logUserInteraction:function(a,c){if("ga"===
this.options.loggingType){a=a.split("/");var b=void 0;a[0]&&(b="reset"===a[0]?"showall":a[0]);var e=this.getRenderedFilterOptions()[a[0]];a[1]&&"toggle"===a[1]&&e&&(a[1]=e.state.selected?"show":"hide");a[1]&&(b=(c?"":a[1]+"-")+b+(c?"-"+a[1]:""));this.base({category:this.trackCategory,action:this.name,label:b})}else this.base(a)},filterItemDidChange:function(a,c,b){"only"===c||"price"===c||"count"===c?(this.only=this.getRenderedFilterOptions()[a],this.forEachItem(function(b,c){c.options.state.ignoreOnly||
c&&b!=a&&(this.only.options.heading&&this.options.confineOnlyToHeading?this.only.options.heading===c.options.heading&&c.setChecked(0):c.setChecked(0))}),"price"===c&&h.events.publish("filters.selectedprice",{ignore:this.name})):this.only&&(a!==this.only.options.name?(this.only.setChecked(1),this.only=null):a===this.only.options.name&&2!==this.only.state.selected&&(this.only=null));"function"===typeof this.options.onChange&&this.options.onChange.call(this,b);this.options.logUserInteraction&&this.logUserInteraction(a+
"/"+c);(c=this.getState())&&0!==c[a]&&h.events.publish("gtm.update",{event:"resultsFilterChange",filterName:this.name,filterValue:a});this.setLastUserInteraction(!0);this.pushStateChange()},update:function(a){var c=!1;if(a.useHeadings){for(var b=a.headingValueMap,e=Object.keys(b),d=0;d<e.length;d++){var g=e[d],g=this.updateItems(b[g],g);c||(c=g)}a.orderedHeadings&&this.getOptionsContainer().find(".heading").sort(function(b,c){return a.orderedHeadings.indexOf(f(b).data("heading"))>a.orderedHeadings.indexOf(f(c).data("heading"))?
1:a.orderedHeadings.indexOf(f(b).data("heading"))<a.orderedHeadings.indexOf(f(c).data("heading"))?-1:0}).appendTo(this.getOptionsContainer())}else c=this.updateItems(a.valueMap);this.options.sortInPlace&&this.sortRenderedFilterOptions(a);this.element.hasClass("empty")&&c&&this.element.removeClass("empty")},updateItems:function(a,c){if(!a)return!1;var b=this,e=Object.keys(a),d=0<e.length,g=0,f=!1,e=e.sort(function(b,c){return a[b].displayOrder-a[c].displayOrder});e.filter(function(a){return b.getRenderedFilterOptions().hasOwnProperty(a)}).forEach(function(c){var d=
a[c];b.getRenderedFilterOptions()[c].update(d)});e.forEach(function(d){g++;var e=a[d];b.getRenderedFilterOptions().hasOwnProperty(d)||b.addFilterItem(d,e,c);0<b.options.visibleCount&&g>b.options.visibleCount&&(0===e.selected||b.options.isDefaultChecked)?(b.getRenderedFilterOptions()[d].element.addClass("overflow-item"),f=!0):b.getRenderedFilterOptions()[d].element.removeClass("overflow-item");2===e.selected&&(b.only=b.getRenderedFilterOptions()[d])});this.options.preventNoneChecked&&this.disableOnlyOption();
void 0===this.showOverflowLink||this.element.hasClass("overflow-visible")||this.showOverflowLink.toggleClass("visible",f);this.handleExpiredOptions(a,c);return d},handleExpiredOptions:function(a,c){this.forEachItem(function(b,e){a.hasOwnProperty(b)||e.options.heading!==c||(this.options.removeExpiredOptions?(h.ComponentManager.remove(e.id()),delete this.getRenderedFilterOptions()[b]):e.setChecked(0))})},disableOnlyOption:function(){var a=this.getRenderedFilterOptions();if("object"===typeof a&&0!==
a.length){var c=Object.keys(a),b=c.filter(function(b){return 0<a[b].getState()});c.forEach(function(b){a[b].setSelectable(!0)});1===b.length?a[b[0]].setSelectable(!1):0===b.length&&this.log.warn("ValueSetFilter#DisableOnlyOption: No filter options checked while preventNoneChecked is true. \nFilter name: "+this.options.name)}},onItemHover:function(a){!0===a.hover?(a=this.renderedFilterOptions[a.item],a.element.toolTip({content:a.options.state.displayValue,position:"top",showImmediately:!0,delay:1E3})):
!1===a.hover&&(a=this.renderedFilterOptions[a.item],a.element.data("toolTip")&&a.element.data("toolTip").removeWidget())},showOverflowOptions:function(a){this.element.addClass("overflow-visible");this.showOverflowLink.find(".text").html(this.showOverflowLink.data("less"));a&&this.logUserInteraction("overflow/showmore",!0);h.events.publish("filter.overflow.toggle")},hideOverflowOptions:function(a){this.element.removeClass("overflow-visible");this.showOverflowLink.find(".text").html(this.showOverflowLink.data("more"));
a&&this.logUserInteraction("overflow/showless",!0);h.events.publish("filter.overflow.toggle")},forEachItem:function(a,c){var b=this;c=c||this.getRenderedFilterOptions();Object.keys(c).forEach(function(e){a.call(b,e,c[e])},this)},getRenderedFilterOptions:function(){return this.renderedFilterOptions},getOptionsContainer:function(){return this.content},getState:function(){var a={};this.forEachItem(function(c,b){b=b.getState();null!==b&&(a[c]=b)},f.extend({},this.getRenderedFilterOptions()));return a}})})(R9,
jQuery);(function(c,e){c.createComponentClass("common.results.filters.ValueSetFilterItem",{checkbox:null,options:{name:null,loggingValue:null,group:null,state:{displayValue:null,minPrice:null,selected:0,info:!1,showAllSate:void 0,resetState:void 0,noSelect:!1,disabled:!1,hideOnly:!1,ignoreOnly:!1,displayOrder:0,filtered:!1,partiallyFiltered:!1,dynamicFilterTipText:null,href:null,cssClass:null,count:0},withImage:!1,onlyOnClick:!1,heading:void 0,headingOnlyState:1,onUserChange:e.noop,allowZeroCount:!1,disableOnZeroCount:!1,
messages:{}},events:{only:"filters.valueSetFilterItem.only"},eventPrefix:"",loggingPrefix:"Filters",state:null,init:function(){this.state=e.extend({},this.options.state||{});this.checkbox=this.getChildElement("check");this.price=this.getChildElement("price");this.count=this.getChildElement("count");this.innerCount=e("span",this.count);this.checkbox.prop("checked",0<this.state.selected);this.eventPrefix="filters.%s.%s.".format(this.options.group,this.options.name);this.options.onUserChange=this.options.onUserChange.bind(this,
this.options.name);this.update(this.state);"string"===typeof this.state.cssClass&&this.element.addClass(this.state.cssClass)},addEventHandlers:function(){var a=this;this.element.find(".Common-Widgets-Checkbox").click(function(b){b.preventDefault();if(!a.options.state.disabled&&!a.options.state.noSelect){b=0<a.state.selected?0:1;var d="toggle";a.options.onlyOnClick&&2!==a.state.selected&&(b=2,d="only");a.setChecked(b);a.options.onUserChange(d);c.Analytics.api.trackEvent({category:a.loggingPrefix,action:a.options.group,
label:(0<a.state.selected?"show":"hide")+"-"+a.options.name})}});this.price.click(function(){a.options.state.disabled||a.options.state.hideOnly||a.options.state.noSelect||(a.setChecked(1),a.options.onUserChange("price"),c.Analytics.api.trackEvent({category:a.loggingPrefix,action:a.options.group,label:"price"}))});this.count.click(function(){a.options.state.disabled||a.options.state.hideOnly||a.options.state.noSelect||(a.setChecked(1),a.options.onUserChange("count"),c.Analytics.api.trackEvent({category:a.loggingPrefix,
action:a.options.group,label:"count"}))});this.getChildElement("only").click(function(b){b.stopPropagation();a.options.state.disabled||(a.options.heading?a.setChecked(a.options.headingOnlyState):a.setChecked(2),a.options.onUserChange("only"))});this.subscribe(this.eventPrefix+"setchecked",this.setChecked.bind(this));this.subscribe(this.eventPrefix+"setchecked.force",function(b){a.setChecked(b.selected,b.changeType||"toggle")});this.subscribe(["filters.disabled",this.eventPrefix+"disabled"],this.setDisabled.bind(this))},
setDisabled:function(a){this.options.state.disabled=a;this.element.toggleClass("Disabled",a);this.checkbox.parent().toggleClass("Disabled",a)},setSelectable:function(a){this.options.state.noSelect=!a;this.element.toggleClass("Disabled",!a);this.checkbox.parent().toggleClass("Disabled",!a)},setPrice:function(a){this.state.minPrice=a;this.price.text(a)},setCount:function(a){this.state.count=a;this.innerCount.text(a)},setChecked:function(a,b){var d=this.state.selected!==a;this.state.selected=a;this.checkbox.prop("checked",
0<this.state.selected);if(d&&(c.events.publish(this.eventPrefix+"changed",this.state),b))this.options.onUserChange(b)},setDisplayValue:function(a){this.element.find(".label").text(a);this.state.displayValue=a},update:function(a){this.count.length&&0===a.count&&this.options.disableOnZeroCount&&(a.disabled=!0,a.selected=!1);a.cssClass&&a.cssClass!==this.state.cssClass&&(this.element.removeClass(this.state.cssClass),this.element.addClass(a.cssClass),this.state.cssClass=a.cssClass);this.setChecked(a.selected);
this.state.minPrice!==a.minPrice&&this.setPrice(a.minPrice);this.state.displayValue!==a.displayValue&&this.setDisplayValue(a.displayValue);0===a.count&&!this.options.allowZeroCount||a.count===this.state.count||this.setCount(a.count);this.state.displayOrder=a.displayOrder;this.element.hasClass("empty")&&this.element.removeClass("empty");if(a.filtered||a.partiallyFiltered){var b=a.filtered?this.options.messages.filtered:this.options.messages.partiallyFiltered;b&&(b=c.Common.Utils.String.formatString(b,
a.displayValue),this.element.addClass("Filtered"+(a.filtered?" FilteredOut":"")).find(".funnel").attr("title",b).toolTip({position:"top"}))}else this.element.removeClass("Filtered FilteredOut").find(".funnel").attr("title","");this.element.toggleClass("No-Only",a.hideOnly);this.element.toggleClass("NoSelect",a.noSelect);this.setDisabled(a.disabled);a.href?(this.price.attr("href",a.href),this.price.attr("target","_blank")):this.price.attr("href",null)},getState:function(){return this.options.state.disabled?
null:this.state.selected}})})(R9,jQuery);(function(c,e){c.createComponentClass("common.results.AfterclickContainer",{options:{searchId:"",url:"",rateLimitCount:c.config.getInt("ui.afterclick.rate_limited_occurrence",2),rateLimitPeriod:864E5,rateLimitStorageKey:"hotel_afterclick_last"},searchId:"",dialogContent:null,dialog:null,init:function(){this.dialogContent=this.getChildElement("content");this.searchId=this.options.searchId;this.options.rateLimitStorageKey||(this.options.rateLimitStorageKey="hotel_afterclick_last")},addEventHandlers:function(){if(!c.config.getBoolean("ui.no.popup.enabled",
!1)||"notloggedin"===c.globals.analytics.loginState){var a=this;c.events.subscribe("multibook.providerClicked",function(b){b&&b.afterclickIgnore||c.config.getBoolean("ui.ignore.afterclick.popup",!1)||a.openAfterclick(b.resultId)});c.events.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId})}},rateLimit:function(a){if(!c.config.getBoolean("ui.afterclick.rate_limited",!0))return!1;a=a||{};var b=new Date,g=isNaN(a.rateLimitCount)?2:a.rateLimitCount,e=isNaN(a.rateLimitPeriod)?
864E5:a.rateLimitPeriod,f=a.rateLimitStorageKey,d;if(!c.storage.isAvailable()||!f)return!1;if("prevent"===c.storage.get("prevent-afterclick"))return c.storage.remove("prevent-afterclick"),!0;a=c.storage.get(f);"string"===typeof a&&(a=[]);if(!a||a.length<g)return a=a?a.concat(b.getTime()):[b.getTime()],c.storage.set(f,a),!1;for(d=0;d<g;d++){if(isNaN(a[d]))return c.storage.set(f,[b.getTime()]),!1;if(b.getTime()-(new Date(a[d])).getTime()>e)return a[d]=b.getTime(),c.storage.set(f,a),!1}return!0},openAfterclick:function(a){var b=
this;b.dialog&&b.dialog.isOpen()||!b.options.url||!b.searchId||b.rateLimit(this.options)||(a={resultId:a,searchId:b.searchId},c.Analytics.api.trackEvent({category:"AfterClick",action:"request"}),c.ajax.execute(b.options.url,{data:a,appendTo:this.dialogContent,replace:!0}).then(function(a){b.dialog=b.getChildElement("afterclickdialog").dialog({blur:!0}).getWidget();a=b.getChildElement("content").children().eq(0);if(e("#acerror").length){try{c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",
label:e("#acerror").get(0).innerText.trim()})}catch(h){}console.log(e("#acerror").get(0).innerText)}else c.Analytics.api.trackEvent({category:"AfterClick",action:"displayed"}),b.dialog.setContentDimensions(a.outerWidth(),a.outerHeight()),b.dialog.open()}).fail(function(a){c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:"ajax"})}))}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.results.AllResultsFiltered",{addEventHandlers:function(){this.getChildElement("resetAll").click(function(){a.events.publish("filters.reset",{type:"showAll"})});this.element.find(".leaveBehindFiltersRow:not(.resetAll) \x3e a").click(function(){var c=b(this).data("filter-name");a.events.publish("filter.reset",{name:c})})}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.results.BookingLinksExpiredDialog",{expiredResultsDialog:null,options:{redirectUrl:""},addEventHandlers:function(){a.events.subscribe("search.expired",this.showBookingLinksExpiredDialog.bind(this))},showBookingLinksExpiredDialog:function(){if(null===this.expiredResultsDialog){this.expiredResultsDialog=this.element.dialog({onClose:function(){a.events.publish("resultspage.transition.remove")}}).getWidget();var c=this.options.redirectUrl?this.options.redirectUrl:
"/";this.getChildElement("home-btn").click(function(){a.Analytics.api.trackEvent("booklinkexpired/homepage");window.location=c});this.getChildElement("refresh-btn").click(function(){b(document.body).css("cursor","wait");a.Analytics.api.trackEvent("booklinkexpired/refresh");window.location.reload()})}this.expiredResultsDialog.open()}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.CurrencyConversionInfo",{options:{vertical:null,dialogContainerId:"currencyConversionInfoDialogContent",linkSelector:"a.dialog"},dialog:null,addEventHandlers:function(){this.base();var a=this;this.element.find(this.options.linkSelector).click(function(b){b.preventDefault();a.showDialog()})},destroyDialog:function(){this.dialog&&(this.dialog.close(),this.dialog=null)},showDialog:function(){this.destroyDialog();this.dialog=this.getChildElement(this.options.dialogContainerId).dialog({}).getWidget();
this.dialog.open()}})})(R9);(function(b,c){b.createComponentClass("common.results.DisplayCounts",{filteredCount:null,totalCount:null,showAllLink:null,product:null,baseProductString:null,options:{withUnits:!1,labelMsg:"",filteredCountId:"",totalCountId:"",pluralProductMsg:"",singleProductMsg:""},init:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.baseProductString=this.product.html()},addEventHandlers:function(){this.subscribe("resultspage.results.count.changed",
this.updateCounts.bind(this));this.subscribe(["search.searchFailed","search.startSearch"],this.updateCounts.bind(this,{filtered:0,total:0}));this.bindShowAll()},bindShowAll:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.showAllLink=this.element.find("a.showAll").eq(0);this.showAllLink.click(function(){c(this).hasClass("disabled")||(b.events.publish("filters.reset",{type:"showAll"}),
b.Analytics.api.trackEvent({category:"Filters",action:"see-all-results"}))})},updateCounts:function(a){if(this.options.withUnits)this.filteredCount.text(a.filtered),this.totalCount.text(a.total),this.showAllLink.css("display",a.filtered===a.total?"none":"inline-block");else{var d="\x3cspan id\x3d"+this.options.filteredCountId+"\x3e"+a.filtered+"\x3c/span\x3e",c="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3c/a\x3e",
f="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3cspan class\x3d'product'\x3e "+this.options.pluralProductMsg+"\x3c/span\x3e\x3c/a\x3e",e=this.getChildElement("showLabel"),d=b.Common.Utils.String.formatChoice(this.options.labelMsg,a.filtered,a.filtered,d,c,f,this.options.pluralProductMsg,this.options.singleProductMsg,e.length?e[0].outerHTML:"");this.element.html(d);this.bindShowAll()}this.element.find("a.showAll").toggleClass("disabled",
a.filtered===a.total);a.hasOwnProperty("product")?this.product.html(a.product):this.product.html()!==this.baseProductString&&this.product.html(this.baseProductString)}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.results.HotListButton",{options:{checked:!1,resultId:null,tips:null,vslog:""},init:function(){},addEventHandlers:function(){this.element.on("click",this.onClickToggle.bind(this));this.subscribe("hotlist.add",this.options.resultId,this.onHotlistAdd.bind(this));this.subscribe("hotlist.remove",this.options.resultId,this.onHotlistRemove.bind(this))},onClickToggle:function(a){a.stopPropagation();a=this.options.checked?"hotlist.remove":"hotlist.add";var c=this.options.checked?
"uncheck":"check";this.options.resultId&&b.events.publish(a,this.options.resultId);this.options.vslog&&b.Analytics.api.trackEvent("hotlist/"+this.options.vslog+c)},onHotlistAdd:function(){var a=this.options.tips||{};this.options.checked=!0;this.element.addClass("checked").attr("title",a.remove)},onHotlistRemove:function(){var a=this.options.tips||{};this.options.checked=!1;this.element.removeClass("checked").attr("title",a.add)}})})(window.R9,window.jQuery);(function(b,e){b.createComponentClass("common.results.HotListContainer",{options:{key:"",hotListComponent:"",resultIds:[],searchId:"",mapEnabled:!1,cityLat:0,cityLng:0,markerImg:""},resultIds:[],searchId:"",results:null,markers:{},queue:[],mapReady:!1,mapInit:!1,init:function(){this.results=this.getChildElement("results");this.options.resultIds.length&&(this.resultIds=this.options.resultIds);this.options.searchId&&(this.searchId=this.options.searchId);this.options.mapEnabled&&b.Maps.Google.load(this.setupMap.bind(this));
this.updateVisibility()},addEventHandlers:function(){var a=this;this.subscribe("hotlist.fetch",this.fetchHotlist.bind(this));this.subscribe("hotlist.add",this.addResult.bind(this));this.subscribe("hotlist.remove",this.removeResult.bind(this));this.options.mapEnabled&&(this.subscribe("hotlist.initMap",this.setupMap.bind(this)),this.subscribe("hotlist.map",this.mapLocations.bind(this)),b.events.when("hotlist.map.ready",this.onMapReady.bind(this)));this.subscribe("resultspage.cleanup",function(){a.clear()});
this.subscribe("hotlist.clear",function(){a.clear(!0)});this.subscribe("resultspage.searchId.changed",function(c){a.searchId=c.searchId;a.clear();a.fetchHotlist()})},onMapReady:function(){for(;this.queue.length;)this.queue.shift().call(this)},fetchHotlist:function(){var a=this;a.updateVisibility();this.options.hotListComponent&&b.ajax.execute(this.options.hotListComponent,{data:{searchId:this.searchId},appendTo:this.results,replace:!0}).then(function(){a.element.removeClass("adding");a.updateVisibility()})},
clear:function(a){b.ComponentManager.remove(this.results.children().first());a&&(this.resultIds=[],this.updateMetaCookie(!1),this.updateVisibility())},addResult:function(a){-1==this.resultIds.indexOf(a)&&(this.resultIds.push(a),this.element.addClass("adding"),this.updateMetaCookie(!0))},removeResult:function(a){var c=this.resultIds.indexOf(a);-1!=c&&(b.ComponentManager.remove(this.element.find("[data-resultid\x3d%s]".format(a))),this.resultIds.splice(c,1),this.updateMetaCookie(!1),this.updateVisibility(),
this.options.mapEnabled&&(this.markers[a].setMap(null),delete this.markers[a],this.fitMapBounds()))},updateMetaCookie:function(a){var c=this;this.options.key&&b.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"metaCookie",searchId:this.searchId,key:this.options.key,value:this.resultIds.join(",")}).then(function(){a&&c.fetchHotlist()})},updateVisibility:function(){this.element.find("[data-resultid]").length?this.element.removeClass("hidden"):this.element.addClass("hidden")},
setupMap:function(){this.center=new google.maps.LatLng(this.options.cityLat,this.options.cityLng);this.mapNode=this.getChildElement("map").get(0);b.events.ready("hotlist.map.ready");this.mapReady=!0},showMap:function(){this.getChildElement("mapWrapper").removeClass("hidden");this.mapInit||(this.map=new google.maps.Map(this.mapNode,{center:this.center,zoom:15,disableDefaultUI:!0}),this.map.set("styles",b.Common.Widgets.Maps.Styles.MapInlineDetailsStyle.getGoogleStyle().styles),this.mapInit=!0)},mapLocations:function(a){var c=
this,b=function(){c.showMap();var b=[];e.each(a.locations,function(a,d){b.push(d.hotelId);c.markers.hasOwnProperty(d.hotelId)||(c.markers[d.hotelId]=c.makeMarker(d))});for(var d in c.markers)c.markers.hasOwnProperty(d)&&-1===b.indexOf(d)&&(c.markers[d].setMap(null),delete c.markers[d]);c.fitMapBounds()};this.mapReady?b():this.queue.push(b)},makeMarker:function(a){return new google.maps.Marker({position:new google.maps.LatLng(a.lat,a.lng),map:this.map,title:a.name,icon:this.options.markerImg})},fitMapBounds:function(){var a=
this,c=new google.maps.LatLngBounds;e.each(this.markers,function(a,b){c.extend(b.position)});setTimeout(function(){a.map.fitBounds(c);if(1===a.markers.length)var b=google.maps.event.addListener(a.map,"idle",function(){a.map.setZoom(11);google.maps.event.removeListener(b)})},400)}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.results.InlineTravelAudienceAd",{options:{templateIdPrefix:"",templateSlots:[],taAdClient:"",taDateFrom:"",taDateTo:"",taNumPax:"",taKeywords:"",taAirport:"",taNumChildren:""},travelAudienceParams:{travelaudience_ad_position:"1",travelaudience_ad_width:"782",travelaudience_ad_height:"171",travelaudience_ad_type:"text/swf",travelaudience_color_text:"#000000",travelaudience_color_bg:"#ffffff",travelaudience_color_hover:"#ffffff"},travelAudienceColors:{swoodoo:{headline:"#000000",
price:"#000000",border:"#ffffff",url:"#61B500",headline_hover:"#000000",hover:"#ffffff",button:"#AD2333"},checkfelix:{headline:"#000000",price:"#000000",border:"#ffffff",url:"#60b400",headline_hover:"#000000",hover:"#F9f9f9",button:"#2e9ae4"}},init:function(){this.options.taAdClient&&(window.travelaudience_dynamic=!0,"undefined"===typeof travelaudience&&d.getScript("https://ads.travelaudience.com/inv2/",c.events.ready.bind(c.events,"travelaudience.script.loaded","")))},collectTravelAudienceParams:function(){var a=
this.travelAudienceParams;a.travelaudience_ad_client=this.options.taAdClient;a.travelaudience_date_from=this.options.taDateFrom;a.travelaudience_date_to=this.options.taDateTo;a.travelaudience_keywords=this.options.taKeywords;a.travelaudience_airport=this.options.taAirport;a.travelaudience_num_pax=this.options.taNumPax;a.travelaudience_num_children=this.options.taNumChildren;var b=this.travelAudienceColors.swoodoo;c&&c.globals&&c.globals.affiliate&&0===c.globals.affiliate.indexOf("checkfelix")&&(b=
this.travelAudienceColors.checkfelix);a.travelaudience_color_headline=b.headline;a.travelaudience_color_price=b.price;a.travelaudience_color_border=b.border;a.travelaudience_color_url=b.url;a.travelaudience_headline_color_hover=b.headline_hover;a.travelaudience_color_hover=b.hover;a.travelaudience_button_bg=b.button;return a},loadTravelAudienceAds:function(){this.unsubscribe("resultspage.streaming.done");if(0<d("#"+this.id()).length){var a=this.getAttachedTemplateSlots();if(0<a.length){var b=this.collectTravelAudienceParams();
c.events.when("travelaudience.script.loaded",function(){"undefined"!==typeof travelaudience&&travelaudience.requestPlacements(a,b)})}}},getAttachedTemplateSlots:function(){var a=this.options.templateSlots,b=this.options.templateIdPrefix,c=[];0<a.length&&b&&a.forEach(function(a){a=b+a;0<d("#"+a).length&&c.push(a)});return c},addEventHandlers:function(){this.options.taAdClient&&this.subscribe("resultspage.streaming.done",this.loadTravelAudienceAds.bind(this))}})})(R9,jQuery);(function(a,b){a.createComponentClass("common.results.LaserswordProgressBar","common.results.ProgressBar",{addEventHandlers:function(){var a=this;this.base();this.getChildElement("switch").click(function(){a.element.toggleClass("Blue").toggleClass("Red")})}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.NoResults","common.results.SearchFailed",{options:{vertical:null},addEventHandlers:function(){this.base();var b=this;a.events.ready("common.results.NoResults.ready",this.element);this.getChildElement("newSearchLink").click(function(c){c.preventDefault();a.events.publish(b.options.vertical+".inline.search.form.show",{focus:!0});return!1});a.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this))},handleSearchFailure:function(a){a&&
a.type===this.failureTypes.NO_RESULTS&&this.showSearchFailedView()}})})(R9);(function(g,c){g.createComponentClass("common.results.Paginator",{trackCategory:"Pagination",activeIndex:0,pageCount:0,pageNumberTemplateId:"paginatorItem",numbered:!0,loader:null,loading:!1,activeSearch:!1,options:{button:!1,infinite:!1,silent:!1,maxPages:5,infiniteScrollingOffset:0,logUserInteraction:!1},init:function(){this.element.hide();this.numbered=!this.options.button&&!this.options.infinite;this.numbered||(this.loader=this.getChildElement("loader"))},addEventHandlers:function(){var a=this;
this.subscribe("resultspage.searchId.changed",function(){a.activeSearch=!0});this.subscribe("resultspage.pageNumber.changed",function(b){a.setIndex(b);a.updateDOM()});this.subscribe("paginator.update",function(b){a.setIndex(b.pageNumber);a.updateBounds(b.pageCount);if(a.options.infinite)if(b.pageNumber===b.pageCount)c(window).off("scroll.pagination");else if(1===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));if(a.options.button){if(b.pageNumber===b.pageCount||1===b.pageNumber)c(window).off("scroll.pagination");
else if(2===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));b.pageNumber===b.pageCount||0===b.pageCount?a.element.hide():a.element.show()}a.updateDOM()});this.subscribe("paginator.hide",function(){a.element.hide()});this.numbered?(this.element.find("a.page-Previous").click(function(b){1>=a.activeIndex?b.preventDefault():(a.options.logUserInteraction&&a.logUserInteraction("Prev"),a.userChangedIndex(--a.activeIndex))}),this.element.find("a.page-Next").click(function(b){a.activeIndex>=
a.pageCount?b.preventDefault():(a.options.logUserInteraction&&a.logUserInteraction("Next"),a.userChangedIndex(++a.activeIndex))})):this.subscribe("search.poll.response",function(){a.element.removeClass("loading");a.loading=!1});this.options.button&&this.getChildElement("loadMore").click(function(){a.element.addClass("loading");a.logUserInteraction("More");a.userChangedIndex(++a.activeIndex)});if(this.options.infinite)c(window).on("scroll.pagination",a.scrollPagination.bind(a))},logUserInteraction:function(a,
b){g.Analytics.api.trackEvent({category:this.trackCategory,action:a,label:b})},scrollPagination:function(){!this.loading&&this.activeSearch&&this.element.offset().top<c(window).scrollTop()+(c(window).height()+this.options.infiniteScrollingOffset)&&(this.element.addClass("loading"),this.loading=!0,this.userChangedIndex(++this.activeIndex))},userChangedIndex:function(a){this.setIndex(a);g.events.publish("paginator.change",{pageNumber:a,append:this.options.button||this.options.infinite})},setIndex:function(a){this.activeIndex=
a},getIndex:function(){return this.activeIndex},updateBounds:function(a){this.pageCount!==a&&(this.pageCount=a)},updateDOM:function(){var a=this;this.numbered&&!this.options.silent&&c("[page-idx]").each(function(){parseInt(c(this).attr("page-idx"))===a.activeIndex?c(this).removeClass("Paginator-Item-Hidden"):c(this).addClass("Paginator-Item-Hidden")});this.options.infinite||this.options.button||(1<this.pageCount?(this.element.show(),this.numbered&&(this.renderDisplayRange(),this.element.find("a.page-Next, a.page-Previous").removeClass("disabled"),
this.activeIndex===this.pageCount?this.element.find("a.page-Next").addClass("disabled"):1===this.activeIndex&&this.element.find("a.page-Previous").addClass("disabled"))):this.element.hide())},renderPageLink:function(a){return g.template.render(this.pageNumberTemplateId,{index:a,cssClass:a===this.activeIndex?"active":""})},renderEllipsis:function(){return"\x3cspan\x3e\x26nbsp;\x26hellip;\x26nbsp;\x3c/span\x3e"},renderDisplayRange:function(){var a=this,b=this.element.find("div.page-Numbers");b.html("");
var f=this.renderPageLink(1),d=0<this.activeIndex-1?this.activeIndex-1:1,e=d+this.options.maxPages-1;e>=this.pageCount&&(e=this.pageCount,d=e-this.options.maxPages+1);for(2<d?f+=this.renderEllipsis():2>d?d=2:--e;d<e;d++)f+=this.renderPageLink(d);e<this.pageCount&&(f+=this.renderEllipsis());f+=this.renderPageLink(this.pageCount);b.html(f).find("a").click(function(){c(this).parent().hasClass("active")||(a.options.logUserInteraction&&a.logUserInteraction("Page",c(this).data("idx")),a.userChangedIndex(c(this).data("idx")),
c(this).parent().addClass("active"))})}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.results.ProgressBar",{bar:null,timerId:null,currentValue:null,startTime:null,elapsedTime:null,delayInterval:150,options:{linear:!1,totalTime:6E4,interval:750,percentage:0,visible:!0,startEvents:["search.startSearch"],stopEvents:["resultspage.streaming.done","resultspage.streaming.firstPhase.done"]},init:function(){this.bar=this.getChildElement("bar");0<this.options.percentage&&(this.currentValue=this.options.percentage);this.options.visible&&this.startTimer()},
addEventHandlers:function(){var a=this;this.subscribe(this.options.stopEvents,function(){a.finish()});this.subscribe(this.options.startEvents,function(){a.stopTimer();a.element.addClass("Reset");a.setPercentage(0);setTimeout(function(){a.element.removeClass("Reset");a.start()},400)})},setPercentage:function(a){isNaN(a)||(this.currentValue=100<a?100:a,this.bar.width("%s%".format(this.currentValue)))},getPosition:function(a){return this.options.linear?a:(3.4+(1-Math.exp(-(6*a-1.5))))/4.4},timerCallback:function(){this.elapsedTime=
(new Date).getTime()-this.startTime;if(this.elapsedTime>=this.options.totalTime)this.finish();else if(100===this.currentValue)this.finish();else{var a=100*this.getPosition(this.elapsedTime/this.options.totalTime);this.setPercentage(a);b.events.publish("progressbar.percentage.change",{percent:a});this.setNextTimeout(this.delayInterval)}},finish:function(){var a=this;this.setPercentage(100);this.stopTimer();setTimeout(function(){a.element.addClass("Hidden")},400)},start:function(){this.element.removeClass("Hidden");
this.startTimer()},setNextTimeout:function(a){var b=this;this.timerId=window.setTimeout(function(){b.timerCallback()},a)},startTimer:function(){null===this.timerId&&(this.elapsedTime=0,this.startTime=(new Date).getTime(),this.setNextTimeout(this.delayInterval))},stopTimer:function(){null!==this.timerId&&(window.clearTimeout(this.timerId),this.startTime=this.timerId=null)}})})(R9,jQuery);(function(b){window.showUsSanctionedCountriesPopup=function(){window.open("http://www.treasury.gov/resource-center/sanctions/Programs/Pages/Programs.aspx","_blank")};b.createComponentClass("common.results.SearchFailed",{defaultErrorMessage:null,hasUniqueNoResultsMessage:!1,failureTypes:{BAD_QUERY:"query",NO_RESULTS:"noresults",SERVER_ISSUE:"server",TIMEOUT:"timeout"},init:function(){var a=this;this.defaultErrorMessage=this.getChildElement("reason").html();b.events.when("common.results.NoResults.ready",
function(){a.hasUniqueNoResultsMessage=!0})},addEventHandlers:function(){b.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this));b.events.subscribe("search.startSearch",this.hideSearchFailedView.bind(this));b.events.subscribe("resultspage.requestResults",this.hideSearchFailedView.bind(this))},handleSearchFailure:function(a){this.hasUniqueNoResultsMessage&&a&&a.type===this.failureTypes.NO_RESULTS?this.hideSearchFailedView():this.showSearchFailedView(a&&a.userDisplayMessage?a.userDisplayMessage:
this.defaultErrorMessage)},showSearchFailedView:function(a){this.getChildElement("reason").html(a);this.element.show()},hideSearchFailedView:function(){this.element.hide()}})})(R9);(function(d,e){d.createComponentClass("common.results.Sharing",{dialog:null,urlInput:null,clipper:null,copyTooltip:null,emailFrom:null,emailTo:null,emailMessage:null,message:null,form:null,send:null,hid:null,rating:null,photoColumn:null,cityName:"",cityImageUrl:"",options:{vertical:"hotels",sourceId:void 0,messages:{},useClipboardCopy:!1,photoColumn:!1,hasRating:!1,useStars:!0},init:function(){var a=this;this.form=this.getChildElement("form");this.dialog=this.getChildElement("dialog").dialog({onClose:function(){a.emailTo.removeClass("form-error");
a.emailFrom.removeClass("form-error");a.clearMessage();d.Analytics.api.trackEvent({category:"Share",action:"close-share"});a.options.photoColumn&&a.clearSharingData()}}).getWidget();this.urlInput=this.getChildElement("url");this.options.useClipboardCopy?this.clipper=new d.utils.ClipboardCopy("#"+a.id("copy")):"undefined"!==typeof window.Clipboard?this.clipper=new Clipboard("#"+this.id("copy")):(this.element.find(".col-copy").hide(),this.element.find(".col-url").removeClass("col-url").addClass("col"));
this.copyTooltip=this.getChildElement("tooltip");this.emailFrom=this.getChildElement("emailFrom");this.emailTo=this.getChildElement("emailTo");this.emailMessage=this.getChildElement("emailMessage");this.hid=this.getChildElement("sharing_email_resultid");this.send=this.getChildElement("send");this.options.photoColumn&&(this.options.hasRating&&(this.rating=a.getChildElement("rating").children()),this.photoColumn=a.getChildElement("photoColumn"))},addEventHandlers:function(){var a=this;if(null!==this.clipper&&
!this.options.useClipboardCopy)this.clipper.on("success",function(b){d.Analytics.api.trackEvent({category:"Share",action:"copy-link"});a.copyTooltip.addClass("show");setTimeout(function(){a.copyTooltip.removeClass("show")},2E3)});d.events.subscribe("share",function(b){if(b&&("flighttracker"===b.page||"explore"===b.page))return b.sourceId&&b.sourceId!==a.options.sourceId||(a.dialog.open(),setTimeout(function(){a.urlInput.val(b.url);a.urlInput.focus()},100)),!1;var c={hotels:"hotels/results/HotelShare",
rentals:"rentals/results/RentalShare",flights:"flights/results/FlightShare"}[a.options.vertical];c?a.openForm(b,c):console.warn("No share component found for current vertical: "+a.options.vertical)});a.options.photoColumn&&d.events.subscribe("search.poll.response",function(b){b.hasOwnProperty("sharingData")&&(a.cityName=b.sharingData.cityName,a.cityImageUrl=b.sharingData.cityImageUrl,a.getChildElement("sourceName").html(b.sharingData.cityName),a.photoColumn.css("background-image",'url("'+b.sharingData.cityImageUrl+
'")'))});this.form.on("submit",function(b){b=validateEmail(a.emailFrom.val());var c=a.validateToField();a.hid.val();a.emailTo.val(a.emailTo.val().replace(" ",""));a.emailTo.toggleClass("form-error",!c);a.emailFrom.toggleClass("form-error",!b);c&&b?(a.send.attr("disabled","disabled"),a.clearMessage(),d.XDM.remotePostAjax(d.globals.remoteHost+"/s/emailresult",a.form.serialize(),function(b){d.events.publish("share.success",a.getChildElement("sharing_email_resultid").val());a.send.removeAttr("disabled");
a.clearFields();a.dialog.close();d.Analytics.api.trackEvent({category:"Share",action:"share-result"})},function(b,c,d){a.showError("SHARING_ERROR");a.send.removeAttr("disabled")})):a.showError("EMAIL_ERROR");return!1})},openForm:function(a,b){var c=this;d.action.execute(b,{searchId:a.searchId,resultId:a.resultId,filterState:d.question.ask("resultspage.urlFilterState.get")},function(b){c.urlInput.val(b.url);c.dialog.open();c.urlInput.focus();c.getChildElement("sharing_email_fs").val(b.fs);c.getChildElement("sharing_email_subject").val(b.emailSubject);
c.getChildElement("sharing_email_searchid").val(a.searchId);c.getChildElement("sharing_email_resultid").val(a.resultId);c.options.photoColumn&&c.addSharingData(a)})},addSharingData:function(a){a.hasOwnProperty("sourceName")&&this.getChildElement("sourceName").html(a.sourceName);a.hasOwnProperty("sourceImageUrl")?(this.photoColumn.css({"background-image":"none"}),this.photoColumn.animate({opacity:0},0).css({"background-image":'url("'+a.sourceImageUrl+'")'}).animate({opacity:1},1E3)):d.Common.Utils.String.isEmpty(self.cityImageUrl)&&
this.photoColumn.addClass("hidden");a.hasOwnProperty("rating")&&(this.rating.removeClass(function(a,c){return(c.match(/(^|\s)count-\S+/g)||[]).join(" ")}),this.rating.addClass("count-"+a.rating),this.rating.attr("data-count",a.rating),!a.useStars&&self.options.useStars&&this.rating.removeClass("starIcon").addClass("circleIcon"))},validateToField:function(){var a=this.emailTo.val().split(","),b=!0;e.each(a,function(a,d){validateEmail(d.replace(" ",""))||(b=!1)});return b},showError:function(a){this.getChildElement("message").removeClass("success").addClass("error").html(this.options.messages[a])},
showSuccess:function(a){this.getChildElement("message").removeClass("error").addClass("success").html(this.options.messages[a])},clearMessage:function(){this.getChildElement("message").html("")},clearSharingData:function(){this.photoColumn.hasClass("hidden")&&this.photoColumn.removeClass("hidden");this.options.hasRating&&this.rating.hasClass("circleIcon")&&self.rating.removeClass("circleIcon").addClass("starIcon")},clearFields:function(){this.emailTo.val("");this.emailMessage.val("")}})})(R9,jQuery);var _slicedToArray=function(){return function(e,d){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=[],c=!0,b=!1,g=void 0;try{for(var f=e[Symbol.iterator](),h;!(c=(h=f.next()).done)&&(a.push(h.value),!d||a.length!==d);c=!0);}catch(k){b=!0,g=k}finally{try{if(!c&&f["return"])f["return"]()}finally{if(b)throw g;}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();
(function(e,d){e.createComponentClass("common.results.SortDropdown",{sortDropdownWidget:null,placeholderOption:[],placeholderText:"",sortUnrolled:null,loggingPrefix:"Sort",dropdownWidgetType:"dropdown",options:{isSortUnrolled:!1,hasDropdown:!1,hasDropdownSortText:!1,useSelectWidget:!1},init:function(){var a=this;this.dropdownWidgetType=this.options.useSelectWidget?"r9Select":this.dropdownWidgetType;this.options.hasDropdown&&((this.sortDropdownWidget=this.getChildElement("sorting")[this.dropdownWidgetType]({change:function(c){if(c)a.onSortModeChange()}}).getWidget())?
(this.options.isSortUnrolled&&this.resetPlaceholderOption(),this.updateSortTextTitle()):console.warn("SortDropdownWidget is undefined, but hasDropdown is set to true in sortDropdown's velocity template."))},resetPlaceholderOption:function(){this.placeholderOption=this.options.useSelectWidget?d(this.sortDropdownWidget.dropdownOptions[0]).detach():this.sortDropdownWidget?this.sortDropdownWidget.element.find("option:eq(0)"):this.placeholderOption;this.updatePlaceholderOption()},addEventHandlers:function(){var a=
this,c=this;this.options.isSortUnrolled&&(this.sortUnrolled=this.getChildElement("sortUnrolled"),this.sortUnrolled.find("a.sortOption").click(function(){c.onSortModeChange(d(this).attr("data-sort"),d(this))}));this.subscribe("searchform.submit",function(b){"function"===typeof a.handleSearchSubmit&&a.handleSearchSubmit(b)});this.subscribe("resultsHeader.changed",this.handleResultsHeaderChanged.bind(this));this.subscribe("resultsHeader.sortType.set",this.onSortModeChange.bind(this));this.subscribe("resultsHeader.sortMode.set",
this.setSortMode.bind(this))},handleResultsHeaderChanged:function(a){null!==this.sortUnrolled&&a.sort&&(this.sortUnrolled.find("a").removeClass("selected"),this.sortUnrolled.find("[data-sort\x3d"+a.sort.sortType+"_"+(a.sort.ascending?"a":"b")+"]").addClass("selected"),this.sortUnrolled.find("a.sortOption").not(".selected").each(function(a,b){(a=d(b).attr("data-default-sort"))&&d(b).attr("data-sort",a)}))},onSortModeChange:function(a,c){"undefined"===typeof a&&null!==this.sortDropdownWidget?a=this.sortDropdownWidget.getValue():
this.sortDropdownWidget&&this.sortDropdownWidget.element.hasClass("selected")&&this.sortDropdownWidget.element.removeClass("selected");a=a.split("_");var b=_slicedToArray(a,2);a=b[0];b=b[1];b="a"===b||!b;void 0!==c&&(this.options.isSortUnrolled&&c.hasClass("selected")&&(b=!b),c.attr("data-sort","%s_%s".format(a,b?"a":"b")));e.events.publish(["resultsHeader.changed","resultsHeader.sortType.log"],{sort:{sortType:a,ascending:b}});this.updatePlaceholderOption()},updatePlaceholderOption:function(){if(this.placeholderOption.length){this.placeholderText=
this.getPlaceholderText();var a=this.element.find(".sortOption.selected");a.length?(this.sortDropdownWidget.setText(this.placeholderText),this.sortDropdownWidget.element.removeClass("selected"),this.options.useSelectWidget?this.sortDropdownWidget.unselect():(this.placeholderOption.text(a.text()),this.placeholderOption.attr("selected",""),this.placeholderOption.removeAttr("disabled","").removeAttr("hidden",""))):(this.placeholderOption.text(this.placeholderText),this.placeholderOption.removeAttr("selected",
""),this.placeholderOption.attr("disabled","").attr("hidden",""),this.sortDropdownWidget.element.addClass("selected"))}},getPlaceholderText:function(){return this.placeholderOption.text()},updateSortTextTitle:function(){if(this.options.hasDropdownSortText){var a=this.sortDropdownWidget.getSelectedElement();this.sortDropdownWidget.setText(d(a).attr("data-title"))}},setSortMode:function(a){var c="";(c=this.options.useSelectWidget?this.sortDropdownWidget.dropdownOptions.filter(function(b,c){return d(c).attr("data-value")===
a}).text():this.element.find("option[value\x3d"+a+"]").text())&&""!=c&&(this.sortDropdownWidget.setValue(a),this.sortDropdownWidget.setText(c))}})})(window.R9,window.jq||window.jQuery);(function(a,c){a.publish("common.results.SwindlePublisher",{publish:function(b){a.storage&&a.storage.set("swindle",b.removeAccentedChars())}})})(R9,jQuery);(function(d,c){d.createComponentClass("common.results.swat16.TabUrgency",{originalTitle:void 0,interval:void 0,isOn:!1,defaultFavicon:"/res/images/horizon/common/results/swat16/default/favicon.ico",altFavicon:"/res/images/horizon/common/results/swat16/urgent/favicon.ico",waitTimeout:void 0,options:{flashingTabs:void 0,title:void 0,altFavicon:!1,speed:1500,altFaviconWhenInactive:!1,waitTime:1E4,includeCurrentTitle:!1},init:function(){this.originalTitle=document.title},isRP:function(){return 0==c(".vm-fd").length},
addEventHandlers:function(){var a=this;window.onblur=function(){a.switchFrom()};window.onfocus=function(){a.switchTo()}},switchFrom:function(){this.isRP()&&!this.isOn&&c.proxy(this.notificationHandler.on,this)()},switchTo:function(){this.isRP()&&c.proxy(this.notificationHandler.off,this)()},notificationHandler:{on:function(){var a=this;a.isOn=!0;a.originalTitle=document.title;a.waitTimeout=setTimeout(function(){a.updateFavicon(a.altFavicon);document.title=a.options.includeCurrentTitle?a.options.title+
" "+a.originalTitle:a.options.title;a.options.flashingTabs&&(a.interval=setInterval(function(){a.originalTitle==document.title?(a.updateFavicon(a.altFavicon),document.title=a.options.includeCurrentTitle?a.options.title+" "+a.originalTitle:a.options.title):(a.options.altFaviconWhenInactive&&a.updateFavicon(a.defaultFavicon),document.title=a.originalTitle)},a.options.speed))},a.options.waitTime)},off:function(){this.isOn=!1;clearTimeout(this.waitTimeout);this.updateFavicon(this.defaultFavicon);this.options.flashingTabs&&
clearInterval(this.interval);0==document.title.indexOf(this.options.title)?document.title=this.originalTitle:this.originalTitle=document.title}},updateFavicon:function(a){if(this.options.altFavicon){var b=document.querySelector("link[rel*\x3d'icon']")||document.createElement("link");b.type="image/x-icon";b.rel="shortcut icon";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)}}})})(R9,jQuery);(function(b){b.createComponentClass("common.results.traveltips.TravelTipsProTip",{initialLoad:!0,options:{searchId:void 0},addEventHandlers:function(){var a=this;b.events.subscribe("resultspage.searchId.changed",function(c){a.initialLoad&&a.options.searchId?(a.initialLoad=!1,(new b.RP.TravelTipsProTip).bindEvents(a.element)):(new b.RP.TravelTipsProTip(c.searchId,a.id())).open()})}})})(R9);(function(a){a.createComponentClass("common.results.traveltips.TravelTipsUrgencyBubble",{initialLoad:!0,options:{searchId:void 0,tip:void 0},addEventHandlers:function(){var b=this;a.events.subscribe("resultspage.searchId.changed",function(c){b.initialLoad&&b.options.searchId?(b.initialLoad=!1,(new a.RP.TravelTipsUrgencyBubble).showTip(b.options.tip)):(new a.RP.TravelTipsUrgencyBubble(c.searchId)).open()})}})})(R9);(function(d,b){d.createComponentClass("common.reviews.GuestReviewsSection",{selectedTab:null,typeIndex:null,init:function(){},addEventHandlers:function(){var a=this,c=b(".guestReviewsTabs").children();null!==c[0]&&(a.selectedTab=b(c[0]),a.typeIndex=a.selectedTab.attr("index"));c.each(function(){b(this).click(function(){null!==a.selectedTab&&(b(".reviewSummary-"+a.typeIndex).removeClass("selected"),a.selectedTab.removeClass("guestReviewsTabActive"));a.selectedTab=b(this);a.typeIndex=a.selectedTab.attr("index");
b(".reviewSummary-"+a.typeIndex).addClass("selected");a.selectedTab.addClass("guestReviewsTabActive")})});d.events.subscribe("hotels.details.recent.reviews.list.fetch.ended",function(a){})}})})(R9,jQuery);(function(c,b){c.createComponentClass("common.reviews.RecentReviewsList",{showingMore:!1,hotelId:"",isSeo:!1,init:function(){},inlineComponentsReady:function(){var a=b(".reviews-ALL .showAll");c.events.publish("hotels.details.recent.reviews.list.fetch.ended",{positive:0<a.find("li.POS").length,negative:0<a.find("li.NEG").length,neutral:0<a.find("li.NEU").length})},addEventHandlers:function(){var a=this;this.hotelId=this.options.hotelId;this.isSeo=this.options.isSeo;a.element.find(".toggleReviews").click(function(){a.element.toggleClass("ShowMore");
a.showingMore=!a.showingMore});a.element.find(".moreReviews").click(function(){c.Analytics.api.trackEvent("hotel/details/reviews/showMore");var a=b(this).attr("data-val"),e=b(this).attr("data-section");b(".reviews-"+e+".group"+a).removeClass("extraGroup");a++;b(this).attr("data-val",a);0===b(".reviews-"+e+".group"+a).length&&b(this).hide()});a.element.find(".reviewTypeLink").not(".disabled").click(function(){var d=b(this).attr("data-reviewtype");c.Analytics.api.trackEvent("hotel/details/reviews/reviewType/%s".format(d));
a.element.find(".reviewTypeLink.selected, .reviewSummary.selected").removeClass("selected");b(this).addClass("selected");a.element.find(".reviewSummary.reviews-%s".format(d)).addClass("selected")})}})})(R9,jQuery);(function(f,b){f.createComponentClass("common.reviews.RecentReviewsSection",{showingMore:!1,objectId:"",isSeo:!1,checkedPill:null,allReviewsTab:null,positiveReviewsTab:null,neutralReviewsTab:null,negativeReviewsTab:null,initReviewsWrapperHeight:function(){var a=b(".MainReviewsClass .reviews");if(!a.hasClass("showAll")){var d=a.find("li:lt(4)"),c=0,e=parseInt(d.first().css("marginBottom"));b.each(d,function(a,h){c+=b(h).outerHeight(!0)});c-=e;a.css("max-height",c)}},init:function(){},addEventHandlers:function(){var a=
this;this.objectId=this.options.objectId;this.typeOfReviews=this.options.typeOfReviews;a.element.find(".reviewTypeLink").not(".disabled").click(function(){var h=b(this).attr("data-reviewtype");f.Analytics.api.trackEvent("hotel/details/reviews/reviewType/%s".format(h));a.element.find(".reviewTypeLink.selected, .reviewSummary.selected").removeClass("selected");b(this).addClass("selected");a.element.find(".reviewSummary.reviews-%s".format(h)).addClass("selected")});b(".reviewTypes").children().each(function(){switch(b(this).attr("data-reviewtype")){case "ALL":a.allReviewsTab=
b(this);break;case "POSITIVE":a.positiveReviewsTab=b(this);break;case "NEUTRAL":a.neutralReviewsTab=b(this);break;case "NEGATIVE":a.negativeReviewsTab=b(this)}});var d=!1,c=b(a.element).find(".reviewTagsPillsContainer"),e=b(a.element).find(".reviewTagsPillsInnerContainer"),g=0;96<e.height()&&(g=0<(e.height()-96)/32,d=!0);d?a.element.find(".toggleReviewPills").click(function(){g?(g=!1,c.animate({height:e.height()},400)):(g=!0,c.animate({height:96},400))}):a.element.find(".toggleReviewPills").hide();
a.element.find(".toggleReviewPills").click(function(){b(".reviewTagsAndSearchContainer").toggleClass("ShowMore")});a.element.find(".reviewTagPill").click(function(){null!==a.checkedPill&&a.checkedPill.removeClass("reviewTagPillActive");null!==a.checkedPill&&b(this).attr("index")===a.checkedPill.attr("index")?(a.fetchNewReviews(""),a.checkedPill=null):(a.checkedPill=b(this),b(this).addClass("reviewTagPillActive"),a.fetchNewReviews(b(this).text()));null!==a.allReviewsTab&&a.allReviewsTab.click()});
f.events.subscribe("hotels.details.recent.reviews.list.fetch.ended",function(b){b&&b.hasOwnProperty("positive")&&(b.positive?a.positiveReviewsTab.removeClass("disabled"):a.positiveReviewsTab.addClass("disabled"),b.neutral?a.neutralReviewsTab.removeClass("disabled"):a.neutralReviewsTab.addClass("disabled"),b.negative?a.negativeReviewsTab.removeClass("disabled"):a.negativeReviewsTab.addClass("disabled"))})},fetchNewReviews:function(a){this.objectId&&(b(".Common-Reviews-RecentReviewsSection").addClass("Loading"),
f.ajax.execute("common/reviews/RecentReviewsList",{data:{tagClusterName:a,objectId:this.objectId,typeOfReviews:this.typeOfReviews},appendTo:b(".recentReviewsListContainer"),replace:!0}).then(function(){b(".Common-Reviews-RecentReviewsSection").removeClass("Loading")}))}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.search.SearchDialog",{options:{searchFormId:void 0},init:function(){this.dialog=this.getChildElement("dialog").dialog({}).getWidget();this.title=this.getChildElement("title");this.defaultTitle=this.title.text();this.form=this.getChildElement("form").getWidget();this.bindEvents()},bindEvents:function(){var a=this;b.events.subscribe("search.dialog.open",{id:this.id()},c.proxy(this.open,this));b.events.subscribe("search.dialog.open",{id:this.id()},function(){a.onOpen.call(a)});
b.events.subscribe("dialog.close",function(){a.onClose.call(a)})},open:function(a){this.title.text(this.defaultTitle);a&&(a.title&&this.title.text(a.title),a=c.extend({},a,{id:this.options.searchFormId}),b.events.publish("search.form.clear",a.id),this.updateForm(a));this.dialog.open()},updateForm:function(a){},onOpen:function(){c("#datepicker").appendTo(this.dialog.element)},onClose:function(){if(!this.dialog.isOpen()){var a=this.dialog.element.find("#datepicker");0<a.length&&a.appendTo(c("body"))}}})})(window.R9,
window.jQuery);(function(a,b){a.createComponentClass("common.search.SearchErrorDialog",{options:{},init:function(){this.dialog=this.getChildElement("dialog").dialog({}).getWidget();this.bindEvents()},bindEvents:function(){a.events.subscribe("dialog.error.open",{id:this.id()},b.proxy(this.open,this));a.events.subscribe("dialog.error.close",{id:this.id()},b.proxy(this.close,this))},open:function(a){a.message&&this.dialog.setContent(a.message);this.dialog.open()},close:function(){this.dialog.close()}})})(window.R9,
window.jQuery);(function(h,c){h.createComponentClass("common.seo.ContentMenu",{options:{fixedClass:"fixed",activeClass:"active",navSelector:".navGrid",pageContentSelector:".Common-Seo-ContentMenu .keel-container",mobileOnly:!1,navGridItemsSizeClass:"navGrid"},nav:null,navItems:null,sections:[],sectionIdToNavItem:{},preventScrollEvent:!1,lastFixedContainerHeight:null,inlineComponentsReady:function(){var a=this,b=this.options,e=!this.options.mobileOnly,d=this.getChildElement("before-nav"),h=d.offset().top,l=this.element;
this.nav=c(b.navSelector,l);var m=this.getChildElement("fixedContainer"),f,p=b.fixedClass,n,g,k,q=c(document).height(),r=c(window).height();e&&(n=c(b.pageContentSelector),k=g=n.width(),this.nav.width(k),f=this.lastFixedContainerHeight=m.outerHeight(),l.height(f));this.navItems=c(this.nav.find("a")).filter(function(){return this.hash});c(this.navItems.get().reverse()).each(function(b){var e=this.hash.replace("#",""),d=a.getSectionByHash(this.hash);null!==d?(a.sections.push(d),a.sectionIdToNavItem[e]=
c(this)):a.removeNavigationLink(c(this));0===b&&c(this)});var t=function(){e&&a.lastFixedContainerHeight!==f&&(l.height(f),a.lastFixedContainerHeight=f);0>=h-window.pageYOffset?(m.addClass(p),e&&k!==g&&(a.nav.width(g),k=g)):m.removeClass(p)};this.nav.on("click",".navItemLink",function(b){b.preventDefault();var e=this.hash.replace("#","");b=a.getSectionByHash(this.hash);b=Math.ceil(b.offset().top)-a.lastFixedContainerHeight;a.preventScrollEvent=!0;c("html,body").animate({scrollTop:b+1},500,function(){a.preventScrollEvent=
!1;a.highlightNavItem(a.sectionIdToNavItem[e])})});var u;window.addEventListener("scroll",function(){clearTimeout(u);u=setTimeout(function(){window.requestAnimationFrame(function(){a.preventScrollEvent||(t(),q>=window.pageYOffset+r?a.highlightCurrentNavItem():a.highlightLastNavItem())})},5)});var v;window.addEventListener("resize",function(){clearTimeout(v);v=setTimeout(function(){window.requestAnimationFrame(function(){e&&(f=m.outerHeight(),l.height(f),a.lastFixedContainerHeight=f,g=n.width(),a.nav.width(g),
k=g,q=c(document).height(),r=c(window).height());h=d.offset().top})},20)});t()},removeNavigationLink:function(a){if(a.is("a")){var b=this.navItems.length,c=this.getNavGridSizeClassName(b),b=this.getNavGridSizeClassName(b-1);this.nav.removeClass(c);this.nav.addClass(b);a.parent().parent().remove()}},getNavGridSizeClassName:function(a){return this.options.navGridItemsSizeClass+a},addEventHandlers:function(a){this.bindMobileNavOpenClose(a)},highlightCurrentNavItem:function(){if(!this.preventScrollEvent){var a=
this,b=window.pageYOffset;c.each(this.sections,function(c,d){c=Math.ceil(d.offset().top);if(b+a.lastFixedContainerHeight>=c)return d=d.attr("id")||d.attr("name"),a.highlightNavItem(a.sectionIdToNavItem[d]),!1})}},highlightNavItem:function(a){var b=this.options.activeClass;a.hasClass(b)||(this.navItems.removeClass(b),a.addClass(b),this.preventScrollEvent||(b=a.attr("id")||a.attr("name"),h.events.publish("common.seo.ContentMenu.activeItemChanged",{id:b,navItem:a})))},highlightLastNavItem:function(){this.highlightNavItem(jQuery(this.navItems[this.navItems.length-
1]))},bindMobileNavOpenClose:function(a){c(".navItemControls a, #"+this.id("openMobileMenu"),a).on("click",function(b){b.preventDefault();a.toggleClass("navOpen")});c(".navItemContent a, .navOverlay",a).on("click",function(){a.removeClass("navOpen")})},getSectionByHash:function(a){var b=c(a);return 0===b.length?(a=c('a[name\x3d"'+a.replace("#","")+'"]'),0===a.length?null:a):b}})})(R9,jQuery);(function(d,e){d.createComponentClass("common.seo.UniversalContainer",{init:function(a){a=e(".Common-Seo-UniversalContainer");var b=a.find(".readMore"),c=a.find(".content");(a=a.data("collapsed-content-height"))&&c.css("height",a);b.click(function(a){a.preventDefault();c.css("height","auto");b.hide()})}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.tracking.GoogleTagManager",{searchId:null,init:function(b){this.gtm=d(b)[0];c.config.getBoolean("ui.tracking.gtm.iframe",!1)?(d(this.gtm).on("load",d.proxy(this.setUpInitialData,this)),this.gtm.src="/gtm"+location.pathname+location.search+location.hash):(this.setUpInitialData(),this.initApi())},setUpInitialData:function(){var b=c.globals.analytics||[],a=b.pixelContext||{},b={vertical:b.vertical||c.globals.vertical,locale:c.globals.locale.loc,affiliate:c.globals.affiliate,
affiliateskin:c.globals.brand,geoIpCc:c.globals.geoIpCc,experiment:c.globals.experiment,pageId:b.pageId,subPageId:b.subPageId,presentation:b.presentation||c.globals.presentation,pixelContext:a};c.config.getBoolean("ui.tracking.gtm.iframe",!1)&&(b.event="pageView");this.updateDataLayer(b);this.searchId=a.searchId},updateDataLayer:function(b){try{this.log.console("updating data layer",b);var a=c.config.getBoolean("ui.tracking.gtm.iframe",!1)?this.gtm.contentWindow:window;a.dataLayer||(a.dataLayer=[]);
a.dataLayer.push(b)}catch(f){}},addEventHandlers:function(){var b=this;c.config.getBoolean("ui.tracking.gtm.iframe",!1)&&c.events.subscribe("frontdoor.view.changed",function(){var a=b.gtm.contentWindow;a.history&&a.history.replaceState&&a.history.replaceState("",document.title,location.href);a.document.title=document.title});c.events.subscribe("search.poll.response",function(a){a.pixelContext&&b.searchId!==a.pixelContext.searchId&&(b.updateDataLayer({event:"pageView",vertical:a.vertical,pageId:"results",
pixelContext:a.pixelContext}),b.searchId=a.pixelContext.searchId);a.completed&&b.updateDataLayer({event:"resultsLoaded"})});c.events.subscribe(["login.success","fbauth.login.success","googleauth.login.success"],function(a){b.loginEvent(a?a.username:null)});c.events.subscribe("signup.success",function(){b.updateDataLayer({event:"signup"})});c.events.subscribe("gtm.update",function(a){b.updateDataLayer(a)})},loginEvent:function(b){var a={event:"login"};try{if(void 0!==window.jsSHA&&b){var c=b.toLowerCase().replace(/ /g,
""),d=new jsSHA("SHA-1","TEXT");d.update(c);var e=d.getHash("HEX");a.obfuscatedEmail=e}}catch(g){}this.updateDataLayer(a)},initApi:function(){var b=window,a=document;b.dataLayer=b.dataLayer||[];b.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"});b=a.getElementsByTagName("script")[0];a=a.createElement("script");a.async=!0;a.src="//www.googletagmanager.com/gtm.js?id\x3dGTM-T654MX";b.parentNode.insertBefore(a,b)}})})(R9,jq||jQuery);(function(b,e){b.createComponentClass("common.trips.AddToTrips",{tripId:"",activeTab:null,modalCloseBtn:null,tripsDropdown:null,newTripInput:null,savedAutomatically:!1,isSaving:!1,options:{callerId:void 0},init:function(){this.tripsDropdown=this.getChildElement("trips").dropdown({}).getWidget();this.newTripInput=this.getChildElement("newTrip");this.modalCloseBtn=this.getChildElement("modalCloseBtn");this.element.find(".new").hasClass("active")&&(this.activeTab="new");this.element.find(".upcoming").hasClass("active")&&
(this.activeTab="upcoming")},addEventHandlers:function(){var a=this,b=a.element.find(".confirmSave"),d=a.element.find(".tripToSaveTo");this.element.find(".tripsTabs li:not(.disabled)").click(function(){var c=e(this),b=c.attr("rel");c.siblings(".active").removeClass("active");c.addClass("active");e(".tripsTab").hide();e(".tripsTab."+b).show();a.activeTab=b});this.element.click(function(){a.cancel()}).focus().keydown(function(c){27===c.keyCode&&a.cancel()});this.element.find(".modalBody").click(function(a){a.stopPropagation()});
this.element.find(".tripItem").click(function(){var c=e(this),f=c.attr("name"),g=c.attr("id");c.addClass("active").siblings(".active").removeClass("active");b.show();d.text(f);a.tripId=g});this.element.find(".saveToNew").click(function(){a.tripId="";a.saveToTrips()});this.element.find(".saveButton").click(function(){a.saveToTrips()});this.modalCloseBtn.click(function(){a.cancel()})},cancel:function(){this.element.remove();this.isSaving||b.events.publish("trips.save.cancel",{resultId:this.options.resultId})},
showContent:function(){this.element.find(".content").show()},hideContent:function(){this.element.find(".content").hide()},showLoader:function(){this.element.find(".loader").show()},hideLoader:function(){this.element.find(".loader").hide()},showSuccessMessage:function(a){this.hideLoader();this.element.find(".successMessage").html(a).show()},showErrorMessage:function(a){this.hideLoader();this.element.find(".errorMessage").show()},saveToTrips:function(){this.isSaving=!0;var a={resultId:this.options.resultId,
searchId:this.options.searchId,providerCode:"",showPrice:"",savedAutomatically:this.savedAutomatically};if("new"===this.activeTab){var f=this.newTripInput.val();a.tripName=f;b.Analytics.api.trackEvent({subPageId:"saved-select",category:"new-trip"})}else f=this.tripsDropdown.getValue(),a.encodedTripId=f,b.Analytics.api.trackEvent({subPageId:"saved-select",category:"existing-trip"});var d=this;window.AjaxReg&&window.AjaxReg.remoteHost||(window.AjaxReg={remoteHost:b.globals.remoteHost});this.hideContent();
this.showLoader();b.XDM.remotePostJSON(window.AjaxReg.remoteHost+"/s/run/saveToMyTrips/save",a,function(a){a.success?d.showSuccessMessage(a.html):d.showErrorMessage();b.events.publish("trips.save.done",e.extend({dialogId:d.id(),callerId:d.options.callerId,resultId:d.options.resultId},a))},function(){})}})})(window.R9,window.jQuery);(function(b,g){b.createComponentClass("common.trips.EmailSyncPostLogin",{options:{isGoogleUser:!1},dialog:null,successDialog:null,errorMsgElement:null,ensureAPIPromise:void 0,init:function(a){a=this.getChildElement("dialog");this.dialog=a.dialog().getWidget();a.addClass("no-transition-dialog");this.errorMsgElement=this.getChildElement("error");this.successDialog=this.getChildElement("successDialog").dialog().getWidget();this.ensureAPIPromise=b.Social.Google.Gmail.ensureApiLoaded();this.logAction("show");
this.dialog.open()},addEventHandlers:function(a){var b=this,d="-"+a.height()+"px",e=this.getChildElement("page-one"),f=this.getChildElement("page-two");this.getChildElement("more").click(function(){a.removeClass("js-state-one").addClass("js-state-two");e.css("transform","translateY("+d+")");f.css("transform","translateY("+d+")");return!1});this.getChildElement("less").click(function(){a.removeClass("js-state-two").addClass("js-state-one");e.css("transform","translateY(0)");f.css("transform","translateY(0)");
return!1});this.getChildElement("submit").click(this.enableSync.bind(this));this.getChildElement("nope").click(this.dialogClose.bind(this));this.element.find("[data-log]").click(this.logElementEventAction.bind(this));this.subscribe("dialog.close",function(){return b.logAction("close")})},dialogClose:function(){this.logAction("close");this.dialog.close()},logElementEventAction:function(a){a=g(a.target).data("log");this.logAction(a)},logAction:function(a){var c=b.globals.analytics||{};b.Analytics.api.trackEvent({vertical:c.vertical||
b.globals.vertical,pageId:c.pageId,subPageId:"",category:"emailsync",action:a})},enableSync:function(){var a=this;this.ensureAPIPromise.done(function(){return b.Social.Google.Gmail.authorize(a.openSuccessDialog.bind(a),a.handleConnectionError.bind(a))}).fail(this.handleConnectionError.bind(this))},openSuccessDialog:function(){this.dialogClose();this.successDialog.open()},handleConnectionError:function(){this.errorMsgElement.show()}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.trips.FastSharingResultHeader","common.trips.ResultItemSaveToTrips",{options:{driveByAnon:!1,hasActivePriceAlert:!1,tooltipPosition:"top",saveString:"Save",savedString:"Saved",watchString:"Watch",watchingString:"Watching"},init:function(a){this.base(a);var b=this;a=this.element.find(".icon");a.length&&a.each(function(a,d){c(d).toolTip({content:function(){return c(this.element).attr("data-message")},showImmediately:!1,position:b.options.tooltipPosition})})},
addEventHandlers:function(){this.base();var a=this;this.getChildElement("share").click(function(){b.Analytics.api.trackEvent("resultItem/share");b.events.publish("share",{resultId:a.options.resultId,searchId:a.options.searchId})});this.options.hasActivePriceAlert||this.getChildElement("watch").click(function(){b.Analytics.api.trackEvent("resultItem/watch");"flights"===a.options.vertical?b.events.publish("flights.results.alerts.create"):a.options.driveByAnon?b.events.publish("showPriceAlertDriveBy",
{resultId:a.options.resultId,searchId:a.options.searchId}):b.events.publish("watch",{resultId:a.options.resultId,searchId:a.options.searchId})});"flights"===this.options.vertical?this.subscribe(["watching","flights.results.existingAlert"],this.markWatched.bind(this)):this.subscribe("watching",{resultId:a.options.resultId,searchId:a.options.searchId},this.markWatched.bind(this))},markWatched:function(){this.getChildElement("watch").addClass("active").attr("href","/alerts").attr("data-message",this.options.watchingString)},
handleSaveTrip:function(){this.base();this.saveEl.attr("data-message",this.options.savedString)}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.trips.IScraperWidget",{closeBtn:null,enableBtn:null,infoDialog:{element:null,submitBtn:null,errorContainer:null},successDialog:{element:null},options:{closeEnabled:!1,group:void 0,version:void 0,closedCookiePrefix:void 0},ensureAPIPromise:null,init:function(){this.closeBtn=this.getChildElement("close");this.enableBtn=this.getChildElement("enable");this.infoDialog.element=this.getChildElement("infoDialog");this.infoDialog.submitBtn=this.getChildElement("submit");
this.infoDialog.errorContainer=this.getChildElement("error");this.successDialog.element=this.getChildElement("successDialog");this.ensureAPIPromise=c.Social.Google.Gmail.ensureApiLoaded()},addEventHandlers:function(){var a=this;jq(document).on("iscraper.widget.close",d.proxy(this.onClose,this));this.enableBtn.on("click",d.proxy(this.openInfoDialog,this));this.closeBtn.on("click",function(b){b.preventDefault();window.setMetaCookie(a.options.closedCookiePrefix+"."+a.options.group,!0);jq(document).trigger("iscraper.widget.close",
{group:a.options.group})});this.infoDialog.submitBtn.on("click",function(){a.infoDialog.errorContainer.hide();a.ensureAPIPromise.done(function(){c.Social.Google.Gmail.authorize(jq.proxy(a.openSuccessDialog,a),jq.proxy(a.onConnectingToGmailError,a))}).fail(jq.proxy(a.onConnectingToGmailError,a))})},onConnectingToGmailError:function(){this.infoDialog.errorContainer.show()},onClose:function(a,b){("all"===b.group||this.options.closeEnabled&&this.options.group===b.group)&&this.element.hide()},openInfoDialog:function(){this.infoDialog.element.getWidget().open()},
openSuccessDialog:function(){this.infoDialog.element.getWidget().close();this.successDialog.element.getWidget().open();jq(document).trigger("iscraper.widget.close",{group:"all"})}})})(window.R9,window.jQuery);(function(b,e){b.createComponentClass("common.trips.InvitationBanner",{options:{},addEventHandlers:function(){var a=this.element.find(".link");a.click(this.createTrip.bind(this));a.click(this.trackClick);this.subscribe("savedItemsListUpdated",this.updateVisibility.bind(this));this.subscribe(["cmp2.submit","searchform.submit","inlineSearchFormUpdated"],this.updateContents.bind(this))},createTrip:function(a){window.AjaxReg&&window.AjaxReg.remoteHost||(window.AjaxReg={remoteHost:b.globals.remoteHost});
var d=function(a){console.group();console.error("Error during request to /trips/e/savetrip \n",a);console.error(a.message&&a.message.responseText);console.groupEnd()};b.XDM.remotePostJSON(window.AjaxReg.remoteHost+"/trips/e/savetrip",{formtoken:b.globals&&b.globals.formtoken,destinationcode:this.options.destinationcode,tripname:this.options.tripname,start_date:this.options.startTripDate,end_date:this.options.endTripDate},function(b){var c=a.currentTarget.dataPopup;b&&b.success?c&&(c.location.href=
b.redirectURL,c.focus()):(c&&(c.location.href="/trips",c.focus()),d(b))},d)},updateVisibility:function(a){this.element.toggleClass("hidden",0<a.listSize)},updateContents:function(a){b.ajax.execute("common/trips/InvitationBanner",{data:{date1:a.checkInDate||a.depart_date_canon,date2:a.checkOutDate||a.return_date_canon,cityId:a.cityId||a.destinationcode.substring(4),location:a.location||a.destination_location},appendTo:this.element.parent(),replace:!0}).then(function(){self.destroy&&self.destroy()})},
trackClick:function(){b.Analytics.api.trackEvent({category:"rp-banner-for-trips"})}})})(window.R9,window.jQuery);(function(c,e){c.createComponentClass("common.trips.MoveEventDialog",{dialog:null,contentEl:null,loaderEl:null,resultId:null,tripId:null,eventId:null,legNum:-1,templates:{moveEventDialogContent:"moveEventDialogContent",moveEventActionContent:"moveEventSuccessContent",moveErrorContent:"moveEventError"},options:{msg:{upcomingTripsOptionHeader:void 0,pastTripsOptionHeader:void 0,unexpectedErrorMessage:void 0,unexpectedErrorTitle:void 0,accessDeniedTitle:void 0,accessDeniedMessage:void 0},optimisticUpdatesEnabled:!1},
init:function(){this.dialog=this.element.getWidget();this.contentEl=this.getChildElement("contentPlaceholder");this.loaderEl=this.getChildElement("loader");this.options.optimisticUpdatesEnabled=c.config.getBoolean("ui.trips-optimistic-updates.enabled",!1)},addEventHandlers:function(){this.subscribe("trips.move.dialog.open",e.proxy(this.processOpenEvent,this));this.subscribe("trips.move.dialog.close",this.dialog.close)},showGeneralError:function(a,b){var d=this;b=b||this.options.msg.unexpectedErrorMessage;
a=a||this.options.msg.unexpectedErrorTitle;this.loaderEl.hide();a=c.template.renderElement(this.templates.moveErrorContent,{title:a,message:b});this.contentEl.html(a);this.dialog.isOpen()||this.dialog.open();this.getChildElement("closeBtn").on("click",function(){d.dialog.close()})},handleGeneralError:function(a){a=a&&403===a.status;this.showGeneralError(a?this.options.msg.accessDeniedTitle:this.options.msg.unexpectedErrorTitle,a?this.options.msg.accessDeniedMessage:this.options.msg.unexpectedErrorMessage)},
processOpenEvent:function(a){this.clearData();if(a.tripId&&a.eventId&&a.resultId)this.tripId=a.tripId,this.eventId=a.eventId,this.resultId=a.resultId,a.legNum&&(this.legNum=a.legNum),c.action.execute("common.trips.ajax.EventData",{tripId:a.tripId,eventId:a.eventId}).done(e.proxy(this.onEventContentData,this)).fail(e.proxy(this.handleGeneralError,this)),this.contentEl.html(""),this.loaderEl.show(),this.dialog.open();else throw Error("tripId, eventId and resultId are required");},generateDropdownOptions:function(a,
b){var d=this,f=[];a=a||[];0<a.length&&(f.push({value:null,text:c.Common.Utils.String.formatString(b,a.length),checked:!1,disabled:!0}),e.each(a,function(a,b){f.push({value:b.id,text:b.title,checked:b.id===d.tripId,disabled:!1})}));return f},onEventContentData:function(a){this.loaderEl.hide();var b=a.data;a=this.generateDropdownOptions(b.upcomingTrips,this.options.msg.upcomingTripsOptionHeader);var d=this.generateDropdownOptions(b.pastTrips,this.options.msg.pastTripsOptionHeader),b=c.template.renderElement(this.templates.moveEventDialogContent,
{hasLegs:null!=b.legs,hasTrips:0<b.upcomingTrips.length||0<b.pastTrips.length,legs:b.legs,event:b.event,showLegTabs:0<=this.legNum,oneLeg:0<=this.legNum&&null!=b.legs?b.legs[this.legNum]:null});this.contentEl.html(b);this.dialog.isOpen()||this.dialog.open();this.bindMoveEventDialog(a.concat(d))},bindMoveEventDialog:function(a){var b=this,d=new c.common.widgets.Dropdown(this.id("dropdown"),{change:function(){c.Analytics.api.trackEvent("move-event/trip-picker ")}});0<a.length&&d.setOptions(a);this.setTabs();
var f=this.getChildElement("legs"),k=this.getChildElement("trips"),n=this.getChildElement("tripName"),l=this.getChildElement("error"),h=this.getChildElement("moveBtn");k.on("tabs.change",function(){var b=e(this).data("active");0===b&&0===a.length?h.attr("disabled","disabled"):h.removeAttr("disabled");c.Analytics.api.trackEvent(0===b?"move-event/existing-trip":"move-event/new-trip")});f.on("tabs.change",function(){var a=e(this).data("active");c.Analytics.api.trackEvent(0===a?"move-event/select-all-legs":
"move-event/select-one-leg")});h.on("click",function(){function a(){h.off("click");d.destroy()}c.Analytics.api.trackEvent("move-event/move");b.options.optimisticUpdatesEnabled?b.dialog.close():(b.loaderEl.show(),l.hide());var e=1===f.data("active")?b.legNum:null,g=1===k.data("active")?n.val():null,m=0===k.data("active")?d.getValue():null;c.action.execute("common.trips.ajax.MoveEventAction",b.getMoveRequestData(m,g,e)).done(function(d){d.success?(a(),b.onEventMove(d)):b.options.optimisticUpdatesEnabled?
(a(),b.handleGeneralError(),c.events.publish("trips.move.event.failed")):(b.loaderEl.hide(),l.text(d.data.errorMsg),l.show())}).fail(function(d){a();b.handleGeneralError(d);c.events.publish("trips.move.event.failed")});b.options.optimisticUpdatesEnabled&&(g||(g=d.getText().split("\u2013")[0].trim()),c.events.publish("trips.move.event.finished",{oldTripId:b.tripId,newTripId:m,newTripName:g,resultId:b.resultId,tripId:m,tripName:g,optimisticMove:!0}))})},onEventMove:function(a){var b=this;c.events.publish("trips.move.event.finished",
{oldTripId:this.tripId,newTripId:a.data.newTripId,newTripName:a.data.newTripName,resultId:this.resultId,tripId:a.data.newTripId,tripName:a.data.newTripName,responseData:a.data});c.events.publish("trips.auto.save.data",{tripId:a.data.newTripId,tripName:a.data.newTripName});this.options.optimisticUpdatesEnabled||(this.loaderEl.hide(),a=c.template.renderElement(this.templates.moveEventActionContent,a.data),this.contentEl.html(a),this.dialog.isOpen()||this.dialog.open(),this.getChildElement("closeBtn").on("click",
function(){b.dialog.close();c.Analytics.api.trackEvent("move-event/success-close")}),this.getChildElement("tripLink").on("click",function(){c.Analytics.api.trackEvent("move-event/success-go-to-new")}))},clearData:function(){this.eventId=this.tripId=null;this.legNum=-1},setTabs:function(){function a(a){a.data("active",a.find("li.selected").index())}this.element.find(".tabs").parent().each(function(){var b=e(this),d=b.find(".tabs li");a(b);d.click(function(){var c=e(this);b.data("active")!==c.index()&&
(d.removeClass("selected"),c.addClass("selected"),b.find(".tab").hide(),b.find("#"+c.attr("rel")).show(),a(b),b.trigger("tabs.change"))})})},getMoveRequestData:function(a,b,c){a={oldTripId:this.tripId,newTripId:a,newTripName:b,eventId:this.eventId,legNum:c};for(var d in a)null===a[d]&&delete a[d];return a}})})(window.R9,window.jQuery);(function(c,d){c.createComponentClass("common.trips.ResultDetailsSaveToTrips","common.trips.ResultItemSaveToTrips",{saveElText:null,options:{tripId:null},addEventHandlers:function(){this.saveElText=this.saveEl.find("span");this.saveEl.on("click",d.proxy(this.onSaveClick,this));this.subscribe("hotel.inline.detail.loaded",{resultId:this.dataResultId},this.onInlineDetailsLoaded.bind(this));this.subscribe(["common.results.inline.save.sync","common.results.inline.remove.sync"],this.syncSaveUI.bind(this))},
onSaveClick:function(){this.base()},renderSave:function(a){this.saveEl.addClass("saved");this.options.tripId=a;this.saveElText.text(this.getSaveRemoveIconText())},renderRemove:function(){this.saveEl.removeClass("saved");this.options.tripId=null;this.saveElText.text(this.getSaveRemoveIconText())},syncSaveUI:function(a){if(a&&a.resultId===this.options.resultId){a.remove&&this.renderRemove();var b=a.tripID||a.encodedTripId;!this.isSaved()&&b&&this.renderSave(b);this.onAutoSaveTripData(a.autoSaveTripId,
a.tripName)}},getSaveRemoveIconText:function(){return this.base()}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.trips.ResultItemSaveToTrips",{saveEl:null,resultItemEl:null,resultId:null,autoSaveTripId:null,autoSaveTripName:null,noSaveCallbackNeeded:!1,savedAutomatically:!1,isPending:!1,options:{resultId:"",searchId:"",tripId:null,tripName:null,newTripName:null,isUserLoggedIn:!1,isClickToSaveEnabled:void 0,isSaveInPlaceEnabled:void 0,simpleSaveEnabled:void 0,isSaveRightRailEnabled:!1,staticSignInEnabled:void 0,hasTooltip:!1,anonSaveEnabled:!1,stayAnon:!1,startDate:null,
endDate:null,ctid:null,langCode:null,msg:{saveToTripsInfoTitle:void 0,saveToTripsInfoContent:void 0,saveToTripIconText:void 0,removeFromTripIconText:void 0},optimisticUpdatesEnabled:!1,resultsMetaData:void 0},isLastResult:function(){return this.options.resultsMetaData?this.options.resultsMetaData.completed:!1},isTooltipVisible:function(){var a=b.question.ask("trips.is.bubble.shown")||!1;return this.options.hasTooltip&&!a&&!this.isSaved()},init:function(a){this.saveEl=this.getChildElement("save");
this.saveElTitle=this.saveEl.children(".saveLinkText");this.resultItemEl=a.closest(".Base-Results-HorizonResult");this.resultId=this.resultItemEl.attr("id");this.dataResultId=this.resultItemEl.attr("data-resultid");this.isTooltipVisible()&&this.showTooltip();this.options.isSaveInPlaceEnabled&&this.options.tripId&&b.events.publish("common.results.inline.save.sync",{resultId:this.options.resultId,autoSaveTripId:this.options.tripId,tripName:this.options.tripName});this.options.optimisticUpdatesEnabled=
b.config.getBoolean("ui.trips-optimistic-updates.enabled",!1)},showTooltip:function(){this.saveEl.toolTip({appendTo:"body",baseClass:"saveInfoTooltip",content:b.messages.common.trips.SAVE_TO_TRIPS_TOOLTIP_MESSAGE,offsetLeft:100,edgeOffset:2})},addEventHandlers:function(){this.saveEl.on("click",d.proxy(function(){this.onSaveClick(!1)},this));this.options.isClickToSaveEnabled&&(this.options.isUserLoggedIn||this.options.anonSaveEnabled)&&this.subscribe("provider.book.click",function(a){if(this.options.resultId==
a.resultId&&!this.isSaved())this.onSaveClick(!0)}.bind(this));this.subscribe(["common.results.inline.save.sync","common.results.inline.remove.sync"],this.syncSaveUI.bind(this));this.subscribe("hotel.inline.detail.loaded",{resultId:this.dataResultId},d.proxy(this.onInlineDetailsLoaded,this));this.subscribe("trips.auto.save.data",d.proxy(this.onAutoSaveTripData,this));this.subscribe("trips.auto.save.clear",d.proxy(this.onAutoSaveTripClearData,this));this.isTooltipVisible()&&this.subscribe("trips.save.tooltip.remove",
d.proxy(this.removeSaveInfoTooltip,this));this.subscribe("trips.move.event.finished",this.updateTripId.bind(this))},removeSaveInfoTooltip:function(){var a=this.saveEl.data("toolTip");a&&a.removeWidget()},isSaved:function(){return!!this.options.tripId},updateTripId:function(a){a.optimisticMove||a.resultId!==this.options.resultId||(this.options.tripId=a.tripId,this.options.tripName=a.tripName)},onSaveClick:function(a){this.isPending||(this.isSaved()?this.removeFromTrips():(this.savedAutomatically=!!a,
b.Analytics.api.trackEvent({subPageId:"resultsinline",category:"save-result"}),this.handleSaveTrip()))},handleSaveTrip:function(){var a=b.question.ask("trips.rightrail.tripId");this.options.isSaveRightRailEnabled&&a?this.saveToTrip(a):this.autoSaveTripId?this.instantSave(this.autoSaveTripId):(this.instantSave(),b.events.publish("gtm.update",{event:"addToTrips",pixelContext:{hotelId:this.options.resultId}}))},instantSave:function(a){this.shouldShowActionOverlay()&&this.resultItemEl.append("\x3cdiv class\x3d'removeItemOverlay'\x3e\x3c/div\x3e");
var c=this,e=!(!a||!this.autoSaveTripName),f={resultId:c.options.resultId,searchId:c.options.searchId,providerCode:"",showPrice:"",encodedTripId:a||void 0,savedAutomatically:c.savedAutomatically};window.AjaxReg&&window.AjaxReg.remoteHost||(window.AjaxReg={remoteHost:b.globals.remoteHost});d.post(window.AjaxReg.remoteHost+"/s/run/saveToMyTrips/save",f).done(function(a){c.isPending=!1;if(c.noSaveCallbackNeeded)c.options.isSaveRightRailEnabled&&c.triggerSaved(a);else if(a.success)c.onSave(a,!0),b.hotels&&
b.events.publish("gtm.update",{event:"addToTrips",pixelContext:{hotelId:c.options.resultId}});else c.onSaveError(a.error)}).fail(function(a){c.onSaveError(a.error)});this.options.optimisticUpdatesEnabled&&e?(this.onSave({eventId:!1,tripID:a,tripName:this.autoSaveTripName},!0,!0),this.noSaveCallbackNeeded=!0):this.isPending=!0},onSaveError:function(){b.Analytics.api.trackEvent({subPageId:"saved-select",category:"error"});this.onCancel({resultId:this.options.resultId})},triggerSaved:function(a){b.events.publish("resultItem.saved",
{resultItemId:this.options.resultId,tripId:a.tripID,tripName:a.tripName,eventID:a.eventID,savedAutomatically:this.savedAutomatically,responseData:a,resultItemElId:this.resultItemEl.attr("id")})},triggerRemoved:function(a,c,e){b.events.publish("resultItem.removed",{resultItemId:this.options.resultId,tripId:a,resultItemElId:this.resultItemEl.attr("id"),eventIds:c,tripRemoved:e})},onRemoveError:function(){this.resultItemEl.find(".removeItemOverlay").remove()},saveToTrip:function(a){this.shouldShowActionOverlay()&&
this.resultItemEl.append("\x3cdiv class\x3d'removeItemOverlay'\x3e\x3c/div\x3e");var c=this;if(!a)throw Error("Trip id is not defined");b.action.execute("common/trips/ajax/SaveToTrip",{tripId:a,resultId:c.options.resultId,searchId:c.options.searchId}).success(function(a){if(a.success)c.onSave(a.data,!0),b.hotels&&b.events.publish("gtm.update",{event:"addToTrips",pixelContext:{hotelId:c.options.resultId}});else c.onSaveError(a.data.errorMsg)}).error(function(){c.onSaveError()})},triggerSaveSync:function(a){b.events.publish("common.results.inline.save.sync",
a)},getSaveRemoveIconText:function(){return this.isSaved()?this.options.msg.removeFromTripIconText:this.options.msg.saveToTripIconText},onSave:function(a,c,e){if(c||a.callerId===this.id())d("#"+a.dialogId).remove(),this.triggerSaved(a),this.triggerSaveSync({autoSaveTripId:this.autoSaveTripId,resultId:this.options.resultId,encodedTripId:a.tripID,tripName:a.tripName}),b.storage.set("hotels.results.saveToTrips.tripId",a.tripID),b.events.publish("trips.save.tooltip.remove"),b.events.publish("trips.add",
{tripId:a.tripID}),b.events.publish("common.results.updateTripId",{resultId:this.options.resultId,tripId:a.tripID,tripName:a.tripName}),e||b.events.publish("trips.auto.save.data",{tripId:a.tripID,tripName:a.tripName}),this.unsubscribe("trips.save.done"),this.unsubscribe("trips.save.cancel")},renderSave:function(a){this.saveEl.addClass("saved");this.options.tripId=a;this.saveElTitle.text(this.getSaveRemoveIconText());b.config.getBoolean("ui.swindle.enabled",!1)&&b.config.getBoolean("ui.swindle.trips.enabled",
!1)&&b.Common.SwindlePublisher.publish("/trips/"+a)},renderRemove:function(){this.saveEl.removeClass("saved");this.options.tripId=null;this.saveElTitle.text(this.getSaveRemoveIconText())},syncSaveUI:function(a){if(a&&a.resultId===this.options.resultId){a.remove&&this.renderRemove();var c=a.tripID||a.encodedTripId;!this.isSaved()&&c&&this.renderSave(c,a.tripName);this.onAutoSaveTripData(a.autoSaveTripId,a.tripName)}},onAutoSaveTripData:function(a,c){null!=a&&"object"===typeof a&&(c=a.tripName,a=a.tripId);
a&&(this.autoSaveTripId=a,this.autoSaveTripName=c)},onAutoSaveTripClearData:function(){this.autoSaveTripName=this.autoSaveTripId=null},onInlineDetailsLoaded:function(){this.triggerSaveSync({autoSaveTripId:this.autoSaveTripId,resultId:this.dataResultId})},onCancel:function(){this.isPending=!1;this.resultItemEl.find(".removeItemOverlay").remove();b.Analytics.api.trackEvent({subPageId:"saved-select",category:"close"});this.unsubscribe("trips.save.done");this.unsubscribe("trips.save.cancel")},removeFromTrips:function(){b.Analytics.api.trackEvent({subPageId:"saved",
category:"remove-saved"});var a=this,c={tripId:this.options.tripId,resultId:this.options.resultId,searchId:this.options.searchId},e={url:"/s/run/saveToMyTrips/remove",type:"POST",spinner:!0,data:JSON.stringify(c),contentType:"application/json",dataType:"json",beforeSend:function(){a.shouldShowActionOverlay()&&a.resultItemEl.append("\x3cdiv class\x3d'removeItemOverlay'\x3e\x3c/div\x3e")},success:function(b){a.isPending=!1;if(a.options.optimisticUpdatesEnabled)a.options.isSaveRightRailEnabled&&a.triggerRemoved(c.tripId,
b.eventIds,b.tripRemoved);else if(b.success)a.onRemove(c,b);else a.onRemoveError()},error:d.proxy(a.onRemoveError,a)};d.ajax(e);if(this.options.optimisticUpdatesEnabled)this.onRemove(c,{eventIds:[],tripRemoved:!1});else this.isPending=!0},onRemove:function(a,c){this.options.tripId=null;this.options.isSaveInPlaceEnabled||this.options.optimisticUpdatesEnabled||b.events.publish("resultspage.results.refresh",{doRefreshUserStatus:!0});b.events.publish("common.results.inline.remove.sync",{resultId:this.options.resultId,
remove:!0});this.triggerRemoved(a.tripId,c.eventIds,c.tripRemoved);b.events.publish("trips.remove",{tripId:a.tripId});b.events.publish("common.results.updateTripId",{resultId:this.options.resultId,tripId:null,tripName:null});c.tripRemoved&&b.events.publish("trips.auto.save.clear")},shouldShowActionOverlay:function(){return!0}})})(R9,jQuery);(function(c,b){c.createComponentClass("common.trips.ResultItemSaveToTripsV2","common.trips.ResultItemSaveToTrips",{saveTitleEl:null,options:{msg:{savedToTripIconText:void 0}},init:function(a){this.base(a);this.saveTitleEl=this.getChildElement("title")},addEventHandlers:function(){this.base();this.saveEl.on("mouseenter",b.proxy(this.onSaveHoverIn,this));this.saveEl.on("mouseleave",b.proxy(this.onSaveHoverOut,this))},onSaveHoverIn:function(){this.isSaved()&&this.saveTitleEl.text(this.options.msg.removeFromTripIconText)},
onSaveHoverOut:function(){this.isSaved()&&this.saveTitleEl.text(this.options.msg.savedToTripIconText)},renderSave:function(a){this.saveEl.addClass("saved");this.options.tripId=a;this.saveTitleEl.text(this.getSaveRemoveIconText())},getSaveRemoveIconText:function(){return this.isSaved()?this.options.msg.savedToTripIconText:this.options.msg.saveToTripIconText}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.trips.ResultItemSaveToTripsV3","common.trips.ResultItemSaveToTrips",{msg:{remove:void 0,removed:void 0,save:void 0,saved:void 0,saving:void 0,error:void 0},prevState:{tripId:null,tripName:null},mouseLeaveDeferred:null,saveRemoveTransitionFinished:!0,baseWidth:0,state:{SAVED:0,REMOVED:1,SAVING:2},currentState:void 0,init:function(a){this.base(a);this.options.optimisticUpdatesEnabled=!1;this.prevState={tripId:this.options.tripId,tripName:this.options.tripName};
this.baseWidth=this.saveEl.outerWidth();this.currentState=this.isSaved()?this.state.SAVED:this.state.REMOVED;this.msg.remove=c.messages.common.trips.SAVE_ICON_REMOVE;this.msg.removed=c.messages.common.trips.SAVE_ICON_REMOVED_TITLE;this.msg.save=c.messages.common.trips.SAVE_ICON_SAVE_TITLE;this.msg.saved=c.messages.common.trips.SAVE_ICON_SAVED;this.msg.saving=c.messages.common.trips.SAVE_ICON_SAVING_TITLE;this.msg.error=c.messages.common.trips.UNEXPECTED_ERROR_AJAX_TITLE},addEventHandlers:function(){this.base();
this.saveEl.hover(d.proxy(this.onMouseOver,this),d.proxy(this.onMouseLeave,this))},onSaveClick:function(){this.saveRemoveTransitionFinished&&(this.saveRemoveTransitionFinished=!1,this.base(),this.animateClick(),this.isSaved()?this.renderRemove(!1):(this.saveEl.addClass("saved"),this.currentState=this.state.SAVING))},onRemoveError:function(){this.renderSave(this.prevState.tripId,this.prevState.tripName,!0)},onSaveError:function(a){this.base(a);this.renderRemove(!0)},animateClick:function(){var a=this;
this.saveEl.one(c.Common.Utils.Browsers.ANIMATION_END,function(){a.saveEl.removeClass("active")});this.saveEl.addClass("active")},renderSave:function(a,b,f){var e=this;this.currentState=this.state.SAVED;this.saveEl.addClass("saved");this.setTripData(a,b);this.setTitle(f?this.msg.error:c.Common.Utils.String.formatString(this.msg.saved,b),!0);a=[this.getTimeoutPromise(3E3)];f||a.push(this.mouseLeaveDeferred);d.when.apply(d,a).then(function(){e.saveRemoveTransitionFinished=!0;e.closeText().then(function(){e.setTitle(c.Common.Utils.String.formatString(e.msg.remove,
b))})})},setTripData:function(a,b){this.prevState.tripId=this.options.tripId;this.prevState.tripName=this.options.tripName;this.options.tripId=a;this.options.tripName=b},updateTripId:function(a){this.base(a.tripId,a.tripName);this.currentState===this.state.SAVED?(this.saveEl.addClass("saved"),this.setTitle(c.Common.Utils.String.formatString(this.msg.remove,a.tripName))):(this.saveEl.removeClass("saved"),this.setTitle(this.msg.save))},renderRemove:function(a){var b=this;if(this.currentState!==this.state.REMOVED){this.currentState=
this.state.REMOVED;this.saveEl.removeClass("saved");this.setTripData(null,null);this.setTitle(a?this.msg.error:this.msg.removed,!0);var c=[this.getTimeoutPromise(3E3)];a||c.push(this.mouseLeaveDeferred);d.when.apply(d,c).then(function(){b.saveRemoveTransitionFinished=!0;b.closeText().then(function(){b.setTitle(b.msg.save)})})}},getTimeoutPromise:function(a){var b=d.Deferred();setTimeout(function(){b.resolve()},a);return b.promise()},onMouseOver:function(){this.mouseLeaveDeferred=d.Deferred();this.updateWidth()},
closeText:function(){var a=d.Deferred();this.saveRemoveTransitionFinished?(this.saveEl.one(c.Common.Utils.Browsers.TRANSITION_END,function(){a.resolve()}),this.saveEl.css("width","")):a.resolve();return a.promise()},onMouseLeave:function(){this.mouseLeaveDeferred&&this.mouseLeaveDeferred.resolve();this.closeText()},updateWidth:function(){this.saveEl.css("width",this.getTextWidth())},setTitle:function(a,b){b=b||!1;this.saveElTitle.text(a);b&&this.updateWidth()},getTextWidth:function(){var a=this.saveElTitle.clone().css({visibility:"hidden",
position:"absolute",left:"-9999px",top:"0px","padding-left":this.saveElTitle.css("padding-left"),"font-size":this.saveElTitle.css("font-size")},this.saveEl).appendTo("body"),b=a.outerWidth();a.remove();return b+this.baseWidth+2},shouldShowActionOverlay:function(){return!1},showTooltip:function(){this.saveEl.toolTip({appendTo:"body",baseClass:"saveInfoTooltipV3",content:c.messages.common.trips.SAVE_TO_TRIPS_TOOLTIP_MESSAGE,offsetLeft:100,edgeOffset:2,extraClass:this.options.langCode})}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.trips.ResultsSavedItems",{savedItemsListContainer:null,savedItemsListEl:null,savedItemsHeader:null,goToTripEl:null,compareLink:null,expiryMessageEl:null,headerTitleEl:null,options:{tripsURL:void 0,msg:{viewTrip:void 0,viewTrips:void 0,savedToTripItems:void 0,savedToTripsItems:void 0,tripsCounter:void 0},stickyEnabled:!1,isSaveInPlaceEnabled:void 0,vertical:void 0,searchPollURL:null,optimisticUpdatesEnabled:!1},listSize:0,tripsMap:{},searchId:void 0,hasNewSearchId:!1,
savedItemsHeaderPlaceholder:null,resultItemClass:"Base-Results-HorizonResult",init:function(){this.goToTripEl=this.getChildElement("tripsLink");this.savedItemsHeader=this.getChildElement("header");this.savedItemsHeaderPlaceholder=this.getChildElement("headerPlaceholder");this.tripsToggleEl=this.getChildElement("savedItemsList");this.savedItemsListContainer=this.getChildElement("savedItemsList");this.savedItemsListEl=this.savedItemsListContainer.find(".list");this.compareLink=this.getChildElement("CompareLink");
this.expiryMessageEl=this.getChildElement("expiryMessage");this.headerTitleEl=this.getChildElement("headerTitle");this.options.isSaveInPlaceEnabled&&this.savedItemsListContainer.hide();this.options.optimisticUpdatesEnabled=c.config.getBoolean("ui.trips-optimistic-updates.enabled",!1)},inlineComponentsReady:function(){},initSticky:function(){this.options.stickyEnabled&&this.createStickyHeader()},resultsHeaderChanged:function(a){this.hideSavedItemList();var b=!(!a.hasOwnProperty("refreshResults")||
!a.refreshResults);this.onSearchPollResponse(a,b)},addEventHandlers:function(){c.events.subscribe("resultItem.saved",d.proxy(this.onItemSaved,this));c.events.subscribe("resultItem.removed",d.proxy(this.onItemRemoved,this));c.events.subscribe(["resultspage.streaming.done","resultspage.refreshed"],d.proxy(this.onSearchPollResponse,this));c.events.subscribe(this.options.vertical+".results.savedItems.update",this.onSavedResultsUpdate.bind(this));c.events.subscribe("resultspage.searchId.changed",d.proxy(this.onSearchIdChange,
this));c.events.subscribe("filters.changed",d.proxy(this.onFiltersChange,this));c.events.subscribe("resultsHeader.changed",d.proxy(this.resultsHeaderChanged,this));c.events.subscribe("resultspage.streaming.start",d.proxy(this.initSticky,this));c.events.subscribe("trips.move.event.finished",d.proxy(this.onItemMoved,this));c.events.subscribe("trips.move.event.failed",d.proxy(this.onItemMoveFailed,this));this.savedItemsListEl.on("click",jq(".bookingOptions"),this.logBookit);this.goToTripEl.on("click",
this.logGoToTrip);d("#"+this.id("expiryMessage")).click(function(){c.events.publish("show.login.options.dialog",{forceLogin:!0,trackingLabel:"urgency-message"})});if(c.config.getBoolean("trips.cleanupAfterSearch",!0)){var a=this;this.subscribe("resultspage.cleanup",function(b){b===a.searchId&&a.clearState()})}},onItemMoved:function(a){this.addItemToMap(a.newTripId,a.newTripName,a.optimisticMove);this.removeItemFromMap(a.oldTripId,a.optimisticMove);this.updateTripsLinkAndHeader(this.listSize)},onItemMoveFailed:function(){this.restoreTripsMap();
this.updateTripsLinkAndHeader(this.listSize)},logBookit:function(){c.Analytics.api.trackEvent({subPageId:"saved",category:"clickthrough"})},logGoToTrip:function(){c.Analytics.api.trackEvent({subPageId:"saved",category:"go-to-trip"})},onFiltersChange:function(){this.setShowHideListState(!1,!1)},hideSavedItemList:function(){this.element.removeClass("visible")},onSearchIdChange:function(a){this.searchId!==a.searchId&&this.clearState()},clearState:function(){this.hideSavedItemList();this.listSize=0;this.tripsMap=
{}},onSearchPollResponse:function(a,b){null==b&&(b=!1);var e=a.searchId&&0<a.searchId.length&&!a.streaming&&this.searchId!==a.searchId;b=b&&this.searchId&&0<this.searchId.length;this.setShowHideListState(this.tripsToggleEl.data("toggle"),!0);e&&(this.searchId=a.searchId);e||b?(e={searchId:this.searchId},a.hasOwnProperty("priceType")&&d.extend(e,{priceType:a.priceType}),this.ajaxSavedSearchPoll(e)):(this.updateVisibility(),a=this.getFirstTripId(),this.tripsMap.hasOwnProperty(a)&&c.events.publish("trips.auto.save.data",
{tripId:a,tripName:this.tripsMap[a].tripName}))},ajaxSavedSearchPoll:function(a){var b=this;a&&(a={data:a,beforeScript:function(){b.savedItemsListEl.empty();b.destroyOldResults.bind(b)},enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.savedSearchPoll",!0),appendTo:this.options.isSaveInPlaceEnabled?d("\x3cdiv\x3e"):b.savedItemsListEl},c.ajax.execute(b.options.searchPollURL,a))},destroyOldResults:function(){this.savedItemsListEl.find("."+this.resultItemClass).each(function(){c.ComponentManager.remove(d(this).attr("id"))})},
onSavedResultsUpdate:function(a){this.listSize=a.listSize;this.tripsMap=a.tripsMap;var b=this.getFirstTripId();this.tripsMap.hasOwnProperty(b)&&c.events.publish("trips.auto.save.data",{tripId:b,tripName:this.tripsMap[b].tripName});this.updateTripsLinkAndHeader(this.listSize);c.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.options.stickyEnabled&&c.events.publish("trips.counter.setValue",{id:this.id("TripsCounter"),value:this.listSize});this.updateVisibility();this._toggleCompareLink();
var e=this.options.vertical;(a.openDetails||[]).each(function(a){c.events.publish(e+".inline.detail.heightChanged",{resultId:a})});this.setExpiryMessage(a.expiryMessage)},_toggleCompareLink:function(){this.compareLink.toggleClass("visible",1<this.listSize)},updateVisibility:function(){this.element.toggleClass("visible",0<this.listSize);0<this.listSize&&c.events.publish("trips.updateHeader")},setShowHideListState:function(a,b){b&&this.tripsToggleEl.data("toggle",a);this.savedItemsListContainer.toggleClass("visible",
a)},showToast:function(a){!a.eventId&&a.eventID&&(a.eventId=a.eventID);a=c.template.render("saveToTripToast",a);c.Widgets.Toaster.addToast(a,{button:!1,escaped:!0,theme:"centered"})},onItemSaved:function(a){var b=this,e=d("#"+a.resultItemElId),g=function(){var a=e.detach();a.show();a.find(".removeItemOverlay").remove();b.savedItemsListEl.append(a)};0===this.listSize&&this.element.addClass("visible");this.listSize++;this.options.isSaveInPlaceEnabled?e.find(".removeItemOverlay").remove():e.fadeOut({duration:100,
complete:g});this.options.stickyEnabled&&(c.events.publish("trips.counter.notification.show",{id:b.id("TripsCounter")}),c.events.publish("trips.counter.increase",{id:b.id("TripsCounter")}),setTimeout(function(){c.events.publish("trips.counter.notification.clear",{id:b.id("TripsCounter")})},3E3));this.showToast(a);c.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.addItemToMap(a.tripId,a.tripName);this.updateTripsLinkAndHeader(this.listSize);this._toggleCompareLink();this.setExpiryMessage(a.responseData.expiryMessage)},
onItemRemoved:function(a){var b=this.getResultItemElement(a.resultItemId,this.savedItemsListContainer);this.listSize--;0===this.listSize&&this.element.removeClass("visible");c.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.removeItemFromMap(a.tripId);this.updateTripsLinkAndHeader(this.listSize);this.options.isSaveInPlaceEnabled?(b=this.getResultItemElement(a.resultItemId),b.find(".removeItemOverlay").remove(),c.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,
remove:!0})):this.options.optimisticUpdatesEnabled?(b.detach(),d("#searchResultsList").find(".normalResults").prepend(b),b.find(".removeItemOverlay").remove(),c.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,remove:!0})):b.remove();this._toggleCompareLink();this.options.stickyEnabled&&c.events.publish("trips.counter.decrease",{id:this.id("TripsCounter")})},removeItemFromMap:function(a,b){var c=this.tripsMap[a];if(b)this.tripsMap.optimisticRemove=c;else if(this.tripsMap.optimisticRemove){delete this.tripsMap.optimisticRemove;
return}c&&(c.savedItemsCounter--,0===c.savedItemsCounter&&delete this.tripsMap[a])},addItemToMap:function(a,b,c){b={tripId:a,savedItemsCounter:1,tripName:b};a=a||"idStub";var e=this.tripsMap[a];if(c)this.tripsMap.optimisticSave=b;else if(this.tripsMap.optimisticSave){this.tripsMap.idStub&&(this.tripsMap[a]=b,delete this.tripsMap.idStub);delete this.tripsMap.optimisticSave;return}e?e.savedItemsCounter++:this.tripsMap[a]=b},restoreTripsMap:function(){var a=this.tripsMap.optimisticSave,b=this.tripsMap.optimisticRemove,
c=this.tripsMap[b.tripId];c?c.savedItemsCounter++:this.tripsMap[b.tripId]=b;delete this.tripsMap.optimisticRemove;if(c=this.tripsMap[a.tripId])c.savedItemsCounter--,0===c.savedItemsCounter&&delete this.tripsMap[a.tripId];delete this.tripsMap.optimisticSave},getTripsIds:function(){var a=/^(optimisticRemove|optimisticSave)$/;return Object.keys(this.tripsMap).filter(function(b){return-1===b.search(a)})},getTripsCount:function(){return this.getTripsIds().length},getFirstTrip:function(){return this.tripsMap[this.getTripsIds()[0]]},
getFirstTripId:function(){return this.getTripsIds()[0]||null},updateTripsLinkAndHeader:function(a){var b=this.getTripsIds(),e=b.length;if(e){var d="\x3cstrong\x3e%s\x3c/strong\x3e".format(a),f=this.options.tripsURL;1===e?(b=this.tripsMap[b[0]],e=c.utils.escapeHTML(b.tripName),b.tripId&&(f+="/"+b.tripId+"#saved"),this.goToTripEl.html(this.options.msg.viewTrip),this.goToTripEl.attr("href",f),this.headerTitleEl.html(c.Common.Utils.String.formatChoice(this.options.msg.savedToTripItems,a,d,e,f))):(this.goToTripEl.html(this.options.msg.viewTrips),
this.goToTripEl.attr("href",f),this.headerTitleEl.html(c.Common.Utils.String.formatChoice(this.options.msg.savedToTripsItems,a,d,e,f)));this.headerTitleEl.find("a").attr("target","_blank");this.goToTripEl.attr("target","_blank")}},clearSticky:function(){this.savedItemsHeaderPlaceholder.hide();this.savedItemsHeader.removeClass("sticky layer-sticky")},setSticky:function(){this.savedItemsHeaderPlaceholder.show();this.savedItemsHeader.addClass("sticky layer-sticky");this.savedItemsHeader.css("width",
this.element.width())},createStickyHeader:function(a){var b=this;"function"!==typeof a&&(a=d.noop);var c=null;d(document).off("scroll.sticky").on("scroll.sticky",function(){b.savedItemsHeader.is(":visible")&&null===c&&(c=b.savedItemsHeader.offset().top,b.savedItemsHeaderPlaceholder.height(b.savedItemsHeader.outerHeight()));null!==c&&(d(window).scrollTop()<c?b.clearSticky():b.setSticky())});setTimeout(function(){a()},500)},isSavedItemsOnScreen:function(){return d(window).scrollTop()<this.savedItemsHeader.offset().top+
this.savedItemsHeader.outerHeight()},getResultItemElement:function(a,b){a="div[data-resultid\x3d'"+a+"']";return b?b.find(a):d(a)},setExpiryMessage:function(a){this.expiryMessageEl&&(1<this.getTripsCount()?this.expiryMessageEl.hide():a&&(this.expiryMessageEl.text(c.utils.escapeHTML(a)),this.expiryMessageEl.show()))}})})(R9,jQuery);(function(e,d){e.createComponentClass("common.trips.ResultsSavedItemsTray","common.trips.ResultsSavedItems",{goToTripEl:null,savedItemsWrapperEl:null,savedItemsContainerEl:null,hideTrayEl:null,templateState:[],maxShowedItems:8,awaitingMoveQueue:[],closed:!1,templates:{savedItemsList:"common-trips-savedItemsList",savedItemsListTooltip:"common-trips-savedItemsList-tooltip"},ANIMATION_END:"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",init:function(){this.goToTripEl=this.getChildElement("tripsLink");
this.savedItemsWrapperEl=this.getChildElement("savedItemsWrapper");this.savedItemsContainerEl=this.getChildElement("savedItemsContainer");this.hideTrayEl=this.getChildElement("hideTray");this.hideTrayEl.on("click",d.proxy(this.onTrayHide,this));this.initSavedList();this.base();this.attachScrollListener()},initSavedList:function(){this.templateState=[];this.renderList()},updateTemplateState:function(a,b){for(var c=null,f=0;f<this.templateState.length;f++)if(this.templateState[f].resultId===a){c=this.templateState[f];
break}null!==c&&d.extend(c,b)},createEmptyArray:function(a){for(var b=[],c=0;c<a;c++)b[c]=null;return b},renderList:function(){var a=this,b=this.templateState.length-this.maxShowedItems+1,c=this.rearrangeTemplateState(this.templateState),b=e.template.renderElement(this.templates.savedItemsList,{savedItems:c.slice(0,1<b?this.maxShowedItems-1:this.maxShowedItems),shouldShowNumberOfInvisibleItems:1<b,numberOfInvisibleItems:b,firstTripId:0<this.getTripsCount()?this.getFirstTrip().tripId:null});b.find(".remove").click(function(){var b=
""+d(this).data("resultid"),c=d(this).data("tripid");d(this).parent().addClass("removing");a.updateTemplateState(b,{removing:!0});a.removeFromTrips(c,b)});b.find(".newlyAdded").one(this.ANIMATION_END,function(){var b=""+d(this).data("resultid");d(this).removeClass("newlyAdded");a.updateTemplateState(b,{isNew:!1})});b.find(".imageContainer img").each(function(b){d(this).toolTip({delay:0,edgeOffset:20,appendTo:a.element,forceDesiredPosition:!0,content:function(){var c=a.templateState[b];return e.template.renderElement(a.templates.savedItemsListTooltip,
{price:c.price,name:c.name})}})});this.savedItemsWrapperEl.html(b);0===this.templateState.length||this.closed?this.savedItemsContainerEl.addClass("is-hidden"):this.savedItemsContainerEl.removeClass("is-hidden");this.attachScrollListener()},rearrangeTemplateState:function(a){a=a.filter(function(a){return null!==a});a.length<this.maxShowedItems&&(a=a.concat(this.createEmptyArray(this.maxShowedItems-a.length)));return a},onTrayHide:function(){this.closed=!0;this.savedItemsContainerEl.addClass("is-hidden")},
onSearchIdChange:function(a){this.closed=!1;this.base(a)},onItemMoved:function(a){this.addItemToMap(a.newTripId,a.newTripName);this.removeItemFromMap(a.oldTripId);this.updateTemplateState(a.resultId,{tripId:a.newTripId,tripName:a.newTripName});this.renderList();this.updateTripsLinkAndHeader(this.listSize)},onFiltersChange:function(){},ajaxSavedSearchPoll:function(a){a&&e.action.execute(this.options.searchPollURL,a,d.proxy(this.onSavedResultsUpdate,this))},onSavedResultsUpdate:function(a){this.listSize=
a.listSize;this.tripsMap=a.tripsMap;var b=this.getFirstTripId();e.events.publish("trips.auto.save.data",{tripId:b,tripName:this.tripsMap[b].tripName});this.updateTripsLinkAndHeader();e.events.publish("savedItemsListUpdated",{listSize:this.listSize});for(b=0;b<this.listSize;b++){var c=a.resultData[b];this.templateState[b]={imageURL:c.thumbURL,tripId:c.tripId,resultId:c.resultId,tripName:c.tripName,name:c.name,price:c.price,removing:!1}}this.renderList();this.updateVisibility()},attachScrollListener:function(){d(document).off("scroll.savedItems");
if(0<this.templateState.length){var a=d(".Base-Results-ResultsPage .resultsContainer");d(document).on("scroll.savedItems",d.proxy(this.onScrollListener,this,a))}},onScrollListener:function(a){d(document).scrollTop()>a.outerHeight()-a.offset().top?this.element.addClass("is-hidden"):this.element.removeClass("is-hidden")},setShowHideListState:function(){},hideSavedItemList:function(){this.tripsMap=[];this.initSavedList();this.updateTripsLinkAndHeader()},resultsHeaderChanged:function(a){var b=a.hasOwnProperty("refreshResults")&&
a.refreshResults?!0:!1;this.onSearchPollResponse(a,b)},onItemSaved:function(a){var b=this.getResultItemElement(a.resultItemId);this.base(a);if(b=b.find(".photoContainer .photo").first().attr("src"))b=b.replace(/width=[0-9]+/,"width\x3d100"),b=b.replace(/height=[0-9]+/,"height\x3d100");this.templateState.push({imageURL:b,tripId:a.tripId,resultId:a.resultItemId,tripName:a.tripName,name:a.responseData.name,price:a.responseData.price,isNew:!0});this.renderList();e.events.publish("resultItem.addedToWidget",
a)},showToast:function(){},onItemRemoved:function(a){this.base(a);var b=this.templateState.find(function(b){return null!==b&&b.resultId===a.resultItemId});this.templateState.splice(this.templateState.indexOf(b),1);this.renderList()},updateTripsLinkAndHeader:function(){var a=this.getTripsCount(),b=this.getFirstTrip();1===a?this.goToTripEl.attr("href",this.options.tripsURL+"/"+b.tripId+"#saved"):this.goToTripEl.attr("href",this.options.tripsURL);this.goToTripEl.attr("target","_blank")},removeFromTrips:function(a,
b){e.Analytics.api.trackEvent({subPageId:"saved",category:"remove-saved"});var c=this,f={tripId:a,resultId:b,searchId:this.searchId};e.events.publish("common.results.inline.save.sync",{resultId:b,encodedTripId:null,remove:!0});f={url:"/s/run/saveToMyTrips/remove",type:"POST",spinner:!0,data:JSON.stringify(f),contentType:"application/json",dataType:"json",success:function(c){c.success&&(e.events.publish("resultItem.removed",{resultItemId:b,tripId:a}),e.events.publish("trips.remove",{tripId:a}),e.publish("common.results.updateTripId",
{resultId:b,tripId:null}))},error:function(){c.savedItemsWrapperEl.find(".remove[data-resultid\x3d"+b+"]").removeClass("removing");e.events.publish("common.results.inline.remove.sync",{resultId:b,encodedTripId:a})}};d.ajax(f)}})})(R9,jQuery);(function(d,e){d.createComponentClass("common.trips.SaveRightRail",{options:{searchId:void 0,tripsURL:void 0,vertical:void 0,priceType:void 0},upcomingTrips:[],allSearchResultTrips:[],activeTripItems:[],tripDropdownWidget:null,tripDropdownContent:null,defaultRightRailEl:null,savedItemsLoader:null,tripDatesEl:null,tripLinkHeader:null,tripLinkFooter:null,savedItemsListWrapper:null,tripNameContainer:null,singleTripName:null,templateState:[],maxShowedItems:4,isWidgetVisible:!1,isWidgetShownDeferred:null,
manuallySelectedTripId:null,getTripInfoRequest:null,templates:{savedItemsList:"common-trips-rightrail-savedItemsList",dropdownLink:"common-trips-rightrail-dropdownLink"},ANIMATION_END:"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",init:function(){var a=this;this.initBaseRightRailBehaviour();this.initTripsDropdownWidget();this.savedItemsLoader=this.getChildElement("savedItemsLoader");this.tripLinkHeader=this.getChildElement("tripLinkHeader");this.tripLinkFooter=this.getChildElement("tripLinkFooter");
this.tripDatesEl=this.getChildElement("tripDates");this.savedItemsListWrapper=this.getChildElement("savedItemsGrid");this.singleTripName=this.getChildElement("singleTripName");this.tripNameContainer=this.getChildElement("tripNameContainer");d.question.answer("trips.rightrail.tripId",function(){return a.manuallySelectedTripId})},initBaseRightRailBehaviour:function(){new d.base.results.Rail(this.id(),{pinnable:!0})},inlineComponentsReady:function(){this.options.searchId&&this.loadWidgetData()},addEventHandlers:function(){this.subscribe("resultItem.saved",
e.proxy(this.onItemSaved,this));this.subscribe("resultItem.removed",e.proxy(this.onItemRemoved,this));this.subscribe("trips.move.event.finished",e.proxy(this.onItemMoved,this));this.subscribe("resultspage.searchId.changed",e.proxy(this.onSearchIdChange,this));this.subscribe("resultspage.streaming.start",e.proxy(this.onStreamingStarted,this));this.subscribe("resultsHeader.changed",e.proxy(this.onResultsHeaderChange,this));this.subscribe("search.poll.response",e.proxy(this.onSearchPollResponse))},onSearchPollResponse:function(a){a.trips&&
(this.allSearchResultTrips=a.trips)},onResultsHeaderChange:function(a){a.priceType!==this.options.priceType&&(this.options.priceType=a.priceType,this.renderUpdateActiveList())},onSearchIdChange:function(a){this.options.searchId||(this.options.searchId=a.searchId,this.loadWidgetData())},onStreamingStarted:function(){null==this.manuallySelectedTripId&&this.isShown()&&this.hideWidget()},loadWidgetData:function(){var a=this;d.action.execute("common/trips/ajax/GetTripInfo",{searchId:this.options.searchId,
vertical:this.options.vertical}).success(function(b){a.onTripsData(b.trips);a.onTripData(b.savedItems);0<b.trips.length&&a.hasMatch(b.trips)&&a.renderUpdateActiveList().then(function(){0<b.savedItems.length&&a.showWidget()})}).error(e.proxy(this.onGetTripInfoError,this))},showWidget:function(){var a=this;this.isWidgetShownDeferred=e.Deferred();this.isShown()?this.isWidgetShownDeferred.resolve():(d.events.publish("right.rail.hide"),this.subscribe("right.rail.hideAnimationDone",function(){a.unsubscribe("right.rail.hideAnimationDone");
a.element.addClass("is-visible");a.element.removeClass("animate-hide");a.element.off(a.ANIMATION_END).one(a.ANIMATION_END,function(){a.isWidgetShownDeferred.resolve()});a.element.addClass("animate-show");a.isWidgetVisible=!0;d.events.publish("hotels.showUrgencyBubbles.value",!1)}))},hideWidget:function(){var a=this;this.element.removeClass("animate-show");this.element.on(d.Common.Utils.Browsers.ANIMATION_END,function(){d.events.publish("right.rail.show");a.element.off(d.Common.Utils.Browsers.ANIMATION_END)});
this.element.addClass("animate-hide");this.unsubscribe("right.rail.hideAnimationDone");this.isWidgetVisible=!1;d.events.publish("hotels.showUrgencyBubbles.value",!0)},isShown:function(){return this.isWidgetVisible},hasMatch:function(a){a=a||[];for(var b=0;b<a.length;b++)if(a[b].active)return!0;return!1},onTripsData:function(a){var b=this;a=a||[];var c=null;this.tripDropdownContent.html("");a.each(function(a){b.addNewTrip(a);a.active&&(c=a)});this.updateAllTripLinks();this.updateTripsDropdown();null!==
c&&this.selectTrip(c.tripId,!0)},updateTripData:function(a,b){this.upcomingTrips.each(function(c){c.tripId===a&&e.extend(c,b)})},updateDates:function(a){var b=null;this.upcomingTrips.each(function(c){c.tripId===a&&(b=c)});if(null!=b){var c=moment(b.startDate).format(d.globals.dateFormats["short"]),e=moment(b.endDate).format(d.globals.dateFormats["short"]);this.tripDatesEl.text(c+" - "+e)}},onTripData:function(a){this.activeTripItems=a||[]},initTripsDropdownWidget:function(){this.tripDropdownWidget=
this.getChildElement("tripDropdown").getWidget();this.tripDropdownWidget.setOption("onClose",function(){e("body").removeClass("scrollDisabled")});this.tripDropdownWidget.setOption("onOpen",function(){e("body").addClass("scrollDisabled")});this.tripDropdownContent=this.getChildElement("tripDropdown_content");this.bindTripDropdownClick()},bindTripDropdownClick:function(){var a=this;this.tripDropdownContent.find("a").off("click").on("click",function(){e(this).hasClass("active")||(a.manuallySelectedTripId=
e(this).data("id"),a.selectTrip(e(this).data("id")))})},addNewTrip:function(a){e.extend(a,{tripName:d.utils.escapeHTML(a.tripName)});this.upcomingTrips.push(a);a=d.template.renderElement(this.templates.dropdownLink,a);this.tripDropdownContent.prepend(a);this.bindTripDropdownClick();this.updateTripsDropdown()},removeTrip:function(a){for(var b=-1,c=0;c<this.upcomingTrips.length;c++)if(this.upcomingTrips[c].tripId===a){b=c;break}-1!==b&&(this.upcomingTrips.splice(c,1),this.tripDropdownContent.find("a[data-id\x3d'"+
a+"']").remove(),this.updateTripsDropdown(),this.manuallySelectedTripId===a&&(this.manuallySelectedTripId=null));a=this.allSearchResultTrips.indexOf(a);-1!==a&&this.allSearchResultTrips.splice(a,1)},updateTripsDropdown:function(){1<this.upcomingTrips.length?this.tripNameContainer.removeClass("single").addClass("multi"):this.tripNameContainer.removeClass("multi").addClass("single")},selectTrip:function(a,b){b=b||!1;var c=this.tripDropdownContent.find("a[data-id\x3d'"+a+"']");this.tripDropdownWidget.updateLabel(c.html());
this.singleTripName.text(c.text());this.tripDropdownWidget.close();this.tripDropdownContent.find("a.active").removeClass("active");this.tripDropdownContent.find("a[data-id\x3d'"+a+"']").addClass("active");this.updateDates(a);c=e.Deferred();b?c.resolve():this.onNewTripSelected(a).then(c.resolve);return c.promise()},getSelectedTripId:function(){return this.tripDropdownContent.find("a.active").data("id")||null},onGetTripInfoError:function(a){"abort"!==a.statusText&&(this.savedItemsLoader.removeClass("is-visible"),
this.activeTripItems=[],this.renderUpdateActiveList(!0))},onNewTripSelected:function(a){var b=this,c=e.Deferred();this.savedItemsLoader.addClass("is-visible");this.updateAllTripLinks();null!=this.getTripInfoRequest&&this.getTripInfoRequest.abort();this.getTripInfoRequest=d.action.execute("common/trips/ajax/GetTripInfo",{tripId:a,vertical:this.options.vertical});this.getTripInfoRequest.success(function(a){b.activeTripItems=a.savedItems;b.renderUpdateActiveList().then(function(){c.resolve(arguments);
b.savedItemsLoader.removeClass("is-visible")})}).error(e.proxy(this.onGetTripInfoError,this));return c.promise()},hasTrip:function(a){var b=!1;this.upcomingTrips.each(function(c){c.tripId===a&&(b=!0)});return b},updateAllTripLinks:function(){this.tripLinkFooter.attr("href",this.getSelectedTripLink());this.tripLinkHeader.attr("href",this.getSelectedTripLink());this.singleTripName.attr("href",this.getSelectedTripLink())},onItemMoved:function(a){a.optimisticMove||(this.hasTrip(a.newTripId)?this.updateTripData(a.newTripId,
{startDate:a.responseData.startDate,endDate:a.responseData.endDate}):this.addNewTrip({tripId:a.newTripId,tripName:a.newTripName,startDate:a.responseData.startDate,endDate:a.responseData.endDate}),this.selectTrip(a.newTripId),a.responseData.oldTripRemoved&&this.removeTrip(a.oldTripId))},onItemSaved:function(a){var b=this;this.getResultItemElementById(a.resultItemElId).find(".removeItemOverlay").remove();if("undefined"!==typeof a.eventID&&null===this.getSavedItemByEventId(a.eventID)){this.updateTripData(a.tripId,
{startDate:a.responseData.startDate,endDate:a.responseData.endDate});-1===this.allSearchResultTrips.indexOf(a.tripId)&&this.allSearchResultTrips.push(a.tripId);if(a.tripId===this.getSelectedTripId()){var c=d.action.execute("common/trips/ajax/GetSavedItem",{eventId:a.eventID,tripId:a.tripId});this.updateDates(a.tripId);this.activeTripItems.push({loading:!0,eventId:a.eventID,resultId:a.resultItemId,hasItemData:!1});this.renderUpdateActiveList();c.success(function(c){null===c.savedItem?b.updateActiveTripItem(a.eventID,
{hasError:!0,loading:!1}):b.updateActiveTripItem(a.eventID,e.extend({},{isNew:!0},c.savedItem));b.renderUpdateActiveList().then(function(){b.showWidget();return b.isWidgetShownDeferred.promise()}).then(function(){d.events.publish("resultItem.addedToWidget",a)})})}else this.hasTrip(a.tripId)||this.addNewTrip({tripId:a.tripId,tripName:a.tripName,startDate:a.responseData.startDate,endDate:a.responseData.endDate}),this.selectTrip(a.tripId).then(function(){b.showWidget();return b.isWidgetShownDeferred.promise()}).then(function(){d.events.publish("resultItem.addedToWidget",
a)});d.question.ask("hotels.isMapViewOpen")&&this.showToast(a)}},renderUpdateActiveList:function(a){var b=this;a=a||!1;this.activeTripItems.each(function(a){a.isHotel="hotel"===a.type||"rental"===a.type;a.isCar="car"===a.type;a.isFlight="flight"===a.type;a.waitForImage=a.waitForImage||!1;a.hasOwnProperty("hasItemData")||(a.hasItemData=!0);a.isNew&&(a.loading=!1,a.hasItemData=!0,a.waitForImage=!0,a.isNew=!1);a.isHotel&&("daytaxes"===b.options.priceType?(a.price=a.unitPriceWithTaxes,a.priceLabel=d.messages.common.trips.SAVED_RIGHT_RAIL_HOTEL_PER_NIGHT_INCL_TAXES):
"totaltaxes"===b.options.priceType?(a.price=a.totalPrice,a.priceLabel=d.messages.common.trips.SAVED_RIGHT_RAIL_HOTEL_TOTAL):"daybase"===b.options.priceType&&(a.price=a.unitPrice,a.priceLabel=d.messages.common.trips.SAVED_RIGHT_RAIL_HOTEL_PER_NIGHT));a.hasPrice=!(a.isNotAvailable||a.isExpired||a.isPriceCall);a.isNotAvailable?a.price=d.messages.common.trips["SAVED_RIGHT_RAIL_SOLD_OUT_"+b.options.vertical.toUpperCase()]:a.isExpired?a.price=d.messages.common.trips.SAVED_RIGHT_RAIL_EXPIRED:a.isPriceCall&&
(a.price=a.isPriceInfo?d.messages.common.trips.SAVED_RIGHT_RAIL_INFO:d.messages.common.trips.SAVED_RIGHT_RAIL_CALL);a.wrappedTitle=function(){return function(a,b){a=b(a).trim();return 30<a.length?a.substr(0,27)+"...":a}}});var c=this.activeTripItems.length,h=this.activeTripItems.slice().reverse().slice(0,c>this.maxShowedItems?this.maxShowedItems:c),f=c>this.maxShowedItems?c-this.maxShowedItems:0;a=d.template.renderElement(this.templates.savedItemsList,{items:h,hasMore:c>this.maxShowedItems,moreLink:this.getSelectedTripLink(),
moreLinkMsg:d.Common.Utils.String.formatChoice(d.messages.common.trips.SAVED_RIGHT_RAIL_MORE,f,f),noItems:0===c,tripId:this.getSelectedTripId(),hasError:a});a.find(".col-stars").each(function(){e(this).find(".Common-Widgets-Rating").removeClass("count-0").addClass("count-"+e(this).data("id")).toggleClass("circleIcon",!e(this).data("star"))});a.find(".remove").off("click").on("click",function(){b.removeFromTrips(b.getSelectedTripId(),e(this).data("eventid"))});this.savedItemsListWrapper.html(a);this.tripLinkFooter.text(1<
this.activeTripItems.length?d.messages.common.trips.SAVED_RIGHT_RAIL_COMPARE_FOOTER:d.messages.common.trips.SAVED_RIGHT_RAIL_VIEW_FOOTER);return this.waitForImages()},waitForImages:function(){var a=[],b=this;this.savedItemsListWrapper.find(".waitForImage").each(function(){var c=e(this),d=c.find(".cardGrid .col-icon img"),f=e.Deferred();a.push(f);var g=function(){c.removeClass("waitForImage");b.updateActiveTripItem(c.data("eventid"),{waitForImage:!1});f.resolve(c.data("eventid"))};if(0<d.length)d.on("load",
g);else g()});return e.when.apply(e,a)},updateActiveTripItem:function(a,b){this.activeTripItems.each(function(c){c.eventId===a&&e.extend(c,b)})},getSavedItemById:function(a,b){for(var c=null,d=0;d<this.activeTripItems.length;d++){var e=this.activeTripItems[d],g=e.eventId;1===b&&(g=e.resultId);if(g===a){c=e;break}}return c},getSavedItemByEventId:function(a){return this.getSavedItemById(a,0)},getSavedItemByResultId:function(a){return this.getSavedItemById(a,1)},removeActiveTripItem:function(a){if(a){for(var b=
-1,c=0;c<this.activeTripItems.length;c++)if(this.activeTripItems[c].eventId===a){b=c;break}0<=b&&this.activeTripItems.splice(b,1)}},onItemRemoved:function(a){d.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,remove:!0});for(var b=0;b<a.eventIds.length;b++)this.removeActiveTripItem(a.eventIds[b]);a.tripRemoved||0===this.activeTripItems.length?(a.tripRemoved&&this.removeTrip(a.tripId),0===this.allSearchResultTrips.length?(this.hideWidget(),d.events.publish("trips.auto.save.clear")):
(b=this.allSearchResultTrips.shift(),this.selectTrip(b))):this.renderUpdateActiveList();this.getResultItemElementById(a.resultItemElId).find(".removeItemOverlay").remove()},removeFromTrips:function(a,b){function c(){f.updateActiveTripItem(b,{loading:!1});f.renderUpdateActiveList();d.events.publish("common.results.inline.remove.sync",{resultId:e.resultId,encodedTripId:a})}d.Analytics.api.trackEvent({subPageId:"saved",category:"remove-saved"});var e=this.getSavedItemByEventId(b),f=this;this.updateActiveTripItem(b,
{loading:!0,waitForImage:!1});this.renderUpdateActiveList();d.events.publish("common.results.inline.save.sync",{resultId:e.resultId,encodedTripId:null,remove:!0});d.action.execute("common/trips/ajax/RemoveEvent",{eventId:b}).done(function(f){f.success?(d.events.publish("resultItem.removed",{resultItemId:e.resultId,tripId:a,eventIds:[b],tripRemoved:f.data.tripRemoved}),d.events.publish("trips.remove",{tripId:a}),d.publish("common.results.updateTripId",{resultId:e.resultId,tripId:null})):c()}).fail(c)},
getResultItemElementById:function(a){return e("#"+a)},getSelectedTripLink:function(){return this.options.tripsURL+"/"+this.getSelectedTripId()+"#saved"},showToast:function(a){!a.eventId&&a.eventID&&(a.eventId=a.eventID);a=d.template.render("saveToTripToast",a);d.Widgets.Toaster.addToast(a,{button:!1,escaped:!0,theme:"centered"})}})})(R9,jQuery);(function(b,c){b.createComponentClass("common.trips.SavedInfoBubble",{options:{vertical:void 0,timeout:1E4,onFocusOnly:!1},isAlreadyShown:!1,titleEl:null,descriptionEl:null,thumbnailEl:null,changeLinkEl:null,hideBubbleLinkEl:null,tripId:void 0,eventId:void 0,resultId:void 0,savedAutomatically:!1,timeoutId:null,animationTimeoutId:null,init:function(){this.hideBubbleLinkEl=this.getChildElement("hideBubble");this.titleEl=this.getChildElement("title");this.descriptionEl=this.getChildElement("description");
this.thumbnailEl=this.getChildElement("thumb");this.changeLinkEl=this.getChildElement("changeLink")},addEventHandlers:function(){var a=this;this.subscribe("resultItem.addedToWidget",c.proxy(this.onResultItemAddedToWidget,this));this.subscribe("resultspage.searchId.changed",c.proxy(this.onSearchIdChange,this));this.changeLinkEl.on("click",c.proxy(this.onChangeLinkClick,this));this.hideBubbleLinkEl.on("click",c.proxy(this.hide,this));this.element.hover(function(){clearTimeout(a.timeoutId)},function(){a.timeoutId=
setTimeout(c.proxy(a.hide,a),3E3)});b.question.answer("trips.is.bubble.shown",function(){return a.isAlreadyShown})},onChangeLinkClick:function(){b.events.publish("trips.move.dialog.open",{tripId:this.tripId,eventId:this.eventId,resultId:this.resultId})},onSearchIdChange:function(){this.isAlreadyShown=!1},onResultItemAddedToWidget:function(a){var d=this;if(!this.isAlreadyShown){this.tripId=a.tripId;this.eventId=a.eventID;this.resultId=a.resultItemId;var e=a.savedAutomatically?b.messages.common.trips["SAVED_INFO_BUBBLE_TITLE_AUTO_SAVE_"+
this.options.vertical.toUpperCase()]:b.messages.common.trips["SAVED_INFO_BUBBLE_TITLE_MANUAL_SAVE_"+this.options.vertical.toUpperCase()],f=a.savedAutomatically?b.messages.common.trips.SAVED_INFO_BUBBLE_DESC_AUTO_SAVE:b.messages.common.trips.SAVED_INFO_BUBBLE_DESC_MANUAL_SAVE;this.thumbnailEl.attr("src",a.responseData.cityImageURL);this.titleEl.text(b.Common.Utils.String.formatString(b.utils.escapeHTML(e),a.tripName));this.descriptionEl.text(b.Common.Utils.String.formatString(f));if((this.savedAutomatically=
a.savedAutomatically||!1)&&this.options.onFocusOnly)c(document).one("mousemove.focus.back",function(){d.show()});else this.show();this.isAlreadyShown=!0}},hide:function(){var a=this;clearTimeout(this.timeoutId);this.element.removeClass("animateShow");this.element.addClass("animateHide");this.animationTimeoutId=setTimeout(function(){a.element.removeClass("is-visible")},1500)},show:function(){clearTimeout(this.animationTimeoutId);this.element.removeClass("animateHide");this.element.addClass("animateShow");
this.element.addClass("is-visible");this.savedAutomatically&&this.options.onFocusOnly||(this.timeoutId=setTimeout(c.proxy(this.hide,this),this.options.timeout))},getResultItemElement:function(a){return c("div[data-resultid\x3d'"+a+"']")}})})(R9,jQuery);(function(d,b){d.createComponentClass("common.trips.TripsCounter",{counterEl:null,counterValue:0,options:{counter:0},init:function(a){this.counterValue=this.options.counter;this.counterEl=this.getChildElement("counter")},addEventHandlers:function(){this.subscribe("trips.counter.increase",{id:this.id()},b.proxy(this.increase,this));this.subscribe("trips.counter.decrease",{id:this.id()},b.proxy(this.decrease,this));this.subscribe("trips.counter.setValue",{id:this.id()},b.proxy(this.update,this));this.subscribe("trips.counter.notification.show",
{id:this.id()},b.proxy(this.showNotification,this));this.subscribe("trips.counter.notification.clear",{id:this.id()},b.proxy(this.clearNotification,this))},showNotification:function(){this.element.addClass("new")},clearNotification:function(){this.element.removeClass("new")},increase:function(a){this.refreshUI(this.counterValue,++this.counterValue,a)},decrease:function(a){this.refreshUI(this.counterValue,--this.counterValue,a)},update:function(a){a=a||{};var b=parseInt(a.value);if(!isNaN(b)){var c=
this.counterValue;this.counterValue=b;this.refreshUI(c,this.counterValue,a)}},refreshUI:function(a,b,c){c=c||{};this.element.toggle(0<this.counterValue);this.counterEl.text(this.counterValue);c.hasOwnProperty("done")&&"function"===typeof c.done&&c.done(b,a)}})})(R9,jQuery);(function(b){b.createComponentClass("common.upgrade.UpgradeBrowser",{visibilityClass:"show",options:{enabled:!0},inlineComponentsReady:function(){var a=this;window.ActiveXObject&&this.options.enabled&&setTimeout(function(){a.showBanner()},1E3)},showBanner:function(){this.element.addClass(this.visibilityClass);b.Analytics.api.trackEvent("browserupgrade/show")},addEventHandlers:function(){var a=this;$(".close",this.element).on("click",function(){setMetaCookie("hideBrowserUpgradeMessage",!0);a.element.removeClass(a.visibilityClass);
b.Analytics.api.trackEvent("browserupgrade/close")})}})})(R9);(function(a,b){a.createComponentClass("common.utils.admin.Tools",{options:{showExperimentSwitchTool:!1,showFeaturesSwitchTool:!1,showCookieControlTool:!1,showFindTemplateTool:!1,currentExperiments:null},legacyAdminToolsInstance:null,constructor:function(a,c,d){this.options=b.extend({},this.options,b.extend(c||{},d||{}));this.init()},init:function(){this.legacyAdminToolsInstance=a.Admin.AdminTools.getInstance({classNameMainContainer:"Common-Utils-Admin-Tools layer-sticky r9-admin-main"},!0);this.options.showExperimentSwitchTool&&
this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.ExperimentTool({currentExperiments:this.options.currentExperiments}));this.options.showFeaturesSwitchTool&&this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.FeatureTool);this.options.showCookieControlTool&&this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.CookieTool);this.options.showFindTemplateTool&&this.legacyAdminToolsInstance.addTool(new a.Admin.Tools.FindTemplateTool)}})})(window.R9,window.jQuery);(function(c,d,e){c.publish("common.utils.history.UserHistory",e.extend({constructor:function(a){this.options=d.extend({},this.options,a);this.init()},pageTab:"other",wasLastUsedPage:!1,searchHistoryLimit:3,options:{defaultCookiExpire:10,defaultSearchExpire:100,persistLocalStorage:!0,onSave:d.noop},_storageTemplate:{sticky:{origin:"",destination:"",guests:"",depart_date:"",return_date:"",travelersObject:""},lastUsedTab:"",canary:3},_storageKey:"BKHISTORY2",hasSearchHistory:!1,searchHistoryMoreRecent:!1,
_loadStorageInstance:function(){var a=this._storageTemplate.canary,b=c.storage.get(this._storageKey);c.common.utils.history.UserHistory.storageSync=b&&b.canary&&b.canary===a?b:d.extend(!0,{},this._storageTemplate)},getStorage:function(){c.common.utils.history.UserHistory.storageSync||(c.common.utils.history.UserHistory.storageSync=d.extend(!0,{},this._storageTemplate));return c.common.utils.history.UserHistory.storageSync},initStorageInstance:function(){var a=this.getStorage();a[this.pageTab]||(a[this.pageTab]=
{searches:[],last_updated:null},c.storage.set(this._storageKey,a))},_createExpirationTimestamp:function(a){return moment().add(a||0,"hours").toDate()},init:function(){this.dirty=!1;this.pageTab=this.options.tab||this.pageTab;this._loadStorageInstance();this.initStorageInstance();this.getStorage().lastUsedTab===this.pageTab&&(this.wasLastUsedPage=!0);this.evictExpiredSearches();var a=this.getStorage()[this.pageTab];a&&a.searches&&0<a.searches.length&&(this.hasSearchHistory=!0,a.last_updated&&a.searches[0]&&
1>moment(a.last_updated).diff(a.searches[0].createdAt)&&(this.searchHistoryMoreRecent=!0));var b=this;d(window).bind("beforeunload",function(){try{b.save()}catch(f){}})},save:function(){if(this.dirty)try{this.options.onSave.call(this),this.dirty&&this.options.persistLocalStorage&&(this.dirty=!1,this.getStorage().lastUsedTab=this.pageTab,this.getStorage().common=this.common,c.storage.set(this._storageKey,this.getStorage()))}catch(a){return!1}return!0},get:function(a){if(this.getStorage()[this.pageTab])return this.getStorage()[this.pageTab][a]},
set:function(a,b){var c=this.getStorage()[this.pageTab];c&&c[a]!==b&&(this.dirty=!0,c.last_updated=this._createExpirationTimestamp(),c[a]=b);clearTimeout(this._saveTimeout);this._saveTimeout=setTimeout(d.proxy(this,"save"),100)},reduceTravelersObjectToTotal:function(){var a=0;if(this.getStorage().sticky){var b=this.getStorage().sticky.travelersObject;b&&(a+=parseInt(b.adults),a+=parseInt(b.youth),a+=parseInt(b.children),a+=parseInt(b.infants),a+=parseInt(b.lapinfants),a+=parseInt(b.seniors))}return a},
getRecentHistory:function(){var a=this.getStorage()[this.pageTab],b=this.hasSearchHistory&&this.searchHistoryMoreRecent&&a&&a.searches?a.searches[0]:null;if(!b&&a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=this.get(c));delete b.last_updated;delete b.searches}return b},evictExpiredSearches:function(){var a=this.getStorage(),b=a[this.pageTab]?a[this.pageTab].searches:null;b&&0!==b.length&&b.length>this.searchHistoryLimit&&a[this.pageTab].searches&&(a[this.pageTab].searches=b.slice(0,this.searchHistoryLimit))},
pushSearchHistory:function(a){var b=this.getStorage();b[this.pageTab]&&b[this.pageTab].searches&&(a.expiresBy=this._createExpirationTimestamp(this.options.defaultSearchExpire),a.createdAt=this._createExpirationTimestamp(),b[this.pageTab].searches.splice(0,0,a),this.dirty=!0);this.save()},purge:function(){c.storage.remove(this._storageKey);c.common.utils.history.UserHistory.storageSync=null;this.initStorageInstance();this.options.persistLocalStorage=!1}}))})(R9,jQuery,base2.Base);(function(c,e,d){c.publish("common.utils.uimodel.ObjectMapper",d.extend({propertyMappers:null,constructor:function(a){this.propertyMappers=[].concat(a)},addPropertyMappers:function(a){this.propertyMappers=this.propertyMappers.concat(a)},mapObjA2ObjB:function(a,b,c){this.propertyMappers.forEach(function(d){d.mapPropA2PropB(a,b,c)},this)},mapObjB2ObjB:function(a,b,c){this.propertyMappers.forEach(function(d){d.mapPropB2PropA(a,b,c)},this)}}))})(R9,jQuery,base2.Base);
(function(c,e,d){c.publish("common.utils.uimodel.PropertyMapper",d.extend({propA:null,propB:null,propA2PropBMapFn:null,propB2PropAMapFn:null,constructor:function(a,b,c,d){this.propA=a;this.propB=b;this.propA2PropBMapFn=c;this.propB2PropAMapFn=d},mapPropA2PropB:function(a,b,c){this._mapProperty(this.propA,a,this.propB,b,this.propA2PropBMapFn,c)},mapPropB2PropA:function(a,b,c){this._mapProperty(this.propB,b,this.propA,a,this.propB2PropAMapFn,mapUndef)},_mapProperty:function(a,b,c,d,e,f){if((a=a.get(b))||
f)e=e?e(a):a,c.set(e,d)}}))})(R9,jQuery,base2.Base);(function(c,e,d){c.publish("common.utils.uimodel.Property",d.extend({getFn:null,setFn:null,constructor:function(a,b){this.getFn=a;this.setFn=b},get:function(a){return this.getFn.call(this,a)},set:function(a,b){this.setFn.call(this,a,b)}}))})(R9,jQuery,base2.Base);
(function(c,e,d){c.publish("common.utils.uimodel.ModelProperty",d.extend({propertyName:null,constructor:function(a){this.propertyName=a},get:function(a){return a.get(this.propertyName)},set:function(a,b){return b.set(this.propertyName)}}))})(R9,jQuery,base2.Base);
(function(c,e,d){c.publish("common.utils.uimodel.ObjectProperty",d.extend({propertyName:null,constructor:function(a){this.propertyName=a},get:function(a){return a[this.propertyName]},set:function(a,b){b&&(b[this.propertyName]=a)}}))})(R9,jQuery,base2.Base);
(function(c,e,d){c.publish("common.utils.uimodel.StaticProperty",d.extend({value:null,throwErrorOnSet:!0,constructor:function(a,b){this.value=propertyName;this.throwErrorOnSet=!1!==b},get:function(a){return this.value},set:function(a,b){if(this.throwErrorOnSet)throw Error("Can't map back into a static property");}}))})(R9,jQuery,base2.Base);(function(h,k,l){h.publish("common.utils.uimodel.UiModel",l.extend({_properties:null,_propTransformers:null,_propListeners:null,_propValidators:null,_PROP_REGEX:/^(_)?[_a-zA-Z]+$/,_getContext:function(a){return null!=a?a:this},constructor:function(){this._properties={};this._propTransformers={};this._propListeners={};this._propValidators={}},addProperty:function(a,b,c,d,e,f){this._validatePropertyName(a);d=this._getContext(d);if(null!=c)if(k.isArray(c))for(var g=0;g<c.length;g++)this.addListener(a,
c[g],d);else this.addListener(a,c,d);"function"===typeof e&&this.setPropertyTransformer(a,e,d);"function"===typeof f&&this.setPropertyValidator(a,f,d);this._set(a,b,null,"object_add")},set:function(a,b){this._validatePropertyName(a);this._properties.hasOwnProperty(a)?this.update(a,b):this.addProperty(a,b)},update:function(a,b){this._set(a,b,this._properties[a],"object_update")},doDelete:function(a,b){var c=this._properties[a];delete this._properties[a];this._notifyListeners(a,b,this,a,"object_delete",
c)},get:function(a){this._validatePropertyName(a);return this._properties[a]},getArrayModel:function(a){var b=this.get(a);if(k.isArray(b)){var c=this;return new h.common.utils.uimodel.UiArrayModel(b,function(){var b=Array.prototype.slice.call(arguments);b.unshift(a);c._notifyListeners.apply(c,b)},function(b){return c._getTransformedValue.call(c,a,b,!0)})}throw Error("property "+a+" is not an array");},setPropertyTransformer:function(a,b,c){this._validatePropertyName(a);this._addCallback(a,b,c,this._propTransformers)},
setPropertyValidator:function(a,b,c){this._validatePropertyName(a);this._addCallback(a,b,c,this._propValidators)},addListener:function(a,b,c){this._validatePropertyName(a);c=this._getContext(c);if("function"!==typeof b)throw Error("expected transformerFn argument to be a function but was "+typeof transformerFn);var d=this._propListeners[a];if(null===d||void 0===d)d=this._propListeners[a]=[];a=function(){b.apply(c,arguments)};d.push(a);return a},removeListener:function(a,b){this._validatePropertyName(a);
a=this._propListeners[a];b=k.inArray(b,a);return 0<=b?(a.splice(b,1),!0):!1},validateProperty:function(a,b){this._validatePropertyName(a);"function"!==typeof b&&(b=this._propValidators[a]);return"function"===typeof b?b(this.get(a)):!0},validate:function(){for(var a=Object.getOwnPropertyNames(this._properties),b=null,c=0;c<a.length;c++){var d=a[c],e=null;try{var f=this.validateProperty(d);!0!==f&&(e=f)}catch(g){e=g}null!=e&&(null===b&&(b={}),b[d]=e)}if(null!==b)throw b;return!0},validateToHtmlList:function(){try{return this.validateToArray()}catch(b){for(var a=
0;a<b.length;a++)b[a]=this.escapeHtml(b[a]);throw"\x3cul\x3e\x3cli\x3e"+b.join("\x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e";}},validateToArray:function(){try{return this.validate()}catch(d){for(var a=[],b=Object.getOwnPropertyNames(d),c=0;c<b.length;c++)a.push(d[b[c]]);throw a;}},escapeHtml:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));return b.innerHTML},_set:function(a,b,c,d){this._validatePropertyName(a);b=this._getTransformedValue(a,b,!1);this._properties[a]=
b;this._notifyListeners(a,b,this,a,d,c)},_notifyListeners:function(a){var b=Array.prototype.slice.call(arguments);b.splice(0,1);var c=this._propListeners[a];if(null!=c)for(var d=0;d<c.length;d++)c[d].apply(this,b)},_addCallback:function(a,b,c,d){c=this._getContext(c);if("function"!==typeof b)throw Error("expected callback to be a function but was "+typeof validatorFn);d[a]=function(){return b.apply(c,arguments)}},_getTransformedValue:function(a,b,c){a=this._propTransformers[a];"function"===typeof a&&
(b=a(b,c));return b},_validatePropertyName:function(a){if(null===a||void 0===a)throw Error("prop must be defined");if("string"!==typeof a)throw Error("prop must be a string");if(!this._PROP_REGEX.test(a))throw Error("prop is not a valid property name ("+a+")");}}))})(R9,jQuery,base2.Base);
(function(h,k,l){h.publish("common.utils.uimodel.UiArrayModel",l.extend({_array:null,_listenerNotificationCallback:null,_transformerFn:null,constructor:function(a,b,c){this._array=a;this._listenerNotificationCallback=b;this._transformerFn=c},get:function(a){return this._array[a]},size:function(){return this._array.length},set:function(a,b){this._array.hasOwnProperty(a)?this.update(a,b):this.add(a,b)},_set:function(a,b,c,d){this._array[a]=this._getTransformedValue(b);this._notifyListeners(b,this.array,
a,d,c,null,null,null)},update:function(a,b){this._set(a,b,this._array[a],"array_update")},add:function(a,b){this._set(a,b,null,"array_add")},doDelete:function(a){var b=this.array[a];delete this._array[a];this._notifyListeners(null,this.array,a,"array_delete",b,null,null,null)},splice:function(a,b){for(var c=Array.prototype.slice.call(arguments),d=2;d<c.length;d++)c[d]=this._getTransformedValue(c[d]);c=Array.prototype.splice.apply(this._array,c);this._notifyListeners(null,this.array,name,"array_splice",
null,a,c,arguments.length-2)},_notifyListeners:function(a,b,c,d,e,f,g,h){this._listenerNotificationCallback(a,b,c,d,e,f,g,h)},_getTransformedValue:function(a){return"function"===typeof this._transformerFn?this._transformerFn(a):a}}))})(R9,jQuery,base2.Base);(function(d,e){d.publish("common.utils.uimodel.UiModelRegistry",{_uiModels:{},_uiModelRegisterListeners:{},isUiModelRegistered:function(a){return this._uiModels.hasOwnProperty(a)},registerUiModel:function(a,c){if(this.isUiModelRegistered(a))throw Error("A model with the id "+a+" is already registered");this._uiModels[a]=c;this._notifyModelRegisteredListeners(a,c)},deregisterUiModel:function(a){if(this.isUiModelRegistered(a))delete this._uiModels[a];else throw Error("There is no model registered with the id "+
a);},getRegisteredUiModelSync:function(a){if(this.isUiModelRegistered(a))return this._uiModels[a];throw Error("There is no model registered with the id "+a);},getRegisteredUiModelAsync:function(a,c){var b=this._uiModels[a];null!=b?c(b):this._registerModelRegisteredListeners(a,c)},_registerModelRegisteredListeners:function(a,c){var b=this._uiModelRegisterListeners[a];if(null===b||void 0===b)b=this._uiModelRegisterListeners[a]=[];b.push(c)},_notifyModelRegisteredListeners:function(a,c){a=this._uiModelRegisterListeners[a];
if(null!=a){for(var b=0;b<a.length;b++)(0,a[b])(c);for(;0<a.length;)a.pop()}}})})(R9,jQuery);(function(c,d,e){c.publish("common.utils.uimodel.TransformerValidator",e.extend({childValidator:null,errorMessageProvider:null,constructor:function(a,b){if(null!=a)if(a instanceof c.common.utils.uimodel.TransformerValidator)this.childValidator=a;else{if(null!=b)throw Error("childValidator must be of type TransformerValidator");b=a}if(null!=b){if("string"===typeof b){var f=b;b=function(a){return f}}if("function"!==typeof b)throw Error("errorMessageProvider must be of type function");this.errorMessageProvider=
b}},validate:function(a){var b=this.doValidate(a);return!0===b&&null!=this.childValidator?this.childValidator.doValidate(a):b},mapToValidValue:function(a,b){a=this.doMap(a);return null!=this.childValidator?this.childValidator.doMap(a):a},doValidate:function(a){return!0},doMap:function(a,b){return a},throwErrorMessage:function(a,b){if(null!=this.errorMessageProvider)throw this.errorMessageProvider(a);if(null!=b)throw b;throw"validation failed for "+a;}}))})(R9,jQuery,base2.Base);
(function(c,d,e){c.publish("common.utils.uimodel.RangeValidator",c.common.utils.uimodel.TransformerValidator.extend({min:null,max:null,constructor:function(a,b,c,d){this.base(c,d);this.min=a;this.max=b},doValidate:function(a){this._valueInRange(a,!0);return!0},doMap:function(a,b){return this._valueInRange(a,!1)},_valueInRange:function(a,b){var c=this.min,d=this.max;void 0!==d&&a>d?(b&&this.throwErrorMessage(a,"value may not be greater than "+d),a=d):void 0!==c&&a<c&&(b&&this.throwErrorMessage(a,"value may not be lower than "+
c),a=c);return a}}))})(R9,jQuery,base2.Base);(function(c,d,e){c.publish("common.utils.uimodel.ArrayValidator",c.common.utils.uimodel.TransformerValidator.extend({constructor:function(a,b){this.base(a,b)},validate:function(a){if(d.isArray(a)){for(var b=0;b<a.length;b++){var c=this.base(a[b]);if(!0!==c)return c}return!0}return this.base(a)},mapToValidValue:function(a,b){if(!1===b){for(b=0;b<a.length;b++)a[b]=this.base(a[b],!1);return a}return this.base(a,!0)}}))})(R9,jQuery,base2.Base);
(function(c,d,e){c.publish("common.utils.uimodel.DropdownOptionValidator",c.common.utils.uimodel.TransformerValidator.extend({optionValues:null,defaultValue:null,dropdownOptions:null,constructor:function(a,b,c,d){this.base(c,d);this.defaultValue=b;this.optionValues=[];this.dropdownOptions=a;for(b=0;b<a.length;b++)this.optionValues.push(a[b].value)},doValidate:function(a,b){0>d.inArray(a,this.optionValues)&&this.throwErrorMessage(a,"invalid option "+a);return!0},doMap:function(a){var b=d.inArray(a,
this.optionValues);return 0>b||this.dropdownOptions[b].disabled?this.defaultValue:a}}))})(R9,jQuery,base2.Base);(function(c,d,e){c.publish("common.utils.uimodel.DefaultValueTransformer",c.common.utils.uimodel.TransformerValidator.extend({defaultValue:null,constructor:function(a,b,c){this.base(b,c);this.defaultValue=null!=a?a:null},doMap:function(a,b){var c;try{!0===this.validate(a)&&(c=!1)}catch(g){c=!0}return c?this.defaultValue:a}}))})(R9,jQuery,base2.Base);
(function(c,d,e){c.publish("common.utils.uimodel.String2DateTransformer",c.common.utils.uimodel.TransformerValidator.extend({constructor:function(a,b){this.base(a,b)},doMap:function(a,b){return"string"===typeof a?moment(a,"YYYY-MM-DD").toDate():a}}))})(R9,jQuery,base2.Base);
(function(c,d,e){c.publish("common.utils.uimodel.InstanceOfValidator",c.common.utils.uimodel.TransformerValidator.extend({instance:null,constructor:function(a,b,c){this.base(b,c);this.instance=a;try{new a}catch(g){throw Error("passed instance is not an object; instance: "+a);}},doValidate:function(a){if(a instanceof this.instance)return!0;this.throwErrorMessage(a,a+" is not an instanceof "+Object.prototype.toString.call(new this.instance))}}))})(R9,jQuery,base2.Base);
(function(c,d,e){c.publish("common.utils.uimodel.EmptyValidator",c.common.utils.uimodel.TransformerValidator.extend({constructor:function(a,b){this.base(a,b)},doValidate:function(a){if(null!=a)if("string"===typeof a&&""===a.trim())this.throwErrorMessage(a,"value may not be empty");else return!0;else this.throwErrorMessage(a,"value may not be empty")}}))})(R9,jQuery,base2.Base);
(function(c,d,e){c.publish("common.utils.uimodel.JsonObjectValidator",c.common.utils.uimodel.TransformerValidator.extend({constructor:function(a,b){this.base(a,b)},doValidate:function(a){if(null!=a)if("string"===typeof a)if(""===a.trim())this.throwErrorMessage(a,"value may not be empty");else try{return this.validateParsedJsonObject(d.parseJSON(a))}catch(b){this.throwErrorMessage(a,b)}else return!0;else this.throwErrorMessage(a,"value may not be empty")},validateParsedJsonObject:function(a){return!0}}))})(R9,
jQuery,base2.Base);(function(c,d,e){c.publish("common.utils.uimodel.JsonArrayValidator",c.common.utils.uimodel.JsonObjectValidator.extend({constructor:function(a,b){this.base(a,b)},validateParsedJsonObject:function(a){if(d.isArray(a))return!0;this.throwErrorMessage(a,"object is not an array")}}))})(R9,jQuery,base2.Base);
(function(c,d,e){c.publish("common.utils.uimodel.NoOpValidator",c.common.utils.uimodel.TransformerValidator.extend({constructor:function(){if(0<arguments.length)throw Error("this validator validates always \x3d\x3e we don't take any arguments");this.base()},doValidate:function(a){return!0},doMap:function(a,b){return a}}))})(R9,jQuery,base2.Base);(function(b,d){b.createComponentClass("common.weather.WeatherDisplay",{options:{searchId:""},addEventHandlers:function(){var a=this;this.element.find(".forecast-link").click(function(){b.Analytics.api.trackEvent("common/weather/weatherDisplay/externalLink/clicked")});this.searchIdChangedCallback=b.events.subscribe("resultspage.searchId.changed",function(c){c&&a.options.searchId!==c.searchId&&(a.options.searchId=c.searchId,a.element.html(""),a.searchIdChangedCallback&&b.events.unsubscribe("resultspage.searchId.changed",
a.searchIdChangedCallback),b.ajax.execute("common.weather.WeatherDisplay",{data:{searchId:a.options.searchId},appendTo:a.element.parent(),replace:!0}))})}})})(R9,jQuery);(function(g,f){g.createWidgetClass("ActivitiesPanel",{activities:null,activityTypes:{},places:{},RADIUS:600,init:function(){this.locations=this.options.locations;this.activities=this.options.activities;this.processActivityTypes();this.activityList=this.element.find(".activity-list");this._populateActivities();this._bindHandlers();this.element.data("ActivitiesPanel",this)},processActivityTypes:function(){var a=this;this.activities.forEach(function(c){c.types.forEach(function(b){a.activityTypes[b]=
{type:b,category:c.category}})})},_bindHandlers:function(){this.element.on("click.acitivitiesPanel",".activity-list li",this.onActivityClick.bind(this))},_populateActivities:function(){var a=this;this.activities.forEach(function(c,b){var d=f("\x3cli/\x3e"),e=f("\x3cdiv/\x3e").appendTo(d).addClass("wrapper");f('\x3cspan class\x3d"count"/\x3e').appendTo(e).text(0);f('\x3cspan class\x3d"name"/\x3e').appendTo(e).text(c.name);d.appendTo(a.activityList).addClass(c.category).addClass("clearfix").data("category",
c.category).toggleClass("active",0===b)})},onActivityClick:function(a){a=f(a.target).closest("li");var c=a.data("category");this.activityList.find(".active").removeClass("active");a.addClass("active");g.Analytics.api.trackEvent("/map/activities_panel/activity_changed/"+c);this.showActiveActivityPlaces()},fetchActivityPlaces:function(a,c){var b=f.Deferred(),d=[],e=this;!this.mapView&&window.google&&(this.mapView=c,this.map=c.getMap(),this.placesService=g.maps.PlacesService.getInstance({map:this.map.getGMap()}));
a&&a.length?a.forEach(function(a){e.places[a.lat()+"|"+a.lng()]||(e.placesService?e.activities.forEach(function(b){var c=e.placesService.searchNearby({location:a,radius:e.RADIUS,types:b.types}).then(function(c){e.processData(a,c,b.category);e.showActiveActivityPlaces()});d.push(c)}):b.reject("Invalid Places Service"))}):b.reject("Invalid Locations or empty");f.when.apply(f,d).then(function(){b.resolve(e.getActiveActivityPlaces())}).fail(function(a){b.reject("Unable to fetch activities, ",a)});return b},
showActiveActivityPlaces:function(){var a=this.activityList.find(".active").data("category");a.length&&(a=this.getPlacesByCategory(a),this.mapView&&this.mapView.addActivityMarkers(a))},processData:function(a,c,b){var d=a.lat()+"|"+a.lng(),e=this;this.places[d]||(this.places[d]={});c.forEach(function(a){e.places[d][b]||(e.places[d][b]={});e.places[d][b][a.place_id]||(e.places[d][b][a.place_id]=a)});this._updateCounts()},getPlacesByCategory:function(a){var c=[],b={},d=this;Object.keys(this.places).forEach(function(b){d.places[b][a]&&
(c=c.concat(Object.keys(d.places[b][a]).map(function(c){return d.places[b][a][c]})))});c.forEach(function(a){b[a.place_id]||(b[a.place_id]=a)});return Object.keys(b).map(function(a){return b[a]})},getActiveActivityPlaces:function(){var a=this.activityList.find(".active").data("category");return this.getPlacesByCategory(a)},_updateCounts:function(){var a=this;this.activities.forEach(function(c){var b=a.getPlacesByCategory(c.category).length;a.activityList.find("."+c.category+" .count").text(b)})},
reset:function(a){var c={},b=this;a&&a.forEach(function(a){a=a.lat()+"|"+a.lng();b.places[a]&&(c[a]=b.places[a])});this.places=c;this._updateCounts()}})})(R9,jQuery);(function(e,f){e.createWidgetClass("BookingLink",{elementNode:null,options:{elementId:"",bookingUrl:"",searchType:"",provider:null,adt:"",onClick:null,text:"",isButton:!1},init:function(){this.elementNode=f("#"+this.options.elementId);this.createTriggers()},createTriggers:function(){var a=this;if(null!=a.options.onClick)this.elementNode.on("click",function(){alert(a.options.onClick)})},humanizeBookit:function(a,d){var c=null;a&&"string"!=typeof a&&(c=jq(a),a=c.attr(d||"href"));if(!a||a.match(/&sc=/))return a;
var b=a.match(/code=(.*)&/);b&&(b=b[1].split("."));if(!b||6>=b.length)return a;b=(Math.abs(parseInt(b[0]))+Math.abs(parseInt(b[5])))%13242+1;a=a+"\x26sc\x3d"+b;c&&c.attr(d||"href",a);return a}})})(R9,jQuery);(function(d,c){d.createWidgetClass("ButtonDropdownDialog",{element:null,elementNode:null,content:null,placeholder:null,label:null,icon:null,isOpen:!1,options:{autoOpen:!1,alignment:"left",direction:"down",showIcon:!0,matchWidth:!1,iconClass:"",contentClass:"",triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:""},init:function(){this.options.autoOpen&&this.open();if(this.options.onInit)this.options.onInit(this);this.createContent();this.elementNode=this.element[1];
this.createTrigger()},addEventHandlers:function(){function a(a){a=c(a.target).closest(".Common-Widgets-ButtonDropdownDialog-Content");b.content[0]!==a[0]&&b.isOpen&&b.close()}var b=this,d=c("body");d.on("click",a);this.subscribe("trips.menu.open",c.proxy(this.close,this));c(b.element).click(function(c){d.off("click",a);b.toggleContent();setTimeout(function(){d.on("click",a)},10)});c(document).keydown(function(a){27===a.which&&b.close()});this.element.keydown(function(a){if(13===a.which||32===a.which)b.element.trigger("click"),
a.preventDefault()});c(window).on("resize",function(){b.isOpen&&b.reposition()});c(document).on("scroll",function(){b.isOpen&&b.reposition()});c(".viewport").on("scroll",function(){b.isOpen&&b.reposition()})},createContent:function(){this.content=this.options.content?c(this.options.content):c("#"+this.element.attr("id")+"_content")},createTrigger:function(){this.element.hasClass("open")&&(this.isOpen=!0);this.label=this.element.find(".label");this.label.length||(this.label=c("\x3cspan\x3e",{"class":"label"}),
this.element.prepend(this.label));this.placeholder=this.element.find(".placeholder");this.placeholder.length||(this.placeholder=c("\x3cspan\x3e",{"class":"placeholder",text:this.options.placeholder}),this.element.append(this.placeholder));this.options.showIcon&&(this.icon=this.element.find(".icon"),this.icon.length||(this.icon=c("\x3cspan\x3e",{"class":"icon "+this.options.iconClass}),this.element.append(this.icon)));this.options.text?this.updateLabel(this.options.text):this.label.text()&&this.updateLabel(this.label.text())},
open:function(){this.isOpen=!0;this.content.appendTo("body");this.reposition();this.element.addClass("open");this.content.addClass("open");if(this.options.onOpen)this.options.onOpen(this);d.events.publish("DropdownDialog.open",{id:this.id()})},close:function(){var a=this.isOpen;this.isOpen=!1;this.element.removeClass("open");this.content.removeClass("open");this.element.after(this.content);if(this.options.onClose)this.options.onClose(a,this);d.events.publish("DropdownDialog.close",{id:this.id()})},
toggleContent:function(){this.isOpen?this.close():this.open()},updateLabel:function(a){this.label.html(a);"0"===a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},hasValue:function(){return this.element.hasClass("hasValue")},reposition:function(){var a=this.element.offset(),b=a.top+this.element.outerHeight();"up"===this.options.direction&&(b=a.top-this.element.outerHeight()-this.content.outerHeight());b={top:b+"px"};"right"===this.options.alignment?b.right=c(window).width()-
(a.left+this.element.outerWidth())+"px":b.left="center"===this.options.alignment?a.left-this.content.outerWidth()/2+this.element.outerWidth()/2+"px":a.left+"px";b.width=this.options.matchWidth?this.element.outerWidth()+"px":"";b.zIndex=this.element.zIndex()+9999;this.content.css(b)}})})(window.R9,window.jQuery);(function(h,f){h.createWidgetClass("Calendar",{options:{monthTitleFormat:"MMMM YYYY",initDate:null,allowPastDates:!1,title:""},existing:!1,animating:!1,currentDate:null,months:null,now:null,minDate:null,maxDate:null,leftArrow:'\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" viewBox\x3d"0 0 11 11"\x3e\x3cpath d\x3d"M5.36,0.51h0A0.84,0.84,0,0,1,6,.76,0.86,0.86,0,0,1,6,2L3.3,4.66H9.65a0.85,0.85,0,0,1,0,1.7H3.45L6.1,9.06a0.85,0.85,0,0,1-1.2,1.2L0.75,6a0.85,0.85,0,0,1,0-1.2l4-4.07A0.84,0.84,0,0,1,5.36.51Z"/\x3e\x3c/svg\x3e\n',
rightArrow:'\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" viewBox\x3d"0 0 11 11"\x3e\x3cpath d\x3d"M5.64,10.5h0A0.84,0.84,0,0,1,5,10.25,0.86,0.86,0,0,1,5,9L7.7,6.35H1.35a0.85,0.85,0,0,1,0-1.7H7.55L4.9,2a0.86,0.86,0,0,1,0-1.2,0.86,0.86,0,0,1,1.2,0L10.25,5a0.85,0.85,0,0,1,0,1.2l-4,4.07A0.84,0.84,0,0,1,5.64,10.5Z"/\x3e\x3c/svg\x3e\n',init:function(){this.now=moment().startOf("day");this.maxDate=moment().add(1,"year");this.currentDate=this.getInitDate();this.existing?this.update(this.currentDate):this.create(this.currentDate);
this.bindElements();this.setDisplayHeight()},bindElements:function(){this.months=this.getChildElement("months");this.animation=this.getChildElement("animation");this.displayWrapper=this.getChildElement("displayWrapper");this.next=this.getChildElement("next");this.prev=this.getChildElement("prev")},create:function(a){f("body").append(this.makeHTML(a));this.element=f("#%s".format(this.id()));this.elementNode=this.element.get(0)},addEventHandlers:function(){this.next.click(this.onNextClick.bind(this));
this.prev.click(this.onPrevClick.bind(this));this.prev.keypress(this.proxyClick.bind(this));this.next.keypress(this.proxyClick.bind(this));this.addDayEventHandlers(this.months.children())},update:function(a){this.removeDayEventHandlers(this.months.children());this.months.html(this.makeCalendarHTML(a));this.addDayEventHandlers(this.months.children());this.updateNav();this.setDisplayHeight()},makeHTML:function(a){var b=[];if(!this.existing){b.push("\x3cdiv id\x3d'%s' class\x3d'%s'\x3e".format(this.id(),
this.getCssClass()));b.push("\x3cdiv id\x3d'%s' class\x3d'pointer'\x3e\x3c/div\x3e".format(this.id("pointer")));b.push("\x3cdiv id\x3d'%s' class\x3d'title %s'\x3e%s\x3c/div\x3e".format(this.id("title"),this.options.title?"":"hidden",this.options.title?this.options.title:""));var c=this.makeAboveCalendarHTML();b.push("\x3cdiv id\x3d'%s' class\x3d'aboveCalendar %s'\x3e".format(this.id("above"),c.length?"":"hidden"));b.push(c);b.push("\x3c/div\x3e");b.push("\x3cdiv id\x3d'%s' class\x3d'displayWrapper'\x3e".format(this.id("displayWrapper")));
b.push(this.makeNavHTML(a));b.push("\x3cdiv class\x3d'keel-grid weekDaysGrid'\x3e");c=this.makeWeekHeaderHTML(!1);b.push("\x3cdiv class\x3d'col-hidden col-weekHeader col-weekHeader-m'\x3e");b.push(c);b.push("\x3c/div\x3e");b.push("\x3cdiv class\x3d'col-hidden col-weekHeader col-weekHeader-m'\x3e");b.push(c);b.push("\x3c/div\x3e");b.push("\x3c/div\x3e");b.push("\x3cdiv id\x3d'%s' class\x3d'animationWrapper'\x3e".format(this.id("animation")));b.push("\x3cdiv id\x3d'%s' class\x3d'keel-grid monthsGrid'\x3e".format(this.id("months")))}b.push(this.makeCalendarHTML(a));
this.existing||(b.push("\x3c/div\x3e"),b.push("\x3c/div\x3e"),b.push("\x3c/div\x3e"),b.push("\x3c/div\x3e"));return b.join("")},getCssClass:function(){return"Common-Widgets-Calendar"},makeAboveCalendarHTML:function(){return""},makeNavHTML:function(a){var b=this.checkDate(a.clone().add(-1,"month"))?"":"disabled";a=this.checkDate(a.clone().add(1,"month"))?"":"disabled";var c=[];c.push("\x3cdiv id\x3d'%s' tabindex\x3d'0' role\x3d'button' %s aria-label\x3d'Previous month' class\x3d'navItem prevMonth %s'\x3e%s\x3c/div\x3e".format(this.id("prev"),
b?"disabled\x3d'disabled'":"",b,this.leftArrow));c.push("\x3cdiv id\x3d'%s' tabindex\x3d'0' role\x3d'button' %s aria-label\x3d'Next month' class\x3d'navItem nextMonth %s'\x3e%s\x3c/div\x3e".format(this.id("next"),a?"disabled\x3d'disabled'":"",a,this.rightArrow));return c.join("")},makeWeekHeaderHTML:function(a,b){var c=[];c.push("\x3cdiv class\x3d'keel-grid weekDayGrid %s' %s\x3e".format(a?"hide":"",a?"role\x3d'row'":"aria-hidden\x3d'true'"));for(var e=moment().startOf("week"),d=0;7>d;d++)c.push("\x3cdiv class\x3d'col-weekDay'\x3e\x3cdiv %s class\x3d'weekDay' %s\x3e%s\x3c/div\x3e\x3c/div\x3e".format(b?
"id\x3d'%s-%s'".format(b,d):"",a?"role\x3d'columnheader'":"",e.format("dd").substr(0,1))),e.add(1,"day");c.push("\x3c/div\x3e");return c.join("")},makeCalendarHTML:function(a){var b=[];b.push(this.makeMonthHTML(a.clone(),-1));b.push(this.makeMonthHTML(a.clone(),0));b.push(this.makeMonthHTML(a.clone(),1));b.push(this.makeMonthHTML(a.clone(),2));return b.join("")},makeMonthHTML:function(a,b){var c=[];a=a.clone().add(b,"month").startOf("month");var e=a.month(),d=this.id(a.format("YYYYMM"));b=-1===b||
2===b;c.push("\x3cdiv id\x3d'%s' class\x3d'col col-month col-month-m %s' role\x3d'grid' aria-readonly\x3d'true' aria-hidden\x3d'%s'\x3e".format(d,b?"col-hidden":"",b));c.push("\x3cdiv class\x3d'month'\x3e");c.push("\x3cdiv class\x3d'monthDisplay'\x3e%s\x3c/div\x3e".format(a.format(this.options.monthTitleFormat)));c.push(this.makeWeekHeaderHTML(!0,d));c.push("\x3cdiv class\x3d'weeks'\x3e");c.push("\x3cdiv class\x3d'keel-grid weekGrid' role\x3d'row'\x3e");for(b=0;b<a.weekday();b++)c.push(this.makeDayHTML(d));
for(;a.month()==e;)c.push(this.makeDayHTML(d,a)),6===a.weekday()&&c.push("\x3c/div\x3e\x3cdiv class\x3d'keel-grid weekGrid' role\x3d'row'\x3e"),a.add(1,"day");a.add(-1,"day");c.push("\x3c/div\x3e");c.push("\x3c/div\x3e");c.push("\x3c/div\x3e");c.push("\x3c/div\x3e");return c.join("")},makeDayTipHTML:function(){return""},makeDayHTML:function(a,b){var c="",e="",d="",f=-1,g="";b?(this.checkDate(b)?(b.isSame(this.now)&&(c="today"),f=0):c="disabled",e=b.date(),g="aria-describedby\x3d'%s-%s'".format(a,
b.weekday()),d="data-val\x3d'%s'".format(b.valueOf())):c="empty";return"\x3cdiv %s class\x3d'col-day %s' role\x3d'gridcell' %s tabindex\x3d'%s'\x3e\x3cdiv class\x3d'day'\x3e%s\x3c/div\x3e\x3c/div\x3e".format(d,c,g,f,e)},onNextClick:function(a){f(a.currentTarget).is(".disabled")||this.animating?a.preventDefault():this.changeMonth(1)},onPrevClick:function(a){f(a.currentTarget).is(".disabled")||this.animating?a.preventDefault():this.changeMonth(-1)},proxyClick:function(a){32!=a.which&&13!=a.which||this.trigger("click")},
calculateMonthOffset:function(a){a=moment(a).startOf("month").diff(this.currentDate.startOf("month"));a=Math.round(moment.duration(a).asMonths());0<a&&--a;return a},changeMonth:function(a){var b=this;this.currentDate.add(a,"month");1!==Math.abs(a)||500>this.animation.outerWidth()?(this.update(this.currentDate),this.onMonthChange()):(this.animating=!0,this.animation.addClass("animating").css("transform","translateX(%spx)".format(-260*a)),this.setDisplayHeight(a),setTimeout(function(){b.animating=!1;
b.animation.removeClass("animating").css("transform","translateX(0px)");-1==a?(b.removeMonth(b.months.children().last()),b.addMonth(b.makeMonthHTML(b.currentDate.clone(),-1),!0),b.months.children().eq(1).attr("aria-hidden","false").removeClass("col-hidden"),b.months.children().eq(3).attr("aria-hidden","true").addClass("col-hidden")):1==a&&(b.removeMonth(b.months.children().first()),b.addMonth(b.makeMonthHTML(b.currentDate.clone(),2),!1),b.months.append(),b.months.children().eq(2).attr("aria-hidden",
"false").removeClass("col-hidden"),b.months.children().eq(0).attr("aria-hidden","true").addClass("col-hidden"));b.onMonthChange()},200),this.updateNav())},updateNav:function(){this.checkDate(this.getMonthDate(-1,!0))?this.prev.removeClass("disabled").removeAttr("disabled"):this.prev.addClass("disabled").attr("disabled","disabled");this.checkDate(this.getMonthDate(2))?this.next.removeClass("disabled").removeAttr("disabled"):this.next.addClass("disabled").attr("disabled","disabled")},getMonthDate:function(a,
b){a=this.currentDate.clone().add(a,"month");return b?a.endOf("month"):a.startOf("month")},checkDate:function(a){return a.isBefore(this.now)&&!this.options.allowPastDates||a.isAfter(this.maxDate)||null!==this.minDate&&a.isBefore(this.minDate)?!1:!0},setMinDate:function(a){this.minDate=moment(a);this.update(a)},setDisplayHeight:function(a){a||(a=0);var b=0;this.months.children().each(function(c){c-=a;if(1==c||2==c)b=Math.max(b,f(this).find(".month").outerHeight())});this.displayWrapper.height(b)},
getInitDate:function(){var a=this.options.initDate,a=a?moment(a):this.now.clone();a.isBefore(this.now)&&!this.options.allowPastDates&&(a=this.now.clone());return a},setTitle:function(a){this.getChildElement("title").html(a)},removeMonth:function(a){this.removeDayEventHandlers(a);a.remove()},addMonth:function(a,b){b?(this.months.prepend(a),this.addDayEventHandlers(this.months.children().first())):(this.months.append(a),this.addDayEventHandlers(this.months.children().last()))},addDayEventHandlers:function(a){a=
a.find(".col-day[data-val]").not(".disabled");this.bindEvent(a,"click.day",this.onDayClick);this.bindEvent(a,"mouseenter.day",this.onDayPreviewOver);this.bindEvent(a,"mouseleave.day",this.onDayPreviewOut)},removeDayEventHandlers:function(a){a=a.find(".col-day[data-val]").not(".disabled");a.off("click.day");a.off("mouseenter.day");a.off("focus.day");a.off("mouseleave.day");a.off("blur.day")},bindEvent:function(a,b,c){var e=this;a.off(b).on(b,function(a){return c.call(e,this,a)})},onMonthChange:function(){},
onDayClick:function(a,b){},onDayPreviewOver:function(a,b){},onDayPreviewOut:function(a,b){},getSelectableDays:function(a){var b=this.months.children().find(".col-day[data-val]").not(".disabled");return a?b.filter(a):b},getDayElement:function(a){a=moment(a).valueOf();return this.element.find(".col-day[data-val\x3d%s]".format(a))}})})(R9,jQuery);(function(a){R9.createWidgetClass("Checkbox",a.extend({},R9.Widgets.Checkbox.prototype,{init:function(){this.elementNode=this.element.get(0);this.icon=a(R9.Widgets.Checkbox.findIconNode(this.elementNode))},addEventHandlers:function(){this.bindInputClickEvent();this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent)}}))})(jq||jQuery);(function(d,e){d.createWidgetClass("DateInput",{options:{placeholder:"",displayFormat:"ddd M/D",inputFormat:"MM/DD/YYYY",field:"startDate",group:"",updateGroup:"",isoDate:"",change:null,wrapper:null,minDateFunc:null,flexDisplayEnabled:!1},inputElement:null,date:null,previewDate:null,now:null,maxDate:null,minDate:null,tempDate:null,inModal:!1,inSticky:!1,flexDisplay:null,timers:{selectAll:null},typing:!1,focusData:{data:null,triggering:!1},Keys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,RETURN:13,PAGE_UP:33,
PAGE_DOWN:34,SPACE:32,HOME:36,SHIFT:16,END:35,ESC:27},init:function(){this.inputElement=this.getChildElement("input");this.inModal=1===this.element.closest(".R9-Overlay").length;this.inSticky=1===this.element.closest(".R9-Sticky").length;this.now=moment().startOf("day");this.maxDate=moment().add(1,"year");this.flexDisplay=this.getChildElement("flexDisplay");if(this.validateDate(moment(this.options.isoDate))){var a=moment(this.options.isoDate);this.setDate(a.valueOf())}else this.showPlaceholder()},
addEventHandlers:function(){var a=this;this.subscribe("DatePicker.update",{updateGroup:this.options.updateGroup},this.onDatePickerUpdate.bind(this));this.subscribe("DateInput.%s.focus".format(this.options.field),this.options.group,function(){a.focus()});this.inputElement.on("focus",function(b){a.onFocus.call(a,this,b,a.focusData.data);a.focusData.triggering=!1;a.focusData.data=null});this.inputElement.on("blur",function(b){a.onBlur.call(a,this,b)});this.inputElement.on("keydown",function(b){a.onKeydown.call(a,
this,b)});this.inputElement.on("keyup",function(b){a.onKeyup.call(a,this,b)});this.element.find("[data-proxy-click]").click(function(){a.inputElement.trigger("click")});d.question.answer("DateInput.%s.%s".format(this.options.group,this.options.field),this.getInputData.bind(this))},getInputData:function(){var a={offset:this.element.offset(),height:this.element.outerHeight(),value:this.getValue()};this.options.wrapper&&(a.wrapper="#%s".format(this.options.wrapper));return a},onDatePickerUpdate:function(a){if(a.fields.hasOwnProperty(this.options.field))switch(a.action){case "change":this.receiveDateChange(a);
break;case "preview":this.receiveDatePreview(a);break;case "focus":this.options.group===a.group&&(this.focusData=e.extend({},{data:a,triggering:!0}),this.focus());break;case "blur":this.showDate();this.element.removeClass("focused");d.events.publish("DateInput.%s.onBlur".format(this.options.field),this.options.group);break;case "flex":this.options.flexDisplayEnabled&&this.receiveFlexChange(a)}},focus:function(){this.inputElement.trigger("focus")},onFocus:function(a,b,c){b="input";c&&c.format&&(b=
c.format);"function"===typeof this.options.minDateFunc&&this.options.minDateFunc.call(this,this);this.focusData.triggering||this.summonDatePicker();this.typing=!1;(c=this.getValue())&&this.showDate(c,b);"input"!==b||this.isPlaceholder||this.selectAll(a);this.element.addClass("focused");d.events.publish("DateInput.%s.onFocus".format(this.options.field),this.options.group)},onBlur:function(a,b){},onKeydown:function(a,b){var c=a=!1;switch(b.which){case this.Keys.RETURN:case this.Keys.TAB:c=!0;break;
case this.Keys.UP:case this.Keys.DOWN:case this.Keys.LEFT:case this.Keys.RIGHT:case this.Keys.PAGE_UP:case this.Keys.PAGE_DOWN:case this.Keys.SPACE:case this.Keys.HOME:case this.Keys.END:a=!0;break;case this.Keys.ESC:c=!0;break;case this.Keys.CTRL:case this.Keys.SHIFT:break;default:this.typing=!0}this.typing&&this.isPlaceholder&&this.inputElement.val("");var d=moment(this.inputElement.val());if(this.validateDate(d)||c)if(!this.typing||c)this.handleKeyboardNavigation(b,d),a&&b.preventDefault()},handleKeyboardNavigation:function(a,
b){var c=!0,d=b.clone();switch(a.which){case this.Keys.UP:b.subtract(1,"week");break;case this.Keys.DOWN:b.add(1,"week");break;case this.Keys.LEFT:b.subtract(1,"day");break;case this.Keys.RIGHT:b.add(1,"day");break;case this.Keys.PAGE_UP:a.ctrlKey||a.metaKey?b.subtract(1,"year"):b.subtract(1,"month");break;case this.Keys.PAGE_DOWN:a.ctrlKey||a.metaKey?b.add(1,"year"):b.add(1,"month");break;case this.Keys.HOME:b=b.startOf("month");break;case this.Keys.END:b=b.endOf("month");break;case this.Keys.SPACE:c=
!1;this.sendDateChange(b,!0);break;case this.Keys.TAB:c=!1;b.isValid()&&!b.isSame(this.date)?this.sendDateChange(b):this.dismissDatePicker(!0,a.shiftKey);break;case this.Keys.RETURN:c=!1;this.validateDate(b)?this.sendDateChange(b):this.dismissDatePicker();break;case this.Keys.ESC:c=!1;this.dismissDatePicker();this.inputElement.trigger("blur");break;default:c=!1}c&&this.sendDatePreview(b,d)},onKeyup:function(a,b){a=moment(this.inputElement.val());this.validateDate(a)&&this.typing&&b.which!==this.Keys.TAB&&
b.which!==this.Keys.RETURN&&this.sendDatePreview(a,this.date.clone(),{preventUpdate:!0})},setDate:function(a,b){a&&this.validateDate(moment(a))?this.date=moment(a):null===a&&this.clearDate();b||this.showDate()},setMinDate:function(a){a&&this.validateDate(moment(a))&&(this.minDate=a)},clearDate:function(){this.date=null},getValue:function(){return this.date?this.date.valueOf():0},getDate:function(){return this.date?this.date.clone():null},validateDate:function(a){return a.isValid()&&a.isSameOrAfter(this.now)&&
a.isBefore(this.maxDate)},receiveDatePreview:function(a){var b=a.fields[this.options.field];a=this.options.field===a.picking&&!a.clear;b?this.showDate(b,"input"):this.getValue()?this.showDate(this.getValue(),a?"input":"display"):this.showPlaceholder()},receiveDateChange:function(a){var b=this.options.field===a.picking;this.setDate(a.fields[this.options.field],!0);"function"===typeof this.options.change&&this.options.change.call(this,{field:this.field,date:this.date.format(d.globals.apiDateFormat)});
this.showDate(b?"input":"display")},sendDatePreview:function(a,b,c){var d={action:"preview",date:0,field:this.options.field};a&&(d.value=a.valueOf(),b&&e.extend(d,{previous:b.valueOf()}),e.extend(d,c));this.publishUpdate(d)},receiveFlexChange:function(a){var b=a.data;switch(a.flex){case "plusminusthree":case "weekend":case "openflex":b.inputDisplay&&b.inputDisplay.hasOwnProperty(this.options.field)?(this.element.addClass("show-flex-display"),this.flexDisplay.html(b.inputDisplay[this.options.field])):
(this.element.removeClass("show-flex-display"),this.flexDisplay.html(""));break;default:this.element.removeClass("show-flex-display"),this.flexDisplay.html("")}},sendDateChange:function(a,b){this.publishUpdate({action:"change",value:a.valueOf(),field:this.options.field,focused:!!b})},publishUpdate:function(a){e.extend(a,{updateGroup:this.options.updateGroup,group:this.options.group});d.events.publish("DateInput.update",a)},summonDatePicker:function(){var a={modal:this.inModal,sticky:this.inSticky,
updateGroup:this.options.updateGroup,group:this.options.group,field:this.options.field};this.minDate&&e.extend(a,{minDate:this.minDate});d.events.publish("DateInput.summon",a)},dismissDatePicker:function(a,b){var c={updateGroup:this.options.updateGroup,group:this.options.group,field:this.options.field};a&&!b?c.tabForward=!0:a&&b&&(c.tabBackward=!0);d.events.publish("DateInput.dismiss",c)},showDate:function(a,b){0===arguments.length?(b="display",a=this.getValue()):"string"===typeof arguments[0]?(b=
a,a=this.getValue()):"undefined"===typeof b&&(b="display");0!==a?(this.hidePlaceholder(),"input"===b?this.inputElement.val(moment(a).format(this.options.inputFormat)):"display"===b&&this.inputElement.val(moment(a).format(this.options.displayFormat))):this.showPlaceholder()},showPlaceholder:function(){this.inputElement.val(this.options.placeholder);this.isPlaceholder=!0;this.element.addClass("Placeholder")},hidePlaceholder:function(){this.inputElement.val("");this.isPlaceholder=!1;this.element.removeClass("Placeholder")},
selectAll:function(a){clearTimeout(this.timers.selectAll);this.timers.selectAll=window.setTimeout(function(){a.select()},1)}})})(R9,jQuery);(function(d){d.extend("common.widgets.DateInput.prototype.options",{inputFormat:"DD/MM/YYYY",displayFormat:"ddd D/M",inlineDisplayFormat:"D MMM"})})(window.R9);(function(k,g){k.createWidgetClass("DatePicker","common.widgets.Calendar",{DateMode:{SINGLE:"single",RANGE:"range",WEEKEND:"weekend",OPENFLEX:"openflex"},options:{msg:{},startDate:"",endDate:"",dateMode:"range",group:"",updateGroup:"",minRange:0,closeDelay:0,getFormData:null,consecutive:!0},dateMode:"range",startDate:0,endDate:0,weekendStartTime:{day:4,partial:""},weekendEndTime:{day:0,partial:""},picking:"startDate",prevState:null,pointer:null,visible:!1,init:function(){this.options.startDate&&this.validateDate(this.options.startDate)&&
(this.startDate=moment(this.options.startDate).valueOf());this.options.endDate&&this.validateDate(this.options.endDate)&&(this.endDate=moment(this.options.startDate).valueOf());this.options.getFormData&&(this.cssClass+=" Buzz");this.base();this.options.dateMode&&this.setDateMode(this.options.dateMode)},bindElements:function(){this.base();this.pointer=this.getChildElement("pointer");this.element.attr("data-date-group",this.options.group)},addEventHandlers:function(){var a=this;this.base();this.subscribe("DateInput.update",
{group:this.options.group},this.onDateInputUpdate.bind(this));this.subscribe("DateInput.summon",{group:this.options.group},this.onSummon.bind(this));this.subscribe("DateInput.dismiss",{group:this.options.group},this.onDismiss.bind(this));g(document).on("click.DatePicker",this.hideOnClickOut.bind(this));g(window).on("resize",function(b){a.position()})},getCssClass:function(){return[this.base(),"Common-Widgets-DatePicker R9-Overlay"].join(" ")},hideOnClickOut:function(a){a=g(a.target).closest("[data-date-group\x3d%s]".format(this.options.group));
if(this.visible&&0===a.length)this.onDismiss()},publishUpdate:function(a){g.extend(a,{updateGroup:this.options.updateGroup,group:this.options.group});k.events.publish("DatePicker.update",a)},onDateInputUpdate:function(a){if(this.visible)switch(a.clear&&this.clear(),a.picking&&(this.picking=a.picking),a.weekendStartTime&&(this.weekendStartTime=this.parseWeekendTimes(a.weekendStartTime)),a.weekendEndTime&&(this.weekendEndTime=this.parseWeekendTimes(a.weekendEndTime)),a.dateMode&&this.setDateMode(a.dateMode),
a.action){case "preview":this.picking=a.field;!a.previous&&a.value||this.removeDatePreview(a.previous,!0);a.value&&this.previewDate(a.value,a.preventUpdate);break;case "change":this.changeDate(a.value,a.focused)}},onSummon:function(a){var b=this;this.setPicking(a.field,!0);null!==this.options.getFormData?this.element.addClass("Buzz"):this.element.removeClass("Buzz");a.modal?this.element.addClass("InModal"):this.element.removeClass("InModal");a.sticky?this.element.addClass("InSticky"):this.element.removeClass("InSticky");
this.validateDate(a.minDate)&&this.setMinDate(a.minDate);if(!this.visible){this.visible=!0;this.element.attr("aria-hidden",!this.visible);this.element.addClass("Summon");setTimeout(function(){b.element.addClass("animate")},1);var d=k.question.ask("DateInput.%s.startDate".format(this.options.group));d&&(this.startDate=d.value);if(this.dateMode===this.DateMode.RANGE){var c=k.question.ask("DateInput.%s.endDate".format(this.options.group));this.validateDateRange(d.value,c.value)&&(this.startDate=d.value,
this.endDate=c.value);c&&(this.endDate=c.value)}}this.setDisplayHeight();this.position();this.moveDateIntoView(this[a.field]);this.markSelectedDays();this.updateBuzzData()},onDismiss:function(a){var b=function(){this.visible=!1;this.hideTooltip();this.element.attr("aria-hidden",!this.visible);this.element.removeClass("Summon animate");this.publishUpdate({action:"blur",fields:{startDate:!0,endDate:!0},format:"display"})};this.shouldDismiss(a)&&(this.options.closeDelay?setTimeout(b.bind(this),this.options.closeDelay):
b.call(this))},shouldDismiss:function(a){return this.dateMode===this.DateMode.RANGE&&a&&this.options.consecutive&&(a.tabForward&&"startDate"===this.picking||a.tabBackward&&"endDate"===this.picking)?!1:!0},onDayClick:function(a,b){a=g(a).data("val");this.changeDate(a)},changeDate:function(a,b){moment(a);var d=!1,c=!0,e={action:"change",fields:{}};if(this.dateMode===this.DateMode.RANGE)"startDate"===this.picking&&this.validateDate(a)?(this.startDate===a?(c=!1,this.setPicking("endDate")):(this.startDate=
a,e.fields.startDate=a,this.validateDateRange(a,this.endDate)||(this.endDate=0,e.fields.endDate=this.getMinEndDate()),this.moveDateIntoView(a),this.markSelectedDays(),b||this.setPicking("endDate")),"endDate"===this.wasPicking&&this.endDate&&(e.fields.endDate=this.endDate)):"endDate"===this.picking&&this.validateDate(a)&&(this.endDate===a?(c=!1,0===this.startDate?this.setPicking("startDate"):d=!0):(this.validateDateRange(this.startDate,a)?(this.endDate=a,e.fields.endDate=a):this.startDate||(this.endDate=
a,e.fields.endDate=this.endDate),this.moveDateIntoView(this.endDate),this.markSelectedDays(),b||(0===this.startDate?this.setPicking("startDate"):d=!0))),e.picking=this.picking;else{this.moveDateIntoView(a);e.fields.startDate=a;if(this.validateDate(this.endDate)&&!this.validateDateRange(a,this.endDate)){var f=Math.max(this.options.minRange,1),f=moment(a).add(f,"days");e.fields.endDate=f.valueOf();this.endDate=e.fields.endDate}this.startDate=a;this.markSelectedDays();b||(d=!0)}c&&(this.publishUpdate(e),
"function"===typeof this.options.change&&(a=[this.startDate],this.endDate&&a.push(this.endDate),this.options.change.apply(this,a)));if(d)this.onDismiss()},moveDateIntoView:function(a){0!==a&&(a=this.calculateMonthOffset(a),0!==a&&this.changeMonth(a))},clear:function(){this.endDate=this.startDate=0;this.setPicking("startDate");this.clearDayState("preview");this.clearDayState("hover");this.clearDayState("highlighted");this.clearDayState("selected");this.publishUpdate({action:"clear",fields:{startDate:0,
endDate:0}})},onMonthChange:function(){this.updateBuzzData();this.markSelectedDays()},clearDayState:function(a){var b=this.getSelectableDays(".%s".format(a)).removeClass(a);"selected"===a&&(b.removeAttr("aria-selected"),this.getSelectableDays(".flex").removeClass("flex"))},validateDate:function(a){if("undefined"===typeof a||0===a)return!1;a=moment(a);if(a.isValid()){if(a.isBefore(this.now)&&!this.options.allowPastDates||a.isAfter(this.maxDate)||null!==this.minDate&&a.isBefore(this.minDate))return!1}else return!1;
return!0},validateDateRange:function(a,b){return a&&b?this.validateMinRange(a,b)&&this.validateDate(a)&&this.validateDate(b):!1},validateMinRange:function(a,b){a=moment(a);b=moment(b);return moment.duration(b.diff(a)).asDays()>=this.options.minRange},getMinEndDate:function(){return this.startDate?moment(this.startDate).add(this.options.minRange,"days").valueOf():0},onDayPreviewOver:function(a,b){a=g(a).data("val");this.previewDate(a)},previewDate:function(a,b){var d=moment(a),c={action:"preview",
fields:{},picking:this.picking};!a||d.isBefore(this.now)?(d=this.now.clone(),a=d.valueOf()):d.isSameOrAfter(this.maxDate)&&(d=this.maxDate.clone(),a=d.valueOf());this.dateMode===this.DateMode.RANGE&&("endDate"===this.picking&&0!==this.startDate?this.validateMinRange(this.startDate,a)?this.validateDateRange(this.startDate,a)?c.fields[this.picking]=a:c.endDate=this.getMinEndDate():(0===this.endDate?(this.endDate=this.startDate,this.startDate=0,c.fields={startDate:a,endDate:this.endDate}):c.fields={startDate:a,
endDate:0},this.wasPicking=this.picking,this.setPicking("startDate",!1,!0),c.picking="startDate"):c.fields[this.picking]=a);b||this.publishUpdate(c);this.moveDateIntoView(a);this.markPreviewedDays(a)},removeDatePreview:function(a,b){if(this.visible){a={action:"preview",fields:{startDate:0,endDate:0},clear:!0};this.clearDayState("preview");this.clearDayState("hover");this.hideTooltip();if(this.wasPicking){var d=this[this.wasPicking],c=this[this.picking];if(0===c||0===d)this[this.wasPicking]=c,this[this.picking]=
d;delete a.fields[this.wasPicking];this.setPicking(this.wasPicking,!1,!0);this.wasPicking=null;this.markSelectedDays()}a.picking=this.picking;b||this.publishUpdate(a)}},onDayPreviewOut:function(a,b){a=g(a).data("val");this.removeDatePreview(a)},setDateMode:function(a){this.dateMode=a;this.dateMode!==this.DateMode.RANGE&&this.setPicking("startDate");this.markSelectedDays()},computeActiveDates:function(a,b){switch(this.dateMode){case this.DateMode.RANGE:return this.computeActiveRangeDates(a,b);case this.DateMode.WEEKEND:return this.computeActiveWeekendDates(a,
b);case this.DateMode.OPENFLEX:return this.computeActiveOpenFlexDates(a,b);default:return a?[a.format(b)]:[b]}},computeActiveRangeDates:function(a,b){var d;b||(b=this[this.picking]);b&&(d=moment(b));var c=[];if(d)if("startDate"===this.picking&&this.endDate&&d.valueOf()<=this.endDate)for(b=this.endDate,this.getMonthDate(3).isSameOrBefore(moment(this.endDate))&&(b=this.getMonthDate(3).valueOf());d.valueOf()<=b;)a?c.push(a.format(d.valueOf())):c.push(d.valueOf()),d.add(1,"day");else if("endDate"==this.picking&&
this.startDate&&d.valueOf()>=this.startDate)for(b=this.startDate,this.getMonthDate(-1).isSameOrAfter(moment(this.startDate))&&(b=this.getMonthDate(-1).valueOf());d.valueOf()>=b;)a?c.unshift(a.format(d.valueOf())):c.unshift(d.valueOf()),d.add(-1,"day");else a?c.push(a.format(b)):c.push(b);return c},computeActiveWeekendDates:function(a,b){b=b?moment(b):moment(this.startDate);for(var d=b.clone().add(5,"weeks"),c={selected:[],highlighted:[]},e=!1,f=[],h=[];b.isSameOrBefore(d);)!e&&b.day()>this.weekendStartTime.day||
(b.day()==this.weekendStartTime.day?(e=!0,f=[],h=[],a?f.push(a.format(b.valueOf())):f.push(b.valueOf())):b.day()==this.weekendEndTime.day&&e?(a?f.push(a.format(b.valueOf())):f.push(b.valueOf()),c.selected=c.selected.concat(f),c.highlighted=c.highlighted.concat(h)):(b.day()>this.weekendStartTime.day||b.day()<this.weekendEndTime.day)&&e&&(a?h.push(a.format(b.valueOf())):h.push(b.valueOf()))),b.add(1,"day");return c},computeActiveOpenFlexDates:function(a,b){b=b?moment(b):moment(this.startDate);for(var d=
b.clone().add(5,"weeks"),c=[];b.isSameOrBefore(d);)a?c.push(a.format(b.valueOf())):c.push(b.valueOf()),b.add(1,"day");return c},parseWeekendTimes:function(a){var b=a.split("_");a=b[0];b=b[1];return{day:moment().set("day",a).day(),partial:"ANYTIME"!==b?b:""}},markSelectedDays:function(){var a;this.clearDayState("highlighted");this.clearDayState("preview");this.clearDayState("selected");switch(this.dateMode){case this.DateMode.RANGE:a=this.computeActiveDates("[data-val\x3d%s]");1<a.length&&this.getSelectableDays(a.join(",")).addClass("highlighted");
this.startDate&&(a=this.getStartDayElements(),a.flex&&a.flex.addClass("flex"),a.exact&&a.exact.addClass("selected").attr("aria-selected","true"));this.endDate&&(a=this.getEndDayElements(),a.flex&&a.flex.addClass("flex"),a.exact&&a.exact.addClass("selected").attr("aria-selected","true"));break;case this.DateMode.OPENFLEX:a=this.computeActiveDates("[data-val\x3d%s]");this.getSelectableDays(a.join(",")).addClass("selected").attr("aria-selected","true");this.getDayElement(this.startDate).addClass("selected").attr("aria-selected",
"true");break;case this.DateMode.WEEKEND:a=this.computeActiveDates("[data-val\x3d%s]");this.getSelectableDays(a.selected.join(",")).addClass("selected").attr("aria-selected","true");a.highlighted.length&&this.getSelectableDays(a.highlighted.join(",")).addClass("highlighted");break;default:this.getDayElement(this.startDate).addClass("selected").attr("aria-selected","true")}},getStartDayElements:function(){return{exact:this.getDayElement(this.startDate)}},getEndDayElements:function(){return{exact:this.getDayElement(this.endDate)}},
markPreviewedDays:function(a){this.clearDayState("preview");var b=this.computeActiveDates("[data-val\x3d%s]",a);this.dateMode===this.DateMode.WEEKEND?(b=this.computeActiveDates("[data-val\x3d%s]",a),this.getSelectableDays(b.selected.concat(b.highlighted).join(",")).addClass("preview")):this.getSelectableDays(b.join(",")).addClass("preview");a=this.getDayElement(a);a.addClass("hover");a.attr("data-tip")&&this.showTooltip(a)},setPicking:function(a,b,d){if(this.picking!==a){var c={},e={};c[this.picking]=
!0;this.picking=a;e[this.picking]=!0;this.position(d);b||this.publishUpdate({action:"focus",fields:e,format:"input"});this.publishUpdate({action:"blur",fields:c})}},position:function(a){var b={},d=0,c=0,e=0;if(this.dateMode===this.DateMode.RANGE){var f=k.question.ask("DateInput.%s.startDate".format(this.options.group)),h=k.question.ask("DateInput.%s.endDate".format(this.options.group)),m,l;h||console.error("Missing end input field, if this is a single date, set the dateMode parameter to 'single'");
var n=h.offset.left-f.offset.left;f.wrapper&&f.wrapper===h.wrapper&&(m=g(f.wrapper),l=m.offset());m?(b.left=l.left,d=l.top,c=m.outerHeight(),e="endDate"===this.picking?h.offset.left-l.left:f.offset.left-l.left):f.height===h.height&&f.offset.top===h.offset.top&&this.element.outerWidth()-60>n&&(b.left=f.offset.left,d=f.offset.top,c=f.height,e="endDate"===this.picking?n:0)}b.hasOwnProperty("left")&&"undefined"!==typeof c||(f=k.question.ask("DateInput.%s.%s".format(this.options.group,this.dateMode===
this.DateMode.RANGE?this.picking:"startDate")),d=f.offset.top,c=f.height,b.left=f.offset.left);this.shouldFlipDirection(d,c)?(b.top=d-this.element.outerHeight(),this.element.addClass("up")):(b.top=d+c,this.element.removeClass("up"));d=Math.round(b.left);b=Math.round(b.top);e=Math.round(e);c=Math.round(g(window).width());c=Math.round(this.element.outerWidth())+d-c;0<c&&(d-=c,e+=c);b="translateX(%spx) translateY(%spx)".format(d,b);e="translateX(%spx)".format(e);b={transform:b,msTransform:b};e={transform:e,
msTransform:e};a||this.element.css(b);this.pointer.css(e)},shouldFlipDirection:function(a,b){var d=g(window).scrollTop(),c=d+g(window).outerHeight(),e=this.element.outerHeight();return a+b+e>c&&!(a-e<d)},isBuzzEnabled:function(){return"function"===typeof this.options.getFormData},updateBuzzData:function(){this.isBuzzEnabled()&&(new k.DatePicker.BuzzData).fetch(this.options.getFormData(),this.handleBuzzUpdate.bind(this))},handleBuzzUpdate:function(a){var b=this,d=this.months.find("[data-tip\x3dBUZZ_LOW]"),
c=[];window.subData&&(a=window.subData);if("object"===typeof a.dates)for(var e in a.dates)a.dates.hasOwnProperty(e)&&"LOW"===a.dates[e]&&c.push(moment(e).valueOf());0<d.length&&d.each(function(a,b){a=g(b);b=c.indexOf(a.attr("data-val"));-1==b?a.removeClass("buzz-date-low").removeAttr("data-tip"):c.splice(b,1)});g.each(c,function(a,c){b.getDayElement(c).addClass("buzz-date-low").attr("data-tip","BUZZ_LOW")})},makeAboveCalendarHTML:function(){return"\x3cdiv id\x3d'%s' class\x3d'dayTip buzzMsg'\x3e%s\x3c/div\x3e".format(this.id("BUZZ_LOW"),
this.options.msg.BUZZ_MESSAGE_LOW)},showTooltip:function(a){var b=this.getChildElement(a.attr("data-tip"));a=a.offset();var d=this.element.offset();b.css({top:Math.round(a.top-d.top),left:Math.round(a.left-d.left)}).show()},hideTooltip:function(){this.element.find(".dayTip").hide()}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.widgets.DateRangeInput",{separator:null,options:{group:""},init:function(){this.separator=this.getChildElement("separator")},addEventHandlers:function(){var a=this;this.element.click(function(c){0===d(c.target).closest("[data-date-group\x3d%s]".format(a.options.group)).not("#%s".format(this.id)).length&&b.events.publish("DateInput.%s.focus".format(a.getField(c)),a.options.group)});this.subscribe(["DateInput.startDate.onFocus","DateInput.endDate.onFocus"],
this.options.group,this.onInputFocus.bind(this));this.subscribe(["DateInput.startDate.onBlur","DateInput.endDate.onBlur"],this.options.group,this.onInputBlur.bind(this))},onInputFocus:function(){this.element.addClass("focused")},onInputBlur:function(){this.element.removeClass("focused")},getField:function(a){return a.offsetX<=this.separator.position().left?"startDate":"endDate"}})})(R9,jQuery);(function(c,e){c.publish("common.widgets.BaseCalendar.prototype",e.extend({},c.Widgets.BaseCalendarWidget.prototype,{useSpecialCharacters:!1,options:{language:null,title:"",prevTitle:"",nextTitle:"",titleYearFormat:"YYYY",titleMonthFormat:"MMMM",reverseMonthAndYearOrder:!1,yearSymbol:null},showYearWithSpecialSymbol:function(b){var a=[],d=this.getYearSymbol();a.push("\x3cspan class\x3d'r9-datepicker-year'\x3e");a.push(b.format(this.options.titleYearFormat)+d+" ");a.push("\x3c/span\x3e");return a.join("")},
showMonthAndYear:function(b){var a=[];this.isReverseMonthAndYearOrder()?(a.push(this.showYearWithSpecialSymbol(b)),a.push(this.showMonth(b))):(a.push(this.showMonth(b)),a.push(this.showYearWithSpecialSymbol(b)));return a.join("")},isReverseMonthAndYearOrder:function(){return!0===this.options.reverseMonthAndYearOrder||!0===c.config.getBoolean("ui.datepicker.reverse.order.month.year",!1)},getYearSymbol:function(){return null!=this.options.yearSymbol?this.options.yearSymbol:this.isReverseMonthAndYearOrder()?
c.config.getString("ui.datepicker.year.symbol",""):""}}));c.createWidgetClass("DaterangePicker",e.extend({},c.Widgets.DaterangePickerTwoFields.prototype,c.common.widgets.BaseCalendar.prototype,{widgetName:"daterangePicker",widgetBaseClass:"r9-datepicker",calendarBaseClass:"r9-datepicker-calendar",dropdownId:"datepicker",singleDateMode:!1,maxDate:null,options:e.extend({},c.common.widgets.BaseCalendar.prototype.options,c.Widgets.DaterangePickerTwoFields.prototype.options,{skipForceSetDefaultStartOnFocusBlur:!1,
skipForceSetDefaultEndOnFocusBlur:!1,doNotFillWhenEmpty:!1,minRangeDays:1,alwaysShowEndDatepicker:!1,responsive:!1}),init:function(b){c.Widgets.BaseCalendarWidget.apply(this);this.options.useDaysFormat?(this.unitFormat=this.options.daysFormat,this.unitAdjustment=1):(this.unitFormat=this.options.nightsFormat,this.unitAdjustment=0);this.advanceStyling&&(this.options.skipForceSetDefaultStartOnFocusBlur=!0,this.options.skipForceSetDefaultEndOnFocusBlur=!0,this.options.doNotFillWhenEmpty=!0);this.options.maxDate&&
(this.maxDate=this.options.maxDate);this.elementNode=this.element.get(0);b=this.element.closest(".R9-Overlay");0<b.length&&(this.options.appendTo="#%s".format(b.attr("id")));this.startSection=this.findStartSection();this.startDisplay=this.findStartDisplay();this.startPlaceholderDisplay=this.findStartPlaceholderDisplay();this.startElement=this.startWrapper=this.findStartWrapperElement();this.startInput=this.findStartInput();this.startInputTab=this.findStartInputTab();this.endSection=this.findEndSection();
this.endDisplay=this.findEndDisplay();this.endPlaceholderDisplay=this.findEndPlaceholderDisplay();this.endElement=this.endWrapper=this.findEndWrapperElement();this.endInput=this.findEndInput();this.endInputTab=this.findEndInputTab();this.element.hasClass("singleDate")&&this.setSingleDateMode(!0,!0);this.summaryDisplay=this.findSummaryDisplay();this.setUseDaysFormat(this.options.useDaysFormat);this.initDropdown();this.timers={};this.bindCommandUtilities();this.start_custom_value=this.end_custom_value=
"";this.utils=this.options.commands.utilities;this.today=moment().startOf("day").toDate();this.isResponsive()&&this.handleResponsive();this.wholeMonthSearch&&(this.options.skipForceSetDefaultStartOnFocusBlur=!0,this.options.skipForceSetDefaultEndOnFocusBlur=!0,this.options.doNotFillWhenEmpty=!0);this.update();this.updateClicks();this.updateDOM()},addEventHandlers:function(){var b=function(b){b.off("mousedown focus").on("mousedown focus",function(a){a.preventDefault();a.stopPropagation();b.removeClass("r9-datepicker-end-empty r9-datepicker-start-empty");
e(this).find(".r9-datepicker-display").focus()})};b(this.startWrapper);b(this.endWrapper);this.bindAccessibilityEvents();this.bindEvent(this.startInputTab,"focus",this.handleStartInputFocusEvent);this.bindEvent(this.startInputTab,"blur",this.handleInputBlurEvent);this.bindEvent(this.startInputTab,"keydown",this.handleInputKeydownEvent);this.bindEvent(this.startElement,"mousedown",this.handleStartClickEvent);this.bindEvent(this.endInputTab,"focus",this.handleEndInputFocusEvent);this.bindEvent(this.endInputTab,
"blur",this.handleInputBlurEvent);this.bindEvent(this.endInputTab,"keydown",this.handleInputKeydownEvent);this.bindEvent(this.endElement,"mousedown",this.handleEndClickEvent);this.bindEvent(this.dropdown,"mousedown",this.handleDropdownClickEvent);this.bindEvent(this.overlay,"mousedown",this.handleItemClickEvent);this.isResponsive()&&e(window).resize(this.handleResponsive.bind(this))},handleDropdownClickEvent:function(){return!!this.wholeMonthSearch},isSelectingEndDate:function(){return this.endWrapper.hasClass("r9-datepicker-focus")},
handleCloseEvent:function(){this.isDropdownVisible()&&this.hideDropdown()},handleItemClickEvent:function(b,a){if(!0===this.isBeforeStart(b)&&!1===this.actOnStart)return this.preventBlur=!0,this.wholeMonthSearch&&(this.preventBlur=!1),a.preventDefault(),this;var d=this;a=e(b);var c,f,h;a.hasClass("r9-datepicker-enabled")&&(f=parseInt(a.attr("data-val")),c=(h=this.actOnStart)?0:1,a=this.actOnStart?1:0,this.clicks[c]=f,this.clicks[0]&&this.clicks[1]&&(c=moment(this.clicks[1]).diff(this.clicks[0],"days"),
c<this.options.minRangeDays&&(this.clicks[a]=0)),this.updateDropdownSelection(null),!this.options.alwaysShowEndDatepicker||this.singleDateMode||this.isSelectingEndDate()?!this.singleDateMode&&this.clicks[0]&&this.clicks[1]||this.singleDateMode&&this.clicks[0]?setTimeout(function(){d.hideDropdown();d.options.change&&d.options.change.apply(d,[f,h]);d.options.nextFieldSelector&&e(d.options.nextFieldSelector).focus()},this.options.secondClickHideDelay):this.switchActOn():(this.switchActOn(),d.options.change&&
d.options.change.apply(d,[f,h])));this.updateDOM();e(b).trigger("daterangepicker.itemclicked");return!1},handleStartDisplayFocusEvent:function(b,a){if(this.clickTarget&&e(this.clickTarget[0]).hasClass("FormView"))return this;var d=null,g="",f=this.getStartWrapperElement(),h=this;this.markDropdownElements();e(".r9-datepicker-focus").removeClass("r9-datepicker-focus");e(f).addClass("r9-datepicker-focus");var k=e(b);k.text()||!0!==this.options.skipForceSetDefaultStartOnFocusBlur&&this.setStartDate(this.today);
null!==(d=this.getStartDate())&&(g=e(this.startInput).val()||moment(d).format(this.options.startInputFormat));this.actOnStart=!0;this.hideDropdown(this.getEndWrapperElement());this.showDropdown(f);this.options.accessible&&setTimeout(function(){k.text(g);h.wholeMonthSearch&&("wholeMonthSearch"===(null!==c.storage.get("daterangePickerDefaultNavTab")?c.storage.get("daterangePickerDefaultNavTab"):"specificDate")?h.startDisplay.text("Select a month..."):k.text(g));h.selectDisplayBox(b)},1);a.stopPropagation();
a.stopImmediatePropagation();e("body").trigger("event",[a]);return this},handleStartDisplayBlurEvent:function(b,a){if(null!==this.clickTarget&&(0<this.clickTarget.closest(".r9-datepicker").length||this.wholeMonthSelect))this.blurTarget=b;else{var d=this.getStartWrapperElement(),c=this.getStartDate();b=e(b);""===b.text()&&!0===this.options.doNotFillWhenEmpty&&(this.setStartDate(null),this.options.change&&this.options.change.apply(this,arguments));this.hideDropdown(d);e(d).removeClass("r9-datepicker-focus");
""===b.text()&&null===c?!0!==this.options.skipForceSetDefaultStartOnFocusBlur&&this.setStartDate(this.today):""!==this.start_custom_value?this.utils.applyStartVal():(null===this.getEndDate()||moment(this.getStartDate()).isSame(this.getEndDate()))&&this.setEndDate(moment(this.getStartDate()).add(1,"days").toDate());this.updateDropdownSelection();this.updateClicks();return this}},handleEndDisplayFocusEvent:function(b,a){var d="",c=this.getEndWrapperElement(),f=this;f.markDropdownElements();jq(".r9-datepicker-focus").removeClass("r9-datepicker-focus");
jq(c).addClass("r9-datepicker-focus");var e=jq(b),k=f.clicks[0]||f.today.getTime();(!e.text()||f.clicks[1]<=k)&&!0!==this.options.skipForceSetDefaultEndOnFocusBlur&&f.setEndDate(moment(k).toDate());var l;null!==(l=f.getEndDate())&&(d=jq(f.endInput).val()||moment(l).format(f.options.endInputFormat));f.actOnStart=!1;f.showDropdown(c);f.options.accessible&&(jq(f.endDisplay).attr("contenteditable","true"),setTimeout(function(){e.text(d);f.selectDisplayBox(b)},1));a.stopPropagation();a.stopImmediatePropagation();
jq("body").trigger("event",[a]);return this},handleEndDisplayBlurEvent:function(b,a){var c=this.getEndWrapperElement();this.options.accessible&&jq(this.endDisplay).attr("contenteditable","false");if(null!==this.clickTarget&&0<this.clickTarget.closest(".r9-datepicker").length)this.blurTarget=b;else return b=jq(b),""===b.text()&&!0===this.options.doNotFillWhenEmpty&&(this.setEndDate(null),this.options.change&&this.options.change.apply(this,arguments)),this.hideDropdown(c),""===b.text()&&null===this.getEndDate()?
!0!==this.options.skipForceSetDefaultEndOnFocusBlur&&(null!==this.getStartDate()?this.setEndDate(moment(this.getStartDate()).add(1,"days")):this.setEndDate(moment().toDate())):this.utils.applyEndVal(),this.updateDropdownSelection(),this},switchActOn:function(){var b=!this.actOnStart;this.hideDropdown(this.getWrapperElement());this.actOnStart=b;e(this.actOnStart?this.startInputTab:this.endInputTab).focus()},findStartSection:function(){return this.getChildElement("start")},findStartDisplay:function(){return this.getChildElement("start-display")},
findStartPlaceholderDisplay:function(){return this.getChildElement("start-placeholder")},findEndSection:function(){return this.getChildElement("end")},findEndDisplay:function(){return this.getChildElement("end-display")},findEndPlaceholderDisplay:function(){return this.getChildElement("end-placeholder")},findSummaryDisplay:function(){return this.getChildElement("summary-display")},findClearDisplay:function(){return this.getChildElement("clear")},findCloseLink:function(){return e(".r9-datepicker-title-close",
this.dropdown)},findTitle:function(){return e(".r9-datepicker-title \x3e span",this.dropdown)},findStartInput:function(){return this.getChildElement("start-formField")},findEndInput:function(){return this.getChildElement("end-formField")},findTabInput:function(){return this.getChildElement("tab")},findStartInputTab:function(){return this.getChildElement("start-tab")},findEndInputTab:function(){return this.getChildElement("end-tab")},findStartWrapperElement:function(){return this.getChildElement("start-wrapper")},
findEndWrapperElement:function(){return this.getChildElement("end-wrapper")},getDropdownEl:function(){return e("#datepicker")},getWrapperElement:function(){return this.actOnStart?this.startWrapper:this.endWrapper},getStartWrapperElement:function(){return this.startWrapper},getEndWrapperElement:function(){return this.endWrapper},handleNextPrevClickEvent:function(b,a){b=moment(parseInt(e(b).attr("data-val")));this.dropdown[0].innerHTML=this.makeCalendarHTML(b);this.updateDropdownSelection(null);this.loadBuzzData&&
this.displayBuzzData();this.isResponsive()&&c.utils.presentation.isTablet()&&(this.updateTitle(),this.bindEvent(this.findCloseLink(),"click",this.handleCloseEvent));this.wholeMonthSearch&&(this.createCalendarTabNavBindings(),this.createWholeMonthClickBindings(),this.createNoOfNightsChangedBinding(),jq(".tabWrapper.wholeMonth").hasClass("selected")?jq(".tabWrapper.wholeMonth").trigger("click"):jq(".tabWrapper.specificDate").trigger("click"),jq(".searchform.rtow").hasClass("oneway")&&(jq(".tabWrapper.wholeMonth").hide(),
jq(".tabWrapper.specificDate").click()));return!1},showDropdown:function(b){this.hideTimeout&&clearTimeout(this.hideTimeout);this.options.show&&this.options.show.apply(this,arguments);this.dropdown.parent().is(this.options.appendTo)||this.dropdown.appendTo(this.options.appendTo);this.showOverlay();this.markDropdownElements();this.updateClicks();"function"===typeof this.options.minDateFunc&&this.options.minDateFunc(this);this.wholeMonthSearch&&jq(".searchform.rtow").hasClass("oneway")&&(c.events.publish("flights.search.rt.form.wholeMonthSelect.setSpecificDateCategory",
{group:"wholeMonthSelect"}),this.daterangePickerDefaultNavTab="specificDate");this.dropdown[0].innerHTML=this.makeCalendarHTML(!this.actOnStart&&this.clicks[1]?this.clicks[1]:this.clicks[0]);this.updateDropdownSelection(null);this.wholeMonthSearch&&(this.createCalendarTabNavBindings(),this.createWholeMonthClickBindings(),this.createNoOfNightsChangedBinding(),jq(".tabWrapper.wholeMonth").hasClass("selected")?jq(".tabWrapper.wholeMonth").trigger("click"):jq(".tabWrapper.specificDate").trigger("click"),
jq(".searchform.rtow").hasClass("oneway")&&(jq(".tabWrapper.wholeMonth").hide(),jq(".tabWrapper.specificDate").click()));var a=this.calendarBaseClass;this.options.dropdownClass&&(a=a+" "+this.options.dropdownClass);e(b).addClass("r9-datepicker-focus");this.dropdown.addClass(a);this.advanceStyling&&this.dropdown.addClass("r9-advance-styling");this.wholeMonthSearch?this.dropdown.addClass("CalendarWidget-WholeMonthSearch"):this.dropdown.hasClass("CalendarWidget-WholeMonthSearch")&&this.dropdown.removeClass("CalendarWidget-WholeMonthSearch");
a=this.dropdown[0].style;this.positionDropdown(b);c.events.publish("common.widgets.DaterangePicker.showDropdown",{wrapper:b});var d=this,g=e(window).width();this.resizeHandler=function(){var a=e(window).width();10<Math.abs(a-g)&&(g=a,d.positionDropdown(b))};e(window).on("resize",this.resizeHandler);this.bindItemEvent("mousedown",this.handleItemClickEvent);if("ontouchstart"in document.documentElement){var f=this;this.overlay.addClass("touch");this.bindOverlayEvent("mousedown",function(){f.hideDropdown()})}else this.bindItemEvent("mouseover",
this.handleItemHoverEvent),this.bindItemEvent("mouseout",this.handleItemHoverEndEvent);this.isResponsive()&&c.utils.presentation.isTablet()&&(this.updateTitle(),this.bindEvent(this.findCloseLink(),"click",this.handleCloseEvent));this.bindNextPrevEvent("mousedown",this.handleNextPrevClickEvent);this.dropdown.prop("data-owner",b.attr("id"));this.loadBuzzData&&this.displayBuzzData();a.display=this.isResponsive()&&c.utils.presentation.isTablet()?"block":"inline";this.wholeMonthSearch&&(d=this,jq(".noOfNightsInput").on("click",
function(){jq(this).change().select()}),setTimeout(function(){jq(".noOfNightsInput").is(":focus")||(d.clickTarget=jq(".noOfNightsInput"),jq(".noOfNightsInput").trigger("click"))},300))},createCalendarTabNavBindings:function(){var b=this;jq(b.dropdown).find(".tabWrapper").on("click",function(){var a=this;jq(b.dropdown).find(".tabWrapper:not(no-click)").removeClass("selected");jq(this).addClass("selected");jq(b.dropdown).removeClass("SelectedNavTab-Date").removeClass("SelectedNavTab-Month");if(jq(this).hasClass("specificDate"))setTimeout(function(){var c=
jq(a).width(),d=jq(a).position().left-25;jq(b.dropdown).find(".tabUnderlay").css({left:d,width:c})},10),setTimeout(function(){var a=jq(b.dropdown).find(".tabUnderlay");a.hasClass("no-transition")&&a.removeClass("no-transition")},100),jq(b.dropdown).addClass("SelectedNavTab-Date"),jq(b.dropdown).find(".plusMinus").stop().fadeIn(),"undefined"!==typeof c.storage&&c.storage.set("daterangePickerDefaultNavTab","specificDate"),c.events.publish("flights.search.rt.form.wholeMonthSelect.setSpecificDateCategory",
{group:"wholeMonthSelect"}),this.daterangePickerDefaultNavTab="specificDate";else{var d=jq(b.dropdown).find(".tabUnderlay");setTimeout(function(){var b=jq(a).width(),c=jq(a).position().left-25;d.css({left:c,width:b})},10);setTimeout(function(){var a=jq(b.dropdown).find(".tabUnderlay");a.hasClass("no-transition")&&a.removeClass("no-transition")},100);jq(b.dropdown).addClass("SelectedNavTab-Month");jq(b.dropdown).find(".plusMinus").stop().fadeOut();"undefined"!==typeof c.storage&&c.storage.set("daterangePickerDefaultNavTab",
"wholeMonthSearch");setTimeout(function(){jq(".noOfNightsInput").is(":focus")||(b.clickTarget=jq(".noOfNightsInput"),jq(".noOfNightsInput").trigger("click"))},300);c.events.publish("flights.search.rt.form.wholeMonthSelect.setWholeMonthCategory",{group:"wholeMonthSelect"});this.daterangePickerDefaultNavTab="wholeMonthSearch"}});jq(b.dropdown).find(".input.flexPlusMinus").on("click",function(){jq(this).toggleClass("checked");jq(this).hasClass("checked")?("undefined"!==typeof c.storage&&c.storage.set("flexPlusMinusChecked",
!0),c.events.publish("flights.search.rt.form.wholeMonthSelect.enablePlusMinusSearch",{group:"wholeMonthSelect"})):("undefined"!==typeof c.storage&&c.storage.set("flexPlusMinusChecked",!1),c.events.publish("flights.search.rt.form.wholeMonthSelect.disablePlusMinusSearch",{group:"wholeMonthSelect"}))})},createWholeMonthClickBindings:function(){var b=this;jq(b.dropdown).off("click").on("click",".monthWrapper",function(){jq(b.dropdown).find(".monthWrapper").removeClass("selected");jq(this).addClass("selected");
var a=jq(this).data("month"),d=jq(this).data("end-of-month"),e=jq(this).data("year"),f=new Date(e,a-1,1),d=new Date(e,a-1,d);moment(f).isBefore(moment())&&(f=moment().toDate());"undefined"!==typeof c.storage&&(c.storage.set("flexSelectedMonth",a),c.storage.set("flexSelectedYear",e));c.events.publish("flights.search.rt.form.wholeMonthSelect",{group:"wholeMonthSelect",startDate:f,endDate:d});c.Analytics.api.trackEvent({category:"sw16-flex-to-the-max",action:"searchByWholeMonthClick",label:"month",value:a-
1});b.handleCloseEvent()})},createNoOfNightsChangedBinding:function(){var b=jq(this.dropdown).find(".noOfNightsInput");jq(this.dropdown).off("change").on("change",".noOfNightsInput",function(){var a,d;a=b.val().replace(" ","").replace("nights","").split("-");1<a.length?(d=a[0],a=a[1]):(d=a[0],a=a[0]);7<a-d&&(d=a-7);var e=d+"-"+a;d===a&&(e=d);b.val(e);"undefined"!==typeof c.storage&&c.storage.set("flexNoOfNights",e);c.events.publish("flights.search.rt.form.noOfNightsChanged",{group:"wholeMonthSelect",
noOfNights:b.val()})})},endStartIsSameField:function(){return this.options.singleDateMode||this.options.singlePickerWithSingleField},refreshWidth:function(){var b=this.dropdown[0].style;b.width="inherit";var a=this.dropdown.outerWidth();this.options.minWidth&&(a=Math.max(this.options.minWidth,a));this.options.maxWidth&&(a=Math.min(this.options.maxWidth,a));b.width=a+this.options.offsetWidth+"px"},positionDropdown:function(b){var a=b.offset(),d=jq(this.options.appendTo).offset(),g=this.dropdown[0].style;
g.zIndex=10009;e("#datepicker").removeClass("r9-datepicker-responsive-right-position");if(this.isResponsive()&&c.utils.presentation.isTablet())this.dropdown.css({left:"0",top:c.utils.presentation.isMobile()?"0":"4%"});else{var f=a.left-d.left,h=f+this.dropdown.outerWidth();h>window.innerWidth&&(h-=window.innerWidth,f=f-h-15,this.dropdown.find(".r9-datepicker-pointer").css("left",h+36+"px"));g.left=f+"px";this.shouldFlipDirection()?(this.dropdown.addClass("up"),g.top=a.top-this.dropdown.outerHeight()-
d.top+"px"):(this.dropdown.removeClass("up"),g.top=a.top+b.outerHeight()-d.top+"px")}},shouldFlipDirection:function(){var b=e(window).scrollTop(),a=b+e(window).outerHeight(),c=this.dropdown.outerHeight(),g=this.element.offset().top;return g+this.element.outerHeight()+c>a&&!(g-c<b)},initDropdown:function(){var b=this.getDropdownId(this.element),a=this.getDropdownEl(this.element).get(0);if("undefined"===typeof a){var d=c.Widgets.DaterangePicker.prototype.widgetBaseClass+" R9-Overlay";this.options.dropdownClass&&
(d=d+" "+this.options.dropdownClass);a=jq("\x3cdiv\x3e\x3c/div\x3e",{id:b,css:{display:"none",position:"absolute"}}).appendTo(this.options.appendTo)[0];jq(a).addClass(d);this.advanceStyling&&jq(a).addClass("r9-advance-styling");this.wholeMonthSearch&&(jq(a).addClass("CalendarWidget-WholeMonthSearch"),b="specificDate","undefined"!==typeof c.storage&&(b="undefined"!==typeof c.storage.get("daterangePickerDefaultNavTab")?c.storage.get("daterangePickerDefaultNavTab"):"specificDate"),"wholeMonthSearch"===
b?jq(a).addClass("SelectedNavTab-Month"):jq(a).addClass("SelectedNavTab-Date"))}this.dropdown=jq(a);this.overlay=jq("#"+this.widgetBaseClass+"-overlay");this.overlay.length||(this.overlay=jq('\x3cdiv id\x3d"'+this.widgetBaseClass+'-overlay" class\x3d"'+this.widgetBaseClass+'-overlay R9-Overlay"\x3e\x3c/div\x3e').appendTo(this.options.appendTo))},isResponsive:function(){return this.options.responsive},handleResponsive:function(){c.utils.presentation.isTablet()?(this.dropdown.addClass("mobile-datepicker"),
this.overlay.addClass("mobile-overlay")):(this.dropdown.removeClass("mobile-datepicker"),this.overlay.removeClass("mobile-overlay"));this.positionDropdown(this.actOnStart?this.getStartWrapperElement():this.getEndWrapperElement())},updateTitle:function(){var b="",a,c="";null!==(a=this.getStartDate())&&(b=moment(a).format(this.options.titleFormat));null!==(c=this.getEndDate())&&a!==c&&(b+=(b?" - ":"")+moment(c).format(this.options.titleFormat));this.findTitle().text(b)}}))})(R9,jQuery);
(function(c){c.extend("common.widgets.DaterangePicker.prototype.options",{startInputFormat:"DD/MM/YYYY",endInputFormat:"DD/MM/YYYY",startFormat:"ddd D/M",endFormat:"ddd D/M",inlineDisplayFormat:"D MMM",titleFormat:"D MMM"})})(window.R9);(function(d,c){d.createWidgetClass("Dialog",{content:null,contentBody:null,closeButton:null,modalBackground:null,options:{modal:!0,blur:!1,onClose:null,onOpen:null,afterOpen:null,closeOnModalClick:!0,openImmediately:!1,preventClose:!1},topLevelComponent:null,returnElement:null,init:function(){var a=this;a.content=this.getChildElement("content");a.contentBody=this.getChildElement("body");a.closeButton=this.getChildElement("close");a.modalBackground=this.getChildElement("modal");a.viewport=this.getChildElement("viewport");
a.body=c("body");(d.Common.Utils.Browsers.isIE()||d.Common.Utils.Browsers.isEdge())&&a.content.addClass("ie");this.options.modal||a.modalBackground.hide();this.options.openImmediately&&this.open();a.options.preventClose?a.closeButton.hide():c(document).keydown(function(b){27===b.which&&a.close()});this.topLevelComponent=this.contentBody.children("div").eq("0")},addEventHandlers:function(){function a(a){a=c(a.target).closest(".content");b.content[0]===a[0]||b.options.preventClose||b.close()}var b=
this;b.options.preventClose||b.closeButton.click(function(){b.close()});if(b.viewport&&b.options.closeOnModalClick)b.viewport.on("click",a);c(b.content).click(function(c){b.viewport.off("click",a);setTimeout(function(){b.viewport.on("click",a)},50)});c(window).on("resize",function(){b.calculateDimensions()})},calculateDimensions:function(){if(null!=this.topLevelComponent&&this.topLevelComponent.length){var a=this.topLevelComponent[0].getBoundingClientRect(),b=this.content[0].getBoundingClientRect(),
c=null!=this.topLevelComponent.outerWidth()?Math.ceil(a.width):null,a=null!=this.topLevelComponent.outerHeight()?Math.ceil(a.height):null;c!==Math.ceil(b.width)&&this.content.width(c);a!==Math.ceil(b.height)&&this.content.height(a)}},setContentDimensions:function(a,b){void 0!==a&&this.content.width(a);void 0!==b&&this.content.height(b)},setContent:function(a){this.contentBody.html(a);this.topLevelComponent=this.contentBody.children("div").eq("0")},close:function(){if(this.isOpen()){if(this.isTouchDevice()){var a=
this.body.css("top").replace("-","").replace("px","");this.body.css({overflow:"",position:"",width:"",top:0})}this.body.scrollTop(a);this.element.removeClass("visible");if("function"===typeof this.options.onClose)this.options.onClose(this.element);d.events.publish("dialog.close");this.options.blur&&d.events.publish("pageContainer.contentBlur",!1);c("body").removeClass("hideOverflow modal-open");this.returnElement&&this.returnElement.length&&(this.returnElement.focus(),this.returnElement=null)}},open:function(a){this.topLevelComponent&&
0!==this.topLevelComponent.length||(this.topLevelComponent=this.contentBody.children("div").eq("0"));this.returnElement=c(document.activeElement);this.element.addClass("visible");this.closeButton.focus();if("function"===typeof this.options.onOpen)this.options.onOpen(this.element);"function"===typeof a&&a(this.element);this.modalBackground.length&&c("body").addClass("hideOverflow modal-open");this.options.blur&&d.events.publish("pageContainer.contentBlur",!0);null!==this.topLevelComponent&&setTimeout(this.calculateDimensions.bind(this),
1);this.isTouchDevice()&&this.body.css({overflow:"hidden",position:"fixed",width:"100%",top:"-"+this.body.scrollTop()+"px"});"function"===typeof this.options.afterOpen&&this.options.afterOpen()},isOpen:function(){return this.element.hasClass("visible")},isTouchDevice:function(){return"ontouchstart"in window||navigator&&navigator.maxTouchPoints}})})(R9,jQuery);(function(c,b){c.createWidgetClass("Dropdown",{status:null,select:null,selectEl:null,refreshTimer:null,lastSelectedIndex:-1,options:{click:null,change:null,statusClientTemplate:""},init:function(){this.status=this.getChildElement("status");this.select=this.getChildElement("select");this.selectEl=this.select.get(0)},addEventHandlers:function(){this.select.click(this.handleSelectClickEvent.bind(this));this.select.keydown(this.handleSelectKeydownEvent.bind(this));this.select.keyup(this.handleSelectKeyupEvent.bind(this));
this.select.focus(this.handleSelectFocusEvent.bind(this));this.select.blur(this.handleSelectBlurEvent.bind(this));this.select.change(this.handleSelectChangeEvent.bind(this))},refresh:function(){this.select.is(":disabled")?this.element.addClass("disabled"):this.element.removeClass("disabled");var a=this.selectEl.selectedIndex;0>a&&(a=0);a=this.selectEl.options[a];"undefined"!==typeof a&&(this.options.statusClientTemplate?this.status.html(c.template.render(this.options.statusClientTemplate,a)):(this.status.html(c.utils.escapeHTML(a.title||
a.text||a.value)),this.selectEl.title=a.title||a.text||a.value))},startRefreshLoop:function(){var a=this;this.lastSelectedIndex=this.selectEl.selectedIndex;this.refreshTimer=setInterval(function(){a.doRefresh()},100)},stopRefreshLoop:function(){null!=this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null,this.lastSelectedIndex=-1)},doRefresh:function(){this.selectEl.selectedIndex!=this.lastSelectedIndex&&(this.lastSelectedIndex=this.selectEl.selectedIndex,this.refresh())},handleSelectClickEvent:function(){"function"===
typeof this.options.click&&this.options.click(this);this.stopRefreshLoop()},handleSelectKeydownEvent:function(){this.startRefreshLoop()},handleSelectKeyupEvent:function(){this.refresh();this.stopRefreshLoop()},handleSelectFocusEvent:function(){this.selectEl.disabled||this.element.addClass("focused")},handleSelectBlurEvent:function(){this.selectEl.disabled||(this.element.removeClass("focused"),this.refresh(),this.stopRefreshLoop())},handleSelectChangeEvent:function(a){"function"===typeof this.options.change&&
this.options.change.call(this,a);this.refresh();this.stopRefreshLoop()},getSelectedElement:function(){return this.selectEl.options[0<=this.selectEl.selectedIndex?this.selectEl.selectedIndex:0]},getName:function(){return this.selectEl.name},hasOptions:function(){return 0!==this.selectEl.options.length},getValue:function(){return this.hasOptions()?this.getSelectedElement().value:null},getText:function(){return b(this.getSelectedElement()).text()},setText:function(a){this.status.text(a)},setValue:function(a,
b){this.select.val(a);b?this.handleSelectChangeEvent():this.refresh()},setOptions:function(a,c){var e=b("\x3cselect\x3e");b.each(a,function(a,d){d.value===c&&(d.selected=!0);e.append(b("\x3coption\x3e",d))});this.select.html(e.html());this.refresh()}})})(R9,jQuery);(function(f,c){f.createWidgetClass("DropdownDialog",{element:null,elementNode:null,content:null,placeholder:null,label:null,icon:null,isOpen:!1,leftOffset:0,options:{autoOpen:!1,alignment:"left",direction:"down",isPopover:!1,showIcon:!0,matchWidth:!1,iconClass:"",contentClass:"",triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:"",topOffset:"0",removeZIndex:!1,flippable:!0},init:function(){this.options.autoOpen&&this.open();if(this.options.onInit)this.options.onInit(this);
this.createContent();this.elementNode=this.element[0];this.createTrigger();this.popoverArrow=this.getChildElement("popover-arrow")},addEventHandlers:function(){function a(a){a=c(a.target).closest(".Common-Widgets-DropdownDialog-Content");b.content[0]!=a[0]&&b.isOpen&&b.close()}var b=this,d=c("body"),e;e=this.options.triggerClass?c("."+b.options.triggerClass):c(b.element);d.on("click",a);this.subscribe("trips.menu.open",c.proxy(this.close,this));f.events.subscribe("authentication.showLogin",this.close.bind(this,
null,!0));e.click(function(c){b.element.closest(".Common-Widgets-DropdownDialog-Content").length||(d.off("click",a),b.toggleContent(),setTimeout(function(){d.on("click",a)},10))});c(document).keydown(function(a){27===a.which&&b.close(a,null,!0)});this.element.keydown(function(a){if(13===a.which||32===a.which)b.element.trigger("click"),a.preventDefault()});c(window).on("resize",function(){b.isOpen&&b.reposition()});c(document).on("scroll",function(){b.isOpen&&b.reposition()});c(".viewport").on("scroll",
function(){b.isOpen&&b.reposition()});e=function(){b.element.is(":visible")&&(f.Common.Utils.Browsers.isIE(11)||setTimeout(function(){b.reposition()},25))};this.content.on("mouseup touchend",e);f.events.subscribe("horizon.dropdownDialog.reposition",e)},createContent:function(){this.content=this.options.content?c(this.options.content):c("#"+this.element.attr("id")+"_content")},createTrigger:function(){this.element.hasClass("open")&&(this.isOpen=!0);this.label=this.element.find(".label");this.label.length||
(this.label=c("\x3cdiv\x3e",{"class":"label"}),this.element.prepend(this.label));this.placeholder=this.element.find(".placeholder");this.placeholder.length||(this.placeholder=c("\x3cdiv\x3e",{"class":"placeholder",text:this.options.placeholder}),this.element.append(this.placeholder));this.options.showIcon&&(this.icon=this.element.find(".icon"),this.icon.length||(this.icon=c("\x3cdiv\x3e",{"class":"icon "+this.options.iconClass}),this.element.append(this.icon)));this.options.text?this.updateLabel(this.options.text):
this.label.html()&&this.updateLabel(this.label.html())},open:function(){this.isOpen=!0;var a=this,b="body";this.options.container&&""!==this.options.container&&(b=this.options.container,c(a.options.container).off("scroll."+a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.reposition()}));this.options.isPopover&&this.popoverArrow.show();this.content.appendTo(b);this.reposition();a.element.addClass("open");a.content.addClass("open");if(this.options.onOpen)this.options.onOpen(this);f.events.publish("DropdownDialog.open",
{id:a.id()})},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible").not("[tabindex\x3d-1],[disabled]")},close:function(a,b,c){if(this.isOpen){var e=this.isOpen,d=this;this.isOpen=!1;this.options.isPopover&&this.popoverArrow.hide();this.element.removeClass("open");this.content.removeClass("open");d.element.after(d.content);c&&setTimeout(function(){d.element.focus()},1);if(this.options.onClose)this.options.onClose(e,this,a);f.events.publish("DropdownDialog.close",
{id:d.id(),silent:!!b})}},toggleContent:function(){this.isOpen?this.close(null,null,!0):this.open()},updateLabel:function(a){this.label.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},hasValue:function(){return this.element.hasClass("hasValue")},reposition:function(){var a=this.options.direction,b=this.element.offset(),d=c(this.options.container);if(d.length)var e=d.offset(),b={top:b.top-e.top+d.scrollTop(),left:b.left-e.left};else d=c(window);e=b.top+
this.element.outerHeight();this.shouldFlipDirection(a)&&(a="down"===a?"up":"down");"up"===a?(this.content.addClass("up"),e=b.top-this.content.outerHeight()):this.content.removeClass("up");a={top:e+"px"};"right"===this.options.alignment?a.right=d.width()-(b.left+this.getTriggerWidth())+"px":a.left="center"===this.options.alignment?b.left-this.content.outerWidth()/2+this.getTriggerWidth()/2+"px":b.left+"px";this.options.topOffset&&"0"!=this.options.topOffset&&(a.marginTop=this.options.topOffset+"px");
this.leftOffset&&(a.marginLeft=this.leftOffset+"px");this.options.isPopover&&"right"===this.options.alignment&&(a.left=b.left+this.getTriggerWidth()+22+"px",a.top=e-45+"px");a.minWidth=this.options.matchWidth?this.getTriggerWidth()+"px":"";this.options.removeZIndex||(a.zIndex=this.element.zIndex()+9999);this.content.css(a)},shouldFlipDirection:function(a){if(this.options.flippable){var b=c(window).scrollTop(),d=b+c(window).outerHeight(),e=this.content.outerHeight(),f=this.element.offset().top,d=f+
this.element.outerHeight()+e>d,b=f-e<b;if("down"===a)return d&&!b;if("up"===a)return b&&!d}return!1},getTriggerWidth:function(){var a=this.elementNode.getBoundingClientRect();return a?a.right-a.left:this.element.outerWidth()}})})(window.R9,window.jQuery);(function(e,d){e.createWidgetClass("DropdownDialog2",{element:null,content:null,isOpen:!1,options:{loadWithAjaxOnInit:!1,ajaxUrl:"",ajaxData:{},autoOpen:!1,alignment:"left",direction:"down",matchWidth:!1,content:null,container:null},init:function(){this.options.autoOpen&&this.open();this.createContent();this.createTrigger();this.popoverArrow=this.getChildElement("popover-arrow");this.options.loadWithAjaxOnInit&&this.options.ajaxUrl&&this.loadAjax()},loadAjax:function(){var a=this;e.ajax.execute(this.options.ajaxUrl,
{data:this.options.ajaxData,customUpdate:function(b,c){a.content.html(c);return!0}})},addEventHandlers:function(){function a(a){a=d(a.target).closest(".Common-Widgets-DropdownDialog-Content");b.content[0]!=a[0]&&b.isOpen&&b.close()}var b=this,c=d("body");c.on("click",a);this.subscribe("trips.menu.open",d.proxy(this.close,this));e.events.subscribe("authentication.showLogin",this.close.bind(this));d(b.element).click(function(d){b.element.closest(".Common-Widgets-DropdownDialog-Content").length||(c.off("click",
a),b.toggleContent(),setTimeout(function(){c.on("click",a)},10))});d(document).keydown(function(a){27===a.which&&b.close(a)});b.element.width();d(window).on("resize",function(){b.isOpen&&b.reposition()});d(document).on("scroll",function(){b.isOpen&&b.reposition()});d(".viewport").on("scroll",function(){b.isOpen&&b.reposition()});var f=function(){b.element.is(":visible")&&setTimeout(function(){b.reposition()},25)};this.content.on("mouseup touchend",f);e.events.subscribe("horizon.dropdownDialog.reposition",
f)},createContent:function(){this.content=this.options.content?d(this.options.content):d("#"+this.element.attr("id")+"_content")},createTrigger:function(){this.element.hasClass("open")&&(this.isOpen=!0)},open:function(){this.isOpen=!0;var a=this,b="body";this.options.container&&""!==this.options.container&&(b=this.options.container,d(a.options.container).off("scroll."+a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.reposition()}));this.content.appendTo(b);this.reposition();a.element.addClass("open");
a.content.addClass("open");if(this.options.onOpen)this.options.onOpen(this);e.events.publish("DropdownDialog.open",{id:a.id()})},close:function(a){var b=this.isOpen;this.isOpen=!1;this.element.removeClass("open");this.content.removeClass("open");this.element.after(this.content);if(this.options.onClose)this.options.onClose(b,this,a);e.events.publish("DropdownDialog.close",{id:this.id()})},toggleContent:function(){this.isOpen?this.close():this.open()},hasValue:function(){return this.element.hasClass("hasValue")},
reposition:function(){var a=this.element.offset(),b=d(this.options.container);if(b.length)var c=b.offset(),a={top:a.top-c.top+b.scrollTop(),left:a.left-c.left};else b=d(window);c=a.top+this.element.outerHeight();"up"===this.options.direction&&(c=a.top-this.element.outerHeight()-this.content.outerHeight());c={top:c+"px"};"right"===this.options.alignment?c.right=b.width()-(a.left+this.element.outerWidth())+"px":c.left="center"===this.options.alignment?a.left-this.content.outerWidth()/2+this.element.outerWidth()/
2+"px":a.left+"px";c.width=this.options.matchWidth?this.element.outerWidth()+"px":"";c.zIndex=this.element.zIndex()+9999;this.content.css(c)}})})(window.R9,window.jQuery);(function(c,d){c.createWidgetClass("FlexDateDisplay",{options:{group:"",updateGroup:"",msg:{OPEN_FLEX_DURATION_FORMAT:""}},input:null,init:function(){this.input=this.getChildElement("input")},addEventHandlers:function(){var a=this;this.subscribe("DatePicker.update",{updateGroup:this.options.updateGroup},this.onDatePickerUpdate.bind(this));this.input.click(function(){c.events.publish("DateInput.startDate.focus",a.options.group)})},onDatePickerUpdate:function(a){if(a.flex){var b=a.data;this.element.removeClass("empty");
switch(a.flex){case "weekend":this.input.html("%s \x26ndash; %s".format(b.weekend_depart_time_display,b.weekend_return_time_display));break;case "openflex":b.openflex_length_of_stay?this.input.html(c.Common.Utils.String.formatChoice(this.options.msg.OPEN_FLEX_DURATION_FORMAT,"1"==b.openflex_length_of_stay?1:2,b.openflex_length_of_stay)):(this.element.addClass("empty"),this.input.html(this.options.msg.OPEN_FLEX_DURATION_PLACEHOLDER));break;default:this.input.html("")}}}})})(R9,jQuery);(function(f,d){f.createWidgetClass("FlexDatePicker","common.widgets.DatePicker",{flexCategory:"exact",defaultDateMode:"",flexHeader:null,flexDateForms:null,plusMinusThreeDepart:null,plusMinusThreeReturn:null,openFlexDuration:null,categories:{exact:!1,openflex:!1,plusminusthree:!1,weekend:!1},options:{openFlexDefaultDuration:"",openFlexAllowBlankDuration:!1},init:function(){this.base();this.defaultDateMode=this.dateMode;this.options.flexCategory&&(this.flexCategory=this.options.flexCategory)},bindElements:function(){this.base();
this.flexHeader=this.getChildElement("flexHeader");this.flexDateForms=this.getChildElement("flexDateForms");this.categories.openflex&&(this.openFlexDuration=this.getChildElement("openFlexDuration"))},addEventHandlers:function(){var a=this;this.base();this.flexHeader.find("[data-flex-value]").click(this.handleFlexDateChange.bind(this));this.plusMinusThreeDepart=this.bindDropdown(this.getChildElement("plusMinusThreeDepart"),this.onPlusMinusThreeDepartChange);this.plusMinusThreeReturn=this.bindDropdown(this.getChildElement("plusMinusThreeReturn"),
this.onPlusMinusThreeReturnChange);this.weekendDepartTime=this.bindDropdown(this.getChildElement("weekendDepartTime"),this.onWeekendDepartChange);this.weekendReturnTime=this.bindDropdown(this.getChildElement("weekendReturnTime"),this.onWeekendReturnChange);this.initWeekendTimes();this.categories.openflex&&(this.openFlexDuration.blur(this.onOpenFlexDurationBlur.bind(this)),this.openFlexDuration.keypress(function(b){if(13===b.which)a.onDismiss()}))},bindDropdown:function(a,b){return a.dropdown({change:b.bind(this)}).getWidget()},
onPlusMinusThreeDepartChange:function(){this.publishFlexUpdate();this.markSelectedDays();f.Analytics.api.trackEvent({category:"flexDates",label:"plusMinusThree",action:"changeDepart",value:this.plusMinusThreeDepart.getValue()})},onPlusMinusThreeReturnChange:function(){this.publishFlexUpdate();this.markSelectedDays();f.Analytics.api.trackEvent({category:"flexDates",label:"plusMinusThree",action:"changeReturn",value:this.plusMinusThreeReturn.getValue()})},initWeekendTimes:function(){this.onWeekendDepartChange(!0);
this.onWeekendReturnChange(!0)},onWeekendDepartChange:function(a){var b=this.weekendDepartTime.getValue();this.weekendStartTime=this.parseWeekendTimes(b);a||f.Analytics.api.trackEvent({category:"flexDates",label:"weekend",action:"changeDepart",value:b});this.markSelectedDays();this.publishFlexUpdate()},onWeekendReturnChange:function(a){var b=this.weekendReturnTime.getValue();this.weekendEndTime=this.parseWeekendTimes(b);a||f.Analytics.api.trackEvent({category:"flexDates",label:"weekend",action:"changeReturn",
value:b});this.markSelectedDays();this.publishFlexUpdate()},onOpenFlexDurationBlur:function(){var a=this.validateOpenFlexDuration();a?(this.openFlexDuration.removeClass("error"),this.openFlexDuration.val(a)):(this.openFlexDuration.addClass("error"),f.Analytics.api.trackEvent({category:"flexDates",label:"openflex",action:"error",value:encodeURIComponent(this.openFlexDuration.val())}));this.publishFlexUpdate()},getCssClass:function(){return[this.base(),"Common-Widgets-FlexDatePicker"].join(" ")},makeAboveCalendarHTML:function(){var a=
[this.base()];a.push(this.makeFlexDatesHTML());return a.join("")},makeFlexDatesHTML:function(){var a=this,b=[],c=this.options.categories;b.push('\x3cdiv id\x3d"%s" class\x3d"flexDateHeader %sSelected"\x3e'.format(this.id("flexHeader"),this.flexCategory));b.push('\x3cdiv class\x3d"flexDateIndicator"\x3e\x3c/div\x3e');b.push('\x3cdiv class\x3d"keel-grid flexDateOptions"\x3e');d.each(c,function(c,e){b.push('\x3cdiv class\x3d"col-option %s"\x3e\x3cdiv class\x3d"flexDateOption %sOption" data-flex-value\x3d"%s" title\x3d"%s"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format("weekend"===
e.value||"openflex"===e.value?"range-only":"",e.value,e.value,e.title,e.label));a.categories[e.value]=!0});b.push("\x3c/div\x3e");b.push('\x3cdiv id\x3d"%s" class\x3d"flexDateForms"\x3e'.format(this.id("flexDateForms")));d.each(c,function(c,e){c=a.makeFlexForm(e.value);null!=c&&b.push('\x3cdiv class\x3d"flexDateForm %sForm"\x3e%s\x3c/div\x3e'.format(e.value,c))});b.push("\x3c/div\x3e\x3c/div\x3e");return b.join("")},makeFlexForm:function(a){var b=[];return"plusminusthree"===a?(b.push('\x3cdiv class\x3d"keel-grid %sGrid vertical-centered-pseudo"\x3e'.format(a)),
b.push('\x3cdiv class\x3d"col-label right"\x3e\x3cdiv class\x3d"formLabel"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(this.options.msg.DEPART_LABEL)),b.push('\x3cdiv class\x3d"col-days"\x3e'),b.push(f.template.render("plusMinusThreeDepart",{id:this.id("plusMinusThreeDepart")})),b.push('\x3c/div\x3e\x3cdiv class\x3d"col-separator range-only"\x3e\x3cdiv class\x3d"separator"\x3e\x3c/div\x3e\x3c/div\x3e'),b.push('\x3cdiv class\x3d"col-label range-only right"\x3e\x3cdiv class\x3d"formLabel"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(this.options.msg.RETURN_LABEL)),
b.push('\x3cdiv class\x3d"col-days range-only"\x3e'),b.push(f.template.render("plusMinusThreeReturn",{id:this.id("plusMinusThreeReturn")})),b.push("\x3c/div\x3e\x3c/div\x3e"),b.join("")):"weekend"===a?(b.push('\x3cdiv class\x3d"keel-grid %sGrid vertical-centered-pseudo"\x3e'.format(a)),b.push('\x3cdiv class\x3d"col-3-12 col-2-12-m right"\x3e\x3cdiv class\x3d"formLabel"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(this.options.msg.DEPART_LABEL)),b.push('\x3cdiv class\x3d"col-3-12 col-2-12-m"\x3e'),b.push(f.template.render("weekendDepartTime",
{id:this.id("weekendDepartTime")})),b.push("\x3c/div\x3e"),b.push('\x3cdiv class\x3d"col-2-12 right"\x3e\x3cdiv class\x3d"formLabel"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(this.options.msg.RETURN_LABEL)),b.push('\x3cdiv class\x3d"col-3-12 col-2-12-m"\x3e'),b.push(f.template.render("weekendReturnTime",{id:this.id("weekendReturnTime")})),b.push("\x3c/div\x3e"),b.push('\x3cdiv class\x3d"col col-4-12-m center"\x3e\x3cdiv class\x3d"formInfo"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(this.options.msg.WEEKEND_INFO)),
b.push("\x3c/div\x3e"),b.join("")):"openflex"===a?(b.push('\x3cdiv class\x3d"keel-grid %sGrid vertical-centered-pseudo"\x3e'.format(a)),b.push('\x3cdiv class\x3d"col-1-3 col-2-12-m right"\x3e\x3cdiv class\x3d"formLabel"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(this.options.msg.DURATION_LABEL)),b.push('\x3cdiv class\x3d"col-1-3 col-3-12-m"\x3e'),b.push('\x3cinput type\x3d"text" id\x3d"%s" class\x3d"Common-Widgets-TextInput duration" placeholder\x3d"%s"/\x3e'.format(this.id("openFlexDuration"),this.options.msg.DURATION_PLACEHOLDER)),
b.push("\x3c/div\x3e"),b.push('\x3cdiv class\x3d"col-1-3 col-2-12-m"\x3e%s\x3c/div\x3e'.format(this.options.msg.DURATION_UNITS)),b.push('\x3cdiv class\x3d"col col-5-12-m center"\x3e\x3cdiv class\x3d"formInfo"\x3e%s\x3c/div\x3e\x3c/div\x3e'.format(this.options.msg.OPEN_FLEX_INFO)),b.push("\x3c/div\x3e"),b.join("")):null},makeDropdownOption:function(a){return'\x3coption value\x3d"%s" %s\x3e%s\x3c/option\x3e'.format(a.value,a.isSelected?'selected\x3d"selected"':"",a.text)},setDateMode:function(a){switch(a){case this.DateMode.RANGE:case this.DateMode.SINGLE:this.defaultDateMode=
a,this.flexHeader.removeClass([this.DateMode.RANGE,this.DateMode.SINGLE].join(" ")).addClass(a),"weekend"!=this.flexCategory&&"openflex"!=this.flexCategory||this.changeFlexCategory("exact")}f.Analytics.api.trackEvent({category:"flexDates",label:"dateMode",action:"change",value:a});this.base(a)},handleFlexDateChange:function(a){this.changeFlexCategory(d(a.target).attr("data-flex-value"))},changeFlexCategory:function(a){if(a!==this.flexCategory){this.flexHeader.removeClass("%sSelected".format(this.flexCategory));
this.flexCategory=a;this.flexHeader.addClass("%sSelected".format(this.flexCategory));this.categories.openflex&&this.openFlexDuration.removeClass("error");var b=this.flexHeader.find(".flexDateForm:visible");b.length?this.flexDateForms.addClass("hasForm"):this.flexDateForms.removeClass("hasForm");var c=d(window).width();b.length&&768<=c?this.flexDateForms.height(b.outerHeight()):768>c?this.flexDateForms.height("auto"):this.flexDateForms.height("0");switch(a){case "plusminusthree":case "exact":this.setDateMode(this.defaultDateMode);
break;case "weekend":this.setDateMode(this.DateMode.WEEKEND);break;case "openflex":this.setDateMode(this.DateMode.OPENFLEX)}f.Analytics.api.trackEvent({category:"flexDates",label:"category",action:"change",value:a});this.publishFlexUpdate()}},shouldDismiss:function(){if("openflex"===this.flexCategory)if(this.validateOpenFlexDuration())this.openFlexDuration.removeClass("error");else return this.openFlexDuration.addClass("error"),!1;return this.base()},getFlexDatesDisplayData:function(){var a=this.getFlexDatesData();
switch(this.flexCategory){case "plusminusthree":var b={};"exact"!==a.depart_date_flex&&(b.startDate=this.plusMinusThreeDepart.getText());this.DateMode!==this.DateMode.SINGLE&&"exact"!==a.return_date_flex&&(b.endDate=this.plusMinusThreeReturn.getText());d.extend(a,{inputDisplay:b});break;case "weekend":d.extend(a,{weekend_depart_time_display:this.weekendDepartTime.getText(),weekend_return_time_display:this.weekendReturnTime.getText(),inputDisplay:{startDate:this.options.msg.WEEKEND_INPUT_DISPLAY_WEEKS}});
break;case "openflex":d.extend(a,{inputDisplay:{startDate:this.options.msg.OPEN_FLEX_INPUT_DISPLAY_WEEKS}})}return a},getFlexDatesData:function(){var a={flex_category:this.flexCategory};switch(this.flexCategory){case "plusminusthree":d.extend(a,{depart_date_flex:this.plusMinusThreeDepart.getValue()});this.DateMode!==this.DateMode.SINGLE&&d.extend(a,{return_date_flex:this.plusMinusThreeReturn.getValue()});break;case "weekend":d.extend(a,{weekend_depart:this.weekendDepartTime.getValue(),weekend_return:this.weekendReturnTime.getValue()});
break;case "openflex":d.extend(a,{openflex_length_of_stay:this.validateOpenFlexDuration()})}return a},publishFlexUpdate:function(){this.publishUpdate({action:"flex",flex:this.flexCategory,fields:{startDate:!0,endDate:!0},data:this.getFlexDatesDisplayData()})},getFlexCategory:function(){return this.flexCategory},validateOpenFlexDuration:function(){var a=[];(this.openFlexDuration.val()||"").split(",").forEach(function(b,c){var g=b.split("-");b=d.trim(g[0]);c=Math.round(b);if(1===g.length)d.isNumeric(b)?
30<c?a=null:a.push(c.toString()):a=null;else if(2==g.length){var g=d.trim(g[1]),e=Math.round(g);d.isNumeric(b)&&d.isNumeric(g)?e<c||30<c||30<c?a=null:c===e?a.push(b):a.push("%s-%s".format(c.toString(),e.toString())):a=null}});return null===a?this.options.openFlexAllowBlankDuration?null:this.options.openFlexDefaultDuration:a.join(", ")},loadFlexData:function(a){a.flex_category&&this.changeFlexCategory(a.flex_category);a.weekend_depart&&this.weekendDepartTime.setValue(a.weekend_depart);a.weekend_return&&
this.weekendReturnTime.setValue(a.weekend_return);a.depart_date_flex&&this.plusMinusThreeDepart.setValue(a.depart_date_flex);a.return_date_flex&&this.plusMinusThreeReturn.setValue(a.return_date_flex);a.openflex_length_of_stay&&this.openFlexDuration.val(a.openflex_length_of_stay);if(this.categories.openflex)this.onOpenFlexDurationBlur()},getStartDayElements:function(){var a=this.base();if("plusminusthree"===this.flexCategory){var b=this.getFlexDateRange(this.plusMinusThreeDepart.getValue(),this.startDate);
d.extend(a,{flex:b})}return a},getEndDayElements:function(){var a=this.base();if("plusminusthree"===this.flexCategory){var b=this.getFlexDateRange(this.plusMinusThreeReturn.getValue(),this.endDate);d.extend(a,{flex:b})}return a},getFlexDateRange:function(a,b){var c=0,d=0,e=[];switch(a){case "plusminusthree":d=c=3;break;case "plusminustwo":d=c=2;break;case "plusminusone":d=c=1;break;case "plusone":d=1;break;case "minusone":c=1}if(this.validateDate(b)){a=moment(b);e.push("[data-val\x3d%s]".format(b));
for(b=1;b<=c;b++){var f=a.clone().subtract(b,"days").valueOf();this.validateDate(f)&&e.push("[data-val\x3d%s]".format(f))}for(c=1;c<=d;c++)b=a.clone().add(c,"days").valueOf(),this.validateDate(b)&&e.push("[data-val\x3d%s]".format(b))}return this.getSelectableDays(e.join(","))}})})(R9,jQuery);(function(d,b){d.createWidgetClass("NumberBox",b.extend({},d.Widgets.NumberBox.prototype,{init:function(a){this.inputNode=b(a).find("input")[0];this.jqNode=b(a);if(!this.isValidElement())return this;this.boxValue=""!==this.inputNode.value?parseInt(this.inputNode.value,10):0;this.incrButton=this.jqNode.find(".incrementor");this.decrButton=this.jqNode.find(".decrementor");0<this.options.defaultValue&&0===this.boxValue&&this.setValue(this.options.defaultValue,!0);b(this.inputNode).prop("readonly","readonly");
this.updateView()},isValidElement:function(){return!0},canChange:function(a){return"function"===typeof this.options.validator?this.options.validator.call(this,a,this.boxValue):!0},addEventHandlers:function(a){var c=this;this.incrButton.unbind("click").click(function(a){c.increment();jq(c.jqNode).trigger("increment");return!1});this.decrButton.unbind("click").click(function(a){c.decrement();jq(c.jqNode).trigger("decrement");return!1})},setValue:function(a,c){a=parseInt(a);if(isNaN(a)||this.boxValue===
a)return!1;var b=this.boxValue>a?this.boxValue-a:a-this.boxValue;this.canChange(b)&&(this.boxValue=a,this.updateView(),this.options.callback&&!c&&this.options.callback.call(this,b))},decrement:function(){if(this.boxValue>this.options.min&&this.canChange(-1))return--this.boxValue,this.updateView(),this.options.callback.call(this,-1,this.boxValue),!0;this.decrButton.addClass("NumberBox-disabled").attr("disabled","disabled");return!1},disableDecrement:function(){this.decrButton.addClass("NumberBox-disabled").prop("disabled",
!0)},enableDecrement:function(){this.decrButton.removeClass("NumberBox-disabled").prop("disabled",!1)}}))})(window.R9,window.jQuery);(function(c){R9.createWidgetClass("NumberInput",c.extend({},R9.Widgets.TextInput.prototype,{widgetPlaceholderClass:"vs-placeholder",inputElement:null,options:{needsPlaceholderSupport:!1,decimalLimit:null},init:function(){this.inputElement=this.getChildElement("input")||this.element;this.elementNode=this.inputElement.get(0)},addEventHandlers:function(){this.options.needsPlaceholderSupport&&(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("focus",this.handleElementFocusEvent),
this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));var b=this;"number"===typeof b.options.decimalLimit&&0<=b.options.decimalLimit&&this.inputElement.keyup(function(d){var a=c(d.currentTarget).val(),e=a.indexOf("."),f=a.length-e-1;-1!==e&&f>b.options.decimalLimit&&(a=parseFloat(a),"number"===typeof a&&a===a&&(c(d.currentTarget).val(a.toFixed(b.options.decimalLimit)),d.preventDefault()))})}}))})(jq||jQuery);(function(d){R9.createWidgetClass("RadioButtonSet",d.extend({},R9.Widgets.RadiobuttonSet.prototype,{init:function(a){R9.Widgets.RadiobuttonSet.refresh(this.element)},addEventHandlers:function(a){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.handleElementClickEvent)},setButtonCheckedById:function(a,c){this._setButtonChecked(function(b){return b.attr("id")===
a},c)},setButtonCheckedByValue:function(a,c){this._setButtonChecked(function(b){return b.val()===a},c)},setButtonEnabledById:function(a,c){this._setButtonEnabled(function(b){return b.attr("id")===a},c)},setButtonEnabledByValue:function(a,c){this._setButtonEnabled(function(b){return b.val()===a},c)},_setButtonChecked:function(a,c){this._getButtons().each(function(){var b=d(this);!0===a(b)&&b.prop("checked",!1!==c)});R9.Widgets.RadiobuttonSet.refresh(this.element)},_setButtonEnabled:function(a,c){this._getButtons().each(function(){var b=
d(this);!0===a(b)&&b.prop("disabled",!1===c)});R9.Widgets.RadiobuttonSet.refresh(this.element)},_getButtons:function(){return this.element.find("input."+this.widgetBaseClass)}}))})(jQuery);(function(f,c){f.createWidgetClass("Select",{inputElement:null,dropdownOptions:null,content:null,list:null,jQueryConstructorName:"r9Select",options:{autoOpen:!1,alignment:"left",direction:"down",showIcon:!0,matchWidth:!1,matchMinWidth:!0,iconClass:"",contentClass:"",triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:"",topOffset:"0",removeZIndex:!1,flippable:!0,change:c.noop},init:function(){this.elementNode=this.element[0];this.createContent();this.inputElement=
this.getChildElement("input");this.dropdownOptions=this.content.find("li");this.list=this.getChildElement("dropdownDialogList");if(this.content.find("li.selected").length){var a=this.content.find("li.selected");this.inputElement.text(a.attr("data-title"));this.inputElement.attr("data-value",a.attr("data-value"));this.inputElement.attr("data-title",a.attr("data-title"));this.element.hasValue=!0}},updateValue:function(a,b){this.isNodeDisabled(a)||(a.addClass("selected").siblings().removeClass("selected"),
this.inputElement.text(a.attr("data-title")),this.inputElement.attr("data-value",a.attr("data-value")),this.inputElement.attr("data-title",a.attr("data-title")),this.element.hasValue=!0,this.isOpen&&this.ensureVisible(a),b&&"function"===typeof this.options.change&&this.options.change.call(this,arguments))},ensureVisible:function(a){var b=a.position().top;a=a.outerHeight(!0);var c=this.content.scrollTop(),d=this.content.outerHeight();0>b?this.list.animate({scrollTop:c+b},"slow"):b+a>d&&this.list.animate({scrollTop:c+
b-d/2+a/2},"slow")},addEventHandlers:function(){function a(a){a=c(a.target).closest(".Common-Widgets-Select-Content");b.content[0]!=a[0]&&b.isOpen&&(b.close(),b.blur())}var b=this,e=c("body"),d;d=this.options.triggerClass?c("."+b.options.triggerClass):c(b.element);b.dropdownOptions.on("click",function(a){b.updateValue(c(this),!0);b.close();b.inputElement.focus()});e.on("click",a);this.subscribe("trips.menu.open",c.proxy(this.close,this));f.events.subscribe("authentication.showLogin",this.close.bind(this,
null,!0));d.click(function(g){b.element.closest(".Common-Widgets-Select-Content").length||(e.off("click",a),b.toggleContent(),setTimeout(function(){e.on("click",a)},10))});c(document).keydown(function(a){27===a.which&&b.close(a,null,!0)});this.element.focusout(function(){b.element.hasClass("closed")&&b.blur()});this.element.blur(function(){b.element.hasClass("closed")&&b.blur()});this.element.keydown(function(a){if(13===a.which||32===a.which)b.close(),a.preventDefault();if(40===a.which){b.isOpen||
b.open();var d=b.content.find(".selected").next();d.length&&b.updateValue(d);a.preventDefault()}38===a.which&&(b.isOpen||b.open(),d=b.content.find(".selected").prev(),d.length&&b.updateValue(d),a.preventDefault());9==a.which&&(b.close(),b.blur())});this.list.on("mousewheel DOMMouseScroll",function(a){var b=a.originalEvent;this.scrollTop+=30*(0>(b.wheelDelta||-b.detail)?1:-1);a.preventDefault()});c(window).on("resize",function(){b.isOpen&&b.reposition()});c(document).on("scroll",function(){b.isOpen&&
b.reposition()});c(".viewport").on("scroll",function(){b.isOpen&&b.reposition()});d=function(){b.element.is(":visible")&&(f.Common.Utils.Browsers.isIE(11)||setTimeout(function(){b.reposition()},25))};this.content.on("mouseup touchend",d);f.events.subscribe("horizon.dropdownDialog.reposition",d)},val:function(){return this.inputElement.attr("data-value")},getValue:function(){return this.val()},dataVal:function(){return this.inputElement.attr("data-value")},getDataValue:function(){return this.dataVal()},
getText:function(){return this.inputElement.text()},setText:function(a){this.inputElement.text(a)},setValue:function(a,b){a=this.content.find("li[data-value\x3d'"+a+"']");a.length&&this.updateValue(a,b)},isNodeSelected:function(a){return a.length&&a.hasClass("selected")},isNodeDisabled:function(a){return a.length&&a.hasClass("disabled")},getNodeDataValue:function(a){return a.length?a.attr("data-value"):""},disableValue:function(a){a=this.content.find("li[data-value\x3d'"+a+"']");a.length&&a.addClass("disabled")},
enableValue:function(a){a=this.content.find("li[data-value\x3d'"+a+"']");a.length&&a.removeClass("disabled")},blur:function(){this.element&&this.element.removeClass("closed");this.content.removeClass("closed")},createContent:function(){this.content=this.options.content?c(this.options.content):c("#"+this.element.attr("id")+"_content")},open:function(){this.isOpen=!0;var a=this,b="body";this.options.container&&""!==this.options.container&&(b=this.options.container,c(a.options.container).off("scroll."+
a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.reposition()}));this.content.appendTo(b);this.reposition();a.element.addClass("open");a.content.addClass("open");a.element.removeClass("closed");a.content.removeClass("closed");a.content.find("li.selected").length&&(b=a.content.find("li.selected"),a.ensureVisible(b));if(this.options.onOpen)this.options.onOpen(this);f.events.publish("Select.open",{id:a.id()})},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible").not("[tabindex\x3d-1],[disabled]")},
close:function(a,b,c){if(this.isOpen){var d=this.isOpen,e=this;this.isOpen=!1;this.element.removeClass("open");this.content.removeClass("open");this.element.addClass("closed");this.content.addClass("closed");e.element.after(e.content);c&&setTimeout(function(){e.element.focus()},1);if(this.options.onClose)this.options.onClose(d,this,a);f.events.publish("Select.close",{id:e.id(),silent:!!b})}},toggleContent:function(){this.isOpen?this.close(null,null,!0):this.open()},updateLabel:function(a){this.label.html(a);
"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},hasValue:function(){return this.element.hasClass("hasValue")},reposition:function(){var a=this.options.direction,b=this.element.offset(),e=c(this.options.container);if(e.length)var d=e.offset(),b={top:b.top-d.top+e.scrollTop(),left:b.left-d.left};else e=c(window);d=b.top+this.element.outerHeight();this.shouldFlipDirection(a)&&(a="down"===a?"up":"down");"up"===a?(this.content.addClass("up"),d=b.top-this.content.outerHeight()):
this.content.removeClass("up");a={top:d+"px"};"right"===this.options.alignment?a.right=e.width()-(b.left+this.getTriggerWidth())+"px":a.left="center"===this.options.alignment?b.left-this.content.outerWidth()/2+this.getTriggerWidth()/2+"px":b.left+"px";this.options.topOffset&&"0"!=this.options.topOffset&&(a.marginTop=this.options.topOffset+"px");this.leftOffset&&(a.marginLeft=this.leftOffset+"px");this.options.matchWidth?(a.minWidth=this.getTriggerWidth()+"px",a.maxWidth=a.minWidth):(a.minWidth=this.options.matchMinWidth?
this.getTriggerWidth()+"px":"",a.maxWidth="");this.options.removeZIndex||(a.zIndex=this.element.zIndex()+9999);this.content.css(a)},shouldFlipDirection:function(a){if(this.options.flippable){var b=c(window).scrollTop(),e=b+c(window).outerHeight(),d=this.content.outerHeight(),g=this.element.offset().top,e=g+this.element.outerHeight()+d>e,b=g-d<b;if("down"===a)return e&&!b;if("up"===a)return b&&!e}return!1},getTriggerWidth:function(){var a=this.elementNode.getBoundingClientRect();return a?a.right-a.left:
this.element.outerWidth()},setOptions:function(a,b){var e=this.dropdownOptions;c.each(a,function(a,b){a=c(e[a]);a.attr("data-value",b.value);a.attr("data-title",b.title);a.text(b.text);a.prop("disabled",b.disabled)})},setToFirstOption:function(){this.updateValue(c(this.dropdownOptions[0]),!1)},unselect:function(){this.dropdownOptions.removeClass("selected")}})})(window.R9,window.jq||window.jQuery);(function(b,c){b.createWidgetClass("ShowHideBox",{showMore:null,showLess:null,container:null,content:null,innerContent:null,options:{visibleHeight:0},init:function(){var a=this;a.container=a.element;a.showMore=this.getChildElement("showMore");a.showLess=this.getChildElement("showLess");a.content=this.getChildElement("content");a.innerContent=this.getChildElement("innerContent");0<this.options.visibleHeight||(a.options.visibleHeight=0,a.innerContent.find(a.options.selector).each(function(d,b){d<a.options.count&&
(a.options.visibleHeight+=c(b).height())}),a.content.css("height",a.options.visibleHeight+"px"));a.innerContent.height()<=a.options.visibleHeight&&(a.showMore.hide(),a.showLess.hide(),a.content.css("height","auto"))},addEventHandlers:function(){var a=this;c(a.showMore).click(function(b){a.container.addClass("shb-container-open")});c(a.showLess).click(function(b){a.container.removeClass("shb-container-open")})}})})(R9,jQuery);(function(b,f){b.createWidgetClass("Slider",f.extend({},b.Widgets.Slider.prototype,{init:function(){var c=this;this.handles=this.element.children(".handle");this.activeRange=this.element.find(".activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(a){c.mouseDown(a);a.preventDefault();a.stopPropagation(!0)});var a=this.options.values;if(!a||1>a.length)a=this.options.range?[this.options.min,this.options.max]:[this.options.min];if(b.config.getBoolean("ui.slider.safeSetValues",
!0)){var d=this.safeSetValues(a);if(d){var e=b.config.getBoolean("ui.slider.logRollbar",!0);e&&this.rollbarError("Slider setValues failed",d);b.config.getBoolean("ui.slider.deferFailedSetValues",!0)&&setTimeout(function(){var b=c.safeSetValues(a);b&&e&&c.rollbarError("Slider setValues timeout failed",b)},200)}}else this.setValues(a)},safeSetValues:function(b){try{return this.setValues(b),null}catch(a){return a}},rollbarError:function(b,a){window.Rollbar&&Rollbar.error(b,{error:a&&a.message?a.message:
"(unknown error)",winTop:window===window.top,winParent:window.top===window.parent})},mouseDown:function(){this.element.hasClass("Disabled")||b.Widgets.Slider.prototype.mouseDown.apply(this,arguments)},validateElement:function(){return this.element.hasClass("Common-Widgets-Slider")}}))})(R9,jQuery);(function(d){R9.publish("globals.browserCapabilities.scrollbarRetainsInputFocus",!0);R9.publish("common.widgets.base.Smarty",d.extend({},R9.Widgets.Smarty.Smarty.prototype,{dropdownId:"smartbox",loggingPrefix:"smarty",setItemTriggered:!1,init:function(){var a=this;this.dropdownId=this.options.dropdownId||this.dropdownId;this.initDropdown();this.options.scrollbarRetainsInputFocus=!R9.globals.browserCapabilities.scrollbarRetainsInputFocus;this.options.scrollbarRetainsInputFocus&&this.trackScrollbarClick();
this.element.attr({autocomplete:"off",autocapitalize:"off",autocorrect:"off"});this.element.is(":focus")?this.element.focus():this.element.attr("autofocus")&&this.element.focus();this.options.showBackgroundAutocomplete&&(this.options.getBackgroundAutocompletePositionProps=function(){return{"margin-bottom":"-"+a.element.outerHeight(!0)+"px"}});this.initBackgroundAutocomplete()},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses",
"greyIcons"):""},addEventHandlers:function(){var a=this;this.bindInputEvent("mousedown touchstart",this.handleInputFocusEvent);this.bindInputEvent("keyup",function(b,c){27!==(c.keyCode?c.keyCode:c.which)&&a.dropdown&&!a.dropdown.is(":visible")&&a.handleInputFocusEvent()});this.bindInputEvent("blur",this.handleInputBlurEvent);this.bindInputEvent("keydown",this.handleInputKeydownEvent);this.bindInputEvent("textchange",this.handleInputChangeEvent);d(window).resize(this.handleWindowResize.bind(a))},getDropdownId:function(){return this.dropdownId},
getDropdownEl:function(){return"undefined"!==this.id()?d("#"+this.id(this.getDropdownId())):d("#"+this.dropdownId)},initDropdown:function(){var a=this.getDropdownEl(),b=jq(a)[0];void 0===b&&(a=R9.Widgets.Smarty.Smarty.prototype.widgetBaseClass,this.options.dropdownClass&&(a=a+" "+this.options.dropdownClass),b={id:this.id(this.dropdownId),css:{display:"none",position:"absolute",width:"auto"}},b=jq("\x3cdiv\x3e\x3c/div\x3e",b).appendTo(this.options.appendTo)[0],jq(b).addClass(a));this.dropdown=jq(b);
this.dropdown.addClass("R9-Overlay");this.dropdown.addClass(this.extraIconClasses())},showDropdown:function(a,b){var c=this;this.dropdown[0].innerHTML=this.makeHTML(a);a=R9.Widgets.Smarty.Smarty.prototype.widgetBaseClass;this.options.dropdownClass&&(a=a+" "+this.options.dropdownClass);a=a+" "+this.extraIconClasses();this.dropdown.attr("class",a);a=this.dropdown[0].style;var e=this.dropdown.outerWidth(!0),k=!1;this.options.minWidth&&e<this.options.minWidth&&(e=Math.max(this.options.minWidth,e),k=!0);
this.options.maxWidth&&e>this.options.maxWidth&&(e=Math.min(this.options.maxWidth,e),k=!0);a.width=k?e+"px":"auto";var k=this.element.offset(),g=jq(this.options.appendTo).offset(),h=k.left-g.left;"right"===this.options.position&&(h+=this.element.width()-e-2);a.left=h+"px";a.top=k.top+this.element.outerHeight()-g.top+"px";a.display="inline";a.zIndex=this.element.zIndex()+9999;this.options.boundToScreen&&(this.dropdown.css("height","auto"),e=d(window).height(),k=d(window).scrollTop(),g=this.dropdown.outerHeight(),
a=parseInt(a.top),g+a+10-k>e&&(this.dropdown.height(e+k-a-10),this.dropdown.css("overflow-y","auto")));this.bindDropdownEvent("mousedown",this.handleItemMousedownEvent);this.bindDropdownEvent("mouseover",this.handleItemMouseoverEvent);this.bindDropdownEvent("mouseout",this.handleItemMouseoutEvent);0!==this.getHighlitedItemIndex()&&(this.removeItemHighlite(),b&&""!==this.element.val()&&this.highlightFirstNonHistoryItem());d(window).on("scroll.smarty",function(){c.position()})},stopInputProcessing:function(){if(!this.setItemTriggered&&
R9.config.getBoolean("ui.smarty.flights.r9LogOptions",!1)){var a={vertical:this._logPath,inputType:this.element.attr("name")||"destination",prefix:this.element.val()||"",options:this.dropdown&&this.dropdown.children?this.dropdown.children().children():[]};R9.SmartyLogger._save(a)}this.setItemTriggered=!1;this.base()},setItem:function(a,b){if(R9.config.getBoolean("ui.smarty.flights.r9LogOptions",!1)){var c={selectedElem:a,vertical:this._logPath,inputType:this.element.attr("name")||"destination",prefix:this.element.val()||
"",options:this.dropdown&&this.dropdown.children?this.dropdown.children().children():[]};R9.SmartyLogger._save(c);this.setItemTriggered=!0}this.base(a,b)},handleWindowResize:function(){if("block"===this.dropdown.css("display")){var a=this.element.offset().left-d(this.options.appendTo).offset().left,b=this.element.offset().top+this.element.outerHeight()-jq(this.options.appendTo).offset().top;"right"===this.options.position&&(a+=this.element.width()-width-2);this.dropdown.css("left",a+"px");this.dropdown.css("top",
b+"px")}this.updateBackgroundAutocompletePosition()},destroy:function(){this.base();this.hideDropdown();this.abortSearchCompletedEventListeners();this.unInit();this.unbindInputEvent("mousedown touchstart");this.unbindInputEvent("keyup");this.element.removeData("widget")}}));R9.createWidgetClass("FlareSmarty",d.extend({},R9.common.widgets.base.Smarty,R9.Widgets.Smarty.FlareSmarty.prototype,{options:d.extend({},R9.Widgets.Smarty.FlareSmarty.prototype.options,{dataSource:"/f/smarty",appendTo:"body"}),
init:R9.common.widgets.base.Smarty.init}));R9.createWidgetClass("FlightSmarty",R9.common.widgets.FlareSmarty,{isDirty:!1,constructor:function(a,b){var c={};R9.config.getBoolean("ui.flight.smarty-history",!1);d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-air smartbox-v2 R9-Overlay "+this.extraIconClasses(),flareSmartyType:1,forceSelection:!0,minWidth:250,searchOnFocus:!0,extendRequest:{v:"v2"}});this.base(a,d.extend(c,b))},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.flights.greyIcons",
!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""},makeRecentList:function(a,b){if(this.options.smartyControlGroup){var c=this.options.smartyControlGroup.getHistory(),e=this.options.smartyControlGroup.getMaxHistory(),d="origin"===this.elementNode.name,g="destination"===this.elementNode.name,h=this.options.smartyControlGroup.isRoundTrip();a=jq.trim(a);var e=""===a?e:3,f;g&&(f=jq(this.options.smartyControlGroup.options.originCode).val());c=c.filter(a,d,e,h,f);g="";for(h=0;h<c.length;h++)f=
c[h],e=!1,h===c.length-1&&(e=!0),g=d?g+this.generateSmartyItem(this.matchAndBold(a,f.departShortName),f.destShortName,f.startDate,f.endDate,f.idx,f.isRoundTrip,f.isPast,e):g+this.generateSmartyItem(f.departShortName,this.matchAndBold(a,f.destShortName),f.startDate,f.endDate,f.idx,f.isRoundTrip,f.isPast,e);return g=""!==g?(b?"\x3cul\x3e":"")+this.generateRecentHeader()+g+(b?"\x3c/ul\x3e":""):null}},generateSmartyItem:function(a,b,c,e,d,g,h,f){c=new moment(c);e=new moment(e);h=h?"past":"";f=f?" last":
"";var k=g?"doubleArrow":"singleArrow";g=g?" - "+e.format(this.options.smartyControlGroup.options.endFormat):"";return'\x3cli class\x3d"hist '+f+'" data-history-idx\x3d"'+d+'"\x3e\x3cspan class\x3d"smartyRecentAirports"\x3e'+a+'\x3cspan class\x3d"arrow '+k+'"\x3e\x3c/span\x3e'+b+'\x3c/span\x3e\x3cspan class\x3d"smartyRecentDate '+h+'"\x3e'+c.format(this.options.smartyControlGroup.options.startFormat)+g+"\x3c/span\x3e\x3c/li\x3e"},generateLoginBar:function(a){var b="";if(!this.options.smartyControlGroup)return"";
var c="admin";a&&(c+=" addSeparation");return b="notloggedin"===R9.globals.analytics.loginState?b+("\x3cli class\x3d'signupnow "+c+"'\x3e"+this.options.messages.loginForSearchHistory+"\x3c/li\x3e"):b+("\x3cli class\x3d'showHistory "+c+"'\x3e"+this.options.messages.seeAllSearchHistory+"\x3c/li\x3e")},generateAnywhereMarkup:function(a){var b="",c=this.element.val().trim().toLocaleLowerCase();!this.options.showAnywhere||this.isDirty&&""!==c&&0!==this.options.messages.anywhere.toLocaleLowerCase().indexOf(c)||
(b+="\x3cli data-short-name\x3d'anywhere' class\x3d'anywhere admin "+(a?"addSeparation":"")+"'\x3e"+this.options.messages.anywhere+"\x3c/li\x3e");return b},handleInputValue:function(){this.isDirty=!0;this.base()},setItem:function(a,b){if(R9.config.getBoolean("ui.smarty.flights.logCityVsAp",!1)){var c=a.hasOwnProperty("type")&&"city"===a.type?"city":"airport";R9.Analytics.api.trackEvent({category:this.loggingPrefix,action:"click",label:c,value:(a.short_str||a.str).replace(/\s+/g,"-")})}R9.common.widgets.base.Smarty.setItem.call(this,
a,b);this.base(a,b)},stopInputProcessing:R9.common.widgets.base.Smarty.stopInputProcessing});R9.createWidgetClass("AirportSmarty",R9.common.widgets.FlareSmarty,{constructor:function(a,b){var c={};d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-air smartbox-v2 R9-Overlay "+this.extraIconClasses(),extendRequest:{v:"v2"},flareSmartyType:13,forceSelection:!0,minWidth:250,searchOnFocus:!0});this.base(a,d.extend(c,b))},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.flights.greyIcons",
!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""}});R9.createWidgetClass("TrainSmarty",R9.common.widgets.FlareSmarty,{options:d.extend({},R9.common.widgets.FlareSmarty.prototype.options,{forceSelection:!0,minWidth:250,searchOnFocus:!0,extendRequest:{v:"v2"}})});R9.createWidgetClass("AirlineSmarty",R9.common.widgets.FlareSmarty,{constructor:function(a,b){var c={};d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-v2 smartbox-air R9-Overlay "+
this.extraIconClasses(),flareSmartyType:"airline",forceSelection:!0,minWidth:250,searchOnFocus:!0});this.base(a,d.extend(c,b))},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.flights.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""}});R9.createWidgetClass("CityGuideSmarty",R9.common.widgets.FlareSmarty,{constructor:function(a,b){var c={};d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox R9-Overlay ",dataSource:"/mv/marvel",
forceSelection:!0,searchOnFocus:!0,extendRequest:{v:"v1"}});this.base(a,d.extend(c,b))},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.hotels.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""}});R9.createWidgetClass("AirportHavingTipsSmarty",R9.common.widgets.FlareSmarty,{constructor:function(a,b){var c={};d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-air smartbox-v2 R9-Overlay "+this.extraIconClasses(),extendRequest:this.extendRequest,
dataSource:"/mv/marvel",flareSmartyType:53,forceSelection:!0,minWidth:250,searchOnFocus:!0});this.base(a,d.extend(c,b))},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.flights.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""},extendRequest:function(){return{v:"v2",excluded:this.filterData=R9.question.ask("marketing.TravelHackerWhenToBookCalculateForm.originCode")}}});R9.createWidgetClass("ActivitiesSmarty",R9.common.widgets.FlareSmarty,{options:d.extend({},
R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox R9-Overlay",forceSelection:!0,minWidth:377,maxWidth:377,searchOnFocus:!0,extendRequest:{v:"v1"}})});R9.createWidgetClass("CitySmarty",R9.common.widgets.FlareSmarty,{constructor:function(a,b){var c={};d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dataSource:"/mv/marvel",dropdownClass:" smartbox smartbox-v2 smartbox-city "+this.extraIconClasses(),flareSmartyType:31,forceSelection:!0,extendRequest:{v:"v2"},minWidth:250,
searchOnFocus:!0});this.base(a,d.extend(c,b))},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.hotels.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""}});R9.createWidgetClass("AirlineMultipleSmarty",d.extend({},R9.common.widgets.base.Smarty,R9.Widgets.Smarty.FlareSmarty.prototype,R9.common.widgets.base.Tags,{constructor:function(a,b){var c={};d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-v2 smartbox-air R9-Overlay "+
this.extraIconClasses(),flareSmartyType:"airline",forceSelection:!0,minWidth:250,searchOnFocus:!0});this.base(a,d.extend(c,b))},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.flights.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""},init:function(){R9.common.widgets.base.Smarty.init.call(this);R9.common.widgets.base.Tags.init.call(this)}}));R9.createWidgetClass("HotelSmarty",R9.common.widgets.FlareSmarty,{options:{showPopularDestinationsList:!1,showPopularDestinationsPictures:!1},
extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.hotels.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""},constructor:function(a,b){var c={},e=R9.config.getBoolean("ui.hotel.smarty-history",!1);b.hasOwnProperty("showPopularDestinationsList")&&(this.options.showPopularDestinationsList=b.showPopularDestinationsList);b.hasOwnProperty("showPopularDestinationsPictures")&&(this.options.showPopularDestinationsPictures=b.showPopularDestinationsPictures);var k=R9.config.getBoolean("ui.hotel.smarty.darkSmarty.enabled",
!1);e?(e=" smartbox smartbox-hotel smartbox-v2 R9-Overlay "+this.extraIconClasses(),k&&(e+=" smartbox-dark"),d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:e,forceSelection:!0,minWidth:377,searchOnFocus:!0,extendRequest:{v:"v2"}})):d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-v2 smartbox-hotel R9-Overlay "+this.extraIconClasses(),forceSelection:!0,minWidth:377,extendRequest:{v:"v2"}});this.base(a,d.extend(c,b))},postprocessResponse:function(a,
b){var c=this;R9.config.getBoolean("ui.hotel.smarty-addresses",!0)&&""===a&&R9.Maps.Google.load(function(){var e=c.getAddressSuggestions(c.lastValue),d=c.searchCompleted,g=c.base,h=c.matchAndBold,f=c.lastValue;e.done(function(a){if(0<a.length){for(var e="\x3cul\x3e",k=0;k<a.length;k++){var l=a[k],m=!1;if(l.types)for(var p=0;p<l.types.length;p++)if("street_address"===l.types[p]||"route"===l.types[p]){m=!0;break}m&&(e+='\x3cli\x3e\x3cdiv class\x3d"smarty-city"\x3e'+h.call(c,f,l.description)+"\x3c/div\x3e\x3c/li\x3e")}d.call(c,
g.call(c,e+"\x3c/ul\x3e",b),b)}});return a},c.widgetName);return this.base(a,b)},getAddressSuggestions:function(a){var b=d.Deferred();(new google.maps.places.AutocompleteService).getPlacePredictions({input:a},function(a,e){e===google.maps.places.PlacesServiceStatus.OK?b.resolve(a):b.reject(e)});return b.promise()},makeRecentList:function(a,b){if(this.options.smartyControlGroup){var c=this.options.smartyControlGroup.getHistory(),e=this.options.smartyControlGroup.getMaxHistory();a=jq.trim(a);for(var c=
c.filter(a,""===a?e:3),e="",d=0;d<c.length;d++){var g=c[d],h=!1;d===c.length-1&&(h=!0);e+=this.generateSmartyItem(this.matchAndBold(a,g.location),g.checkinDate,g.checkoutDate,g.idx,g.isPast,h)}return e=""!==e?(b?"\x3cul\x3e":"")+this.generateRecentHeader()+e+(b?"\x3c/ul\x3e":""):null}},generateSmartyItem:function(a,b,c,e,d,g){b=new moment(b);c=new moment(c);return'\x3cli class\x3d"hist '+(g?" last":"")+'" data-history-idx\x3d"'+e+'"\x3e\x3cspan class\x3d"smartyRecentHotels"\x3e'+a+'\x3c/span\x3e\x3cspan class\x3d"smartyRecentDate '+
(d?"past":"")+'"\x3e'+b.format(this.options.smartyControlGroup.options.startFormat)+" - "+c.format(this.options.smartyControlGroup.options.endFormat)+"\x3c/span\x3e\x3c/li\x3e"},generateLoginBar:function(a){if(!this.options.smartyControlGroup)return"";var b="admin";a&&(b+=" addSeparation");return"notloggedin"===R9.globals.analytics.loginState?"\x3cli class\x3d'signupnow "+b+"'\x3e"+this.options.messages.loginForSearchHistory+"\x3c/li\x3e":"\x3cli class\x3d'showHistory "+b+"'\x3e"+this.options.messages.seeAllSearchHistory+
"\x3c/li\x3e"},handleInputFocusEvent:function(a){this.options.showPopularDestinationsList||this.options.showPopularDestinationsPictures?this.startedSearching&&0!==this.element[0].value.length?this.base():(this.options.searchOnFocus=!1,this.base(),this.showPopularDestinations()):this.base()},showDropdown:function(a,b){this.base(a,b);if(this.options.showPopularDestinationsList||this.options.showPopularDestinationsPictures)0!==this.element[0].value.length&&this.startedSearchings?this.options.showPopularDestinationsPictures&&
this.dropdown.removeClass("smartbox-pictures"):(this.dropdown[0].style.minimumWidth="420px",!this.options.showPopularDestinationsPictures||this.startedSearching&&0!==this.element[0].value.length||this.dropdown.addClass("smartbox-pictures"))},onInputChange:function(){if(this.options.showPopularDestinationsList||this.options.showPopularDestinationsPictures)this.startedSearching=!0,this.options.searchOnFocus=!0,this.options.showPopularDestinationsPictures&&this.dropdown.removeClass("smartbox-pictures");
this.base()},hideDropdown:function(){var a=this.base();if(this.options.showPopularDestinationsList||this.options.showPopularDestinationsPictures){var b=document.activeElement===this.element[0];0===this.element[0].value.length&&b&&this.showPopularDestinations()}return a},getItemList:function(){return this.options.showPopularDestinationsList||this.options.showPopularDestinationsPictures?this.dropdown.find(this.options.dropdownListSelector+", .destinationItem"):this.base()},selectItem:function(a,b){var c=
-1<a.className.indexOf("destinationItem");(this.options.showPopularDestinationsList||this.options.showPopularDestinationsPictures)&&c?R9.question.ask("hotel.search.popularDestinationSelected",a):this.base(a,b)},stopInputProcessing:R9.common.widgets.base.Smarty.stopInputProcessing,setItem:R9.common.widgets.base.Smarty.setItem,showPopularDestinations:function(){if(!this.options.showPopularDestinationsList||!this.options.showPopularDestinationsPictures){var a;this.options.showPopularDestinationsList?
a=d(".Hotels-Search-PopularDestinationsList"):this.options.showPopularDestinationsPictures&&(a=d(".Hotels-Search-PopularDestinationsPictures"));if(a[0]){a=a.clone().removeAttr("hidden")[0].outerHTML;var b=this.makeRecentList(null,!1);null==b?b="":0>b.indexOf("\x3cul\x3e")&&(b="\x3cul\x3e"+b+"\x3c/ul\x3e");var c="\x3cul\x3e"+this.generateLoginBar(!1)+"\x3c/ul\x3e";this.showDropdown(b+a+c,!1);var e=this;R9.question.ask("hotel.search.popularDestinationsAppended",{smarty:e,after:function(){e.startedSearching=
!0;e.options.searchOnFocus=!0;e.hideDropdown()}})}}}});R9.createWidgetClass("CarSmarty",R9.common.widgets.FlareSmarty,{constructor:function(a,b){var c={};R9.config.getBoolean("ui.car.smarty-history",!1)?d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-car smartbox-v2 R9-Overlay",forceSelection:!0,flareSmartyType:2,searchOnFocus:!0,extendRequest:{v:"v2"},minWidth:377}):d.extend(c,R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-car smartbox-v2 R9-Overlay",
flareSmartyType:2,forceSelection:!0,extendRequest:{v:"v2"},minWidth:377});this.base(a,d.extend(c,b))},makeRecentList:function(a,b){if(this.options.smartyControlGroup){var c=this.options.smartyControlGroup.getHistory(),e="location"===this.elementNode.name,d=this.options.smartyControlGroup.isOneWay();a=jq.trim(a);for(var g=this.options.smartyControlGroup.getMaxHistory(),c=c.filter(a,e,""===a?g:3,d),g="",h=0;h<c.length;h++){var f=c[h],m=!1;h===c.length-1&&(m=!0);g=e?g+this.generateSmartyItem(this.matchAndBold(a,
f.location),f.location2,this.matchAndBold(a,f.airportCode),f.airportCode2,f.cityName,f.cityName2,f.startDate,f.endDate,f.idx,d,f.isPast,m):g+this.generateSmartyItem(f.location,this.matchAndBold(a,f.location2),f.airportCode,this.matchAndBold(a,f.airportCode2),f.cityName,f.cityName2,f.startDate,f.endDate,f.idx,d,f.isPast,m)}return g=""!==g?(b?"\x3cul\x3e":"")+this.generateRecentHeader()+g+(b?"\x3c/ul\x3e":""):null}},generateSmartyItem:function(a,b,c,e,d,g,h,f,m,q,n,l){b=new moment(h);f=new moment(f);
n=n?"past":"";l=l?" last":"";return q?'\x3cli class\x3d"hist '+l+'" data-history-idx\x3d"'+m+'"\x3e\x3cspan class\x3d"smartyRecentCars"\x3e'+(c||d)+'\x3cspan class\x3d"arrow singleArrow"\x3e\x3c/span\x3e'+(e||g)+'\x3c/span\x3e\x3cspan class\x3d"smartyRecentDate '+n+'"\x3e'+b.format(this.options.smartyControlGroup.options.startFormat)+" - "+f.format(this.options.smartyControlGroup.options.endFormat)+"\x3c/span\x3e\x3c/li\x3e":'\x3cli class\x3d"hist '+l+'" data-history-idx\x3d"'+m+'"\x3e\x3cspan class\x3d"smartyRecentCars"\x3e'+
(null!==c?'\x3cspan class\x3d"airportCode"\x3e'+c+"\x3c/span\x3e"+a:a)+'\x3c/span\x3e\x3cspan class\x3d"smartyRecentDate '+n+'"\x3e'+b.format(this.options.smartyControlGroup.options.startFormat)+" - "+f.format(this.options.smartyControlGroup.options.endFormat)+"\x3c/span\x3e\x3c/li\x3e"},generateLoginBar:function(a){if(!this.options.smartyControlGroup)return"";var b="admin";a&&(b+=" addSeparation");return"notloggedin"===R9.globals.analytics.loginState?"\x3cli class\x3d'signupnow "+b+"'\x3e"+this.options.messages.loginForSearchHistory+
"\x3c/li\x3e":"\x3cli class\x3d'showHistory "+b+"'\x3e"+this.options.messages.seeAllSearchHistory+"\x3c/li\x3e"},highlightFirstNonHistoryItem:function(){for(var a=R9.config.getBoolean("ui.car.smarty.highlight.first.airport",!1),b=-1,c=this.getItemList(),e=0;e<c.length;e++){var d=jq(c[e]);if(!d.hasClass("hist")){if(a){if(b===e){d.addClass("selected");this.setBackgroundAutocomplete(c[e]);return}if(1===(parseInt(d.data("airports-count"),10)||0)){b=e+1;continue}}d.addClass("selected");this.setBackgroundAutocomplete(c[e]);
return}}jq(c[0]).addClass("selected");this.setBackgroundAutocomplete(c[0])}});R9.createWidgetClass("PackageSmarty",d.extend({},R9.common.widgets.base.Smarty,R9.Widgets.Smarty.PackageToursSmarty.prototype,{constructor:function(a,b){var c={};d.extend(c,R9.Widgets.Smarty.PackageToursSmarty.prototype.options,{dropdownClass:" smartbox smartbox-packagetour R9-Overlay "+this.extraIconClasses(),flareSmartyType:17,forceSelection:!0,searchOnFocus:!0,minWidth:250});this.base(a,d.extend(c,b))},init:function(){d.fn.changeHiddenParam=
function(a){this.val(a);d("body").trigger("form.hiddenParamChanged",[this])};this.ptOptions=d.extend({},this.ptOptions,this.options.ptOptions);R9.common.widgets.base.Smarty.init.call(this);this.extendOptions();this.hasTags=!0;this.tags={};this.tagsIds=[];this.searchInput=d(this.element);this.hiddenInput=d(this.ptOptions.hiddenInput);this.isPlaceHolderSupported=this.checkIsPlaceHolderSupported();this.initTags();this.bindSearchInputEvents()},bindSearchInputEvents:function(){this.searchInput.on("click",
d.proxy(function(){if(this.searchInput.is(":disabled"))return!1;R9.events.publish("PackageSmarty.focus",{id:this.id()})},this));R9.Widgets.Smarty.PackageToursSmarty.prototype.bindSearchInputEvents.call(this)},extraIconClasses:function(){return R9.config.getBoolean("ui.smarty.hotels.greyIcons",!1)?R9.config.getString("ui.smarty.iconClasses","greyIcons"):""},setItem:function(a,b){a.isSuggestionParent||(R9.common.widgets.base.Smarty.setItem.call(this,a,b),R9.Widgets.Smarty.PackageToursSmarty.prototype.setItem.call(this,
a,b))},stopInputProcessing:function(){R9.common.widgets.base.Smarty.stopInputProcessing.call(this);R9.Widgets.Smarty.PackageToursSmarty.prototype.stopInputProcessing.call(this)}}));R9.createWidgetClass("BrandNameSmarty",R9.common.widgets.FlareSmarty,{options:d.extend({},R9.common.widgets.FlareSmarty.prototype.options,{dropdownClass:" smartbox smartbox-brandname smartbox-longnames",flareSmartyType:15,extendRequest:{v:"v2"},forceSelection:!1,searchOnFocus:!0,showDropdownWhenEmpty:!1,initialData:function(){return this.options.initialData}})});
R9.createWidgetClass("LandmarksSmarty",d.extend({},R9.common.widgets.base.Smarty,R9.Widgets.Smarty.LandmarksSmarty.prototype,{options:d.extend({},R9.Widgets.Smarty.LandmarksSmarty.prototype.options,{dataSource:"/f/smarty",appendTo:"body",flareSmartyType:25,dropdownClass:" smartbox smartbox-landmarks",minWidth:250,forceSelection:!0,searchOnFocus:!0,searchNoQuery:!0,showDropdownWhenEmpty:!0,f:"j",v:"v1"}),init:R9.common.widgets.base.Smarty.init}));R9.createWidgetClass("SmartSearchSmarty",d.extend({},
R9.common.widgets.base.Smarty,R9.Widgets.Smarty.Smarty.prototype,{options:d.extend({},R9.Widgets.Smarty.Smarty.prototype.options,{dropdownClass:"smartbox-smartsearch R9-Overlay",searchOnFocus:!0,forceSelection:!0,searchNoQuery:!0,dataSource:"/sherlock/smartsearch",dataType:"json",appendTo:"body",postprocessResponse:null}),responseData:null,init:function(){R9.common.widgets.base.Smarty.init.call(this);this.element.attr({autocomplete:"off",autocapitalize:"off",autocorrect:"off"})},preprocessRequest:function(a){"function"===
typeof this.options.preprocessRequest&&this.options.preprocessRequest(a);this.responseData=null;this.options.formId&&(a.formId=this.options.formId);this.options.vertical&&(a.vertical=this.options.vertical);a.localeLang=R9.globals.locale.lc||"en";a.localeCc=R9.globals.locale.lc_cc||"US";a.autoSuggestDates=!0;a.query=a.value;delete a.value;return a},postprocessResponse:function(a,b){"function"===typeof this.options.postprocessResponse&&this.options.postprocessResponse(a);return this.responseData=a},
makeHTML:function(a){for(var b=document.createElement("ul"),c=0;c<a.length;c++){var d=document.createElement("li");d.innerHTML=a[c].formattedText;d.id=c;b.appendChild(d)}return b.outerHTML},translateItem:function(a){return this.responseData[a.id]}}));R9.createWidgetClass("NearbySmarty",d.extend({},R9.common.widgets.base.Smarty,R9.Widgets.Smarty.NearbySmarty.prototype,{options:d.extend({},R9.Widgets.Smarty.NearbySmarty.prototype.options,{dataSource:"/f/smarty",appendTo:"body",flareSmartyType:28,dropdownClass:" smartbox smartbox-nearby",
minWidth:250,forceSelection:!0,searchOnFocus:!0,searchNoQuery:!0,showDropdownWhenEmpty:!0,f:"j",v:"v1"}),init:function(){this.options.placesService&&(this.placesService=this.options.placesService);R9.common.widgets.base.Smarty.init.call(this)},dropdownId:"smartbox",getDropdownId:R9.common.widgets.base.Smarty.getDropdownId,getDropdownEl:R9.common.widgets.base.Smarty.getDropdownEl,initDropdown:R9.common.widgets.base.Smarty.initDropdown,showDropdown:R9.common.widgets.base.Smarty.showDropdown,makePopularContent:function(a,
b,c){var d="";this.options.makeSelectedContent&&(d+=this.options.makeSelectedContent.call(this));return d+=R9.Widgets.Smarty.NearbySmarty.prototype.makePopularContent.call(this,a,b,c)},makeRegularContent:function(a,b,c){var d="";this.options.makeSelectedContent&&(d+=this.options.makeSelectedContent.call(this));return(a=R9.Widgets.Smarty.NearbySmarty.prototype.makeRegularContent.call(this,a,b,c))?d+a:d},translateItem:function(a){var b=R9.Widgets.Smarty.NearbySmarty.prototype.translateItem.call(this,
a);b.jqElem=d(a);return b}}))})(jq||jQuery);(function(e,f){e.publish("SmartyLogger",{loggingCategory:"Smarty",inputDefault:"destination",selectedIndex:"",_save:function(a){this.setStorage(a)},_log:function(a){a&&(this.logData(a,"origin"),this.logData(a,"destination"))},logData:function(a,c){var b=this;a=this.getLoggingObj(a,c);f.isEmptyObject(a)||e.Analytics.api.trackEvent(a,function(){b.cleanUpSmartyLogger(c)})},makeOptionsStr:function(a,c){var b=this,d,h,f,g=[],l=!1;a.each(function(k){d=e.common.widgets.FlareSmarty.prototype.translateItem.call(this,
a[k]);null==c||l||d.id!==c.id||d.type!==c.type||(b.selectedIndex=k+1,l=!0);h=d.id.split("/");1<h.length&&(d.idCode=h[1],d.apCode=h[0]);f="ap"===d.type?"airport":d.type;g.push("pos: "+(k+1));g.push("text: "+b.cleanString(d.short_str||d.str));g.push("locid: "+b.cleanString(d.idCode||d.id));g.push("loc_type: "+f)});return g.join("|")},getLoggingObj:function(a,c){var b=this.getStorage(c),d={};f.isEmptyObject(b)||(d={searchid:a,category:this.loggingCategory,params:{point:c}},b.hasOwnProperty("vertical")&&
(d.params.vertical=b.vertical),b.hasOwnProperty("prefix")&&(d.params.prefix=b.prefix),b.hasOwnProperty("selected")&&(d.params.selected=b.selected),b.hasOwnProperty("options")&&(d.params.options=b.options));return d},setStorage:function(a){if(a&&e.storage.isAvailable()){var c=(a.inputType||this.inputDefault)+"SmartyLogging",b=this.getStorageObj(a.inputType);a.hasOwnProperty("vertical")&&(b.vertical=a.vertical);a.hasOwnProperty("prefix")&&(b.prefix=this.cleanString(a.prefix));a.hasOwnProperty("options")&&
(b.options=this.makeOptionsStr(a.options,a.selectedElem||null),b.selected=this.selectedIndex,this.selectedIndex="");e.storage.set(c,b)}},getStorageObj:function(a){a=(a||this.inputDefault)+"SmartyLogging";var c={};e.storage.isAvailable()&&(c=e.storage.get(a),f.isEmptyObject(c)&&(e.storage.set(a,{}),c=e.storage.get(a)));return c},getStorage:function(a){var c={};e.storage.isAvailable()&&(c=e.storage.get(a+"SmartyLogging"));return c},cleanString:function(a){return a.replace(/&/g,"\\\x26")},cleanUpSmartyLogger:function(a){e.storage.remove(a+
"SmartyLogging");this.selectedIndex=""}})})(R9,jQuery);(function(c){R9.publish("common.widgets.base.Tags",{hiddenInput:null,searchInput:null,suggestionsXml:null,setItemFromSmarty:!1,triggerSmartBoxFocusTimeout:null,hasTags:!0,tagsContainer:null,tags:{},tagsIds:[],isSubmitEnabled:!1,skipActiveSubmit:!1,ptOptions:{hiddenInput:null,tags:{tagsContainerSelector:null,tagSelector:".tag",tagCloseSelector:".tagClose",tagTemplate:'\x3ca href\x3d"#" class\x3d"tag"\x3e\x3cspan class\x3d"tagLabel"\x3e[[TEXT]]\x3c/span\x3e\x3cspan class\x3d"tagClose"\x3e\x3c/span\x3e\x3c/a\x3e',
maxTags:1}},init:function(){this.ptOptions=c.extend({},this.ptOptions,this.options.ptOptions);this.extendOptions();this.searchInput=this.element;this.hiddenInput=this.ptOptions.hiddenInput;this.initTags();this.bindSearchInputEvents()},extendOptions:function(){var a=this;c.extend(!0,this.options,{setItem:function(b,d){a.setItemFromSmarty=!0;d&&d.id&&d.str&&a.addTag(d.id,d.str,!0)}})},initTags:function(){var a=this.ptOptions.tags;a&&a.tagsContainerSelector?(this.tagsContainer=c(a.tagsContainerSelector),
this.tagsContainer.length?(this.bindTagEvents(),this.bindTagsKeyboardEvents()):this.hasTags=!1):this.hasTags=!1},bindTagEvents:function(){var a=this,b=this.ptOptions.tags,d=b.tagSelector,e=b.selectedClass;this.tagsContainer.off("click",d).on("click",d,function(a){a.preventDefault();a.stopPropagation();a=c(this);a.hasClass(e)?a.removeClass(e):(a.addClass(e),a.siblings(d).removeClass(e))});this.tagsContainer.off("click",b.tagCloseSelector).on("click",b.tagCloseSelector,function(){var d=c(this).closest(b.tagSelector);
a.removeTag(d,!0);return!1})},bindSearchInputEvents:function(){this.searchInput.on("click",c.proxy(this.onSearchInputClick,this));this.searchInput.on("focus",c.proxy(this.onSearchInputFocus,this));this.searchInput.on("focusout",c.proxy(this.onSearchInputFocusOut,this));this.searchInput.on("blur",c.proxy(this.onSearchInputBlur,this))},bindTagsKeyboardEvents:function(){var a=this,b=this.ptOptions.tags,d=b.tagSelector,e=b.selectedClass,h=this.searchInput,f=this.tagsContainer;h.on("keydown",function(b){if(!h.val())if(13===
b.which)a.isSubmitEnabled&&(0<a.tagsIds.length&&a.disableSmartBox(),a.skipActiveSubmit=!1,h.closest("form").submit()),a.skipActiveSubmit=!0,a.isSubmitEnabled=!0;else if(0!==a.tagsIds.length)switch(b.which){case 8:b=c(d+"."+e,f);if(b.length)a.removeTag(b,!0);else{b=c(d,f).last();if(!b.length)break;b.addClass(e)}a.hideSmartBox();break;case 46:b=c(d+"."+e,f);if(!b.length)break;a.removeTag(b,!0);break;case 27:c(d,f).removeClass(e);break;case 37:b=c(d+"."+e,f);if(b.length){var g=b.prev(d);if(!g.length)if(1<
a.tagsIds.length)g=c(d,f).last();else break;b.removeClass(e);g.addClass(e)}else b=c(d,f).last(),b.length&&b.addClass(e);break;case 39:if(b=c(d+"."+e,f),b.length){g=b.next(d);if(!g.length)if(1<a.tagsIds.length)g=c(d,f).first();else break;b.removeClass(e);g.addClass(e)}}})},onSearchInputClick:function(a){if(this.searchInput.is(":disabled"))return!1;a.stopPropagation()},onSearchInputFocus:function(a){a.stopPropagation();this.smartBoxFocus();this.skipActiveSubmit=this.isSubmitEnabled=!1},onSearchInputFocusOut:function(a){a.stopPropagation();
this.setItemFromSmarty?this.setItemFromSmarty=!1:(this.smartBoxFocusOut(),"function"===typeof this.ptOptions.onFocusout&&this.ptOptions.onFocusout.call());return!1},onSearchInputBlur:function(a){this.skipActiveSubmit=!1},smartBoxFocus:function(){this.isSearchInputEmpty()&&this.searchInput.val("");this.searchInput.addClass("focus")},smartBoxFocusOut:function(){""===this.searchInput.val()&&this.searchInput.removeClass("focus")},searchInputFocusOut:function(){this.searchInput.focusout()},maxTagsReached:function(){var a=
this.getCurrentHiddenData();return a&&this.ptOptions.tags.maxTags<=a.length},removeLastTag:function(){this.removeTagById(this.tagsIds[this.tagsIds.length-1])},addTag:function(a,b,d){var e=this,h=this.ptOptions.tags;if(!a||!b)return!1;var f=c('[data-id\x3d"'+a+'"]',this.tagsContainer);if(0<f.length&&(!this.tags||this.tags==={}))return!1;if(this.tags[a])return f.fadeOut(100,function(){f.fadeIn(100);e.searchInput.val("")}),!1;this.maxTagsReached()&&this.removeLastTag();var k=c(h.tagTemplate.replace("[[TEXT]]",
b));k.attr("data-id",a);var g=c(h.tagSelector,this.tagsContainer).last();g.length?g.after(k):this.tagsContainer.prepend(k);this.tags[a]=b;this.tagsIds.push(a);this.tagsIds.length>=h.maxTags&&(e.disableSmartBox(),this.searchInput.addClass(h.hiddenClass));this.searchInput.val("");!0===d&&this.tagsIds.length<h.maxTags||this.searchInputFocusOut();this.removeItemHighlite();this.addHiddenData(a,b);return!0},removeTag:function(a,b,d){var c=this;a.length&&(d?this.removeTagInner(a):a.fadeOut(200,function(){c.removeTagInner(a)}))},
removeTagInner:function(a){var b=this.ptOptions.tags,d=a.attr("data-id"),e=this.tagsIds.indexOf(d);delete this.tags[d];this.tagsIds.splice(e,1);a.remove();this.enableSmartBox();this.tagsContainer.removeClass(b.disabledClass);this.searchInput.removeClass(b.hiddenClass);this.removeHiddenData(d);c.isEmptyObject(this.tags)&&this.clearSearchValues()},removeTagById:function(a){a=c(this.ptOptions.tags.tagSelector,this.tagsContainer).filter("[data-id\x3d"+a+"]");this.removeTag(a,!0,!0)},issetHiddenValue:function(a){for(var b=
this.getCurrentHiddenData(),d=b.length,c=0;c<d;c++)if(a===b[c].id)return c+1;return!1},getCurrentHiddenData:function(){var a=c.trim(this.hiddenInput.val());return a&&c.parseJSON(a)||[]},createHiddenValue:function(a,b){return{id:a,name:b}},addHiddenData:function(a,b){this.issetHiddenValue(a)||(a=this.createHiddenValue(a,b),this.hasTags?(b=this.getCurrentHiddenData(),b.push(a)):b=[a],this.hiddenInput.val(JSON.stringify(b)),this.hasTags&&(this.maxTagsReached()?this.disableSmartBox():this.enableSmartBox()),
this.onHiddenChange())},removeHiddenData:function(a){a=this.issetHiddenValue(a);var b=this.getCurrentHiddenData();a&&b.splice(a-1,1);this.hiddenInput.val(JSON.stringify(b));this.enableSmartBox();this.onHiddenChange()},onHiddenChange:function(){"function"===typeof this.ptOptions.onHiddenChange&&this.ptOptions.onHiddenChange.call()},clearSearchValues:function(){this.hasTags&&(c(this.ptOptions.tags.tagSelector,this.tagsContainer).remove(),this.tags=[],this.tagsIds=[]);this.searchInput.val("").removeClass("focus");
this.hiddenInput.val("[]")},disableSmartBox:function(){this.searchInput.attr("disabled","disabled");this.hideSmartBox()},hideSmartBox:function(){c("#"+this.ptOptions.targetId).hide()},enableSmartBox:function(){this.maxTagsReached()?this.disableSmartBox():(this.searchInput.removeAttr("disabled"),this.searchInput.css("display","inline"))},isSearchInputEmpty:function(){var a=c.trim(this.searchInput.val());return!a||""===a}})})(jq||jQuery);(function(b){R9.createWidgetClass("TextInput",b.extend({},R9.Widgets.TextInput.prototype,{widgetPlaceholderClass:"vs-placeholder",inputElement:null,options:{needsPlaceholderSupport:!1,selectOnFocus:!1},init:function(){this.inputElement=this.inputElement||this.element;this.elementNode=this.inputElement.get(0)},addEventHandlers:function(){var a=this;this.options.needsPlaceholderSupport&&(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("focus",this.handleElementFocusEvent),
this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));if(this.options.selectOnFocus)a.inputElement.on("focus",function(){a.inputElement.on("mouseup.a keyup.a",function(b){a.elementNode.setSelectionRange(0,9999);a.inputElement.off("mouseup.a keyup.a").select()})})}}))})(jq||jQuery);(function(c,b){c.createWidgetClass("Toast",{containerId:"toasts",container:null,options:{duration:4E3,position:"bottomRight"},init:function(){this.element.addClass("ToastItem");this.container=b("#%s".format(this.containerId));0===this.container.length&&(this.container=b("\x3cdiv\x3e",{"class":"Common-Widgets-Toast %s".format(this.options.position),id:this.containerId}),b("body").append(this.container));this.makeToast()},makeToast:function(){var a=this;-1===a.options.position.toLowerCase().indexOf("bottom")?
a.container.append(a.element):a.container.prepend(a.element);a.element.addClass("visible");setTimeout(function(){a.element.removeClass("visible");setTimeout(function(){a.element.remove()},400)},a.options.duration)}})})(R9,jQuery);(function(a,b){a.createWidgetClass("ToggleArrow",{element:null,init:function(a){this.element=a},addEventHandlers:function(){this.element.click(b.proxy(this.toggle,this))},toggle:function(){this.element.toggleClass("on")}})})(window.R9,window.jQuery);(function(c,e){c.createWidgetClass("ToolTip",e.extend({},c.Widgets.Tooltip.prototype,{options:e.extend({},c.Widgets.Tooltip.prototype.options,{showImmediately:!1,baseClass:"coolTip",extraClass:null,closeOnBodyClick:!0}),init:function(){this.base();c.Widgets.Tooltip.prototype.init.call(this);this.subscribe("common.widgets.tooltip.clearCloseTimers",this._clearCloseTimers.bind(this))},bindComponent:function(){this.element.data("toolTip",this)},setContent:function(a){this.element.html(a)},_updateWrapperElement:function(a,
b){this._addStyleClasses(b,"-wrapper",a.wrapperClass);b.attr("style","").css({top:a.newWrapperTop+"px",left:a.newWrapperLeft+"px"});return this},_open:function(a){var b=this;c.Widgets.Tooltip.prototype._open.call(this,a);c.events.publish("common.widgets.tooltip.clearCloseTimers");var d=function(c){c.target!==a&&(e(document).unbind("click",d),b.close())};if(this.options.closeOnBodyClick)e(document).on("click",d)},_clearCloseTimers:function(){clearTimeout(this._closeTimer)},_addStyleClasses:function(a,
b,d){b&&(a.addClass(this.widgetBaseClass+b),d&&a.addClass(this.widgetBaseClass+b+d),this.options.baseClass&&(a.addClass(this.options.baseClass+b),d&&a.addClass(this.options.baseClass+b+d)));this.options.extraClass&&a.addClass(this.options.extraClass);return this},_getOffsetInformation:function(a,b,d){var c=this.element.outerWidth(),f=this.element.outerHeight(),g=this.element.offset().top-e(this.options.appendTo).offset().top,h=this.element.offset().left-e(this.options.appendTo).offset().left;a="width"===
a?d.outerWidth():d.outerHeight();return{arrowSize:Math.round(a/2),elementWidth:c,elementHeight:f,wrapperWidth:b.outerWidth(),wrapperHeight:b.outerHeight(),offset:{top:Math.floor(g),left:Math.floor(h)}}}}))})(R9,jQuery);(function(a){a.extend("messages.common.trips",{UNEXPECTED_ERROR_AJAX_TITLE:"Unexpected Error",SAVE_TO_TRIPS_TOOLTIP_MESSAGE:"Save your favourites to compare, share and track prices over time.",SAVED_INFO_BUBBLE_DESC_AUTO_SAVE:"Shortlist and compare your favourite results, track prices and plan your itinerary with Trips.",SAVED_INFO_BUBBLE_TITLE_AUTO_SAVE_HOTELS:"We\u2019ve added your hotel to {0}",SAVED_INFO_BUBBLE_TITLE_AUTO_SAVE_FLIGHTS:"We\u2019ve added your flight to {0}",SAVED_INFO_BUBBLE_DESC_MANUAL_SAVE:"Compare and share saved items with others, track prices and plan the rest of your trip.",
SAVED_INFO_BUBBLE_TITLE_MANUAL_SAVE_HOTELS:"Hotel saved to {0}",SAVED_INFO_BUBBLE_TITLE_MANUAL_SAVE_FLIGHTS:"Flight saved to {0}",SAVED_RIGHT_RAIL_COMPARE_FOOTER:"Compare",SAVED_RIGHT_RAIL_VIEW_FOOTER:"View",SAVED_RIGHT_RAIL_MORE:"1#+1 more saved item|2#+{0} more saved items",SAVED_RIGHT_RAIL_HOTEL_PER_NIGHT:"per night",SAVED_RIGHT_RAIL_HOTEL_PER_NIGHT_INCL_TAXES:"incl. tax",SAVED_RIGHT_RAIL_HOTEL_TOTAL:"total",SAVED_RIGHT_RAIL_SOLD_OUT_HOTELS:"Sold Out",SAVED_RIGHT_RAIL_SOLD_OUT_FLIGHTS:"Sold Out",
SAVED_RIGHT_RAIL_SOLD_OUT_CARS:"Sold Out",SAVED_RIGHT_RAIL_EXPIRED:"Expired",SAVED_RIGHT_RAIL_CALL:"Call",SAVED_RIGHT_RAIL_INFO:"Info",SAVED_RIGHT_RAIL_ERROR_LOADING_ITEM:"Unexpected error while loading data. Please contact support if the problem persists.",SAVE_ICON_SAVE_TO_TRIP:"Saved to {0}",SAVE_ICON_SAVED:"Saved to {0}",SAVE_ICON_REMOVE:"Remove from {0}",SAVE_ICON_REMOVED_TITLE:"Removed",SAVE_ICON_SAVE_TITLE:"Save",SAVE_ICON_SAVING_TITLE:"Saving..."})})(R9);