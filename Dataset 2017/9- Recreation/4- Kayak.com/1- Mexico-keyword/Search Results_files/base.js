(function(a,c){a.createComponentClass("base.frontdoor.FrontDoor",{options:{vertical:null},init:function(a){},addEventHandlers:function(c){var d=this;a.events.subscribe("frontdoor.view.changed",function(b){d.element.toggleClass("InlineView","inline"===b.view);a.events.publish("frontdoor.setview",b.view)})}})})(R9,jq||jQuery);(function(c,d){c.createComponentClass("common.frontdoor.FrontDoorContent",{init:function(){this.element.find("img").unveil(500,function(){d(this).on("load",function(){this.style.opacity=1})}).trigger("unveil")},addEventHandlers:function(d){var a=this;c.events.subscribe("frontdoor.vertical.changed",function(b){b.vertical===a.vertical?a.show():a.hide()});c.events.subscribe(["frontdoor.view.changed","fdcontent.view.setview"],function(b){"inline"===b.view||"hidden"===b.view?a.hide():a.show()})},show:function(){this.element.removeClass("hidden")},
hide:function(){this.element.addClass("hidden")}})})(R9,jQuery);(function(b,d,e){var f={trains:"trains/results/TrainsSearchPoll",flights:"flights/results/FlightSearchPoll",hotels:"hotels/results/HotelSearchPoll",packages:"packages/results/PackageSearchPoll",rentals:"rentals/results/RentalSearchPoll",activities:"activities/results/ActivitiesSearchPoll",cityhotels:"hotels/cityhotels/CityHotelsPoll"},g={trains:"trains/results/TrainsResultDetails",flights:"flights/results/FlightResultDetails",hotels:"hotels/results/HotelResultDetails",packages:"packages/results/PackageResultDetails",
rentals:"rentals/results/HotelResultDetails",activities:"activities/results/ActivitiesResultDetails"};b.publish("common.results.search.AjaxSearchPoll",e.extend({searchUrl:null,detailsUrl:null,options:{vertical:null,searchId:null,appendTo:null},pollNumber:0,searchId:null,constructor:function(a){this.options=d.extend({},this.options,a);if(!a.vertical)throw"AjaxSearchPoll requires a vertical to be properly initialized";this.searchId=this.options.searchId;this.searchUrl=f[this.options.vertical];this.detailsUrl=
g[this.options.vertical];"cityhotels"===this.options.vertical&&this.options.citycode&&(this.searchUrl+="?citycode\x3d"+this.options.citycode)},fetchResults:function(a,c){a=d.extend({data:d.extend({searchId:this.searchId,poll:!0,pollNumber:this.pollNumber},a||{}),appendTo:this.options.appendTo,replace:!1,enforceCaptcha:b.config.getBoolean("ui.ajax.enforceCaptcha.searchPoll",!0)},c||{});b.config.getBoolean("ui.ssajax.last.action.abort",!1)&&(a.data.ajaxts=(new Date).getTime());this.searchId=a.data.searchId;
this.pollNumber++;return b.ajax.execute(this.searchUrl,a)},fetchDetails:function(a,c){c={data:{resultId:a,searchId:this.searchId},appendTo:c,enforceCaptcha:b.config.getBoolean("ui.ajax.enforceCaptcha.inlineDetails",!0)};if(null===c.searchId)throw"Cannot request result details for %s: No searchId tied to this instance of AjaxSaerchPoll.".format(a);return b.ajax.execute(this.detailsUrl,c)}}))})(R9,jQuery,base2.Base);(function(b,d){b.createComponentClass("base.results.HorizonResult",{detailsComponentUrl:null,open:!1,options:{resultId:null,searchId:null,detailsOpen:!1,showDetailsLinkVisible:!1,promoParams:null,pollPinning:!1,showPopularHotels:!1,clickoutsPopupSettings:{},isSEO:!1,alwaysOpen:!1},awaitingDetails:!1,hasDetails:!1,detailsContainer:d(),inlineContent:null,cheapest:null,init:function(){var a=this.options;this.cheapest=this.getChildElement("cheapest");this.detailsWrapper=this.getChildElement("detailsWrapper");
this.detailsContent=this.getChildElement("detailsContent");this.hasDetails=this.open=a.detailsOpen;a.isSEO&&!a.detailsOpen||this.detailsWrapper.height(this.detailsContent.outerHeight())},addEventHandlers:function(){var a=this;this.options.showDetailsLinkVisible&&this.getChildElement("toggleMore").click(function(){a.toggleOpen()});this.subscribe("result.details.open",this.options.resultId,function(){a.ensureOpened()});this.subscribe("result.details.close",this.options.resultId,function(){a.ensureClosed()});
this.subscribe("result.details.opened",this.options.resultId,function(){a.element.addClass("Opened LastOpened")});this.subscribe("result.details.opened",function(b){a.options.resultId!==b&&a.element.removeClass("LastOpened")});this.cheapest.click(function(c){b.events.publish("nps.show");b.Analytics.api.trackEvent("resultItem/cheapest/clickthrough");a.clickoutsPopup().openPopup(a.options.clickoutsPopupSettings,c.currentTarget.href,c)})},toggleOpen:function(a){"undefined"!==typeof a&&null!==a?a?this.ensureOpened():
this.ensureClosed():(this.open=this.options.alwaysOpen||!this.open,this.toggleHeight(),this[this.open?"detailsDidOpen":"detailsDidClose"]());b.Analytics.api.trackEvent({category:"inlinedetails",action:this.open?"show":"hide"})},ensureOpened:function(){this.open?this.toggleHeight():(this.open=!0,this.toggleHeight(),this.detailsDidOpen())},detailsDidOpen:function(){this.element.toggleClass("DetailOpen",!0);b.events.publish("result.details.opened",this.options.resultId)},ensureClosed:function(){this.open?
(this.open=!1,this.toggleHeight(),this.detailsDidClose()):this.toggleHeight()},detailsDidClose:function(){this.element.toggleClass("DetailOpen",!1);b.events.publish("result.details.closed",this.options.resultId)},toggleHeight:function(){this.detailsWrapper.height(this.open?this.detailsContent.height():0)},_clickoutsPopup:null,clickoutsPopup:function(){return this._clickoutsPopup?this._clickoutsPopup:b.common&&b.common.booking&&b.common.booking.ClickoutsPopup?this._clickoutsPopup=new b.common.booking.ClickoutsPopup:
{openPopup:function(){}}}})})(R9,jQuery);(function(g,c){g.createComponentClass("base.results.Rail",{options:{pinnable:!0,sticky:!1,debug:!1,debounceDelay:5,handleHorizontalScroll:!0,repositionTimeout:200},prevScroll:0,upScroll:!1,stickTop:!1,stickBottom:!1,originalNode:null,staticPosition:0,pinnedContentHeight:0,init:function(){this.element.css("width",this.element.parent().width())},addEventHandlers:function(){},inlineComponentsReady:function(){var a=this;a.originalNode=a.element.get(0);this.bindWindowEvents();this.options.pinnable&&this.subscribe("resultspage.streaming.done moreFilters.toggle filterTab.changed filter.overflow.toggle displayad.loaded textad.loaded pinnedContent.heightChanged".split(" "),
function(){a.onScroll()})},onScroll:function(){this.isRailAttached()?this.handleScroll():this.unbindWindowEvents()},handleScroll:function(){this.setPinnedContentHeight();var a=this.getWindowScroll(),b=this.getParentScroll();this.upScroll=this.prevScroll>a;this.prevScroll=a;(a=this.getPositionCSS(a,b,this.isElementTallerThanScreen()))&&this.element.css(a)},unbindWindowEvents:function(){c(window).off("scroll.pinrails-"+this.id());c(window).off("resize.pinrails-"+this.id())},bindWindowEvents:function(){var a;
this.options.pinnable&&(0<this.options.repositionTimeout&&this.element.css("transition","transform %sms ease-in-out".format(this.options.repositionTimeout)),a=0<this.options.debounceDelay?g.Common.Utils.debounce(this.onScroll.bind(this),this.options.debounceDelay):this.onScroll.bind(this),c(window).on("scroll.pinrails-"+this.id(),a),c(window).on("resize.pinrails-"+this.id(),a))},testBottom:function(a,b){return b?a<this.getParentHeight()-this.getWindowHeight():a+this.getElementHeight()<this.getParentHeight()},
testTop:function(a,b){return a>this.getParentTop()-this.pinnedContentHeight},isElementTallerThanScreen:function(){return this.getElementHeight()>this.getWindowHeight()},calculateScrollPosition:function(a,b){if(!b)return{position:"top"};this.upScroll&&a<=this.getElementTop()-this.getParentTop()?(this.stickTop=!0,this.stickBottom=!1):!this.upScroll&&a+this.getWindowHeight()>=this.getElementBottom()-this.getParentTop()?(this.stickTop=!1,this.stickBottom=!0):this.stickBottom=this.stickTop=!1;return this.stickBottom?
{position:"bottom"}:this.stickTop?{position:"top"}:{translate:this.staticPosition}},getPositionCSS:function(a,b,e){var f=0,d={position:"relative",top:"auto",bottom:"auto"};a=this.testTop(a,e);var g=this.testBottom(b,e);this.staticPosition=this.getElementTop()-this.getParentTop();a&&g?(b=this.calculateScrollPosition(b,e),b.translate&&(f=b.translate),b.position?"top"==b.position?(d={position:"fixed",top:0,bottom:"auto"},f=this.pinnedContentHeight):(d={position:"fixed",bottom:0,top:"auto"},f=0):d=c.extend({},
d)):(f=a?this.getParentHeight()-this.getElementHeight():0,d=c.extend({},d));b="translateY(%spx)".format(f);this.options.handleHorizontalScroll&&"fixed"===d.position&&(e=this.getLeftScroll(),0<e&&(b="translate(-%spx, %spx)".format(e,f)));return c.extend({},d,this.makeTransformCSS(b))},makeTransformCSS:function(a){return{msTransform:a,transform:a}},destroy:function(){this.unbindWindowEvents();this.base()},isRailAttached:function(){return this.element&&c.contains(window.document,this.originalNode)},
getElementHeight:function(){return Math.round(this.element.outerHeight())},getElementBottom:function(){return this.getElementTop()+this.getElementHeight()},getElementTop:function(){return Math.round(this.element.offset().top)},getWindowHeight:function(){return Math.round(c(window).outerHeight())},getWindowScroll:function(){return Math.round(c(window).scrollTop())},getParentHeight:function(){return Math.round(this.element.parent().outerHeight())},getParentTop:function(){return Math.round(this.element.parent().offset().top)},
getLeftScroll:function(){return Math.round(c(window).scrollLeft())},getParentBottom:function(){return this.getParentTop()+this.getParentHeight()},getParentScroll:function(){return this.getWindowScroll()-this.getParentTop()},setPinnedContentHeight:function(){var a=g.question.ask("pinnedContent.height");null!==a?this.pinnedContentHeight=a:0!==this.pinnedContentHeight&&(this.pinnedContentHeight=0)}})})(R9,jQuery);(function(d,e){d.createComponentClass("base.results.ResultsListHeader",{sortDropdownWidget:null,sortUnrolled:null,searchId:null,options:{sortUnrolled:!1,quickLinkSort:!1},init:function(){},addEventHandlers:function(){var a=this,c=this;this.options.sortUnrolled&&!this.options.quickLinkSort?(this.sortUnrolled=this.getChildElement("sortUnrolled"),this.sortUnrolled.find("a.sortOption").click(function(){c.onSortModeChange(e(this).attr("data-sort"),e(this))})):this.sortDropdownWidget=this.getChildElement("sorting").dropdown({change:function(b){if(b)a.onSortModeChange()}}).getWidget();
this.subscribe("resultsHeader.changed",function(b){null!==a.sortUnrolled&&b.sort&&(a.sortUnrolled.find("a").removeClass("selected"),a.sortUnrolled.find("[data-sort\x3d"+b.sort.sortType+"_"+(b.sort.ascending?"a":"b")+"]").addClass("selected"))});this.subscribe("resultsHeader.sortType.set",this.onSortModeChange.bind(this))},onSortModeChange:function(a,c){"undefined"===typeof a&&null!==this.sortDropdownWidget&&(a=this.sortDropdownWidget.getValue());var b=a.split("_")[0];a="a"===a.split("_")[1];void 0!==
c&&(this.options.sortUnrolled&&c.hasClass("selected")&&(a=!a),c.attr("data-sort","%s_%s".format(b,a?"a":"b")));d.events.publish("resultsHeader.changed",{sort:{sortType:b,ascending:a}})}})})(window.R9,window.jq||window.jQuery);(function(c,e){c.createComponentClass("base.results.ResultsPage",{searchRunner:null,searchId:null,priceType:null,searchStartParams:null,vertical:null,urlSearchStartSupported:!1,loggingPrefix:"resultspage",poll:{pollingId:null,sent:0,activeRequest:null,ended:!1,nextPollTimeoutId:null,firstPhaseCompleted:!1,consecutiveEmptyResponses:0,lastPollTotalCount:-1,started:null,cheapestPrice:-1,useUrlFilterState:!1,viewingResults:!1,reason:"POLL"},filterState:null,urlFilterState:null,filtersData:null,useViewStateFilterState:!0,
resultsList:e(),listBody:e(),progressBar:null,paginator:null,viewState:null,leftRail:null,rightRail:null,backToTop:null,clientTimeoutId:null,idleTimeoutId:null,secondPhaseTimeoutId:null,frenchWarning:null,ajaxAppendTo:null,preserveFilters:!1,preservedFilters:null,options:{infinite:!1,button:!1,startSearchImmediately:!1,searchParams:null,ajaxParams:null,poll:!0,pageNumber:1,searchId:null,completed:!1,sortMode:null,quickLinkType:null,ascending:!0,priceType:null,centerPointLat:null,centerPointLong:null,
urlFilterState:null,pollingTimeout:16E3,exponentialBackoffDelay:!1,pollDelay:250,maxPollDelay:5E3,pollingId:null,windowScroll:"",persistWindowScroll:!0,filtersData:null,quickLinkData:null,useTwoPhasePolling:!1,visible:!1,useBuzz:!1,showExpiredResultsMessage:!0,secondPhaseWait:null,secondPhaseTimeout:null,idleExpireMinutes:120,enforceIdleTimeout:!0,showFilteredButSimilar:!1,defaultSortType:null,secondPhaseCompleteBanner:!1,msg:{expired_search:"",filters_removed:""}},init:function(){this.appendResults=
this.options.infinite||this.options.button;this.filterState={};this.viewState={openDetails:[]};this.leftRail=this.getChildElement("leftRail");this.rightRail=this.getChildElement("rightRail");this.backToTop=this.getChildElement("backToTop");this.resultsList=this.getChildElement("list");this.listBody=this.element.find(".listBody");this.progressBar=this.getChildElement("progress");this.frenchWarning=this.getChildElement("frenchWarning");this.searchId=this.options.searchId;this.priceType=this.options.priceType;
this.poll.pollingId=this.options.pollingId;this.urlFilterState=this.options.urlFilterState;c.events.publish("paginator.hide")},addEventHandlers:function(a){var b=this,f=null,d=function(){null!==f&&clearTimeout(f);f=setTimeout(function(){c.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:b.searchId,key:"openDetails",value:b.viewState.openDetails.join(",")})},1E3)};this.subscribe("searchform.submit",this.startSearchFromSearchForm.bind(this));this.subscribe("filters.changed",
this.onFilterStateChange.bind(this));this.subscribe("resultspage.filters.sync",this.syncFilterState.bind(this));this.subscribe("paginator.change",this.onPaginatorChange.bind(this));this.subscribe("resultsHeader.changed",this.onResultsListHeaderChange.bind(this));this.subscribe("resultspage.view.setvisible",this.setVisible.bind(this));this.subscribe("search.poll.response",this.preprocessResponse.bind(this));this.subscribe("resultspage.results.refresh",this.refreshResults.bind(this));this.subscribe("resultspage.transition.remove",
this.removeTransitionClass.bind(this));this.subscribe("result.details.opened",function(a){b.viewState.openDetails.push(a);d()});this.subscribe("result.details.closed",function(a){b.viewState.openDetails=b.viewState.openDetails.filter(function(b){return b!==a});d()});this.subscribe("results.expired",this.reloadExpiredResults.bind(this));this.subscribe("filters.selectedprice",function(){"price"!==b.options.sortType&&c.events.publish("resultsHeader.sortType.set","price_a")});this.subscribe("resultspage.showLowest",
function(){c.events.publish("filters.reset",{type:"showAll"});c.events.publish("resultsHeader.sortType.set","price_a")});this.subscribe("ads.request",this.onSetupAdsRequest.bind(this));this.subscribe("results.quickLinkType.setDefault",function(a){a.hasOwnProperty("quickLinkType")&&(b.options.quickLinkType=a.quickLinkType)});this.answer("resultspage.filterState.is",function(a){return a&&b.filterState?b.filterState[a]:b.filterState});this.answer("resultspage.filterData.get",function(){return b.filtersData?
b.filtersData:b.options.filtersData});this.answer("resultspage.searchFailed",function(){return b.listBody.hasClass("failed")});this.answer("resultspage.urlFilterState.get",function(){return b.urlFilterState});this.appendResults&&(this.backToTop.click(function(){e(window).scrollTop(0).trigger("scroll")}),this.subscribe("resultspage.pageNumber.changed",function(){var a=e(window).scrollTop();e(window).unbind("scroll.backToTop").bind("scroll.backToTop",function(){var c=e(this).scrollTop();c>2*e(this).height()&&
a>c?b.backToTop.addClass("visible"):b.backToTop.removeClass("visible");a=c})}))},inlineComponentsReady:function(){this.adRequestInfo||c.events.publish("resultspage.adinfo.empty");if(this.options.searchId){this.setupStreaming(this.options.searchId,this.options.completed);if(this.options.windowScroll&&0<this.options.windowScroll.length&&this.options.persistWindowScroll){var a=this.options.windowScroll.split(";");e(window).scrollTop(a[0]);e(window).scrollLeft(a[1])}null!==this.options.quickLinkData&&
c.events.publish("resultspage.quickLinkData.changed",this.options.quickLinkData)}else this.options.startSearchImmediately&&this.startSearch(this.options.searchParams,this.options.ajaxParams)},onSetupAdsRequest:function(a){if(a&&a.adType&&a.pageLocation){this.adRequestInfo||(this.adRequestInfo={});this.adRequestInfo[a.adType]||(this.adRequestInfo[a.adType]=[]);for(var b=this.adRequestInfo[a.adType],c,d=0;d<b.length;d++)b[d]&&b[d].pageLocation===a.pageLocation&&(c=1,b[d]=a);c||b.push(a)}},setAdRequestSearchOptions:function(a){if(a&&
this.adRequestInfo){var b=this,f="",d="",e,g,k=function(a){if(!a||!a.length)return"";for(var f="",d,e=0;e<a.length;e++)(d=a[e])&&d.pageLocation&&(!isNaN(d.minRefreshRate)&&(0<d.minRefreshRate||0===d.minRefreshRate)&&(g=void 0===g?d.minRefreshRate:Math.min(g,d.minRefreshRate)),d.now||d.events&&d.events.pop&&"string"===typeof b.resultsReason&&0<=d.events.indexOf(b.resultsReason))&&(c.config.getBoolean("ui.ads.nowAfterResponse",!0)||(d.now=0),f+=d.pageLocation+",");return f};for(e in this.adRequestInfo)this.adRequestInfo.hasOwnProperty(e)&&
("displayAd"===e?f=k(this.adRequestInfo[e]):"textAd"===e&&(d=k(this.adRequestInfo[e])));b.adsResponseDate&&0<g&&Date.now()-b.adsResponseDate<g||(d&&(a.textAdPageLocations=d.substr(0,d.length-1)),f&&(a.displayAdPageLocations=f.substr(0,f.length-1)),a.existingAds=!!this.adsResponseDate)}},setVisible:function(a){a&&(this.options.visible=!0,this.element.addClass("ResultsVisible"))},setupStreaming:function(a,b){this.searchId=this.options.searchId;this.searchRunner=new c.common.results.search.AjaxSearchPoll({searchId:a,
vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList,replace:!this.appendResults});c.events.publish("resultspage.searchId.changed",{searchId:this.searchId});window.SearchID=this.searchId;c.events.publish("resultspage.cmp2.changed",{searchId:this.searchId});null!==this.options.filtersData&&(this.filtersData=this.options.filtersData,c.events.publish("resultspage.filtersData.changed",this.options.filtersData));b&&this.requiresAdsPoll()&&(b=!1);this.logSmartyInteractions();
b&&c.config.getBoolean("ui.horizon.resultspage.%s.handleCompleted".format(this.vertical||"base"),!1)?this.endPolling():(c.events.publish("resultspage.streaming.start"),this.listBody.addClass("streaming-in-progress"),this.resultsReason="init",this.poll.reason="POLL",this.getResults(),this.startedStreaming())},logSmartyInteractions:function(){c.config.getBoolean("ui.smarty.flights.r9LogOptions",!1)&&this.searchId&&c.SmartyLogger._log(this.searchId)},requiresAdsPoll:function(){if(!c.config.getBoolean("ui.horizon.resultspage.requireAdsPoll",
!0)||this.adsResponseDate||!this.adRequestInfo)return!1;for(var a in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(a)){var b=this.adRequestInfo[a];if(b&&b.pop)for(var f=0;f<b.length;f++)if(b[f].now)return!0}return!1},startSearchFromSearchForm:function(a){this.resultsReason="searchform.submit";(this.preserveFilters=a.preserveFilters)?(this.preservedFilters=e.extend({},this.filterState),this.preservedFilters.takeoff&&this.preservedFilters.takeoff.legs.forEach(function(b,f){var d,e;0===f&&
(d=moment(a.depart_date,c.globals.apiDateFormat));1===f&&(d=moment(a.return_date,c.globals.apiDateFormat));f=moment(parseInt(b.min,10));e=b.max-b.min;f.utc();d.utc();d.startOf("day");d.add(f.hours(),"hours");d.add(f.minutes(),"minutes");f=d.toDate().getTime();d.add(e,"milliseconds");d=d.toDate().getTime();b.max=""+d;b.min=""+f})):this.preservedFilters=null;this.startSearch(a)},startSearch:function(a){a.url&&c.authentication.needsRefresh?window.location="/"===a.url[0]?a.url:"/"+a.url:(c.events.publish("search.startSearch",
a),c.events.publish("resultspage.streaming.start",a),this.getChildElement("list").show(),this.searchRunner=new c.common.results.search.AjaxSearchPoll({vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList}),this.searchId&&this.cleanupExistingSearch(),this.poll.sent=0,this.poll.ended=!this.options.poll,this.poll.pollingId=""+Math.floor(65536*Math.random())+1,this.poll.lastPollTotalCount=-1,this.poll.consecutiveEmptyResponses=0,this.options.pageNumber=1,a=e.extend(this.options.searchParams,
a),this.setAdRequestSearchOptions(a),this.searchStartParams=a,this.getResults(0,a),a=!1,this.options.useBuzz&&0<this.resultsList.find(".Hotels-Results-HotelBuzzResultItem").length&&(a=!0),a||this.listBody.addClass("loading"))},cleanupExistingSearch:function(){this.poll.activeRequest&&this.poll.activeRequest.abort();c.events.publish("resultspage.cleanup",this.searchId);this.stopIdleTimeout();this.destroyOldResults();this.resultsList.find("#searchResultsList").html("");this.listBody.removeClass("failed");
this.searchId=null;this.poll.pollingId=null;this.preserveFilters||(this.filterState={});c.events.publish("paginator.hide");this.poll.firstPhaseCompleted=!1;this.poll.lastPollTotalCount=-1;this.poll.consecutiveEmptyResponses=0;this.options.filtersData=null;this.options.completed=!1;this.searchStartParams=null;this.options.defaultSortType&&(this.options.sortMode=null,c.events.publish("resultsHeader.sortMode.set",this.options.defaultSortType))},destroyOldResults:function(a){c.ComponentManager.remove(this.resultsList.children().eq(0),
!1)},destroyBuzzResults:function(){},beforeAppendNewResults:function(){},beforeUpdateDOM:function(a,b){a=e(a.content);if(b)return this.beforeAppendNewResults();0===a.length&&c.config.getBoolean("ui.horizon.rp.skipEmptyPoll",!0)||this.destroyOldResults(a)},getResults:function(a,b,f){var d=this,h=e.extend(this.getFetchResultsOpts(),b);a=void 0!==a?a:this.options.pollDelay;var g={beforeScript:function(){d.beforeUpdateDOM(this.response,h.append)},replace:!h.append};b=b||{};null!==this.preservedFilters&&
(h.filterState=JSON.stringify(this.preservedFilters));this.doCustomUpdate()&&(g=e.extend(g,{customUpdate:d.updateDOM.bind(this)}));f&&(h.isSecondPhase=!1);this.poll.activeRequest&&this.poll.activeRequest.abort();b.resetFilters&&(h=e.extend({},h,{useViewStateFilterState:!1}));clearTimeout(this.poll.nextPollTimeoutId);this.poll.nextPollTimeoutId=setTimeout(function(){d.poll.sent++;var a=d.searchRunner.fetchResults(h,g);a.then(d.checkSearchExpired.bind(d)).fail(d.handleError.bind(d));d.poll.activeRequest=
a;c.events.publish("resultspage.requestResults")},a)},checkSearchExpired:function(a,b){b&&202===b.status&&(this.endPolling(),c.events.publish("search.expired"))},doCustomUpdate:function(){return this.options.pollPinning||this.options.showPopularHotels},endPolling:function(a,b){this.poll.ended&&c.config.getBoolean("ui.horizon.rp.dedupeEndPolling",!0)||(this.poll.ended=!0,this.options.secondPhaseCompleteBanner&&(e(window).off("scroll.viewResults"),this.poll.viewingResults=!1,this.poll.cheapestPrice=
-1),this.log.console("Ended polling"),this.removeTransitionClass(),this.listBody.removeClass("loading").removeClass("blur").removeClass("streaming-in-progress"),this.stopClientTimeout(),this.stopSecondPhaseTimeout(),c.events.publish("resultspage.streaming.done",{searchId:this.searchId,error:b}),a&&c.Analytics.api.trackEvent({category:"ResultsPage",action:"search_finished",label:a}))},clearPreservedFilters:function(){this.preservedFilters=null;this.preserveFilters=!1},handleError:function(a){if(!a||
"object"!==typeof a||0!==a.status){if("object"===typeof a){this.log.console(a.message);if(a.searchExpired){this.reloadExpiredResults();return}c.Analytics.api.trackEvent(this.loggingPrefix+"/error/"+a.type)}this.endPolling("error",a);this.getChildElement("list").hide();c.events.publish("paginator.hide");this.listBody.addClass("failed").removeClass("loading");c.events.publish("search.searchFailed",a);a&&"noresults"===a.type&&a.response&&a.response.filtersData&&(a=Object.keys(a.response.filtersData),
0<a.length&&(a.forEach(function(a){c.events.publish("filter.show",{name:a})}),c.events.publish("resultspage.filterList.show")))}},getFetchResultsOpts:function(){var a={applyFilters:!0,filterState:null,useViewStateFilterState:this.useViewStateFilterState,pageNumber:this.options.pageNumber};a.append=1<this.options.pageNumber&&this.appendResults;null!==this.poll.pollingId&&(a.pollingId=this.poll.pollingId);null!==this.options.sortMode&&(a.sortMode=this.options.sortMode);null!==this.options.ascending&&
(a.ascending=this.options.ascending);null!==this.priceType&&(a.priceType=this.priceType);this.filterState&&0<Object.keys(this.filterState).length?a.filterState=JSON.stringify(this.filterState):this.useViewStateFilterState&&this.urlFilterState&&(a.filterState=this.urlFilterState);if(this.poll.ended&&(!this.appendResults||1===this.options.pageNumber)){var b=e(window).scrollTop().toFixed(),c=e(window).scrollLeft().toFixed();a.windowScroll=""+(0<b?b:0)+";"+(0<c?c:0)}!this.poll.ended&&-1<this.poll.lastPollTotalCount&&
(a.lastPollTotalCount=this.poll.lastPollTotalCount);!this.poll.ended&&this.poll.firstPhaseCompleted&&0<e(window).scrollTop().toFixed()&&(a.cheapestPrice=this.poll.cheapestPrice);a.requestReason="string"===typeof this.poll.reason?this.poll.reason:"POLL";a.secondPhaseCompleteBanner=this.options.secondPhaseCompleteBanner;a.isSecondPhase=this.poll.firstPhaseCompleted;this.setAdRequestSearchOptions(a);a.openDetails=this.viewState.openDetails;return a},setupNewlyCreatedSearch:function(a){this.searchRunner.searchId=
this.searchId=a.searchId;this.log.console("setting up searchId",this.searchId);c.events.publish("resultspage.searchId.changed",{searchId:this.searchId});window.SearchID=this.searchId;c.events.publish("resultspage.cmp2.changed",{searchId:this.searchId});"pageTitle"in a&&(document.title=a.pageTitle);"viewState"in a&&"priceType"in a.viewState&&(this.priceType=a.viewState.priceType,c.events.publish("resultspage.priceType.changed",{priceType:this.priceType}));this.logSmartyInteractions();this.options.pollingTimeout=
a.uiTimeout;this.startedStreaming()},preprocessResponse:function(a){if(this.searchId||"searchId"in a){this.options.useBuzz&&(0<a.totalCount||a.completed)&&this.destroyBuzzResults();if(a&&(!this.poll.firstPhaseCompleted||!a.secondPhaseWait||a.completed||a.error)){this.log.console("received response",a);!this.searchId&&"searchId"in a&&"string"===typeof a.searchId&&this.setupNewlyCreatedSearch(a);this.options.completed=a.completed;if(a.error){var b={type:"server",message:a.errorMessage,searchExpired:a.searchExpired};
a.searchStartError&&(b={type:"query",userDisplayMessage:a.queryErrors.reduce(function(a,b){return a+"\x3c/br\x3e"+b})});this.handleError(b);return}"filtersData"in a&&(this.filtersData=a.filtersData,c.events.publish("resultspage.filtersData.changed",a.filtersData));"urlFilterState"in a&&(this.urlFilterState=a.urlFilterState,this.options.useUrlFilterState&&this.updateUrlFilterState(a.urlFilterState));"quickLinkData"in a&&c.events.publish("resultspage.quickLinkData.changed",a.quickLinkData);"taxesEstimated"in
a&&c.events.publish("resultspage.taxesEstimated.changed",{taxesEstimated:a.taxesEstimated});"swindle"in a&&c.common.results.SwindlePublisher.publish(a.swindle);if(a.ads){this.resultsReason=null;if(c.config.getBoolean("ui.ads.nowAfterResponse",!0)&&this.adRequestInfo)for(b in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(b)){var e=this.adRequestInfo[b];if(e)for(var d=0;d<e.length;d++)e[d].now=0}this.adsResponseDate=Date.now();c.events.publish("resultspage.ads.update",a.ads)}a.completed&&
(0===a.totalCount&&0===a.filteredCount?this.handleError({type:"noresults",message:"Finished search but failed to find results",response:a}):this.endPolling("completed"));if(0<a.filteredCount||a.allResultsWereFiltered||a.error)this.removeTransitionClass(),a.allResultsWereFiltered&&!this.options.showFilteredButSimilar&&this.listBody.addClass("failed");this.setFirstPhaseCompleted(a);(a.completed||0<a.filteredCount&&0<a.totalCount)&&c.events.publish("resultspage.results.count.changed",{filtered:a.filteredCount,
total:a.totalCount});c.events.publish("paginator.update",{pageNumber:a.pageNumber,pageCount:a.pageCount});c.events.publish("resultspage.refreshed",{streaming:!a.completed});this.didReceiveResults(a)}this.options.secondPhaseCompleteBanner&&(a.hasOwnProperty("cheapestPrice")&&(this.poll.cheapestPrice=a.cheapestPrice),a.hasOwnProperty("cheapestPriceMessage")&&this.showSecondPhaseCompleteBanner(a.cheapestPriceMessage));this.options.poll&&!this.poll.ended&&("totalCount"in a&&0<a.totalCount&&a.totalCount!==
this.poll.lastPollTotalCount?(this.poll.consecutiveEmptyResponses=0,this.poll.lastPollTotalCount=a.totalCount):this.poll.consecutiveEmptyResponses++,b=this.options.pollDelay,!a.cached&&this.options.exponentialBackoffDelay&&(b=this.options.pollDelay*(1+Math.pow(2,this.poll.consecutiveEmptyResponses)/100)),b=Math.floor(b,this.options.maxPollDelay),this.poll.firstPhaseCompleted&&0<=this.options.secondPhaseWait&&(b=this.options.secondPhaseWait),this.poll.reason="POLL",this.getResults(b));a.hasOwnProperty("cubanQuery")&&
a.cubanQuery?this.getChildElement("cubaWarning").addClass("visible"):this.getChildElement("cubaWarning").removeClass("visible");this.getChildElement("list").show()}},setFirstPhaseCompleted:function(a){this.poll.firstPhaseCompleted!==a.firstPhaseCompleted&&(this.poll.firstPhaseCompleted=a.firstPhaseCompleted,this.poll.firstPhaseCompleted&&(c.events.publish("resultspage.streaming.firstPhase.done"),this.startSecondPhaseTimeout()))},syncFilterState:function(a){null===a.state?delete this.filterState[a.name]:
this.filterState[a.name]=a.state},syncPreservedFilters:function(a){null===a.state?delete this.preservedFilters[a.name]:this.preservedFilters[a.name]=a.state},setPageNumber:function(a){this.options.pageNumber!==a&&(this.options.pageNumber=a,c.events.publish("resultspage.pageNumber.changed",a),c.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:self.searchId,key:"pageNumber",value:a.toString()}))},onFilterStateChange:function(a){this.useViewStateFilterState=
!1;this.getChildElement("list").show();this.syncFilterState(a);this.preserveFilters&&this.syncPreservedFilters(a);this.setPageNumber(1);this.resultsReason="filters.changed";this.poll.reason="FILTER";this.refreshResults()},onPaginatorChange:function(a){a.append||e(window).scrollTop(0).trigger("scroll");c.Analytics.api.trackEvent("page/"+a.pageNumber);this.setPageNumber(a.pageNumber);this.resultsReason="paginator.change";this.poll.reason="PAGINATE";this.refreshResults({append:a.append})},onResultsListHeaderChange:function(a){a.rpIgnore||
(void 0!==a.sort?(this.options.sortMode=a.sort.sortType,this.options.ascending=a.sort.ascending,c.Analytics.api.trackEvent(this.loggingPrefix+"/sort/"+(a.sort.ascending?"":"-")+a.sort.sortType)):void 0!==a.priceType&&(this.priceType=this.options.priceType=a.priceType,c.Analytics.api.trackEvent(this.loggingPrefix+"/priceType/"+a.priceType)),void 0!==a.reviewType&&(this.options.reviewType=a.reviewType,c.Analytics.api.trackEvent(this.loggingPrefix+"/reviewType/"+a.reviewType)),void 0!==a.quickLinkType&&
(this.options.quickLinkType=a.quickLinkType,c.Analytics.api.trackEvent(this.loggingPrefix+"/quickLinkType/"+a.quickLinkType)),this.updateFrenchWarning(),this.setPageNumber(1),this.resultsReason="resultsHeader.changed",this.poll.reason="SORT",this.refreshResults())},updateFrenchWarning:function(){this.frenchWarning&&this.frenchWarning.toggleClass("hidden",this.options.defaultSortType&&-1===this.options.defaultSortType.indexOf(this.options.sortMode))},addTransitionClass:function(){var a=[];this.options.blurTransition&&
a.push("blur");this.options.spinnerTransition&&a.push("loading");this.listBody.addClass(a.join(" "))},removeTransitionClass:function(){this.listBody.removeClass("loading blur");this.getChildElement("loadingMessage").hide()},refreshResults:function(a){this.searchRunner&&(!this.searchId&&c.config.getBoolean("horizon.resultspage.dontRefreshBeforeSearchStart",!0)&&this.searchStartParams&&(a=e.extend({},a,this.searchStartParams)),"undefined"!==typeof a&&"undefined"!==typeof a.append&&a.append||(this.addTransitionClass(),
this.listBody.removeClass("failed")),this.getResults(0,a,!0))},reloadExpiredResults:function(){this.addTransitionClass();this.log.console("reloading expired results");this.options.showExpiredResultsMessage&&this.getChildElement("loadingMessage").text(this.options.msg.expired_search).show();c.Analytics.api.trackEvent(this.loggingPrefix+"/searchexpired");c.config.getBoolean("ui.horizon.rp.results.expired.preserveFilters",!1)&&this.urlFilterState?window.location.href=this.mergeFilterStateWithUrl(this.urlFilterState):
window.location.reload(!0)},stopSearch:function(a){e.get("/s/sparkle?action\x3dkillseeker\x26searchid\x3d%s\x26formtoken\x3d%s".format(a||this.searchId,c.globals.formtoken))},clientTimeout:function(){this.log.console("client timed out");c.config.getBoolean("ui.horizon.rp.streaming.timeout.reload",!0)&&(this.stopSearch(),this.handleError({type:"timeout",message:"Reached polling timeout without completing"}),window.location=document.location.pathname+(1<document.location.search.length?"\x26":"?")+"force\x3dtrue")},
startSecondPhaseTimeout:function(){var a=this;c.config.getBoolean("ui.horizon.killSecondPhase",!0)&&(this.stopSecondPhaseTimeout(),this.secondPhaseTimeoutId=window.setTimeout(function(){a.poll.ended||(a.stopSearch(),window.setTimeout(function(){a.endPolling("2ftimeout")},5E3))},this.options.secondPhaseTimeout-5E3))},stopSecondPhaseTimeout:function(){window.clearTimeout(this.secondPhaseTimeoutId);this.secondPhaseTimeoutId=null},startIdleTimeout:function(a){this.idleTimeoutId=window.setTimeout(function(){e(window).one("mousemove",
function(){c.events.publish("results.expired")})},a)},stopIdleTimeout:function(){window.clearTimeout(this.idleTimeoutId);this.idleTimeoutId=null},startClientTimeout:function(a){var b=this;a+=5E3;var c=this.searchId;this.stopClientTimeout();this.clientTimeoutId=window.setTimeout(function(){c===b.searchId&&b.clientTimeout()},a)},stopClientTimeout:function(){window.clearTimeout(this.clientTimeoutId);this.clientTimeoutId=null},startedStreaming:function(){var a=this;this.options.enforceIdleTimeout&&this.startIdleTimeout(6E4*
this.options.idleExpireMinutes);null===this.clientTimeoutId&&this.startClientTimeout(2*this.options.pollingTimeout);c.Analytics.api.trackEvent({category:"ResultsPage",action:"search_started"});if(this.options.secondPhaseCompleteBanner){var b=this.resultsList.offset().top;if(e(window).scrollTop()>b)a.poll.viewingResults=!0;else e(window).on("sdcroll.viewResults",function(){!a.poll.viewingResults&&e(window).scrollTop()>b&&(a.poll.viewingResults=!0,e(window).off("scroll.viewResults"))})}},showSecondPhaseCompleteBanner:function(a){var b=
this;a="\x3ca href\x3d'javascript:void(0)'\x3e%s\x3c/a\x3e".format(a);a="\x3cdiv class\x3d'pinnedBanner'\x3e\x3cspan class\x3d'arrow'\x3e\x3c/span\x3e %s \x3cspan class\x3d'close-x'\x3e\x3c/span\x3e\x3c/div\x3e".format(a);var c=e("\x3cdiv class\x3d'pinnedBannerContainer'\x3e%s\x3c/div\x3e".format(a));c.appendTo(this.element.find(".resultsListHeader"));c.find("a").on("click",function(){b.refreshResults();c.remove();e("html, body").animate({scrollTop:0});e(window).off("scroll.secondPhaseBanner")});
c.find(".close-x").click(function(){c.remove()});this.subscribe("resultspage.requestResults",function(){c.remove()});var d=this.element.find(".resultsListHeader").offset().top;a=function(){var a=e(window).scrollTop(),b=a>d-50;c.css("top",(b?a-(d-27):-23)+"px");c.toggleClass("sticky",b)};e(window).on("scroll.secondPhaseBanner",a);a()},didReceiveResults:function(a){},updateDOM:function(a,b){},checkFilteredCountForPreservedFilters:function(a){if(this.preserveFilters){this.clearPreservedFilters();var b=
c.config.getInt("horizon.base.results.removeFiltersThreshHold",10);a.filtered<b&&a.total>=b&&(c.Widgets.Toaster.addToast(this.options.msg.filters_removed,{button:!0,escaped:!1,auto:!0,theme:"centered filters-cleared-toast"}),this.filterState={},this.refreshResults({resetFilters:!0}))}},attachLastChanceAfterClickHandler:function(a){var b=0,f=null,d=0;e(document).off("scroll.lcac").off("mousemove.lcac").on("scroll.lcac",function(){b=e(this).scrollTop()}).on("mousemove.lcac",function(h){var g=h.pageY-
(f-h.pageY);g<f&&0<=g&&g-10<=b&&1E3<Date.now()-d&&(g=e(a),g.length&&(g=e(g.get(0)).data("resultid"),c.Analytics.api.trackEvent("/mouseout/show/afterclick"),c.events.publish("multibook.providerClicked",{resultId:g}),d=Date.now()));f=h.pageY})},mergeFilterStateWithUrl:function(a){var b=window.location.pathname+window.location.search,c="string"!==typeof a,d=b.split("?");if(1<d.length){for(var b=d[1].split("\x26"),e=!1,g=0;g<b.length;g++)b[g].startsWith("fs")&&(b[g]=c?null:"fs\x3d"+a,e=!0);e||c||b.push("fs\x3d"+
a);a=b.filter(function(a){return"string"===typeof a&&a.length});b=d[0]+(a.length?"?"+a.join("\x26"):"")}else c||(b+="?fs\x3d"+a);return b},updateUrlFilterState:function(a){window.history&&window.history.replaceState&&window.history.replaceState(null,null,this.mergeFilterStateWithUrl(a))}})})(R9,jq||jQuery);(function(c,d){c.createComponentClass("base.search.SearchForm",{vertical:null,searchForm:null,submitButton:null,errorContainer:null,options:{suppressCmp2s:!1,useCmp2Submit:!0,navigateToResults:!1,pageOrigin:"",useHistory:!0,inlineErrorEnabled:!1,sync:!0,loggingPrefix:"",isSeo:!1,isCmp2Tooltip:!1,autofocusViaJs:!1,multiSearcherEnabled:!1,useSelectWidget:!1},didUpdateHistory:!1,localHistory:null,isSubmitted:!1,init:function(a){this.searchForm=this.element.find(".searchform");this.submitButton=this.getChildElement("submit");
this.errorContainer=this.getChildElement("error")},addEventHandlers:function(){var a=this;this.bindLocalHistory();this.bindSelectTextOnFocus();this.loadFromStorage();this.searchForm.on("submit",function(b){b.preventDefault();a.trackSubmitEvent();return a.onSubmit(b)});c.events.subscribe("search.form.clear",d.proxy(this.onClear,this))},enableSearchButton:function(){this.submitButton.removeAttr("disabled");this.isSubmitted=!1},disableSearchButton:function(){this.submitButton.attr("disabled","disabled");
this.isSubmitted=!0},inlineComponentsReady:function(){c.events.publish("searchform.initialized",this);this.loadCompareToItems();this.options.autofocusViaJs&&this.autofocus()},loadCompareToItems:function(){if(this.isEnoughInformationForCompareToRequest()){var a=d.extend({},this.getCompareToFormData(),{id:this.id()+"-compareTo",vertical:this.vertical});c.events.publish("cmp2.getItems",a);c.events.publish("search.form.clear",this.id())}else c.events.publish("cmp2.cleanUp",{id:this.id()+"-compareTo"})},
shouldUpdate:function(a){a=a||{};return this.options.sync||this.id()===a.id},updateLogging:function(a){a.loggingPrefix&&a.loggingPrefix!==this.options.loggingPrefix&&(this.options.loggingPrefix=a.loggingPrefix)},getCompareToFormData:function(){return{}},isEnoughInformationForCompareToRequest:function(){return!1},serialize:function(){return{tab:this.vertical,pageOrigin:this.options.pageOrigin,src:"",searchingAgain:"",c2s:"",po:"",personality:"",provider:"-1"}},load:function(a){},buildSearchURL:function(a){},
onClear:function(){this.clearErrors()},clearErrors:function(){this.errorContainer.html("")},validate:function(){return!1},isValid:function(){var a=this.validate();return!a||!a.length},showError:function(a){if(this.options.inlineErrorEnabled)if(0<this.errorContainer.length)this.errorContainer.html(a),c.events.publish("search.submit.error",this.errorContainer);else throw"Missing container with id: "+this.id("error");else c.events.publish("error.alert",{messages:a})},onSubmit:function(a){if(this.isSubmitted)return!1;
this.clearErrors();this.disableSearchButton();if((a=this.validate())&&a.length)return this.enableSearchButton(),this.showError(a),!1;this.saveToStorage(!0);a=this.serialize()||{};a.vertical=this.vertical;a.url=this._generate(a);a.id=this.id();this.publishSubmitEvent(a);return!1},publishSubmitEvent:function(a){c.events.publish(this.options.multiSearcherEnabled?"multilocale.search.submit":this.options.useCmp2Submit?"cmp2.submit":"searchform.submit",a)},bindSelectTextOnFocus:function(){var a=null;this.searchForm.find("input.selectTextOnFocus").on("focus",
function(){a!==d(this)&&(a=d(this),setTimeout(function(){a.select()},50))});var b=this.searchForm.find("input[autofocus]");b.length&&setTimeout(function(){b.select()},50)},bindLocalHistory:function(){var a=this;this.didUpdateHistory=!1;this.localHistory=new c.common.utils.history.UserHistory({tab:a.vertical,persistLocalStorage:a.options.useHistory,onSave:function(){a.didUpdateHistory||a.saveToStorage(!1)}})},trackSubmitEvent:function(){c.Analytics.api.trackEvent("%s/searchform/submit".format(this.options.loggingPrefix))},
getCookieData:function(){var a=this.serialize();return{page_origin:a.pageOrigin,src:a.src,searchingagain:a.searchingAgain,c2s:a.c2s,po:a.po,personality:a.personality,provider:a.provider}},_generate:function(a){a=this.buildSearchURL(a);this.setCookies(a);return a},setCookies:function(a){var b=this.getCookieData();b.id=this.id();c.events.publish("update.cookies",b);document.cookie=this._generateCookie(a,this.vertical,b)},_generateCookie:function(a,b,c){if(""!==a){b="/"+b+"/";var e=encodeURIComponent(a.substring(a.indexOf(b)+
b.length));0>a.indexOf(b)&&(e=encodeURIComponent(a.substring(a.indexOf("/",1)+1)));a="hiddenParams"+e;b=new Date;e=b.getTime();b.setTime(e+3E4);c=encodeURIComponent(decodeURIComponent(d.param(c)));return a+"\x3d"+c+"; expires\x3d"+b.toGMTString()+"; path\x3d/"}},getStorageProps:function(){return null},getStorageExceptions:function(){return null},loadFromStorage:function(){this.loadingHistory=!0;this.options.useHistory&&this.localHistory.wasLastUsedPage&&this.loadFromHistory(this.localHistory.getRecentHistory());
this.loadingHistory=!1},loadFromHistory:function(a){this.load(d.extend({},{id:this.id()},a))},saveToStorage:function(a){this.didUpdateHistory=!0;if(a){a=this.serialize()||{};var b=this.getStorageProps()||{},c=this.getStorageExceptions()||[],g={};b||(b=d.map(a,function(a,b){return b}));c&&d.map(c,function(a){a=d.inArray(a,b);0<=a&&b.splice(a,1)});for(c=0;c<b.length;c++)if(a.hasOwnProperty(b[c])){var f=b[c],h=a[f];this.localHistory.set(f,h);g[f]=h}this.localHistory.pushSearchHistory(g)}},autofocus:function(){return null},
isNull:function(a){return null===a},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return this.isNull(a)||this.isUndefined(a)||"string"===typeof a&&""===a.trim()}})})(window.R9,window.jq||window.jQuery);(function(c,d,e){c.publish("common.utils.history.UserHistory",e.extend({constructor:function(a){this.options=d.extend({},this.options,a);this.init()},pageTab:"other",wasLastUsedPage:!1,searchHistoryLimit:3,options:{defaultCookiExpire:10,defaultSearchExpire:100,persistLocalStorage:!0,onSave:d.noop},_storageTemplate:{sticky:{origin:"",destination:"",guests:"",depart_date:"",return_date:"",travelersObject:""},lastUsedTab:"",canary:3},_storageKey:"BKHISTORY2",hasSearchHistory:!1,searchHistoryMoreRecent:!1,
_loadStorageInstance:function(){var a=this._storageTemplate.canary,b=c.storage.get(this._storageKey);c.common.utils.history.UserHistory.storageSync=b&&b.canary&&b.canary===a?b:d.extend(!0,{},this._storageTemplate)},getStorage:function(){c.common.utils.history.UserHistory.storageSync||(c.common.utils.history.UserHistory.storageSync=d.extend(!0,{},this._storageTemplate));return c.common.utils.history.UserHistory.storageSync},initStorageInstance:function(){var a=this.getStorage();a[this.pageTab]||(a[this.pageTab]=
{searches:[],last_updated:null},c.storage.set(this._storageKey,a))},_createExpirationTimestamp:function(a){return moment().add(a||0,"hours").toDate()},init:function(){this.dirty=!1;this.pageTab=this.options.tab||this.pageTab;this._loadStorageInstance();this.initStorageInstance();this.getStorage().lastUsedTab===this.pageTab&&(this.wasLastUsedPage=!0);this.evictExpiredSearches();var a=this.getStorage()[this.pageTab];a&&a.searches&&0<a.searches.length&&(this.hasSearchHistory=!0,a.last_updated&&a.searches[0]&&
1>moment(a.last_updated).diff(a.searches[0].createdAt)&&(this.searchHistoryMoreRecent=!0));var b=this;d(window).bind("beforeunload",function(){try{b.save()}catch(f){}})},save:function(){if(this.dirty)try{this.options.onSave.call(this),this.dirty&&this.options.persistLocalStorage&&(this.dirty=!1,this.getStorage().lastUsedTab=this.pageTab,this.getStorage().common=this.common,c.storage.set(this._storageKey,this.getStorage()))}catch(a){return!1}return!0},get:function(a){if(this.getStorage()[this.pageTab])return this.getStorage()[this.pageTab][a]},
set:function(a,b){var c=this.getStorage()[this.pageTab];c&&c[a]!==b&&(this.dirty=!0,c.last_updated=this._createExpirationTimestamp(),c[a]=b);clearTimeout(this._saveTimeout);this._saveTimeout=setTimeout(d.proxy(this,"save"),100)},reduceTravelersObjectToTotal:function(){var a=0;if(this.getStorage().sticky){var b=this.getStorage().sticky.travelersObject;b&&(a+=parseInt(b.adults),a+=parseInt(b.youth),a+=parseInt(b.children),a+=parseInt(b.infants),a+=parseInt(b.lapinfants),a+=parseInt(b.seniors))}return a},
getRecentHistory:function(){var a=this.getStorage()[this.pageTab],b=this.hasSearchHistory&&this.searchHistoryMoreRecent&&a&&a.searches?a.searches[0]:null;if(!b&&a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=this.get(c));delete b.last_updated;delete b.searches}return b},evictExpiredSearches:function(){var a=this.getStorage(),b=a[this.pageTab]?a[this.pageTab].searches:null;b&&0!==b.length&&b.length>this.searchHistoryLimit&&a[this.pageTab].searches&&(a[this.pageTab].searches=b.slice(0,this.searchHistoryLimit))},
pushSearchHistory:function(a){var b=this.getStorage();b[this.pageTab]&&b[this.pageTab].searches&&(a.expiresBy=this._createExpirationTimestamp(this.options.defaultSearchExpire),a.createdAt=this._createExpirationTimestamp(),b[this.pageTab].searches.splice(0,0,a),this.dirty=!0);this.save()},purge:function(){c.storage.remove(this._storageKey);c.common.utils.history.UserHistory.storageSync=null;this.initStorageInstance();this.options.persistLocalStorage=!1}}))})(R9,jQuery,base2.Base);(function(a,d){a.createComponentClass("base.search.SearchPage",{options:{msg:{resultPageTitle:""},lazyLoadRP:!1,pageVertical:"",staticSignInEnabled:!1,preloadDialogContainer:!1,preloadResourcesForRP:!1},rpLoaded:!1,rpPromise:null,pushStateAvailable:!1,init:function(a){this.pushStateAvailable=void 0!==window.history.pushState;this.preloadComponents();""!==this.options.msg.resultPageTitle&&(document.title=this.options.msg.resultPageTitle)},addEventHandlers:function(c){var b=this;a.events.subscribe("pageContainer.contentBlur",
function(a){b.element.toggleClass("Blur",a)});a.events.subscribe("searchform.submit",function(a){b.rpLoaded?(b.pushStateAvailable?window.history.pushState({view:"rp"},"","/"+a.url):window.location.href="/"+a.url,""!==b.options.msg.resultPageTitle&&(document.title=b.options.msg.resultPageTitle),b.setView("rp")):(null!==b.rpPromise&&b.rpPromise.abort(),window.location.href="/"+a.url)});a.events.subscribe("searchpage.setview",function(a){b.setView(a)});if(this.pushStateAvailable){var d=window.location.hash,
e=function(a){window.setTimeout(function(a){window.location.hash!==d?d=window.location.hash:(window.removeEventListener("popstate",e),window.location.pathname=document.location.pathname)},1)};-1<navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome")||a.config.getBoolean("horizon.searchpage.popstate.onload.only",!0)?window.addEventListener("load",function(){setTimeout(function(){window.addEventListener("popstate",e)},0)}):window.addEventListener("popstate",e)}},setView:function(c){"rp"===
c&&(a.events.publish("frontdoor.view.changed",{view:"inline"}),this.element.removeClass("vm-fd"),this.element.addClass("vm-rp"),a.events.publish("resultspage.view.setvisible",!0),a.events.publish("header.view.set",{view:"results"}),a.events.publish("pageContainers.changed",{state:"results"}),a.events.publish("body.setClass","wide"),a.events.publish("resultspage.routed",!0),a.Analytics.api.setVertical(this.options.pageVertical),a.Analytics.api.setPageId("results"),"requestId"in a.globals&&(a.globals.requestId=
a.globals.requestId.replace("frontdoor","results").replace("main",this.options.pageVertical)),this.cleanupFrontDoor())},preloadComponents:function(){var c=this;if(this.options.lazyLoadRP)d(window).on("load",function(){c.rpPromise=c.loadResultsPageComponent();c.rpPromise.done(function(){c.rpLoaded=!0})});else this.rpLoaded=!0;this.options.preloadDialogContainer&&d(document).ready(function(){a.authentication.preloadDialog()});this.element.hasClass("vm-fd")&&this.options.preloadResourcesForRP&&a.ajax.preloadResources("common.booking",
"styles")},cleanupFrontDoor:function(){},loadResultsPageComponent:function(){}})})(R9,jq||jQuery);