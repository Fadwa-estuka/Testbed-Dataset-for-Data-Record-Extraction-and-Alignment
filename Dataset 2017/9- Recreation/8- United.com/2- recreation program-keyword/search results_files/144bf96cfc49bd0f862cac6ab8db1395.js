/*
 MIT License (c) copyright 2011-2013 original author or authors  MIT License (c) copyright 2013 original author or authors */
Bootstrapper.bindDOMLoaded(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;var width=window.innerWidth||document.body.clientWidth;var height=window.innerHeight||document.body.clientHeight;width=Math.round(width/10)*10;height=Math.round(height/10)*10;function inIframe(){try{return window.self!==window.top}catch(e){return true}}var size=width+"x"+height;scripts=document.getElementsByTagName("script");for(var i=scripts.length;i--;){var filename=scripts[i].src.split("/");
if(filename[filename.length-1].toLowerCase()=="analytics.js"){ga("send","event","Browser Size","Range",size,1,{"nonInteraction":1});ga("set","dimension8",size);if(inIframe())try{ga("send","event","CrossSite Alert","iFrame",document.referrer,1,{"nonInteraction":1})}catch(e){}}}},1427733,249951);
Bootstrapper.bindImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;var setupAct=true,urlSearch=document.location.search.slice(1);if(urlSearch!==""){var searchArr=document.location.search.slice(1).split("\x26"),searchObj={};for(var i=0;i<searchArr.length;i++){var keyVal=searchArr[i].split("\x3d");if(keyVal.length>1&&keyVal[0]&&keyVal[1])searchObj[keyVal[0].toLowerCase()]=keyVal[1].toLowerCase()}if(searchObj.activate&&searchObj.activate===
"no")setupAct=false}if(setupAct){if(!window.JSON||typeof JSON!=="object")window[ensightenOptions.ns].JSON={};(function(){var JSON=window.JSON?window.JSON:window[ensightenOptions.ns].JSON;function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=
Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?
'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function")value=value.toJSON(key);if(typeof rep==="function")value=rep.call(holder,key,value);switch(typeof value){case "string":return quote(value);case "number":return isFinite(value)?String(value):"null";
case "boolean":case "null":return String(value);case "object":if(!value)return"null";gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1)partial[i]=str(i,value)||"null";v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1)if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v)partial.push(quote(k)+
(gap?": ":":")+v)}}else for(k in value)if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function")JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number")for(i=0;i<space;i+=1)indent+=" ";else if(typeof space==="string")indent=space;rep=replacer;if(replacer&&
typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number"))throw new Error("JSON.stringify");return str("",{"":value})};if(typeof JSON.parse!=="function")JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object")for(k in value)if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined)value[k]=v;else delete value[k]}return reviver.call(holder,key,value)}text=String(text);
cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse");}})();window[ensightenOptions.ns].when=function(){when.defer=defer;
when.resolve=resolve;when.reject=reject;when.join=join;when.all=all;when.map=map;when.reduce=reduce;when.any=any;when.some=some;when.isPromise=isPromise;function when(promiseOrValue,onFulfilled,onRejected,onProgress){return resolve(promiseOrValue).then(onFulfilled,onRejected,onProgress)}function Promise(then){this.then=then}Promise.prototype={otherwise:function(onRejected){return this.then(undef,onRejected)},ensure:function(onFulfilledOrRejected){var self=this;return this.then(injectHandler,injectHandler).yield(self);
function injectHandler(){return resolve(onFulfilledOrRejected())}},"yield":function(value){return this.then(function(){return value})},spread:function(onFulfilled){return this.then(function(array){return all(array,function(array){return onFulfilled.apply(undef,array)})})},always:function(onFulfilledOrRejected,onProgress){return this.then(onFulfilledOrRejected,onFulfilledOrRejected,onProgress)}};function resolve(value){return promise(function(resolve){resolve(value)})}function reject(promiseOrValue){return when(promiseOrValue,
rejected)}function defer(){var deferred,pending,resolved;deferred={promise:undef,resolve:undef,reject:undef,notify:undef,resolver:{resolve:undef,reject:undef,notify:undef}};deferred.promise=pending=promise(makeDeferred);return deferred;function makeDeferred(resolvePending,rejectPending,notifyPending){deferred.resolve=deferred.resolver.resolve=function(value){if(resolved)return resolve(value);resolved=true;resolvePending(value);return pending};deferred.reject=deferred.resolver.reject=function(reason){if(resolved)return resolve(rejected(reason));
resolved=true;rejectPending(reason);return pending};deferred.notify=deferred.resolver.notify=function(update){notifyPending(update);return update}}}function promise(resolver){var value,handlers=[];try{resolver(promiseResolve,promiseReject,promiseNotify)}catch(e){promiseReject(e)}return new Promise(then);function then(onFulfilled,onRejected,onProgress){return promise(function(resolve,reject,notify){handlers?handlers.push(function(value){value.then(onFulfilled,onRejected,onProgress).then(resolve,reject,
notify)}):enqueue(function(){value.then(onFulfilled,onRejected,onProgress).then(resolve,reject,notify)})})}function promiseResolve(val){if(!handlers)return;value=coerce(val);scheduleHandlers(handlers,value);handlers=undef}function promiseReject(reason){promiseResolve(rejected(reason))}function promiseNotify(update){if(handlers)scheduleHandlers(handlers,progressing(update))}}function coerce(x){if(x instanceof Promise)return x;else if(x!==Object(x))return fulfilled(x);return promise(function(resolve,
reject,notify){enqueue(function(){try{var untrustedThen=x.then;if(typeof untrustedThen==="function")fcall(untrustedThen,x,resolve,reject,notify);else resolve(fulfilled(x))}catch(e){reject(e)}})})}function fulfilled(value){var self=new Promise(function(onFulfilled){try{return typeof onFulfilled=="function"?coerce(onFulfilled(value)):self}catch(e){return rejected(e)}});return self}function rejected(reason){var self=new Promise(function(_,onRejected){try{return typeof onRejected=="function"?coerce(onRejected(reason)):
self}catch(e){return rejected(e)}});return self}function progressing(update){var self=new Promise(function(_,__,onProgress){try{return typeof onProgress=="function"?progressing(onProgress(update)):self}catch(e){return progressing(e)}});return self}function scheduleHandlers(handlers,value){enqueue(function(){var handler,i=0;while(handler=handlers[i++])handler(value)})}function isPromise(promiseOrValue){return promiseOrValue&&typeof promiseOrValue.then==="function"}function some(promisesOrValues,howMany,
onFulfilled,onRejected,onProgress){checkCallbacks(2,arguments);return when(promisesOrValues,function(promisesOrValues){return promise(resolveSome).then(onFulfilled,onRejected,onProgress);function resolveSome(resolve,reject,notify){var toResolve,toReject,values,reasons,fulfillOne,rejectOne,len,i;len=promisesOrValues.length>>>0;toResolve=Math.max(0,Math.min(howMany,len));values=[];toReject=len-toResolve+1;reasons=[];if(!toResolve)resolve(values);else{rejectOne=function(reason){reasons.push(reason);
if(!--toReject){fulfillOne=rejectOne=noop;reject(reasons)}};fulfillOne=function(val){values.push(val);if(!--toResolve){fulfillOne=rejectOne=noop;resolve(values)}};for(i=0;i<len;++i)if(i in promisesOrValues)when(promisesOrValues[i],fulfiller,rejecter,notify)}function rejecter(reason){rejectOne(reason)}function fulfiller(val){fulfillOne(val)}}})}function any(promisesOrValues,onFulfilled,onRejected,onProgress){function unwrapSingleResult(val){return onFulfilled?onFulfilled(val[0]):val[0]}return some(promisesOrValues,
1,unwrapSingleResult,onRejected,onProgress)}function all(promisesOrValues,onFulfilled,onRejected,onProgress){checkCallbacks(1,arguments);return map(promisesOrValues,identity).then(onFulfilled,onRejected,onProgress)}function join(){return map(arguments,identity)}function map(array,mapFunc){return when(array,function(array){return promise(resolveMap);function resolveMap(resolve,reject,notify){var results,len,toResolve,resolveOne,i;toResolve=len=array.length>>>0;results=[];if(!toResolve)resolve(results);
else{resolveOne=function(item,i){when(item,mapFunc).then(function(mapped){results[i]=mapped;if(!--toResolve)resolve(results)},reject,notify)};for(i=0;i<len;i++)if(i in array)resolveOne(array[i],i);else--toResolve}}})}function reduce(promise,reduceFunc){var args=fcall(slice,arguments,1);return when(promise,function(array){var total;total=array.length;args[0]=function(current,val,i){return when(current,function(c){return when(val,function(value){return reduceFunc(c,value,i,total)})})};return reduceArray.apply(array,
args)})}var reduceArray,slice,fcall,nextTick,handlerQueue,timeout,funcProto,call,arrayProto,undef;handlerQueue=[];function enqueue(task){if(handlerQueue.push(task)===1)scheduleDrainQueue()}function scheduleDrainQueue(){nextTick(drainQueue)}function drainQueue(){var task,i=0;while(task=handlerQueue[i++])task();handlerQueue=[]}timeout=setTimeout;nextTick=typeof setImmediate==="function"?typeof window==="undefined"?setImmediate:setImmediate.bind(window):typeof process==="object"&&process.nextTick?process.nextTick:
function(task){timeout(task,0)};funcProto=Function.prototype;call=funcProto.call;fcall=funcProto.bind?call.bind(call):function(f,context){return f.apply(context,slice.call(arguments,2))};arrayProto=[];slice=arrayProto.slice;reduceArray=arrayProto.reduce||function(reduceFunc){var arr,args,reduced,len,i;i=0;arr=Object(this);len=arr.length>>>0;args=arguments;if(args.length<=1)for(;;){if(i in arr){reduced=arr[i++];break}if(++i>=len)throw new TypeError;}else reduced=args[1];for(;i<len;++i)if(i in arr)reduced=
reduceFunc(reduced,arr[i],i,arr);return reduced};function checkCallbacks(start,arrayOfCallbacks){var arg,i=arrayOfCallbacks.length;while(i>start){arg=arrayOfCallbacks[--i];if(arg!=null&&typeof arg!="function")throw new Error("arg "+i+" must be a function");}}function noop(){}function identity(x){return x}return when}();(function(){var when,slice;when=window[ensightenOptions.ns].when;slice=[].slice;when.apply=apply;when.call=call;when.lift=lift;when.bind=lift;when.compose=compose;function apply(func,
promisedArgs){return when.all(promisedArgs||[],function(args){return func.apply(null,args)})}function call(func){return apply(func,slice.call(arguments,1))}function lift(func){var args=slice.call(arguments,1);return function(){return apply(func,args.concat(slice.call(arguments)))}}function compose(f){var funcs=slice.call(arguments,1);return function(){var args=slice.call(arguments);var firstPromise=apply(f,args);return when.reduce(funcs,function(arg,func){return func(arg)},firstPromise)}}})();window[ensightenOptions.ns].data=
function(window,undefined){var _private={engines:{memory:{get:function(key){if(!_public.utils.isArray(key))return window[ensightenOptions.ns].when.resolve(_private.data[key]);else{var data=[];for(var i=0;i<key.length;i++)data.push(_private.data[key[i]]);return window[ensightenOptions.ns].when.resolve(data)}},set:function(key,val){if(!_public.utils.isArray(key)){_private.data[key]=val;return window[ensightenOptions.ns].when.resolve(true)}else{for(var k in key)_private.data[key[k]]=val[k];return window[ensightenOptions.ns].when.resolve(true)}},
remove:function(key){if(!_public.utils.isArray(key)){delete _private.data[key];return window[ensightenOptions.ns].when.resolve(true)}else{for(var k in key)delete _private.data[key[k]];return window[ensightenOptions.ns].when.resolve(true)}},clear:function(key){_private.data={};_private.definitions={};return window[ensightenOptions.ns].when.resolve(true)},all:function(){return window[ensightenOptions.ns].when.resolve(_private.data)}}},normalizeInputArgs:function(key,val){var normalized={key:[],val:undefined},
k;if(_public.utils.isPlainObject(key)){normalized.val=[];for(k in key){normalized.key.push(k);normalized.val.push(key[k])}}else if(_public.utils.isArray(key)){normalized.key=key;normalized.val=val}else{normalized.key=key;normalized.val=val}return normalized},definitions:{},data:{}},_public={utils:{isPlainObject:function(value){return!!value&&Object.prototype.toString.call(value)==="[object Object]"},isArray:function(obj){return Object.prototype.toString.call(obj)==="[object Array]"}}},noop=function(){return window[ensightenOptions.ns].when.reject("Not Implemented.")};
function DataDefinitionException(ddArr,optionalMsg){this.name="DataDefinitionException";this.message=optionalMsg||"Data definitions cannot be resolved as there are invalid id(s): "+ddArr}DataDefinitionException.prototype=new Error;if(!DataDefinitionException.prototype)DataDefinitionException.prototype={};DataDefinitionException.prototype.constructor=DataDefinitionException;_private.DataDefinitionException=DataDefinitionException;_private.checkForInvalidDataDefinitions=function checkForInvalidDataDefinitions(ddArr){if(ddArr&&
ddArr.length>0){var ddArrStr=ddArr.join(",");if(ddArrStr.indexOf("invalid_id")>-1){window[ensightenOptions.ns].reportException(new _private.DataDefinitionException(ddArrStr));return true}}return false};_private.collectAvailableDataDefinitions=function collectAvailableDataDefinitions(ddArr){var promisesArr=[];for(var i=0;i<ddArr.length;i++){var dd=parseInt(ddArr[i],10),dataDef=window[ensightenOptions.ns].dataDefinitions[dd];if(dataDef===null||dataDef===undefined){window[ensightenOptions.ns].reportException(new _private.DataDefinitionException(ddArr,
"Invalid data definition used: "+dd));return{promises:[],isInvalid:true}}else promisesArr.push(window[ensightenOptions.ns].data.get(ddArr[i]))}return{promises:promisesArr,isInvalid:false}};_private.dataDefinitions={};_private.dataDefinitionsBySourceCollName={};_public.defineEngine=function(name,object){var i,methods=["get","set","remove","clear","all"];_private.engines[name]=object;if(!object.returnsPromise)for(i=0;i<methods.length;i++){var m=methods[i];object[m]=window[ensightenOptions.ns].when.lift(object[m])}};
_public.getEngine=_public.engine=function(name){return name?_private.engines[name]||{get:noop,set:noop,remove:noop,clear:noop,all:noop}:_private.engines};_public.all=function(engine){engine=engine||"memory";return window[ensightenOptions.ns].data.engine(engine).all()};_public.get=function(key,engine,options){engine=engine||"memory";options=options||{};var keys,normalizedInput;if(key.indexOf(",")>-1){keys=key.split(",");normalizedInput=_private.normalizeInputArgs(keys)}else normalizedInput=_private.normalizeInputArgs(key);
if(options.wait)return _private.getWait(normalizedInput.key,window[ensightenOptions.ns].data.engine(engine),options);else{var keyExists=_private.data?_private.data.hasOwnProperty(normalizedInput.key):false;if(!keyExists)return _private.getWaitForKey(normalizedInput.key,window[ensightenOptions.ns].data.engine(engine),options);return window[ensightenOptions.ns].data.engine(engine).get(normalizedInput.key)}};_private.getWait=function(key,engine,options){var startTime=+new Date,defer=window[ensightenOptions.ns].when.defer(),
doIt=function(){var dataPromise=engine.get(key);if(options.wait===-1)return dataPromise;dataPromise.then(function(val){if(!options.setCheck(val))setTimeout(tryAgain,options.interval);else defer.resolve(val)},function(err){setTimeout(tryAgain,options.interval)})},tryAgain=function(){var currentTime=+new Date,elapsed=currentTime-startTime;if(options.wait!==-1&&elapsed<options.wait)doIt();else defer.reject("Timeout")};options.interval=options.interval||500;options.wait=options.wait||5E3;if(!_public.utils.isArray(key))options.setCheck=
options.setCheck||function(val){return!!val};else options.setCheck=options.setCheck||function(val){var ret=true;for(var i=0;i<val.length;i++)ret=ret&&!!val[i];return ret};doIt();return defer.promise};_private.getWaitForKey=function(key,engine,options){var defer=window[ensightenOptions.ns].when.defer(),doIt=function(){var keyExists=_private.data?_private.data.hasOwnProperty(key):false;if(keyExists){var dataPromise=engine.get(key);if(options.wait===-1)return dataPromise;dataPromise.then(function(val){defer.resolve(val)},
function(err){defer.reject(err)})}else setTimeout(tryAgain,options.interval)},tryAgain=function(){doIt()};options.interval=options.interval||100;options.wait=options.wait||1;doIt();return defer.promise};_public.set=function(key,value,engine){var normalizedInput=_private.normalizeInputArgs(key,value);var args=Array.prototype.slice.call(arguments);engine=engine||"memory";return window[ensightenOptions.ns].data.engine(engine).set(normalizedInput.key,normalizedInput.val)};_public.remove=function(key,
engine){engine=engine||"memory";return window[ensightenOptions.ns].data.engine(engine).remove(key)};_public.clear=function(engine){engine=engine||"memory";return window[ensightenOptions.ns].data.engine(engine).clear()};_public.define=function(options,old){if(old){options.name=old.id||old.name;options.persist=old.memLevel}if(!options.name)return window[ensightenOptions.ns].when.reject(new Error("Invalid parameters: missing 'name'"));options.id=options.name;options.load=options.load||"javascript";options.load=
options.load.indexOf("javascript")>-1?options.load:options.load+",javascript";options.trigger=options.trigger||function(){return window[ensightenOptions.ns].when.resolve()};options.priv=options.priv||false;options.persist=options.persist||options.load.replace("javascript","memory").replace("local","store").replace("cloud","hpps")||"memory";options.collection=options.collection||"Data Layer";if(options.persist.indexOf(",")>-1)options.persist=options.persist.split(",");else options.persist=[options.persist];
for(var i=0;i<options.persist.length;i++)options.persist[i]=window[ensightenOptions.ns].data.engine(options.persist[i]);var fnE=options.extract||function(){return document},fnT=options.transform||function(elem){return elem.toString()},fnL=function(name,value){var promises=[],p=options.persist;for(var i=0;i<p.length;i++)promises.push(p[i].set(name,value));if(typeof window[ensightenOptions.ns].data.dataExport=="object")window[ensightenOptions.ns].data.dataExport(name,value,options.collection);window[ensightenOptions.ns].when.all(promises).then(function(val){defer.resolve(val)},
function(err){defer.reject(err)})},defer=window[ensightenOptions.ns].when.defer();options.trigger().then(function(){defer.resolve(window[ensightenOptions.ns].when.reduce([fnE(),fnT,fnL],function(previous,current,index,total){if(index==1)return current(previous);else if(index==2)current(options.name,previous)}))},function(err){defer.reject(err)});_private.dataDefinitions[options.id]=options;var source_coll_name_key=""+options.source+"."+options.collection+"."+options.dataDefName;_private.dataDefinitionsBySourceCollName[source_coll_name_key]=
options;return defer.promise};_public.checkConditions=function(conditions){var i,comparatorFns={lt:function(compareWith,compareTo){return compareWith<compareTo},gt:function(compareWith,compareTo){return compareWith>compareTo},eql:function(compareWith,compareTo){return compareWith==compareTo},exists:function(compareWith,compareTo){var compareTo=compareTo||"";return compareTo!=""},starts:function(compareWith,compareTo,c){var regEx=new RegExp("^"+compareTo,c?"i":"");try{return compareWith.match(regEx)}catch(e){return false}},
ends:function(compareWith,compareTo,c){var regEx=new RegExp(compareTo+"$",c?"i":"");try{return compareWith.match(regEx)}catch(e){return false}},contains:function(compareWith,compareTo,c){var regEx=new RegExp(".*"+compareTo+".*",c?"i":"");try{return compareWith.match(regEx)}catch(e){return false}}};comparatorFns["is"]=comparatorFns["eql"];comparatorFns["starts with"]=comparatorFns["starts"];comparatorFns["ends with"]=comparatorFns["ends"];for(var i=0;i<conditions.values.length;i++){var compareMethod=
conditions.customComparator?conditions.customComparator[i]?conditions.customComparator[i]:comparatorFns[conditions.comparators[i]]:comparatorFns[conditions.comparators[i]],passComparator=compareMethod(conditions.values[i],conditions.compareTo[i],conditions.caseInsensitive?conditions.caseInsensitive[i]||false:false);if(conditions.not[i])passComparator=!passComparator;if(!passComparator)return false}return true};_public.triggerPromise=function(fn,compareTo,timeout){timeout=timeout||5E3;var start=+new Date,
defer=window[ensightenOptions.ns].when.defer(),checkForPass=function(){var check=fn();if(check!=compareTo)defer.resolve(check);else if(window[ensightenOptions.ns].hasDOMParsed())defer.reject("DOM parsed, timeout");else if(+new Date-start<timeout)setTimeout(arguments.callee,200);else defer.reject("timed out")};checkForPass();return defer.promise};_public.timeoutPromise=function(promise,ms){var d=window[ensightenOptions.ns].when.defer(),ms=ms||800;promise.then(d.resolve,d.reject);setTimeout(function(){d.reject(new Error("timed out"))},
ms);return d.promise};_public.delayTrigger=function(delay){delay=delay||10;var defer=window[ensightenOptions.ns].when.defer();setTimeout(function(){defer.resolve()},delay);return defer.promise};_public.delayUntilTrigger=function(fn,compareTo,timeout,pollInterval){timeout=timeout||null;pollInterval=pollInterval||200;var start=+new Date,defer=window[ensightenOptions.ns].when.defer(),checkForPass=function(){var check=fn();if(check!=compareTo)defer.resolve(check);else if(timeout)if(+new Date-start<timeout)setTimeout(arguments.callee,
pollInterval);else defer.reject("timed out");else setTimeout(arguments.callee,pollInterval)};checkForPass();return defer.promise};_public.getAllDataDefinitionsOnCurrentPage=function(){return _private.dataDefinitions};_public.getAllDataDefinitionsOnCurrentPage_S_C_N=function(){return _private.dataDefinitionsBySourceCollName};_public.getDataDefinitionById=function(id){id=id||-1;return _private.dataDefinitions[id]||{}};_public.getDataDefinitionBySourceCollectionName=function(source,collection,name){var source_coll_name_key=
""+source+"."+collection+"."+name;return _private.dataDefinitionsBySourceCollName[source_coll_name_key]||{}};_public.getDataDefinitionByPercentSyntax=function(source_id_random){source_id_random=""+source_id_random;var parts=source_id_random.split("_");if(parts.length<1)return{};var id=parts[1];return _private.dataDefinitions[id]||{}};_public.resolve=function(ddArr,cb){var self=this;if(!_private.checkForInvalidDataDefinitions(ddArr))window[ensightenOptions.ns].bindDataDefinitionComplete(function(){var validatedDataDefinitions=
_private.collectAvailableDataDefinitions(ddArr);if(validatedDataDefinitions.isInvalid)return;var promises=validatedDataDefinitions.promises;window[ensightenOptions.ns].when.all(promises).then(function(resolvedArr){try{cb.apply(self,resolvedArr)}catch(err){window[ensightenOptions.ns].reportException(new _private.DataDefinitionException(ddArr,"Error resolving data definitions: "+ddArr+". Details: "+err))}},function(err){window[ensightenOptions.ns].reportException(new _private.DataDefinitionException(ddArr,
"Error resolving data definitions: "+ddArr+". Details: "+err))})})};_public.extract=function(g,t){var value="",getElementByXPathStep=function(d,a){var c=~a.indexOf("#")?a.split("#")[1]:"",e=c?0:~a.indexOf("[")?parseInt(a.match(/\[(\d+)\]/)[1]):0,f=(c?a.split("#")[0]:e?a.split("[")[0]:a).toLowerCase();if(d==document&&f=="html"&&e==0)return document.getElementsByTagName("html")[0];if(~a.indexOf("#"))return document.getElementById(a.split("#")[1]);var b=d.firstChild;if(!b)return null;for(var g=0,e=e!=
0?e-1:e;b;){if(b.nodeType==1)if(b.tagName.toLowerCase()==f&&c!=""&&b.id==c)return b;else if(b.tagName.toLowerCase()==f&&g==e&&c=="")return b;else b.tagName.toLowerCase()==f&&g++;b=b.nextSibling}},getElementByXPath=function(d,n){for(var d=d.split("/"),a=getElementByXPathStep(n||document,d[1]),c=2;c<d.length;c++){if(a==null)return null;a=getElementByXPathStep(a,d[c])}return a},getMetaCache=function(){var cache={},metas=window.document.getElementsByTagName("META")||[];for(var m=0,len=metas.length;m<
len;m++){var name=metas[m].name||metas[m].getAttribute("property")||"";if(name.length!==0)cache[name]=metas[m].content}return cache}(),getMeta=function(n){var meta=getMetaCache[n];if(meta)return meta;var metas=window.document.getElementsByTagName("META")||[];for(var m=0,len=metas.length;m<len;m++){var name=metas[m].name||metas[m].getAttribute("property")||"";if(n==name)return metas[m].content}},getParam=function(p){return(val=(new RegExp("\x26"+p+"\x3d([^\x26]*)")).exec(window.location.search.replace(/^\?/,
"\x26")))?val[0].split("\x3d")[1]:""},getCookie=function(c){return(val=(new RegExp("^"+c+"\x3d.*|;\\s*"+c+"\x3d.*")).exec(window.document.cookie))?val[0].split("\x3d")[1].split(";")[0]:""},getContent=function(x){var n=getElement(x);if(n&&n.nodeType&&n.nodeType==1)n=n.value||n.innerHTML||"";return n.toString().replace(/\n|\r|\s\s+/g,"")||""},getElement=function(x){var n="";if(x.indexOf("/HTML/BODY")==0)n=getElementByXPath(x);else try{n=eval(x)}catch(e){n=""}return n};try{if(t)if(t=="meta")value=getMeta(g);
else if(t=="cookie")value=getCookie(g);else if(t=="param")value=getParam(g);else if(t=="content")value=getContent(g);else if(t=="event")value=getElement(g);else{if(t=="var")value=window[g]}else value=getMeta(g)||getCookie(g)||getParam(g)||getContent(g)||getEvent(g)||window[g]||"";return value||""}catch(e){return""}};if("undefined"==typeof module)var module={exports:{}},exports=module.exports;exports=_public;return _public}(window);window[ensightenOptions.ns].data.defineEngine("store",function(){var api=
{},win=window,doc=win.document,localStorageName="localStorage",globalStorageName="globalStorage",storage,k,isArray=Array.isArray||function(value){return Object.prototype.toString.call(value)==="[object Array]"};api.set=function(key,value){};api.get=function(key){};api.remove=function(key){};api.clear=function(){};try{if(localStorageName in win&&win[localStorageName]){storage=win[localStorageName];api.set=function(key,val){var i,l,Json=window.JSON&&window.JSON.stringify?window.JSON:window[ensightenOptions.ns].JSON;
if(isArray(key))for(i=0,l=key.length;i<l;i++)storage.setItem(key[i],typeof val[i]==="string"?val[i]:Json.stringify(val[i]));else storage.setItem(key,typeof val==="string"?val:Json.stringify(val))};api.get=function(key){if(isArray(key)){var items={},i,l;for(i=0,l=key.length;i<l;i++)items[key[i]]=storage.getItem(key[i]);return items}return storage.getItem(key)};api.remove=function(key){if(isArray(key)){var i,l;for(i=0,l=key.length;i<l;i++)storage.removeItem(key[i]);return}storage.removeItem(key)};api.clear=
function(){storage.clear()};api.all=function(){return storage}}else if(globalStorageName in win&&win[globalStorageName]){storage=win[globalStorageName][win.location.hostname];api.set=function(key,val){if(isArray(key)){var i,l;for(i=0,l=key.length;i<l;i++)storage[key[i]]=val[i];return}storage[key]=val};api.get=function(key){if(isArray(key)){var items={},i,l;for(i=0,l=key.length;i<l;i++)items[key[i]]=storage[key[i]]&&storage[key[i]].value;return items}return storage[key]&&storage[key].value};api.remove=
function(key){if(isArray(key)){var i,l;for(i=0,l=key.length;i<l;i++)delete storage[key[i]];return}delete storage[key]};api.clear=function(){for(var key in storage)delete storage[key]};api.all=function(){return storage}}else if(doc.documentElement.addBehavior){var storageOwner,storageContainer;try{storageContainer=new ActiveXObject("htmlfile");storageContainer.open();storageContainer.write("\x3cs"+"cript\x3edocument.w\x3dwindow\x3c/s"+'cript\x3e\x3ciframe src\x3d"/favicon.ico"\x3e\x3c/frame\x3e');
storageContainer.close();storageOwner=storageContainer.w.frames[0].document;storage=storageOwner.createElement("div")}catch(e){storage=doc.createElement("div");storageOwner=doc.body}function withIEStorage(storeFunction){return function(){var args=Array.prototype.slice.call(arguments,0);args.unshift(storage);storageOwner.appendChild(storage);storage.addBehavior("#default#userData");storage.load(localStorageName);var result=storeFunction.apply(store,args);storageOwner.removeChild(storage);return result}}
var forbiddenCharsRegex=new RegExp("[!\"#$%\x26'()*+,/\\\\:;\x3c\x3d\x3e?@[\\]^`{|}~]","g");function ieKeyFix(key){return key.replace(forbiddenCharsRegex,"___")}api.set=withIEStorage(function(storage,key,val){var k;if(isArray(key)){var i,l;for(i=0,l=key.length;i<l;i++){fixedKey=ieKeyFix(key[i]);if(val[i]===undefined)return api.remove(fixedKey);storage.setAttribute(fixedKey,val[i]);storage.save(localStorageName)}}else{fixedKey=ieKeyFix(key);if(val===undefined)return api.remove(fixedKey);storage.setAttribute(fixedKey,
val);storage.save(localStorageName)}});api.get=withIEStorage(function(storage,key){if(isArray(key)){var items={},fixedKey,i,l;for(i=0,l=key.length;i<l;i++){fixedKey=ieKeyFix(key[i]);items[key[i]]=storage.getAttribute(fixedKey)}return items}key=ieKeyFix(key);return storage.getAttribute(key)});api.remove=withIEStorage(function(storage,key){if(isArray(key)){var i,l;for(i=0,l=key.length;i<l;i++){storage.removeAttribute(ieKeyFix(key[i]));storage.save(localStorageName)}return}key=ieKeyFix(key);storage.removeAttribute(key);
storage.save(localStorageName)});api.clear=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;storage.load(localStorageName);for(var i=0,attr;attr=attributes[i];i++)storage.removeAttribute(attr.name);storage.save(localStorageName)});api.all=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;var ret={};for(var i=0,attr;attr=attributes[i];++i){var key=ieKeyFix(attr.name);ret[attr.name]=storage.getAttribute(key)}return ret})}}catch(e){}var k,
utils={};for(k in api)utils[k]=api[k];utils.testStorage=function(){try{var testKey="tk_"+Math.ceil(Math.random()*5E7);utils.set(testKey,"test");if(utils.get(testKey)==="test"){utils.remove(testKey);return true}}catch(e){}return false};api.utils=utils;window[ensightenOptions.ns].data.local=api;return api}());window[ensightenOptions.ns].data.defineEngine("cookie",function(document,undefined){var cookie=function(){return cookie.get.apply(cookie,arguments)};var utils=cookie.utils={isArray:Array.isArray||
function(value){return Object.prototype.toString.call(value)==="[object Array]"},isPlainObject:window[ensightenOptions.ns].data.utils.isPlainObject,toArray:function(value){return Array.prototype.slice.call(value)},getKeys:Object.keys||function(obj){var keys=[],key="";for(key in obj)if(obj.hasOwnProperty(key))keys.push(key);return keys},escape:function(value){return String(value).replace(/[,;"\\=\s%]/g,function(character){return encodeURIComponent(character)})},retrieve:function(value,fallback){return value==
null?fallback:value},getAllCookies:function(){if(document.cookie==="")return{};var cookies=document.cookie.split("; "),result={};for(var i=0,l=cookies.length;i<l;i++){var item=cookies[i].split("\x3d");result[decodeURIComponent(item[0])]=decodeURIComponent(item[1])}return result},set:function(key,value,options){options=options||-1;if(utils.isPlainObject(key))for(var k in key){if(key.hasOwnProperty(k))cookie.set(k,key[k],value)}else if(utils.isArray(key)){var i,l;for(i=0,l=key.length;i<l;i++)cookie.set(key[i],
value[i],options)}else{var expires=options.expires!==undefined?options.expires:cookie.defaults.expires||"",expiresType=typeof expires;if(expiresType==="number")expires=new Date(expires);if(utils.isPlainObject(expires)&&"toGMTString"in expires)expires=";expires\x3d"+expires.toGMTString();else expires=";expires\x3d"+expires;var path=options.path||cookie.defaults.path;path=path?";path\x3d"+path:"";var domain=options.domain||cookie.defaults.domain;domain=domain?";domain\x3d"+domain:"";var secure=options.secure||
cookie.defaults.secure?";secure":"";document.cookie=utils.escape(key)+"\x3d"+utils.escape(value)+expires+path+domain+secure}},get:function(keys,fallback){fallback=fallback||undefined;var cookies=utils.getAllCookies();if(utils.isArray(keys)){var result={};for(var i=0,l=keys.length;i<l;i++){result[keys[i]]=utils.retrieve(cookies[keys[i]],fallback);if(result[keys[i]]===undefined)result[keys[i]]=null}return result}else{var result=utils.retrieve(cookies[keys],fallback);if(result===undefined)return null;
return result}},getGMTString:function(daysFromToday){var date=new Date;date.setTime(date.getTime()+daysFromToday*24*60*60*1E3);return date.toGMTString()}};cookie.defaults={path:"/",expires:utils.getGMTString(90)};cookie.set=function(key,val){utils.set(key,val)};cookie.remove=function(keys){keys=utils.isArray(keys)?keys:utils.toArray(arguments);for(var i=0,l=keys.length;i<l;i++)utils.set(keys[i],"",{expires:-1})};cookie.clear=function(){return cookie.remove(utils.getKeys(utils.getAllCookies()))};cookie.get=
function(keys,fallback){return utils.get(keys,fallback)};cookie.all=function(){return utils.getAllCookies()};cookie.utils=utils;window[ensightenOptions.ns].data.cookie=cookie;return cookie}(document));(function(){var ns=window[ensightenOptions.ns];ns.getIEVersion=function(){if(!(navigator.appName=="Microsoft Internet Explorer"))return-1;var version=navigator.appVersion;return parseInt(version.substr(version.indexOf("MSIE")+4))};ns.getXmlRequestObj=function(URL,onSuccess,onFailure){var version=ns.getIEVersion(),
request;if(version!==-1&&version<10)try{request=new XDomainRequest;request.onload=function(){onSuccess(request.responseText)};request.onerror=function(e){onFailure("http request failed "+request.responseText+" "+e)};request.open("GET",URL);request.send(null);return}catch(e){return onFailure("http request not supported: "+e+" ie version "+version)}else try{request=new XMLHttpRequest;request.open("GET",URL,true);request.onreadystatechange=function(){if(request.readyState!=4)return;var response=request.responseText;
if(request.status!==200){onFailure("http request failed- "+request.status+" "+response);return}onSuccess(response)};request.send(null);return}catch(e){return onFailure("http request not supported: "+e+" ie version "+version)}onFailure("http request not supported")};if(!window.atob)(function(){function t(t){this.message=t}var e="undefined"!=typeof exports?exports:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d";t.prototype=Error(),t.prototype.name="InvalidCharacterError",
e.btoa||(e.btoa=function(e){for(var o,n,a=0,i=r,c="";e.charAt(0|a)||(i="\x3d",a%1);c+=i.charAt(63&o>>8-8*(a%1))){if(n=e.charCodeAt(a+=0.75),n>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|n}return c}),e.atob||(e.atob=function(e){if(e=e.replace(/=+$/,""),1==e.length%4)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,n,a=0,i=0,c="";n=e.charAt(i++);~n&&(o=a%4?64*o+n:n,a++%4)?c+=String.fromCharCode(255&
o>>(6&-2*a)):0)n=r.indexOf(n);return c})})();ns.encodeB64=function(input){var data=input,JSON=window.JSON?window.JSON:ns.JSON;if(!!input&&Object.prototype.toString.call(input)==="[object Object]")data=JSON.stringify(data);if(window.btoa)return btoa(data);else return B64Lib.encode(data)}})();(function(){var _global=window;var _rng;if(typeof require=="function")try{var _rb=require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=
new Uint8Array(16);_rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}var BufferClass=typeof Buffer=="function"?Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];
s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16)buf[i+ii++]=_hexToByte[oct]});while(ii<16)buf[i+ii++]=0;return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],
_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!=null?options.clockseq:_clockseq;var msecs=options.msecs!=null?options.msecs:(new Date).getTime();var nsecs=options.nsecs!=null?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1E4;if(dt<0&&options.clockseq==null)clockseq=clockseq+
1&16383;if((dt<0||msecs>_lastMSecs)&&options.nsecs==null)nsecs=0;if(nsecs>=1E4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928E5;var tl=((msecs&268435455)*1E4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1E4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=
options.node||_nodeId;for(var n=0;n<6;n++)b[i+n]=node[n];return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf)for(var ii=0;ii<16;ii++)buf[i+ii]=rnds[ii];return buf||unparse(rnds)}var uuid=window[ensightenOptions.ns].data.uuidFunc=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;
uuid.unparse=unparse;uuid.BufferClass=BufferClass;if(typeof define==="function"&&define.amd)define(function(){return uuid});else if(typeof module!="undefined"&&module.exports)module.exports=uuid;else uuid.noConflict=function(){return uuid}}).call(this);window[ensightenOptions.ns].data.hppsConfig={hppsURL:"//activate.united.com",profileSync:false};window[ensightenOptions.ns].data.defineEngine("hpps",function(){var ieVersion=window[ensightenOptions.ns].getIEVersion(),ns=window[ensightenOptions.ns];
if(ieVersion!==-1&&ieVersion<8){var funcNames=["set","get","callService","remove","clear","all"];var emptyInterface={};for(k in funcNames)emptyInterface[funcNames[k]]=function(){return ns.when.defer().promise()};return emptyInterface}var cookies=ns.data.getEngine("cookie").utils,localS=ns.data.getEngine("store").utils,JSON=window.JSON?window.JSON:ns.JSON;if(!localS.testStorage())localS={"set":function(){},"get":function(){}};var _private={cache:{},onIDChangeCallbacks:[],profileSyncPromises:{},isPlainObject:function(value){return!!value&&
Object.prototype.toString.call(value)==="[object Object]"},isArray:Array.isArray||function(value){return Object.prototype.toString.call(value)==="[object Array]"},setSessionKey:function(key){var expires="",date=new Date;if(!ns.data.hppsConfig.useLocalStorageSession){if(ns.data.hppsConfig.sessionExpirationSecs){date.setTime(date.getTime()+window[ensightenOptions.ns].data.hppsConfig.sessionExpirationSecs*1E3);expires=date.toGMTString()}cookies.set("ensightenSK",key,{"expires":expires})}else{var exp;
if(ns.data.hppsConfig.sessionExpirationSecs)exp=ns.data.hppsConfig.sessionExpirationSecs;else exp=43200;expires=date.getTime()+exp*1E3;localS.set("_act_sk",expires)}},getSessionKey:function(){if(!ns.data.hppsConfig.useLocalStorageSession)return cookies.get("ensightenSK");else{var sk=localS.get("_act_sk");if(sk&&sk.length>0)try{sk=parseInt(sk);if(sk>(new Date).getTime())return""+sk}catch(e){}return undefined}},dispatchRequest:function(baseUrl,data,onSuccess,onFailure){var request=ns.getXmlRequestObj(_public.hppsURL()+
"?json\x3d"+encodeURIComponent(JSON.stringify(data)),onSuccess,onFailure)},createPromise:function(ajaxFunc,optionalTransformation){var defered=window[ensightenOptions.ns].when.defer();ajaxFunc(_public.hppsURL(),_private.requestData,function(message){if(optionalTransformation)defered.resolve(optionalTransformation(message));else defered.resolve(message)},function(message){defered.reject(message)});return defered.promise},transformViewResult:function(message){var resultSet=JSON.parse(message);var transformed=
{},k,elemName;for(k in resultSet){elemName=resultSet[k].value._elem;transformed[elemName]=_private.createTransformGetResultFunction(elemName)(resultSet[k].value)[elemName]}return transformed},onIdentityChange:function(){for(var i=0;i<_private.onIDChangeCallbacks.length;i++)if(_private.onIDChangeCallbacks[i])_private.onIDChangeCallbacks[i]()},createTransformGetResultFunction:function(keys){return function(message){var data,k,elem;data=_private.isPlainObject(message)?message:JSON.parse(message);if(_private.isArray(data)){var resultObj=
{};for(k in keys)resultObj[keys[k]]=null;for(k in data){if(data[k]===null)continue;elem=data[k]["_elem"];if("_data"in data[k])resultObj[elem]=data[k]._data;else{delete data[k]["_uid"];delete data[k]["_elem"];resultObj[elem]=data[k]}}return resultObj}else{if(data===null)return data;if("_data"in data)data=data._data;else{delete data["_uid"];delete data["_elem"]}}return data}},getProfile:function(oldUID,forceRead){var ns=window[ensightenOptions.ns],sessionKey=_private.getSessionKey(),profile,defered=
ns.when.defer(),args;if(!forceRead&&!oldUID&&sessionKey&&sessionKey.length>1){profile=localS.get(["_act_p"])._act_p;if(profile&&profile!="null"&&profile!="undefined"){try{profile=JSON.parse(profile)}catch(e){try{profile=JSON.parse(_private.isPlainObject(profile)?profile:atob(profile))}catch(e){return defered.reject("Invalid profile string")}}if(profile._actData)profile=_private.isPlainObject(profile._actData)?profile._actData:atob(profile._actData);_private.cache[ns.data.uuid]=profile;if(profile){defered.resolve(profile);
_private.profileSyncPromises[ns.data.uuid]=defered.promise}}else if(!forceRead){defered.reject("No profile found in local storage");return defered.promise}}if(oldUID){profile=localS.get(["_act_p"])._act_p;if(profile&&profile!="null"&&profile!="undefined")args={"oldUID":oldUID};profile=undefined}if(!forceRead&&_private.profileSyncPromises[ns.data.uuid])return _private.profileSyncPromises[ns.data.uuid];_private.profileSyncPromises[ns.data.uuid]=defered.promise;_public.callService("getProfile",args,
true).then(function(data){if(data&&data.length>1){data=JSON.parse(data);_private.setSessionKey((new Date).getTime());if(data._actUid&&data._actData){localS.set("_act_id",data._actUid);ns.data.uuid=data._actUid;localS.set("_act_p",data._actData);_private.cache[ns.data.uuid]=_private.isPlainObject(data._actData)?data._actData:JSON.parse(atob(data._actData));defered.resolve(_private.cache[ns.data.uuid])}else{localS.set("_act_p",data);_private.cache[ns.data.uuid]=_private.isPlainObject(data)?data:JSON.parse(atob(data));
defered.resolve(_private.cache[ns.data.uuid])}_private.onIdentityChange()}else{defered.reject("No profile found in HPPS");_private.setSessionKey((new Date).getTime())}},function(err){defered.reject(err)});return defered.promise},requestData:undefined};var _public={returnsPromise:true,hppsURL:function(){return window[ensightenOptions.ns].data.hppsConfig.hppsURL},registerOnChange:function(onChange){_private.onIDChangeCallbacks.push(onChange)},set:function(key,vals,optionalUID){if(!optionalUID)optionalUID=
window[ensightenOptions.ns].data.uuid;if(_private.isPlainObject(key)){var keys=[],vals=[],k;for(k in key){keys.push(k);if(_private.isPlainObject(key[k]))vals.push(key[k]);else vals.push({"_data":key[k]})}_private.requestData={op:"set",uid:""+optionalUID,elem:keys,val:vals}}else{if(_private.isArray(vals)){var i,l;for(i=0,l=vals.length;i<l;i++)if(!_private.isPlainObject(vals[i]))vals[k]={"_data":vals[i]}}else if(!_private.isPlainObject(vals))vals={"_data":vals};_private.requestData={op:"set",uid:""+
optionalUID,elem:key,val:vals}}return _private.createPromise(_private.dispatchRequest)},get:function(key,optionalUID){if(!optionalUID)optionalUID=window[ensightenOptions.ns].data.uuid;_private.requestData={op:"get",uid:""+optionalUID,elem:key};return _private.createPromise(_private.dispatchRequest,_private.createTransformGetResultFunction(key))},callService:function(serviceOpName,data,includeUID){var sid=cookies.get("_act_id"),data={op:serviceOpName,data:data};if(sid&&sid.length>0)data.manageSID=
sid;if(includeUID)data.uid=window[ensightenOptions.ns].data.uuid;_private.requestData=data;return _private.createPromise(_private.dispatchRequest,function(message){return message})},remove:function(key,optionalUID){if(!optionalUID)optionalUID=window[ensightenOptions.ns].data.uuid;_private.requestData={op:"remove",uid:""+optionalUID,elem:key};return _private.createPromise(_private.dispatchRequest)},clear:function(optionalUID){if(!optionalUID)optionalUID=window[ensightenOptions.ns].data.uuid;_private.requestData=
{op:"clear",uid:""+optionalUID};return _private.createPromise(_private.dispatchRequest)},all:function(optionalUID){if(!optionalUID)optionalUID=window[ensightenOptions.ns].data.uuid;_private.requestData={op:"all",uid:""+_private.uid};return _private.createPromise(_private.dispatchRequest,_private.transformViewResult)},getProfileAttribute:function(attribute){var uid=_public.setUID(),cachedProfile=_private.cache[uid],ns=window[ensightenOptions.ns],defered=ns.when.defer();var getAttributes=function(){if(_private.isArray(attribute)){var i=
0,results=[];for(;i<attribute.length;i++)cachedProfile[attribute[i]]?results.push(cachedProfile[attribute[i]]):results.push(null);defered.resolve(results)}else cachedProfile[attribute]?defered.resolve(cachedProfile[attribute]):defered.resolve(null)};if(cachedProfile)getAttributes();else _private.getProfile().then(function(profile){cachedProfile=_private.cache[ns.data.uuid]=profile;getAttributes()},function(err){defered.reject(err)});return defered.promise},clearIdentity:function(){window[ensightenOptions.ns].data.uuid=
undefined;if(!ns.data.hppsConfig.useLocalStorageSession)cookies.set("ensightenSK","",{expires:-1});else localS.set("_act_sk","");localS.set("_act_id","");localS.set("_act_p",null);_private.cache={};_private.profileSyncPromises={}},getFullProfile:function(){var ns=window[ensightenOptions.ns],uid=ns.data.uuid?ns.data.uuid:_public.setUID(),cachedProfile=_private.cache[uid],defered=ns.when.defer();if(cachedProfile)defered.resolve(cachedProfile);else _private.getProfile().then(function(profile){_private.cache[uid]=
profile;defered.resolve(profile)},function(err){defered.reject(err)});return defered.promise},setProfileAttribute:function(attribute,value){var ns=window[ensightenOptions.ns],defered=ns.when.defer();if(!ns.data.uuid){var uuid=localS.get("_act_id");if(!uuid||uuid.length<1){uuid=ns.data.uuidFunc();localS.set("_act_id",uuid);ns.data.uuid=uuid}}var attributes=[],values=[];if(_private.isPlainObject(attribute))for(var k in attribute){attributes.push(k);values.push(attribute[k])}else if(_private.isArray(attribute)){attributes=
attribute;values=value}else{attributes.push(attribute);values.push(value)}if(!_private.cache[ns.data.uuid])_private.cache[ns.data.uuid]={};for(var i=0;i<attributes.length;i++)_private.cache[ns.data.uuid][attributes[i]]=values[i];_public.callService("setAttribute",{"k":attributes,"v":values},true).then(function(data){var identityWasCleared=!(ns.data.uuid in _private.cache);if(identityWasCleared){defered.reject("no identity found");return}var profile={},localP,k;if(data&&data.length>1){data=JSON.parse(data);
if(data._actUid&&data._actData){localS.set("_act_id",data._actUid);ns.data.uuid=data._actUid;if(ns.data.hppsConfig.obfuscateProfile&&_private.isPlainObject(data._actData))localS.set("_act_p",ns.encodeB64(data._actData));else localS.set("_act_p",data._actData);_private.cache[ns.data.uuid]=_private.isPlainObject(data._actData)?data._actData:JSON.parse(atob(data._actData))}else{for(var i=0;i<attributes.length;i++)profile[attributes[i]]=values[i];ns.data.hppsConfig.obfuscateProfile?localS.set("_act_p",
ns.encodeB64(profile)):localS.set("_act_p",profile);_private.cache[ns.data.uuid]=profile}_private.setSessionKey((new Date).getTime());_private.onIdentityChange()}else{localP=localS.get(["_act_p"])._act_p;if(localP&&localP!="null"&&localP!="undefined")try{profile=JSON.parse(localP)}catch(e){profile=JSON.parse(_private.isPlainObject(localP)?localP:atob(localP))}for(var i=0;i<attributes.length;i++)profile[attributes[i]]=values[i];ns.data.hppsConfig.obfuscateProfile?localS.set("_act_p",ns.encodeB64(profile)):
localS.set("_act_p",profile)}defered.resolve()},function(err){defered.reject(err)});return defered.promise},setUID:function(uuid,initiateMerge){var oldUID,forceRead=false,ns=window[ensightenOptions.ns];if(!uuid&&!ns.data.uuid){uuid=localS.get("_act_id");if(!uuid||uuid.length<1){uuid=ns.data.uuidFunc();localS.set("_act_id",uuid);ns.data.uuid=uuid;return uuid}}else if(uuid){oldUID=localS.get("_act_id");if(oldUID!==uuid)localS.set("_act_id",uuid);else{ns.data.uuid=uuid;_private.getProfile();return}}else{uuid=
localS.get("_act_id");if(!uuid||uuid.length<1){uuid=ns.data.uuid;localS.set("_act_id",uuid)}}ns.data.uuid=uuid;if(!initiateMerge&&oldUID)forceRead=true;if(!initiateMerge)oldUID=undefined;_private.getProfile(oldUID,forceRead);return uuid},getUnstructuredData:function(IDs){return _public.callService("getData",{"IDs":IDs},false)}};if(window[ensightenOptions.ns].data.hppsConfig.profileSync)_public.setUID();window[ensightenOptions.ns].data.hpps=_public;return _public}());Bootstrapper.activateObj={profileData:{},
_getUUID:function(){var cookies=document.cookie,UUID=cookies.indexOf("uuid\x3d")>-1?cookies.substr(cookies.indexOf("uuid\x3d")).split(";")[0].split("\x3d")[1]:"";return UUID},_setUUID:function(){if(Bootstrapper.data.getEngine("store").utils.testStorage()){var syncUUID=Bootstrapper.activateObj._getUUID();if(syncUUID)Bootstrapper.data.hpps.setUID(syncUUID)}}}}},1251456,262015);