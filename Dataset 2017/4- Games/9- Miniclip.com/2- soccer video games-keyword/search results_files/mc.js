var mcAsyncInterval=setInterval(function(){if(document.readyState==="complete"){clearInterval(mcAsyncInterval);if(window.mcAsyncInit&&!window.mcAsyncInit.initialised){window.mcAsyncInit.initialised=true;window.mcAsyncInit()}}},100);var MC=new function(){var a=this;this.appId;this.languageCode;this.height;this.unloadFunctions=[];this._intervals=[];this.init=function(b){a.appId=b.app_id||0;a.languageCode=b.language_code||"en";MC.Proxy.init();MC.Modules.init(b.modules||[]);if(typeof b.header!=="undefined"){MC.Header.init(b.header)}};this.console=function(c,b){if(console&&console[c]){console[c](b)}};this.api=function(f,b){var d="",c={};try{d=f.request||"";c=f.parameters||{}}catch(g){}MC.Proxy.api(d,c,b)};this.resize=function(b){defaults={interval:100,height:150,minHeight:null};if(typeof b==="undefined"){b=defaults}if(!isNaN(b)){MC.console("warn","Deprecated use of MC.resize(), please use MC.resize({interval: %d}) instead",b);b={interval:b}}for(var c in defaults){if(typeof b[c]==="undefined"){b[c]=defaults[c]}}if(typeof a._intervals.resize!=="undefined"){clearInterval(a._intervals.resize)}a._intervals.resize=setInterval(function(){var d=Math.max(b.height,document.body.offsetHeight,document.documentElement.offsetHeight);if(b.minHeight!==null){var d=b.minHeight;MC.Proxy.postMessage("getAvailableHeight",null,null);if(typeof window._resizePostMessageListener==="undefined"){window._resizePostMessageListener=true;window.addEventListener("message",function(f){var e=JSON.parse(f.data);if(e.name=="availableHeight"){var g=parseInt(e.parameters,10);d=Math.max(b.minHeight,g);MC.Proxy.postMessage("resize",{height:d})}})}}else{if(a.height!==d){MC.Proxy.postMessage("resize",{height:d});a.height=d}}},b.interval)};this.login=function(d,b){var c="/dialog/login/"+a.appId+"/"+a.languageCode+"?";if(typeof d==="function"){b=d}if(typeof d==="undefined"||d===null||d.constructor!==Object){d={}}if(typeof d.facebook!=="undefined"){c+="&facebook=1"}else{if(typeof d.register!=="undefined"){c+="&register=1"}}if(typeof d.reload!=="undefined"){c+="&reload=1"}if(typeof d.iu!=="undefined"){c+="&iu="+d.iu}MC.Proxy.open(c,{name:"login",cb:b})};this.logout=function(b){MC.Proxy.open("/dialog/logout/"+a.appId,{name:"logout",cb:b})};this.userStatus=function(c,b){if(typeof c==="undefined"||c===null){if(typeof b==="function"){b(false)}return}MC.Proxy.jsonp("/ajax/loginstatus",{app_id:a.appId,access_token:c},{name:"userStatus",cb:b})};this.registerUnloadFunction=function(d){if(typeof d!=="function"){throw ("registerUnloadFunction only accepts callable params")}var b=a.unloadFunctions.push(d);var c=function(){var f=null;for(var h in a.unloadFunctions){try{var e=a.unloadFunctions[h]();if(typeof e==="string"&&e!==""){f=e}}catch(g){}}if(f!==null){return f}};window.onbeforeunload=c;return b};this.sendUserEvent=function(c,d){var b="/ajax/userEvent";var e=d;e.type=c;jQuery.post(b,e)}};MC.Proxy=new function(){var a=this;this.lightbox=false;this.domain;this.callbacks={};this.objects={};this.init=function(){a.domain=a.getDomain();a.listenerRegister();a.environment(function(b){a.lightbox=b===true})};this.getDomain=function(){if(typeof a.domain!=="undefined"){return a.domain}var b=document.getElementsByTagName("script");var f="//www.miniclip.com";if(b&&b.length>0){for(var d in b){if(b[d].src&&b[d].src.match(/\/js\/mc\.js/)){var c=b[d].src;var e=[];if(c.indexOf("sandbox")>=0){return"//sandbox.miniclip.com"}else{if(c.indexOf("miniclipcdn")>=0){return f}}c=c.replace(/^https?:\/\/(.+)\/js\/mc\.js.*$/,"$1");e=c.split(".");if(e.length>3){e.shift()}return"//"+e.join(".")}}}return f};this.listenerRegister=function(){var c=window.addEventListener?"addEventListener":"attachEvent";var b=c==="attachEvent"?"onmessage":"message";if(c==="attachEvent"){window[c](b,a.listenerTrigger,false)}else{window[c](b,a.listenerTrigger)}};this.listenerTrigger=function(b){if(typeof b.data==="string"){if(b.origin.indexOf("miniclip.com")<0||b.data.indexOf("default")===0){return}try{var c=JSON.parse(b.data);a.callbackTrigger(c.name,c.parameters)}catch(d){}}};this.callbackReigster=function(d){if(typeof d==="undefined"||d===null||d.constructor!==Object){return}var c=typeof d.name!=="undefined"?d.name:null;var b=typeof d.cb!=="undefined"?d.cb:null;if(typeof c==="string"&&typeof b==="function"){a.callbacks[c]=b}};this.callbackTrigger=function(b,c){if(typeof b==="string"&&typeof a.callbacks[b]==="function"){a.callbacks[b](c);delete a.callbacks[b]}};this.postMessage=function(c,d,b){a.callbackReigster(b);parent.postMessage(JSON.stringify({miniclip:true,data:{action:c,parameters:d||{}}}),"*")};this.api=function(d,f,b){if((typeof d!=="string"||d.length<=0)&&typeof b==="function"){return b({error:"No request entered",code:-1})}var c=d+":"+JSON.stringify(f);a.callbackReigster({name:c,cb:b});var e=a.setupEasyXdm(d);e.proxyLocal={postMessage:function(g){var i=typeof g.miniclip!=="undefined"&&g.miniclip===true;var j=typeof g.api!=="undefined"&&g.api===true;var k={},h=null;try{k=typeof g.data!=="undefined"?JSON.parse(decodeURIComponent(g.data)):{};h=a.objects[c]||null}catch(l){}if(i!==true||j!==true&&h!==null){return}h.easyxdm.destroy();a.callbackTrigger(c,k)}};MC.Modules.includeFile("easyxdm.js",{name:"easyXDM",cb:function(){var g=new easyXDM.Rpc(e.options,{remote:{open:{},postMessage:{}},local:e.proxyLocal});a.objects[c]={type:"api",name:c,easyxdm:g};g.postMessage({app_id:MC.appId,method:d,params:f})}})};this.open=function(d,b){a.callbackReigster(b);var c=b.name||d;if(d.indexOf("?")<0){d+="?"}if(a.lightbox===true&&window.top===window.self){console.info("Opening lightbox");a.openLightbox(d)}else{if(a.lightbox===true){console.info("Opening lightbox parent");a.openLightboxParent(c,d)}else{console.info("Opening pop up window");a.openDialog(c,d)}}};this.jsonp=function(c,d,b){a.callbackReigster(b);try{$.ajax({url:a.domain+c,type:"POST",dataType:"JSONP",jsonpCallback:"data",data:d||{}}).done(function(e){a.callbackTrigger(b.name,e)})}catch(f){}};this.environment=function(b){if(window.top===window.self){return b(true)}MC.Proxy.postMessage("environment",null,{name:"environment",cb:b})};this.openLightbox=function(b){b+="&request="+encodeURIComponent(location.protocol+"//"+location.host);console.info("src: ",a.getDomain(),b);Modal.open({header:"Sign in to Miniclip",type:"url",src:a.getDomain()+b,callback:function(c){if(c!==true){location.reload()}}})};this.openLightboxParent=function(b,c){c+="&request="+encodeURIComponent(location.protocol+"//"+location.host);MC.Proxy.postMessage(b,{request:c})};this.openDialog=function(b,c){var d=a.setupEasyXdm(c);d.proxyLocal={postMessage:function(f){var h=typeof f.miniclip!=="undefined"&&f.miniclip===true;var k={},j=null,i={},g=null;try{k=typeof f.data!=="undefined"?JSON.parse(decodeURIComponent(f.data)):{};j=typeof k.action!=="undefined"?k.action:null;i=typeof k.parameters!=="undefined"?k.parameters:{};g=a.objects[j]||null}catch(l){}if(h!==true||g===null){return}clearInterval(g.interval);g.easyxdm.destroy();a.callbackTrigger(j,i)}};MC.Modules.includeFile("easyxdm.js",{name:"easyXDM",cb:function(){var e=new easyXDM.Rpc(d.options,{remote:{open:{},postMessage:{}},local:d.proxyLocal});a.objects[b]={type:"dialog",name:b,window:window.open(d.loadingUrl,d.windowName,"width=500,height=500"),easyxdm:e,interval:setInterval(function(){a.closeDialog(b)},100)};e.open(d.requestUrl,d.windowName)}})};this.closeDialog=function(c){var b=a.objects[c];if(typeof b.window!=="undefined"&&b.window.closed){clearInterval(b.interval);b.easyxdm.destroy();MC.Proxy.callbackTrigger(b.name,{data:{cancelled:true}})}};this.setupEasyXdm=function(b){return{options:{swf:"/easyxdm/easyxdm.swf",remote:"https:"+a.domain+"/dialog/arbiter/"+MC.appId+"/"+MC.languageCode+"?request="+encodeURIComponent(location.protocol+"//"+location.host)},windowName:"MiniclipDialog",requestUrl:"https:"+a.domain+(b||""),loadingUrl:"https:"+a.domain+"/dialog/loading"}}};MC.Modules=new function(){var a=this;this.domain;this.valid="share,currency,social,leaderboard,challenge";this.included={};this.files={};this.init=function(b){a.domain=a.getDomain();a.load(b)};this.getDomain=function(){if(typeof a.domain!=="undefined"){return a.domain}var b=document.getElementsByTagName("script");var c="//static.miniclipcdn.com";if(b&&b.length>0){for(var e in b){if(b[e].src&&b[e].src.match(/\/js\/mc\.js/)){var d=b[e].src.replace(/https?:\/\/(.+)\/js\/mc\.js.*$/,"$1");var f=d.split(".");if(f.length>3){f.shift()}return"//"+f.join(".")}}}return c};this.load=function(b,e){if(b.constructor!==Array){throw"The modules parameter must be an array"}var d;for(var c in b){if(b.hasOwnProperty(c)){d=b[c].toLowerCase();if(typeof e==="undefined"&&a.valid.indexOf(d)<0){MC.console("warn",'Module "'+d+'" is not a valid');continue}a.include(d)}}};this.include=function(b){a.included[b]=true;if(typeof(window.MC[b.charAt(0).toUpperCase()+b.slice(1)])!=="undefined"){MC.console("warn",'Module "'+b+'" already exists');return}a.includeFile(b.replace(/\./g,"/").toLowerCase()+".js")};this.includeFile=function(f,c){MC.Proxy.callbackReigster(c);if(typeof a.files[f]!=="undefined"){a.callbackTrigger(c);return}a.files[f]=true;var b=document.querySelector("body");var d=document.createElement("script");var e=b.dataset?b.dataset.scriptVersion:0;d.src=a.getDomain()+"/js/"+f+"?"+e;d.onload=a.callbackTrigger(c);b.appendChild(d)};this.callbackTrigger=function(c){if(typeof c==="undefined"){return}var e=0,d=1;var b=setInterval(function(){e+=d;try{if(typeof window[c.name]!=="undefined"){clearInterval(b);MC.Proxy.callbackTrigger(c.name)}}catch(f){}if(e>=5000){clearInterval(b);MC.console("error",'Object "'+c.name+'" took too long to load')}},d)}};MC.Header=new function(){var a=this;this.theme;this.init=function(b){a.theme=b.theme||"light";a.script_version=b.script_version||"1";a.css_version=b.css_version||"1";a.include()};this.include=function(){a.css();a.html()};this.css=function(){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",MC.Modules.getDomain()+"/css/mc.css?"+a.css_version);document.getElementsByTagName("head")[0].appendChild(b)};this.html=function(){var b=false,d="mc-header";var c=document.getElementById(d);if(c===null){b=true;c=document.createElement("div")}c.id=d;c.className="miniclip-global-header miniclip-global-header-"+a.theme;c.innerHTML='<div class="container"> '+a.sectionMain()+"</div>";if(b===true){document.body.insertBefore(c,document.body.firstChild)}};this.sectionMain=function(){return'<section id="miniclip-global-main" class="section section-main">            <a href="'+MC.Proxy.getDomain()+'" class="logo"></a>        </section>'}};