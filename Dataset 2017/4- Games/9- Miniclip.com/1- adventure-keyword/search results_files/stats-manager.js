var StatsManager=function(){var a=this;this._ecommerceLoaded=false;this._settings;this._persistant_data={local:{ad_refresh_called:{}},google:{}};this.init=function(b){a._settings=b;(function(f,h,l,k,j,e,d){f.GoogleAnalyticsObject=j;f[j]=f[j]||function(){(f[j].q=f[j].q||[]).push(arguments)},f[j].l=1*new Date();e=h.createElement(l),d=h.getElementsByTagName(l)[0];e.async=1;e.src=k;d.parentNode.insertBefore(e,d)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");var c={cookieDomain:".miniclip.com",legacyCookieDomain:".miniclip.com"};if(typeof a._settings.ua_client_id!=="undefined"){c.clientId=a._settings.ua_client_id}ga("create",a._settings.ua_account_number,c);ga("require","displayfeatures");jQuery(function(){if(typeof MC!=="undefined"){MC.registerUnloadFunction(a._destructProceedure)}})};this._setUaUnloadParam=function(b){if(typeof a._settings.disabled_trackers[b.tracker]=="undefined"){a._persistant_data.google[b.index]=b.value}};this._sendToUA=function(b){if(typeof a._settings.disabled_trackers[b.tracker]=="undefined"){ga("send",b.ga_data)}};this._destructProceedure=function(){var b={};b.tracker="not_a_tracker";b.ga_data=a._persistant_data.google;b.ga_data.hitType="event";b.ga_data.eventCategory="Data";b.ga_data.eventAction="LogData";a._sendToUA(b)};this._ecommerceModule=function(){if(a._ecommerceLoaded===false){ga("require","ec");a._ecommerceLoaded=true}};this._appendHashData=function(c,g){var f={H:"Homepage",C:"Category Page",G:"Game Page",P:"Page",S:"Search Pages",U:"User Pages",V:"Video Pages"};var b=g.split("-");var e=b.length;var d=b[(e-1)];if(typeof f[d]!=="undefined"){d=f[d];c.dimension12=d;delete b[(e-1)]}g=b.join("-");g=g.replace(/-+$/,"");c.dimension13=g;return c};this.trackerPageview=function(){var d={};var b=a._settings.pageview_data;if(a._settings.page!="undefined"){b.page=a._settings.page}if(window.location.hash!=""&&window.location.hash.substring(0,3)==="#t-"){b.page=(window.location.pathname+window.location.search+window.location.hash);b=a._appendHashData(b,window.location.hash)}if(a._settings.page_prefix!=""){if(typeof b.page!="undefined"){b.page=a._settings.page_prefix+b.page}else{b.page=a._settings.page_prefix+"/"}}var c=JSON.parse(JSON.stringify(b));for(index in c){if(index.substr(0,6)=="metric"){delete c[index]}}ga("set",c);b.hitType="pageview";d.tracker="Pageview";d.ga_data=b;a._sendToUA(d)};this.trackerGameTimePlayed=function(b){var f={};var c="dimension10";var d;var e=0;if(typeof a._persistant_data.local[c]!="undefined"){if(b>a._persistant_data.local[c]){e=a._persistant_data.local[c]+(b-a._persistant_data.local[c])}else{e=a._persistant_data.local[c]+b}}else{e=b}a._persistant_data.local[c]=e;if(e<=1){d="a. 0-1"}if(e>1&&e<=2){d="b. 1-2"}if(e>2&&e<=5){d="c. 2-5"}if(e>5&&e<=10){d="d. 5-10"}if(e>10&&e<=120){upper_bound=(Math.ceil(e/10)*10);lower_bound=(upper_bound-10);d=String.fromCharCode(99+(upper_bound/10))+". "+lower_bound+"-"+upper_bound}if(e>120){d="p. 120+"}f.tracker="GameTimePlayed";f.index=c;f.value=d;a._setUaUnloadParam(f);f.index="metric3";f.value=1;a._setUaUnloadParam(f);f.index="metric4";f.value=e*60;a._setUaUnloadParam(f)};this.trackerGameLoadTime=function(c){var d={};var b="dimension16";a._persistant_data.local[b]=c;d.tracker="GameLoadTime";d.index="metric5";d.value=c*60;a._setUaUnloadParam(d)};this.trackerAdblockUser=function(b){ga("send","event","HasAdblock",b?"Yes":"No",{nonInteraction:1})};this.trackerBrowserFeatures=function(c){for(var b in c){if(c.hasOwnProperty(b)){ga("send","event","BrowserFeatures",b,c[b],{nonInteraction:1})}}};this.trackerGameState=function(b){var c={};c.tracker="GameState";c.index="dimension11";c.value=b;a._setUaUnloadParam(c)};this.trackerPrerollShown=function(){var d={};var b="metric2";var c=0;if(typeof a._settings.ad_values!=="undefined"&&typeof a._settings.ad_values.preroll!=="undefined"){if(typeof a._persistant_data.local[b]!=="undefined"){c=a._persistant_data.local[b]+a._settings.ad_values.preroll}else{c=a._settings.ad_values.preroll}a._persistant_data.local[b]=c;d.tracker="PrerollShown";d.index=b;d.value=c;a._setUaUnloadParam(d)}else{console.log("Preroll tracking can only be called from game pages")}console.log("value: "+c)};this.trackerAdRefresh=function(d){var e={};var b="metric2";var c=0;if(typeof a._settings.ad_values!=="undefined"&&typeof a._settings.ad_values[d]!=="undefined"){if(typeof a._persistant_data.local.ad_refresh_called[d]!=="undefined"){if(typeof a._persistant_data.local[b]!=="undefined"){c=a._persistant_data.local[b]+a._settings.ad_values[d]}else{c=a._settings.ad_values[d]}a._persistant_data.local[b]=c;e.tracker="AdRefresh";e.index=b;e.value=c;a._setUaUnloadParam(e)}else{a._persistant_data.local.ad_refresh_called[d]=true}}else{console.log("ad refresh tracking can only be called from game pages")}};this.trackerSocialEngagement=function(b,c,d){var e={};e.tracker="SocialEngagement";e.ga_data={};e.ga_data.hitType="social";e.ga_data.socialNetwork=b;e.ga_data.socialAction=c;e.ga_data.socialTarget=d;a._sendToUA(e)};this.trackerSearchAccuracy=function(c){if((c<7&&c>0)||c=="more results button"||c=="search button"){var b={};b.tracker="SearchAccuracy";b.index="dimension14";b.value=c;a._setUaUnloadParam(b)}};this.trackerLeaderboard=function(b){if(b==="score_save"){if(typeof(a._persistant_data.local.leaderboard_score_saves)==="undefined"){a._persistant_data.local.leaderboard_score_saves=1}else{a._persistant_data.local.leaderboard_score_saves++}var c={};c.tracker="Leaderboard";c.index="metric6";c.value=a._persistant_data.local.leaderboard_score_saves;a._setUaUnloadParam(c)}};this.ecommerceAddTransaction=function(b){if(typeof(b.id)=="undefined"){b.id=0}if(typeof(b.site_category)=="undefined"){b.site_category=""}if(typeof(b.revenue)=="undefined"){b.revenue=0}if(typeof(b.shipping)=="undefined"){b.shipping=0}if(typeof(b.commission)=="undefined"){b.commission=0}b.tax=b.commission;b.affiliation=b.site_category;if(b.id==0){throw"The transactionid must be provided"}else{a._ecommerceModule();ga("ecommerce:addTransaction",{id:b.id,affiliation:b.affiliation,revenue:b.revenue,shipping:b.shipping,tax:b.tax})}};this.ecommerceAddItem=function(b){if(typeof(b.id)=="undefined"){b.id=0}if(typeof(b.name)=="undefined"){b.name=""}if(typeof(b.sku)=="undefined"){b.sku=0}if(typeof(b.category)=="undefined"){b.category=0}if(typeof(b.price)=="undefined"){b.price=0}if(typeof(b.quantity)=="undefined"){b.quantity=0}if(b.id==0||b.name==""){throw"The item id and name are both required params."}else{a._ecommerceModule();ga("ec:addProduct",{id:b.id,name:b.name,category:b.category,brand:b.gameName,price:b.price,quantity:b.quantity})}};this.enableEcommerce=function(b){$(".ec-track-impression").each(function(){var c=$(this).data("ec-json");a.ecommerceAddImpression(c)});$(".ec-track-product-click").click(function(f){f.stopImmediatePropagation();f.stopPropagation();var c=$(this);var d=$(this).data("ec-json");a.ecommerceAddProductClick(d,function(g){window.location=c.attr("href")});return false})};this.ecommerceCheckout=function(b){ga("ec:addProduct",{id:b.id,name:b.name,category:b.category,brand:b.brand,price:b.price,quantity:1});ga("ec:setAction","add");ga("send","event","UX","click","add to cart");ga("ec:addProduct",{id:b.id,name:b.name,category:b.category,brand:b.brand,price:b.price,quantity:1});ga("ec:setAction","checkout",{option:b.paymentMethod})};this.ecommerceAddProductClick=function(b,c){ga("ec:addProduct",{id:b.id,name:b.name,category:b.category,brand:b.brand,price:b.price,quantity:1});ga("ec:setAction","click",{list:b.list});ga("send","event","UX","click","Results",{hitCallback:function(){console.log("click ended");c()}})};this.ecommerceTransaction=function(b){ga("ec:addProduct",{id:b.id,name:b.name,category:b.category,brand:b.brand,price:b.price,quantity:1});ga("ec:setAction","purchase",{id:b.transactionId,affiliation:b.affiliation,revenue:b.revenue})};this.ecommerceRemoveProduct=function(c,b,d){ga("ec:addProduct",{id:c.id,name:c.name,category:c.category,brand:c.brand,price:c.price,quantity:1});ga("ec:setAction","remove");ga("send","event","UX","click",b,{hitCallback:function(){d()}})};this.ecommerceAddImpression=function(b){a._ecommerceModule();ga("ec:addImpression",{id:b.id,name:b.name,category:b.category,list:b.list,position:b.position,price:b.price})};this.trackerFriends=function(b){var c={};if(b!==""){var d=false;c.tracker="Friends";c.ga_data={};c.ga_data.hitType="event";c.ga_data.eventCategory="User";switch(b){case"block":c.ga_data.eventAction=c.tracker+" - Block";break;case"add":c.ga_data.eventAction=c.tracker+" - Add";break;case"remove":c.ga_data.eventAction=c.tracker+" - Remove";break;case"unblock":c.ga_data.eventAction=c.tracker+" - Unblocked";break;default:d=true}if(d!==true){a._sendToUA(c)}}};this.trackerChallenges=function(b){var c={};if(b!==""){var d=false;c.tracker="Challenges";c.ga_data={};c.ga_data.hitType="event";c.ga_data.eventCategory="User";c.ga_data.eventLabel="Miniclip Website";switch(b){case"newChallenge":c.ga_data.eventAction=c.tracker+" - New Challenge";break;case"accept":c.ga_data.eventAction=c.tracker+" - Accept";break;case"reject":c.ga_data.eventAction=c.tracker+" - Reject";break;case"rematch":c.ga_data.eventAction=c.tracker+" - Rematch";break;default:d=true}if(d!==true){a._sendToUA(c)}}};this.trackerStream=function(b){var c={};if(b!==""){var d=false;c.tracker="Stream";c.ga_data={};c.ga_data.hitType="event";c.ga_data.eventCategory="User";switch(b){case"ticker-pause":c.ga_data.eventAction=c.tracker+" - TickerPause";break;case"ticker-play":c.ga_data.eventAction=c.tracker+" - TickerPlay";break;default:d=true}if(d!==true){a._sendToUA(c)}}};this.trackerPoints=function(b){var c={};if(b!==""){var d=false;c.tracker="Points";c.ga_data={};c.ga_data.hitType="event";c.ga_data.eventCategory="User";switch(b){case"reputation-button-not-logged-in":c.ga_data.eventAction=c.tracker+" - ReputationButtonNotLoggedIn";break;case"reputation-button-logged-in":c.ga_data.eventAction=c.tracker+" - ReputationButtonLoggedIn";break;case"reputation-button":c.ga_data.eventAction=c.tracker+" - ReputationButton";break;case"notification-levelup":c.ga_data.eventAction=c.tracker+" - NotificationLevelUp";break;case"notification-earned-experience-award":c.ga_data.eventAction=c.tracker+" - NotificationEarnedExperienceAward";break;case"notification-earned-reputation-like":c.ga_data.eventAction=c.tracker+" - NotificationEarnedReputationLike";break;case"notification-earned-reputation-registration":c.ga_data.eventAction=c.tracker+" - NotificationEarnedReputationRegistration";break;case"notification-earned-experience-first-gameplay":c.ga_data.eventAction=c.tracker+" - NotificationEarnedExperienceFirstGameplay";break;case"notification-earned-experience-challenge":c.ga_data.eventAction=c.tracker+" - NotificationEarnedExperienceChallenge";break;case"toaster-earned-experience-levelup":c.ga_data.eventAction=c.tracker+" - ToasterEarnedExperienceLevelUp";break;case"toaster-earned-experience-award":c.ga_data.eventAction=c.tracker+" - ToasterEarnedExperienceAward";break;case"toaster-earned-reputation-like":c.ga_data.eventAction=c.tracker+" - ToasterEarnedReputationLike";break;case"toaster-earned-reputation-registration":c.ga_data.eventAction=c.tracker+" - ToasterEarnedReputationRegistration";break;case"toaster-earned-experience-first-gameplay":c.ga_data.eventAction=c.tracker+" - ToasterEarnedExperienceFirstGameplay";break;case"toaster-earned-experience-challenge":c.ga_data.eventAction=c.tracker+" - ToasterEarnedExperienceChallenge";break;default:d=true}if(d!==true){a._sendToUA(c)}}};this.trackerFriendsInvite=function(c,b,e){var d={};if(c!==""){var f=false;d.tracker="FriendsEmailInvite";d.ga_data={};d.ga_data.hitType="event";d.ga_data.eventCategory="User";d.ga_data.eventLabel="Miniclip Website";switch(c){case"send_email":if(e=="emailInvite"){d.ga_data.eventAction=d.tracker+" - provider:Email"}else{if(e=="gmailInvite"){d.ga_data.eventAction=d.tracker+" - provider:Gmail"}else{d.ga_data.eventAction=d.tracker+" - provider:Unknown"}}d.ga_data.metric7=b;break;default:f=true}if(f!==true){a._sendToUA(d)}}};this.trackerTeams=function(b){var c={};if(b!==""){var d=false;c.tracker="Teams";c.ga_data={};c.ga_data.hit_type="event";c.ga_data.eventCategory="User";switch(b){case"created":c.ga_data.eventAction=c.tracker+" - Created";break;case"invited":c.ga_data.eventAction=c.tracker+" - InvitedUser";break;case"accepted":c.ga_data.eventAction=c.tracker+" - AcceptedInvite";break;case"declined":c.ga_data.eventAction=c.tracker+" - DeclinedInvite";break;case"left":c.ga_data.eventAction=c.tracker+" - Left";break;default:d=true}if(d!==true){a._sendToUA(c)}}};this.trackerSubmit=function(b){var c={};if(b!==""){var d=false;c.tracker="Dialog";c.ga_data={};c.ga_data.hit_type="event";c.ga_data.eventCategory="User";switch(b){case"loginSubmit":c.ga_data.eventAction=c.tracker+" - Login Submit";break;case"loginError":c.ga_data.eventAction=c.tracker+" - Login Error";break;case"loginFinished":c.ga_data.eventAction=c.tracker+" - Login Successful";break;case"userSignup":c.ga_data.eventAction=c.tracker+" - User Signed-up";break;case"userSignupByInvite":c.ga_data.eventAction=c.tracker+" - User Signed-up by invitation";break;case"userLogin":c.ga_data.eventAction=c.tracker+" - Exisiting User";break}if(d!==true){a._sendToUA(c)}}};this.ecommerceSetCurrency=function(b){a._ecommerceModule();ga("set","&cu",b)};this.ecommerceAddProduct=function(b){a._ecommerceModule();ga("ec:addProduct",{id:b.id,name:b.name,brand:b.brand,variant:b.variant,price:b.price,quantity:b.quantity})};this.ecommerceSendData=function(){a._ecommerceModule()};this.trackEvent=function(c,e,b,d){var f={};f.tracker=c;f.ga_data={hitType:"event",eventCategory:c,eventAction:e};if(b){f.ga_data.label=b}if(d){f.ga_data.value=d}a._sendToUA(f)};return{init:this.init,ecommerceSetCurrency:this.ecommerceSetCurrency,ecommerceSendData:this.ecommerceSendData,ecommerceAddProduct:this.ecommerceAddProduct,ecommerceAddTransaction:this.ecommerceAddTransaction,ecommerceAddItem:this.ecommerceAddItem,ecommerceAddImpression:this.ecommerceAddImpression,trackerSocialEngagement:this.trackerSocialEngagement,trackerPageview:this.trackerPageview,trackerGameTimePlayed:this.trackerGameTimePlayed,trackerGameLoadTime:this.trackerGameLoadTime,trackerGameState:this.trackerGameState,trackerSearchAccuracy:this.trackerSearchAccuracy,trackerPrerollShown:this.trackerPrerollShown,trackerAdRefresh:this.trackerAdRefresh,trackerFriends:this.trackerFriends,trackerFriendsInvite:this.trackerFriendsInvite,trackerChallenges:this.trackerChallenges,trackerStream:this.trackerStream,trackerPoints:this.trackerPoints,trackerSubmit:this.trackerSubmit,trackerTeams:this.trackerTeams,trackerLeaderboard:this.trackerLeaderboard,trackerAdblockUser:this.trackerAdblockUser,trackerBrowserFeatures:this.trackerBrowserFeatures,enableEcommerce:this.enableEcommerce,ecommerceCheckout:this.ecommerceCheckout,ecommerceTransaction:this.ecommerceTransaction,ecommerceRemoveProduct:this.ecommerceRemoveProduct,trackEvent:this.trackEvent}};