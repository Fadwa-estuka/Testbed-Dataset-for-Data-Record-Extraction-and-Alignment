MC.Currency.Miniclip=new function(){this._payment_modal=null;this._credits_iframe=null;this._old=false;this._initModal=function(){$("#payment-modal").remove();if(this._payment_modal===null){var c=$("#game-container").hasClass("webgame")?($("#game-container").find("> div").width()/2):475;var a=$("#game-container").hasClass("webgame")?($("#game-container").find("> div").height()/2):275;this._payment_modal=$("<div/>").attr("id","payment-modal").css({zIndex:999,position:"fixed",top:"35%",left:"50%",margin:"-"+a+"px 0 0 -"+c+"px"})}if(this._credits_iframe===null){var b=570;if(typeof $("#buy-credits").data("window-height")!=="undefined"&&$("#buy-credits").data("window-height")>0){b=$("#buy-credits").data("window-height")}this._credits_iframe=$("<iframe/>").attr({id:"credits_iframe",scrolling:"yes"}).css({width:950,height:870})}};this.showTopup=function(a){if(typeof a.source_id==="undefined"&&typeof a.game_id==="undefined"){if(typeof game_data!=="undefined"&&typeof game_data.game_id!=="undefined"){a.game_id=game_data.game_id}}this._openWindow(this._windowUrl(a,"topup"));if(MC.Currency._game_type==="flash"){if(typeof MC.Currency._game_obj[0]!=="undefined"&&typeof MC.Currency._game_obj[0].notifyBundleWindowOpened!=="undefined"){if(this._old===true){MC.Currency._game_obj[0].notifyTopupWindowOpen()}else{MC.Currency._game_obj[0].notifyTopupWindowOpened()}}}else{if(MC.Currency._game_type==="unity"){MC.Currency._game_obj.invokeService("notifyTopupWindowOpen",null)}}};this.purchaseBundle=function(a){this._openWindow(this._windowUrl(a,"currency"));if(MC.Currency._game_type==="flash"){if(typeof MC.Currency._game_obj[0]!=="undefined"&&typeof MC.Currency._game_obj[0].notifyBundleWindowOpened!=="undefined"){MC.Currency._game_obj[0].notifyBundleWindowOpened()}}else{if(MC.Currency._game_type==="unity"){MC.Currency._game_obj.invokeService("notifyBundleWindowOpened",null)}}};this.purchaseItem=function(a){this._openWindow(this._windowUrl(a,"item"));if(MC.Currency._game_type==="flash"){if(typeof MC.Currency._game_obj[0]!=="undefined"&&typeof MC.Currency._game_obj[0].notifyItemWindowOpened!=="undefined"){MC.Currency._game_obj[0].notifyItemWindowOpened()}if(typeof MC.Currency._game_obj[0]!=="undefined"&&typeof MC.Currency._game_obj[0].notifyItemWindowClosed!=="undefined"){MC.Currency._game_obj[0].notifyItemWindowClosed({success:false,result:this._params})}}};this._windowUrl=function(e,b){if(typeof e==="undefined"){e={}}if(typeof document.affiliation!="undefined"){e.affiliation=document.affiliation}e.type=b;if(e.old===true){this._old=true}if($("#game-container").hasClass("webgame")){e.webmaster="true"}if(typeof e.currency_id!="undefined"){e.payment_currency_id=e.currency_id;delete e.currency_id}this._params=e;var d=this._getPaymentsDomain();var f=this._getLanguage()?this._getLanguage():"en";var d=this._getPaymentsDomain();var c="//"+d+"/currency/"+f+"/";if(typeof(e.type)!="undefined"&&e.type==="topup"){c+="bundles/?"}else{c+="purchase/?"}for(var a in e){c+=a+"="+e[a]+"&"}return c};this._getLanguage=function(){var a="language_code";var b="; "+document.cookie;var c=b.split("; "+a+"=");if(c.length==2){return c.pop().split(";").shift()}};this._getPaymentsDomain=function(){var a;if((typeof(window.app_env)!="undefined"&&window.app_env==="development")||window.location.host.indexOf("stag.miniclip.com")!==-1){a="payments."+window.location.host}else{a="payments.miniclip.com"}return a};this._openWindow=function(c){this._initModal();if(MC.Currency._game_type!=="none"){this._hideGame()}if(typeof this._params.game_id==="undefined"&&typeof this._params.source_id==="undefined"){alert("There has been a problem with the purchase window, please reload the page");this._showGame();return false}this._credits_iframe.attr("src",c);this._payment_modal.append(this._credits_iframe);$("#screen-overlay").fadeIn(250);$("body").prepend(this._payment_modal);var b=$("#game-container").width();var e=$("#game-container").height();var a=$("#game-container").length>0?$("#game-container").offset().top+((e-425)/2):0;var d=846-(b/2);if($("#game-container").hasClass("webgame")){b=$("#game-container").find("> div").width();e=$("#game-container").find("> div").height();this._credits_iframe.css({width:b,height:e});this._credits_iframe.load(function(){var h=$(this).contents();h.find(".buy-content").height(e);var f=h.find(".buy-content");var g=f.height()-f.find("header").outerHeight();h.find("#payment_window").height(g)})}};this._hideWindow=function(b,a){this._payment_modal.remove();$("#screen-overlay").fadeOut(250);if(MC.Currency._game_type==="flash"&&typeof MC.Currency._game_obj[0]!=="undefined"){this._hideWindowFlash(b,a)}else{if(MC.Currency._game_type==="unity"){this._hideWindowUnity(b,a)}}this._showGame()};this._hideWindowFlash=function(b,a){switch(this._params.type){case"topup":if(this._old===true&&typeof MC.Currency._game_obj[0].notifyTopupWindowClose!=="undefined"){MC.Currency._game_obj[0].notifyTopupWindowClose({success:b,result:a})}else{if(typeof MC.Currency._game_obj[0].notifyTopupWindowClosed!=="undefined"){MC.Currency._game_obj[0].notifyTopupWindowClosed({success:b,result:this._params})}}break;case"currency":if(typeof MC.Currency._game_obj[0].notifyBundleWindowClosed!=="undefined"){MC.Currency._game_obj[0].notifyBundleWindowClosed({success:b,result:this._params})}break;case"item":if(typeof this._game_obj[0].notifyItemWindowClosed!=="undefined"){MC.Currency._game_obj[0].notifyItemWindowClosed({success:b,result:this._params})}break}};this._hideWindowUnity=function(b,a){switch(this._params.type){case"topup":if(this._old===true){MC.Currency._game_obj.invokeService("notifyTopupWindowClose",{success:b,result:a})}else{MC.Currency._game_obj.invokeService("notifyTopupWindowClosed",{success:b,result:this._params})}break;case"currency":MC.Currency._game_obj.invokeService("notifyBundleWindowClosed",{success:b,result:this._params});break;case"item":MC.Currency._game_obj.invokeService("notifyItemWindowClosed",{success:b,result:this._params});break}};this._hideGame=function(){switch(MC.Currency._game_type){case"shockwave":MC.Currency._game_obj.css("visibility","hidden !important");break;case"flash":if(this._isIE()){MC.Currency._game_obj.css("left","-900px")}else{MC.Currency._game_obj.css("visibility","hidden")}break;default:MC.Currency._game_obj.hideAllObjects();break}if(this._params.game_id==2471){if(this._isIE()==false){this._showBackground()}}};this._showBackground=function(){var d="data:image/jpeg;base64,"+MC.Currency._game_obj[0].actionExportScreenshot();var b=$("<img/>").attr("id","game-background-img").attr("width","750px").attr("height","520").attr("src",d);var c=$("<div/>").attr("id","game-background").css("position","relative");var a=$("<div/>").attr("id","game-background-panel").css({position:"absolute",width:750,height:520});$(a).append(b);$(c).append(a);$("#game-container #game-embed").before(c)};this._showGame=function(){switch(MC.Currency._game_type){case"shockwave":MC.Currency._game_obj.css("visibility","visible !important");break;case"flash":if(this._isIE()){MC.Currency._game_obj.css("left","0px")}else{MC.Currency._game_obj.css("visibility","visible")}break;default:MC.Currency._game_obj.showAllObjects();break}$("#game-background").remove()};this._isIE=function(){if(navigator.userAgent.indexOf("MSIE")!==-1){return true}if(navigator.appName=="Netscape"&&navigator.userAgent.indexOf("Trident")!==-1){return true}return false}};