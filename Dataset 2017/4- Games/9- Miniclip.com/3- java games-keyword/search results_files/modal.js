var Modal=new function(){var a=this;this.eventMethodAdd=window.addEventListener?"addEventListener":"attachEvent";this.eventMethodRemove=window.removeEventListener?"removeEventListener":"detachEvent";this.eventMessage=!window.addEventListener||!window.removeEventListener?"onmessage":"message";this.modal=$("<div/>").addClass("mc-modal");this.modalDialog=$("<div/>").addClass("mc-modal-dialog");this.modalContent=$("<div/>").addClass("mc-modal-content");this.modalHeader=$("<div/>").addClass("mc-modal-header");this.modalBody=$("<div/>").addClass("mc-modal-body");this.modalClose=$("<span/>").addClass("mc-close");this.modalCallback=null;this.frameHeight=0;this.domain;this.init=function(){a.actions()};this.actions=function(){$(window).on("resize",function(){a.resize(a.frameHeight)});$("body").on("click",".mc-modal .mc-close",function(){a.close(true);return false})};this.getDomain=function(){if(typeof a.domain!=="undefined"){return a.domain}var b=document.getElementsByTagName("script");var c="//static.miniclipcdn.com";if(b&&b.length>0){for(var e in b){if(b[e].src&&b[e].src.match(/\/js\/mc\.js/)){var d=b[e].src.replace(/https?:\/\/(.+)\/js\/mc\.js.*$/,"$1");var f=d.split(".");if(f.length>3){f.shift()}return"//"+f.join(".")}}}return c};this.open=function(b){if(typeof b==="undefined"||b===null||b.constructor!==Object){throw"Incorrect data format for modal"}switch(b.type){case"url":a.url(b.src);break;case"content":a.content(b.html);break;default:throw"Modal type not set"}a.header(b.header||null);a.callback(b.callback||null);a.build()};this.close=function(b){a.listenerRemove();if(typeof a.modalCallback==="function"){a.modalCallback(b===true)}a.modalCallback=null;$(".mc-modal").remove();return false};this.header=function(b){a.modalHeader.html("");if(typeof b==="string"){a.modalHeader.html('<h1 class="title">'+b+"</h1>")}};this.callback=function(b){a.modalCallback=typeof b==="function"?b:null};this.url=function(c){var b=$("<iframe/>").addClass("mc-modal-iframe").attr({hidden:true,frameBorder:0,src:c}).load(function(){$(".mc-modal-loading").remove();b.show()});a.loading();a.listenerAdd();a.modalBody.append(b)};this.content=function(b){a.modalBody.append(b)};this.loading=function(){var b=$("<div/>").addClass("mc-modal-loading").html('<img src="'+a.getDomain()+'/images/loading/waiting64.gif" alt="Loading">');a.modalBody.html(b)};this.build=function(){a.modalHeader.append(a.modalClose.html('<a href="#">&times;</a>'));a.modalContent.append(a.modalHeader).append(a.modalBody);a.modalDialog.append(a.modalContent);a.modal.append(a.modalDialog);$("body").append(a.modal)};this.listenerAdd=function(){if(a.eventMethodAdd==="attachEvent"){window[a.eventMethodAdd](a.eventMessage,a.listener,false)}else{window[a.eventMethodAdd](a.eventMessage,a.listener)}};this.listenerRemove=function(){if(a.eventMethodRemove==="detachEvent"){window[a.eventMethodRemove](a.eventMessage,a.listener,false)}else{window[a.eventMethodRemove](a.eventMessage,a.listener)}};this.listener=function(d){var k={},b=false,h=false,j=false;try{k=JSON.parse(d.data);b=typeof k.miniclip!=="undefined"&&k.miniclip===true;h=typeof k.modal!=="undefined"&&k.modal===true;j=typeof k.close!=="undefined"&&k.close===true}catch(g){}if(b!==true||h!==true){return}var f=typeof k.data!=="undefined"?k.data:{};var c=typeof f.action!=="undefined"?f.action:null;var i=typeof f.parameters!=="undefined"?f.parameters:{};if(typeof a[c]==="function"){a[c](i)}if(j===true){a.close()}};this.resize=function(b){var d=$(".mc-modal-iframe");var f=d.position()||{};var g=window.innerHeight||document.documentElement.clientHeight;var c=g-((f.top||0)+$(".mc-modal-header").outerHeight(true));var e=100;a.frameHeight=b;if(!isNaN(b)&&b<=c){e=b}else{if(!isNaN(b)&&b>c){e=c}}d.height(e)}};$(document).ready(function(){Modal.init()});