/***************************************
* @preserve
* ForeSee Client Code: record
* Built January 26, 17 16:47:41
* Code version: 19.2.0
* Template version: 19.2.0
***************************************/
("undefined"!=typeof _fsDefine?_fsDefine:define)(["require","_acs",_acsNormalizeUrl("cxreplay/fs.utils.v2.js"),"recordconfig"],function(t,e,i,r){function s(){this.initialize.apply(this,arguments)}var n={_trackers:[]};n.Tracker=function(t,e,r,s,o,a){this.recorder=t,this.throttleTime=s,this.recFunction=o,this.subject=e,a||this._capture({},e),i.Bind(e,r,function(t,e){return function(i){t._capture&&t._capture(i,e),i=null,e=null}}(this,e)),n._trackers.push(this),e=null,t=null,r=null,o=null},n.Tracker.prototype.merge=function(t,e,r,s){i.Bind(e,r,function(t,e,i){return function(r){t._capture&&t._capture(r,e,i)}}(this,e,t)),t=null,r=null,s=null},n.Tracker.prototype._capture=function(t,e,r){clearTimeout(this.lastCapThrottle);var s=r||this.recorder;if(!this.lastCap||i.now()-this.lastCap>this.throttleTime)this.recFunction.call(this,t,e,s),this.lastCap=i.now();else{var n={};for(var o in t)6==o.length&&"layerX"!=o&&"layerY"!=o&&(n[o]=t[o]);this.lastCapThrottle=setTimeout(function(t,e,r,s){return i.isDefined(e.clientX)&&(e.sX=e.clientX,e.sY=e.clientY),function(){e.delayed=!0,t._capture&&t._capture(e,r,s)}}(this,n,e,s),this.throttleTime)}s=null,r=null,t=null,e=null},n.Tracker.prototype.dispose=function(){this.lastCapThrottle&&clearTimeout(this.lastCapThrottle),i.superDispose(this)};var o=n.Tracker,a={SESSIONID:"rpid",GLOBALSESSIONID:"mid",TRANSMITTING:"rt",CANCELED:"cncl",CANCELEDPERMANENT:"rcp",SESSION:"SESSION",DATA:"DATA",GLOBALREFRESHTIME:"grft"},c={_frames:[]};c.TrackFrame=function(t,e,r){var s=c._getFrameByXPath(t);s||c._frames.push({xp:t,nd:e,rc:r,sid:c._frames.length+"_",id:i.generateGUID(),initialized:!1})},c._getFrameByXPath=function(t){for(var e=t.join("/"),i=0;i<c._frames.length;i++)if(c._frames[i].xp.join("/")==e)return c._frames[i]},c._getFrameById=function(t){for(var e=0;e<c._frames.length;e++)if(c._frames[e].id==t)return c._frames[e]},c.BeginTrackingChildFrames=function(t){setInterval(function(){for(var e=0;e<c._frames.length;e++){var i=c._frames[e];!i.initialized&&i.nd.contentWindow&&i.nd.contentWindow.postMessage(JSON.stringify({cxr:!0,id:i.id,xp:i.xp,sid:i.sid,sp:B.getPosition(i.nd,t.win)}),"*")}},400),i.Bind(window,"message",function(e){if(e.data.timetounload)for(var r=0;r<c._frames.length;r++)c._frames[r].id===e.data.frameId&&(c._frames[r].initialized=!1);if(e.data=e.data+"",e.data&&i.isFunction(e.data.indexOf)&&e.data.indexOf("_cxrXDS_")>-1){var s;try{s=JSON.parse(e.data)}catch(t){return}if(s){var n=c._getFrameById(s.id);if(n){var o=t.getLogger();n.initialized=!0,o._data&&o._data.length>0?o._data=o._data+","+s.data:o._data=s.data}}}});new o(t,t.win,"record:scroll",500,function(e,r,s){for(var n=(i.getScroll(t.win),0);n<c._frames.length;n++){var o=c._frames[n];o.initialized&&o.nd.contentWindow&&o.nd.contentWindow.postMessage(JSON.stringify({cxsp:!0,sp:B.getPosition(o.nd,t.win)}),"*")}})},c.SendDataToParentFrame=function(t,e,i){t.postMessage(JSON.stringify({_cxrXDS_:!0,id:e,data:i}),"*")};var h=function(t,e,config,r){this.config=config,this.browser=e,this.isXDRIFrameMode=r,this.isTop=t.getTop()==t,this.recorder=t,this.mutation=new S(t),this._setupMouseTracking(),this.sizeCapture=new o(this.recorder,this.recorder.win,"resize",700,function(t,r,s){var n=i.getSize(s.win),o=0,a=s.getLogger(),c=B.getDocSize(s.doc),h={w:c.width,h:c.height};if(s.docSize=c,e.isMobile){var l=n;n=h,h=l,o=window.orientation}a.log(s,R.EVENT_TYPES.FRAME_SIZE,{sz:n,avs:h,st:o,m:e.isMobile},null,-350),a.log(s,R.EVENT_TYPES.DOC_SIZE,{sz:{w:c.width,h:c.height}},null,-340)});var s=this.recorder.win.onerror;this.recorder.win.onerror=i.proxy(function(t,e,i){this.getLogger().log(this,R.EVENT_TYPES.JAVASCRIPT_ERROR,{v:t+", "+e+", "+i}),s&&s.apply(this.win,arguments)},this.recorder),this.inputCaptures=[],this.updateNodeBinding(this.recorder.win.document.body,!1,!0),this.inputReserialize=function(t,e,r){return function(){setTimeout(function(){try{t.recorder.win.document}catch(t){return}for(var e=0;e<r.length;e++){var s=r[e];r[e].hasChanged()&&i.isDefined(s.input)&&"SELECT"!=s.input.nodeName&&(s.lastValue=s.input.value,s.serialize())}},20),t.isTop||t.recorder.getTop().eventcap.inputReserialize.apply()}}(this,this.recorder,this.inputCaptures),i.Bind(this.recorder.win.document,"record:click",this.inputReserialize),i.Bind(this.recorder.win.document,"record:touchstart",this.inputReserialize),this.config.advancedSettings&&this.config.advancedSettings.scrollEls&&(this._setupScrollTracking(),t.DomUpdated.subscribe(i.proxy(function(t){this._setupScrollTracking(t)},this))),t=null};h.prototype._setupScrollTracking=function(t){t||(t=document);var e=this.config.advancedSettings.scrollEls;if(i.isString(e))for(var r=t.querySelectorAll(e),s=function(t){return function(e,i){i||(i=e.target||e.srcElement),i&&t.getLogger().log(t,R.EVENT_TYPES.SCROLL_EL,{x:t.getLogger().logXPath(t,N.getMapping(i)),ps:{x:i.scrollLeft,y:i.scrollTop}})}},n=0;n<r.length;n++)r[n]._fsrScrollCapture||(r[n]._fsrScrollCapture=new o(this.recorder,r[n],"scroll",400,s(this.recorder)))},h.prototype._setupMouseTracking=function(){var t=this,e=function(e,r,s,n){var o=R.EVENT_TYPES,a=s.getLogger();if(e.delayed||s.getTop().isMousedOverWindow||(a.log(s,o.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),s.getTop().isMousedOverWindow=!0),s.getTop().isMousedOverWindow){n=n||o.MOUSE_MOVE;var c={x:"unknown"!=typeof e.clientX?e.clientX:"unknown"!=typeof e.screenX?e.screenX:e.sX,y:"unknown"!=typeof e.clientY?e.clientY:"unknown"!=typeof e.screenY?e.screenY:e.sY},h=-1;if(n==o.MOUSE_CLICK||n==o.MOUSE_DOWN){var l=e.explicitOriginalTarget||e.originalTarget||e.target||e.srcElement;l&&(h=a.logXPath(s,N.getMapping(l)))}var d=i.getScroll(s.win);if("undefined"==typeof c.x&&(c=s.lastRawMouseCoords),i.isDefined(c)){s.lastRawMouseCoords=c;var u={x:d.x+c.x,y:d.y+c.y};if(s.win!==s.win.top)if(t.isXDRIFrameMode)u.x+=s.ifrFrameOffset.x-d.x,u.y+=s.ifrFrameOffset.y-d.y;else{var g=s.win.frameElement,p=B.getPositionRelativeToMainView(g,B.getParentWindow(g),!1);p&&(u.x+=p.x-d.x,u.y+=p.y-d.y)}a.log(s,n,{ps:u,x:h})}}},r=250;if(this.browser.isMobile){if(e=null,r=100,this.isTop){this.lastOrientation={alpha:0,beta:0,gamma:0},i.Bind(window,"record:deviceorientation",i.proxy(function(t){if(i.isDefined(t.alpha)){var e=Math.round(t.alpha),r=Math.round(t.beta),s=Math.round(t.gamma),n=10,o=this.recorder;(Math.abs(e-this.lastOrientation.alpha)>n||Math.abs(r-this.lastOrientation.beta)>n||Math.abs(s-this.lastOrientation.gamma)>n)&&(this.lastOrientation.alpha=e,this.lastOrientation.beta=r,this.lastOrientation.gamma=s,o.getLogger().log(o,R.EVENT_TYPES.ORIENTATION,{ot:{a:e,b:r,g:s}}))}},this)),this.doOrientationChange=i.proxy(function(t){var e=this.recorder.win.document.documentElement,r=B.getDocSize(this.recorder.doc),s=0;Math.abs(window.orientation)>0&&(s=1),this.recorder.getLogger().log(this.recorder,R.EVENT_TYPES.ORIENTATION_CHANGE,{ps:i.getScroll(this.recorder.win),oc:{isL:s,ww:e.clientWidth,wh:e.clientHeight,dw:r.width,dh:r.height,wiw:window.innerWidth,wih:window.innerHeight}})},this),i.Bind(window,"record:orientationchange",this.doOrientationChange),this.doOrientationChange();for(var s=function(t,e,r){var s=[];if(i.isDefined(t.touches))for(var n=0;n<t.touches.length;n++){var o=t.touches[n];s.push({x:o.pageX,y:o.pageY})}r.getLogger().log(r,R.EVENT_TYPES.TOUCH,{ts:s})},n=["start","end","cancel","leave","move"],a=function(t){return function(e){s(e,"",t)}},c=0;c<n.length;c++)i.Bind(window,"record:touch"+n[c],a(this.recorder));i.Bind(window,"record:touchstart",i.proxy(function(){this.EmergencySendRequired.fire()},this.recorder))}}else{var h=this.browser.isIE?this.recorder.win.document:this.recorder.win;this.isTop?this.mouseMoveCapture=new o(this.recorder,h,"record:mousemove",200,e,!0):this.mouseMoveCapture=this.recorder.getTop().eventcap.mouseMoveCapture.merge(this.recorder,h,"record:mousemove",e,!0),i.Bind(this.recorder.win.document,"record:mousedown",i.proxy(function(t){this.mHandler.call(this.ctx,t,null,this.rec,R.EVENT_TYPES.MOUSE_CLICK)},{ctx:this,rec:this.recorder,mHandler:e}))}if(this.scrollCapture=new o(this.recorder,this.recorder.win,"record:scroll",r,function(t){return function(r,s,n){var o=!0;if(n.win==n.win.top)if(D._browser.isMobile){var a=B.getDocSize(n.doc),c={cw:window.innerWidth,ch:window.innerHeight,w:a.width,h:a.height},h={z:c,ps:i.getScroll(n.win)};o=!1,n.getLogger().log(n,R.EVENT_TYPES.ZOOM,h)}else e&&t.call(this,r,s,n);o&&n.getLogger().log(n,R.EVENT_TYPES.FRAME_SCROLL,{ps:i.getScroll(n.win)})}}(e)),this.isTop){this.browser.isMobile||(this.recorder.isMousedOverWindow=!0,i.Bind(this.recorder.win.document,"record:mouseover",function(t,e){return function(t){!e||e.isMousedOverWindow||t.relatedTarget||t.fromElement||(e.getLogger().log(e,R.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:1}),e.isMousedOverWindow=!0)}}(this,this.recorder)),i.Bind(this.recorder.win.document,"record:mouseout",i.proxy(function(t){t=t?t:this.recorder.win.event;var e,i=this.recorder,r=t.relatedTarget||t.toElement;try{r&&(e=r.nodeName)}catch(t){}i&&i.isMousedOverWindow&&(!r||e&&"HTML"==e)&&(i.getLogger().log(i,R.EVENT_TYPES.WINDOW_MOUSEOUT_MOUSEENTER,{st:0}),i.isMousedOverWindow=!1,i.EmergencySendRequired.fire())},this)));var l=function(t){return function(){var e=B.getDocSize(t.doc);t.docSize&&t.docSize.width==e.width&&t.docSize.height==e.height||(t.docSize=e,t.getLogger().log(t,R.EVENT_TYPES.DOC_SIZE,{sz:{w:e.width,h:e.height}}))}}(this.recorder);l.apply(this,[]),this.recorder.DomUpdated.subscribe(l),l=null}e=null},h.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME=500,h.prototype.updateNodeBinding=function(t,e,r){for(var s=+new Date,n=t.querySelectorAll("input, select, textarea"),o=this.inputCaptures,a=function(t){return function(){setTimeout(i.proxy(function(){for(var t=0;t<this.length;t++)this[t].serialize()},t),1)}},c=n.length-1;c>=0;c--){if(i.now()-s>h.MAX_UPDATE_NODE_BINDING_EXECUTION_TIME){this.recorder.logger.log(this.recorder,R.EVENT_TYPES.INCOMPLETE_INPUT_CAPTURE,{});break}var l=n[c];if(l._fsrTracker)for(var d=o.length-1;d>=0;d--){var u=o[d];if(u.input==l&&u.hasChanged()){u.serialize();break}}else o[o.length]=new T(this.recorder,l),"reset"==l.getAttribute("type")&&i.Bind(l,"record:click",a(o));l=null}!r&&this.browser.isIE&&this.mutation.setNodeSpecificBindings(t,e),n=null,o=null,t=null},h.prototype.dispose=function(){this.mutation.dispose(),this.mutation=null,this.recorder=null,this.inputCaptures=null,this.inputReserialize=null;var t,e=n._trackers;for(t=0;t<e.length;t++)e[t].dispose(),e.splice(t--,1);var i=_;for(t=0;t<i.length;t++)i[t].dispose(),i.splice(t--,1)};var l=function(t,e,config){var i=l,r=t.document;return i.ProcessHTML(i._getDocType(r)+r.querySelectorAll("html")[0].outerHTML,r,e,!!config.advancedSettings.pii.useWhiteListing,config)},d=l;l.ProcessHTML=function(t,e,i,r,config){return D.getCacheableObject(l._scrubHTML(t,r,config),i)},l._scrubHTML=function(t,e,config){var r,s=l,n=config.advancedSettings||{};if(t=i.isArray(t)?t[0]:t||"",n.regexScrub)for(r=0;r<n.regexScrub.length;r++)t=t.replace(n.regexScrub[r],"");return t=s._removeInnerScriptContent(t),t=s._removeZeroWidthEntities(t),t=s._fixPreTags(t),t=s._fixViewState(t),t=s._stripOptionTags(t),t=s._convertSpecialChars(t,config),t=s._stripInputValues(t),t=e?s._whiteListBlock(t,e):s._maskFSRHiddenBlocks(t,e),e||i.isDefined(n.keepComments)&&n.keepComments===!0||(t=s._removeComments(t)),t};var u=function(t){return t[0].indexOf("fsrHiddenBlock")<0?"":t[0]};l._removeComments=function(t){return/<!--/gim.test(t)?d._superReplace(t,/(<!--)[\w\W]*?(-->)/gim,u):t},l._convertSpecialChars=function(t,config){if(config.advancedSettings){var e,r=config.advancedSettings.specialMappings;if(i.isDefined(r))for(e=0,len=r.length;e<len;e++)t=t.replace(r[e][0],r[e][1])}return t},l._removeInnerScriptContent=function(t){return/script/gim.test(t)?d._superReplace(t,/(<script[^>]*?>)[\s\S]*?(<\/[\w]*script>)/gim,function(t){return t[1]+t[2]}):t},l._maskFSRHiddenBlocks=function(t,e){return e?this._superReplace(t,new RegExp(".+","mig"),d._maskBlock):t.indexOf("fsrHiddenBlock")>=0?l._superReplace(t,new RegExp("<!--(\\W)*fsrHiddenBlockStart[\\w\\W]*?fsrHiddenBlockEnd(\\W)*-->","mig"),d._maskBlock):t},l._removeZeroWidthEntities=function(t){return t.replace(/(\u200B)|(\u200C)|(\u200D)|(\uFEFF)/g,"")},l._fixPreTags=function(t){return t.indexOf("/pre")>-1||t.indexOf("/PRE")>-1?d._superReplace(t,new RegExp("[\\s\\S]*?(?:\\/pre\\s*>)|[\\s\\S]+","mig"),d._removeFormat):t},l._fixViewState=function(t){return t.indexOf("VIEWSTATE")>-1?t.replace(/<input[^>]*name=["']?__VIEWSTATE[^>]*>/gim,'<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" />'):t};var g=function(t){var e=t[0].match(/<\/select[^>]*>/gim);return e?t[0]:""};l._stripOptionTags=function(t){return/select/gim.test(t)?d._superReplace(t,/(<option[^>]*>[\s\S]*?<\/[\w]*option>)/gim,g):t};var p=function(t,e,i){if(e)return e+i.replace(/[\w\d\s]/g,"*")+'"'};l._stripInputValues=function(t){return t.length>0&&/value/.test(t)?t.replace(/(<(?:\s)*?input(?:[^>]+)value=\")([^>\"]*)\"/gim,p):t},l._superReplace=function(t,e,r){for(var s,n=e.exec(t),o="",a=0;i.isDefined(n);)o+=t.substring(a,n.index),s=r(n),o+=s,a=n.index+n[0].length,n=e.exec(t);return o+=t.substring(a,t.length)};var f=function(t,e,i,r){return i||r||"*"};l._maskBlock=function(t){var e=t instanceof Array?t[0]:t||"";return e.length>0?e.replace(/(>)|(&[^\s;]*;)|(<[^<>]*?>)|(<)|\w/g,f).replace(/&((?!nbsp| |amp).)*?;/g,"*"):""},l._removeFormat=function(t){var e=0,i=t[0];return i&&(i="",e=l._regexIndexOf(t[0],new RegExp("<\\s*?pre","mig")),i+=t[0].substring(0,e).replace(/\t/g," ").replace(/\s+/g," "),i+=t[0].substring(e)),i},l._regexIndexOf=function(t,e,i){var r=t.substring(i||0).search(e);return r>=0?r+(i||0):r},l._regexLastIndexOf=function(t,e,i){for(var r=i,s=l.regexIndexOf(t,e,r);s>-1;)r=s,s=l.regexIndexOf(t,e,r+1);return r},l._getDocType=function(t){var e,r="",s=t.doctype,n=t.childNodes,o=0;if(h._browser.isIE&&("CSS1Compat"!=t.compatMode||5==t.documentMode))return r;if(s){try{if(e=(new XMLSerializer).serializeToString(s).toString(),e&&e.length>0)return e}catch(t){}r="<!DOCTYPE HTML",s.publicId&&(r=r+' PUBLIC "'+s.publicId+'"'),s.systemId&&(r=r+' SYSTEM "'+s.systemId+'"'),r+=">"}else if(n[o].text){for(;n[o].text&&(0===n[o].text.indexOf("<!--")||0===n[o].text.indexOf("<?xml"));)o++;i.isDefined(n[o].text)&&0===n[o].text.toLowerCase().indexOf("<!doctype")&&(r=n[o].text)}return r},l._whiteListBlock=function(t,e){var i=t.indexOf("<!--fsrWhiteListStart"),r="";return e?i>=0?r+=l._maskBlock(t.substring(0,i))+l._superReplace(t.substring(i),new RegExp("<!--(\\W)*fsrWhiteListEnd(\\W)*-->([\\W\\D\\S](?!!--(\\W)*fsrWhiteListStart(\\W)*-->))*","mig"),l._maskBlock):this._superReplace(t,new RegExp(".+","mig"),l._maskBlock):t};var m={iFrameXpaths:{}};m.performFrameBindings=function(t,e){if(!r.advancedSettings.skipIframes){var s,n,o,a,h,l,d=(e||t.win.document).querySelectorAll("iframe"),u=function(t){return function(){t.dispose()}},g=function(t){return function(e){m.bindToFrameLoad(e,t)}};for(s=0;s<d.length;s++){if(n=d[s],o=n._fsrB||n.getAttribute("_fsrB"),!o&&!m.iFrameXpaths[N.getMapping(n)]){var p=this.testFrameOrigin(n),f=this.testFrameSrc(n);if(f&&p){if(m.iFrameXpaths[N.getMapping(n)]=!0,n.setAttribute("_fsrB",!0),a=this.getFrameWindow(n),!a)return;if(h=this.getFrameDocument(a,!1),l=!1,h){this.unbindInternalIframes(h);try{"complete, loaded".indexOf(h.readyState)>-1&&(l=!0)}catch(t){}l&&(i.isDefined(a.recorder)?a.recorder.serializeDom():(a.recorder=new U(t.stg,t.browser,a,N.getMapping(n),t,t.config),t.childRecorders.push(a.recorder),i.Bind(a,"unload",u(a.recorder))))}h=null,a=null}else f&&!p&&(m.iFrameXpaths[N.getMapping(n)]=!0,n.setAttribute("_fsrB",!0),c.TrackFrame(N.getMapping(n),n,t));i.BindOnce(n,"record:load",g(t))}n=null}d=null,t=null}},m.bindToFrameLoad=function(t,e){var r,s=t.originalTarget||t.target||t.srcElement;s&&this.testFrameSrc(s)&&m.testFrameOrigin(s)&&(r=m.getFrameWindow(s),m.getFrameDocument(r)&&(i.isDefined(r.recorder)||(r.recorder=new U(e.stg,e.browser,r,N.getMapping(s),e,e.config,e.isIframeMode),e.childRecorders.push(r.recorder),r.recorder.ready.subscribe(i.proxy(function(){i.Bind(r,"unload",this.dispose)},r.recorder),!0,!0))),r=null),s=null,e=null,t=null},m.testFrameSrc=function(t){var e,i=["javascript:","shim.gif","about:blank"];for(e=0;e<i.length;e++)if(t.src.indexOf(i[e])>-1)return!1;return!0},m.testFrameOrigin=function(t,e){var r=t.getAttribute("src");if(!r||0===r.indexOf(" "))return!1;var s=t.src;return i.testSameDomain(e||window.location.href,s)},m.unbindInternalIframes=function(t){var e,i=t.querySelectorAll("iframe[_fsrB='true']");for(e=0;e<i.length;e++)i[e]._fsrB=!1},m.getFrameWindow=function(t){var e;return t&&t.contentWindow?e=t.contentWindow:t&&t.contentDocument&&t.contentDocument.defaultView&&(e=t.contentDocument.defaultView),e&&e!=e.top?e:null},m.getFrameDocument=function(t){var e;try{return e=t.document}catch(t){return!1}};var _=[],T=function(t,e){if(!e._fsrTracker){e._fsrTracker=this,_.push(this),this.input=e,this.recorder=t;var r="";if(r=e.getAttribute("type")?e.getAttribute("type").toLowerCase():"text",this._isTextInput()&&(this.lastValue=e.getAttribute("value")||""),((!this._isTextInput()||e.value)&&("checkbox"!=r||e.checked)||e.type&&"select-one"==e.type)&&this.serialize(!0),i.Bind(e,"record:scroll",i.proxy(function(){this.input&&this.recorder.getLogger().log(this.recorder,R.EVENT_TYPES.SCROLL_EL,{t:r,x:this.recorder.getLogger().logXPath(this.recorder,N.getMapping(this.input)),ps:{x:this.input.scrollLeft,y:this.input.scrollTop}})},this)),i.Bind(e,"record:focus",i.proxy(function(){this.input&&(this._isTextInput()&&(this._updateCaret(),this._caretMonitor=setInterval(i.proxy(function(){this.input&&this._updateCaret()},this),350)),this.recorder.getLogger().log(this.recorder,R.EVENT_TYPES.FOCUS_BLUR,{t:r,st:1,x:this.recorder.getLogger().logXPath(this.recorder,N.getMapping(this.input))}))},this)),i.Bind(e,"record:blur",i.proxy(function(t){this.input&&(this._isTextInput()&&clearInterval(this._caretMonitor),this.recorder.getLogger().log(this.recorder,R.EVENT_TYPES.FOCUS_BLUR,{t:r,st:0,x:this.recorder.getLogger().logXPath(this.recorder,N.getMapping(this.input))}))},this)),"checkbox"==r||"radio"==r){var s=i.proxy(function(){this.input&&this._lastCheckedState!=this.input.checked&&(this._lastCheckedState=this.input.checked,this.recorder.getLogger().log(this.recorder,R.EVENT_TYPES.VALUE_CHANGED,{t:r,b:this.input.checked,x:this.recorder.getLogger().logXPath(this.recorder,N.getMapping(this.input))}))},this);i.Bind(e,"record:click",s),i.Bind(t.win,"record:click",s)}"checkbox"!=r&&"radio"!=r&&i.Bind(e,"record:change",i.proxy(function(){if(this.input){this._lastSelectListContents!=this.input.innerHTML&&this.serialize(),this.lastValue=this.input.value;var t=this.input.selectedOptions,e="";t&&t.length>0&&!this._isSecret()&&(e=t[0].innerText),this.recorder.getLogger().log(this.recorder,R.EVENT_TYPES.VALUE_CHANGED,{t:r,si:this.input.selectedIndex,x:this.recorder.getLogger().logXPath(this.recorder,N.getMapping(this.input)),v:e})}},this)),this._isTextInput()&&(this.lastValue=this.input.value,i.Bind(e,"record:keydown",function(t){return function(e){t.input&&(h._browser.isIE&&(e={keyCode:e.keyCode,charCode:e.charCode}),setTimeout(function(t,e){return function(){t._updateCaret();var i=0;if("number"==typeof e.keyCode?i=e.keyCode:"number"==typeof e.which?i=e.which:"number"==typeof e.charCode&&(i=e.charCode),Math.abs(t.lastValue.length-t.input.value.length)>1||t.lastCaretInfo.e-t.lastCaretInfo.s>1)t.serialize();else{0===i&&32==e.charCode&&(i=e.charCode);var s=t.recorder.getLogger().logXPath(t.recorder,N.getMapping(t.input));i<=46||i>=91&&i<96||i>=112&&i<=145?t.recorder.getLogger().log(t.recorder,R.EVENT_TYPES.KEY_PRESS,{t:r,xp:s,sk:i,ps:{x:t.input.scrollTop,y:t.input.scrollLeft}}):t.recorder.getLogger().log(t.recorder,R.EVENT_TYPES.KEY_PRESS,{t:r,xp:s,v:t._filterTextIfApplicable(t.input.value.substr(t.lastCaretInfo.c-1,1)),ps:{x:t.input.scrollTop,y:t.input.scrollLeft}})}t.lastValue=t.input.value}}(t,e),1))}}(this))),t=null,e=null}};T.prototype.hasChanged=function(){return this._lastCheckedState!=this.input.checked||this.lastValue!=this.input.value},T.prototype._filterTextIfApplicable=function(t){return t&&this._isSecret()?t.replace(/[^ \n\r\t]/g,"*"):t},T.prototype._isSecret=function(){var t=this.input.getAttribute("class")||this.input.getAttribute("className");return!(t&&t.indexOf("fsrVisible")>-1||"reset,submit,button".indexOf(this.input.getAttribute("type"))>-1)},T.prototype._isTextInput=function(){var t="text",e=this.input.tagName.toLowerCase(),r=["text","password","textarea","number","email","url","search","color","tel",""];return this.input.getAttribute("type")&&(t=this.input.getAttribute("type").toLowerCase()),("textarea"==e||i.inArray(t,r))&&"select"!==e},T.prototype.serialize=function(t){var e=this.input.tagName.toLowerCase(),i=this.input.getAttribute("type");if(i||(i=this.input.tagName.toLowerCase(),"input"==i&&(i="text")),"hidden"!=i){if(t){if(!("radio"!=i&&"checkbox"!=i||this.input.checked))return void(this._lastCheckedState=!1);if(("text"==i||"password"==i||"textarea"==e)&&""===this.input.value)return}var r=this.recorder.getLogger(),s=R.EVENT_TYPES.INPUT_SERIALIZE,n=r.logXPath(this.recorder,N.getMapping(this.input));switch(i="select,textarea".indexOf(e)>-1?e:i){case"textarea":r.log(this.recorder,s,{t:i,x:n,v:this._filterTextIfApplicable(this.input.value)||"",wt:B.getStyle(this.input,this.recorder.win,"width"),ht:B.getStyle(this.input,this.recorder.win,"height")});break;case"radio":case"checkbox":!this.input.checked&&t||(r.log(this.recorder,s,{t:i,x:n,b:this.input.checked}),this._lastCheckedState=this.input.checked);break;case"select":for(var o=[],a=0;a<this.input.options.length;a++)o[o.length]={v:this._filterTextIfApplicable(this.input.options[a].value),t:this._filterTextIfApplicable(this.input.options[a].text)};!this.input.multiple&&this._isSecret()&&o.length>1&&(o.length=1),r.log(this.recorder,s,{t:i,x:n,sz:{w:this.input.offsetWidth,h:this.input.offsetHeight},o:o,si:this.input.options.selectedIndex}),this._lastSelectListContents=this.input.innerHTML;break;default:r.log(this.recorder,s,{t:i,x:n,v:this._filterTextIfApplicable(this.input.value)||""})}}},T.prototype._updateCaret=function(){var t=this._getCaretInfo(this.input);this.lastCaretInfo&&this.lastCaretInfo.s==t.s&&this.lastCaretInfo.e==t.e&&this.lastCaretInfo.c==t.c||setTimeout(function(t,e){return function(){t.recorder.getLogger().log(t.recorder,R.EVENT_TYPES.CARET_INFO,e)}}(this,{x:this.recorder.getLogger().logXPath(this.recorder,N.getMapping(this.input)),ci:t}),1),this.lastCaretInfo=t},T.prototype._getCaretInfo=function(){var t=this.input,e=t.value,i=t.ownerDocument,r={s:0,e:0,c:0};if(h._browser.isIE){if("textarea"==t.tagName.toLowerCase()&&i.selection){e.charCodeAt(e.length-1)<14&&(e=e.replace(/34/g,"")+String.fromCharCode(28));var s=i.selection.createRange(),n=s.duplicate();n.moveToElementText(t),n.setEndPoint("StartToEnd",s),r.e=e.length-n.text.length,n.setEndPoint("StartToStart",s),r.s=e.length-n.text.length,r.c=r.e,e.substr(e.length-1)==String.fromCharCode(28)&&(e=e.substr(0,e.length-1));var o=e.substr(0,r.s).split("\n").length-1,a=e.substr(0,r.c).split("\n").length-1,c=e.substr(0,r.e).split("\n").length-1;r.c-=a,r.s-=o,r.e-=c}else if(i.selection){var l=i.selection.createRange(),d=l.duplicate();r.s=0-d.moveStart("character",-1e5),r.e=r.s+l.text.length,r.c=r.e}}else try{r.s=t.selectionStart,r.e=t.selectionEnd,r.c=r.e}catch(t){}return!r.s&&r.s<0&&(r={s:0,e:0,c:0}),r},T.prototype.dispose=function(){this.input._fsrTracker=null,this.recorder=null,this.lastValue=null,this.input=null,this.lastCaretInfo=null,this._lastSelectListContents=null,clearTimeout(this._caretMonitor)};var y=function(t){this._elementCache={},this._callbackTimer=null,this.recorder=t,this.cacheIndex=0,t=null};y.prototype.dispose=function(){i.superDispose(this._elementCache),this._elementCache=null,this.recorder=null,clearTimeout(this._callbackTimer)},y.prototype.push=function(t,e,r,s){var n={t:t,c:e,i:r,p:s,d:i.now()};s=s||"",t&&1!=t.nodeType&&(t=t.parentNode),t&&this._elementCache&&(t._fsrKey||(t._fsrKey={id:"_"+this.cacheIndex++}),this._elementCache[t._fsrKey.id+s.toLowerCase()]=n,this._callbackTimer||(this._callbackTimer=setTimeout(i.proxy(function(){this.handleEvents()},this),1e3)),t=null,e=null)},y.prototype.handleEvents=function(){this._callbackTimer=null;try{this.recorder.win.document}catch(t){return}var t,e=this._elementCache,r=i.now();for(var s in e)t=e[s],t._fsrKey=null,"object"==typeof t&&t.t&&t.t.nodeName&&"svg"!=t.t.nodeName&&(t.c(r-t.d),i.superDispose(t),t=null);i.superDispose(this._elementCache),this._elementCache={},e=null},y.prototype.accelerate=function(){this.handleEvents()};var S=function(t){this.config=t.config,this.recorder=t,this.mutationSynonym=window.MutationObserver?"MutationObserver":!!window.WebKitMutationObserver&&"WebKitMutationObserver",this.domMethodCopies=[],this.domMethodRewrites=[],this.domUpdateThrottler=new y(this.recorder),this.supportsDomPrototypes=!h._browser.isIE||(i.isDefined(t.win.Element)||i.isDefined(t.win.HTMLElement))&&!r.useEleMutation,this.setupMutationObserver(this.recorder,this)||h._browser.isIE&&(this.saveDomMutationMethods(),this.supportsDomPrototypes&&this.overrideDomPrototype(),this.setNodeSpecificBindings(this.recorder.win.document),this.recorder.DomUpdated.subscribe(i.proxy(function(t){this.setNodeSpecificBindings(t),t=null},this))),t=null};S.mutatorInfo={ignoreNodeContentsList:"input,select,img,link,meta,title,textarea,br,hr,script".split(","),watchNodeList:"html,head,header,h1,h2,h3,h4,h5,article,aside,section,details,footer,figure,nav,body,div,span,ul,li,dd,dt,ol,dl,tr,td,span,form,img,a,area,iframe,fieldset,select,input,textarea,table,label",svgWatchNodeList:"svg,defs,g,symbol,use,circle,ellipse,line,polygon,polyline,rect,linearGradient,radialGradient,animate,animateColor,animateMotion,animateTransform,set,stop,a,altGlyphDef,clipPath,color-profile,cursor,filter,font,font-face,foreignObject,image,marker,mask,pattern,switch,text,view,path,clippath",domRewriteList:"appendChild,removeChild,removeNode,insertAdjacentHTML,replaceChild,replaceNode,swapNode,insertBefore".split(",")};var E=S.mutatorInfo;S.prototype.setupMutationObserver=function(t,e){var i=this,r=this.mutationSynonym,s=e.domAttrModifiedHandler(t,e,i.config,!0),n=e.domSubtreeModifiedHandler(t,e,i.config,!0);if(r)return e.mutationObserver=new window[r](function(t){t.forEach(function(t){var e;switch(t.type){case"attributes":w(t.attributeName,t.target.tagName)&&(e={target:t.target,attrName:t.attributeName,newValue:t.target.getAttribute(t.attributeName)},s(e)),e=null;break;case"characterData":e={target:t.target.parentNode},n(e);break;case"childList":v(t)&&(e={target:t.target},n(e),e=null)}})}),this.mutationConfig={attributes:!0,childList:!0,subtree:!0},e.mutationObserver.observe(t.win.document,this.mutationConfig),!0};var v=function(t){var e,i;if(t.addedNodes&&t.addedNodes.length>0)for(e=0;e<t.addedNodes.length;e++)if(i=t.addedNodes[e],"SCRIPT"!=i.tagName)return!0;if(t.removedNodes&&t.removedNodes.length>0)for(e=0;e<t.removedNodes.length;e++)if(i=t.removedNodes[e],"SCRIPT"!=i.tagName)return!0},w=function(t,e){return!(!t||"_"==t.substr(0,1)||"on"==t.substr(0,2)||"href"==t||"script,meta,title".indexOf(e)>=0)&&(!(0===t.indexOf("siz")||0===t.indexOf("jQuery"))||0===t.indexOf("_fsrb"))};S.prototype.propertyChangeHandler=function(t){var e=t.propertyName,r=t.srcElement,config=this.config;if(!w(e,r.tagName))return void(r=null);if("innerHTML"==e||"innerText"==e||"outerHTML"==e)("outerHTML"==e||r.tagName&&"select"==r.tagName.toLowerCase())&&(r=r.parentNode),this.mutationSynonym||this.domUpdateThrottler.push(r,function(t,e){return function(i){var r=t.recorder,s=r.masker._tagDynamicMaskNodes(e,!1,r.win),n=N.getMapping(e),o=r.getLogger();o&&(o.log(r,R.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:o.logXPath(r,n),h:l.ProcessHTML(e.innerHTML,r.win.document,n,s,config)},null,i),t._handleDomUpdateIfNecessary(e)),e=null,t=null,s=null}}(this,r),!1);else if("on"!=e.substring(0,2)){for(var s=0;s<E.domRewriteList.length;s++)if(e==E.domRewriteList[s])return;if("on"==e.substr(0,2).toLowerCase())return;var n=r[e];e.indexOf("style.")>-1&&(e="style",n=r.getAttribute(e)),this.mutationSynonym||this.domUpdateThrottler.push(r,function(t,r){return function(s){if(t.recorder.masker._tagDynamicMaskNodes(r,!1,t.recorder.win),"style"==e){var o=r.getAttribute("style")||r.style;o&&o.cssText&&(n=o.cssText)}var a=t.recorder.getLogger(),c=N.getMapping;if(a)if("style"==e){n&&"null"!=n||(n="");var h=a.logXPath(t,c(r,null,"id"==e)),l=r.getAttribute("style")||r.style;l&&a.log(t.recorder,R.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:"undefined"!=typeof l.cssText?l.cssText:l+"",x:h},null,s)}else{var d=r.tagName.toLowerCase();"object"==typeof n||"value"==e&&"input"==d&&"hidden"==r.type||i.inArray(d,["input","select","textarea"])&&!i.inArray(e,["className","cols","rows","class","width","height","align"])||a.log(t.recorder,R.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:n+"",x:a.logXPath(t,c(r,null,"id"==e))},null,s)}t=null,a=null,r=null}}(this,r),!0,e)}r=null,t=null},S.prototype.domSubtreeModifiedHandler=function(t,e,r){return function(t){var s,n=t.originalTarget||t.target||t.srcElement,o=n.tagName?n.tagName.toLowerCase():"";if(i.inArray(o,E.ignoreNodeContentsList))"select"==o&&null!==n._fsrTracker&&e.domUpdateThrottler.push(n,function(t){return function(){t._fsrTracker&&t._fsrTracker.serialize()}}(n),!1);else{if(r.advancedSettings&&r.advancedSettings.svgCaptureEnabled&&i.inArray(o,E.svgWatchNodeList.split(","))){for(s=n;!s.innerHTML&&s.parentNode;)s=s.parentNode;n=s}e.domUpdateThrottler.push(n,function(t,e){return function(i){e._doDomUpdateWorkWithLog&&e._doDomUpdateWorkWithLog(t,i)}}(n,e),!1)}}};var b=function(t,e,i,r,s,n){return function(s){var n,o=r.getLogger(),a=N.getMapping;if(o)if("class"==e&&r.masker._tagDynamicMaskNodes(t,!0,r.win),"style"==e){n=o.logXPath(r,a(t,null,"id"==e));var c=t.getAttribute("style")||t.style;c&&"_fsrb"!=e&&o.log(r,R.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:"undefined"!=typeof c.cssText?c.cssText:c+"",x:n},null,s)}else if("_fsrb"!=e&&("value"!=e||"input"!=t.tagName.toLowerCase()||"hidden"!=t.type)&&"on"!=e.substr(0,2).toLowerCase()){var h=a(t,null,"id"==e);n=o.logXPath(r,h),o.log(r,R.EVENT_TYPES.DOM_MUTATION_NODE_ATTR_MODIFIED,{a:e,v:i,x:n},null,s)}}};S.prototype.domAttrModifiedHandler=function(t,e,i){return function(r){var s=r.attrName,n=r.newValue,o=r.originalTarget||r.target||r.srcElement;"on"==s.substr(0,2)||"script,meta,title".indexOf(o.tagName)>-1||(e.domUpdateThrottler.push(o,b(o,s,n,t,e,i),!0,s),o=null)}},S.prototype._doDomUpdateWorkWithLog=function(t,e){var i=this.recorder;3==t.nodeType&&(t=t.parentNode);var r=N.getMapping(t);if(0===r[0].indexOf("html")){var s=this.recorder.masker._tagDynamicMaskNodes(t,!1,i.win),n=t.innerHTML?l.ProcessHTML(t.innerHTML,i.win.document,r,s,this.config):{},o=i.getLogger();o&&(o.log(i,R.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:o.logXPath(i,r),h:n},null,e),this._handleDomUpdateIfNecessary(t))}},S.prototype._handleDomUpdateIfNecessary=function(t){var e=t.tagName?t.tagName.toLowerCase():"";1!=t.nodeType||i.inArray(e,S.ignoreNodeContentsList)||this.recorder.DomUpdated.fire(t)},S.prototype.setNodeSpecificBindings=function(t){for(var e=t.querySelectorAll(E.watchNodeList+", "+E.svgWatchNodeList),r=function(t){return function(e){t.propertyChangeHandler(e)}}(this),s=e.length-1;s>=0;s--){var n=e[s];if(i.BindOnce(n,"record:propertychange",r,!0,!0),!this.supportsDomPrototypes){var o,a=n.getAttribute("_fsrRewrite");if(!a){n.setAttribute("_fsrRewrite","true");for(var c=E.domRewriteList.length-1;c>=0;c--)o=E.domRewriteList[c],n[o]=this.domMethodRewrites[o]}}n=null}e=null,t=null,r=null},S.prototype.methodRewriter=function(t,e){var config=this.config;return function(){var s,n=this.parentNode,o=e.domMethodCopies[t];if(o){if("BODY"==this.tagName)try{s=o(arguments[0],arguments[1])}catch(t){s=o.apply(this,arguments)}else s=o.apply(this,arguments);
return n&&1==n.nodeType&&e.domUpdateThrottler.push(n,function(t,e){return function(s){var n,o,a=t.recorder.masker._tagDynamicMaskNodes(e,!1,t.recorder.win),c=N.getMapping(e),h=t.recorder.getLogger();if(h){if(n=e.tagName.toLowerCase(),r.svgCaptureEnabled&&i.inArray(n,E.svgWatchNodeList.split(","))){for(o=e;!o.innerHTML;){if(!o.parentNode)return;o=o.parentNode}e=o}h.log(t.recorder,R.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED,{x:h.logXPath(t.recorder,c),h:l.ProcessHTML(e.innerHTML,t.recorder.win.document,c,a,config)},null,s),t._handleDomUpdateIfNecessary(e)}e=null,t=null,a=null}}(e,n),!1),s}}},S.prototype.saveDomMutationMethods=function(){var t,e;for(e=E.domRewriteList.length-1;e>=0;e--)t=E.domRewriteList[e],this.domMethodCopies[t]=this.recorder.win.document.body[t],this.domMethodRewrites[t]=this.methodRewriter(t,this)},S.prototype.overrideDomPrototype=function(){var t,e,r=this.recorder.win,s=i.isDefined(r.Element)?r.Element.prototype:void 0,n=i.isDefined(r.HTMLElement)?r.HTMLElement.prototype:void 0;for(e=E.domRewriteList.length-1;e>=0;e--)t=E.domRewriteList[e],s&&(s[t]+"").indexOf("native")>-1&&(s[t]=this.domMethodRewrites[t]),n&&(n[t]+"").indexOf("native")>-1&&(n[t]=this.domMethodRewrites[t])},S.prototype.removeDomPrototypeOverrides=function(){var t,e,r=this.recorder.win,s=i.isDefined(r.Element)?r.Element.prototype:void 0,n=i.isDefined(r.HTMLElement)?r.HTMLElement.prototype:void 0;for(e=E.domRewriteList.length-1;e>=0;e--)t=E.domRewriteList[e],s&&s[t]&&delete s[t],n&&n[t]&&delete n[t]},S.prototype.dispose=function(){this.domUpdateThrottler&&(this.domUpdateThrottler.accelerate(),this.domUpdateThrottler.dispose()),i.superDispose(this.domMethodCopies),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.supportsDomPrototypes&&h._browser.isIE&&this.removeDomPrototypeOverrides(),this.domMethodCopies=null,this.domMethodRewrites=null,this.recorder=null};var N={};N.getMapping=function(t,e,i){if(e=e||[],t.parentNode&&(e=N.getMapping(t.parentNode,e)),1==t.nodeType){var r,s;if(t.previousSibling){r=1,s=t.previousSibling;do 1==s.nodeType&&s.nodeName==t.nodeName&&r++,s=s.previousSibling;while(s);1==r&&(r=null)}else if(t.nextSibling){s=t.nextSibling;do 1==s.nodeType&&s.nodeName==t.nodeName?(r=1,s=null):(r=null,s=s.previousSibling);while(s)}e.push(M(t,r,!!i))}return e};var M=function(t,e,i){var r;return t.getAttribute&&(r=t.getAttribute("id"),r&&r.indexOf("yui_")>-1&&(r=null)),t.nodeName.toLowerCase()+(r&&!i?"[@id='"+r+"']["+(e||1)+"]":e>0?"["+e+"]":"")};N.getNodeXPathPosition=function(t){for(var e=t.nodeType,i=t.tagName,r=t.parentNode,s=0,n=r.childNodes,o=n.length,a=0;o>s&&n[s];){if(n[s].nodeType==e&&(i&&i==n[s].tagName||!i)&&(a++,n[s]==t))return a;s++}return 0};var C=function(){};C.prototype={useWhiteListing:!1,dynamicWhiteListUnblocks:[],dynamicSelectorsToMask:[],dynamicSelectorsToUnmask:[],dynamicWhiteListEls:[],dynamicSelectorsToRemask:[],dynamicSelectorsToBlockAssets:[],staticWhiteListEls:[],isMasking:!1,noMaskClassArray:[]};var I="fsrHiddenBlockStart",O="fsrHiddenBlockEnd",L="fsrWhiteListStart",x="fsrWhiteListEnd";C.prototype._maskStaticBySelector=function(t,e,r){var s,n,o,a=e.document,c=a.querySelectorAll(t),h=r?L:I,l=r?x:O,d="_fsrWL";for(s=0;s<c.length;s++)n=c[s],"BODY"==n.nodeName?i.hasClass(n,d)||(i.addClass(n,d),n.insertBefore(a.createComment(h),n.firstChild),n.appendChild(a.createComment(l))):(o=n.parentNode,i.hasClass(o,d)||(i.addClass(o,d),o.insertBefore(a.createComment(h),n),o.insertBefore(a.createComment(l),n.nextSibling)))},C.prototype._remaskBySelector=function(t,e){i.removeClass(e.document.querySelectorAll(t),"fsrVisible")},C.prototype._unmaskStaticBySelector=function(t,e){i.addClass(e.document.querySelectorAll(t),"fsrVisible")},C.prototype._obscureBySelector=function(t,e){i.addClass(e.document.querySelectorAll(t),"fsrObscure")},C.prototype._maskDynamicBySelector=function(t,e,i){t.length>0&&"string"==typeof t&&(void 0===i||""===i||"inTxBlk"==i?(this._maskStaticBySelector(t,e,!1),this.dynamicSelectorsToMask[this.dynamicSelectorsToMask.length]=t):"evUnblk"==i?(this._unmaskStaticBySelector(t,e),this.dynamicSelectorsToUnmask[this.dynamicSelectorsToUnmask.length]=t):"evReblk"==i?(this._remaskBySelector(t,e),this.dynamicSelectorsToRemask[this.dynamicSelectorsToRemask.length]=t):"DOMWL"==i&&(this._maskStaticBySelector(t,e,!0),this.dynamicWhiteListUnblocks[this.dynamicWhiteListUnblocks.length]=t))},C.prototype._unmaskDynamicBySelector=function(t,e){this._maskDynamicBySelector(t,e,"evUnblk")},C.prototype._maskAssetDynamicBySelector=function(t,e){if(i.addClass(e.document.querySelectorAll(t),"fsrHidden"),t.length>0){"string"==typeof t&&(t=[t]);for(var r=this.dynamicSelectorsToBlockAssets,s=0;s<t.length;s++)r[r.length]=t[s]}},C.prototype._removeVisibility=function(t,e){this._maskDynamicBySelector(t,e,"evReblk")},C.prototype._whiteListUnblockDynamic=function(t,e){this._maskDynamicBySelector(t,e,"DOMWL")},C.prototype.addClassToNoMaskArray=function(t){this.noMaskClassArray[this.noMaskClassArray.length]=t},C.prototype.isNodeMasked=function(t){var e,i,r,s=!0;if(this.noMaskClassArray.length>0&&t.className)for(e=this.noMaskClassArray,i=0;i<e.length;i++)r=e[i],t.className.indexOf(r)>-1&&(s=!1),i=r=null;return t.childNodes.length<1||!s||!!(t.childNodes[0].data&&t.childNodes[0].data.indexOf(I)>-1)},C.prototype._tagDynamicMaskNodes=function(t,e,r){var s,n,o,a=r.document,c=!1,h="_fsrWL";if(!this.isMasking){if(this.isMasking=!0,this.useWhiteListing){if(c=!0,this.dynamicWhiteListUnblocks.length>0&&!e)for(o=a.querySelectorAll(this.dynamicWhiteListUnblocks.join(",")),s=0,n=o.length;s<n;s++)if(B.nodeBelongsTo(t,o[s])||o[s]==t){if(!this.isNodeMasked(t)){c=!1;break}}else B.nodeBelongsTo(o[s],t)&&(this.isNodeMasked(o[s])||i.hasClass(o[s],h)||(i.addClass(o[s],h),o[s].insertBefore(a.createComment(L),o[s].firstChild),o[s].appendChild(a.createComment(x))))}else if(this.dynamicSelectorsToMask.length>0&&!e)for(o=a.querySelectorAll(this.dynamicSelectorsToMask.join(",")),s=0,n=o.length;s<n;s++)if(B.nodeBelongsTo(t,o[s])||o[s]==t){if(!this.isNodeMasked(t)){c=!0;break}}else B.nodeBelongsTo(o[s],t)&&(this.isNodeMasked(o[s])||(o[s].insertBefore(a.createComment(I),o[s].firstChild),o[s].appendChild(a.createComment(O))));if(this.dynamicSelectorsToUnmask.length>0){for(s=this.dynamicSelectorsToUnmask.length-1;s>=0;s--)i.addClass(a.querySelectorAll(this.dynamicSelectorsToUnmask[s]),"fsrVisible");for(n=this.dynamicSelectorsToRemask.length-1;n>=0;n--)i.removeClass(a.querySelectorAll(this.dynamicSelectorsToRemask[n]),"fsrVisible")}if(this.dynamicSelectorsToBlockAssets.length>0)for(s=this.dynamicSelectorsToBlockAssets.length-1;s>=0;s--)i.addClass(a.querySelectorAll(this.dynamicSelectorsToBlockAssets[s]),"fsrHidden");this.isMasking=!1}return c},C.prototype.maskDocument=function(t,e){var r=(e.location.href||"about:blank").toLowerCase();if(this.useWhiteListing=!1,t.staticWhiteListEls)for(var s in t.staticWhiteListEls)if(t.staticWhiteListEls.hasOwnProperty(s)&&(r.indexOf(s)>-1||i.testAgainstSearch(s,r))){this.useWhiteListing=!0;break}if(t.dynamicWhiteListEls)for(var n in t.dynamicWhiteListEls)if(t.dynamicWhiteListEls.hasOwnProperty(n)&&(r.indexOf(n)>-1||i.testAgainstSearch(n,r))){this.useWhiteListing=!0;break}t.useWhiteListing=this.useWhiteListing;var o=function(t,e,s,n,o){for(var a in e)(r.indexOf(a)>-1||i.testAgainstSearch(a,r))&&s.call(t,e[a],n,o)};this.useWhiteListing?(o(this,t.staticWhiteListEls,this._maskStaticBySelector,e,!0),o(this,t.dynamicWhiteListEls,this._whiteListUnblockDynamic,e)):(o(this,t.staticBlockEls,this._maskStaticBySelector,e),o(this,t.dynamicBlockEls,this._maskDynamicBySelector,e)),o(this,t.staticVisibleEls,this._unmaskStaticBySelector,e),o(this,t.dynamicVisibleEls,this._unmaskDynamicBySelector,e),o(this,t.assetBlockEls,this._maskAssetDynamicBySelector,e),o(this,t.removeVisibilityEls,this._removeVisibility,e),o(this,t.obscureEls,this._obscureBySelector,e)};var D={_browser:null,_cacheList:[]};D.getCacheableObject=function(t,e){var r=D._browser.isMobile;e&&e.join&&(e=e.join(","));var s,n={},o=D,a=o._cacheList;for(s=a.length-1;s>=0;s--)if(a[s].str==t){n.uid=a[s].uid;break}if(!i.isDefined(n.uid)){if(n.uid=i.generateGUID(),n.kl=e,e&&t.length>100)for(s=a.length-1;s>=0;s--)if(a[s].kl==e){var c=k(a[s].str,t);n.diff={uid:a[s].uid,d:c};break}i.isDefined(n.diff)?(!r||a.length<500)&&(a[a.length]={str:t,uid:n.uid,kl:n.kl}):(n.str=t,(!r||a.length<500)&&(a[a.length]=n))}return n},D.reset=function(){D._cacheList=[]};var k=function(t,e){for(var i=t,r=e,s=t.length,n=e.length,o=s>n?n:s,a=o,c=0,h=0,l=0,d=0;a-c>15;)d=Math.round((a-c)/2),l=a-d,i.substr(0,l)!=r.substr(0,l)?a=l:c=l;var u=e.substr(c);for(a=u.length;a-h>15;)d=Math.round((a-h)/2),l=a-d,u.substr(u.length-l)!=i.substr(i.length-l)?a=l:h=l;return{o:c,c:h,r:e.substring(c,e.length-h)}},A=[],R=function(t,r,s,config){this.config=config,this.recorder=s,this.browser=r,this.cors=new i.CORS(r,t.fstg),this.isIframeMode=s.isIframeMode;var n=t.get([a.GLOBALSESSIONID,a.TRANSMITTING,a.CANCELED,"pv"]),o=n[a.GLOBALSESSIONID],c=n[a.TRANSMITTING],h=n[a.CANCELED],l=i.getScreenResolution();this.stg=t,this.pageViews=t.get("pv"),this.failCount=0,this.transportid=0,this.lastTransmissionTime=0,this.holdTransmits=!1,this.transmitting=!1,this.canceled=!1,this.siteid=config.clientId||"unk",this.domain=document.domain.toString(),this.StorageReady=new i.FSEvent,this.TransportReady=new i.FSEvent,this._quickXpathCache={},this._reset(),this.isIframeMode?(this.TransportReady.fire(),this.transmitting=!0,this.StorageReady.fire(),this.iFrameCommitItv=setInterval(i.proxy(this._flushAndTransmit,this),1e3)):(this.log(s,R.EVENT_TYPES.PAGE_MARKER,{dtm:e.startTS,ofs:(new Date).getTimezoneOffset(),v:r.browser.name,dv:r.browser.version,sid:config.clientId,r:"W3C",l:config.layout,m:r.isMobile,f:document.referrer.toString(),sz:{w:l.w,h:l.h}},-1),i.Bind(window,"unload",i.proxy(function(){this.commitData()},this)),this._backup_storage=new i.DomStorage(this.siteid,!1,!1,r),this._storage=new i.WindowStorage(this.siteid,!1,r),this._syncStorage(),this._syncSession(o,!!c,!!h),this._syncData(),this.startStateMonitor(),this.startStorageMonitor(),this.TransportReady.subscribe(i.proxy(function(){this.StorageReady.fire(),this.transmitting&&this.startHeartbeat(),this._flushAndTransmit()},this),!0,!0),this.TransportReady.fire(),this.recorder.ready.subscribe(i.proxy(function(){this.recorder.EmergencySendRequired.subscribe(i.proxy(function(){this._flushAndTransmit(!0)},this))},this),!0,!0)),s=null};R.prototype.commitData=function(){this._flush(),this.transmitting&&this._transmit(),this._storage&&(this._storage.set(a.SESSION,this._session),this._storage.setBlob(this._data),this._storage.commit()),this._backup_storage&&(this._backup_storage.set(a.SESSION,this._session),this._backup_storage.setBlob(this._data),this._backup_storage.commit())},R.prototype.dispose=function(){this._flush(),this.cors.dispose(),this.iFrameCommitItv&&clearInterval(this.iFrameCommitItv),this.recorder.EmergencySendRequired.unsubscribeAll(),this.recorder.EmergencySendRequired=null,this.stopStorageMonitor(),this.stopStateMonitor()},R.prototype.setTransmitOK=function(){this.canceled||(this.transmitting=!0,this._session[a.TRANSMITTING]=!0,this.stg.set(a.TRANSMITTING,!0),this._flushAndTransmit(),this.startHeartbeat())},R.prototype.setTransmitNotOK=function(){this.stopHeartbeat(),this.transmitting=!1,this._session[a.TRANSMITTING]=!1,this.stg.set(a.TRANSMITTING,!1)},R.prototype.cancelRecord=function(t){this.setTransmitNotOK(),this.stopStateMonitor(),this.stopStorageMonitor(),this.canceled=!0,this._session[a.CANCELED]=!0,this.stg.set(a.CANCELED,!0),t&&this.stg.set(_SESSION_SYMBOLS.CANCELEDPERMANENT,this.cancel),this.iFrameCommitItv&&clearInterval(this.iFrameCommitItv),this._reset()},R.prototype._syncStorage=function(){var t,e,i=this._storage,r=this._backup_storage;i&&r&&i.isNew()&&!r.isNew()&&(t=r.get(a.SESSION),i.set(a.SESSION,t),e=r.getBlob(),i.setBlob(e))},R.prototype._syncSession=function(t,e,r){var s=this._storage||this._backup_storage;if(s){if(this.refreshLastTime=this.stg.get(a.GLOBALREFRESHTIME),this.refreshLastTime){this.refreshLastTime=parseInt(this.refreshLastTime);var n=36e5;i.now()-this.refreshLastTime>n&&(t=null,s.erase(a.SESSION),this.stg.erase([a.GLOBALSESSIONID,a.SESSIONID]))}s.get(a.SESSION)?(this._session=s.get(a.SESSION),this.sessionid=this._session[a.SESSIONID],this.gsessionid=this._session[a.GLOBALSESSIONID],this.stg.set(a.SESSIONID,this.sessionid),i.isDefined(e)?(this.transmitting=e,this._session[a.TRANSMITTING]=this.transmitting):(this.transmitting=this._session[a.TRANSMITTING],this.stg.set(a.TRANSMITTING,this.transmitting)),i.isDefined(r)?(this.canceled=r,this._session[a.CANCELED]=this.canceled):(this.canceled=this._session[a.CANCELED],this.stg.set(a.CANCELED,this.canceled)),s.set(a.SESSION,this._session)):(this._session={},this.sessionid=i.generateGUID(),this._session[a.SESSIONID]=this.sessionid,t||(t=i.generateGUID()),this.gsessionid=t,this._session[a.GLOBALSESSIONID]=this.gsessionid,this.stg.set(a.GLOBALSESSIONID,this.gsessionid),this.transmitting=e,this._session[a.TRANSMITTING]=this.transmitting,this.stg.set(a.TRANSMITTING,this.transmitting),this.canceled=r,this._session[a.CANCELED]=this.canceled,this.stg.set(a.CANCELED,this.canceled),s.set(a.SESSION,this._session),s.commit()),this.refreshLastTime=i.now(),this._session[a.GLOBALREFRESHTIME]=this.refreshLastTime,this.stg.set(a.GLOBALREFRESHTIME,this.refreshLastTime)}},R.prototype._syncData=function(){this._storage?this._data=this._storage.getBlob():this._backup_storage&&(this._data=this._backup_storage.getBlob())},R.prototype._flushAndTransmit=function(t){if((this._storage||this._backup_storage)&&!this.canceled||this.isIframeMode){var e=this.testStorageLimit();this.transmitting&&(i.now()-this.lastTransmissionTime>5e3||t)||e||this.isIframeMode?(this._flush(),this._transmit()):t&&this.browser.isMobile&&this.commitData()}},R.prototype.processImmediately=function(t){i.Healthy(this.browser,["cxreplay"],i.proxy(function(){this.cors.send({method:"GET",url:i.sign(r.rec_transport_url+"process/"+encodeURIComponent(this.gsessionid)+"?delay="+(t||0)),failure:i.proxy(function(t){},this),success:i.proxy(function(t){},this)})},this))},R.prototype._transmit=function(){if(0!==this._data.length||this.isIframeMode)return this.isIframeMode?void(this._data.length>0&&(c.SendDataToParentFrame(this.recorder.iFrameParentFr,this.recorder.ifrid,this._data),this._data="")):this.holdTransmits&&i.now()-this.lastTransmissionTime<1e4?void(this.hasEmergency=!0):void i.Healthy(this.browser,["cxreplay"],i.proxy(function(){this.holdTransmits=!0,this.hasEmergency=!1,this.lastTransmissionTime=i.now();var t,e="corsservice",s=this.siteid.replace(/[- _.&]/g,"").toLowerCase(),n='{"data":['+this._data+"]}",o=n.length;P.set("rtp",e.substr(0,1)),o>1e3&&o<1e6&&(n=i.Compress.fragmentAndCompress(n)),t="datalen:"+n.length+",time:"+i.now(),P.increment("rta"),this.cors.send({action:"data",method:"POST",contentType:"text/plain;charset=UTF-8",encoding:encodeURIComponent(B.getEncoding()),version:5,gSessionId:this.gsessionid,sessionId:this.sessionid,domain:this.domain||window.location.hostname,siteId:s,url:r.rec_transport_url+e+"?action=data&metadata="+encodeURIComponent(t)+"&encoding="+encodeURIComponent(B.getEncoding())+"&session_id="+encodeURIComponent(this.sessionid)+"&global_session_id="+encodeURIComponent(this.gsessionid)+"&domain="+encodeURIComponent(this.domain)+"&site_id="+encodeURIComponent(s)+"&version=5.0&cachebust="+Math.random(),skipEncode:!0,data:n,failure:i.proxy(function(t){P.increment("rtf"),this.failCount++,this.holdTransmits=!1;try{t=JSON.parse(t)}catch(t){}if(i.isDefined(t.status)){var e=Math.abs(parseInt(t.status));P.increment("rtf"+e)}return this.failCount>10?(P.set("rtcr",1),P.set("rtcp",this.pageViews),void this.cancelRecord()):void(this.hasEmergency&&setTimeout(i.proxy(function(){this._flushAndTransmit(!0)},this),100))},this),success:function(t,e,r){return function(s){P.increment("rts"),t.failCount=0,t.holdTransmits=!1;try{s=JSON.parse(s)}catch(t){}if(i.isDefined(s.status)){var n=parseInt(s.status,10);if(1==n)e==t.transportid?t._data="":t._data.substr(0,r.length)==r&&(t._data=t._data.substr(r.length));else if(2==n)return P.set("rtcr",2),P.set("rtcp",t.pageViews),void t.cancelRecord();t.hasEmergency&&setTimeout(function(){t._flushAndTransmit(!0)},100)}}}(this,this.transportid,this._data+"")})},this))},R.prototype._ping=function(){i.isDefined(this.transport)&&!this.canceled&&i.Healthy(this.browser,["cxreplay"],i.proxy(function(){var t=this.siteid.replace(/[- _.&]/g,"").toLowerCase();this.transport||(this.transport=new this.transport),this.cors.send({action:"ping",contentType:"text/plain;charset=UTF-8",sessionId:this.sessionid,siteId:t,url:r.rec_transport_url+"corsservice?action=ping&session_id="+encodeURIComponent(this.sessionid)+"&site_id="+encodeURIComponent(t)+"&cachebust="+Math.random(),skipEncode:!0,data:"",failure:function(){},success:function(){}})},this))},R.prototype._reset=function(){this._log={start:this._log?i.now():e.startTS,log:[],guid:i.generateGUID()},this._log_size_est=0},R.prototype._flush=function(){if(0!==this._log.log.length){this.transportid++,this._log.log.toJSON=null;var t=JSON.stringify(this._log);t&&t.length>0&&(this._data&&this._data.length>0?this._data=this._data+","+t:this._data=t),this._reset()}},R.prototype.logXPath=function(t,e){if(!this.canceled){if(e=e.join(","),!i.isDefined(this._quickXpathCache[e])){A[A.length]=e;var r=this.recorder.iFramexPathPrefix+(A.length-1);this._quickXpathCache[e]=r,this.log(t,R.EVENT_TYPES.XPATH_CACHE,{idx:r,xp:e},r)}return this._quickXpathCache[e]}},R.prototype.log=function(t,e,r,s,n){if(!this.canceled){var o=0;n||(n=0);var a={x:i.isDefined(s)?s:this.logXPath(t,t.getPath()),e:e,d:r,t:Math.max(0,i.now()-this._log.start-n)};this._log.log[this._log.log.length]=a,e==R.EVENT_TYPES.DOM_SERIALIZE?r.dom.str&&(o=r.dom.str.length,this._log_size_est+=o):e==R.EVENT_TYPES.CSS_SERIALIZE?r.stylesheet?(o=r.stylesheet.length,this._log_size_est+=o):r.v&&(o=Math.round(1*r.v.length),this._log_size_est+=o):e==R.EVENT_TYPES.DOM_MUTATION_NODE_MODIFIED?r.h.str||r.h.diff?(o=Math.round(1*((r.h.str?r.h.str.length:0)+(r.h.diff?r.h.diff.d.r.length:0)+(r.h.kl?r.h.kl.length:0)+(r.h.uid?r.h.uid.length:0))),o+=50,this._log_size_est+=o):(o=84,this._log_size_est+=o):(o=60,this._log_size_est+=o)}},R.prototype.testStorageLimit=function(){return!this.isIframeMode&&this._data.length+this._log_size_est>3e6},R.prototype._monitorState=function(){var t=this.stg.get([a.CANCELED,a.TRANSMITTING]),e=t[a.CANCELED],r=t[a.TRANSMITTING];return i.isDefined(e)&&this.canceled!=e&&e?void this.cancelRecord():void(i.isDefined(r)&&this.transmitting!=r&&(r?this.setTransmitOK():this.setTransmitNotOK()))},R.prototype.startHeartbeat=function(){this.heartbeatTransmit||(this._ping(),this.heartbeatTransmit=setInterval(i.proxy(function(){this._ping()},this),45e3))},R.prototype.stopHeartbeat=function(){this.heartbeatTransmit&&(clearInterval(this.heartbeatTransmit),delete this.heartbeatTransmit)},R.prototype.startStateMonitor=function(){this.stateMonitor||(this._monitorState(),this.stateMonitor=setInterval(i.proxy(function(){this._monitorState()},this),2e3))},R.prototype.stopStateMonitor=function(){this.stateMonitor&&(clearInterval(this.stateMonitor),delete this.stateMonitor)},R.prototype.startStorageMonitor=function(){this.storageMonitor||(this.storageMonitor=setInterval(i.proxy(function(){this.log(this.recorder,R.EVENT_TYPES.HEARTBEAT,{ofs:(new Date).getTimezoneOffset()},-1),this._flushAndTransmit()},this),this.browser.isMobile?1e4:2e4))},R.prototype.stopStorageMonitor=function(){this.storageMonitor&&(clearInterval(this.storageMonitor),delete this.storageMonitor)},R.EVENT_TYPES={DOM_SERIALIZE:0,XPATH_CACHE:1,FRAME_SIZE:2,FRAME_SCROLL:3,MOUSE_MOVE:4,WINDOW_MOUSEOUT_MOUSEENTER:5,INPUT_SERIALIZE:6,FOCUS_BLUR:7,KEY_PRESS:8,CARET_INFO:9,VALUE_CHANGED:10,DOM_MUTATION_NODE_MODIFIED:11,DOM_MUTATION_NODE_ATTR_MODIFIED:12,JAVASCRIPT_ERROR:13,MOUSE_CLICK:14,MOUSE_DOWN:15,MOUSE_UP:16,PAGE_MARKER:17,DOC_SIZE:18,SCROLL_EL:19,NOT_RECORDED:20,CSS_SERIALIZE:21,ORIENTATION:22,ZOOM:23,TOUCH:24,INCOMPLETE_INPUT_CAPTURE:25,ORIENTATION_CHANGE:26,CUSTOM_BEHAVIOR:27,CUSTOM_ERROR:28,HEARTBEAT:29};var P={};P.increment=function(t,e){try{var i=t.get("meta")||{};i[e]=(i[e]||0)+1,t.set("meta",i)}catch(t){}},P.set=function(t,e,i){try{var r=t.get("meta")||{};r[e]=i,t.set("meta",r)}catch(t){}};var B={};B.nodeBelongsTo=function(t,e){if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(;t.parentNode;){if(t==e||t==e.body)return!0;t=t.parentNode}return!1},B.getEncoding=function(){return h._browser.isIE?window.document.charset:window.document.characterSet},B.getParentWindow=function(t){var e=t;if(t){if(t._pw)return t._pw;if(t.ownerDocument&&t.ownerDocument.defaultView)return t.ownerDocument.defaultView;for(;t.parentNode||t.document;){if(t.document)return e._pw=t,t;t=t.parentNode}}},B.getStyle=function(t,e,i){if(!e)return"";var r="",s=e.document.defaultView;return s&&s.getComputedStyle&&s.getComputedStyle(t,"")?r=s.getComputedStyle(t,"").getPropertyValue(i):t.currentStyle&&(i=i.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),r=t.currentStyle[i]),r},B.getPosition=function(t,e){for(var i=0,r=0,s=B.getStyle;t;)i+=t.offsetTop+(parseFloat(s(t,e,"borderTopWidth"))||0),r+=t.offsetLeft+(parseFloat(s(t,e,"borderLeftWidth"))||0),t=t.offsetParent;return{x:r,y:i}},B.getPositionRelativeToMainView=function(t,e,r){for(var s,n=!1;!n&&e;){n=e.parent==e;var o=B.getPosition(t,e),a=i.getScroll(e);r&&!n&&(o.x-=a.x,o.y-=a.y),s?(s.x+=o.x,s.y+=o.y):s=o,t=e.frameElement,e=e.parent}return s},B.getDocSize=function(t){var e=t||window.document,i=e.body,r=e.documentElement,s=Math.max;return{width:s(s(i.scrollWidth,r.scrollWidth),s(i.offsetWidth,r.offsetWidth),s(i.clientWidth,r.clientWidth)),height:s(s(i.scrollHeight,r.scrollHeight),s(i.offsetHeight,r.offsetHeight),s(i.clientHeight,r.clientHeight))}},B.externalizeStyleCSSTextToInnerHTML=function(t){var e,s,n=!1;if(i.isDefined(r.useCSSText)||(e=document.createElement("style"),e.setAttribute("type","text/css"),r.useCSSText=i.isDefined(e.styleSheet)),r.useCSSText){e="style"==t.nodeName.toLowerCase()?[t]:t.querySelectorAll("style");for(var o=0,a=e.length;o<a;o++)s=e[o],s.styleSheet&&s.styleSheet.cssText&&s.styleSheet.cssText.replace(/\s/gi,"").length!=s.innerHTML.replace(/\s/gi,"").length&&(s.innerHTML=s.styleSheet.cssText,n=!0)}return n};var U=function(t,e,r,s,n,config,o,a,l,d,u){D._browser=h._browser=this.browser=e,u&&this.setXFrameScrollPosition(u),this.isIframeMode=!!o,this.iFramexPathPrefix=d||"",this.ifrid=a,this.iFrameParentFr=l,this.config=config,this.stg=t,this.win=r,this.ready=new i.FSEvent,this.childRecorders=[],this.disposed=!1,this.DomUpdated=new i.FSEvent,this.DomUpdated.subscribe(i.proxy(function(){this.update.apply(this,arguments)},this)),this.EmergencySendRequired=new i.FSEvent,this.instancePath=s||[],this.isMousedOverWindow=!1,this.logger=this.eventcap=this.recordParent=null,this.win.document&&(this.recordParent=n,n||(this.logger=new R(t,e,this,this.config)),this.getLogger().StorageReady.subscribe(i.proxy(function(){this.ready.fire(),config.advancedSettings&&(this.masker=new C,this.masker.maskDocument(config.advancedSettings.pii,this.win)),this.serializeDom(),this.eventcap=new h(this,e,this.config,this.isIframeMode),m.performFrameBindings(this),o||c.BeginTrackingChildFrames(this),n||this.logger._flushAndTransmit(!0),e.isMobile&&this.setTransmitOK()},this),!0,!0)),n=null,r=null,s=null};U.prototype.update=function(t){t||(t=this.doc.body),0!==t.childNodes.length&&(this.eventcap.updateNodeBinding(t,!!t),m.performFrameBindings(this,t))},U.prototype.getLogger=function(){return this.recordParent?this.recordParent.getLogger():this.logger||{log:function(){}}},U.prototype.logCustomEvent=function(t,e,r){i.isDefined(t)&&"string"==typeof t||(t=""),this.getLogger().log(this,r,{attrName:t,v:JSON.stringify(e)})},U.prototype.getPath=function(){return this._getPathCache||(this.recordParent?this._getPathCache=this.instancePath.concat(this.recordParent.getPath()):this._getPathCache=this.instancePath),this._getPathCache},U.prototype.getTop=function(){return this.recordParent?this.recordParent.getTop():this},U.prototype.setTransmitOK=function(){this.getLogger().setTransmitOK()},U.prototype.processImmediately=function(t){this.getLogger().processImmediately(t)},U.prototype.setTransmitNotOK=function(){this.getLogger().setTransmitNotOK()},U.prototype.cancelRecord=function(t){this.getLogger().cancelRecord(t)},U.prototype.dispose=function(){D.reset();var t=this;if(t.win||(t=t.recorder),!this.disposed){this.disposed=!0;for(var e=0;e<t.childRecorders.length;e++)t.childRecorders[e].dispose();t.eventcap&&t.eventcap.dispose(),t.lastRawMouseCoords&&(t.lastRawMouseCoords=null),t.eventcap=null,t.win=null,t.recordParent=null,t.DomUpdated.unsubscribeAll(),t.DomUpdated=null,t.logger&&(t.logger.dispose(),t.logger=null),t=null,i.Unbind("record:*")}},U.prototype.serializeDom=function(){if(this.getLogger()){var t;if(this.win==this.win.top){var r=this.win.document.body;t=D.getCacheableObject(r.innerHTML,N.getMapping(r)).uid}this.getLogger().log(this,R.EVENT_TYPES.DOM_SERIALIZE,{dom:l(this.win,this.getPath(),this.config),url:this.win.location.href.toString(),v:this.browser.agent,buid:t,start:e.startTS,tz:(new Date).getTimezoneOffset(),domloadtime:i.now()-e.startTS})}},U.prototype.getGlobalId=function(){return this.getLogger().gsessionid},U.prototype.setXFrameScrollPosition=function(t){this.ifrFrameOffset=t};var W=function(t,e){var r={};t.ACS||{};r.beginTransmitting=function(){e.beginTransmitting()},r.cancelRecord=function(){e.cancelRecord()},r.getSession=function(){var t=e.recorder.logger;return{sessionid:t.sessionid,gsessionid:t.gsessionid,sig:t.gsessionid+"/"+t.sessionid}},t.FSR||(t.FSR={}),t.ACS||(t.ACS={}),i.ext(t.ACS,r,!1)},F=function(config,t){this.config=config,this.browser=t};F.prototype.supported=function(){var t,e=this.config.advancedSettings,r=this.browser,s=this.config.blacklist,n=e.device_type_support,o=location.toString();if(!(e.browser_cutoff[r.browser.name]&&r.browser.actualVersion>=e.browser_cutoff[r.browser.name]||e.platform_cutoff[r.os.name]&&r.os.version>=e.platform_cutoff[r.os.name]))return!1;if(n&&(!n.desktop&&!r.isMobile||!n.tablet&&r.isTablet||!n.phone&&r.isMobile&&!r.isTablet))return!1;if(s&&s.active&&s.text&&s.text.length>0)for(t=0;t<s.text.length;t++)if(i.testAgainstSearch(s.text[t],o))return!1;for(t=0;t<e.device_blacklist.length;t++)if(r.agent.toLowerCase().indexOf(e.device_blacklist[t].toLowerCase())>-1)return!1;return!0};var V=null;return s.prototype.isIframe=function(){return window!=window.top},s.prototype.isCrossDomainFrame=function(){if(this.isIframe())try{var t=window.top.document.body.toString().length;return t.length<0}catch(t){return!0}return!1},s.prototype.initialize=function(t,e,s,n){"undefined"!=typeof Uint8Array&&i.Healthy(t,["cxreplay"],i.proxy(function(){var o=this.isIframe(),a=this.isCrossDomainFrame();if(!o||a){if(n&&i.ext(r.advancedSettings||{},n),this.winobj=e,this.browser=t,r&&r.instances)for(var c=0;c<r.instances.length;c++){var h=r.instances[c];if(!h.disabled){i.ext(r,h);break}}this.crit=new F(r,t),this.stg=s,s.ready.subscribe(i.proxy(function(){t.ready.subscribe(i.proxy(function(){this.crit.supported()&&(a?i.Bind(window,"message",i.proxy(function(n){if(n.data=n.data+"",n.data&&i.isFunction(n.data.indexOf)&&n.data.length>3&&n.data.indexOf("{")>-1){var o;try{o=JSON.parse(n.data)}catch(t){return}o.src&&"fsframe"==o.src||(o.cxr&&o.id?(this.recorder=new U(s,t,e,o.xp,null,r,a,o.id,n.source,o.sid,o.sp),i.Bind(window,"unload",i.proxy(function(){if(this.recorder){var t=this.recorder.ifrid;window.top.postMessage({unloadiFrame:!0,frameId:t},"*"),this.recorder.dispose(),this.recorder=null}},this))):o.cxsp&&this.recorder&&this.recorder.setXFrameScrollPosition(o.sp))}},this)):(this.recorder=new U(s,t,e,null,null,r,a),i.Bind(window,"unload",i.proxy(function(){this.recorder&&(this.recorder.dispose(),this.recorder=null)},this)),o||W(e,this)))},this),!0,!0)},this),!0,!0)}},this),function(){})},s.prototype.beginTransmitting=function(){this.recorder&&this.recorder.setTransmitOK()},s.prototype.dispose=function(){this.recorder&&(this.transmitIfCan(),this.recorder.dispose(),V=null)},s.prototype.transmitIfCan=function(){var t=this.recorder;if(t){var e=t.getLogger();e&&e.transmitting&&e._flushAndTransmit()}},s.prototype.cancelRecord=function(){this.recorder&&(this.recorder.dispose(),this.recorder=null)},s.getInstance=function(t,e,i,r){return null===V&&(V=new s(t,e,i,r)),V},s});