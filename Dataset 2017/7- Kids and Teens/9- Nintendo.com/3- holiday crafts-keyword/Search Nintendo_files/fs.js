/***************************************
* @preserve
* ForeSee Client Code: Invitation Presenter Plugin
* Built January 26, 17 16:47:22
* Code version: 19.2.0
* Template version: 19.2.0
***************************************/
("undefined"!=typeof _fsDefine?_fsDefine:define)(["require","_acs",_acsNormalizeUrl("foresee/fs.utils.v2.js"),"triggerconfig"],function(e,t,i,config){function s(e,t,i){var s,n,a,o,l=!1;return this.count=this.count?++this.count:1,s=this.count,n="load-css-"+s,a=document.createElement("link"),a.setAttribute("id",n),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),"undefined"!=typeof a.addEventListener?(a.addEventListener("load",function(){l||(l=!0,o&&clearTimeout(o),t(a))},!1),a.addEventListener("error",function(){o&&clearTimeout(o),i(a)},!1),o=setTimeout(function(){l=!0,t(a)},2e3)):"undefined"!=typeof a.attachEvent&&a.attachEvent("onload",function(){var e,s,o=document.styleSheets.length;try{for(;o--;)if(s=document.styleSheets[o],s.id===n)return e=s.cssText,l=!0,void t(a)}catch(e){}l||i(a)}),document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("href",e),a}var n,a="Func",o="ion",l=function(e,t){var i;return i=new window[a+"t"+o]("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),t?i(t):i},r=function(config,e,t,s,a,o,l){this.cfg=config,this.def=i.ext({},e),this.brwsr=t,this.locale=o.get("locale")||"en",this.displayoverride=a,n=l,this.isCustom=n.customInvitationRequested.subscriptions.length>0;var r,c={},d={};if(this.fstr=s,this.inviteStage=0,this.declined=new i.FSEvent,this.declined.subscribe(i.proxy(function(){this._removeEls()},this)),this.abandoned=new i.FSEvent,this.abandoned.subscribe(i.proxy(function(){this._removeEls()},this)),this.accepted=new i.FSEvent,this.completed=new i.FSEvent,this.completed.subscribe(i.proxy(function(e){e&&this._removeEls()},this)),this._inviteEls=[],this.def.display.desktop)for(r=0;r<this.def.display.desktop.length;r++)d=c.dialog||{},c=i.ext({},c),c=i.ext(c,this.def.display.desktop[r]),this.def.display.desktop[r].dialog&&c.dialog&&(c.dialog=i.ext(i.ext({},d),this.def.display.desktop[r].dialog)),this.def.display.desktop[r]=c;if(this.def.display.mobile)for(c={},d={},r=0;r<this.def.display.mobile.length;r++)d=c.dialog||{},c=i.ext({},c),c=i.ext(c,this.def.display.mobile[r]),this.def.display.mobile[r].dialog&&c.dialog&&(c.dialog=i.ext(i.ext({},d),this.def.display.mobile[r].dialog)),this.def.display.mobile[r]=c;var h;if(this.brwsr.isMobile)if(this.displayoverride){for(r=0;r<this.def.display.mobile.length;r++)if(this.def.display.mobile[r].displayname==this.displayoverride){h=this.def.display.mobile[r];break}}else h=this.def.display.mobile[Math.round(999999999999*Math.random())%this.def.display.mobile.length];else if(this.displayoverride){for(r=0;r<this.def.display.desktop.length;r++)if(this.def.display.desktop[r].displayname==this.displayoverride){h=this.def.display.desktop[r];break}}else h=this.def.display.desktop[Math.round(999999999999*Math.random())%this.def.display.desktop.length];h.dialog.locales&&h.dialog.locales[this.locale]&&(h.dialog=i.ext(h.dialog,h.dialog.locales[this.locale])),h=i.ext({inviteLogo:"",trackerLogo:"",siteLogoAlt:""},h),this.display=h,this.template=h.template};return r.prototype.loadResources=function(e){var n=this.display;if(this.isCustom)e();else{var a=t.makeURI("foresee/templates/"+n.template+"/main.css"),o=t.makeURI("foresee/templates/"+n.template+"/invite.html"),l=!1,r=!1,c=function(){l&&r&&e&&e()};s(a,i.proxy(function(e){l=!0,this._inviteEls.push(e),c()},this));var d=new i.JSONP({success:i.proxy(function(e){r=!0,this.invitetemplate=e,c()},this)});d.get(o)}},r.prototype._validateMobileInput=function(e){var t=document.getElementById("acsEmailSMSInput").value,s=function(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)},n=function(e){e=e.split(" ").join("");var t=/^\(?([0-9]{3})\)?[-.]?([0-9]{3})[-.]?([0-9]{4})$/;return!!(e.match(t)&&e.length<=12)},a=function(){i.removeClass(document.getElementById("acsInvalidInput"),"acsNoDisplay"),document.getElementById("acsEmailSMSInput").focus()},o=function(){i.addClass(document.getElementById("acsInvalidInput"),"acsNoDisplay"),setTimeout(function(){e(t)},250)};switch(e=e||function(){},this.display.inviteType){case"SMS":n(t)?o():a();break;case"EMAIL":s(t)?o():a();break;case"SMSEMAIL":s(t)||n(t)?o():a()}},r.prototype._switchToMobileOnExitStageInvite=function(){var e=document.querySelector("#acsMainInvite"),t=document.querySelector("#acsOnExitMobileInvite"),s=document.querySelector("#acsFullScreenContainer");s&&(i.addClass(document.body,"acsFullScreen"),i.addClass(document.documentElement,"acsFullScreen"),i.addClass(s,"acsFullScreen"),i.addClass(t,"acsClassicInvite--fullscreen")),i.addClass(e,"acsNoDisplay"),i.removeClass(t,"acsNoDisplay"),s||document.querySelector("#acsEmailSMSInput").focus(),this.inviteStage+=1},r.prototype._switchToThankYouPage=function(){var e,t=document.getElementById("acsOnExitMobileInvite"),s=document.getElementById("acsOnExitThankYou"),n=document.getElementById("acsFullScreenContainer"),a=document.getElementsByClassName("acsDeclineButton"),o=1e3*Number(this.display.dialog.onexitcounterval)||8e3,l=i.proxy(function(e){i.preventDefault(e),this.completed.fire(!0)},this);if(n){for(var r=0;r<a.length;r++)i.Unbind(a[r],"invite:click"),i.Bind(a[r],"invite:click",l),i.removeClass(a[r],"acsDeclineButton");i.removeClass(n,"__acs__input-clicked"),i.addClass(t,"acsNoDisplay"),i.removeClass(s,"acsNoDisplay"),this.closeTimeOut=setTimeout(i.proxy(function(){this.completed.fire(!0)},this),o+1e3),this.counterInterval=setInterval(i.proxy(function(){var t=document.getElementsByClassName("counter");n&&t&&(e=Number(t[0].innerHTML),t[0].innerHTML=e-1,1===Number(e)&&i.addClass(n,"__acs--complete"))},this),1e3)}this.inviteStage+=1},r.prototype._handleAcceptCurrentStage=function(){var e=document.getElementById("acsFullScreenContainer");switch(this.display.inviteType){case"TRACKER":this.accepted.fire(this.display.inviteType),this.completed.fire(!0);break;case"INSESSION":this.accepted.fire(this.display.inviteType),this.completed.fire(!0);break;case"SMS":0===this.inviteStage?this._switchToMobileOnExitStageInvite():1===this.inviteStage&&this._validateMobileInput(i.proxy(function(t){this.accepted.fire(this.display.inviteType,t),e&&this._switchToThankYouPage()},this));break;case"EMAIL":0===this.inviteStage?this._switchToMobileOnExitStageInvite():1===this.inviteStage&&this._validateMobileInput(i.proxy(function(t){this.accepted.fire(this.display.inviteType,t),e&&this._switchToThankYouPage()},this));break;case"SMSEMAIL":0===this.inviteStage?this._switchToMobileOnExitStageInvite():1===this.inviteStage&&this._validateMobileInput(i.proxy(function(t){this.accepted.fire(this.display.inviteType,t),e&&this._switchToThankYouPage()},this))}},r.prototype._removeEls=function(){var e=document.getElementById("acsFullScreenContainer"),t=i.proxy(function(){for(clearTimeout(this.closeTimeOut),clearInterval(this.counterInterval),i.removeClass(document.body,"acsFullScreen"),i.removeClass(document.documentElement,"acsFullScreen");this._inviteEls.length>0;){var e=this._inviteEls.pop();e.parentNode.removeChild(e)}i.Unbind("invite:*")},this);e?(i.addClass(e,"__acs--complete"),setTimeout(t,500)):t()},r.prototype.present=function(){i.Healthy(this.brwsr,["survey","static"],i.proxy(function(){i.HealthStatus(this.brwsr,["trust"],i.proxy(function(e){if(this.isCustom)this.inviteStage=1,n.customInvitationRequested.fire(this.display.inviteType,i.proxy(function(e){this.accepted.fire(this.display.inviteType,e),this.completed.fire(!0)},this),i.proxy(function(){this.declined.fire()},this),i.proxy(function(){this.abandoned.fire()},this));else{this.display.inviteType=this.display.inviteType.toUpperCase();var s=i.ext({supportsSVG:this.brwsr.supportsSVG,isIE8:this.brwsr.isIE&&8==this.brwsr.browser.actualVersion},this.display,this.cfg.config);s.trust=e.trust,s.inviteLogo&&s.inviteLogo.length>0&&(s.inviteLogo=t.makeURI("foresee/"+s.inviteLogo)),s.trackerLogo&&s.trackerLogo.length>0&&(s.trackerLogo=t.makeURI("foresee/"+s.trackerLogo)),s.vendorLogo&&s.vendorLogo.length>0&&(s.vendorLogo=t.makeURI("foresee/"+s.vendorLogo)),s.vendorLogoPNG&&s.vendorLogoPNG.length>0&&(s.vendorLogoPNG=t.makeURI("foresee/"+s.vendorLogoPNG)),s.trusteLogo&&s.trusteLogo.length>0&&(s.trusteLogo=t.makeURI("foresee/"+s.trusteLogo));var a=l(this.invitetemplate,s),o=document.createElement("div");o.innerHTML=a;for(var r=0;r<o.childNodes.length;r++)this._inviteEls.push(o.childNodes[r]),document.body.appendChild(o.childNodes[r]);var c=document.getElementById("acsFocusFirst"),d=document.getElementById("acsEmailSMSInput"),h=function(e){var t;if(e){if(i.hasClass(e,"acsClassicInvite--placeholder"))return e;for(var s=e.parentNode.childNodes,n=0;n<s.length;n++)if(i.hasClass(s[n],"acsClassicInvite--placeholder")){t=s[n];break}if(!t)for(var a=e.childNodes,o=0;o<a.length;o++)if(i.hasClass(a[o],"acsClassicInvite--placeholder")){t=a[o];break}}return t},p=document.getElementById("acsMainInvite"),u=document.getElementById("acsFullScreenContainer");if(c&&c.focus(),i.Bind(document.body,"invite:focus",function(e){e=e||window.event;var t=e.target||e.srcElement;p.contains(t)||u||c&&(e.stopPropagation(),c.focus())},!1),s.isIE8){var f=document.querySelectorAll(".acsIE8VerticalCenter");if(f.length>0){var m=function(){for(var e=0;e<f.length;e++){var t=f[e],i=t.parentNode,s=i.offsetHeight,n=t.offsetHeight;t.style.top=(s-n)/2+"px"}};m(),setInterval(m,500)}}for(var v=document.querySelectorAll(".acsDeclineButton"),y=i.proxy(function(e){i.preventDefault(e),this.declined.fire()},this),g=0;g<v.length;g++)i.Bind(v[g],"invite:click",y);for(var b=document.querySelectorAll(".acsAcceptButton"),I=document.getElementsByClassName("acsSubmitBtn"),E=document.getElementsByClassName("acsClassicInvite--fullscreen__container"),C=document.getElementsByClassName("acsClassicInner--description"),S=i.proxy(function(e){var t=e.target||e.srcElement;if(u){i.addClass(E[0],"acsClassicInvite--fullscreen__input-clicked");var s=h(t);s&&i.addClass(s,"acsClassicInvite--placeholder__clicked"),i.addClass(u,"__acs__input-clicked")}},this),_=i.proxy(function(e){var t=e.target||e.srcElement,s=t.value.replace(/\s/g,""),n=e.keyCode||e.which;s.length>0&&27!==n&&i.hasClass(I[0],"acsClassicInner--btn__grey")&&i.removeClass(I[0],"acsClassicInner--btn__grey")},this),k=i.proxy(function(e){i.preventDefault(e);var t=e.target||e.srcElement;if(i.hasClass(t,"acsEmailInput")||i.hasClass(t.parentNode,"acsEmailInput")){var s=document.getElementsByClassName("acsClassicInvite--placeholder")[0];s&&(s.innerHTML=this.display.dialog.emailPlaceholder||""),d.type="text",i.hasClass(d,"acsClassicInvite__input--spaced")&&i.removeClass(d,"acsClassicInvite__input--spaced"),document.getElementById("acsInvalidInput").innerHTML=this.display.dialog.emailInvalidation||"",this.display.dialog.emailDisclaimer?C[0].innerHTML=this.display.dialog.emailDisclaimer:i.addClass(C[0],"acsNoDisplay")}i.hasClass(t,"acsClassicInner--btn__grey")||this._handleAcceptCurrentStage()},this),x=0;x<b.length;x++)i.Bind(b[x],"invite:click",k);u&&(i.Bind(d,"invite:focus",S),i.Bind(d,"invite:keydown",_)),this.__kpEscape=i.proxy(function(e){27==e.keyCode&&(i.preventDefault(e),this.declined.fire())},this),i.Bind(document.body,"invite:keydown",this.__kpEscape);for(var T=document.querySelectorAll(".acsAbandonButton"),w=i.proxy(function(e){for(var t=e.target||e.srcElement,n=!1;t;){if(t.tagName&&"A"==t.tagName&&i.hasClass(t,"acsAllowDefault")){n=!0;break}t=t.parentNode}n||i.preventDefault(e);var a=e.target||e.srcElement;i.hasClass(a,"acsAbandonButton")&&("true"!=a.getAttribute("data-isbackdrop")||s.closeClickOnBackdrop)&&this.abandoned.fire()},this),B=0;B<T.length;B++)i.Bind(T[B],"invite:click",w)}},this))},this))},r.prototype.dispose=function(){this.disposed||(this.disposed=!0,this._removeEls(),i.Unbind("invite:*"))},r});