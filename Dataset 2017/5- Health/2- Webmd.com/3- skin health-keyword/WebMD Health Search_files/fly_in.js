define(["jquery/1/jquery","css!fly_in/2/fly_in.css"],function(){function a(){l.after('<div id="'+u.flyin_element_id+'" data-metrics-module="prm-flyin"></div>'),m=$("#"+u.flyin_element_id),$(window).on("scroll",b),b()}function b(){var a=$(window).scrollTop()+$(window).height(),b=2400,e=l.offset().top-b;a>=e?o&&c():o||d()}function c(){return p?(o=!1,m.stop().animate({right:"0px"},u.speed),void wmdPageLink("prm-flyin")):(r||e(),f(s),!1)}function d(){m.stop().animate({right:"-524px"},u.speed),o=!0}function e(){var a=!0,b=webmd.cookie.getJson("ui");r=!0,b.aca_p1?b.aca_p1+=1:b.aca_p1=1,b.aca_p1>u.max_display_times&&"1"!==webmd.url.getParam("flyin")&&(a=!1),webmd.cookie.setJson("ui",b,{domain:webmd.url.getSLD()}),s=a}function f(a){var b="";if(!a)return j(),!1;if(!p&&!q){if(q=!0,u.start_time&&u.end_time)return window.webmd.flyin({Start:u.start_time,End:u.end_time}),!1;b+="http://apiv1.scribblelive.com/event/"+u.scribblelive_id+"/?Token=QdWW9RSf&format=json&callback=webmd.flyin",webmd.load({js:b})}}function g(){var a=webmd.cookie.getJson("ui");a.aca_p1=u.max_display_times,webmd.cookie.setJson("ui",a,{domain:webmd.url.getSLD()})}function h(){require(["repository_service/1/service"],function(a){var b=a.get({module:u.dctm_id,timeout:1e4});b.done(function(a){n=a||{},i()}),b.fail(function(){j()})})}function i(){var a,b,d="",e=[];d=t?"Happening Now":0===u.days_left?"Live Event Today":1===u.days_left?"Live Event Tomorrow":"Live Event in "+u.days_left+" days",a=webmd.object.get("webmd_rendition.referenced_objects.object",n),a&&a.length?$.each(a,function(a,b){e[b["@chronic_id"]]=b.target["@friendlyurl"]}):e[a["@chronic_id"]]=a.target["@friendlyurl"],b=webmd.object.get("webmd_rendition.content.wbmd_asset.webmd_module.module_data.links.link",n)||"",replacement={title:webmd.object.get("webmd_rendition.content.wbmd_asset.webmd_module.module_data.module_title",n)||"",when:d,text:webmd.object.get("webmd_rendition.content.wbmd_asset.webmd_module.module_data.descriptions.description.0.description_text",n)||"",link1:"",link2:"",link3:""},webmd.object.get("0.link_text",b)&&webmd.object.get("0.link_url.@chronic_id",b)&&(replacement.link_1=webmd.substitute(u.ctaLinkTemplate,{link_url:e[webmd.object.get("0.link_url.@chronic_id",b)],link_text:webmd.object.get("0.link_text",b),link_metrics:"1"})),webmd.object.get("1.link_text",b)&&webmd.object.get("1.link_url.@chronic_id",b)&&(replacement.link_2=webmd.substitute(u.ctaLinkTemplate,{link_url:e[webmd.object.get("1.link_url.@chronic_id",b)],link_text:webmd.object.get("1.link_text",b),link_metrics:"2"})),webmd.object.get("2.link_text",b)&&webmd.object.get("2.link_url.@chronic_id",b)&&(replacement.link_3=webmd.substitute(u.ctaLinkTemplate,{link_url:e[webmd.object.get("2.link_url.@chronic_id",b)],link_text:webmd.object.get("2.link_text",b),link_metrics:"3"})),u.days_left>0&&(replacement.link_1=""),m.html(webmd.substitute(u.inner_html,replacement)),m.find(".close a").click(function(a){a.preventDefault(),g(),j()}),p=!0,c()}function j(){$(window).off("scroll",b),d()}function k(){require(["repository_service/1/service"],function(b){var c=b.get({module:u.dctm_id,timeout:1e4});c.done(function(b){n=b||{},u.scribblelive_id=webmd.object.get("webmd_rendition.content.wbmd_asset.webmd_module.module_data.descriptions.description.1.description_text",n),u.start_time=webmd.object.get("webmd_rendition.content.wbmd_asset.webmd_module.module_data.descriptions.description.2.description_text",n),u.end_time=webmd.object.get("webmd_rendition.content.wbmd_asset.webmd_module.module_data.descriptions.description.3.description_text",n),a()}),c.fail(function(){j()})})}var l,m,n,o=!0,p=!1,q=!1,r=!1,s=!1,t=!1,u={flyin_element_id:"flyinElement",ctaLinkTemplate:'<a href="{link_url}" data-metrics-link="{link_metrics}">{link_text}</a>',inner_html:'<div class="top"><h3>{title}</h3></div><div class="middle"><h4>{when}</h4><p>{text}</p></div><div class="bottom">{link_1}{link_2}{link_3}</div><div class="close"><a href="#" data-metrics-link="cls" data-metrics-type="ad-hoc">Close</a></div>',days_left:999,full_days_to_display:2,max_display_times:2,speed:500,scribblelive_id:"",dctm_id:"091e9c5e80d07ec9",start_time:"",end_time:""};return window.webmd.flyin=function(a){var b,c,d=new Date,e=6e4,f=60*e*24;"object"==typeof a&&(b=+a.Start.match(/\d{13}/)[0],c=+a.End.match(/\d{13}/)[0],u.days_left=Math.floor(b/f)-Math.floor((d-d.getTimezoneOffset()*e)/f),u.days_left<=u.full_days_to_display&&b>d?h():d>=b&&c>d?(t=!0,h()):"1"===webmd.url.getParam("flyin")?h():j())},{init:function(a){l=$(a),l.length&&window.webmd&&window.image_server_url&&""===window.s_sponsor_program&&""===window.s_sponsor_brand&&k()},options:u}});