define("lib/hbTemplate!storefront/templates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<script type='text/template' id='internal-link'>\n  <% if (typeof _class === 'undefined') { %>\n    <% var _class = ''; %>\n  <% } %>\n  <% if (typeof title === 'undefined') { %>\n    <% var title = ''; %>\n  <% } %>\n  <% var store_root = store_root || '' %>\n  <a href=\"<%= store_root %><%= href %>\"\n     class=\"js-internal-store-link <%= _class %>\"\n     title=\"<%= title %>\"\n  <% if (typeof target !== 'undefined') { %>\n      target=\"<%- target %>\"\n  <% } %>\n  >\n</script>\n\n<script type='text/template' id='monthly-discount-notification'>\n  <div class=\"monthly-discount-notification\">\n    <img src=\"xSTATIC_URLx/static/hashed/6870c22a05a51295440393258418d20c881083a6.png\" height=22 width=170 alt=\"Humble Monthly\">\n    <% if (is_monthly_subscriber) { %>\n      <% if (!is_monthly_paused) { %>\n        <p><i class=\"hb hb-check\"></i> Subscribed! You get 10% off at checkout. <a href=\"#\" class=\"tooltip-bottom info-tooltip\" data-tooltip=\"<%= tooltip_text %>\"><i class=\"hb hb-support\"></i></a></p>\n      <% } else { %>\n        <p><i class=\"hb hb-times\"></i> Subscription paused; your 10% discount is disabled.</p>\n        <a href=\"/user/settings\" target=_blank class=\"green button\">Resume</a>\n      <% } %>\n    <% } else { %>\n    <p><i class=\"hb hb-tag\"></i> Get 10% off Humble Store purchases! <a href=\"#\" class=\"tooltip-bottom info-tooltip\" data-tooltip=\"<%= tooltip_text %>\"><i class=\"hb hb-support\"></i></a></p>\n    <a href=\"/monthly?hmb_source=store&hmb_medium=cta_cross&hmb_campaign=store_promo_1\" target=_blank class=\"green button\">Subscribe</a>\n    <% } %>\n  </div>\n</script>\n\n<script type='text/template' id='daily-sale-info'>\n  <div class='sale-info'>\n    <div class='sale-info-container-outer'>\n      <div class='sale-info-container-inner'>\n        <i class='hb hb-bundle'></i>\n        <span class='sale-description hide-on-hover'>Daily Deal</span>\n        <span class='js-sale-timer show-on-hover'></span>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='wishlist-icon'>\n  <div class=\"wishlist-icon js-wishlist-button\">\n<% if (on_wishlist) { %>\n    <i class=\"hb hb-star\"></i><span class=\"wishlist-hover\">Remove from Wish List</span>\n<% } else { %>\n    <i class=\"hb hb-star-o\"></i><span class=\"wishlist-hover\">Add to Wish List</span>\n<% } %>\n<% if (show_login_prompt) { %>\n    <div class=\"wishlist-login\"><a href=\"#\" class=\"js-login-button\">Login</a> to add this to your wish list.</div>\n<% } %>\n  </div>\n</script>\n\n<script type='text/template' id='wishlist-button'>\n  <div class=\"wishlist-button\">\n    <button type=\"button\" class=\"js-wishlist-button\">\n      <% if (on_wishlist) { %>\n      <div class=\"wishlist-not-hover\">\n        <i class=\"hb hb-star\"></i> On Wish List\n      </div>\n      <div class=\"wishlist-on-hover\">\n          <i class=\"hb hb-star\"></i> Remove from Wish List\n      </div>\n      <% } else { %>\n      <i class=\"hb hb-star-o\"></i> Add to Wish List\n      <% } %>\n    </button>\n<% if (show_login_prompt) { %>\n    <div class=\"wishlist-login\"><a href=\"#\" class=\"js-login-button\">Login</a> to add this to your wish list.</div>\n<% } %>\n  </div>\n</script>\n\n<script type='text/template' id='flash-sale-info'>\n  <div class='sale-info'>\n    <div class='sale-info-container-outer'>\n      <div class='sale-info-container-inner'>\n        <i class='hb hb-lightning'></i>\n        <span class='js-sale-timer'></span>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='sale-info'>\n<% if (display_timer) { %>\n  <div class='sale-info show-on-hover'>\n    <div class='sale-info-container-outer'>\n      <div class='sale-info-container-inner'>\n        <i class='hb hb-clock'></i> <span class='js-sale-timer'></span>\n      </div>\n    </div>\n  </div>\n<% } %>\n</script>\n\n<script type=\"text/template\" id=\"storefront-grid-carousel\">\n  <div>\n    <div class=\"grid-carousel\">\n      <div class=\"grid-carousel-contents\" id=\"js-grid-carousel-contents\"></div>\n      <div class=\"grid-carousel-arrow arrow-left\" data-idx=\"-1\"></div>\n      <div class=\"grid-carousel-arrow arrow-right\" data-idx=\"1\"></div>\n    </div>\n    <div class=\"grid-carousel-dots\">\n      <i class=\"hb hb-circle grid-carousel-dot selected-item\" id=\"grid-carousel-dot0\" data-idx=\"0\"></i>\n<% for (var i = 1; i < carousel_contents.length; i++) { %>\n      <i class=\"hb hb-circle grid-carousel-dot\" id=\"grid-carousel-dot<%- i %>\" data-idx=\"<%- i %>\"></i>\n<% } %>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-grid-product'>\n  <% var classes = 'product-details-link'; %>\n  <% if (on_sale) { %>\n    <% classes += ' product-' + sale_type + '-sale'; %>\n  <% } %>\n  <% if (type === 'product' && wallet_reload) { %>\n  <div class='<%= classes %>'>\n  <% } else { %>\n    <% if (layout_type === 'recommendation') { %>\n      <% var link_params = 'hmb_source=' + hmb_tracking.hmb_source + '&hmb_medium=' + hmb_tracking.hmb_medium + '&hmb_campaign=' + hmb_tracking.hmb_campaign; %>\n      <% if (link.indexOf('?') == -1) { %>\n        <% link += '?' + link_params %>\n      <% } else { %>\n        <% link += '&' + link_params %>\n      <% } %>\n    <% }%>\n    <% include('internal-link', {'href': link, '_class': classes}) %>\n  <% } %>\n    <img class='product-image' alt='' src=\"<%- featured_image %>\"/>\n    <div>\n    <% if (on_sale) { %>\n      <% if (sale_type == 'daily') { %>\n      <p class='sale-desc'>\n        This Daily Sale ends soon!\n      </p>\n      <% } else if (sale_type == 'flash') { %>\n      <p class='sale-desc'>\n        This Flash Sale ends soon!\n      </p>\n      <% } %>\n    <% } %>\n      <div class='product-details-preview'>\n        <div class='show-on-hover'>\n          <p class='game_name'>\n            <span class='js-product-title-anchor' title='<%- human_name %>'><%- human_name %></span>\n          </p>\n          <%= render_platform_icons(icon_dict, 'light white') %>\n          <p class='more-info'>\n    <% if (type == 'page') { %>\n            See the games!\n    <% } else { %>\n            View trailer &amp; description...\n    <% } %>\n          </p>\n        </div>\n      </div>\n\n    <% if (promotional_message) { %>\n      <div class='promotional-message'>\n        <h4>\n          <%- promotional_message %>\n        </h4>\n      </div>\n    <% } %>\n\n      <div class='product-info-bar'>\n    <% if (on_sale && sale_type == 'daily' && layout_type != 'recommendation') { %>\n        <% include('daily-sale-info') %>\n    <% } else if (on_sale && sale_type == 'flash' && layout_type != 'recommendation') { %>\n        <% include('flash-sale-info') %>\n    <% } else { %>\n      <% var cta_classes = ''; %>\n      <% if (on_sale && layout_type != 'recommendation') { %>\n        <% if (display_timer) { %>\n          <% cta_classes = 'hide-on-hover'; %>\n        <% } %>\n        <% include('sale-info') %>\n      <% } %>\n      <% if (cta_badge) { %>\n      <span class='cta-badge <%= cta_badge %> <%= cta_classes %>'>\n        <%= cta_text %>\n      </span>\n      <% } %>\n    <% } %>\n      <% include('action-button') %>\n      </div>\n    </div>\n  <% if (type === 'product' && wallet_reload) { %>\n  </div>\n  <% } else { %>\n  </a>\n  <% } %>\n</script>\n\n<script type='text/template' id='action-button'>\n  <div class='action-button'>\n  <% var classes = ''; %>\n  <% var button_text = ''; %>\n  <% if (on_sale) { %>\n    <% var percent_off = Math.round(100.0 * ((full_price[0] - current_price[0]) / full_price[0])); %>\n  <% } %>\n\n  <% var text_class = 'text'; %>\n  <% if (!can_be_purchased || type === 'bundle') { %>\n    <% button_text = get_string('VIEW'); %>\n  <% } else { %>\n\n    <% if (display_as_free) { %>\n      <% button_text = get_string('FREE'); %>\n      <% classes += ' on-sale'; %>\n    <% } else { %>\n      <% button_text = button_text || moneyfmt(current_price, null, false, usd_postfix); %>\n      <% text_class += ' store-price'; %>\n    <% } %>\n\n    <% if (on_sale && !display_as_free) { %>\n      <span class='discount'>-<%= percent_off %>%</span>\n      <% classes += ' on-sale'; %>\n    <% } %>\n\n    <% if (territory_allowed) { %>\n      <% classes += ' has-cart js-add-to-cart'; %>\n    <% } else { %>\n      <% classes += ' js-show-product-details'; %>\n    <% } %>\n\n  <% } %>\n    <div class='store-item-button js-action-button <%= classes %>'>\n      <span>\n        <i class='hb hb-shopping-cart'></i>\n        <span class='<%- text_class %>'>\n          <%= button_text %>\n        </span>\n        <span class='view-text'>\n          <%= get_string('VIEW') %>\n        </span>\n        <span class='add-to-cart-text'>\n          <%= get_string('ADD_TO_CART') %>\n        </span>\n        <span class='in-cart-text'>\n          <%= get_string('IN_CART') %>\n        </span>\n      </span>\n  <% if (type === 'product' && !wallet_reload) { %>\n      <div class='wishlist-holder js-wishlist-holder'></div>\n  <% } %>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-product-details-no-details'>\n  <div class='gate visible'>\n    <div class='center-container'>\n      Sorry, further details are unavailable at this time.\n    </div>\n  </div>\n  <div class='column1'></div>\n  <div class='column2'></div>\n</script>\n\n\n<script type='text/template' id='storefront-list-product'>\n  <% var classes = 'product-details-link'; %>\n  <% if (on_sale) { %>\n    <% classes += ' product-' + sale_type + '-sale'; %>\n  <% } %>\n  <% if (type === 'bundle') { %>\n  <a href='<%- bundle_path %>' class='<%- classes %>'>\n  <% } else { %>\n    <% include('internal-link', {'href': link, '_class': classes}) %>\n  <% } %>\n    <div class='scrollable-wrapper' title='<%- human_name %>'>\n      <img class='product-image' src='<%- icon %>' alt=''/>\n      <div class='product-list-wrapper'>\n        <div class='buy-button'>\n  <% include('action-button') %>\n        </div>\n          <div class='product-title-and-description'>\n            <h2 class=\"product-title\"><%- human_name %></h2>\n          </div>\n        <div class='platforms-wrapper'>\n  <% if (cta_badge) { %>\n          <%= render_platform_icons(icon_dict).trim() %><span class='cta-text <%= cta_badge %>'><%= cta_text %></span>\n  <% } else { %>\n          <%= render_platform_icons(icon_dict) %>\n  <% } %>\n        </div>\n      </div>\n    </div>\n  </a>\n</script>\n\n<script type='text/template' id=\"storefront-wishlist-product\">\n <% var classes = 'product-details-link'; %>\n  <% if (on_sale) { %>\n    <% classes += ' product-' + sale_type + '-sale'; %>\n  <% } %>\n   <div class='wishlist-grabber'>\n  <% if (options.editable) { %>\n    <i class=\"hb hb-ellipsis-v\"></i>\n  <% } %>\n    <span class=\"wishlist-index\"><%- index %></span>\n  </div>\n  <% if (type === 'bundle') { %>\n  <a href='<%- bundle_path %>' class='<%- classes %>'>\n  <% } else { %>\n    <% include('internal-link', {'href': link, '_class': classes}) %>\n  <% } %>\n    <div class='scrollable-wrapper' title='<%- human_name %>'>\n      <img class='product-image' src='<%- icon %>' alt=''/>\n\n      <div class='product-list-wrapper'>\n  <% if (options.editable) { %>\n        <span class=\"remove-wishlist\">\n          <i class=\"hb hb-close\"></i>\n        </span>\n  <% } %>\n        <div class='buy-button'>\n  <% include('action-button') %>\n        </div>\n          <div class='product-title-and-description'>\n            <h2 class=\"product-title\"><%- human_name %></h2>\n          </div>\n        <div class='platforms-wrapper'>\n  <% if (cta_badge) { %>\n          <%= render_platform_icons(icon_dict).trim() %><span class='cta-text <%= cta_badge %>'><%= cta_text %></span>\n  <% } else { %>\n          <%= render_platform_icons(icon_dict) %>\n  <% } %>\n        </div>\n      </div>\n    </div>\n  </a>\n</script>\n\n<script type=\"text/template\" id=\"wishlist\">\n  <div class=\"wishlist-header-container\"></div>\n  <div class=\"wishlist-item-container\"></div>\n</script>\n\n<script type='text/template' id='wishlist-header'>\n  <div class=\"wishlist-header\">\n    <span class=\"wishlist-name\">\n<% if (title_selected) { %>\n      <input name=\"title\" value=\"<%- title %>\" />\n<% } else { %>\n      <%- title %>\n    <% if (editable) { %><i class=\"wishlist-edit-title hb hb-pencil\"></i><% } %>\n<% } %>\n    </span>\n    <span class=\"wishlist-share\">\n      <% if (editable) { %><label>Share Wish List <input type=\"checkbox\" name=\"share\" <% if (share) { %>checked=\"checked\"<% }%>/></label><% } %>\n      <% if (share) { %>\n      <span class=\"wishlist-share-social-media\">\n        <a target=\"_blank\" href=\"mailto:?to=&subject=My Humble Store Wish List&body=<%- url %>\"><i class=\"hb hb-envelope\"></i></a>\n        <a target=\"_blank\" href=\"https://www.facebook.com/sharer/sharer.php?u=<%- url %>\"><i class=\"hb hb-facebook\"></i></a>\n        <a target=\"_blank\" href='http://twitter.com/share?url=<%- url %>&via=humblestore&text=My Humble Store Wish List:'><i class=\"hb hb-twitter\"></i></a>\n        <a target=\"_blank\" href=\"https://plus.google.com/share?url=<%- url %>\"><i class=\"hb hb-google-plus\"></i></a>\n      </span>\n      <% } %>\n    </span>\n  </div>\n</script>\n\n<script type='text/template' id='wishlist-empty'>\n  <div class='scrollable-wrapper empty-product'>\n    <div class='product-list-wrapper'>\n      <div class='product-title-and-description'>\n        <h2>Wish list is empty.</h2>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='wishlist-other-empty'>\n  <div class='scrollable-wrapper empty-product'>\n    <div class='product-list-wrapper'>\n      <div class='product-title-and-description'>\n        <h2>This wish list is empty.</h2>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-list-empty-product'>\n  <div class='scrollable-wrapper empty-product'>\n    <div class='product-list-wrapper'>\n      <div class='product-title-and-description'>\n        <span class=\"product-title\">Sorry, we could not find what you were looking for!</span>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-demo-trailer-switcher'>\n  <div class=\"media-container\">\n<% include('storefront-asm-demo') %>\n<% include('storefront-youtube-trailer') %>\n  </div>\n  <div class=\"media-selection-container\">\n    <div class=\"show-demo js-show-demo js-show-demo-selected media-selection-item media-selection-arrow media-selection-item-selected\">\n      <span><i class=\"hb hb-library\"></i> Play Demo</span>\n    </div>\n    <div class=\"show-trailer js-show-trailer media-selection-item\">\n      <span><i class=\"hb hb-youtube\"></i> Watch Trailer</span>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-product-carousel'>\n  \n<% var asm_demos = (asm_demo_machine_name)?[asm_demo_machine_name]:[];\nvar youtube_links = (youtube_link)?[youtube_link]:[];\nvar screenshots = [];\nvar content_index = 0;\nvar icon_queue = [];\nvar carousel_content_count = 1;\n\n_.each(carousel_content, function(list, key) {\n  _.each(list, function(val) {\n    carousel_content_count++;\n    if (key === 'asm-demo-machine-name') {\n      asm_demos.push(val)\n    } else if (key === 'youtube-link') {\n      youtube_links.push(val);\n    } else if (key === 'screenshot') {\n      screenshots.push(val);\n    }\n  });\n});%>\n  <div class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#carousel-content_anchor\"></div>\n  <div class=\"carousel-viewport\">\n    <div class='carousel-content' style=\"width: <%= carousel_content_count * youtubeWidth %>px;\">\n  \n<% _.each(asm_demos, function(val, idx) {\n  icon_queue.push({'icon':'hb-gamepad', 'type':'demo'});\n  asm_demo_machine_name = val; %>\n      <div class='carousel-item js-carousel-item' id='js-carousel-item-<%- content_index%>'>\n  <% include('storefront-carousel-asm-demo', {'asmWidth': youtubeWidth - 50 }) %>\n      </div>\n  <% content_index++; %>\n<% }); %>\n\n<% _.each(youtube_links, function(val, idx) {\n  icon_queue.push({'icon':'hb-play', 'link':val, 'type':'video'});\n  youtube_link = val; %>\n      <div class='carousel-item js-carousel-item' id='js-carousel-item-<%- content_index%>'>\n  <% include('storefront-youtube-trailer') %>\n      </div>\n  <% content_index++; %>\n<% }); %>\n\n<% _.each(screenshots, function(val) {\n  icon_queue.push({'icon': false, 'link': val.thumb, 'type':'screenshot'});  // icon: hb-picture-o, if want to go back to screenshot icon\n  var storefront_preview_image = val.compressed_image ? val.compressed_image : STATIC_URL + val.image; %>\n    <div class='carousel-item js-carousel-item' id='js-carousel-item-<%- content_index%>'>\n  <% if (content_index === 0) { %>\n      <img class='preview-image' src='<%- storefront_preview_image %>'>\n  <% } else { %>\n      <img class='preview-image js-lazy-load' data-original='<%- storefront_preview_image %>'>\n  <% } %>\n    </div>\n    <% content_index++; %>\n<% }); %>\n    </div>\n    <div class='carousel-arrow js-carousel-arrow arrow-right' id='js-next-carousel' data-carousel='1'></div>\n    <div class='carousel-arrow js-carousel-arrow arrow-left' id='js-prev-carousel' data-carousel='-1'></div>\n  </div>\n  <div class='carousel-button-wrapper'>\n    <div class='carousel-button-container'>\n<% for (var idx = 0; idx < content_index; idx++) { %>\n      <div class='carousel-button<%- (idx === 0)?' selected':'' %> js-carousel-button' data-carousel='<%- idx %>'\n  <% if (icon_queue[idx].type === 'video') { %>\n        style=\"background-image:url('https://img.youtube.com/vi/<%- icon_queue[idx].link %>/default.jpg');\" >\n  <% } else if (icon_queue[idx].type === 'demo') { %>\n        style=\"background-color:black;\" >\n  <% } else if (icon_queue[idx].type === 'screenshot') { %>\n        style=\"background-image:url('<%= icon_queue[idx].link %>');\" >\n  <% } %>\n  <% if (icon_queue[idx].icon) { %>\n        <div class=\"icon-backer\">\n          <span class=\"hb <%- icon_queue[idx].icon %>\"></span>\n        </div>\n  <% } %>\n      </div>\n<% } %>\n    </div>\n  </div>\n  <hr class=\"carousel-break\">\n  <br>\n</script>\n\n<script type='text/template' id='storefront-asm-demo'>\n  <div class='asm-demo js-asm-demo asm-demo-selected js-controlled-content trailer js-admin-edit'\n       data-entity-kind='display_item' data-anchor-name='#asm-demo-machine-name_anchor' width='<%= youtubeWidth %>' height='<%= youtubeHeight %>'>\n    <iframe id='asm-demo' class='asm-iframe' width='<%= youtubeWidth %>' frameborder='0' allowfullscreen scrolling='no' src=\"/play/<%= asm_demo_machine_name %>/demo\"></iframe>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-carousel-asm-demo'>\n  <div class='asm-demo js-asm-demo asm-demo-selected js-controlled-content trailer' width='<%= youtubeWidth %>' height='<%= youtubeHeight %>'>\n    <iframe id='asm-demo' class='asm-iframe' width='<%= asmWidth %>' frameborder='0' allowfullscreen scrolling='no' src=\"/play/<%= asm_demo_machine_name %>/demo?width=<%= asmWidth %>&height=<%= youtubeHeight %>\"></iframe>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-youtube-trailer'>\n  <div id=\"youtube-trailer-container\" class='youtube-trailer js-youtube-trailer js-controlled-content trailer' width='<%= youtubeWidth %>' height='<%= youtubeHeight %>'>\n    <iframe class='youtube-embed js-youtube-embed' allowfullscreen width='<%= youtubeWidth %>' height='<%= youtubeHeight %>' src='//www.youtube.com/embed/<%- youtube_link %>?rel=0&iv_load_policy=3&wmode=transparent&showinfo=0&enablejsapi=1'></iframe>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-product-details'>\n<%\n  // TODO: Set the schema type correctly based on the Product.media_type if non-videogame products in the store ever exceed 0.1%\n%>\n  <div itemscope itemtype=\"http://schema.org/Product http://schema.org/VideoGame\">\n    <meta itemprop=\"applicationCategory\" content=\"Game\">\n    <div class=\"product-title <%- priceAfterMonthlyDiscount ? 'has-monthly-discount' : '' %>\">\n      <h2 itemprop=\"name\" class=\"js-admin-edit\" data-entity-kind=\"product\" data-anchor-name=\"#human_name\"><%- human_name %></h2>\n      <link href=\"<%= base_url_secure + '/store/' + human_url %>\" itemprop=\"url\">\n      <div class=\"price-and-add-to-cart\">\n  <% var classes = ''; %>\n  <% if (can_be_purchased && !display_as_free) { %>\n    <% if (on_sale) { %>\n        <s><%- moneyfmt(full_price, null, false, usd_postfix) %></s>\n        <% classes += 'sale'; %>\n    <% } %>\n        <span class=\"store-price <%= classes %> js-admin-edit\" data-entity-kind=\"product\" data-anchor-name=\"#row_pricing\" itemprop=\"offers\" itemscope itemtype=\"http://schema.org/Offer\">\n          <%- moneyfmt(current_price, null, false, usd_postfix) %>\n          <meta itemprop=\"price\" content=\"<%- current_price[0] %>\">\n          <meta itemprop=\"priceCurrency\" content=\"<%- current_price[1] %>\">\n          <link itemprop=\"availability\" href=\"<%- availability %>\">\n        </span>\n    <% if (priceAfterMonthlyDiscount) { %>\n        <span class=\"store-price coupon-price\">\n          +\n          <img class=\"hb-monthly-icon\" src=\"xSTATIC_URLx/static/hashed/066320274df9b3f00625bcbb409350caca41bebc.png\" alt=\"Humble Monthly\">\n          10% Monthly Discount =\n          <%- moneyfmt(priceAfterMonthlyDiscount, null, false, usd_postfix) %>\n        </span>\n    <% } %>\n  <% } else if (!can_be_purchased) { %>\n        <span class='coming-soon'>\n          This game is coming soon!\n        </span>\n  <% } else if (display_as_free) { %>\n        <% classes += 'sale'; %>\n        <s><%- moneyfmt(full_price, null, false, usd_postfix) %> </s>\n        <span class=\"store-price <%= classes %> js-admin-edit\" data-entity-kind=\"product\" data-anchor-name=\"#row_pricing\" itemprop=\"offers\" itemscope itemtype=\"http://schema.org/Offer\">\n          <%- moneyfmt(0, full_price[1], false, usd_postfix) %>\n          <meta itemprop=\"price\" content=\"0\">\n          <meta itemprop=\"priceCurrency\" content=\"<%- full_price[1] %>\">\n          <link itemprop=\"availability\" href=\"<%- availability %>\">\n        </span>\n  <% }%>\n\n  <% if (can_be_purchased) { %>\n    <% if (territory_allowed) { %>\n        <button class=\"js-action-button js-add-to-cart green button light-background\">\n          <i class=\"hb hb-shopping-cart\"></i>\n          <span class='add-to-cart-text'>\n            <%= get_string('ADD_TO_CART') %>\n          </span>\n          <span class='in-cart-text'>\n            <%= get_string('IN_CART') %>\n          </span>\n        </button>\n    <% } else { %>\n        <button class=\"button gray light-background\">\n          <span class=\"text js-button-text\">Unavailable</span>\n        </button>\n    <% } %>\n  <% } %>\n      </div>\n    </div>\n\n  <% /* ENG-8059 holder for the custom product page visuals */ %>\n    <div class=\"custom-visuals-banner\"></div>\n\n    <% var mainWidth = 940, youtubeWidth = 578, youtubeHeight = 335;\n       var sidebarWidth = 940 - youtubeWidth - 20;\n       // The '20' was determined through trial and error\n    %>\n\n    <div class='product-main-information' style='width: <%= youtubeWidth %>px;'>\n    <% if (carousel_content) { %>\n      <% include('storefront-product-carousel') %>\n    <% } else if (asm_demo_machine_name && youtube_link) { %>\n      <% include('storefront-demo-trailer-switcher') %>\n    <% } else if (youtube_link) { %>\n      <div class='js-controlled-content trailer js-admin-edit' data-entity-kind='display_item' data-anchor-name='#youtube-link_anchor' width='<%= youtubeWidth %>' height='<%= youtubeHeight %>'>\n        <iframe class='youtube-embed' allowfullscreen width='<%= youtubeWidth %>' height='<%= youtubeHeight %>' src='//www.youtube.com/embed/<%- youtube_link %>?rel=0&iv_load_policy=3&wmode=transparent&showinfo=0'></iframe>\n      </div>\n    <% } else if (storefront_preview_image) { %>\n      <div class=\"preview-image\" style=\"background-image:url(<%- storefront_preview_image.compressed_image ? storefront_preview_image.compressed_image : STATIC_URL + storefront_preview_image.image %>)\"></div>\n    <% } %>\n      <div class=\"product-alerts-and-description\">\n        <meta itemprop=\"description\" content=\"<%- stripped_description.substr(0, 297) + (stripped_description.length > 297 ? '...' : '') %>\">\n        <div class=\"product-alerts\"></div>\n        <div class=\"product-information\">\n          <%= key_status_message %>\n          <%= disclaimer %>\n        </div>\n        <div class=\"product-description js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#description-text_anchor\">\n          <div class=\"editable-html\">\n            <%= description %>\n          </div>\n        </div>\n      </div>\n    <% // The close tag of one element and the open tag of the other are on the\n       // same line here because these are both `display: inline-block`\n    %>\n      <% include('product-recommendations') %>\n    </div><% include('product-sidebar-information') %>\n\n  </div>\n</script>\n\n<script type=\"text/template\" id=\"product-recommendations\">\n  <div class=\"js-product-recommendations product-recommendations\">\n    <h2 class=\"js-recommendation-title\"></h2>\n    <div class=\"js-recommended-products\"></div>\n  </div>\n</script>\n\n<script type='text/template' id='product-sidebar-information'>\n  <div class=\"product-sidebar-information\" style=\"width: <%= sidebarWidth %>px;\">\n    <div class=\"content-holder\">\n  <% if (on_sale && display_timer) { %>\n      <div class=\"sale-countdown\">\n        <i class=\"hb hb-clock\"></i>\n        <span class=\"sale-countdown-detail\">This limited time offer will be gone in <span class=\"js-sale-timer\"></span></span>\n      </div>\n  <% } %>\n      <div class='wishlist-holder'></div>\n      <div class='monthly-notification-holder'></div>\n      <dl class=\"product-links js-product-links\">\n  <% if (platforms) { %>\n        <dt>Platforms:</dt>\n        <dd><%= render_platform_icons(icon_dict) %></dd>\n        <dt class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#game_anchor\">Operating Systems:</dt>\n        <dd><%= render_operating_system_icons(icon_dict) %></dd>\n  <% } %>\n  <% if (release_date) { %>\n        <dt class=\"js-admin-edit\" data-entity-kind=\"product\" data-anchor-name=\"#row_dates\">Release Date:</dt>\n        <dd><span class=\"sidebar-info-subtext\"><%= release_date %></span></dd>\n  <% } %>\n  <% if (genres && genres.length > 0) { %>\n        <dt class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#genres_anchor\">Genre:</dt>\n    <% for (var i = 0; i < genres.length; i++) { %>\n        <dd class=\"genre\">\n          <% include('internal-link', {'target': '_blank', 'href': '/search/genre/' + genres[i]}) %>\n            <span itemprop=\"genre\"><%- genres[i] %></span>\n          </a>\n        </dd>\n    <% } %>\n  <% } %>\n  <% var dev_pub_links = {}; %>\n  <% if (developers && developers.length) { %>\n        <dt class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#developers_anchor\">Developer:</dt>\n    <% for (var i = 0; i < developers.length; i++) { %>\n        <dd><% include('internal-link', {'href': '/search/developer/' + developers[i]['developer-name']}) %><%- developers[i]['developer-name'] %></a></dd>\n      <% if (developers[i]['developer-url']) { %>\n        <% dev_pub_links[developers[i]['developer-url']] = developers[i]['developer-name']; %>\n      <% } %>\n    <% } %>\n  <% } %>\n  <% if (publishers && publishers.length) { %>\n        <dt class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#publishers_anchor\">Publisher:</dt>\n    <% for (var i = 0; i < publishers.length; i++) { %>\n        <dd><% include('internal-link', {'href': '/search/publisher/' + publishers[i]['publisher-name']}) %><%- publishers[i]['publisher-name'] %></a></dd>\n      <% if (publishers[i]['publisher-url']) { %>\n        <% dev_pub_links[publishers[i]['publisher-url']] = publishers[i]['publisher-name']; %>\n      <% } %>\n    <% } %>\n  <% } %>\n  <% if (system_requirements) { %>\n        <dt class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#system-requirements_anchor\">System Requirements:</dt>\n        <dd>\n          <a class=\"js-expand-hide-next expand-hide-next\" href='#'>\n            <i class=\"hb hb-caret-right\"></i>Read More\n          </a>\n          <div class=\"js-to-toggle to-toggle\">\n            <div class=\"wrapper\">\n              <div class=\"editable-html\">\n                <%= system_requirements %>\n              </div>\n            </div>\n          </div>\n        </dd>\n  <% } %>\n  <% if (more_information || eula_link || dev_pub_links || other_links) { %>\n        <dt>More Information:</dt>\n    <% if (eula_link) { %>\n        <dd class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#eula-link_anchor\">\n          <a href=\"<%- eula_link %>\" target=\"_blank\">Requires 3rd Party EULA</a>\n        </dd>\n    <% } %>\n    <% if (other_links) { %>\n      <% for(var i = 0; i < other_links.length; i++) { %>\n        <dd class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#other-links_anchor\">\n          <a href=\"<%- other_links[i]['other-link'] %>\" target=\"_blank\" rel=\"nofollow\"><%- other_links[i]['other-link-title'] %></a>\n        </dd>\n      <% } %>\n    <% } %>\n    <% if (more_information) { %>\n        <dd class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#other-links_anchor\">\n          <a class=\"js-expand-hide-next expand-hide-next\" href='#'>\n            <i class=\"hb hb-caret-right\"></i>Read More\n          </a>\n          <div class=\"js-to-toggle to-toggle\">\n            <div class=\"wrapper\">\n              <div class=\"editable-html\">\n                <%= more_information %>\n              </div>\n            </div>\n          </div>\n        </dd>\n    <% } %>\n    <% if (dev_pub_links) { %>\n      <% for(var url in dev_pub_links) { %>\n        <dd>\n          <a href=\"<%- url %>\" rel=\"nofollow\" target=\"_blank\"><%- dev_pub_links[url] %> Official Website</a>\n        </dd>\n      <% } %>\n    <% } %>\n  <% } %>\n  <% if (asm_demo_machine_name && common_machine_name) { %>\n        <dt>Share:</dt>\n        <dd>\n          <a class='js-expand-hide-next expand-hide-next' href='#'>\n            <i class='hb hb-caret-right'></i>Embed\n          </a>\n          <div class='js-to-toggle to-toggle'>\n            <div class='wrapper'>\n                <input class='embed-code-input' type=\"text\" title='Embed Code' value='<iframe width=\"560\" height=\"685\" src=\"<%= base_url_secure %>/widget/v2/product/<%= common_machine_name %>?include-asm-demo=True\" frameborder=\"0\" scrolling=\"no\" allowfullscreen></iframe>' readonly>\n            </div>\n          </div>\n        </dd>\n  <% } %>\n\n  <% if (esrb_rating || pegi_rating || usk_rating || rating_details) { %>\n        <dt>Ratings:</dt>\n        <dd class=\"ratings\">\n    <% if (pegi_rating) { %>\n          <img src=\"<%- STATIC_URL %>/static/ratings/pegi/<%- pegi_rating %>.png\" alt='PEGI rating: <%- pegi_rating %>'\n             class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#pegi-rating_anchor\"/><%\n    } if (usk_rating) { %><img src=\"<%- STATIC_URL %>/static/ratings/usk/<%- usk_rating %>.png\" alt='USK rating: <%- usk_rating %>'\n            class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#usk-rating_anchor\"/><%\n    } if (esrb_rating) { %><img src=\"<%- STATIC_URL %>/static/ratings/esrb/<%- esrb_rating %>.png\" alt='ESRB rating: <%- esrb_rating %>'\n            class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#esrb-rating_anchor\"/><%\n    } if (rating_details) { %>\n          <div>\n            <p class=\"js-admin-edit\" data-entity-kind=\"display_item\" data-anchor-name=\"#rating-details_anchor\"><%= rating_details %></p>\n          </div>\n    <% } %>\n        </dd>\n  <% } %>\n\n  <% if (!_.isEmpty(partner_vars) && partner_vars['id']) { %>\n        <dt>PARTNERING WITH:</dt>\n        <dd>\n          <div class=\"partner-info\">\n    <%\n      var partnerImage = partner_vars['default_image'];\n      if (partner_vars['image']) {\n        partnerImage = partner_vars['image'];\n      }\n    %>\n            <img src=\"<%- partnerImage %>\" alt=\"<%- partner_vars.name %>\">\n    <% if (partner_vars['show_name']) { %>\n          <%- partner_vars.name %>\n    <% } %>\n          </div>\n          <a href=\"https://support.humblebundle.com/hc/en-us/articles/223517768\" target=\"_blank\">Learn More about Partners</a>\n        </dd>\n  <% } %>\n        <dt>TRAITS&trade;:</dt>\n        <dd>\n          <div>\n            <iframe height=\"400\" frameborder=\"0\" allowtransparency=\"true\" scrolling=\"yes\" style=\"border: none;\" src=\"//cdn.xray.games/hb/sidebar/<%- machine_name %>.html\"></iframe>\n          </div>\n        </dd>\n      </dl>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-details-age-gate'>\n  <div class='js-age-gate gate age-gate'>\n    <div class='center-container age-message'>\n      Sorry, you are not permitted to view this content.\n    </div>\n    <div class='center-container age-prompt'>\n      When were you born?<br>\n      <select class='js-age-month'>\n        <option value=\"1\">January</option>\n        <option value=\"2\">February</option>\n        <option value=\"3\">March</option>\n        <option value=\"4\">April</option>\n        <option value=\"5\">May</option>\n        <option value=\"6\">June</option>\n        <option value=\"7\">July</option>\n        <option value=\"8\">August</option>\n        <option value=\"9\">September</option>\n        <option value=\"10\">October</option>\n        <option value=\"11\">November</option>\n        <option value=\"12\">December</option>\n      </select>\n      <select class='js-age-year'>\n  <% var year = new Date().getFullYear(); %>\n  <% for (var i = 1900; i <= year; i++) { %>\n        <option value=\"<%- i %>\"<%if (i == year - 18) { %> selected<% } %>><%- i %></option>\n  <% } %>\n      </select>\n      <input type='button' class='js-age-response' value='ok' name='ok'/>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-details-territory-gate'>\n  <div class='js-territory-gate gate territory-gate'>\n    <div class='center-container'>\n      <p>Sorry, this content is not available in your region.</p>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-search-bar'>\n  <div class='searchbar'>\n    <img class='search-spinner js-search-spinner' src='xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif' alt=''/>\n    <input class='js-search search' placeholder='Search' />\n    <i class='js-clear-search hb hb-search clear-search-button'></i>\n  </div>\n</script>\n\n<script type=\"text/template\" id=\"storefront-dev-pub-text\">\n  <div class=\"storefront-filter-controls\">\n    <h2>\n<%- title_string %>\n    </h2>\n  </div>\n</script>\n\n<script type=\"text/template\" id=\"storefront-filter-controls\">\n<div class='storefront-filter-controls'>\n<h2>\n<% if (genre && genre != 'all') { %>\n  <%= genre %>\n<% } else if (platform && platform != 'all') { %>\n  <%= platforms[platform] %>\n<% } else if (drm && drm != 'all') { %>\n  <%= drms[drm] %>\n<% } else { %>\n  <%= sorts[sort] %>\n<% } %>\n</h2>\n\n  <div class='filters'>\n    <div class='filter-control'>\n      <h4 class='heading'>Sort by:</h4>\n      <div class='filter-dropdown'>\n        <%- sorts[sort] %>\n        <i class='hb hb-caret-down'></i>\n        <ul class='filter-dropdown-options'>\n    <% _.each(sorts, function(val, key) { %>\n          <li>\n            <% var href = build_search_url({'sort': key}); %>\n            <% include('internal-link', {'href': href,}) %>\n              <%- val %>\n            </a>\n          </li>\n    <% }) %>\n        </ul>\n      </div>\n    </div>\n\n<% if (genres) { %>\n    <div class='filter-control'>\n      <h4 class='heading'>Genre:</h4>\n      <div class='filter-dropdown'>\n        <%- genre || 'All' %>\n        <i class='hb hb-caret-down'></i>\n        <ul class='filter-dropdown-options'>\n          <% var href = build_search_url(null, ['genre']); %>\n          <% include('internal-link', {'href': href,}) %>\n            All\n          </a>\n    <% _.each(genres, function(val) { %>\n          <li>\n            <% var href = build_search_url({'genre': val}); %>\n            <% include('internal-link', {'href': href,}) %>\n              <%- val %>\n            </a>\n          </li>\n    <% }) %>\n        </ul>\n      </div>\n    </div>\n<% } %>\n\n<% if (platforms) { %>\n    <div class='filter-control'>\n      <h4 class='heading'>Platform:</h4>\n      <div class='filter-dropdown'>\n        <%- platforms[platform] || 'All' %>\n        <i class='hb hb-caret-down'></i>\n        <ul class='filter-dropdown-options'>\n          <li>\n            <% var href = build_search_url(null, ['platform']); %>\n            <% include('internal-link', {'href': href,}) %>\n              All\n            </a>\n          </li>\n    <% _.each(platforms, function(val, key) { %>\n          <li>\n            <% var href = build_search_url({'platform': key}); %>\n            <% include('internal-link', {'href': href,}) %>\n              <%- val %>\n            </a>\n          </li>\n    <% }) %>\n        </ul>\n      </div>\n    </div>\n<% } %>\n\n<% if (drms) { %>\n    <div class='filter-control'>\n      <h4 class='heading'>DRM:</h4>\n      <div class='filter-dropdown'>\n        <%- drms[drm] || 'All' %>\n        <i class='hb hb-caret-down'></i>\n        <ul class='filter-dropdown-options'>\n          <li>\n            <% var href = build_search_url(null, ['drm']); %>\n            <% include('internal-link', {'href': href,}) %>\n              All\n            </a>\n          </li>\n    <% _.each(drms, function(val, key) { %>\n          <li>\n            <% var href = build_search_url({'drm': key}); %>\n            <% include('internal-link', {'href': href,}) %>\n              <%- val %>\n            </a>\n          </li>\n    <% }) %>\n        </ul>\n      </div>\n    </div>\n<% } %>\n</div>\n</script>\n\n<script type=\"text/template\" id=\"storefront-about-template\">\n  <div class=\"about-storefront-details js-about-storefront-details\">\n    <h2 class=\"header-text\">What's the Humble Store?</h2>\n    <h3 class=\"sub-header-text\">It's all about choice!</h3>\n    <ul class=\"choice-list\">\n      <li class=\"choice-item play\">\n        <span class=\"choice-image\"></span>\n        <h4 class=\"choice-header-text\">What You Play</h4>\n        <p class=\"choice-description\">We offer thousands of games on the Humble Store with sales happening every day.</p>\n      </li>\n      <li class=\"choice-item support\">\n        <span class=\"choice-image\"></span>\n        <h4 class=\"choice-header-text\">What You Support</h4>\n        <p class=\"choice-description\">Every purchase supports charity. Choose your favorite from a database of over 35,000.</p>\n      </li>\n      <li class=\"choice-item platforms\">\n        <span class=\"choice-image\"></span>\n        <h4 class=\"choice-header-text\">How You Play</h4>\n        <p class=\"choice-description\">When you buy a cross-platform game, you get a version for each available OS.</p>\n      </li>\n      <li class=\"choice-item purchase\">\n        <span class=\"choice-image\"></span>\n        <h4 class=\"choice-header-text\">How You Purchase</h4>\n        <p class=\"choice-description\">Check out with an account or as a guest. Pay with credit card, PayPal, or local options.</p>\n      </li>\n    </ul>\n    <p class=\"disclaimer\">* Humble Bundle is proud to partner with Paypal Giving Fund, a U.S. 501(c)(3) charity. Humble Bundle will donate 10% of the listed price of each item sold through the Humble Store — less PayPal Giving Fund's administrative fee and applicable sales taxes, VAT, and payment processor fees (which typically average 6 to 7% across all transactions, but may vary depending on a number of factors, including your location, purchase price, and payment method) — to the <a href=\"https://www.paypalgivingfund.org/index.html\" target=\"_blank\">PayPal Giving Fund</a>, with the direction that PayPal Giving Fund pay the funds to the charitable organization indicated in your Humble Store shopping cart at the time of purchase. (You may choose to change the indicated charity to any other charity registered with PayPal Giving Fund.) PayPal Giving Fund retains ultimate discretion and control over the use of the donations it receives from Humble Bundle. You will not be entitled to a tax deduction for contributions made by Humble Bundle to the PayPal Giving Fund.</p>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-header-template'>\n<% var show_logo = true; %>\n<% if (store_config.header_image) { %>\n  <% show_logo = false; %>\n  <% include('internal-link', {'href': '/'}) %>\n    <img class='banner hero-banner js-hero'\n    <% if (store_config.header_image_height) { %>\n         height='<%= store_config.header_image_height %>'\n    <% } %>\n         width='940'\n         src='<%- STATIC_URL %><%- store_config.header_image %>'></img>\n  </a>\n<% } else { %>\n  <% if (banner_model) { %>\n    <% include('internal-link', {'href': banner_model.path}) %>\n      <img class='banner ordinary-banner js-banner'\n    <% if (banner_model.banner_link_image_height) { %>\n         height='<%= banner_model.banner_link_image_height %>'\n    <% } %>\n         width='940'\n         alt='<%= banner_model.human_name %>'\n         src='<%- STATIC_URL %><%- banner_model.banner_link_image %>'>\n      </img>\n    </a>\n  <% } else if (page_model && page_model.nonclickable_banner_image) { %>\n    <img class='banner ordinary-banner js-banner'\n    <% if (page_model.nonclickable_banner_image_height) { %>\n         height='<%= page_model.nonclickable_banner_image_height %>'\n    <% } %>\n         width='940'\n         alt='<%= page_model.human_name %>'\n         src='<%- STATIC_URL %><%- page_model.nonclickable_banner_image %>'>\n    </img>\n  <% } %>\n<% } %>\n\n  <div class=\"about-storefront <%= humblekeep_enabled ? 'has-keep' : '' %>\">\n<% if (show_logo) { %>\n    <div class='logo-and-charities charity-icons js-logo-and-charities'>\n      <div class=\"logo-container\">\n          <% include('internal-link', {'href': '/'}) %>\n            <img id=\"logo-image\" src=\"<%- STATIC_URL %><%= store_config.logo_image %>\" alt=\"Humble Store\"/>\n          </a>\n        <h2 class='under-logo'>\n  <% if (page_model && page_model.strings && page_model.strings.logo_sub_text) { %>\n          <%= page_model.strings.logo_sub_text %>\n          <span class='pipe-divider'>|</span>\n  <% } %>\n  <% if (charity_amount) { %>\n          <b>$<%= charity_amount %></b> contributed to charity\n  <% } else { %>\n          <b>$4.5 million and counting</b> raised for charity\n  <% } %>\n        </h2>\n      </div>\n\n  <% if (humblekeep_enabled) { %>\n    <% if (current_charity) { %>\n      <div class=\"charity-keep-container-container <%- is_eligible_for_keep_credit ? '' : 'keep-ineligible' %>\">\n        <a href=\"#\" class=\"humblekeep-info js-humblekeep-info\">\n          <span class=\"info-copy\">What's this?</span>\n          <i class=\"hb hb-info\"></i>\n        </a>\n        <% include('internal-link', {'href': '/select-charity/charity/' + current_charity.charity_id}) %>\n          <span class=\"charity-img\" style=\"background-image: url(<%= current_charity.logo_url %>);\"></span>\n        </a>\n        <p class=\"charity-selection\">\n          5% of your purchase supports\n          <% include('internal-link', {'href': '/select-charity/charity/' + current_charity.charity_id, '_class': 'charity-name'}) %><%- current_charity.human_name %></a>\n          <% include('internal-link', {'href': '/select-charity'}) %><i class=\"hb hb-pencil-square\"></i></a>\n        </p>\n        <span class=\"support-percentage\">Give another 5% to:</span>\n        <button class=\"\n          js-select-humblekeep\n          opt-out\n          humblekeep-radio-button\n          <%= humblekeep_opt_in ? '' : 'is-selected' %>\n        \">\n          Charity\n        </button>\n        <button class=\"\n          js-select-humblekeep\n          opt-in\n          humblekeep-radio-button\n          <%= humblekeep_opt_in ? 'is-selected' : '' %>\n        \"\n        <%- is_eligible_for_keep_credit ? '' : 'disabled' %>>\n          My Wallet\n        </button>\n      </div>\n    <% } %>\n  <% } else { %>\n  <% /* START DEPRECATED NON-HUMBLEKEEP CODE (ENG-6037) */ %>\n    <% if (current_charity) { %>\n      <div class='charity-container'>\n        <% include('internal-link', {'href': '/select-charity/charity/' + current_charity.charity_id}) %>\n          <div class='charity-img' style='background-image: url(\"<%= current_charity.logo_url %>\");'></div>\n        </a>\n        <h3>10% of your purchase will support<% include('internal-link', {'href': '/about', '_class': 'unstyled-link'}) %>*</a></h3>\n        <h4>\n          <% include('internal-link', {'href': '/select-charity', 'title': current_charity.human_name}) %>\n            <span class='charity-name'>\n              <%- current_charity.human_name %>\n            </span>\n            <i class='hb hb-pencil-square'></i>\n          </a>\n        </h4>\n        <p>\n          If you would like to support a different charity,<br>\n          <% include('internal-link', {'href': '/select-charity'}) %>select a new one</a> from a database of thousands.\n        </p>\n      </div>\n    <% } %>\n  <% } %>\n    </div>\n  <% /* END DEPRECATED NON-HUMBLEKEEP CODE */ %>\n<% } %>\n\n<% if (store_config.about_human_name) { %>\n    <h2 class='affiliate-tagline'>\n      <%= store_config.about_human_name %>\n    </h2>\n<% }%>\n    <div class=\"show-wishlist js-show-wishlist\"><% include('internal-link', {'href': '/wishlist'}) %><i class=\"hb hb-star\"></i> Wish List (<span class=\"wishlist-size\">0 items</span>)</a></div>\n    <div class=\"wallet-thumb js-wallet-thumb\">\n      <a href='/user/wallet'><i class=\"hb hb-money\"></i> Humble Wallet\n<% if (wallet_currency !== '') { %>\n      (<%- moneyfmt(wallet_balance, wallet_currency, null, false) %>)\n<% } %>\n      </a>\n    </div>\n    <div class='headerbar'>\n      <ul class='store-nav'>\n\n        <li class='js-nav featured'>\n          <% include('internal-link', {'href': '/', '_class': 'store-nav-link'}) %>\n            Featured\n          </a>\n        </li>\n\n        <li class='js-nav newest'>\n          <% include('internal-link', {'href': '/search/sort/newest', '_class': 'store-nav-link'}) %>\n            <%- sorts['newest'] %>\n          </a>\n        </li>\n        <li class='js-nav bestselling'>\n          <% include('internal-link', {'href': '/search/sort/bestselling', '_class': 'store-nav-link'}) %>\n            <%- sorts['bestselling'] %>\n          </a>\n        </li>\n        <li class='js-nav discount'>\n            <% include('internal-link', {'href': '/search/sort/discount', '_class': 'store-nav-link'}) %>\n            <%- sorts['discount'] %>\n          </a>\n        </li>\n        <li class='js-nav browse'>\n          <% include('internal-link', {'href': '/search/sort/alphabetical', '_class': 'store-nav-link browse'}) %>\n            Browse All\n          </a>\n        </li>\n\n  <% if (genres) { %>\n        <li class='js-nav genre has-dropdown'>\n          <span class='store-nav-link'>\n            Genres <i class='hb hb-caret-down'></i>\n          </span>\n          <div class='store-nav-dropdown'>\n            <ul class='dropdown-column'>\n    <% _.each(genres, function(genre) { %>\n              <li class='indented js-sub-nav genre-<%- genre.replace(' ', '') %>'><% include('internal-link', {'href': '/search/genre/' + genre, '_class': 'store-nav-link'}) %><%- genre %></a></li>\n    <% }) %>\n            </ul>\n          </div>\n        </li>\n  <% } %>\n  <% if (platforms) { %>\n        <li class='js-nav platform has-dropdown'>\n          <span class='store-nav-link'>\n            Platforms <i class='hb hb-caret-down'></i>\n          </span>\n          <div class='store-nav-dropdown'>\n            <ul class='dropdown-column'>\n    <% _.each(platforms, function(key, value) { %>\n              <li class='indented js-sub-nav platform-<%- key.toLowerCase() %>'><% include('internal-link', {'href': '/search/platform/' + value, '_class': 'store-nav-link'}) %><%- key %></a></li>\n    <% }) %>\n            </ul>\n          </div>\n        </li>\n  <% } %>\n  <% if (drms) { %>\n        <li class='js-nav drm has-dropdown'>\n          <span class='store-nav-link'>\n            By DRM <i class='hb hb-caret-down'></i>\n          </span>\n          <div class='store-nav-dropdown'>\n            <ul class='dropdown-column'>\n    <% _.each(drms, function(key, value) { %>\n              <li class='indented js-sub-nav drm-<%- key.toLowerCase() %>'><% include('internal-link', {'href': '/search/drm/' + value, '_class': 'store-nav-link'}) %><%- key %></a></li>\n    <% }) %>\n            </ul>\n          </div>\n        </li>\n  <% } %>\n        <li class='js-nav about'>\n          <% include('internal-link', {'href': '/about', '_class': 'store-nav-link'}) %>\n            About\n          </a>\n        </li>\n      </ul>\n    </div>\n<% if (page_model && page_model.storefront_grid_header_image) { %>\n    <img\n      class='header-image'\n      src='<%- STATIC_URL %><%= page_model.storefront_grid_header_image %>'\n      width='940'\n  <% if (page_model.storefront_grid_header_image_height) { %>\n      height='<%= page_model.storefront_grid_header_image_height %>'\n  <% } %>\n    />\n<% } %>\n    <div class='byob-view js-byob-view'></div>\n  </div>\n</script>\n\n<script type='text/template' id='humblekeep-info'>\n  <div class=\"js-humblekeep-info-lightbox humblekeep-info-lightbox\">\n    <div class=\"humblekeep-info-inner\">\n      <h3>Where can my 5% go?</h3>\n      <p>Here at Humble Bundle, your shopping experience is all about choice. It's why you can pay what you want for bundles and choose where the money goes. It's also why you get cross-platform versions of games as well as DRM-free builds and Steam keys whenever possible. Now you also get to choose where 5% of your Humble Store purchase goes.</p>\n      <p>When you check out, designate 5% of your to either a charity of your choice or straight to your Humble Wallet. If you choose charity, 5% of your net payment (after deducting taxes and payment processing fees) will go to your chosen charity. If you choose the Humble Wallet, 5% of your purchase can be used on your next Humble Store purchase (some exclusions may apply). It's all up to you!</p>\n      <p><em>Payments to charity are made via the <a href=\"https://support.humblebundle.com/hc/en-us/articles/205183597-Humble-Bundle-and-PayPal-Giving-Fund\" target=\"_blank\">PayPal Giving Fund</a> or, if applicable, via the <a href=\"https://support.humblebundle.com/hc/en-us/articles/205501708\" target=\"_blank\">Tides Foundation</a>.</em></p>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='byob-header'>\n<div class='byob-scroll js-byob-scroll'>\n<% if (page_model.strings && (page_model.strings.byob_header || page_model.strings.byob_text)) { %>\n  <p class='js-savings savings'>You’ve saved <span class='js-savings-amount'></span></p>\n<% } %>\n<% if (page_model.strings && page_model.strings.byob_header) { %>\n  <h3>\n    <%= page_model.strings.byob_header %>\n  </h3>\n<% } %>\n<% if (page_model.strings && page_model.strings.byob_text) { %>\n  <h4>\n    <%= page_model.strings.byob_text %>\n  </h4>\n<% } %>\n  <div class='byob'>\n<% for (var ii = 0; ii < progress_bar_segment_widths.length; ii++) { %>\n    <div\n      class='js-progress-bar-segment-holder progress-bar-segment-holder js-segment-<%- ii %>'\n      style='width: calc(<%- progress_bar_segment_widths[ii] %>% - 3px + 3px / <%- progress_bar_segment_widths.length %>)'\n    >\n      <span class='js-progress-bar-segment progress-bar-segment'>\n        <span class='progress-bar-product-wrapper'>\n          <span class='progress-bar-product js-progress-bar-product'></span>\n        </span>\n      </span>\n    </div>\n<% } %>\n  </div>\n</div>\n</script>\n\n<script type='text/template' id='byob-tier-label'>\n<span class='tier-label js-tier-label js-coupon-def-<%- coupon.get('coupon_definition') %>'>\n<% if (tier_label) { %>\n  <%- tier_label %>\n<% } else { %>\n  <% var count = coupon.get('coupon_min_count'); %>\n  <% var type = coupon.get('coupon_type'); %>\n  <% if (coupon.requires_minimum_value()) { %>\n    <% var required_value = coupon.get('coupon_generation_min_value'); %>\n    <%- moneyfmt(required_value[0], required_value[1], true, usd_postfix) %>\n  <% } else if (type == 'price') { %>\n    <% var price = coupon.get('coupon_price'); %>\n    <%- count %> for <%- moneyfmt(price[0], price[1], true, usd_postfix) %>\n  <% } else if (type == 'discount-percentage') { %>\n    <% var discount = coupon.get('coupon_discount'); %>\n    <% var discount_percent = Math.round(100.0 * discount); %>\n      <%- discount_percent %>% off <%- count %> <% if (count > 1) { %>games<% } else { %>game<% } %>\n  <% } else if (type == 'credit-amount') { %>\n    <% var credit = coupon.get('coupon_credit'); %>\n    <%- moneyfmt(credit[0], credit[1], true, usd_postfix) %> off <%- count %> <% if (count > 1) { %>games<% } else { %>game<% } %>\n  <% } %>\n<% } %>\n</span>\n</script>\n\n<script type='text/template' id='product-alert'>\n<div class='product-alert js-admin-edit' data-entity-kind='display_item' data-anchor-name='#alert-messages_anchor'>\n  <aside class='alert <% if (color) { %><%- color %><% } else { %>green<% } %>'>\n    <div class='wrapper'>\n      <% if (icon) { %>\n      <i class='hb hb-<%- icon %>' />\n      <% } %>\n      <p class='notification<% if (!icon) { %> no-icon<% } %>'>\n        <% if (title) { %><strong><%- title %></strong><% } %><%= text %>\n      </p>\n    </div>\n  </aside>\n</div>\n</script>\n\n<script type='text/template' id='storefront-loading-products'>\n  <div class='js-loading-products search-results'>\n    <div class='js-products-loading products-loading'>\n      <h1>\n        <img src='xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif' alt=''/>\n        Loading...\n      </h1>\n    </div>\n    <div class='js-products-loading-failed products-loading-failed'>\n      <h1>Loading failed</h1>\n      <p>You may have a connection problem, or our server may be experiencing issues.</p>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='storefront-loading-grid'>\n  <div class='js-loading-grid grid-status-message'>\n    <img src='xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif' alt='' />Loading additional items…\n  </div>\n</script>\n\n<script type='text/template' id='storefront-loading-grid-error'>\n  <div class='js-error-grid grid-status-message'>\n    Failed to load additional items.\n  </div>\n</script>\n\n<script type='text/template' id='storefront-search-results-holder'>\n  <div class='js-search-results search-results'>\n  </div>\n</script>\n\n<script type=\"text/template\" id=\"humblekeep-account-modal-template\">\n  <div class='generic-popup content'>\n    <div class=\"humblekeep-modal\">\n      <div class=\"humblekeep-modal-content\">\n        <p class=\"humblekeep-modal-content-heading\">\n          You must sign in or create an account\n        </p>\n        <p class=\"humblekeep-modal-content-text\">\n          The Humble Rewards feature requires an account.\n        </p>\n      </div>\n      <div class=\"humblekeep-modal-buttons\">\n        <button class=\"button\n                       js-humblekeep-account-modal-cancel-button\">\n          Cancel\n        </button>\n        <button class=\"button blue\n                       js-humblekeep-account-modal-confirm-button\">\n          Continue\n        </button>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type=\"text/template\" id=\"humblekeep-wallet-modal-template\">\n  <div class='generic-popup content'>\n    <div class=\"humblekeep-modal\">\n      <div class=\"humblekeep-modal-content\">\n        <p class=\"humblekeep-modal-content-heading\">\n          You must set up your Humble Wallet\n        </p>\n        <p class=\"humblekeep-modal-content-text\">\n          The Humble Rewards feature requires a Humble Wallet.\n        </p>\n      </div>\n      <div class=\"humblekeep-modal-buttons\">\n        <button class=\"button\n                       js-humblekeep-wallet-modal-cancel-button\">\n          Cancel\n        </button>\n        <button class=\"button blue\n                       js-humblekeep-wallet-modal-confirm-button\">\n          Create Wallet\n        </button>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type='text/template' id='custom_free_game_banner'>\n  <% /* ENG-8059  Template for custom free game banner and page wide css */ %>\n  <div class='custom-free-game-holder'>\n    <div class='custom-free-game-text'>\n      <h1><strong><%- human_name %></strong> is</h1>\n      <h2><strong>FREE</strong> for a limited time</h2>\n\n        <div class='custom-free-game-timer'>\n        <div class='custom-free-game-timer-holder'>\n          <div class='custom-free-game-timer-days'>00</div>\n          <div class='custom-free-game-timer-units'>days</div>\n        </div>\n        <div class='custom-free-game-timer-holder'>\n          <div class='custom-free-game-timer-hours'>00</div>\n          <div class='custom-free-game-timer-units'>hours</div>\n        </div>\n        <div class='custom-free-game-timer-holder'>\n          <div class='custom-free-game-timer-mins'>00</div>\n          <div class='custom-free-game-timer-units'>mins</div>\n        </div>\n        <div class='custom-free-game-timer-holder'>\n          <div class='custom-free-game-timer-secs'>00</div>\n          <div class='custom-free-game-timer-units'>secs</div>\n        </div>\n      </div>\n      <div class='custom-free-game-share'>\n        <div class='custom-free-game-facebook'>\n          <div class=\"fb-share-button\" data-href=\"https://www.humblebundle.com/store/<%- human_url %>\" data-layout=\"button_count\" data-size=\"small\" data-mobile-iframe=\"true\">\n            <a class=\"fb-xfbml-parse-ignore\" target=\"_blank\" href=\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.humblebundle.com/store/<%- human_url %>%2F&amp;src=sdkpreparse\">Share</a>\n          </div>\n        </div>\n        <a href=\"https://twitter.com/share\" class=\"twitter-share-button\" data-text=\"Get <%- human_name %> for free for a very limited time!\" data-url=\"https://www.humblebundle.com/store/<%- human_url %>\" data-via=\"humble\" data-related=\"humble\" data-show-count=\"false\">Tweet</a>\n        <div class='custom-free-game-email'>\n          <a href='mailto:?subject=Get <%- human_name %> for free!&body=<%- human_name %> here: https://www.humblebundle.com/store/<%- human_url %>'><img src='https://humblebundle-a.akamaihd.net/misc/files/hashed/bf4bc8fd488334146748dc2d4293da1a1877d7c1.png'></a>\n        </div>\n      </div>\n    </div>\n<% if (upsell_asset_url) { %>\n    <div class='custom-free-game-upsell-text'>\n      Find more great deals:\n    </div>\n    <a class='custom-free-game-upsell' href='/store'>\n      <img src='<%= upsell_asset_url %>'>\n    </a>\n<% } %>\n<% if (support_article_url) { %>\n    <div id=\"custom-free-game-more-details\">\n      <strong><a href=\"<%= support_article_url %>\" target=\"_blank\">More Details</a></strong>\n    </div>\n<% } %>\n  </div>\n  <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro\" rel=\"stylesheet\">\n\n  <style>\n  <% if (background_url) { %>\n    .base-main-wrapper {\n      background-image: url(\"<%= background_url %>\");\n      background-repeat: no-repeat;\n      background-position-x: right;\n      background-size: contain;\n    }\n\n    .product-alerts-and-description {\n      background-color: #D5D9E1;\n      padding: 10px 10px 0 10px;\n      border-radius: 3px;\n    }\n  <% } %>\n\n    .custom-free-game-holder {\n      font-family:  helvetica, sans-serif;\n      width: 940px;\n      height: 314px;\n      background: black;\n      color: white;\n      position: relative;\n      background: #282C34 url(<%= banner_url %>);\n      border-radius: 3px;\n      margin-bottom: 30px;\n    }\n\n    .custom-free-game-text {\n      text-align: center;\n      position: absolute;\n      width: 640px;\n      right: -20px;\n      top: 74px;\n    }\n\n    .custom-free-game-holder h1 {\n      font-family:  'Source Sans Pro', helvetica, sans-serif;\n      font-size: 31px;\n      margin: 0;\n    }\n\n    .custom-free-game-holder h2 {\n      font-family:  'Source Sans Pro', helvetica, sans-serif;\n      font-size: 50px;\n      line-height: 50px;\n      margin-bottom: 15px;\n    }\n\n    .custom-free-game-upsell img {\n      position: absolute;\n      bottom: -20px;\n      right: 65px;\n      z-index: 2;\n    }\n    .custom-free-game-upsell-text {\n      right: 0;\n      bottom: 70px;\n      width: 640px;\n      font-size: 16px;\n      text-align: center;\n    }\n    .custom-free-game-timer {\n      right: 0;\n      width: 640px;\n      text-align: center;\n      margin-bottom: 17px;\n    }\n    .custom-free-game-timer-holder {\n      display: inline-block;\n      background: rgba(0, 0, 0, 0.2);\n      text-align: center;\n      padding: 6px 8px;\n      margin: 0;\n      font-size: 24px;\n      font-weight: 300;\n      width: 32px;\n      border-radius: 4px;\n    }\n    .custom-free-game-timer-units {\n      font-size: 10px;\n      color: #D5D9E1;\n    }\n    .custom-free-game-share {\n      width: 640px;\n      text-align: center;\n      z-index: 10;\n    }\n    .custom-free-game-facebook {\n      position: relative;\n      display: inline-block;\n      top: -3px;\n      margin-right: 10px;\n    }\n    .custom-free-game-email {\n      display: inline-block;\n      margin-left: 10px;\n    }\n    /* use an ID for these to avoid collision on highly scoped <a> styles */\n    #custom-free-game-more-details {\n      position: absolute;\n      right: 1px;\n      bottom: -20px;\n    }\n    #custom-free-game-more-details a {\n      color: black;\n      text-decoration: none;\n      font-size: 12px;\n    }\n    #custom-free-game-more-details a:hover {\n      text-decoration: underline;\n    }\n    #custom-free-game-more-details a:visited {\n      color: black;\n    }\n  </style>\n</script>\n\n<script type='text/template' id='custom-monthly-promo-banner'>\n  <div class='custom-monthly-promo-holder'>\n    <div class='custom-monthly-promo-text'>\n      <h1>\n        A curated bundle of games sent to your inbox<br>\n        every month. Get over $100 in games for just $12.\n      </h1>\n      <p>\n        When you subscribe, you'll immediately receive <em><%- unlock_description %></em><br>\n        with more games to come, and enjoy 10% off in the Humble Store!\n      </p>\n      <a href=\"/monthly?hmb_source=store_details_page&hmb_medium=banner_cross&hmb_campaign=<%- campaign %>\" class=\"button large green\">\n        Subscribe Now\n      </a>\n    </div>\n    <div class=\"promo-blurb\">\n      <strong>$12 / month</strong><br>\n      <span class=\"crossout\">MSRP: $100+ / month</span>\n    </div>\n  </div>\n\n  <style>\n    .custom-monthly-promo-holder {\n      font-family:  helvetica, sans-serif;\n      width: 940px;\n      height: 314px;\n      background: black;\n      color: white;\n      position: relative;\n      background: #282C34 url(<%= banner_url %>);\n      border-radius: 3px;\n      margin-bottom: 30px;\n    }\n\n    .custom-monthly-promo-text {\n      position: absolute;\n      width: 465px;\n      left: 42px;\n      top: 100px;\n    }\n\n    .custom-monthly-promo-holder h1 {\n      font-size: 20px;\n      margin: 0 0 15px;\n      font-weight: normal;\n    }\n\n    .custom-monthly-promo-holder p {\n      margin: 0 0 25px;\n    }\n\n    .custom-monthly-promo-holder .promo-blurb {\n      text-align: center;\n      position: absolute;\n      bottom: 51px;\n      right: 276px;\n    }\n\n    .custom-monthly-promo-holder .promo-blurb strong {\n      font-size: 18px;\n    }\n\n    .custom-monthly-promo-holder .promo-blurb .crossout {\n      text-decoration: line-through;\n    }\n  </style>\n</script>\n".replace(/xSTATIC_URLx/g,t);
}()}),define("storefrontv2/dependencies",["require","hbtemplate!storefront/templates.html"],function(e){"use strict";var t=e("hbtemplate!storefront/templates.html");$("body").append(t)}),function(e){"use strict";function t(e,t,n){function i(e){var t="while(1);";return e.substr(t.length)}function s(t){var n=t.text();if(n.match(/@\S/)){t.html("");for(var i=n.split(" "),s=0;s<i.length;s++)if(0===i[s].indexOf("@")&&i[s].length>1&&-1===i[s].indexOf("@",1)){var a=e("<a>");a.text(i[s]),a.attr("href","https://www.twitter.com/"+i[s]),a.attr("target","_blank"),a.appendTo(t),s!=i.length-1&&t.append(document.createTextNode(" "))}else{var r=i[s];s!=i.length-1&&(r+=" "),t.append(document.createTextNode(r))}}}function a(t,n){var i=e("body");n.appendTo(i);var s=function(e){n.css({left:e.pageX+15,top:e.pageY+15})};t.mouseover(function(){i.bind("mousemove",s),n.stop(void 0,!0).fadeIn(200)}).mouseout(function(){n.stop(void 0,!0).fadeOut(200,function(){i.unbind("mousemove",s)})}).click(function(e){e.preventDefault()})}function r(e){return/.+@.+\..+/.test(e)}function o(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(e)}function l(t,n){var i=function(){var i=e.ajax({dataType:"script",cache:!0,url:t});n&&i.done(n)};"complete"===document.readyState?i():e(window).load(i)}function c(t,n,i,s,a){Stripe.card.createToken({number:t,cvc:n,exp_month:i,exp_year:s},function(t,n){n.error?console&&console.log&&console.log("error",n):(a.append(e("<input type=hidden name=stripe_token />").val(n.id)),a.append(e("<input type=hidden name=stripe_token_type />").val(n.type)),n.card&&a.append(e("<input type=hidden name=stripe_cc_data />").val(e.param(n.card))),a.submit())})}function u(){var e=function(e){function t(e,t,n){var i,s;n?(i=new Date,i.setTime(i.getTime()+24*n*60*60*1e3),s="; expires="+i.toGMTString()):s="",document.cookie=e+"="+t+s+"; path=/"}function n(e){var t,n,i=e+"=",s=document.cookie.split(";");for(t=0;t<s.length;t++){for(n=s[t];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return null}function i(n){n=JSON.stringify(n),"session"==e?window.name=n:t("localStorage",n,365)}function s(){"session"==e?window.name="":t("localStorage","",365)}function a(){var t="session"==e?window.name:n("localStorage");return t?JSON.parse(t):{}}var r=a();return{length:0,clear:function(){r={},this.length=0,s()},getItem:function(e){return void 0===r[e]?null:r[e]},key:function(e){var t=0;for(var n in r){if(t==e)return n;t++}return null},removeItem:function(e){delete r[e],this.length--,i(r)},setItem:function(e,t){r[e]=t+"",this.length++,i(r)}}};return new e("local")}function d(){if(void 0===d.storage){var e,t=function(e){if("undefined"==typeof e)return!1;try{return e.setItem("storage",""),e.getItem("storage"),e.removeItem("storage"),!0}catch(t){return!1}};try{e=void 0!==window.localStorage&&null!==window.localStorage&&t(window.localStorage)?window.localStorage:u()}catch(n){e=u()}d.storage=e}return d.storage}function h(e,t){void 0===t&&(t=2);var n=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,n)).toFixed(t)+" "+["B","KB","MB","GB","TB"][n]}function p(e){var t=String(e);return 1==t.length&&(t="0"+t),t}function _(e){var t=new Date,n=e-t.getTime()/1e3;0>n&&(n=0);var i=Math.floor(n/86400),s=Math.floor(n/3600)%24,a=Math.floor(n/60)%60,r=Math.floor(n)%60,o="";return i>0&&(o+=p(i)+":"),o+=p(s)+":",o+=p(a)+":",o+=p(r)}function m(){var e;try{e=parent.document.getElementsByTagName("iframe")}catch(t){return null}for(var n=0;n<e.length;n++){var i=e[n];if(i.contentWindow===window)return i}}function g(){var e=window,t=window.document.referrer||window.location.href;try{for(;e!==e.parent;)e=e.parent,t=e.document.referrer}catch(n){}return t}function f(e,t){try{return JSON.parse(d()[e])}catch(n){return t}}function v(t,n){var i=e("<a/>",{href:t,download:n});i.appendTo(e("body")),i[0].click(),i.remove()}function b(e){return decodeURIComponent(e.replace(/\+/g," "))}function y(e){for(var t=[],n=[],i=[],s=t,a=0;a<e.length;a++){var r=e[a];"?"===r?s=i:"#"===r?s=n:s.push(r)}return i=i.join(""),{baseUrl:t.join(""),hash:n.join(""),queryString:i,queryParams:k(i)}}function w(e,t){var n=y(t);for(var i in e)e.hasOwnProperty(i)&&(n.queryParams[i]=e[i]);var s=C(n.queryParams),a=n.baseUrl+"?"+s;return n.hash&&(a+="#",a+=n.hash),a}function C(t){return e.param(t)}function k(e){if(e=e||"",!e.trim())return{};var t={};return e.split("&").forEach(function(e){var n=e.split("=");t[n[0]]=n[1]||null}),t}function x(e,t){t=t||window.location,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=n.exec(t.search);return null===i?"":b(i[1])}function T(t,n,i,s,a){void 0===i&&(i=[]),void 0===s&&(s=100),a||(a=e.noop);var r=function(){var s=e(t);return s.length?(s[n].apply(s,i),a(),!0):!1};if(!r())var o=setInterval(function(){r()&&clearInterval(o)},s)}function S(t){var n;t instanceof e&&(t=t[0]);var i=document;if(i.body.createTextRange)n=i.body.createTextRange(),n.moveToElementText(t),n.select();else if(window.getSelection){var s=window.getSelection();n=i.createRange(),n.selectNodeContents(t),s.removeAllRanges(),s.addRange(n)}}function E(t){var n=e("<a>");n.attr("href",t),n.data("target-popup","#account-login"),n.addClass("account-login"),e("body").append(n),n.click()}function j(){return"www.humblebundle.com"===window.location.hostname}function P(){return"localhost:8080"===window.location.host}function A(e,t){for(var n=null,i=!1,s=0;s<e.length;s++){if("average"===e[s].type){i=!0,n=t;break}"price"===e[s].type&&(null===n||e[s].amount<n)&&(n=e[s].amount)}return(null===n||!i&&5>n)&&(n=5),n}function $(e){var t={},n=e.serializeArray();for(var i in n){var s=n[i];t[s.name]?(t[s.name].push||(t[s.name]=[t[s.name]]),t[s.name].push(s.value||"")):t[s.name]=s.value||""}return t}function R(e){return(Math.random()+1).toString(36).substr(2,e)}function I(){return window.devicePixelRatio>1}function O(e){var t=document.createElement("a");t.href=window.location.origin+e,t.host!==window.location.host||t.pathname.includes("//")?window.location.replace("/"):window.location.replace(t.href)}function M(e,t,n){return e.replace(new RegExp(t,"g"),n)}function L(t,n){var i=e(t),s=i.css("background-image");s=/^url\((['"]?)(.*)\1\)$/.exec(s),s=s?s[2]:"";var a=new Image;a.src=s,a.complete||(i.css("background-image",'url("'+n+'")'),a.addEventListener("load",function(){i.css("background-image",'url("'+s+'")')}))}function V(e){var t=e.style.display;e.style.display="none",e.offsetHeight,e.style.display=t}t.language("GBP",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"},currency:{symbol:"£"}}),t.language("EUR",{delimiters:{thousands:"",decimal:","},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},currency:{symbol:"€"}});var D=function(e,i,s,a){Array.isArray(e)&&(i=e[1],e=e[0]);var r="",o=s?"$0,0":"$0,0.00";return"GBP"===i||"EUR"===i?t.language(i):(t.language("en"),a&&(r=" usd")),"undefined"!=typeof n&&e instanceof n&&(e=e.toFixed(2)),isNaN(e)&&(e=0),t(e).format(o)+r},N=function(e){if(e=e.replace(/[^0-9.,]/gi,""),e.match(/[0-9.,]*[,.][0-9]{2}/)){var t=e.lastIndexOf("."),n=e.lastIndexOf(",");t>n?e=e.replace(",",""):(e=e.replace(".",""),e=e.replace(",","."))}return e.match(/^[0-9]*([,.][0-9]{0,2})?$/)?e:0},B=function(e){return t(e).format("0,0")},U=function(e){return e.round(2,1).toFixed(2)};return{moneyfmt:D,unmoneyformat:N,getEnclosingIframe:m,getTopMostUrl:g,numberWithCommas:B,round_big_to_money_amount:U,strip_json_prefix:i,twitter_linkify:s,makepopper:a,isValidEmail:r,isValidUrl:o,login:E,async_js:l,stripe_purchase:c,getLocalStorage:d,loadFromLocalStorage:f,humanFileSize:h,render_time_remaining_until:_,parseUrl:y,replace_all_in_string:M,makeQueryString:C,getQueryParam:x,updateQueryString:w,initJQueryPlugin:T,selectText:S,zeropad:p,calculateCaptchaThreshold:A,serializeToJson:$,isDefaultVersion:j,isDebugUnsafe:P,saveAs:v,randomString:R,isRetinaDisplay:I,redirectInDomain:O,preload_background_image_with_default:L,_gaTrackEvent:window._gaTrackEvent||function(){},forceRedraw:V}}if("function"==typeof define&&define.amd)define("util/main",["jquery","lib/numeral","lib/big"],function(e,n,i){return t(e,n,i)});else if("undefined"!=typeof module&&module.exports)module.exports=t($,numeral,Big);else{var n=t($,numeral,Big);e.Util=n;for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}(this),define("util/templating",["module","underscore","util/main"],function(e,t,n){"use strict";function i(e,n){return e.replace(/<%\s*include\(\s*['"]([^'"]+)['"](?:\s*,\s*({[^}]+}))?\s*\)\s*%>/g,function(e,s,a){if(t.contains(n,s))throw new Error("Cycle detected: "+s);var r=document.getElementById(s),o=r?r.innerHTML:"";a&&(o="<% with("+a+") { %>"+o+"<% } %>");var l=n.slice(0);return l.push(s),i(o.trim(),l)})}function s(e,t){t=t||{};var n=document.getElementById(e);if(!n)throw new Error('no template with id "'+e+'"');var i=n?n.innerHTML:"";return a(i,t)}function a(e,n){n=n||{};var s=i(e.trim(),[]),e=t.template(s);return t.extend(n,l),e(n)}var r=function(e){return t.template(i(jQuery(e).html().trim(),[]))},o=e.config().STATIC_URL,l={STATIC_URL:o,moneyfmt:n.moneyfmt};return{renderTemplateId:s,renderTemplate:a,getTemplate:r}}),define("storefront/common",["lib/jquery/full","underscore","backbone"],function(e,t,n){"use strict";function i(e,t){return t.STORE_ROOT+e}function s(e,t){var n=t.STORE_ROOT;return 0===e.indexOf(n)?e.substring(n.length):e}function a(e,t){return t.STORE_ROOT+e}function r(e,t,i,r,l){if(!e.metaKey&&!e.ctrlKey)if(e.preventDefault(),i)window.location=t;else{window.Humble=window.Humble||{},window.Humble.skipScrollRestore=!0;var c=s(t,r);if(r.REDIRECTS.hasOwnProperty(c))return void(window.location=r.REDIRECTS[c]);n.history.navigate(c,l),o(a(c,r))}}var o=window._gaTrackPageview||function(){};return{add_link_prefix:i,navigate:r}}),define("storefront/views/BaseView",["lib/jquery/full","underscore","backbone","util/templating","storefront/common"],function(e,t,n,i,s){"use strict";window.hb=window.hb||{};var a=n.View.extend({initialize:function(e){t.bindAll(this,"handle_internal_link"),this.constants=e.constants},events:{"click a.js-internal-store-link":"handle_internal_link"},handle_internal_link:function(t){t.stopPropagation();var n=e(t.currentTarget),i=!1;return n.hasClass("disabled")?void t.preventDefault():void("_blank"!==n.attr("target")&&((this.details_is_link||window.hb.render_storefrontv2)&&(i=!0),s.navigate(t,n.attr("href"),i,this.constants,{trigger:!0})))},render_template_id:function(e,t){return"undefined"==typeof t&&(t={}),t.store_root=this.constants.STORE_ROOT||"/store",i.renderTemplateId(e,t)},render_template:function(e,t){return"undefined"==typeof t&&(t={}),t.store_root=this.constants.STORE_ROOT||"/store",i.renderTemplate(e,t)}});return a}),define("storefront/views/AboutView",["lib/jquery/full","underscore","backbone","storefront/views/BaseView"],function(e,t,n,i){"use strict";return i.extend({tagName:"div",initialize:function(e){i.prototype.initialize.call(this,e),this.options=e,t.bindAll(this,"render"),this.templateId="storefront-about-template"},render:function(){return this.$el.html(i.prototype.render_template_id.call(this,this.templateId)),this.el}})}),define("storefrontv2/sharedConfig",[],function(){"use strict";return{pubSub:null,storefrontConstants:{ADMIN_LINKS_ENABLED:!1,BASE_URL_SECURE:"https://www.humblebundle.com",CHARITY_RESULTS_PAGE_SIZE:0,CHARITY_SEARCH_PARAM_ORDER:[],CHARITY_SEARCH_PARAMS:{},CSRF_FORM_KEY:"",CSRF_TOKEN:"",DEBUG_PREAMBLE:"",FEATURED_CHARITY_IDS:[],HUMBLEKEEP_ENABLED:!1,MAX_CART_SIZE:0,MAX_WISHLIST_SIZE:0,MIN_ABOUT_HEIGHT:350,REDIRECTS:{},SEARCH_PARAM_ORDER:[],SEARCH_PARAMS:{},STORE_CONFIG:{},STORE_ROOT:"/store"},userModel:null}}),define("storefrontv2/models/BaseCollection",["require","backbone","storefrontv2/sharedConfig"],function(e){"use strict";var t=e("backbone"),n=e("storefrontv2/sharedConfig"),i=t.Collection.extend({initialize:function(){this.lastReceived=-1,this.lastSent=0}});return i.prototype.sharedConfig=n,i}),define("storefrontv2/models/BaseModel",["require","backbone","storefrontv2/sharedConfig"],function(e){"use strict";var t=e("backbone"),n=e("storefrontv2/sharedConfig"),i=t.Model.extend({initialize:function(){this.lastReceived=-1,this.lastSent=0}});return i.prototype.sharedConfig=n,i}),define("storefrontv2/models/Entity",["require","storefrontv2/models/BaseModel"],function(e){"use strict";var t=e("storefrontv2/models/BaseModel"),n=t.extend({getSaleEnd:function(){var e=this.get("sale_end");return e&&(e=1e3*e),e},getTitleText:function(){return""},getUrl:function(){var e;return this.get("type")==n.TYPES.PAGE?e=this.sharedConfig.storefrontConstants.STORE_ROOT+this.get("path"):this.get("type")==n.TYPES.PRODUCT&&(e=this.sharedConfig.storefrontConstants.STORE_ROOT+"/"+this.get("human_url")),e},isEligibleForKeepCredit:function(){return!0}},{TYPES:{PAGE:"page",PRODUCT:"product"}});return n}),define("storefrontv2/models/PagePreview",["require","storefrontv2/models/Entity"],function(e){"use strict";var t=e("storefrontv2/models/Entity");return t.extend({idAttribute:"path",initialize:function(e,n){t.prototype.initialize.call(this,e,n),this.entitiesCache=n.entitiesCache}})}),define("storefrontv2/models/Product",["require","underscore","lib/big","storefrontv2/models/Entity","util/main"],function(e){"use strict";var t=e("underscore"),n=e("lib/big"),i=e("storefrontv2/models/Entity"),s=e("util/main"),a=i.extend({display_as_free:function(){var e=this.get_current_price_as_big();return Boolean(e&&e.eq(0))},has_details:function(){return this.get("description")||this.get("system_requirements")||this.get("youtube_link")||this.get("storefront_preview_image")},is_territory_allowed:function(e){var n=this.get("blocked_territories");if(n instanceof Array&&t.contains(n,e.toUpperCase()))return!1;var i=this.get("allowed_territories");return i instanceof Array?t.contains(i,e.toUpperCase()):!0},get_cta_badge_text:function(e){return e?a.PRODUCT_STATUS[e]:a.PRODUCT_STATUS[this.get("cta_badge")]},get_currency:function(){return this.getCurrency()},get_current_price_as_big:function(){return this.getCurrentPriceAsBig()},get_force_popup:function(){var e=this.get("force_popup");return void 0===e?!1:e},get_icon_path:function(){return this.get("storefront_icon")},get_machine_name:function(){return this.get("machine_name")},get_minimum_age:function(){var e=this.get("minimum_age");return void 0===e?-1:e},get_path:function(){return"/"+this.get("human_url")},get_platforms:function(){return this.get("platforms")},get_storefront_alerts:function(){return this.get("alert_messages")},on_sale:function(){return this.isOnSale()},idAttribute:"machine_name",getCurrency:function(){return this.get("full_price")[1]},getCurrentPriceAsBig:function(){var e=this.get("current_price");return e?new n(e[0]):null},getFullPriceAsBig:function(){var e=this.get("full_price");return e?new n(e[0]):null},getHumanDiscount:function(){return this.isOnSale()?new n(100).times(this.getSaleAmountAsBig().div(this.getFullPriceAsBig())).toFixed(0):0},getHumanDiscountAfterCoupon:function(e,t){var i=this.getPriceAfterCouponAsBig(e,t),s=this.getFullPriceAsBig();return i?new n(100).times(s.minus(i).div(s)).toFixed(0):0},getPriceAfterCouponAsBig:function(e,t){if(!this.hasPrice())return null;var n=t?this.getFullPriceAsBig():this.getCurrentPriceAsBig();return n.minus(e.calculate_discount(n,this.getCurrency()))},getSaleAmountAsBig:function(){return this.hasPrice()?this.getFullPriceAsBig().minus(this.getCurrentPriceAsBig()):null},getStatus:function(){var e=this.get("cta_badge");return a.PRODUCT_STATUS[e]?e:void 0},getStatusHtmlClass:function(){var e=this.getStatus();return e?s.replace_all_in_string(e,"_","-"):void 0},getTitleText:function(){var e="Buy "+this.get("human_name")+" from the Humble Store";return this.isOnSale()&&(e+=" and save "+this.getHumanDiscount()+"%"),e},hasPrice:function(){return this.get("full_price")&&this.get("current_price")},isCompatibleWithCoupon:function(e){return-1!=this.get("incompatible_features").indexOf("coupons")?!1:-1!=this.get("incompatible_features").indexOf("subscriber-discount-coupons")?!e.get("coupon_required_subscriptions").length:!0},isEligibleForKeepCredit:function(){return t.contains(this.get("incompatible_features"),"earn-keep-credit")},isOnSale:function(){return this.hasPrice()&&this.get("current_price")[0]!=this.get("full_price")[0]}},{PRODUCT_STATUS:{coming_soon:"Coming Soon",dlc:"DLC",earlyaccess:"Early Access",moregames:"More Games","new":"New",onsale:"On Sale",outnow:"Out Now",preorder:"Pre-Order",updated:"Updated"}});return a}),define("storefrontv2/models/EntityList",["require","underscore","storefrontv2/models/BaseCollection","storefrontv2/models/BaseModel","storefrontv2/models/Entity","storefrontv2/models/PagePreview","storefrontv2/models/Product","util/main"],function(e){"use strict";var t=e("underscore"),n=e("storefrontv2/models/BaseCollection"),i=e("storefrontv2/models/BaseModel"),s=e("storefrontv2/models/Entity"),a=e("storefrontv2/models/PagePreview"),r=e("storefrontv2/models/Product"),o=(e("util/main"),n.extend({model:function(e,t){if(e.type==l.TYPES.LIST)return new l(e,t);var n=t.entityMap[e];return n.type==s.TYPES.PAGE?new a(n,t):n.type==s.TYPES.PRODUCT?new r(n,t):void 0}})),l=i.extend({initialize:function(e,t){i.prototype.initialize.call(this,e,t),this.fetchedGridPages=[],this.fetchedGridPages.push(0),this.on("gridPageFetch:started",this.fetchGridPage)},parse:function(e,n){var i=n.entityMap;return e=$.extend({},e),e.type!==l.TYPES.TABBED_LIST&&(e.entities=t.filter(e.entities,function(e){return t.has(i,e)})),e.entities=new o(e.entities||e.sub_lists,{entityMap:i,parse:!0}),e},getTypeHtmlClass:function(){return this.get("type").replace("_","-")},isCarousel:function(){return t.contains([l.TYPES.CAROUSEL_LARGE,l.TYPES.CAROUSEL_MINI,l.TYPES.CAROUSEL_STANDARD],this.get("type"))},isGrid:function(){return t.contains([l.TYPES.SMALL_GRID,l.TYPES.FULL_GRID],this.get("type"))},fetchGridPage:function(e){var n=this;t.contains(this.fetchedGridPages,e)?n.trigger("gridPageFetch:preexisting gridPage:changed",e):(n.trigger("gridPageFetch:fetching"),$.ajax({url:"/store/api/fetch_chunk",method:"get",dataType:"json",data:{path:n.get("page_path"),component_key:n.get("component_key"),chunk_index:e},success:function(t){var i=t.result,s=new o(i.entity_keys,{entityMap:i.entity_lookup_dict,parse:!0});n.fetchedGridPages.push(e),n.trigger("gridPageFetch:success",s,e),n.trigger("gridPage:changed",e)},error:function(e){n.trigger("gridPageFetch:error")}}))},getTotalGridPages:function(){return this.get("total_chunks")||1},getUrl:function(){return this.sharedConfig.storefrontConstants.STORE_ROOT+this.get("url")}},{TYPES:{CAROUSEL_LARGE:"carousel_large",CAROUSEL_MINI:"carousel_mini",CAROUSEL_STANDARD:"carousel_standard",SMALL_GRID:"small_grid",FULL_GRID:"full_grid",LIST:"list",TABBED_LIST:"tabbed_list"}});return l}),define("storefrontv2/models/Page",["require","underscore","storefrontv2/models/BaseCollection","storefrontv2/models/EntityList","storefrontv2/models/PagePreview"],function(e){"use strict";var t=e("underscore"),n=e("storefrontv2/models/BaseCollection"),i=e("storefrontv2/models/EntityList"),s=e("storefrontv2/models/PagePreview"),a=n.extend({model:i}),r=s.extend({initialize:function(e,n){s.prototype.initialize.call(this,e,n);var i=this;t.each(r.getValidSections(),function(e){var t=i.get(e);t&&t.each(function(e){i.entitiesCache.addEntities(e.get("entities").models),i.listenTo(e,"gridPageFetch:success",i.mergeGridPageEntities)})})},parse:function(e){var n=r.getValidSections();return e=$.extend({},e),t.each(t.keys(e.section_layout),function(i){var s=e.section_layout[i];t.contains(n,i)&&s.length&&(s=s.map(function(t){var n=e.store_components[t];return n.component_key=t,n.page_path=e.path,n}),e[i]=new a(s,{entityMap:e.entity_lookup_dict,parse:!0}))}),e},getBannerUrl:function(){var e=this.get("banner");return e?this.sharedConfig.storefrontConstants.STORE_ROOT+e.url:""},getTitleText:function(){var e="The Humble Store: ";return this.isMainPage()?e+"Great games. Fantastic prices. Support charity.":e+this.get("human_name")},isMainPage:function(){return"/"==this.get("path")},mergeGridPageEntities:function(e){this.entitiesCache.addEntities(e.models)}},{SECTIONS:{FEATURED_SECTION:"featured_section",OTHERS_SECTION:"others_section",SECONDARY_SECTION:"secondary_section",SIDEBAR_TOP_SECTION:"sidebar_top_section",SIDEBAR_BOTTOM_SECTION:"sidebar_bottom_section"},getValidSections:function(){return t.values(r.SECTIONS)}});return r}),define("storefrontv2/models/BaseEntityCollection",["require","storefrontv2/models/BaseCollection","storefrontv2/models/Entity","storefrontv2/models/Page","storefrontv2/models/PagePreview","storefrontv2/models/Product"],function(e){"use strict";var t=e("storefrontv2/models/BaseCollection"),n=e("storefrontv2/models/Entity"),i=e("storefrontv2/models/Page"),s=e("storefrontv2/models/PagePreview"),a=e("storefrontv2/models/Product");return t.extend({model:function(e,t){return e.type==n.TYPES.PAGE?e.entity_lookup_dict?new i(e,t):new s(e,t):e.type==n.TYPES.PRODUCT?new a(e,t):void 0}})}),define("charity/models",["backbone"],function(e){var t=e.Model.extend({idAttribute:"charity_id",defaults:{human_name:"",logo_url:"",charity_id:""}}),n=e.Collection.extend({model:t,comparator:function(e){return e.get("human_name")}});return{Charity:t,CharityList:n}}),define("pubsub",["backbone","underscore"],function(e,t){"use strict";var n=function(){t.extend(this,e.Events),this._store={},this.subscribe=function(e,n){t.has(this._store,e)&&n.apply(null,this._store[e]),this.on(e,n)},this.publish=function(e){var t=Array.prototype.slice.call(arguments,1);this._store[e]=t,this.trigger.apply(this,arguments)},t.bindAll(this,"subscribe","publish")};return n}),define("charity/helpers",["pubsub"],function(e){return{BODY_SEARCH_PAGE_SIZE:14,ORDER_FORM_SEARCH_PAGE_SIZE:6,DEFAULT_CHARITY_IMAGE:"https://humblebundle-a.akamaihd.net/misc/files/hashed/c046248875f8bbb55008e8d80911cda882721762.gif",charityPubSub:new e,updateUserCharity:function(e,t,n,i){var s=HB_SHARED_CONSTANTS.CSRF_COOKIE_KEY+"=",a=document.cookie.lastIndexOf(s)+s.length,r=document.cookie.slice(a),o=r&&r.split(";")[0];t[HB_SHARED_CONSTANTS.CSRF_FORM_KEY]=o,$.ajax({type:"POST",url:"/api/v1/user/charity",data:t,error:i,success:n})}}}),define("lib/hbTemplate!charity/templates/selectionError.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-selection-message'>\n    <h1>Loading failed</h1>\n    <p>You may have a connection problem, or our server may be experiencing issues.</p>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/selectionLoading.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-selection-message'>\n    <img src='xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif' alt='' />\n    <h1>Loading…</h1>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/selectionNoResults.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-selection-message'>\n    <h1>No results.</h1>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("charity/baseViews",["backbone","charity/helpers","util/main","hbtemplate!./templates/selectionError.html","hbtemplate!./templates/selectionLoading.html","hbtemplate!./templates/selectionNoResults.html"],function(e,t,n,i,s,a){"use strict";var r=_.template(i),o=_.template(s),l=_.template(a),c=e.View.extend({tagName:"div",className:"charity-preview",initialize:function(e){this.options=e,_.bindAll(this,"render","select_this_charity","update_charity"),this.constants=this.options.constants,this.is_disallowed=e.is_disallowed,this.pubSub=t.charityPubSub,this.pubSub.subscribe("charity_updated",this.update_charity),this.rendered=!1},render:function(){this.rendered=!0,this.model.disableSelection||this.$(".js-select-charity").on("click",this.select_this_charity),this.is_disallowed&&this.$el.addClass("is-disallowed"),_.each(this.$(".charity-img"),function(e){n.preload_background_image_with_default(e,t.DEFAULT_CHARITY_IMAGE)})},get_template_params:function(){var e=this.model.toJSON();return e.is_selected=this.is_selected,e.country=this.constants.CHARITY_SEARCH_PARAMS.country[this.model.get("country")],e.is_disallowed=this.is_disallowed,e.current_url=window.location.origin+window.location.pathname,e},select_this_charity:function(e){e.preventDefault(),e.stopPropagation(),this.is_disallowed||this.model&&this.pubSub.publish("set_charity",{current_charity_is_random:!1,current_charity:this.model})},update_charity:function(e){e.current_charity&&(this.is_selected=this.model.get("charity_id")==e.current_charity.get("charity_id"),this.rendered&&(this.is_selected?this.$(".js-select-charity").addClass("is-selected"):this.$(".js-select-charity").removeClass("is-selected"),this.is_disallowed?this.$(".js-select-charity").addClass("is-disallowed"):this.$(".js-select-charity").removeClass("is-disallowed")))}}),u=e.View.extend({tagName:"div",className:"charity-list",events:{},initialize:function(e){this.options=e,_.bindAll(this,"render","renderCharityPreview"),this.constants=this.options.constants,this.pubSub=this.options.pubSub},render:function(){var e=this;return this.$el.empty(),this.collection.each(function(t){e.$el.append(e.renderCharityPreview(_.extend(t,{disableSelection:e.options.disableSelection})))}),this.delegateEvents(),this.el}}),d=e.View.extend({initialize:function(e){this.pubSub=e.pubSub,this.last_sent_request_id=0,this.last_received_request_id=-1,this.UNITED_STATES="US",this.num_results=0,this.page=1,this.PAGE_SIZE=void 0,_(this).bindAll("handleServerResponse","handleCountryChange","showNoResultsState","showLoadingState","showErrorState")},handleServerResponse:function(e){var t=Math.min(1e3,e.num_results);return this.num_results=t,this.num_pages=Math.ceil(t/this.constants.CHARITY_RESULTS_PAGE_SIZE),0==e.results.length?void this.showNoResultsState():(1==e.num_results?this.$(".js-results-heading").text(e.num_results+" result for search"):e.num_results>1e3?(this.$(".js-results-heading").text("1000+ results"),this.$(".js-results-heading-disclaimer").show()):this.$(".js-results-heading").text(e.num_results+" results for search"),this.collection.add(e.results),this.search_results_collection.reset(e.results),void this.renderSearchResults())},handleCountryChange:function(){var e=this.$(".js-country-label"),t=this.$(".js-state-label"),n=this.$(".js-charity-country");n.val()==this.UNITED_STATES?(t.addClass("is-united-states"),e.addClass("is-united-states")):(t.removeClass("is-united-states"),e.removeClass("is-united-states"))},showLoadingState:function(){this.$(".js-results-heading").text(""),this.$(".js-results-heading-disclaimer").hide();var e=this.$(".js-charity-results");e.html(o({}))},showErrorState:function(){this.$(".js-results-heading").text("");var e=this.$(".js-charity-results");e.html(r({}))},showNoResultsState:function(){this.$(".js-results-heading").text("0 results for search");var e=this.$(".js-charity-results");e.html(l({}))},searchCharities:function(e){var t=this,n=5;e.page-=1;var i=function(n){e.request=++t.last_sent_request_id,t.showLoadingState(),$.ajax({type:"GET",url:"/api/v1/charity/search",data:e,error:function(){0===n?t.showErrorState():i(n-1)},success:function(e){var n=parseInt(e.request);n>t.last_received_request_id?(t.last_received_request_id=n,t.handleServerResponse(e)):console.log("ignoring")}})};i(n)}});return{BaseCharityPreviewView:c,BaseCharityListView:u,BaseSelectionView:d}}),define("lib/hbTemplate!storefront/templates/charity/charitySelection.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='featured-charities'>\n    <div class='featured-description-wrapper'>\n      <h3 class='featured-heading'>Featured Charities</h3>\n      <p class='featured-charities-description'>\n        Select one of our featured charities,<br>\n        or choose a new one from a database<br>\n        of thousands. Have any questions?<br>\n        Visit our <a href='https://support.humblebundle.com/hc/en-us/articles/207870727-Supporting-charity-through-the-Humble-Store' target='_blank'>support page</a>.\n      </p>\n    </div>\n    <div class='js-featured-charities featured-charities-list'>\n    </div>\n  </div>\n\n  <h2>Charity Search</h2>\n  <div class='charity-search js-charity-search'>\n    <label class='query'>\n      <input type='text' name='search' class='js-charity-query' placeholder='Search names or keywords'>\n      <i class='hb hb-search'></i>\n    </label><label class='category'>Category\n      <select name='category' class='js-charity-category'>\n        <option value='' selected>All</option>\n<% _.each(categories, function(val, key) { %>\n        <option value='<%- key %>'><%- val %></option>\n<% }); %>\n      </select>\n    </label><label class='country js-country-label'>Country\n      <select name='country' class='js-charity-country'>\n        <option value='' selected>All</option>\n<% _.each(countries, function(val, key) { %>\n        <option value='<%- key %>'><%- val %></option>\n<% }); %>\n      </select>\n    </label><label class='state js-state-label'>State\n      <select name='state' class='js-charity-state'>\n        <option value='' selected>All</option>\n<% _.each(_.sortBy(_.pairs(states), function(tuple) { return tuple[1]; }), function(tuple) { %>\n        <option value='<%- tuple[0] %>'><%- tuple[1] %></option>\n<% }); %>\n      </select>\n    </label><button type=\"submit\" class=\"js-submit-search\">Search</button>\n  </div>\n  <h3 class='js-results-heading results-heading'></h3>\n  <h4 class='js-results-heading-disclaimer results-heading-disclaimer'>Note: only 1000 results are displayed per search</h4>\n  <div class='js-charity-results charity-results'>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!storefront/templates/charity/charityDetails.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-title'>\n    <h2><%= human_name %></h2>\n    <button class='\n      select-charity\n      js-select-charity\n  <% if (is_selected) { %>\n      is-selected\n  <% } %>\n    '>\n      <span class='selected-text'>Selected</span>\n      <span class='unselected-text'>Select this charity</span>\n    </button>\n  </div>\n  <div class='charity-img' style='background-image: url(\"<%= logo_url %>\");'></div>\n  <div class='charity-sidebar'>\n    <p class='charity-info'><strong>Category:</strong> <%= category %></p>\n    <p class='charity-info'><strong>Location:</strong>\n<% if (country == 'United States') { /* XXX: is this the right country format? */ %>\n      <%- city %>, <%- state %>\n<% } else { %>\n      <%- country %>\n<% } %>\n    </p>\n<% if (url) { %>\n    <a class='charity-link' href='<%= url %>' rel=\"nofollow\">Visit their website</a>\n<% } %>\n    <div class='charity-description'>\n      <%= description %>\n    </div>\n    <p class='charity-info'>\n      <strong>Recommend this charity</strong><br>\n      Use this link to refer a friend to the Humble Store in support of <%= human_name %>:<br>\n      <a href=\"https://www.humblebundle.com/store?charity=<%= charity_id %>\" rel=\"nofollow\">https://www.humblebundle.com/store?charity=<%= charity_id %></a>\n    </p>\n  </div>\n\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!storefront/templates/charity/charityPreview.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";
return"  <% include('internal-link', {'href': '/select-charity/charity/' + charity_id}) %>\n    <div class='charity-img' style='background-image: url(\"<%= logo_url %>\");'></div>\n  </a>\n    <div class='charity-name'>\n      <% include('internal-link', {'href': '/select-charity/charity/' + charity_id}) %>\n        <h4><%= human_name %></h4>\n        <h5 class='location'>\n<% if (country == 'United States') { /* XXX: is this the right country format? */ %>\n          <%- city %>, <%- state %>\n<% } else { %>\n          <%- country %>\n<% } %>\n        </h5>\n      </a>\n    <button class='\n      select-charity\n      js-select-charity\n  <% if (is_selected) { %>\n      is-selected\n  <% } %>\n    '>\n      <span class='selected-text'>Selected</span>\n      <span class='unselected-text'>Select</span>\n    </button>\n    </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!storefront/templates/charity/messageAccountError.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-account-cta-message'>\n    <p>\n      <strong>An error occurrred while saving your charity selection.</strong> However, your selection is still set for your current purchase.\n    </p>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!storefront/templates/charity/messageAccountSuccess.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-account-cta-message'>\n    <p class=\"message\">\n      <strong>Selection updated.</strong> Your selection has been saved to your account for future purchases.\n    </p>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!storefront/templates/charity/messsageAccountCTA.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-account-cta-message'>\n    <p>\n      <strong>Charity selection updated.</strong>\n      <a href='/login?goto=/store/<%= fragment %>' class='account-login' data-target-popup='#account-login'>Log in</a>\n      or <a href='/signup?goto=/store/<%= fragment %>' class='create-account' data-target-popup='#account-signup'>create an account</a>\n      to remember your choice for future purchases.\n    </p>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!storefront/templates/charity/paginationControls.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='pagination-controls'>\n<% if (current_page > 1) { %>\n    <% include('internal-link', {'href': build_page_link_url(current_page - 1), '_class': 'page-link'}) %>Previous</a>\n<% } else { %>\n    <span class='page-link disabled'>Previous</span>\n<% } %>\n\n<% if (minimum_page > 1) { %>\n    <% include('internal-link', {'href': build_page_link_url(1), '_class': 'page-link'}) %>1</a>\n    <span class='page-link ellipsis'>...</span>\n<% } %>\n\n<% for (var i = minimum_page; i <= maximize_page; i++) { %>\n  <% if (i == current_page) { %>\n    <span class='page-link current-page'><%= i %></span>\n  <% } else { %>\n    <% include('internal-link', {'href': build_page_link_url(i), '_class': 'page-link'}) %><%= i %></a>\n  <% } %>\n<% } %>\n\n<% if (maximize_page < num_pages) { %>\n    <span class='page-link ellipsis'>...</span>\n    <% include('internal-link', {'href': build_page_link_url(num_pages), '_class': 'page-link'}) %><%= num_pages %></a>\n<% } %>\n\n<% if (current_page < num_pages) { %>\n    <% include('internal-link', {'href': build_page_link_url(current_page + 1), '_class': 'page-link'}) %>Next</a>\n<% } else { %>\n    <span class='page-link disabled'>Next</span>\n<% } %>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("storefront/templates/charity/all",["util/templating","hbtemplate!./charitySelection.html","hbtemplate!./charityDetails.html","hbtemplate!./charityPreview.html","hbtemplate!./messageAccountError.html","hbtemplate!./messageAccountSuccess.html","hbtemplate!./messsageAccountCTA.html","hbtemplate!./paginationControls.html","hbtemplate!charity/templates/selectionError.html","hbtemplate!charity/templates/selectionLoading.html","hbtemplate!charity/templates/selectionNoResults.html"],function(e,t,n,i,s,a,r,o,l,c,u){return{charitySelection:t,charityDetails:n,charityPreview:i,messageAccountError:s,messageAccountSuccess:a,messsageAccountCta:r,paginationControls:o,selectionError:l,selectionLoading:c,selectionNoResults:u}}),define("lib/hbTemplate!account/templates/loading_spinner.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<img class="js-spinner" height=25 src="xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif">\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_message.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1 class='noimg'><%= title %></h1>\n\n  <div class='message-holder'><%= message %></div>\n    <div class='no-center'>\n      <div class='button-holder'>\n        <a class='button-link cancel js-cancel' href='#' data-goto='<%= gotoHref %>'><span class='green-button'>OK</span></a>\n      </div>\n      <div class='clearfix'></div>\n    </div>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_confirmation.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1 class='noimg'><%= title %></h1>\n\n  <div class='message-holder'><%= message %></div>\n  <div class='no-center'>\n    <div class='button-holder'>\n      <a class='button-link cancel js-cancel' href='#'>\n        <span class='button small red'><%= cancelText || 'Cancel' %></span>\n      </a>\n      <a class='button-link submit js-submit' href='#'>\n        <span class='button small green'><%= confirmText || 'Confirm' %></span>\n      </a>\n    </div>\n    <div class='clearfix'></div>\n  </div>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_login.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1 class='js-heading'><span class='main-base-arrow js-loader'></span>Log In</h1>\n<% if (request_reason == 'secure-area') { %>\n  <h2 class='subtitle warning'>For security reasons, please enter your credentials.</h2>\n<% } %>\n  <p class='message-holder js-message-holder'></p>\n  <form id='account-login-form' method='post' action='<%= base_url_secure %>/processlogin' target='hidden-login-iframe' data-input-prefix='account-login-' data-captcha-url='<%= base_url_secure %>/login/captcha'>\n    <%= csrf_token_input %>\n    <input name='goto' type='hidden' value='<%= goto %>'>\n    <input name='qs' type='hidden' value='<%= qs %>'>\n    <input name='script-wrapper' type='hidden' value=true>\n    <p class='input-holder'>\n      <label id='account-login-username-label' class='account-infield' for='account-login-username<%= suffix %>'>Email</label>\n      <input name='username' type='text' id='account-login-username<%= suffix %>' class='account-input js-focus'>\n    </p>\n    <p class='input-holder'>\n      <label id='account-login-password-label' class='account-infield' for='account-login-password<%= suffix %>'>Password</label>\n      <input name='password' type='password' value='' id='account-login-password<%= suffix %>' class='account-input'>\n    </p>\n    <p id='account-login-authy-token-holder' class='input-holder'>\n      <label id='account-login-authy-token-label' class='account-infield' for='account-login-authy-token<%= suffix %>'>Authy token</label>\n      <input name='authy-token' type='text' value='' id='account-login-authy-token<%= suffix %>' class='inline-input account-input' style='display: inline'>\n      <input name='submit-data' type='hidden' value=''>&nbsp;\n      <a class='button-link submit gray-button' href='https://support.humblebundle.com/hc/en-us/articles/202421374' target=_blank id='get-instructions'>Instructions</a>\n      <br>\n      <a class='small-link js-send-sms' href='#' id='send-sms'>Send SMS</a>\n    </p>\n    <div class='input-holder'>\n      <div id='account-login-captcha<%= suffix %>'></div>\n    </div>\n    <div class='no-center'>\n      <div class='link-holder'>\n        <a class='forgot-pw' href='/user/forgot' data-target-popup='#account-pw-reset'>Forgot your password?</a><br/>\n        <a class='js-show-2fa show-2fa' href=\"#\">Two-step verification</a>\n        \n      </div>\n      <div class='button-holder'>\n<% if (suffix == '-modal') { %>\n        <a class='button-link cancel js-cancel' href='#'><span class='gray-button'>Cancel</span></a>\n<% } %>\n        <a class='button-link submit js-submit' href='#'><span class='green-button'>Log In</span></a>\n      </div>\n    </div>\n  </form>\n  <div class='account-switch'>\n    <a class='create-account slide-down' href='<%= base_url_secure %>/signup' data-target-popup='#account-signup'>Need to <span class='create-inner'>create an account</span>?</a>\n  </div>\n  <iframe name='hidden-login-iframe' id='hidden-login-iframe' style='display: none'></iframe>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_relogin.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1><span class='main-base-arrow js-loader'></span>Confirm Password</h1>\n  <h2 class='subtitle warning'>For security reasons, please enter your current password.</h2>\n  <form id='account-login-form' method='post' action='<%= base_url_secure %>/user/confirm-password' data-input-prefix='account-login-'>\n    <%= csrf_token_input %>\n    <p class='input-holder'>\n      <label id='account-login-password-label' class='account-infield' for='account-login-password<%= suffix %>'>Password</label>\n      <input name='password' type='password' value='' id='account-login-password<%= suffix %>' class='account-input'>\n    </p>\n    <p id='account-login-authy-token-holder' class='input-holder'>\n      <label id='account-login-authy-token-label' class='account-infield' for='account-login-authy-token<%= suffix %>'>Authy token</label>\n      <input name='authy-token' type='text' value='' id='account-login-authy-token<%= suffix %>' class='inline-input account-input' style='display: inline'>\n      <input name='submit-data' type='hidden' value=''>&nbsp;\n      <a class='button-link submit gray-button' href='https://support.humblebundle.com/hc/en-us/articles/202421374' target=_blank id='get-instructions'>Instructions</a>\n      <br>\n      <a class='small-link js-send-sms' href='#' id='send-sms'>Send SMS</a>\n    </p>\n    <div class='input-holder'>\n      <div id='account-login-captcha-modal'></div>\n    </div>\n    <div class='no-center'>\n      <div class='button-holder'>\n        <a class='button-link cancel js-cancel' href='#'><span class='gray-button'>Cancel</span></a>\n        <a class='button-link submit js-submit' href='#'><span class='green-button'>Confirm</span></a>\n      </div>\n    </div>\n  </form>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_signup.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1><span class='main-base-arrow js-loader'></span>Create Account</h1>\n  <h2 class='subtitle'>Create an account to organize your bundles.</h2>\n  <form action='<%= base_url_secure %>/signup' data-input-prefix='account-signup-' method='POST'>\n<% if (goto) { %>\n    <input name='goto' type='hidden' value='<%= goto %>'>\n<% } %>\n    <p class='input-holder'>\n      <label class='account-infield' for='account-signup-email<%= suffix %>'>Email</label>\n      <input name='email' type='text' id='account-signup-email<%= suffix %>' class='account-input js-focus'>\n    </p>\n    <p class='input-holder'>\n      <label class='account-infield' for='account-signup-password<%= suffix %>' id='account-signup-password-label'>Password</label>\n      <input name='password' type='password' value='' id='account-signup-password<%= suffix %>' class='account-input'>\n    </p>\n    <p class='disclaimer'>\n      By clicking &quot;Sign Up&quot; and creating a humblebundle.com account, I acknowledge that I am 13 years of age or older and that I understand and agree to this website&#39;s <a href='/terms' target='_blank'>Terms and Conditions</a> and <a href='/privacy' target='_blank'>Privacy Policy</a>.\n    </p>\n    <p class='input-holder'>\n      <input id='account-signup-subscribe' name='subscribe' type='checkbox' value='true' checked>\n      <label for='account-signup-subscribe'>Notify me about Humble Bundle promotions.</label>\n    </p>\n\n    <div class='input-holder'>\n      <div id='account-signup-captcha'></div>\n    </div>\n\n    <div class='no-center'>\n      <div class='button-holder'>\n        <a class='button-link cancel js-cancel' href='#'><span class='gray-button'>Cancel</span></a>\n        <a class='button-link submit js-submit' href='#'><span class='green-button'>Sign Up</span></a>\n      </div>\n      <div class='clearfix'></div>\n    </div>\n  </form>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_pw_reset.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1><span class='main-base-arrow js-loader'></span>Password Reset</h1>\n  <form action='<%= base_url_secure %>/user/forgot' data-input-prefix='account-pw-reset-'>\n    <p class='input-holder'>\n      <label class='account-infield' for='account-pw-reset-email<%= suffix %>'>Email</label>\n      <input name='email' type='text' id='account-pw-reset-email<%= suffix %>' class='account-input js-focus'>\n    </p>\n\n    <div class='input-holder'>\n      <div id='account-pw-reset-captcha'></div>\n    </div>\n\n    <div class='no-center'>\n      <div class='button-holder'>\n        <a class='button-link cancel js-cancel' href='#'><span class='gray-button'>Cancel</span></a>\n        <a class='button-link submit js-submit' href='#'><span class='green-button'>Submit</span></a>\n      </div>\n      <div class='clearfix'></div>\n    </div>\n  </form>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_humble_guard.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1><i class='hb hb-lock'></i>Verify This Browser</h1>\n  <h2 class='subtitle warning'>It looks like you are accessing your Humble Bundle account from an unfamiliar browser.\n    For your protection, we need to verify that this computer is yours. We've sent you an email\n  to the address attached to this account. <br /><br />\n  Enter the code from the email to proceed:</h2>\n  <form id='account-humble-guard-form' method='post' action='<%= base_url_secure %>/user/humbleguard' data-input-prefix='account-humble-guard-'>\n    <input name='goto' type='hidden' value='<%= goto %>'>\n    <input name='qs' type='hidden' value='<%= qs %>'>\n    <p class='input-holder'>\n      <label id='account-humble-guard-code-label' class='account-infield' for='account-humble-guard-code<%= suffix %>'></label>\n      <input name='code' type='text' value='' id='account-humble-guard-code<%= suffix %>' class='account-input always-caps'>\n\n    </p>\n    <p class='resend-email'>No code? <a class='js-resend' href='#'>Resend email</a></p>\n    <div class='input-holder'>\n      <div id=\"account-humble-guard-captcha-modal\"></div>\n    </div>\n    <div class=\"split-left\">\n      \n      <a href=\"https://support.humblebundle.com/hc/en-us/articles/202434394-Humble-Account-Browser-Verification\" target=\"_blank\"><i class=\"hb hb-question-circle\"></i></a>\n      <a href=\"https://support.humblebundle.com/hc/en-us/articles/202434394-Humble-Account-Browser-Verification\" target=\"_blank\">Need help?</a>\n    </div><div class=\"split-right\">\n      <div class='no-center'>\n        <div class='button-holder'>\n          <a class='button-link cancel js-cancel' href='#'><span class='gray-button'>Cancel</span></a>\n          <a class='button-link submit js-submit' href='#'><span class='green-button'>Verify</span></a>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_authy.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1><span class='main-base-arrow js-loader'></span>Confirm Two-Step Verification</h1>\n  <form id='account-login-form' method='post' action='<%= base_url_secure %>/user/confirm-authy' data-input-prefix='account-login-'>\n    <%= csrf_token_input %>\n    <p id='account-confirm-authy-token-holder' class='input-holder'>\n      <label id='account-login-authy-token-label' class='account-infield' for='account-login-authy-token<%= suffix %>'>Authy token</label>\n      <input name='authy-token' type='text' value='' id='account-login-authy-token<%= suffix %>' class='inline-input account-input' style='display: inline'>\n      <input name='submit-data' type='hidden' value=''>&nbsp;\n      <a class='button-link submit gray-button' href='https://support.humblebundle.com/hc/en-us/articles/202421374' target=_blank id='get-instructions'>Instructions</a>\n      <br>\n      <a class='small-link js-send-sms' href='#' id='send-sms'>Send SMS</a>\n    </p>\n    <div class='no-center'>\n      <div class='button-holder'>\n        <a class='button-link cancel js-cancel' href='#'><span class='gray-button'>Cancel</span></a>\n        <a class='button-link submit js-submit' href='#'><span class='green-button'>Confirm</span></a>\n      </div>\n    </div>\n  </form>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_steam_link_free_product.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1>Steam Link Required</h1>\n  <p class="message-holder">\n    Before you can redeem your free copy of <%- product_human_name %>, you must link your Steam account to your Humble Bundle account.\n  </p>\n  <div class="no-center">\n    <div class="button-holder">\n      <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n      <a class="button-link" href="/steam/openid/link?redirect=<%= product_redirect %>"><span class="green-button">Link Steam Account</span></a>\n    </div>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("account/templates/all",["util/templating","hbtemplate!./loading_spinner.html","hbtemplate!./account_message.html","hbtemplate!./account_confirmation.html","hbtemplate!./account_login.html","hbtemplate!./account_relogin.html","hbtemplate!./account_signup.html","hbtemplate!./account_pw_reset.html","hbtemplate!./account_humble_guard.html","hbtemplate!./account_authy.html","hbtemplate!./account_steam_link_free_product.html"],function(e,t,n,i,s,a,r,o,l,c,u){function d(t){return function(n){return e.renderTemplate(t,n)}}return{loading_spinner:d(t),account_message:d(n),account_confirmation:d(i),account_login:d(s),account_relogin:d(a),account_signup:d(r),account_pw_reset:d(o),account_humble_guard:d(l),account_authy:d(c),account_steam_link_free_product:d(u)}}),define("account/accountModals",["lib/jquery/full","underscore","backbone","lib/backbone.modal","lib/email-validation","account/templates/all","util/main"],function(e,t,n,i,s,a,r){"use strict";var o=function(t,i,s){var a=new n.Model({title:t,message:i,gotoHref:s||""}),r=new p({model:a});e("#site-modal").html(r.render().el)},l=function(t,i,s,a,o,l,c){var u=new n.Model({title:t,message:i,confirmText:s,cancelText:a,gotoHref:c||""}),d=new _({model:u});d.onClose=null,"function"==typeof o?d.submit=o:d.submit=function(){var e=u.get("gotoHref");e&&r.redirectInDomain(e)},"function"==typeof l&&(d.cancel=l),e("#site-modal").html(d.render().el)},c=function(){e("body").on("click",".grayout a.cancel, .grayout-inner",function(t){(e(this).hasClass("cancel")||e(this).hasClass("grayout-inner"))&&(t.preventDefault(),e(this).data("goto")&&r.redirectInDomain(e(this).data("goto")),e(".grayout, .arrow-error, .generic-popup.outer-shadow, .download-popup").fadeOut(),e('.generic-popup input[type="text"], .generic-popup input[type="password"]').val("").blur(),e(".generic-popup .account-infield").fadeIn())})},u=function(n){n=n||{},e(function(){n.debug||!1;e(document).on("click",".forgot-pw, .create-account, .account-login, .humble-guard",function(i){i.preventDefault();var s,a,r=e(this),o=r.data("targetPopup"),l=r.attr("href");s=new C[o](t.extend(n,{gotoHref:l})),a=s.render().el,e("#site-modal").html(a)}),e(".generic-popup").delegate(".error-holder .error-item","click",function(t){t.preventDefault(),e(e(this).attr("href")).focus()})})},d=n.Modal.extend({prefix:"generic-bbm",suffix:"-modal",submitEl:".js-submit",cancelEl:".js-cancel",initialize:function(e){this.options=e||{},this.options.attributes?t.extend(this.options.attributes,{suffix:this.suffix}):t.extend(this.options,{attributes:{suffix:this.suffix}})},onClose:function(){var e=this.$(".js-cancel").data("goto");e&&r.redirectInDomain(e)},serializeData:function(){var e=n.Modal.prototype.serializeData.call(this);return this.options&&this.options.attributes&&(e=t.extend(e,this.options.attributes)),e},triggerSubmit:function(e){return e&&(null!=e&&e.preventDefault(),!this.beforeSubmit||this.beforeSubmit()!==!1)?"function"==typeof this.asyncSubmit?this.asyncSubmit(e):("function"==typeof this.submit&&this.submit(),this.regionEnabled?this.trigger("modal:close"):this.close()):void 0}}),h=d.extend({onRender:function(){t.extend(this,{$toSlideDown:this.$(".slide-down"),$form:this.$("form")}),this.options.required&&this.$(this.cancelEl).hide(),this.$toSlideDown.css("display","none");var e=this.$("input[name=goto]"),n=this.$("input[name=qs]");if(e&&n)if(this.options.gotoHref&&"#"!=this.options.gotoHref)e.val(this.options.gotoHref),n.val(this.options.queryString);else{e.val()!=window.location.pathname&&e.val(window.location.pathname);var i=window.location.search;i&&(i=i.substr(1),n.val(i))}this.$(".js-show-2fa").click(t.bind(function(e){e.preventDefault(),this._show_authy()},this)),this.$form.keypress(function(e){13==e.which&&e.preventDefault()})},beforeCancel:function(){return this.options.required?!1:!0},onRendered:function(){var t=/(iPod|iPhone|iPad)/.test(navigator.userAgent);t&&this.$("input").focus(function(t){e(t.target).closest(".generic-bbm-wrapper").css("max-height",document.documentElement.clientHeight)}),this.$(".account-infield").inFieldLabels({fadeOpacity:.6,fadeDuration:250,hideDuration:200}),this.$toSlideDown.slideDown("fast"),this.$(".js-focus").focus(),window.pause_timers&&window.pause_timers()},onClose:function(){window.resume_timers&&window.resume_timers(),d.prototype.onClose.apply(this,arguments)},asyncSubmit:function(t){var n=this,i=this.$("form"),s=i.attr("action"),a=i.serialize();return n._show_loading_spinner(),n._hide_validation_errors(),"send-sms"===t.target.id&&(a+="&send_sms=1",a=a.replace("&script-wrapper=true",""),a=a.replace("?script-wrapper=true","?")),e.ajax({type:"POST",url:s,data:a,dataType:"json",statusCode:{400:function(t,s,a){var r=e.parseJSON(t.responseText);if(r.captcha_required?n._show_captcha():n._refresh_captcha(),i.closest(".generic-popup").length)n._show_validation_errors(r.errors);else if(r.errors){var o="";for(var l in r.errors)o=r.errors[l][0];if(!o)return;n._show_response_message("Error",o,r["goto"]),n.close()}},401:function(t,i,s){var a=e.parseJSON(t.responseText);a.captcha_required?n._show_captcha():n._refresh_captcha(),a.authy_required&&n._show_authy(),n._show_validation_errors(a.errors)},403:function(t,i,s){var a,r="An error occurred. Please try again later.";if(t.responseText){var o=e.parseJSON(t.responseText);a=o["goto"];for(var l in o.errors)r=o.errors[l][0]}n._show_response_message("Error",r,a),n.close()}},error:function(e,t,i){n._hide_loading_spinner()},success:function(t,i,s){if(n._hide_loading_spinner(),t.sms_sent)return e("#send-sms").text("Send SMS again"),void n._show_validation_errors({"authy-token":["SMS sent! Please enter your code here."]});if(n.onSubmitSuccess)return void n.onSubmitSuccess(t,i,s);if(t.message)n._hide_loading_spinner(),n._hide_validation_errors(),n._show_response_message(t.message.title,t.message.body,t["goto"]),n.close();else if(t.force_refresh)window.location.reload();else{var a=window.location.pathname+window.location.search;r.redirectInDomain(t["goto"]),(t["goto"].split("#")[0]===a||0===t["goto"].indexOf("#"))&&window.location.reload()}}})},_show_loading_spinner:function(){var t=this.$("form").closest(".generic-popup").find(".js-loader"),n=t.next(".js-spinner");0==n.length&&(n=e(a.loading_spinner()),n.insertAfter(t)),t.hide(),n.show()},_hide_loading_spinner:function(){var e=this.$("form").closest(".generic-popup").find(".js-loader"),t=e.next(".js-spinner");t.hide(),e.show()},_manipulate_captcha:function(t){var n=this.$("form"),i=this.getFieldId(n,"captcha");e("#"+i);(t||this.captcha)&&(this.captcha?this.captcha.reset():this.captcha=new Recaptcha2(i))},_show_captcha:function(){this._manipulate_captcha(!0)},_refresh_captcha:function(){this._manipulate_captcha(!1)},_show_authy:function(){var e=this.$("#account-login-authy-token-holder");this.$(".js-show-2fa").hide(),e.length&&(e.show(),e.find("input").focus())},_resend_humble_guard_code:function(t){t.preventDefault();var n=e(".resend-email");n.html("Resending...."),e.ajax({type:"POST",url:"/user/humbleguard?resend=1"}).success(function(){n.html("Email resent")}).error(function(){n.html("Too many emails sent. Please wait 24 hours and then try again")})},_show_validation_errors:function(e){this.generateErrorList(e)},_hide_validation_errors:function(){e(".arrow-error").hide()},_show_response_message:function(e,t,n){o(e,t,n)},getFieldId:function(e,t){return(e.data("inputPrefix")||e.attr("id")||"id_")+t+this.suffix},setFormMessage:function(t,n,i){var s=this.getFieldId(t,n),a=s+"-msg",r=e("#"+s),o=e("#"+a);o.length>0?o.html(i+'<div class="arrow-error-right"></div>'):(r.closest(".input-holder").append('<div class="arrow-holder"><div class="arrow-error" id="'+a+'">'+i+'<div class="arrow-error-right"></div></div></div>'),o=e("#"+a));var l=r.position().top;return o.css({top:l+"px"}),o.fadeIn(),o},setFormMessages:function(e){this.$(".arrow-error").fadeOut("fast");var t=this.$("form");for(var n in e)this.setFormMessage(t,n,e[n][0])},generateErrorList:function(e){return e?void this.setFormMessages(e):null}}),p=d.extend({template:a.account_message}),_=d.extend({template:a.account_confirmation}),m=h.extend({template:a.account_login,events:{"click .js-send-sms":"sendSms"},onRendered:function(){var t=this,n=this.$("form");e.ajax({type:"POST",url:n.data("captcha-url"),statusCode:{401:function(){t._show_captcha()}}}),h.prototype.onRendered.call(this)},sendSms:function(e){return e.preventDefault(),h.prototype.asyncSubmit.call(this,e)},asyncSubmit:function(e){var t=this;t._show_loading_spinner(),t._hide_validation_errors(),window.login_callback=function(e){if(t._hide_loading_spinner(),e.success){var n=window.location.pathname+window.location.search;r.redirectInDomain(e["goto"]),(e["goto"].split("#")[0]===n||0===e["goto"].indexOf("#"))&&window.location.reload()}else e.captcha_required?t._show_captcha():t._refresh_captcha(),e.authy_required&&t._show_authy(),t._show_validation_errors(e.errors)},this.$("form").submit()}}),g=m.extend({prefix:"inline",suffix:"-pane",beforeCancel:function(){return!1}}),f=m.extend({onRendered:function(){var e="Login Required";this.$(".js-heading").text(e);var t="You must be logged into a Humble Bundle account to redeem your free copy of "+this.options.attributes.product_human_name+".";this.$(".js-message-holder").text(t),m.prototype.onRendered.apply(this,arguments)}}),v=h.extend({template:a.account_signup,onRendered:function(){var n="#account-signup-email"+this.suffix;s.bindEmailField(e(n),t.bind(function(t,i){var s=t.closest("form"),a=t.attr("name");return i?this.setFormMessage(s,a,i):(e(n+"-msg").fadeOut("fast"),e(n+"-msg"))},this)),h.prototype.onRendered.call(this)}}),b=h.extend({template:a.account_pw_reset}),y=h.extend({template:a.account_humble_guard,events:{"click .js-resend":"_resend_humble_guard_code"},onRendered:function(){this.$("input").focus()},onSubmitSuccess:function(e){this.options.onSuccess?this.options.onSuccess(this):r.redirectInDomain(e["goto"])},onClose:function(){return this.options.onClose&&this.options.onClose(this),!1}}),w=d.extend({template:a.account_steam_link_free_product}),C={"#account-message":p,"#account-login":m,"#account-pw-reset":b,"#account-signup":v,"#account-humble-guard":y};return{bindCancelDialog:c,bindAccountModalHandling:u,displayDialog:o,displayConfirmation:l,modals:C,BaseModal:d,BaseAccountModal:h,AccountMessageModal:p,AccountLoginModal:m,AccountLoginPane:g,AccountLoginFreeProductModal:f,AccountSignUpModal:v,AccountPasswordResetModal:b,AccountHumbleGuardModal:y,AccountSteamLinkFreeProductModal:w}}),define("storefront/charity",["backbone","underscore","charity/models","charity/helpers","charity/baseViews","./templates/charity/all","./common","storefront/views/BaseView","account/accountModals"],function(e,t,n,i,s,a,r,o,l){"use strict";var c=o.extend();t.extend(c.prototype,s.BaseCharityPreviewView.prototype),c=c.extend({tagName:"div",className:"charity-preview",initialize:function(e){s.BaseCharityPreviewView.prototype.initialize.call(this,e),o.prototype.initialize.call(this,e),this.options=e,t.bindAll(this,"render","select_this_charity","update_charity"),this.pubSub=this.options.pubSub,this.pubSub.subscribe("charity_updated",this.update_charity)},render:function(){return this.$el.html(o.prototype.render_template.call(this,a.charityPreview,this.get_template_params())),s.BaseCharityPreviewView.prototype.render.call(this),this.el}});var u=c.extend({tagName:"div",className:"charity-details",events:t.extend(c.prototype.events,{}),initialize:function(e){c.prototype.initialize.call(this,e)},render:function(){return this.$el.html(o.prototype.render_template.call(this,a.charityDetails,this.get_template_params())),s.BaseCharityPreviewView.prototype.render.call(this),this.el}}),d=s.BaseCharityListView.extend({renderCharityPreview:function(e){var t=new c({model:e,constants:this.constants,pubSub:this.pubSub});return t.render()}}),h=o.extend();t.extend(h.prototype,s.BaseSelectionView.prototype),h=h.extend({tagName:"div",className:"charity-selection",events:t.extend({"click .js-submit-search":"submitSearch","keydown .js-charity-query":"handleCharityQueryKeyDown","change .js-charity-country":"handleCountryChange"},o.prototype.events),initialize:function(e){o.prototype.initialize.call(this,e),s.BaseSelectionView.prototype.initialize.call(this,e),this.options=e,this.constants=this.options.constants,t.bindAll(this,"render","buildSearchPath","submitSearch","handleCharityQueryKeyDown","setSearchParams"),this.MAX_PAGE_BUTTONS_TO_SHOW=11,
this.search_results_collection=new n.CharityList,this.charitySearchResultsView=new d({collection:this.search_results_collection,constants:this.constants,pubSub:this.pubSub});var i=this;this.featured_charity_collection=new n.CharityList,t.each(this.constants.FEATURED_CHARITY_IDS,function(e){i.featured_charity_collection.add(i.collection.get(e))}),this.featuredCharitiesView=new d({collection:this.featured_charity_collection,constants:this.constants,pubSub:this.pubSub})},render:function(){var e={categories:this.constants.CHARITY_SEARCH_PARAMS.category,countries:this.constants.CHARITY_SEARCH_PARAMS.country,states:this.constants.CHARITY_SEARCH_PARAMS.state};this.$el.empty(),this.$el.append(o.prototype.render_template.call(this,a.charitySelection,e));var t=this.$(".js-featured-charities");return t.empty(),t.append(this.featuredCharitiesView.render()),this.num_pages=0,this.page=1,this.renderSearchResults(),this.el},renderSearchResults:function(){var e=this,t=this.$(".js-charity-results");if(t.empty(),t.append(this.charitySearchResultsView.render()),this.num_pages>1){if(this.page<this.num_pages/2)var n=Math.max(this.page-Math.floor(this.MAX_PAGE_BUTTONS_TO_SHOW/2),1),i=Math.min(n+(this.MAX_PAGE_BUTTONS_TO_SHOW-1),this.num_pages);else var i=Math.min(this.page+Math.floor(this.MAX_PAGE_BUTTONS_TO_SHOW/2),this.num_pages),n=Math.max(i-(this.MAX_PAGE_BUTTONS_TO_SHOW-1),1);n>1&&(n+=1),i<this.num_pages&&(i-=1);var s={num_pages:this.num_pages,current_page:this.page,minimum_page:n,maximize_page:i,build_page_link_url:function(t){return e.buildSearchPath(e.query,e.category,e.country,e.state,t)}};t.append(o.prototype.render_template.call(this,a.paginationControls,s))}},buildSearchPath:function(e,n,i,s,a){var r="select-charity/search",o={query:e,category:n,country:i,state:s,page:a};return t.each(this.constants.CHARITY_SEARCH_PARAM_ORDER,function(e){o[e]&&(r+="/"+e+"/"+encodeURIComponent(o[e]))}),r},submitSearch:function(e){var t=this.$(".js-charity-query").val(),n=this.$(".js-charity-category").val(),i=this.$(".js-charity-country").val(),s="";i==this.UNITED_STATES&&(s=this.$(".js-charity-state").val());var a=this.buildSearchPath(t,n,i,s);r.navigate(e,a,!1,this.constants,{trigger:!0})},handleCharityQueryKeyDown:function(e){13===e.keyCode&&this.submitSearch(e)},setSearchParams:function(e,t,n,i,s){this.query=e||"",this.category=t||"",this.country=n||"",this.state=i||"",this.page=s||1,this.$(".js-charity-query").val(this.query),this.$(".js-charity-category").val(this.category),this.$(".js-charity-country").val(this.country),this.$(".js-charity-state").val(this.state),this.handleCountryChange(),this.searchCharities({query:this.query,category:this.category,country:this.country,state:this.state,page:this.page,page_size:this.PAGE_SIZE})}});var p=l.BaseAccountModal.extend({template:t.template($("#humblekeep-account-modal-template").html()),events:{"click .js-humblekeep-account-modal-confirm-button":"onConfirm","click .js-humblekeep-account-modal-cancel-button":"onCancel"},onCancel:function(){this.destroy()},onConfirm:function(){window.location="/login?goto=/user/wallet/create",this.destroy()},destroy:function(){this.undelegateEvents(),this.close()}}),_=(l.BaseAccountModal.extend({template:t.template($("#humblekeep-wallet-modal-template").html()),events:{"click .js-humblekeep-wallet-modal-confirm-button":"onConfirm","click .js-humblekeep-wallet-modal-cancel-button":"onCancel"},onCancel:function(){this.destroy()},onConfirm:function(){window.location="/user/wallet",this.destroy()},destroy:function(){this.undelegateEvents(),this.close()}}),o.extend({initialize:function(e){o.prototype.initialize.call(this,e),this.options=e,t.bindAll(this,"request_charity_update","render"),this.user_email=this.options.user_email,this.wallet_currency=this.options.wallet_currency,this.times_charity_has_been_set=0,this.cta_message_shown=!1,this.pubSub=this.options.pubSub,this.pubSub.subscribe("set_charity",this.request_charity_update)},request_charity_update:function(e){var t=this;if(e.humblekeep_opt_in&&!this.user_email){var n=new p;return void $("#site-modal").html(n.render().$el)}if(e.hasOwnProperty("current_charity")&&(this.current_charity=e.current_charity),e.hasOwnProperty("current_charity_is_random")&&(this.current_charity_is_random=e.current_charity_is_random),e.hasOwnProperty("humblekeep_opt_in")&&(this.humblekeep_opt_in=e.humblekeep_opt_in),this.pubSub.publish("charity_updated",e),!e.silent)if(this.user_email){var s={is_bundle:!1};e.hasOwnProperty("humblekeep_opt_in")&&(s.humblekeep_opt_in=e.humblekeep_opt_in),e.current_charity&&!e.current_charity_is_random&&(s.charity_id=e.current_charity.get("charity_id")),i.updateUserCharity(this.constants,s,function(){t.templateToRender=a.messageAccountSuccess,t.render()},function(){t.templateToRender=a.messageAccountError,t.render()})}else this.cta_message_shown||(this.templateToRender=a.messsageAccountCta,this.render(),this.cta_message_shown=!0)},render:function(){var t={fragment:e.history.fragment};void 0===this.initial_bottom_pos&&(this.initial_bottom_pos=this.$el.css("bottom")),this.$el.html(o.prototype.render_template.call(this,this.templateToRender,t)),this.$el.clearQueue().animate({bottom:0},100).delay(5e3).animate({bottom:this.initial_bottom_pos},200)}}));return{Charity:n.Charity,CharityList:n.CharityList,CharityDetailsView:u,CharitySelectionView:h,CharityAccountCTAView:_}}),define("storefrontv2/views/BaseView",["require","jquery","backbone","storefrontv2/sharedConfig"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),i=e("storefrontv2/sharedConfig"),s=n.View.extend({initialize:function(){this.on("attached",this.loadSubViews)},loadSubViews:t.noop(),renderTo:function(e){e.html(this.render().$el),this.trigger("attached")}});return s.prototype.sharedConfig=i,s}),define("lib/hbTemplate!storefrontv2/templates/charityHeaderViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="charity-keep-header">\n  <div class="charity-keep-header">\n<% if (preferredCharity) { %>\n    <div class="selected-charity">\n      <span class="charity-title">5% of your purchase will support</span>\n      <a class="charity-url" href="/store/select-charity/charity/<%- preferredCharity.get(\'charity_id\') %>">\n        <img class="charity-icon" style="background-image: url(<%- preferredCharity.get(\'logo_url\') %>);">\n        <span class="charity-name"><%- preferredCharity.get(\'human_name\') %></span>\n      </a>\n      <a href="/store/select-charity">\n        <i class="hb hb-pencil-square"></i>\n      </a>\n    </div>\n<% } %>\n    <div class="keep-selection">\n      <span class="keep-title">Give another 5% to:</span>\n      <button class="humblekeep-button js-opt-in js-humblekeep-button <%- isKeepEnabled ? \'is-selected\' : \'\' %>">My Wallet</button>\n      <button class="humblekeep-button js-opt-out js-humblekeep-button <%- isKeepEnabled ? \'\' : \'is-selected\' %>">Charity</button>\n    </div>\n  </div>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/models/User",["require","underscore","storefrontv2/models/BaseModel","storefrontv2/models/Entity"],function(e){"use strict";var t=e("underscore"),n=e("storefrontv2/models/BaseModel"),i=e("storefrontv2/models/Entity");return n.extend({defaults:{email:"",humbleKeepOptIn:!1,isCurrentUserViewEligibleForKeepCredit:!0,isPreferredCharityRandom:!0,preferredCharity:null,hasSteamLink:!1},initialize:function(e,i){n.prototype.initialize.call(this,e,i),t.bindAll(this,"updateKeepEligibility","updatePreferredCharity"),this.charityCollection=i.charityCollection,this.on("onToggleKeepSelection",this.toggleKeepSelection),this.listenTo(i.appRouter,"pageContentUpdated",this.updateKeepEligibility),this.sharedConfig.pubSub.subscribe("charity_updated",this.updatePreferredCharity),this.triggerCharityUpdate(!0)},parse:function(e,t){var n,i=!1,s=Math.floor(Math.random()*this.sharedConfig.storefrontConstants.FEATURED_CHARITY_IDS.length);return e.userPreferredCharityId&&(n=t.charityCollection.get(e.userPreferredCharityId)),n||(i=!0,n=t.charityCollection.get(this.sharedConfig.storefrontConstants.FEATURED_CHARITY_IDS[s])),e.isPreferredCharityRandom=i,e.preferredCharity=n,e},isKeepEnabled:function(){return this.get("humbleKeepOptIn")&&this.get("isCurrentUserViewEligibleForKeepCredit")},isLoggedIn:function(){return!!this.get("email")},toggleKeepSelection:function(e){this.set("humbleKeepOptIn",e),this.triggerCharityUpdate()},triggerCharityUpdate:function(e){this.sharedConfig.pubSub.publish("set_charity",{current_charity:this.get("preferredCharity"),current_charity_is_random:this.get("isPreferredCharityRandom"),humblekeep_opt_in:this.isKeepEnabled(),silent:e})},updateKeepEligibility:function(e){e instanceof i&&e.isEligibleForKeepCredit()!=this.get("isCurrentUserViewEligibleForKeepCredit")&&(this.set("isCurrentUserViewEligibleForKeepCredit",e.isEligibleForKeepCredit()),this.triggerCharityUpdate())},updatePreferredCharity:function(e){var n={};e.hasOwnProperty("current_charity")&&(n.preferredCharity=e.current_charity),e.hasOwnProperty("current_charity_is_random")&&(n.isPreferredCharityRandom=e.current_charity_is_random),e.hasOwnProperty("humblekeep_opt_in")&&(n.humbleKeepOptIn=e.humblekeep_opt_in),t.isEmpty(n)||this.set(n)}})}),define("storefrontv2/views/CharityKeepHeaderView",["require","underscore","charity/helpers","storefrontv2/views/BaseView","hbtemplate!storefrontv2/templates/charityHeaderViewTemplates.html","util/templating","storefrontv2/models/User","util/main"],function(e){"use strict";var t=(e("underscore"),e("charity/helpers")),n=e("storefrontv2/views/BaseView"),i=e("hbtemplate!storefrontv2/templates/charityHeaderViewTemplates.html"),s=e("util/templating"),a=(e("storefrontv2/models/User"),e("util/main"));return $("body").append(i),n.extend({events:{"click .js-humblekeep-button":"toggleKeepSelection"},initialize:function(e){n.prototype.initialize.call(this,e),this.listenTo(this.sharedConfig.userModel,"change:humbleKeepOptIn",this.updateKeepSelection).listenTo(this.sharedConfig.userModel,"change:isEligibleForKeepCredit",this.updateKeepSelection).listenTo(this.sharedConfig.userModel,"change:preferredCharity",this.render)},render:function(){return this.$el.html(s.renderTemplateId("charity-keep-header",{isKeepEnabled:this.sharedConfig.userModel.isKeepEnabled(),preferredCharity:this.sharedConfig.userModel.get("preferredCharity")})),a.preload_background_image_with_default(this.$(".charity-icon"),t.DEFAULT_CHARITY_IMAGE),this},toggleKeepSelection:function(e){var t=$(e.currentTarget).hasClass("js-opt-in");this.sharedConfig.userModel.trigger("onToggleKeepSelection",t)},updateKeepSelection:function(){this.$(".js-humblekeep-button").removeClass("is-selected"),this.sharedConfig.userModel.isKeepEnabled()?this.$(".js-opt-in").addClass("is-selected"):this.$(".js-opt-out").addClass("is-selected")}})}),define("coupon/coupon",["jquery","backbone","underscore","lib/big"],function(e,t,n,i){var s=t.Model.extend({idAttribute:"coupon_definition",defaults:{coupon_definition:"",coupon_human_name:"",coupon_key:"",coupon_type:"",coupon_discount:0,coupon_price:null,coupon_min_count:null,coupon_max_count:null,coupon_image:"",coupon_expiration:"",coupon_credit:{amount:0,currency:"USD"},coupon_valid_products:[],coupon_valid_subscriptions:[],coupon_sale_stack:!0,coupon_stack:!1,auto_coupon_stack:!1,auto_generated:!1,coupon_is_dynamic:!1,coupon_generation_products:[],coupon_generation_min_count:null,coupon_generation_min_value:null,coupon_generation_max_count:null,coupon_require_captcha_if_free:!1,coupon_required_subscriptions:[],valid:!1,strings:null},initialize:function(){n.bindAll(this,"applies_to_all_products","get_discount","get_applied_discount","is_auto_generated","stacks_with_coupons","stacks_with_auto_coupons","stacks_with_sales","is_valid","can_generate","can_redeem","get_expiration_date_as_string")},applies_to_all_products:function(){return 0==this.get("coupon_valid_products").length&&(null==this.get("coupon_valid_subscriptions")||0==this.get("coupon_valid_subscriptions").length)},get_matching_generation_products:function(e){if(!this.is_auto_generated())return[];var t=this.get("coupon_generation_products"),i=e.filter(function(e){return n.contains(t,e.get("machine_name"))});return i},get_applicable_product_machine_names:function(e){var t=this.get("coupon_max_count"),i=[],s=this.get("coupon_valid_products"),a=this,i=e.filter(function(e){return!e.incompatible_with_coupon(a)});s&&s.length>0&&(i=n.filter(i,function(e){return n.contains(s,e.get("machine_name"))}));var r=this.get("coupon_invalid_products");if(r&&r.length>0&&(i=n.filter(i,function(e){return!n.contains(r,e.get("machine_name"))})),null!==t){var o=n.sortBy(i,function(e){return e.get("machine_name")});i=o.slice(0,t)}return n.map(i,function(e){return e.get("machine_name")})},get_applicable_total:function(e,t){var n=i(0),s="",a=this.get_applicable_product_machine_names(e),r=this,o=this.get("coupon_min_count");return null!==o&&a.length<o?[n,s]:(e.forEach(function(e){if(a.indexOf(e.get("machine_name"))>-1){var i=e.get_current_price_as_big();r.get("coupon_sale_stack")!==!1||t||(i=e.get_full_price_as_big());var o=i[0];o=o.minus(e.get_discount_amount()),n=n.plus(o),s=i[1]}}),[n,s])},calculate_discount:function(e,t){if("discount-percentage"==this.get("coupon_type"))return e.times(this.get("coupon_discount")).round(2,3);if("credit-amount"==this.get("coupon_type")){var n=i(this.get("coupon_credit")[0]);return t!=this.get("coupon_credit")[1]?i(0):n.gt(e)?e:n}if("price"==this.get("coupon_type")){if(null===this.get("coupon_price"))return i(0);var s=i(this.get("coupon_price")[0]);return t!=this.get("coupon_price")[1]?i(0):e.lte(s)?i(0):e.minus(s)}},get_discount:function(e){var t=this.get_applicable_total(e),n=t[0],i=t[1];return this.calculate_discount(n,i)},get_applied_discount:function(){return this.get("applied_discount")},provides_savings:function(e){var t=this.get_applicable_total(e,!0),n=t[0],i=this.get_applicable_total(e),s=i[0],a=i[1],r=this.calculate_discount(s,a),o=s.minus(r);return o.lt(n)},apply_coupon:function(e){var t=this.get_applicable_total(e),i=t[0],s=t[1],a=this.calculate_discount(i,s),r=this;this.set("applied_discount",a);var o=this.get_applicable_product_machine_names(e);e.forEach(function(e){if(i.gt(0)&&n.contains(o,e.get("machine_name"))){var t=e.get_current_price_as_big()[0];t=t.minus(e.get_discount_amount());var s=t.times(a).div(i);e.add_coupon_discount(r,s)}})},get_expiration_date_as_string:function(){var e=new Date(this.get("coupon_expiration"));return e.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"})},can_generate:function(e){if(!this.is_auto_generated())return!1;var t,i=this.get("coupon_generation_max_count"),s=this.get("coupon_generation_min_count"),a=this.get("coupon_generation_min_value"),r=null,o=this.get("coupon_generation_products"),l=this.get("coupon_generation_invalid_products"),c=e.filter(function(e){var t=n.contains(o,e.get("machine_name")),i=n.contains(l,e.get("machine_name"));return t&&!i});if(null!==s&&c.length<s)return!1;if(null!==i&&c.length>i)return!1;if(this.requires_minimum_value()){if(t=n.reduce(c,function(e,t){var n=t.get_current_price();return null==r&&(r=n[1]),e+n[0]},0),null!==r&&r!=a[1])return console.log("Error: Currency mismatch for auto coupon: "+this.get("coupon_definition")),!1;if(t<a[0])return!1}return!0},can_redeem:function(e){var t,i=this.get("coupon_min_count"),s=this.get("coupon_valid_products"),a=this.get("coupon_invalid_products"),r=this.get("coupon_valid_subscriptions"),o=e.filter(function(e){return n.contains(a,e.get("machine_name"))});if(o.length)return!1;if(r.length>0)return!1;if(s&&s.length&&null==i)i=1;else if(!s||0==s.length||null==i)return!0;return t=e.filter(function(e){return n.contains(s,e.get("machine_name"))}),t.length>=i},can_upsell:function(e){var t,i,s,a,r,o=this.get("coupon_generation_max_count"),l=this.get("coupon_generation_products"),c=this.get("coupon_valid_products");return this.is_auto_generated()?(t=e.filter(function(e){return n.contains(l,e.get("machine_name"))}),t.length&&(a=!0,null!==o&&(a=t.length<=o),this.requires_minimum_value()&&(i=n.reduce(t,function(e,t){return e+t.get_current_price()[0]},0),a=a&&i>0)),c&&(s=e.filter(function(e){return n.contains(c,e.get("machine_name"))}),r=!!s.length),a||r):!1},conflicts_with:function(e){var t=this.get("coupon_definition"),n=e.get("coupon_definition");if(t==n)return!0;if("humble_monthly_10"==t||"humble_monthly_10"==n)return!1;var i=this.is_auto_generated()?e.stacks_with_auto_coupons():e.stacks_with_coupons(),s=e.is_auto_generated()?this.stacks_with_auto_coupons():this.stacks_with_coupons(),a=s&&i,r=this.stacks_with_sales()==e.stacks_with_sales();return!(a&&r)},is_valid:function(e,t){var i=this;if(this.get_discount(e).lte(0))return!1;var s=n.some(t,function(e){return i.conflicts_with(e)});return s?!1:!0},is_auto_generated:function(){return this.get("auto_generated")},requires_minimum_value:function(){return null!==this.get("coupon_generation_min_value")},stacks_with_sales:function(){return this.get("coupon_sale_stack")},stacks_with_auto_coupons:function(){return this.get("auto_coupon_stack")},stacks_with_coupons:function(){return this.get("coupon_stack")},apply_to_full_price:function(e,t){if(this.get("coupon_sale_stack")===!1){var n=this.get_applicable_product_machine_names(t);if(n.indexOf(e.get("machine_name"))>-1)return!0}return!1},requires_subscription:function(){return this.get("coupon_required_subscriptions").length>0}}),a=t.Collection.extend({modelId:"coupon_definition",initialize:function(e,t){this.outboundAutoAddXhrs=0,this.productXhrs={},this.on("fetchAutoAddProducts",this.fetch_coupon_auto_add_products,this)},model:s,url:"/store/coupons",fetch_coupon_auto_add_products:function(t){var n=this,i=t.get("coupon_definition"),s=t.get("auto_add_product_machine_names");n.productXhrs[i]||(n.outboundAutoAddXhrs++,n.productXhrs[i]=e.ajax({url:"/store/api/lookup",data:{products:s}}).done(function(e){e.result.length?n.trigger("fetchAutoAddProducts:success",t,e.result):n.trigger("fetchAutoAddProducts:error")}).fail(function(){n.trigger("fetchAutoAddProducts:error")}).always(function(){delete n.productXhrs[i],n.outboundAutoAddXhrs--,n.outboundAutoAddXhrs||n.trigger("fetchAutoAddProductBatch:complete")}))}});return{coupon:s,couponCollection:a}}),define("storefrontv2/models/EntitiesCache",["require","underscore","storefrontv2/models/BaseEntityCollection","storefrontv2/models/BaseModel","storefrontv2/models/Entity","storefrontv2/models/Page","storefrontv2/models/PagePreview"],function(e){"use strict";var t=e("underscore"),n=e("storefrontv2/models/BaseEntityCollection"),i=e("storefrontv2/models/BaseModel"),s=e("storefrontv2/models/Entity"),a=e("storefrontv2/models/Page"),r=e("storefrontv2/models/PagePreview"),o=i.extend({initialize:function(e,t){i.prototype.initialize.call(this,e,t),t&&(this.adminOverrides=t.adminOverrides),this.set("entities",new n)},addEntities:function(e,n){var i=this.get("entities"),s=[];return n=n||{},n.entitiesCache=this,e=t.isArray(e)?e:[e],t.each(e,function(e){var t;n.parse&&(e=i.model(e,n)),t=i.get(e),t?(t.set(e.toJSON(),n),s.push(t)):s.push(i.add(e,n))}),s},findEntityByHumanUrl:function(e,t){return t==s.TYPES.PAGE?this.get("entities").get(e):this.get("entities").findWhere({human_url:e,type:t})},findEntityByMachineName:function(e,t){return t==s.TYPES.PAGE?this.get("entities").findWhere({machine_name:e,type:t}):t==s.TYPES.PRODUCT?this.get("entities").get(e):void 0},getEntityByHumanUrl:function(e){var t=$.Deferred(),n=e.indexOf("/")>-1?s.TYPES.PAGE:s.TYPES.PRODUCT,i=this.findEntityByHumanUrl(e,n);return o.isCacheMiss(i)?this.loadEntity(e,n,o.ENTITY_LOOKUP_MAX_RETRIES):(t.resolve(i),t)},getEntityByMachineName:function(e,t){var n=$.Deferred(),i=this.findEntityByMachineName(e,t);return o.isCacheMiss(i)?this.loadEntity(e,t,o.ENTITY_LOOKUP_MAX_RETRIES):(n.resolve(i),n)},invalidateCache:function(){this.get("entities").reset()},loadEntity:function(e,t,n){var i=this;return t==s.TYPES.PAGE?$.Deferred().reject():t==s.TYPES.PRODUCT?$.ajax({data:$.extend(i.adminOverrides,{products:[e],request:++i.lastSent}),remainingRetries:n,type:"GET",url:i.sharedConfig.storefrontConstants.STORE_ROOT+"/api/lookup"}).then(function(e){if(e.request>i.lastReceived){if(i.lastReceived=e.request,e.result.length)return i.addEntities(e.result,{parse:!0})[0];$.Deferred().reject()}},function(){return 0!=this.remainingRetries?i.loadEntity(e,t,--this.remainingRetries):void $.Deferred().reject()}):void 0}},{ENTITY_LOOKUP_MAX_RETRIES:5,isCacheMiss:function(e){return!e||e instanceof r&&!(e instanceof a)}});return o}),define("storefrontv2/models/BYOB",["require","underscore","storefrontv2/models/BaseModel","storefrontv2/models/BaseCollection","coupon/coupon"],function(e){"use strict";var t=e("underscore"),n=e("storefrontv2/models/BaseModel"),i=e("storefrontv2/models/BaseCollection"),s=e("coupon/coupon"),a=i.extend({model:s.coupon});return n.extend({initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"updateBYOBCoupons"),this.sharedConfig.pubSub.subscribe("active_coupons",this.updateBYOBCoupons)},parse:function(e,n){var i=n.pageModel.get("auto_coupons");return e.coupons=t.filter(e.coupons,function(e){return t.contains(i,e.coupon_definition)}),e.coupons=t.sortBy(e.coupons,function(e){return e.coupon_min_count}),e.coupons=new a(e.coupons,{parse:!0}),e.strings=n.pageModel.get("strings"),e},getHighestTierCoupon:function(){return this.get("coupons").last()},getLowestTierCoupon:function(){return this.get("coupons").first()},updateBYOBCoupons:function(e){var n=this.get("coupons").pluck("coupon_definition"),i=t.values(t.pick(e.active_coupons,n)),s=t.flatten(t.values(i)),a=t.values(t.pick(e.upsell_coupons,n)),r=t.uniq(t.flatten(t.values(a))).sort(),o=t.uniq(s.concat(r)).sort();this.set("products",o),o.length&&e.discount[0]?this.set("savings",e.discount):this.unset("savings")}})}),define("lib/hbTemplate!storefrontv2/templates/byobViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="byob-banner">\n<% var strings = byob.get(\'strings\'); %>\n<% if (strings && strings.byob_header) { %>\n  <p class="byob-header"><%- strings.byob_header %></p>\n<% } %>\n  <p class="byob-text-container">\n<% if (strings.byob_text) { %>\n    <span class="byob-text"><%= strings.byob_text %></span>\n<% } %>\n    <span class="savings js-savings">You\'ve saved <span class="savings-amount js-savings-amount"></span></span>\n  </p>\n  <ul class="byob-meter no-style-list">\n<%\n  var couponTier;\n  for (var i = 0, l = byob.getHighestTierCoupon().get(\'coupon_min_count\'); i < l; i++) {\n    couponTier = i + 1;\n%>\n    <li class="byob-tier js-byob-tier" title="<%- couponTier %>">\n        <%- byobView.getLabelForCouponTier(couponTier) %>\n    </li>\n<% } %>\n  </ul>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/BYOBView",["require","storefrontv2/views/BaseView","storefrontv2/models/BYOB","hbtemplate!storefrontv2/templates/byobViewTemplates.html","util/templating","util/main"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/BYOB"),i=e("hbtemplate!storefrontv2/templates/byobViewTemplates.html"),s=e("util/templating"),a=e("util/main");return $("body").append(i),t.extend({className:"byob-banner",initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.currentCountry=e.currentCountry,this.shoppingCartCollection=e.shoppingCartCollection,this.listenTo(this.model,"change:products",this.updateMeter).listenTo(this.model,"change:savings",this.updateSavings).listenTo(this.shoppingCartCollection,"collectionModified",this.updateMeter)},model:n,render:function(){return this.$el.html(s.renderTemplateId("byob-banner",{byob:this.model,byobView:this})),this.updateMeter(),this.updateSavings(),this},getLabelForCouponTier:function(e){var t,n,i,s,r=this.model.get("strings")["byob_tier"+e],o=this.model.getLowestTierCoupon().get("coupon_min_count"),l="us"!==this.currentCountry;return r?i=r:e>=o&&(t=this.model.get("coupons").at(e-o),n=t.get("coupon_type"),"price"==n?(s=t.get("coupon_price"),i=a.moneyfmt(s[0],s[1],!0,l)):"discount-percentage"==n?i=Math.round(100*t.get("coupon_discount"))+"% off":"credit-amount"==n&&(s=t.get("coupon_credit"),i=a.moneyfmt(s[0],s[1],!0,l)+" off")),i},updateMeter:function(){var e=this.model.get("products"),t=this.$(".js-byob-tier");if(t.removeClass("active"),e&&e.length)for(var n=0,i=e.length;i>n;n++)t.eq(n).addClass("active")},updateSavings:function(){var e=this.model.get("savings");e?(this.$(".js-savings-amount").text(a.moneyfmt(e[0],e[1],!1)),this.$(".js-savings").show()):this.$(".js-savings").hide()}})}),define("lib/hbTemplate!storefrontv2/templates/entityPriceViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="product-price-button">\n<% if (discount > 0) { %>\n  <span class="discount-percentage">-<%- discount %>%</span>\n<% } %>\n  <div class="price-button js-price-button">\n    <span class="price"><%- price %></span>\n    <span class="price-action-button">\n      <i class="hb hb-shopping-cart"></i>\n      <span class="add-text">Add</span>\n      <span class="buy-text">Buy</span>\n    </span>\n  </div>\n</script>'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/EntityPriceView",["require","storefrontv2/views/BaseView","storefrontv2/models/Product","hbtemplate!storefrontv2/templates/entityPriceViewTemplates.html","util/templating","util/main"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/Product"),i=e("hbtemplate!storefrontv2/templates/entityPriceViewTemplates.html"),s=e("util/templating"),a=e("util/main");return $("body").append(i),t.extend({className:".price-container",events:{"click .js-price-button":"addOrBuyProduct"},initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.shoppingCartCollection=e.shoppingCartCollection,this.listenTo(this.shoppingCartCollection,"add",this.setPriceButtonState).listenTo(this.shoppingCartCollection,"remove",this.setPriceButtonState)},model:n,addOrBuyProduct:function(e){var t=this.model.get("machine_name");this.shoppingCartCollection.get(t)?this.sharedConfig.pubSub.publish("onBuyButtonClick"):(this.sharedConfig.pubSub.publish("addToCart",{product:this.model,startButton:$(e.currentTarget)}),this.shoppingCartCollection.trigger("addToCart",[this.model],!e)),e.preventDefault()},getDisplayDiscountAndPrice:function(){var e=this.sharedConfig.userModel.get("abTestBuckets"),t=this.sharedConfig.userModel.get("monthlyIsPaused"),n=this.couponCollection.get("humble_monthly_10"),i=n&&!t&&this.model.isCompatibleWithCoupon(n);return e&&"apply_monthly_discount"==e.priceDisplayType&&i?{discount:this.model.getHumanDiscountAfterCoupon(n),price:a.moneyfmt(this.model.getPriceAfterCouponAsBig(n))}:{discount:this.model.getHumanDiscount(),price:a.moneyfmt(this.model.get("current_price"))}},render:function(){return this.$el.html(s.renderTemplateId("product-price-button",this.getDisplayDiscountAndPrice())),this.setPriceButtonState(),this},setPriceButtonState:function(e){var t=e&&e.get("machine_name"),n=this.model.get("machine_name");t&&t!=n||this.$(".js-price-button").toggleClass("in-cart",!!this.shoppingCartCollection.get(n))}})}),define("lib/hbTemplate!storefrontv2/templates/entityTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="entity-block-item">\n  <div class="entity js-entity <%- entity.get(\'type\') == Entity.TYPES.PRODUCT && entity.isOnSale() ? \'on-sale\' : \'\' %>">\n    <a class="entity-link js-entity-link" href="<%- entity.getUrl() %>">\n      <div class="entity-details">\n        <img class="entity-image" src="<%- entity.get(\'storefront_v2_large_capsule\') %>">\n        <div class="entity-meta">\n          <span class="entity-title" title="<%- entity.get(\'human_name\') %>"><%- entity.get(\'human_name\') %></span>\n<% if (entity.get(\'type\') == Entity.TYPES.PRODUCT) { %>\n          <div class="js-wishlist-button-container"></div>\n          <div class="entity-devices">\n            <ul class="platforms no-style-list">\n  <%\n    _.each(entity.get(\'delivery_methods\'), function(platform) {\n      var deliveryMethod = HB_SHARED_CONSTANTS.delivery_method_definition_dict[platform];\n      if (deliveryMethod) {\n  %>\n            <li class="platform hb <%- deliveryMethod.icon %>"></li>\n  <%\n      }\n    });\n  %>\n            </ul>\n            <ul class="operating-systems no-style-list">\n  <%\n    _.each(entity.get(\'platforms\'), function(os) {\n      var platform = HB_SHARED_CONSTANTS.platform_definition_dict[os];\n      if (platform) {\n\n  %>\n              <li class="operating-system hb <%- platform.icon %>"\n                  title="<%- platform.human_name %>"></li>\n  <%\n      }\n    });\n  %>\n            </ul>\n          </div>\n<% } %>\n        </div>\n      </div>\n    </a>\n<%\n  if (entity.get(\'type\') == Entity.TYPES.PRODUCT) {\n    var status = entity.getStatus();\n%>\n    <div class="entity-purchase-details">\n  <% if (status) { %>\n      <span class="entity-status <%- entity.getStatusHtmlClass() %>"><%- Product.PRODUCT_STATUS[status] %></span>\n  <% } %>\n      <div class="entity-pricing js-price-container"></div>\n    </div>\n<% } %>\n  </div>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!storefrontv2/templates/wishlistButtonViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="wishlist-button-v2">\n  <span class="wishlist-button js-wishlist-button <%- userModel.get(\'wishlistModel\').contains(productMachineName) ? \'saved\' : \'\' %>">\n    <i class="hb hb-star"></i>\n    <span class="add-text"><%- userModel.isLoggedIn() ? \'\' : \'Login to \' %>Add to Wish List</span>\n    <span class="remove-text">Remove from Wish List</span>\n  </span>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("commonModels/User",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.Model.extend({defaults:{email:""},isLoggedIn:function(){return""!==this.get("email")}})}),define("storefrontv2/views/WishlistButtonView",["require","storefrontv2/views/BaseView","storefrontv2/models/Product","hbtemplate!storefrontv2/templates/wishlistButtonViewTemplates.html","util/templating","commonModels/User","util/main"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/Product"),i=e("hbtemplate!storefrontv2/templates/wishlistButtonViewTemplates.html"),s=e("util/templating"),a=(e("commonModels/User"),e("util/main"));return $("body").append(i),t.extend({events:{"click .js-wishlist-button":"modifyWishlistStatus"},initialize:function(e){t.prototype.initialize.call(this,e),this.listenTo(this.sharedConfig.userModel.get("wishlistModel"),"modifyWishlist:error",this.setWishlistButtonState).listenTo(this.sharedConfig.userModel.get("wishlistModel"),"modifyWishlist:success",this.setWishlistButtonState)},model:n,buildPostLoginWishlistUrl:function(){return"/store/"+this.model.get("human_url")+"?action=wishlist"},modifyWishlistStatus:function(e){var t=this.model.get("machine_name"),n=this.sharedConfig.userModel.get("wishlistModel");this.sharedConfig.userModel.isLoggedIn()?(n.contains(t)?n.trigger("remove",t):n.trigger("add",t),this.setWishlistButtonState()):a.login(this.buildPostLoginWishlistUrl()),e.preventDefault();
},render:function(){return this.$el.html(s.renderTemplateId("wishlist-button-v2",{productMachineName:this.model.get("machine_name"),userModel:this.sharedConfig.userModel})),this},setWishlistButtonState:function(e){var t=this.model.get("machine_name"),n=this.sharedConfig.userModel.get("wishlistModel");e&&e!=t||this.$(".js-wishlist-button").toggleClass("saved",n.contains(t))}})}),define("storefrontv2/views/EntityBlockView",["require","storefrontv2/views/BaseView","storefrontv2/models/Entity","storefrontv2/views/EntityPriceView","storefrontv2/models/Product","hbtemplate!storefrontv2/templates/entityTemplates.html","util/templating","storefrontv2/views/WishlistButtonView"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/Entity"),i=e("storefrontv2/views/EntityPriceView"),s=e("storefrontv2/models/Product"),a=e("hbtemplate!storefrontv2/templates/entityTemplates.html"),r=e("util/templating"),o=e("storefrontv2/views/WishlistButtonView");return $("body").append(a),t.extend({initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.shoppingCartCollection=e.shoppingCartCollection},model:n,getTemplateId:function(){return"entity-block-item"},loadSubViews:function(){var e,t,s=this.$(".js-price-container"),a=this.$(".js-wishlist-button-container");this.model.get("type")==n.TYPES.PRODUCT&&(s.length&&this.model.hasPrice()&&(e=new i({couponCollection:this.couponCollection,model:this.model,shoppingCartCollection:this.shoppingCartCollection}),e.renderTo(s)),a.length&&(t=new o({model:this.model}),t.renderTo(a)))},render:function(){var e=this.getTemplateId();return this.$el.html(r.renderTemplateId(e,{entity:this.model,Entity:n,Product:s})),this}})}),define("lib/hbTemplate!storefrontv2/templates/carouselViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="carousel-container">\n  <div class="carousel">\n    <div class="list-header">\n      <span class="header-text"><%- entityList.get(\'human_name\') %></span>\n<% if (entityList.get(\'url\')) { %>\n      <a class="view-all-link" href="<%- entityList.getUrl() %>">View all</a>\n<% } %>\n    </div>\n    <div class="list-content js-list-content">\n<%\n  var templateArgs = {\n    Entity: Entity,\n    entities: entityList.get(\'entities\'),\n    Product: Product\n  };\n%>\n<% if (entityList.get(\'type\') == EntityList.TYPES.CAROUSEL_MINI) { %>\n      <%= templating.renderTemplateId(\'carousel-special-deals-list\', templateArgs) %>\n<% } else { %>\n      <%= templating.renderTemplateId(\'carousel-entities-list\', templateArgs) %>\n<% } %>\n      <div class="carousel-arrow-container js-carousel-arrow-container">\n        <a class="slick-prev js-slick-prev" title="prev" data-role="none" aria-label="Previous" tabindex="0" role="button">\n          <i class="hb hb-angle-left"></i>\n        </a>\n        <a class="slick-next js-slick-next" title="Next" data-role="none" aria-label="Next" tabindex="0" role="button">\n          <i class="hb hb-angle-right"></i>\n        </a>\n      </div>\n    </div>\n  </div>\n</script>\n\n<script type="text/template" id="carousel-entities-list">\n  <ul class="entities-list js-entities-list no-style-list full js-full">\n<% entities.each(function(entity, index) { %>\n    <li class="entity-block-container js-entity-container"></li>\n<% }); %>\n  </ul>\n</script>\n\n<script type="text/template" id="carousel-page-button">\n  <a class="page-button" data-role="none" role="button" aria-required="false" tabindex="0"></a>\n</script>\n\n<script type="text/template" id="carousel-special-deals-item">\n<%\n  var hasCustomImage = !!entity.get(\'mini_carousel_image\'),\n      isProduct = entity.get(\'type\') == Entity.TYPES.PRODUCT,\n      promoHeading = entity.get(\'promotional_heading\') || entity.get(\'human_name\'),\n      promoMessage = entity.get(\'promotional_message\'),\n      saleEnd = entity.getSaleEnd()\n  ;\n%>\n  <div class="entity\n              <%- entity.get(\'type\') == Entity.TYPES.PRODUCT && entity.isOnSale() ? \'on-sale\' : \'\' %>\n              <%- hasCustomImage ? \'has-image-override\' : \'\' %>\n              <%- (promoHeading || promoMessage) && (saleEnd || isProduct) ? \'has-full-details\' : \'\' %>">\n    <a class="entity-link" href="<%- entity.getUrl() %>">\n      <div class="entity-details">\n        <img class="entity-image" src="<%- entity.get(\'mini_carousel_image\') || entity.get(\'storefront_v2_large_capsule\') %>">\n      </div>\n    </a>\n    <div class="entity-purchase-details">\n<% if (promoHeading) { %>\n      <p class="deal-title"><%- promoHeading %></p>\n<% } %>\n<% if (promoMessage) { %>\n      <p class="deal-cta"><%- promoMessage %></p>\n<% } %>\n<% if (saleEnd || isProduct) { %>\n      <div class="purchase-details-footer">\n  <% if (saleEnd) { %>\n        <div class="countdown">\n          <p class="countdown-title">Time Left</p>\n          <p class="countdown-timer js-countdown-timer">--:--:--</p>\n        </div>\n  <% } %>\n  <% if (isProduct) { %>\n        <div class="entity-pricing js-price-container"></div>\n  <% } %>\n      </div>\n<% } %>\n    </div>\n  </div>\n</script>\n\n<script type="text/template" id="carousel-special-deals-list">\n  <ul class="entities-list js-entities-list no-style-list full js-full">\n<% entities.each(function(entity, index) { %>\n    <li class="entity-block-container js-entity-container"></li>\n<% }); %>\n  </ul>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/CarouselView",["require","storefrontv2/views/BaseView","storefrontv2/models/Entity","storefrontv2/models/EntityList","storefrontv2/views/EntityBlockView","lib/moment","storefrontv2/models/Page","storefrontv2/models/Product","lib/jquery/plugins/slick-carousel/slick","hbtemplate!storefrontv2/templates/carouselViewTemplates.html","util/templating","util/main"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/Entity"),i=e("storefrontv2/models/EntityList"),s=e("storefrontv2/views/EntityBlockView"),a=e("lib/moment"),r=e("storefrontv2/models/Page"),o=e("storefrontv2/models/Product"),l=(e("lib/jquery/plugins/slick-carousel/slick"),e("hbtemplate!storefrontv2/templates/carouselViewTemplates.html")),c=e("util/templating"),u=e("util/main");$("body").append(l);var d=s.extend({initialize:function(e){s.prototype.initialize.call(this,e),this.carouselType=e.carouselType},loadSubViews:function(){if(s.prototype.loadSubViews.call(this),this.carouselType==i.TYPES.CAROUSEL_MINI){var e=this.$(".js-countdown-timer"),t=this;e.length&&setInterval(function(){var n=new a.duration(t.model.getSaleEnd()-(new Date).getTime()),i=n.days(),s="";i&&(s=i+"."),s+=u.zeropad(n.hours())+":"+u.zeropad(n.minutes())+":"+u.zeropad(n.seconds()),e.html(s)},1e3)}},getTemplateId:function(){var e;return e=this.carouselType==i.TYPES.CAROUSEL_MINI?"carousel-special-deals-item":"entity-block-item"}});return t.extend({initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.pageSection=e.pageSection,this.shoppingCartCollection=e.shoppingCartCollection},model:i,getNextArrowTemplate:function(){return c.renderTemplateId("carousel-next-arrow")},getPagingTemplate:function(){return c.renderTemplateId("carousel-page-button")},getPrevArrowTemplate:function(){return c.renderTemplateId("carousel-prev-arrow")},getSlickOptions:function(){var e={appendDots:this.$(".js-list-content"),cssEase:"ease-in-out",customPaging:this.getPagingTemplate,draggable:!1,easing:"swing",mobileFirst:!0,nextArrow:this.$(".js-slick-next"),prevArrow:this.$(".js-slick-prev"),slidesToScroll:1,slidesToShow:1,speed:200,variableWidth:!0,waitForAnimate:!1},t=this.model.get("type");return t==i.TYPES.CAROUSEL_LARGE?$.extend({autoplay:!0,autoplaySpeed:4e3,centerMode:!0,dots:!0,responsive:[{breakpoint:1160,settings:{slidesToScroll:1,slidesToShow:3}}]},e):t==i.TYPES.CAROUSEL_MINI?$.extend({dots:!0},e):this.pageSection==r.SECTIONS.SECONDARY_SECTION?$.extend({responsive:[{breakpoint:500,settings:{slidesToScroll:2,slidesToShow:2}},{breakpoint:680,settings:{slidesToScroll:3,slidesToShow:3}}]},e):$.extend({responsive:[{breakpoint:500,settings:{slidesToScroll:2,slidesToShow:2}},{breakpoint:680,settings:{slidesToScroll:3,slidesToShow:3}},{breakpoint:940,settings:{slidesToScroll:4,slidesToShow:4}}]},e)},loadSubViews:function(){var e,t=this.$(".js-entity-container"),n=this;this.model.get("entities").each(function(i,s){e=new d({couponCollection:n.couponCollection,carouselType:n.model.get("type"),model:i,shoppingCartCollection:n.shoppingCartCollection}),e.renderTo(t.eq(s))}),this.$(".js-entities-list.js-full").slick(this.getSlickOptions())},render:function(){return this.$el.html(c.renderTemplateId("carousel-container",{Entity:n,EntityList:i,entityList:this.model,Product:o,templating:c,userModel:this.sharedConfig.userModel})),this}})}),define("lib/require-text!bundleCalendar/css_dist/main.css",[],function(){return'\n.bundle-calendar .day { display: inline-block; position: relative; vertical-align: middle; }\n.bundle-calendar .day + .day { margin-left: 10px; }\n.bundle-calendar .day .label { display: inline-block; width: 32px; height: 32px; border: 1px solid #a1a7b2; border-radius: 16px; text-transform: uppercase; text-align: center; font-size: 10px; line-height: 32px; cursor: default; -webkit-transition: all 0.3s linear; transition: all 0.3s linear; }\n.bundle-calendar .day.is-current, .bundle-calendar .day.is-pending { color: #97b147; }\n.bundle-calendar .day.is-current .label, .bundle-calendar .day.is-pending .label { border-color: #97b147; }\n.bundle-calendar .day.is-current .label { width: 132px; font-size: 18px; }\n.bundle-calendar .day.is-previous { color: #a1a7b2; }\n.bundle-calendar .day.is-previous .label { border-color: #a1a7b2; }\n.bundle-calendar .day:hover .cross-promo { opacity: 1; z-index: 1000; }\n.bundle-calendar .day .cross-promo { width: 160px; padding: 10px; margin-left: -90px; position: absolute; top: 47px; left: 50%; z-index: -10; opacity: 0; border-radius: 3px; background: white; text-align: center; -webkit-transition: all 0.2s ease; transition: all 0.2s ease; }\n.bundle-calendar .day .cross-promo .promo-text { font-size: 12px; color: #282c34; }\n.bundle-calendar .day .cross-promo .promo-link { display: inline-block; width: 150px; height: 25px; border-radius: 3px; background: -webkit-linear-gradient(top, #97b147 0%, #7e992e 100%); background: linear-gradient(-180deg, #97b147 0%, #7e992e 100%); box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.2), inset 0 2px 0 0 rgba(255, 255, 255, 0.2); line-height: 25px; font-size: 12px; text-decoration: none; color: white; }\n.bundle-calendar .day .cross-promo .promo-link:hover { background: -webkit-linear-gradient(top, #adcc52 0%, #93b336 100%); background: linear-gradient(-180deg, #adcc52 0%, #93b336 100%); box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.2), inset 0 2px 0 0 rgba(255, 255, 255, 0.2); }\n.bundle-calendar .day .cross-promo .promo-link:active { background: #7e992e; box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(0, 0, 0, 0.2); }\n.bundle-calendar .day .cross-promo .subscribe-link { display: inline-block; width: 150px; height: 25px; border-radius: 3px; background: -webkit-linear-gradient(top, #4dc4ff 0%, #17a1e6 100%); background: linear-gradient(-180deg, #4dc4ff 0%, #17a1e6 100%); box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.2), inset 0 2px 0 0 rgba(255, 255, 255, 0.2); line-height: 25px; font-size: 12px; text-decoration: none; color: white; }\n.bundle-calendar .day .cross-promo .subscribe-link:hover { background: -webkit-linear-gradient(top, #80d4ff 0%, #19b2ff 100%); background: linear-gradient(-180deg, #80d4ff 0%, #19b2ff 100%); box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(0, 0, 0, 0.2), inset 0 2px 0 0 rgba(255, 255, 255, 0.2); }\n.bundle-calendar .day .cross-promo .subscribe-link:active { background: #148fcc; box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(0, 0, 0, 0.2); }\n.bundle-calendar .day .cross-promo:hover { opacity: 1; z-index: 1000; }\n.bundle-calendar .day .cross-promo:after { display: block; width: 0; margin-left: -10px; border-width: 0 10px 10px; position: absolute; top: -10px; left: 50%; border-color: white transparent; border-style: solid; content: ""; }\n'}),define("bundleCalendar/js/models/base",["lib/backbone.getters.setters"],function(e){return e.GSModel}),define("bundleCalendar/js/models/day",["./base","lib/moment"],function(e,t){return function(n){return e.extend({defaults:{startDateTime:"",endDateTime:"",state:"pending",crossPromo:{}},getters:{label:function(){return this.get("startDateTime").format("ddd")}},setters:{startDateTime:function(e){return _.isNumber(e)?t(e,"X"):t(e+" -0700","YYYY-MM-DD HH:mm:ss Z")},endDateTime:function(e){return _.isNumber(e)?t(e,"X"):t(e+" -0700","YYYY-MM-DD HH:mm:ss Z")}},initialize:function(){var e=n?t(n):t(),i=this.get("startDateTime"),s=this.get("endDateTime");e.isAfter(i)&&e.isBefore(s)?this.set("state","current"):e.isAfter(s)?this.set("state","previous"):e.isBefore(i)&&this.set("state","pending")},isCurrent:function(){return"current"===this.get("state")},isPending:function(){return"pending"===this.get("state")},isPrevious:function(){return"previous"===this.get("state")},toJSON:function(e){var t={},n=this;return _.each(this.getters,function(e,i){t[i]=e.call(n)}),_.extend(_.clone(this.attributes),t)}})}}),define("bundleCalendar/js/collections/day",["backbone","../models/day"],function(e,t){return function(n){return e.Collection.extend({model:t(n)})}}),define("lib/hbTemplate!bundleCalendar/templates/day.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<span class="label">\n<% if (state === \'current\') { %>\n  <i class="hb hb-clock"></i>\n  <span class="timer"></span>\n<% } else { %>\n  <%= label %>\n<% } %>\n</span>\n\n<% if (state !== \'current\') { %>\n<aside class="cross-promo">\n	<p class="promo-text">\n    <%= crossPromo.text || \'Sign up to hear about the upcoming daily deals!\' %>\n  </p>\n  <% if (crossPromo.linkUrl) { %>\n  <a class="promo-link" href="<%= crossPromo.linkUrl %>" target="_blank"><i class="hb hb-cart"></i> <%= crossPromo.linkText %></a>\n  <% } else { %>\n	<a class="subscribe-link" href="#mailing-list"><i class="hb hb-email"></i> Subscribe</a>\n  <% } %>\n</aside>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("bundleCalendar/js/views/timer",["backbone","lib/moment"],function(e,t){return e.View.extend({initialize:function(e){if(!e.endTime)throw Error("No end time given");this.curTime=e.curTime?t(e.curTime):t(),this.endTime=t(e.endTime),this.secondsSinceStart=0,this.durationToEnd=t.duration(this.endTime.diff(this.curTime.zone("-07:00")))},start:function(){var e=this;this.timerInterval=setInterval(function(){return 0===e.durationToEnd.asSeconds()?void e.stop():(e.durationToEnd=e.durationToEnd.subtract(1,"s"),void e.render())},1e3)},stop:function(){clearInterval(this.timerInterval)},render:function(){var e,t=this.durationToEnd.hours(),n=this.durationToEnd.minutes(),i=this.durationToEnd.seconds();return e=(10>t?"0":"")+t+":"+(10>n?"0":"")+n+":"+(10>i?"0":"")+i,this.$el.text(e),this}})}),define("bundleCalendar/js/views/day",["backbone","lib/jquery/full","hbtemplate!../../templates/day.html","util/templating","./timer"],function(e,t,n,i,s){"use strict";return function(t){return e.View.extend({tagName:"li",className:function(){var e=["day"];this.model.get("startDateTime"),this.model.get("endDateTime");return e.push(this.model.get("label").toLowerCase()),e.push(this.model.get("startDateTime").format("YYYY-MM-DD")),e.push("is-"+this.model.get("state")),e.join(" ")},template:n,TimerView:s,render:function(){var e=i.renderTemplate(this.template,this.model.toJSON());return this.$el.append(e),this.model.isCurrent()&&(this.timer=new this.TimerView({el:this.$(".timer"),curTime:t,endTime:this.model.get("endDateTime")}).render(),this.timer.start()),this}})}}),define("bundleCalendar/js/views/dayList",["backbone","./day"],function(e,t){"use strict";return function(n){var i=t(n);return e.View.extend({tagName:"ul",className:"bundle-calendar",itemView:i,render:function(){var e=this;return this.collection.each(function(t){e.$el.append(new e.itemView({model:t}).render().el)}),this}})}}),define("bundleCalendar/calendar",["lib/jquery/full","lib/moment","util/loadCss","text!./css_dist/main.css","./js/collections/day","./js/views/dayList"],function(e,t,n,i,s,a){"use strict";return n(i),function(e){return{DayListView:a(e),DayCollection:s(e)}}}),define("bundleCalendar/main",["lib/jquery/full","lib/moment","util/loadCss","text!./css_dist/main.css","bundleCalendar/calendar"],function(e,t,n,i,s){"use strict";n(i);var a=function(n,i,a,r){for(var o=1e3*a,l=["one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen"],c=[],u=t(n,"X"),d=t(i,"X"),h=t(a,"X"),p=d.diff(u,"days"),_=0;p>_;_++){var m,g=u.clone().add(_,"day"),f=u.clone().add(_+1,"day");m=h.isBefore(g)?{text:"Check back for day "+l[_]+". Sign up for our newsletter so you don't miss it!"}:{text:"You missed day "+l[_]+". Sign up for our newsletter so you don't miss more!"},c.push({startDateTime:g.unix(),endDateTime:f.unix(),crossPromo:m})}var v=s(o);e(function(){var t=new v.DayCollection(c),n=new v.DayListView({collection:t}).render().el;r.append(n),e("a[href=#mailing-list]").attr("href","/newsletter").attr("target","_blank"),r.show()})};return{initializeCalendar:a}}),define("lib/hbTemplate!storefrontv2/templates/countdownCalendarViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="countdown-calendar">\n  <div class="calendar-text js-calendar-text"></div>\n  <div class="calendar-view js-calendar-view"></div>\n</script>'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/CountdownCalendarView",["require","storefrontv2/views/BaseView","bundleCalendar/main","storefrontv2/models/Page","hbtemplate!storefrontv2/templates/countdownCalendarViewTemplates.html","util/templating","util/main"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("bundleCalendar/main"),i=e("storefrontv2/models/Page"),s=e("hbtemplate!storefrontv2/templates/countdownCalendarViewTemplates.html"),a=e("util/templating");e("util/main");return $("body").append(s),t.extend({className:"countdown-calendar calendar-holder",model:i,render:function(){return this.$el.html(a.renderTemplateId("countdown-calendar")),this},loadSubViews:function(){n.initializeCalendar(this.model.get("calendar_start"),this.model.get("calendar_end"),window.pageData.atTime,this.$(".js-calendar-view")),this.model.get("calendar_text")&&this.$(".js-calendar-text").text(this.model.get("calendar_text"))}})}),define("lib/hbTemplate!storefrontv2/templates/gridTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="grid-container">\n  <div class="list-header">\n    <span class="header-text"><%- entityList.get(\'human_name\') %></span>\n<% if (entityList.get(\'url\')) { %>\n    <a class="view-all-link" href="<%- entityList.getUrl() %>">View all</a>\n<% } %>\n  </div>\n  <div class="chunks-container">\n<% for (var i = 0; i < totalGridPages; i++) { %>\n    <div class="list-content js-list-content"></div>\n<% } %>\n\n    <div class="js-loading-overlay overlay">\n      <span class="overlay-text">Loading more great games&hellip;</span>\n      <span class="spinner"></span>\n    </div>\n    <div class="js-error-overlay overlay">\n      <span class="overlay-text">Error communicating with the server.</span>\n    </div>\n  </div>\n  <div class="js-pagination"></div>\n</script>\n\n<script type="text/template" id="grid-rows">\n  <ul class="entities-list js-entities-list no-style-list full js-full">\n<% entities.each(function(entity) { %>\n    <li class="entity-block-container js-entity-container" data-entity-key="<%- entity.get_machine_name() %>"></li>\n<% }); %>\n  </ul>\n</script>\n\n<script type="text/template" id="grid-pagination">\n  <a href="#" class="js-grid-first grid-first grid-page-nav hb hb-angle-double-left"></a>\n  <a href="#" class="js-grid-prev grid-prev grid-page-nav hb hb-angle-left"></a>\n<% for (var i = 0; i < totalGridPages; i++) { %>\n  <a href="#" class="js-grid-page grid-page <%- i === currentGridPageIndex ? \'active\' : \'\'%>" data-page-index="<%- i %>"><%- i + 1 %></a>\n<% } %>\n  <a href="#" class="js-grid-next grid-next grid-page-nav hb hb-angle-right"></a>\n  <a href="#" class="js-grid-last grid-last grid-page-nav hb hb-angle-double-right"></a>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/GridView",["require","storefrontv2/views/BaseView","storefrontv2/models/Entity","storefrontv2/models/EntityList","storefrontv2/views/EntityBlockView","storefrontv2/models/Product","storefrontv2/models/PagePreview","hbtemplate!storefrontv2/templates/gridTemplates.html","util/templating"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/Entity"),i=e("storefrontv2/models/EntityList"),s=e("storefrontv2/views/EntityBlockView"),a=e("storefrontv2/models/Product"),r=(e("storefrontv2/models/PagePreview"),e("hbtemplate!storefrontv2/templates/gridTemplates.html")),o=e("util/templating");$("body").append(r);var l=t.extend({className:"pagination no-style-list",events:{"click .js-grid-page":"onGridPageClick","click .js-grid-first":"onFirstGridPageClick","click .js-grid-last":"onLastGridPageClick","click .js-grid-prev":"onPrevGridPageClick","click .js-grid-next":"onNextGridPageClick"},initialize:function(e){t.prototype.initialize.call(this,e),this.currentGridPageIndex=0,this.maxGridPageNumbers=e.maxGridPageNumbers||l.MAX_PAGE_NUMBERS;var n=this;this.listenTo(this.model,"gridPage:changed",function(e){n.currentGridPageIndex=e,n.updatePagination(e)})},getGridPageButtonForIndex:function(e){return this.$('.js-grid-page[data-page-index="'+e+'"]')},isFirstGridPage:function(e){return 0===e},isLastGridPage:function(e){return e===this.model.getTotalGridPages()-1},onFirstGridPageClick:function(e){this.triggerGridPageClicked(0,e)},onGridPageClick:function(e){var t=$(e.currentTarget),n=parseInt(t.attr("data-page-index"));this.triggerGridPageClicked(n,e)},onLastGridPageClick:function(e){this.triggerGridPageClicked(this.model.getTotalGridPages()-1,e)},onNextGridPageClick:function(e){this.triggerGridPageClicked(this.currentGridPageIndex+1,e)},onPrevGridPageClick:function(e){this.triggerGridPageClicked(this.currentGridPageIndex-1,e)},render:function(){return this.$el.html(o.renderTemplateId("grid-pagination",{currentGridPageIndex:this.currentGridPageIndex,totalGridPages:this.model.getTotalGridPages()})),this.updatePagination(this.currentGridPageIndex),this},triggerGridPageClicked:function(e,t){t.preventDefault(),this.model.trigger("gridPageFetch:started",e)},updatePagination:function(e){var t,n=this,i=n.$(".js-grid-first, .js-grid-prev"),s=n.$(".js-grid-next, .js-grid-last"),a=n.isFirstGridPage(e),r=n.isLastGridPage(e),o=n.model.getTotalGridPages();n.$(".js-grid-page").removeClass("active visible"),i.removeClass("disabled"),s.removeClass("disabled"),a&&(i.addClass("disabled"),t=_.range(0,Math.min(o,n.maxGridPageNumbers))),r&&(s.addClass("disabled"),t=_.range(Math.max(0,o-n.maxGridPageNumbers),o)),a||r||(t=_.range(e-1,e+n.maxGridPageNumbers-1)),_.each(t,function(e){n.getGridPageButtonForIndex(e).addClass("visible")}),n.getGridPageButtonForIndex(e).addClass("active")}},{MAX_PAGE_NUMBERS:3});return t.extend({initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.currentGridPageIndex=0,this.pageSection=e.pageSection,this.shoppingCartCollection=e.shoppingCartCollection,this.listenTo(this.model,{"gridPageFetch:success":this.onGridPageFetchSuccess,"gridPageFetch:error":this.onGridPageFetchError,"gridPageFetch:preexisting":this.switchGridPage,"gridPageFetch:fetching":this.showLoadingOverlay})},model:i,className:"grid",loadSubViews:function(){var e,t=this.renderGridPageTemplate(this.model.get("entities")),n=this.$(".js-list-content").first(),i=this.$(".js-pagination");n.html(t),this.model.getTotalGridPages()>1&&(e=new l({model:this.model}),i.html(e.render().$el))},renderGridPageTemplate:function(e){var t,i=$(o.renderTemplateId("grid-rows",{Entity:n,entities:e,Product:a})),r=i.find(".js-entity-container"),l=this;return e.each(function(e){t=new s({couponCollection:l.couponCollection,model:e,shoppingCartCollection:l.shoppingCartCollection}),t.renderTo(r.filter('[data-entity-key="'+e.get_machine_name()+'"]'))}),i},switchGridPage:function(e){this.$(".js-list-content").eq(this.currentGridPageIndex).hide(),this.$(".js-list-content").eq(e).show(),this.currentGridPageIndex=e},onGridPageFetchSuccess:function(e,t){this.$(".js-list-content").eq(this.currentGridPageIndex).hide(),this.renderGridPageResults(e,t),this.currentGridPageIndex=t,this.$(".js-loading-overlay").hide()},onGridPageFetchError:function(){this.$(".js-loading-overlay").hide(),this.$(".js-error-overlay").show().delay(1500).fadeOut()},renderGridPageResults:function(e,t){var n=this.renderGridPageTemplate(e);this.$(".js-list-content").eq(t).html(n).show()},showLoadingOverlay:function(){this.$(".js-loading-overlay").show()},render:function(){return this.$el.html(o.renderTemplateId("grid-container",{Entity:n,EntityList:i,entityList:this.model,Product:a,templating:o,userModel:this.sharedConfig.userModel,totalGridPages:this.model.getTotalGridPages()})),this.$(".js-loading-overlay").hide(),this.$(".js-error-overlay").hide(),this}})}),define("lib/hbTemplate!storefrontv2/templates/tabbedListViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="tabbed-list-product-item">\n<%\nvar status = product.getStatus();\n%>\n  <div class="entity <%- product.isOnSale() ? \'on-sale\' : \'\' %>">\n    <a class="entity-link" href="<%- product.getUrl() %>">\n      <div class="entity-details">\n        <span class="entity-title" title="<%- product.get(\'human_name\') %>"><%- productIndex + 1 + \'. \' + product.get(\'human_name\') %></span>\n        <div class="entity-meta">\n          <ul class="platforms no-style-list">\n<% _.each(product.get(\'delivery_methods\'), function(platform) { %>\n           <li class="platform hb <%- HB_SHARED_CONSTANTS.delivery_method_definition_dict[platform].icon %>"></li>\n<% }); %>\n          </ul>\n          <ul class="operating-systems no-style-list">\n<% _.each(product.get(\'platforms\'), function(os) { %>\n            <li class="operating-system hb <%- HB_SHARED_CONSTANTS.platform_definition_dict[os].icon %>"\n                title="<%- HB_SHARED_CONSTANTS.platform_definition_dict[os].human_name %>"></li>\n<% }); %>\n          </ul>\n<% if (status) { %>\n          <span class="entity-status <%- product.getStatusHtmlClass() %>"><%- Product.PRODUCT_STATUS[status] %></span>\n<% } %>\n        </div>\n      </div>\n      <div class="entity-pricing js-price-container"></div>\n    </a>\n  </div>\n</script>\n\n<script type="text/template" id="tabbed-list-product-list">\n  <ul class="entities-list js-entities-list no-style-list <%- isActive ? \'active\' : \'\' %>">\n<% _.each(productList.get(\'entities\').first(TabbedListView.MAX_ITEMS_TO_SHOW), function(product) { %>\n    <li class="entity-container js-entity-container"></li>\n<% }); %>\n    <li class="entity-container view-all">\n      <div class="entity">\n        <a class="entity-link" href="<%- productList.getUrl() %>">View all</a>\n      </div>\n    </li>\n  </ul>\n</script>\n\n<script type="text/template" id="tabbed-list-container">\n  <div class="tabbed-product-list <%- tabbedProductList.getTypeHtmlClass() %>">\n    <div class="list-header">\n      <ul class="list-tabs no-style-list">\n<% tabbedProductList.get(\'entities\').each(function(productList, index) { %>\n        <li class="list-tab js-list-tab <%- index ? \'\' : \'active\' %>"><%- productList.get(\'human_name\') %></li>\n<% }); %>\n      </ul>\n    </div>\n    <div class="list-content">\n<%\nvar templateArgs;\ntabbedProductList.get(\'entities\').each(function(productList, index) {\n  templateArgs = {\n    isActive: !index,\n    Product: Product,\n    productList: productList,\n    TabbedListView: TabbedListView\n  };\n%>\n      <%= templating.renderTemplateId(\'tabbed-list-product-list\', templateArgs) %>\n<% }); %>\n    </div>\n  </div>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/TabbedListView",["require","storefrontv2/views/BaseView","storefrontv2/models/EntityList","storefrontv2/views/EntityPriceView","storefrontv2/models/Product","hbtemplate!storefrontv2/templates/tabbedListViewTemplates.html","util/templating","util/main"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/EntityList"),i=e("storefrontv2/views/EntityPriceView"),s=e("storefrontv2/models/Product"),a=e("hbtemplate!storefrontv2/templates/tabbedListViewTemplates.html"),r=e("util/templating");e("util/main");$("body").append(a);var o=t.extend({initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.productIndex=e.productIndex,this.shoppingCartCollection=e.shoppingCartCollection},model:s,loadSubViews:function(){var e,t=this.$(".js-price-container");t.length&&this.model.hasPrice()&&(e=new i({couponCollection:this.couponCollection,model:this.model,shoppingCartCollection:this.shoppingCartCollection}),e.renderTo(t))},render:function(){return this.$el.html(r.renderTemplateId("tabbed-list-product-item",{product:this.model,Product:s,productIndex:this.productIndex})),this}}),l=t.extend({events:{"click .js-list-tab":"renderList"},initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.shoppingCartCollection=e.shoppingCartCollection},model:n,loadSubViews:function(){var e,t,n,i,s=this.$(".js-entities-list"),a=this;this.model.get("entities").each(function(r,c){n=s.eq(c),i=n.find(".js-entity-container"),e=r.get("entities").first(l.MAX_ITEMS_TO_SHOW),_.each(e,function(e,n){t=new o({couponCollection:a.couponCollection,model:e,productIndex:n,shoppingCartCollection:a.shoppingCartCollection,userModel:a.sharedConfig.userModel}),t.renderTo(i.eq(n))})})},render:function(){return this.$el.html(r.renderTemplateId("tabbed-list-container",{Product:s,TabbedListView:l,tabbedProductList:this.model,templating:r})),this},renderList:function(e){var t=$(e.currentTarget),n=this.$(".js-list-tab"),i=this.$(".js-entities-list"),s=n.index(t);n.removeClass("active"),i.removeClass("active"),n.eq(s).addClass("active"),i.eq(s).addClass("active")}},{MAX_ITEMS_TO_SHOW:15});return l}),define("lib/hbTemplate!storefrontv2/templates/pageViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="storefront-page-content">\n<%\n  var banner = page.get(\'banner\');\n  if (banner) {\n%>\n  <a class="splash-banner"\n     href="<%- page.getBannerUrl() %>"\n     style="background-image: url(<%- banner.image_url %>)"></a>\n  <a class="splash-banner mobile"\n     href="<%- page.getBannerUrl() %>"\n     style="background-image: url(<%- banner.mobile_image_url || banner.image_url %>)"></a>\n<% } %>\n  <div class="js-byob-container"></div>\n  <div class="js-countdown-calendar-container"></div>\n  <ul class="page-sections no-style-list">\n<%\n  _.each(PageView.DEFAULT_PAGE_LAYOUT, function(section) {\n    var entityListCollection = page.get(section);\n\n    if (entityListCollection) {\n%>\n    <li class="page-section <%- PageView.getSectionClass(section) %> js-<%- PageView.getSectionClass(section) %>">\n      <ul class="entity-lists no-style-list js-entity-lists">\n        <% entityListCollection.each(function(entityList) { %>\n          <li class="entity-list js-entity-list <%- entityList.getTypeHtmlClass() %>"></li>\n        <% }) %>\n      </ul>\n    </li>\n<%\n    }\n  });\n%>\n  </ul>\n</script>\n'.replace(/xSTATIC_URLx/g,t);
}()}),define("storefrontv2/views/PageView",["require","storefrontv2/views/BaseView","storefrontv2/models/BYOB","storefrontv2/views/BYOBView","storefrontv2/views/CarouselView","storefrontv2/views/CountdownCalendarView","storefrontv2/views/GridView","storefrontv2/models/Entity","storefrontv2/models/EntityList","storefrontv2/models/Page","storefrontv2/views/TabbedListView","hbtemplate!storefrontv2/templates/pageViewTemplates.html","util/templating","util/main"],function(e){"use strict";var t=e("storefrontv2/views/BaseView"),n=e("storefrontv2/models/BYOB"),i=e("storefrontv2/views/BYOBView"),s=e("storefrontv2/views/CarouselView"),a=e("storefrontv2/views/CountdownCalendarView"),r=e("storefrontv2/views/GridView"),o=(e("storefrontv2/models/Entity"),e("storefrontv2/models/EntityList")),l=e("storefrontv2/models/Page"),c=e("storefrontv2/views/TabbedListView"),u=e("hbtemplate!storefrontv2/templates/pageViewTemplates.html"),d=e("util/templating"),h=e("util/main");$("body").append(u);var p=t.extend({initialize:function(e){t.prototype.initialize.call(this,e),this.couponCollection=e.couponCollection,this.currentCountry=e.currentCountry,this.entityListViews=[],this.shoppingCartCollection=e.shoppingCartCollection},model:l,render:function(){return this.$el.html(d.renderTemplateId("storefront-page-content",{Page:l,page:this.model,PageView:p})),this},loadSubViews:function(){var e,t,l,u=this.model.get("auto_coupons"),d=this;u&&u.length&&(e=new n({coupons:d.couponCollection.toJSON()},{pageModel:d.model,parse:!0}),t=new i({currentCountry:d.currentCountry,model:e,shoppingCartCollection:d.shoppingCartCollection}),t.renderTo(d.$(".js-byob-container"))),d.model.get("calendar_start")&&(l=new a({model:d.model}),l.renderTo(d.$(".js-countdown-calendar-container"))),_.each(p.DEFAULT_PAGE_LAYOUT,function(e){var t,n,i=d.model.get(e);i&&(t=".js-"+p.getSectionClass(e)+" .js-entity-list",n=d.$(t),i.each(function(t,i){var a;t.isCarousel()?a=new s({couponCollection:d.couponCollection,model:t,pageSection:e,shoppingCartCollection:d.shoppingCartCollection}):t.get("type")==o.TYPES.TABBED_LIST?a=new c({couponCollection:d.couponCollection,model:t,shoppingCartCollection:d.shoppingCartCollection}):t.isGrid()&&(a=new r({couponCollection:d.couponCollection,model:t,shoppingCartCollection:d.shoppingCartCollection})),d.entityListViews.push(a),a.renderTo(n.eq(i))}))})}},{DEFAULT_PAGE_LAYOUT:[l.SECTIONS.FEATURED_SECTION,l.SECTIONS.SIDEBAR_TOP_SECTION,l.SECTIONS.SIDEBAR_BOTTOM_SECTION,l.SECTIONS.SECONDARY_SECTION,l.SECTIONS.OTHERS_SECTION],getSectionClass:function(e){return h.replace_all_in_string(e,"_","-")}});return p}),define("lib/hbTemplate!platformIcons/templates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="platform-icons-template">\n<% if (platforms) { %>\n  <ul class="platforms <%= css_class %>">\n  <% for (delivery_method in platforms) { %>\n    <% var method_definition = DELIVERY_DEFINITION[delivery_method]; %>\n    <% if (method_definition) { %>\n    <li>\n      <i class="hb <%- method_definition.icon %>" title=""></i>\n      <aside class="platform-info">\n      <% for (var i = 0; i < platforms[delivery_method].available.length; i++) { %>\n        <% var platform = platforms[delivery_method].available[i]; %>\n        <% var platform_definition = PLATFORM_DEFINITION[platform]; %>\n        <% if (platform_definition) { %>\n        <p>\n          <i class="hb <%- platform_definition.icon %>"></i><em><%- method_definition.preamble || \'Get it via\' %> <%= platform_definition.human_name %></em>\n        </p>\n        <% } %>\n      <% } %>\n    <% } %>\n      </aside>\n    </li>\n  <% } %>\n  </ul>\n<% } %>\n</script>\n\n<script type="text/template" id="operating-systems-icons-template">\n<% if (operating_systems) { %>\n  <ul class="platforms <%= css_class %>">\n  <% for (var os in operating_systems) { %>\n    <% var platform_definition = PLATFORM_DEFINITION[os]; %>\n    <% if (platform_definition) { %>\n    <li>\n      <i class="hb <%- platform_definition.icon %>" title=""></i>\n      <aside class="platform-info">\n        <p>\n          <i class="hb <%- platform_definition.icon %>"></i><em>Play it on <span itemprop="gamePlatform operatingSystem"><%= platform_definition.human_name %></span></em>\n        </p>\n      </aside>\n    </li>\n    <% } %>\n  <% } %>\n  </ul>\n<% } %>\n</script>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("platformIcons/main",["module","backbone","lib/jquery/full","underscore","util/templating","hbtemplate!./templates.html"],function(e,t,n,i,s,a){"use strict";n("body").append(n(a));var r=t.View.extend({initialize:function(e){this.platforms=e.platforms,this.css_class=e.css_class},render:function(){var t={};return t.PLATFORM_DEFINITION=e.config().PLATFORM_DEFINITION,t.DELIVERY_DEFINITION=e.config().DELIVERY_DEFINITION,t.platforms=this.platforms,t.css_class=this.css_class,this.$el.html(s.renderTemplateId("platform-icons-template",t)),this}}),o=function(e,t){var n=new r({platforms:e,css_class:t});return n.render(),n.$el.html()},l=t.View.extend({initialize:function(e){if(this.operating_systems={},e.platforms)for(var t in e.platforms)for(var n=0;n<e.platforms[t].available.length;n++)this.operating_systems[e.platforms[t].available[n]]=e.platforms[t].available[n];this.css_class=e.css_class},render:function(){var t={};return t.PLATFORM_DEFINITION=e.config().PLATFORM_DEFINITION,t.operating_systems=this.operating_systems,t.css_class=this.css_class,this.$el.html(s.renderTemplateId("operating-systems-icons-template",t)),this}}),c=function(e,t){var n=new l({platforms:e,css_class:t});return n.render(),n.$el.html()};return{render_platform_icons:o,render_operating_system_icons:c}}),define("monthly/config",[],function(){"use strict";var e="10% discount is courtesy of Humble Bundle (charities and developers are paid the same amount as if there is no discount) and may not be combined with coupons but does combine with non-coupon discounts (unless otherwise stated). This 10% discount is only available to active Humble Monthly subscribers and expires when a user unsubscribes. Some exclusions may apply.",t="There was an error with your stored payment credentials. Please verify your payment information and update it in your <a class='error-link' target=_blank href='/user/settings'>user settings</a>.";return{CardValidationErrorText:t,MonthlyDiscountTooltipText:e,VideoFadeTime:500}}),define("storefront/views/MonthlyDiscountNotificationView",["lib/jquery/full","lib/underscore","backbone","storefront/views/BaseView","monthly/config"],function(e,t,n,i,s){"use strict";var a=i.extend({initialize:function(e){i.prototype.initialize.call(this,e),this.options=e,this.templateId="monthly-discount-notification",this.monthly_is_paused=e.monthly_is_paused},render:function(){var t={is_monthly_subscriber:this.is_monthly_subscriber(),is_monthly_paused:this.monthly_is_paused,tooltip_text:s.MonthlyDiscountTooltipText};return this.$el.html(e(i.prototype.render_template_id.call(this,this.templateId,t))),this},is_monthly_subscriber:function(){return window.models.user_json&&t.contains(window.models.user_json.active_subscriptions,"humble_monthly")}});return a}),define("storefront/views/WishlistButtonView",["lib/jquery/full","underscore","backbone","util/main","storefront/views/BaseView"],function(e,t,n,i,s){"use strict";var a=s.extend({initialize:function(e){s.prototype.initialize.call(this,e),this.options=e,this.wishlist=this.options.wishlist,this.product_machine_name=this.options.product_machine_name,this.is_logged_in=this.options.is_logged_in,this.templateId="wishlist-icon",this.permalink=this.options.permalink,this.listenTo(this.wishlist,"change",this.render),t.bindAll(this,"remove_login_prompt")},events:t.extend(s.prototype.events,{"click .js-wishlist-button":"wishlist_click","click .js-login-button":"login_click"}),render:function(){var t={on_wishlist:this.wishlist.contains(this.product_machine_name),is_logged_in:this.is_logged_in,permalink:this.permalink,show_login_prompt:this.show_login_prompt};return this.$el.html(e(s.prototype.render_template_id.call(this,this.templateId,t))),this},login_click:function(e){e.preventDefault(),e.stopPropagation(),i.login(this.permalink+"?action=wishlist")},remove_login_prompt:function(){this.show_login_prompt=!1,this.render()},wishlist_click:function(e){if(e.preventDefault(),!this.is_logged_in)return this.show_login_prompt=!0,this.render(),void window.setTimeout(this.remove_login_prompt,5e3);if(this.wishlist.contains(this.product_machine_name))this.wishlist.remove(this.product_machine_name);else{if(this.wishlist.size()>=this.constants.MAX_WISHLIST_SIZE)return void show_flash("You can't add more than "+this.constants.MAX_WISHLIST_SIZE+" items to your wish list");this.wishlist.add(this.product_machine_name)}}});return a}),define("storefront/views/ProductView",["module","lib/jquery/full","underscore","backbone","util/main","platformIcons/main","storefront/views/BaseView","storefront/views/WishlistButtonView","storefront/common"],function(e,t,n,i,s,a,r,o,l){"use strict";var c={ADD_TO_CART:"Add",IN_CART:"Buy",VIEW:"View"},u={ADD_TO_CART:"Add",IN_CART:"Get!",VIEW:"View",FREE:"Free!"},d=r.extend({idAttribute:"machine_name",tagName:"div",initialize:function(e){r.prototype.initialize.call(this,e),this.options=e,this.shopping_cart=this.options.shopping_cart,this.international=this.options.international,this.current_country=this.options.current_country,this.usd_postfix="us"!==this.current_country,this.render_as_grid=this.options.render_as_grid,this.details_is_link=this.options.details_is_link,this.wishlist=this.options.wishlist,this.is_logged_in=this.options.is_logged_in,this.monthly_is_paused=this.options.monthly_is_paused,this.index=this.options.index,this.wishlistView=new o({constants:this.constants,wishlist:this.wishlist,product_machine_name:this.model.get("machine_name"),is_logged_in:this.is_logged_in,permalink:this.permalink()}),this.render_as_grid?this.templateId="storefront-grid-product":this.templateId="storefront-list-product",n.bindAll(this,"add_to_cart","update_purchase_button_text","get_featured_image","render","get_string","start_sale_timer","update_sale_timer","hide_checkout_button","show_checkout_button"),this.shopping_cart&&this.listenTo(this.shopping_cart.collection,"collectionModified",this.update_purchase_button_text)},events:n.extend({"click .js-add-to-cart":"add_to_cart"},r.prototype.events),should_have_view_info_link:function(){return this.details_is_link||this.model.get_force_popup()&&this.render_as_grid||void 0===this.model.get("current_price")},add_to_cart:function(e){if(e.stopPropagation(),this.details_is_link||this.should_have_view_info_link()){var n=this.details_is_link;l.navigate(e,this.permalink(),n,this.constants,{trigger:!0})}else{e.preventDefault();var a=this.model.display_as_free()&&this.model.get("auth_required_for_purchase_if_free");if(this.shopping_cart.size()>=this.constants.MAX_CART_SIZE)return void show_flash("You can't add more than "+this.constants.MAX_CART_SIZE+" items to a cart");var r=this.$(".js-action-button");if(r.hasClass("in-cart")||this.shopping_cart&&this.shopping_cart.is_in_cart(this.model.get_machine_name()))this.shopping_cart.toggle_collapsable(),s._gaTrackEvent(void 0,"'Checkout' clicked",this.model.get_machine_name()+"-"+this.model.get_currency(),Math.floor(100*this.model.get_current_price_as_big()));else if(a&&!this.is_logged_in)i.trigger("free-product-requires-login",this.model);else if(a&&window.models.user_json&&!window.models.user_json.has_steam_link)i.trigger("free-product-requires-steam-link",this.model);else{this.shopping_cart.add_item(this.model);var o=this.model.get_icon_path();window.animate_add_to_cart(t(e.currentTarget),o,t.noop),s._gaTrackEvent(void 0,"'Add to cart' clicked",this.model.get_machine_name()+"-"+this.model.get_currency(),Math.floor(100*this.model.get_current_price_as_big()))}this.update_purchase_button_text()}},permalink:function(){return l.add_link_prefix(this.model.get_path(),this.constants)},update_purchase_button_text:function(){this.shopping_cart&&this.shopping_cart.is_in_cart(this.model.get_machine_name())?(this.$(".js-action-button").removeClass("has-cart"),this.$(".js-action-button").addClass("in-cart")):this.should_have_view_info_link()?(this.$(".js-action-button").removeClass("has-cart"),this.$(".js-action-button").removeClass("in-cart")):(this.$(".js-action-button").addClass("has-cart"),this.$(".js-action-button").removeClass("in-cart"))},get_featured_image:function(){return-1!=this.className.indexOf("promoted")?this.model.get("storefront_featured_image_large"):-1!=this.className.indexOf("medium")?this.model.get("storefront_featured_image_medium"):-1!=this.className.indexOf("recommended")?this.model.get("storefront_featured_image_recommendation"):this.model.get("storefront_featured_image_small")},render:function(){this.$el.addClass(d.get_product_element_class(this.model.get("machine_name")));var e=this.model.toJSON(),i=this.model.get("sale_end"),o=this.model.get("sale_type");e.layout_type=this.options.layout_type,e.featured_image=this.get_featured_image(),e.get_string=this.get_string,e.can_be_purchased=void 0!==this.model.get("current_price"),e.link=this.model.get_path(),e.icon=this.model.get("storefront_icon"),e.on_sale=this.model.on_sale(),e.sale_type=o,e.display_timer=d.should_display_timer(i),e.international=this.international,e.usd_postfix=this.usd_postfix,e.permalink=this.permalink(),e.is_logged_in=this.is_logged_in,e.display_as_free=this.model.display_as_free(),e.index=this.index,e.options=this.options,this.model.has("platforms")||(e.platforms=this.model.get("supported_platforms"));var l=this.model.get("cta_badge");this.model.on_sale()&&"preorder"!=l&&"earlyaccess"!=l&&(l="onsale"),l&&(e.cta_badge=l,e.cta_text=this.model.get_cta_badge_text(l)),e.territory_allowed=this.model.is_territory_allowed(this.current_country),e.render_platform_icons=a.render_platform_icons,e.icon_dict||(e.icon_dict={});var c=window.hb.abTestBuckets,u=this.model.get_current_price_as_big(),h=window.models&&window.models.user_json&&n.contains(window.models.user_json.active_subscriptions,"humble_monthly"),p=u&&h&&!this.monthly_is_paused&&c&&"apply_monthly_discount"==c.priceDisplayType&&-1==this.model.get("incompatible_features").indexOf("coupons")&&-1==this.model.get("incompatible_features").indexOf("subscriber-discount-coupons");if(p){var _=u.times(new Big(.1));e.current_price=[s.round_big_to_money_amount(u.minus(_)),this.model.get_currency()]}return this.$el.append(t(r.prototype.render_template_id.call(this,this.templateId,e))),"product"!=this.model.get("type")||this.details_is_link||(this.$el.find(".js-wishlist-holder").append(this.wishlistView.render().$el),this.$el.find(".js-wishlist-holder").css({display:"inline-block"})),this.update_purchase_button_text(),this.start_sale_timer(),this},get_string:function(e){return"VIEW"==e&&this.model.get("byob_publisher")?"Build a "+this.model.get("byob_publisher")+" bundle":this.model.display_as_free()?u[e]:c[e]},start_sale_timer:function(){if(this.model.on_sale()&&d.should_display_timer(this.model.get("sale_end"))){this.update_sale_timer(),this.clear_sale_timer();var e=this;this.sale_timer=setInterval(function(){e.update_sale_timer()},500)}},update_sale_timer:function(){this.$(".js-sale-timer").text(render_time_remaining_until(this.model.get("sale_end")))},clear_sale_timer:function(){this.sale_timer&&clearInterval(this.sale_timer)},hide_checkout_button:function(){this.$(".js-add-to-cart").hide()},show_checkout_button:function(){this.$(".js-add-to-cart").show()}},{should_display_timer:function(e){if(!e)return!1;var t=new Date;return t.setDate(t.getDate()+30),e<t.getTime()/1e3},get_product_element_class:function(e){return"product-"+e}});return d}),define("storefront/models/BaseModel",["underscore","backbone"],function(e,t){"use strict";var n={preorder:"Pre-Order","new":"New",outnow:"Out Now",dlc:"DLC",earlyaccess:"Early Access",onsale:"On Sale",updated:"Updated",moregames:"More Games"},i=t.Model.extend({initialize:function(t){e.bindAll(this,"get_machine_name","get_force_popup","get_path","get_human_name","get_type","get_cta_badge_text","on_sale","is_territory_allowed","reload_page_on_click","details_loaded")},get_human_name:function(){return this.get("human_name")},get_type:function(){return this.get("type")},get_cta_badge_text:function(e){return e?n[e]:n[this.get("cta_badge")]},on_sale:function(){return!1},is_territory_allowed:function(t){var n=this.get("blocked_territories");if(n instanceof Array&&e.contains(n,t.toUpperCase()))return!1;var i=this.get("allowed_territories");return i instanceof Array?e.contains(i,t.toUpperCase()):!0},display_as_free:function(){return!1}});return i}),define("storefront/models/Product",["module","underscore","backbone","lib/big","storefront/models/BaseModel"],function(e,t,n,i,s){"use strict";var a=s.extend({idAttribute:"machine_name",defaults:{human_name:"",human_url:"",machine_name:"",youtube_link:null,system_requirements:"",storefront_preview_image:null,cta_badge:null,partner_analytics_id:"",wallet_reload:!1,incompatible_features:[],giftable:!0,carousel_content:null,more_information:null,eula_link:null,release_date:null,auth_required_for_purchase_if_free:!1},initialize:function(e){s.prototype.initialize.call(this,e),t.bindAll(this,"get_currency","get_icon_path","get_human_url","get_machine_name","get_current_price_as_big","get_platforms","get_price_as_big","get_storefront_alerts","set_prices","get_humble_price","has_details");var n=new Image;n.src=this.get_icon_path(),this.set("path",this.get_path()),this.prices_set=!1,this.current_country=e.current_country,this.currencies=e.currencies,this.exchange_rates=e.exchange_rates,this.euro_countries=e.euro_countries,this.gbp_countries=e.gbp_countries},get_current_price_as_big:function(){var e=this.get("current_price");return e?new i(e[0]):null},get_currency:function(){var e=this.get("full_price");return e?e[1]:null},get_icon_path:function(){return this.get("storefront_icon")},get_human_url:function(){return this.get("human_url")},get_machine_name:function(){return this.get("machine_name")},get_platforms:function(){return this.has("platforms")?this.get("platforms"):this.get("supported_platforms")},get_minimum_age:function(){var e=this.get("minimum_age");return void 0===e?-1:e},get_force_popup:function(){var e=this.get("force_popup");return void 0===e?!1:e},get_path:function(){return"/"+this.get_human_url()},reload_page_on_click:function(){return!1},get_price_as_big:function(){return new i(this.get("full_price")[0])},get_storefront_alerts:function(){return this.get("alert_messages")},has_details:function(){return this.get("description")||this.get("system_requirements")||this.get("youtube_link")||this.get("storefront_preview_image")},get_title_text:function(){var e="Buy "+this.get_human_name()+" from the Humble Store";if(this.on_sale()){var t=Math.round(100*((this.get_price_as_big()-this.get_current_price_as_big())/this.get_price_as_big()));e+=" and save "+t+"%"}return e},on_sale:function(){return Boolean(this.get("sale_end")||this.get("on_sale"))},details_loaded:function(){return this.has("description")},set_prices:function(){function e(e){return[i(e[0]),e[1]]}if(!this.prices_set)if("bundle"==this.get("type")||"monthly"==this.get("type"))this.set("full_price",void 0),this.set("current_price",void 0);else if(this.get("full_price")){if(this.get("full_price")[this.current_country])return this.set("full_price",e(this.get("full_price")[this.current_country])),this.set("current_price",e(this.get("current_price")[this.current_country])),void(this.prices_set=!0);if("US"==this.current_country)return this.set("full_price",void 0),void this.set("current_price",void 0);this.euro_countries.indexOf(this.current_country)>-1?this.get("full_price").EUROPE_EURO?(this.set("full_price",e(this.get("full_price").EUROPE_EURO)),this.set("current_price",e(this.get("current_price").EUROPE_EURO)),this.prices_set=!0):this.get_humble_price("EUR"):this.gbp_countries.indexOf(this.current_country)>-1?this.get("full_price").EUROPE_GBP?(this.set("full_price",e(this.get("full_price").EUROPE_GBP)),this.set("current_price",e(this.get("current_price").EUROPE_GBP)),this.prices_set=!0):this.get_humble_price("GBP"):this.get_humble_price("USD")}},get_humble_price:function(e){if(e=e.toUpperCase(),this.currencies.indexOf(e)>-1){var t=i(this.get("full_price").US[0]),n=i(this.get("current_price").US[0]);if("USD"==e)return this.set("full_price",[t,"USD"]),this.set("current_price",[n,"USD"]),void(this.prices_set=!0);var s=Math.floor(this.exchange_rates[e.toUpperCase()]*t*100)/100,a=Math.floor(this.exchange_rates[e.toUpperCase()]*n*100)/100;if(2>t)s=Math.floor(10*s)/10+"9",a=Math.floor(10*a)/10+"9";else if(20>t){var r=s%1;s=Math.floor(s)+(.5>r?".49":".99"),r=a%1,a=Math.floor(a)+(.5>r?".49":".99")}else s=Math.floor(s)+".99",a=Math.floor(a)+".99";this.set("full_price",[s,e]),this.set("current_price",[a,e]),this.prices_set=!0}},is_eligible_for_keep_credit:function(){return!t.contains(this.get("incompatible_features"),"earn-keep-credit")},display_as_free:function(){var e=this.get_current_price_as_big();return Boolean(e&&e.eq(0))}});return a}),define("storefront/models/Page",["underscore","backbone","storefront/models/BaseModel"],function(e,t,n){"use strict";var i=n.extend({idAttribute:"path",defaults:{human_name:"",machine_name:"",path:"",num_pages:0,cta_badge:null,end:32503708800,banner_image:null,hero_image:null,logo_text:null,logo_sub_text:null,timer_html:null},initialize:function(e){n.prototype.initialize.call(this,e)},has_auto_coupons:function(){var e=this.get("auto_coupons");return e&&e.length>0},get_machine_name:function(){return this.get("path")},get_force_popup:function(){return!0},get_path:function(){return this.get("path")},reload_page_on_click:function(){return!1},details_loaded:function(){return this.has("featured_items")}});return i}),define("storefront/ProductList",["lib/jquery/full","underscore","backbone","storefront/models/Product","storefront/models/Page"],function(e,t,n,i,s){"use strict";var a=n.Collection.extend({model:function(e,t){if("product"==e.type||"bundle"==e.type)return new i(e,t);if("page"==e.type)return new s(e,t);throw"Unknown type: "+e.type},initialize:function(e){t.bindAll(this,"get_featured_products")},get_by_product_url:function(e){var t=this.models.filter(function(t){var n=t.get_human_url&&t.get_human_url()||t.get_machine_name();return n==e});return t&&t[0]},get_featured_products:function(e,t){var n=new a;e=e||[];var i={};this.each(function(e){i[e.get_machine_name()]=e});for(var s=0;s<e.length;s++){var r=e[s];if(r in i){var o=i[r];o.is_territory_allowed(t)&&n.add(o)}}return n}});return a}),define("storefront/views/ProductListView",["lib/jquery/full","underscore","backbone","storefront/views/BaseView","storefront/views/ProductView","storefront/ProductList"],function(e,t,n,i,s,a){"use strict";var r=i.extend({initialize:function(n){var s=this;i.prototype.initialize.call(this,n),this.options=n,t.bindAll(this,"set_page","get_view_element","find_buy_button","auto_move_carousel","move_carousel_click","move_carousel","carousel_mouse_out","carousel_mouse_in","get_carousel_contents","render_grid_carousel","render","render_products","render_product_list","render_product","render_mixed_grid","load_additional_pages","finish_loading_featured_grid","finish_loading_non_featured_grid","check_load_more"),this.carousel_index=0,this.featured_carousel_count=n.featured_carousel_count||0,this.featured_carousel_items=n.featured_carousel_items||[],this.featured_products=n.featured_products||[],this.grid_options=n.grid_options||{},this.carousel_timeout=0,this.carousel_delay=5e3,this.carousel_animation_speed=800,this.shopping_cart=this.options.shopping_cart,this.international=this.options.international,this.render_as_grid=this.options.render_as_grid,this.current_country=this.options.current_country,this.details_is_link=this.options.details_is_link,this.wishlist=this.options.wishlist,this.is_logged_in=this.options.is_logged_in,this.monthly_is_paused=this.options.monthly_is_paused,this.page=null,this.pages_loaded=1,this.last_sent_request_id=0,this.last_received_request_id=-1,this.MAX_NUM_TRIES=5,this.finish_loading=this.finish_loading_non_featured_grid,".js-featured-view"==this.$el.selector&&(e(window).bind("scroll",s.check_load_more),s.finish_loading=s.finish_loading_featured_grid)},events:t.extend({"click .grid-carousel-dot":"move_carousel_click","click .grid-carousel-arrow":"move_carousel_click","mouseout .grid-carousel":"carousel_mouse_out","mouseover .grid-carousel":"carousel_mouse_in"},i.prototype.events),set_page:function(e){this.page=e,this.pages_loaded=1,this.last_sent_request_id++,this.last_received_request_id=this.last_sent_request_id},get_view_element:function(e){return this.$("."+s.get_product_element_class(e))},find_buy_button:function(e){return this.get_view_element(e).find(".js-action-button")},get_carousel_contents:function(){var e=[],t=Math.max(this.featured_carousel_items.length,this.featured_carousel_count);t=Math.min(t,this.featured_products.length);var n=0;this.featured_carousel_count=t;for(var i=0;t>i;i++){var s;if(i<this.featured_carousel_items.length)s=this.featured_carousel_items[i];else{var a=i-this.featured_carousel_items.length;s=this.featured_products.at(a).id,n+=1}this.collection.get(s)&&e.push(this.collection.get(s))}return{carousel_contents:e,taken_from_grid:n}},render_products:function(){var e=this.grid_options.layout_type,n=this.featured_products.models;if(this.$el.empty(),!e||t.contains(["normal","mixed"],e)){var i=this.get_carousel_contents();i.carousel_contents.length>1&&(this.render_grid_carousel(i.carousel_contents),this.carousel_timeout=setTimeout(this.auto_move_carousel,this.carousel_delay),n=this.featured_products.slice(i.taken_from_grid))}return this.render_product_list(n),this},render_product_list:function(e){var n=this,i=this.grid_options.layout_type;!i||t.contains(["normal","small","medium","recommendation"],i)?t.each(e,function(e){n.$el.append(n.render_product(e,null,i))},this):"mixed"===i&&this.render_mixed_grid(e)},render_product:function(e,t,n){var i,a;this.render_as_grid?(i="storefront-grid-product",0===this.collection.indexOf(e)&&this.featured_carousel_count<=1&&("normal"===n||!n)?i+=" promoted":"small"===n?i+=" small-grid-layout":"medium"===n?i+=" medium-grid-layout":"large"===n?i+=" promoted":"recommendation"===n&&(i+=" recommended-grid-layout")):i="storefront-list-product",null!==t&&(a="grid-carousel-item"+t,i+=" promoted grid-carousel-item");var r=new s({constants:this.constants,shopping_cart:this.shopping_cart,render_as_grid:this.render_as_grid,current_country:this.current_country,international:this.international,usd_postfix:this.usd_postfix,model:e,details_is_link:this.details_is_link,wishlist:this.wishlist,is_logged_in:this.is_logged_in,monthly_is_paused:this.monthly_is_paused,layout_type:n,className:i,id:a});return r.render().el},render_grid_carousel:function(t){var n=this;this.$el.append(e(i.prototype.render_template_id.call(this,"storefront-grid-carousel",{carousel_contents:t}))),e(t).map(function(e){n.$("#js-grid-carousel-contents").append(n.render_product(this,e))}),this.$(".grid-carousel-contents").width(100*t.length+"%"),this.move_carousel(0)},render_mixed_grid:function(e){var n=this,i=["large","small","small"],s=["medium","medium"],a=["small","small","small"],r=[i,s,a],o=["small","small"];this.featured_carousel_count<=1&&o.unshift("large"),t.each(e,function(e){if(n.$el.append(n.render_product(e,null,o.shift())),0==o.length){var t=Math.floor(Math.random()*r.length);o=[].concat(r[t])}},this)},carousel_mouse_in:function(e){clearTimeout(this.carousel_timeout)},carousel_mouse_out:function(e){this.carousel_timeout=setTimeout(this.auto_move_carousel,this.carousel_delay)},move_carousel_click:function(t){var n=parseInt(e(t.currentTarget).attr("data-idx"));t.stopPropagation(),this.move_carousel(n)},move_carousel:function(t){t=0>t?t+this.$(".grid-carousel-dot").length:t%this.$(".grid-carousel-dot").length,clearTimeout(this.carousel_timeout),this.$(".grid-carousel-contents").stop(!0).animate({left:-100*t+"%"},this.carousel_animation_speed),this.$(".grid-carousel-dot").removeClass("selected-item"),this.$("#grid-carousel-dot"+t).addClass("selected-item"),e(".grid-carousel-arrow.arrow-right").attr("data-idx",t+1),e(".grid-carousel-arrow.arrow-left").attr("data-idx",t-1),this.carousel_index=t},auto_move_carousel:function(){this.move_carousel((this.carousel_index+1)%this.featured_carousel_count),this.carousel_timeout=setTimeout(this.auto_move_carousel,this.carousel_delay)},show_loading_state:function(){this.$el.append(i.prototype.render_template_id.call(this,"storefront-loading-grid"))},hide_loading_state:function(){this.$el.find(".js-loading-grid").remove()},show_error_state:function(){this.hide_loading_state(),this.$el.append(i.prototype.render_template_id.call(this,"storefront-loading-grid-error"))},load_additional_pages:function(){var t=this,n=function(i){t.last_sent_request_id==t.last_received_request_id&&(t.show_loading_state(),e.ajax({type:"GET",url:t.constants.STORE_ROOT+"/api/lookup",data:{for_path:t.page.get_path(),page:t.pages_loaded,request:++t.last_sent_request_id},error:function(){0===i?t.show_error_state():n(i-1)},success:function(e){var i=parseInt(e.request);if(!(i<=t.last_received_request_id)){t.last_received_request_id++;var s=new a(e.result),r=s.get(t.page.get_path()),o=r.get("featured_items"),l=s.get_featured_products(o,t.current_country);t.hide_loading_state(),t.render_product_list(l.models),t.pages_loaded++,t.finish_loading(n)}}}))};n(t.MAX_NUM_TRIES)},finish_loading_non_featured_grid:function(e){this.pages_loaded<this.page.get("num_pages")?e(this.MAX_NUM_TRIES):this.hide_loading_state()},finish_loading_featured_grid:function(t){var n=this;this.pages_loaded<this.page.get("num_pages")?this.load_additional_pages=function(){t(n.MAX_NUM_TRIES)}:(e(window).unbind("scroll",n.check_load_more),this.hide_loading_state())},check_load_more:function(){this.$el.height()-window.scrollY<1e3&&this.load_additional_pages()}});return r}),define("lib/hbTemplate!adminLinks/templates/quick_links.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<ul class="admin-quicklinks js-admin-quicklinks">\n  <% if (editProductURL) { %>\n    <li class="menu-item">\n      <a class="quicklink" target="_blank" href="<%- editProductURL %>">View Product Admin</a>\n    </li>\n  <% } %>\n  <% if (editDisplayItemURL) { %>\n  <li class="menu-item">\n    <a class="quicklink" target="_blank" href="<%- editDisplayItemURL %>">View DisplayItem Admin</a>\n  </li>\n  <% } %>\n  <li class="menu-item">\n    <label><input type="checkbox" checked class="js-toggle-tiny-links">Show Edit Links</label>\n  </li>\n</ul>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!adminLinks/templates/tiny_link.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<a href="<%- url %>" target="_blank" class="admin-tiny-link js-admin-tiny-link <% if (!enabled) { %> disabled<% } %>" title="<%- title %>">\n  <i class="hb hb-pencil-square"></i>\n</a>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("adminLinks/main",["jquery","backbone","underscore","hbtemplate!./templates/quick_links.html","hbtemplate!./templates/tiny_link.html"],function(e,t,n,i,s){"use strict";var a={product:"/admin/Product/edit/",display_item:"/admin/DisplayItem/edit/",coupon:"/admin/CouponDefinition/edit/",subproduct:"/admin/SubProduct/edit/",tpkd:"/admin/ThirdPartyKeyDefinition/edit/",banner:"/admin/Banner/edit/",partner:"/admin/Partner/edit/"},r={quickLinks:n.template(i),tinyLink:n.template(s)},o=function(t){var i=e(".js-admin-quicklinks");i.length&&i.remove();var s=n.extend({editProductURL:"",editDisplayItemURL:""
},t);t.productMachineName&&(s.editProductURL=a.product+t.productMachineName),t.displayItemMachineName&&(s.editDisplayItemURL=a.display_item+t.displayItemMachineName),e("body").prepend(r.quickLinks(s))},l=function(t,i){var s=!i,o=e(".js-toggle-tiny-links").is(":checked");if(i=i||e(".js-admin-edit"),n.each(i,function(n){var i=e(n);if(!i.find(".js-admin-tiny-link").length){var s=i.data("entity-kind"),l=i.data("anchor-name")||"",c=i.data("machine-name")||"",u=i.data("link-position")||"";if(void 0!==s){switch(s){case"product":c=c||t.productMachineName;break;case"display_item":c=c||t.displayItemMachineName}if(c){var d=r.tinyLink({url:a[s]+c+l,title:"Edit "+s.charAt(0).toUpperCase()+s.slice(1)+" "+c,enabled:o});switch(u){case"after":i.after(d);break;case"append":i.append(d);break;case"before":default:i.before(d)}}}}}),!s){var l=e(".js-page-top-banner-link");if(l.length){var c=l.data("banner"),u=r.tinyLink({url:a.banner+c,title:"Edit Banner "+c,enabled:o});l.parent().find(".js-admin-tiny-link").remove(),l.before(u)}}e(".js-toggle-tiny-links").on("change",function(t){t.target.checked?e(".admin-tiny-link").removeClass("disabled"):e(".admin-tiny-link").addClass("disabled")})};return{renderMenu:o,renderTinyLinks:l}}),define("storefront/views/PermalinkView",["lib/jquery/full","underscore","backbone","util/main","util/templating","platformIcons/main","storefront/views/BaseView","storefront/views/MonthlyDiscountNotificationView","storefront/views/ProductView","storefront/views/ProductListView","storefront/ProductList","adminLinks/main"],function(e,t,n,i,s,a,r,o,l,c,u,d){"use strict";function h(){var e=i.getLocalStorage(),t=parseInt(e.getItem(p),10);if(isNaN(t))return 0;var n=new Date;return(n.getTime()-t)/31556952e3}var p="users-birthdate",_="js-details-",m={ADD_TO_CART:"Add to Cart",IN_CART:"Check Out",VIEW:"View"},g={ADD_TO_CART:"Get It Free!",IN_CART:"Check Out",VIEW:"View"},f=r.extend({tagName:"div",className:"storefront-alert",initialize:function(e){r.prototype.initialize.call(this,e),this.options=e,this.alert=e.alert,this.templateId="product-alert"},render:function(){var e={title:this.alert.title,text:this.alert.text,icon:this.alert.icon,color:this.alert.color};return this.$el.html(r.prototype.render_template_id.call(this,this.templateId,e)),this}}),v=r.extend({initialize:function(e){r.prototype.initialize.call(this,e),this.options=e,this.alerts=e.alerts,this.current_country=e.current_country},render:function(){for(var e=0;e<this.alerts.length;e++){var t=this.alerts[e];if(!t.territories||-1!==t.territories.indexOf(this.current_country.toUpperCase())){var n=new f({constants:this.constants,model:this.model,alert:t});this.$el.append(n.render().$el.html())}}return this}}),b=l.extend({tagName:"div",className:"product-details",carousel_animation_speed:800,initialize:function(e){l.prototype.initialize.call(this,e),this.wishlistView.templateId="wishlist-button",this.wishlist=e.wishlist,this.last_received_request_id=0,this.last_sent_request_id=0,this.partner_vars=e.partner_vars,this.should_show_monthly_promo=e.should_show_monthly_promo,this.userModel=e.userModel,this.model.has_details()?this.templateId="storefront-product-details":this.templateId="storefront-product-details-no-details",this.monthlyDiscountNotificationView=new o({constants:this.constants,monthly_is_paused:e.monthly_is_paused}),t.bindAll(this,"render","finish_loading","place_reccomendations","get_string","show_territory_gate","show_age_gate","handle_age_response","toggle_sibling","update_purchase_button_text"),this.listenTo(this.shopping_cart.collection,"collectionModified",this.update_purchase_button_text)},events:t.extend(l.prototype.events,{"click .js-expand-hide-next":"toggle_sibling","click .js-age-response":"handle_age_response","click .js-show-demo":"show_demo","click .js-show-trailer":"show_trailer","click .js-carousel-button":"move_carousel","click .js-carousel-arrow":"move_carousel"}),update_purchase_button_text:function(){var e=this.$(".js-action-button");this.shopping_cart&&this.shopping_cart.is_in_cart(this.model.get_machine_name())?(e.removeClass("has-cart green"),e.addClass("in-cart blue")):(e.addClass("has-cart green"),e.removeClass("in-cart blue"))},show_territory_gate:function(){var e=this.$(".js-controlled-content");e.length>0&&this.$(".js-controlled-content").append(r.prototype.render_template_id.call(this,"storefront-details-territory-gate"))},show_age_gate:function(){var e=this.$(".js-controlled-content");e.length>0&&this.$(".js-controlled-content").append(r.prototype.render_template_id.call(this,"storefront-details-age-gate"))},handle_age_response:function(e){var t=h();if(t<this.model.get_minimum_age()){var n=this.$el.find(".js-age-year").val(),s=this.$el.find(".js-age-month").val(),a=new Date(parseInt(n),parseInt(s));try{var r=i.getLocalStorage();r.setItem(p,a.getTime())}catch(e){console&&console.log(e)}t=h()}t>=this.model.get_minimum_age()?this.$(".js-age-gate").fadeOut():(this.$(".age-gate .age-prompt").fadeOut(),this.$(".age-gate .age-message").fadeIn())},toggle_sibling:function(t){t.preventDefault();var n=this.$(t.currentTarget).siblings(".js-to-toggle"),i=e(t.currentTarget).find("i"),s=function(){i.toggleClass("hb-caret-right hb-caret-down")};n.is(":visible")?n.slideToggle(s):(s(),n.slideToggle())},show_demo:function(e){this.$(".js-show-demo").addClass("media-selection-item-selected"),this.$(".js-show-demo").addClass("js-show-demo-selected"),this.$(".js-show-trailer").removeClass("media-selection-item-selected"),this.$(".js-show-trailer").removeClass("js-show-trailer-selected"),this.$(".js-asm-demo").addClass("asm-demo-selected"),this.$(".js-youtube-trailer").removeClass("youtube-trailer-selected"),this.$(".js-show-demo").addClass("media-selection-arrow"),this.$(".js-show-trailer").removeClass("media-selection-arrow");var t=this.$("#asm-demo")[0];t.contentWindow.postMessage(JSON.stringify({action:"wakeUp"}),"*"),this.youtubeIframe=this.$(".js-youtube-embed")[0].contentWindow,this.youtubeIframe.postMessage('{"event":"command", "func":"pauseVideo"}',"*")},show_trailer:function(e){this.$(".js-show-demo").removeClass("media-selection-item-selected"),this.$(".js-show-demo").removeClass("js-show-demo-selected"),this.$(".js-show-trailer").addClass("media-selection-item-selected"),this.$(".js-show-trailer").addClass("js-show-trailer-selected"),this.$(".js-asm-demo").removeClass("asm-demo-selected"),this.$(".js-youtube-trailer").addClass("youtube-trailer-selected"),this.$(".js-show-demo").removeClass("media-selection-arrow"),this.$(".js-show-trailer").addClass("media-selection-arrow");var t=this.$("#asm-demo")[0];t.contentWindow.postMessage(JSON.stringify({action:"goToSleep"}),"*")},move_carousel:function(t){var n=parseInt(this.$(t.currentTarget).data("carousel")),i=this.$(".js-carousel-item").length;n=0>n?n+i:n%i,this.$(".carousel-content").stop(!0).animate({left:-100*n+"%"},this.carousel_animation_speed),this.$(".js-youtube-embed").each(function(){this.contentWindow.postMessage('{"event":"command", "func":"pauseVideo"}',"*")}),this.$(".carousel-button.selected").removeClass("selected"),e(this.$(".js-carousel-button")[n]).addClass("selected"),this.$("#js-prev-carousel").data("carousel",n-1),this.$("#js-next-carousel").data("carousel",n+1)},render:function(){var n=this,s=this.model.get("partner_analytics_id");""!==s&&(ga("create",s,"auto",s),ga(s+".send","pageview")),this.$el.addClass(_+this.model.get("machine_name"));var o=this.model.toJSON();o.usd_postfix="us"!==this.current_country,o.get_string=this.get_string,o.can_be_purchased=void 0!==this.model.get("current_price"),o.display_as_free=this.model.display_as_free(),o.territory_allowed=this.model.is_territory_allowed(this.current_country),o.on_sale=Boolean(this.model.get("sale_end")),o.permalink=this.permalink(),o.is_logged_in=this.is_logged_in,o.display_timer=l.should_display_timer(this.model.get("sale_end")),o.render_platform_icons=a.render_platform_icons,o.render_operating_system_icons=a.render_operating_system_icons,o.base_url_secure=this.constants.BASE_URL_SECURE,o.asm_demo_machine_name=o.asm_demo_machine_name?o.asm_demo_machine_name:void 0,o.availability="http://schema.org/InStock",o.partner_vars=this.model.get("has_partner_split")?this.partner_vars:{},"preorder"===this.model.get("cta_badge")&&(o.availability="http://schema.org/PreOrder"),this.model.get("rating_details")&&(o.rating_details=this.model.get("rating_details").replace(/, ?/g,"<br>")),o.icon_dict||(o.icon_dict={});var c=this.userModel&&this.userModel.get("abTestBuckets"),u=this.model.get_current_price_as_big(),p=window.models.user_json&&t.contains(window.models.user_json.active_subscriptions,"humble_monthly"),m=u&&p&&!this.options.monthly_is_paused&&c&&"apply_monthly_discount"==c.priceDisplayType&&-1==this.model.get("incompatible_features").indexOf("coupons")&&-1==this.model.get("incompatible_features").indexOf("subscriber-discount-coupons");if(o.priceAfterMonthlyDiscount=null,m){var g=u.times(new Big(.1));o.priceAfterMonthlyDiscount=i.round_big_to_money_amount(u.minus(g))}if(this.$el.html(r.prototype.render_template_id.call(this,this.templateId,o)),this.$el.find(".wishlist-holder").append(this.wishlistView.render().$el),-1==this.model.get("incompatible_features").indexOf("subscriber-discount-coupons")&&this.$el.find(".monthly-notification-holder").append(this.monthlyDiscountNotificationView.render().$el),this.model.is_territory_allowed(this.current_country)){var f=this.model.get_minimum_age();h()<f&&this.show_age_gate()}else this.show_territory_gate();var b=this.model.get_storefront_alerts();if(e.isEmptyObject(b))this.$(".product-alerts").hide();else{var y=new v({constants:this.constants,model:this.model,alerts:b,current_country:this.current_country}),w=y.render().$el.html();this.$(".product-alerts").html(w)}if(this.constants.ADMIN_LINKS_ENABLED){var C={productMachineName:n.model.get("machine_name"),displayItemMachineName:n.model.get("display_item_machine_name")};d.renderMenu(C),d.renderTinyLinks(C,this.$(".js-admin-edit"))}return this.start_sale_timer(),this.update_purchase_button_text(),"xcom_ufodefense_freegame"===this.model.get("machine_name")&&this.render_custom_free_game_hacks(),this.should_show_monthly_promo&&this.render_custom_monthly_promo_hacks(this.model),this.el},finish_loading:function(){function t(i){e.ajax({type:"GET",url:n.constants.STORE_ROOT+"/api/recommend",data:{recommendation_attempt:++n.last_sent_request_id,machine_name:n.model.get_machine_name()},error:function(){i>0&&t(i-1)},success:function(e){e.recommendation_attempt>n.last_received_request_id&&(n.last_received_request_id=e.recommendation_attempt,n.place_reccomendations(e.result))}})}var n=this;t(4),this.$(".js-carousel-item").find(".js-lazy-load").each(function(t,n){e(n).removeClass("js-lazy-load"),e(n).attr("src",e(n).data("original"))})},place_reccomendations:function(t){if(t.length>0){var n=t[0].hmb_tracking;this.recommendation_list=new u(t.splice(0,3)),this.recommendation_grid=new c({grid_options:{layout_type:"recommendation"},featured_products:this.recommendation_list,collection:this.recommendation_list,constants:this.constants,render_as_grid:!0,shopping_cart:this.shopping_cart,current_country:this.current_country,details_is_link:!1,wishlist:this.wishlist,is_logged_in:this.is_logged_in,monthly_is_paused:this.options.monthly_is_paused,el:e(".js-recommended-products")}),e(".js-recommendation-title").text(n.rec_name),this.recommendation_grid.render_products(),this.$(".js-product-recommendations").show()}},get_string:function(e){return this.model.display_as_free()?g[e]:m[e]},render_custom_monthly_promo_hacks:function(e){var t="https://humblebundle-a.akamaihd.net/misc/files/hashed/e061c9720b0208a8de7cfdcd7b2157605a509309.jpg",n="xcom_store_details_cross2017",a="XCOM®2 (MSRP: $59.99)";"totalwar_warhammer_storefront"==e.get("machine_name")&&(t="https://humblebundle-a.akamaihd.net/misc/files/hashed/67b1809af5232db1992b62cf75a57324724b025a.jpg",n="warhammer_store_details_cross2017",a="Total War: Warhammer");var r=s.renderTemplateId("custom-monthly-promo-banner",{banner_url:t,campaign:n,unlock_description:a});this.$(".custom-visuals-banner").html(r),i.async_js("//platform.twitter.com/widgets.js"),"undefined"!=typeof FB&&FB.init&&FB.init({appId:"101146256651042",status:!0,cookie:!0,xfbml:!0})},render_custom_free_game_hacks:function(){var e=s.renderTemplateId("custom_free_game_banner",{human_name:this.model.get("human_name"),human_url:this.model.get("human_url"),background_url:"https://humblebundle-a.akamaihd.net/misc/files/hashed/5d77bc599855e6d1e4a403d2876a569966160067.jpg",banner_url:"https://humblebundle-a.akamaihd.net/misc/files/hashed/c5d2ae1aa94340208d4c5b0a9ff4295305bf4349.jpg",support_article_url:"https://support.humblebundle.com/hc/en-us/articles/115000997168-Free-Game-Redemption-Instructions",upsell_asset_url:""});this.$(".custom-visuals-banner").html(e),i.async_js("//platform.twitter.com/widgets.js"),"undefined"!=typeof FB&&FB.init&&FB.init({appId:"101146256651042",status:!0,cookie:!0,xfbml:!0}),this.initialize_custom_free_game_timer(new Date("February 1 2017 10:00:00 GMT-0800"))},initialize_custom_free_game_timer:function(t){function n(e){var t=Date.parse(e)-Date.parse(new Date),n=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60%60),s=Math.floor(t/36e5%24),a=Math.floor(t/864e5);return{days:Math.max(0,a),hours:Math.max(0,s),minutes:Math.max(0,i),seconds:Math.max(0,n)}}function i(){var i=n(t);e(".custom-free-game-timer-days").text(("0"+i.days).slice(-2)),e(".custom-free-game-timer-hours").text(("0"+i.hours).slice(-2)),e(".custom-free-game-timer-mins").text(("0"+i.minutes).slice(-2)),e(".custom-free-game-timer-secs").text(("0"+i.seconds).slice(-2))}this.$(".custom-free-game-holder")&&(i(),setInterval(i,500))}});return b}),define("storefront/views/ProductSearchView",["lib/jquery/full","underscore","backbone","util/main","storefront/common","storefront/views/BaseView","storefront/views/ProductView","storefront/views/ProductListView"],function(e,t,n,i,s,a,r,o){"use strict";function l(e){return e.replace(/[^a-zA-Z0-9 ]/g,"").toLowerCase()}function c(e,t){for(var n=t.split(" "),i=0;i<e.length;i++){for(var s=!1,a=0;a<n.length;a++)if(-1!==n[a].indexOf(e[i])){s=!0;break}if(!s)return!1}return!0}function u(e,t){return e=e||"",c(e.split(" "),t)}var d=a.extend({tagName:"div",className:"storefront-list-product empty-product",initialize:function(e){a.prototype.initialize.call(this,e),this.templateId="storefront-list-empty-product",t.bindAll(this,"render")},render:function(){return this.$el.html(a.prototype.render_template_id.call(this,this.templateId,{})),this}}),h=o.extend({initialize:function(n){o.prototype.initialize.call(this,n),this.options=n,t.bindAll(this,"handle_results_from_server","ga_track_search_input","ga_track_search_navigation","handle_search_input","handle_search_focus","handle_search_unfocus","minisearch_dropdown_display","update_search","refresh","internal_refresh","get_search_params","set_search_params","build_analytics_url","build_search_url","get_search_string","get_sort_name","get_selected_drm","get_selected_platform","go_to_search_page","handle_mini_search_keydown","cancel_search"),this.DEFAULT_SORT="bestselling",this.DEFAULT_PAGE_SIZE=20,this.MAX_PAGE_BUTTONS_TO_SHOW=11,this.searchInputEvent=null,this.genres=this.options.genres,this.search_active=!1,this.saved_sort_method=null,this.saved_platform=null,this.last_sent_request_id=0,this.last_received_request_id=-1,this.last_received_num_results=0,this.last_received_search_string=null,this.page_size=this.options.page_size||this.DEFAULT_PAGE_SIZE,this.current_page=0,this.num_pages=0,this.num_results=0,this.$page_links=e("<div></div>").addClass("page-links"),this.$search_link=e("<a>All Results</a>").addClass("js-search-link search-link"),this.wishlist=this.options.wishlist,this.is_logged_in=this.options.is_logged_in,this.monthly_is_paused=this.options.monthly_is_paused,this.$(".js-search-results-holder").append(a.prototype.render_template_id.call(this,"storefront-loading-products")),this.$loading_products=this.$(".js-loading-products"),this.$search_spinner=this.$(".js-search-spinner"),this.$(".js-search-results-holder").append(a.prototype.render_template_id.call(this,"storefront-search-results-holder")),this.$search_results_holder=this.$(".js-search-results"),this.highlighted_url="",this.mini_search_highlighted_index=-1;var i=new d({constants:this.constants});if(this.$empty_product_view=i.render().$el,this.rendered_views={},this.options.mini){var s=a.prototype.render_template_id.call(this,"storefront-search-bar",{});this.$(".js-searchbar-holder").html(s)}},events:t.extend(o.prototype.events,{"input .js-search":"handle_search_input","focus .js-search":"handle_search_focus","click .js-search":"handle_search_focus","keydown .js-search":"handle_mini_search_keydown","click .js-search-link":"go_to_search_page","click .js-search-results-holder":"handle_results_click"}),get_search_params:function(){function e(e){return e&&"all"!==e?e:void 0}var n={search:l(this.$(".js-search").val()||""),sort:this.sort||this.DEFAULT_SORT,drm:e(this.drm),genre:e(this.genre),page:this.current_page,platform:e(this.platform),publisher:e(this.publisher),developer:e(this.developer)};return t.each(n,function(e,t){(void 0===e||""===e)&&delete n[t]}),n},set_search_params:function(e){var n=this;if(this.search_active=!1,t.each(e,function(e,t){switch(t){case"search":if(e){var i=a.prototype.render_template_id.call(n,"storefront-search-bar",{});n.$(".js-searchbar-holder").html(i),n.$(".js-search").val(e),n.search_active=!0}else n.$(".js-searchbar-holder").empty();break;case"sort":n.sort=e||n.DEFAULT_SORT;break;case"drm":case"genre":case"platform":e&&("all"!=e?(n[t]=e,n.search_active=!0):n[t]=null);break;case"page":n.current_page=e;break;case"developer":n.developer=e;break;case"publisher":n.publisher=e}}),!e.search){var i=a.prototype.render_template_id.call(this,"storefront-filter-controls",{sorts:this.constants.SEARCH_PARAMS.sort,platforms:this.constants.SEARCH_PARAMS.platform,drms:this.constants.SEARCH_PARAMS.drm,sort:this.sort,platform:this.platform,drm:this.drm,genre:this.genre,genres:this.genres,build_search_url:function(e,t){var i=t?t.concat(["page"]):["page"];return n.build_search_url(e,i)}});if(e.developer||e.publisher){var s="";s=e.developer?"Developed by "+e.developer:"Published by "+e.publisher,this.$(".js-searchbar-holder").html(a.prototype.render_template_id.call(this,"storefront-dev-pub-text",{title_string:s}))}else this.$(".js-searchbar-holder").html(i)}},build_analytics_url:function(){var e="/search?",n=this.get_search_params();return t.each(this.constants.SEARCH_PARAM_ORDER,function(t){t in n&&(e+=t+"="+n[t]+"&")}),e.replace(/&$/,"")},build_search_url:function(e,n){var i=this.get_search_params(),s=t.clone(i);e&&t.each(e,function(e,t){s[t]=e}),n&&t.each(n,function(e){delete s[e]});var a="/search";return t.each(this.constants.SEARCH_PARAM_ORDER,function(e){e in s&&(a+="/"+e+"/"+s[e])}),a},get_sort_name:function(){return this.get_search_params().sort},get_search_string:function(){return this.get_search_params().search},get_selected_drm:function(){return this.get_search_params().drm},get_selected_platform:function(){return this.get_search_params().platform},refresh:function(){this.num_results=0,this.last_received_request_id=this.last_sent_request_id,this.internal_refresh()},internal_refresh:function(){function n(t){e.ajax({type:"GET",url:s.constants.STORE_ROOT+"/api",data:i,dataType:"json",error:function(){0===t?(s.trigger("loading:error"),s.$(".js-products-loading").hide(),s.$(".js-products-loading-failed").show()):n(t-1)},success:function(e){var t=parseInt(e.request);t>s.last_received_request_id&&(s.trigger("loading:success"),s.last_received_request_id=t,s.handle_results_from_server(e),s.ga_track_search_navigation(s.build_analytics_url()))}})}this.$search_results_holder.is(":visible")&&this.skip_loading_state||(this.$loading_products.show(),this.$search_results_holder.hide()),this.$search_spinner.show(),this.skip_loading_state=!1,this.last_sent_request_id+=1;var i={request:this.last_sent_request_id,page_size:this.page_size};t.extend(i,this.get_search_params());var s=this;this.trigger("loading");var a=5;n(a)},handle_results_from_server:function(t){var n=this;this.collection.add(t.results.filter(function(e){return void 0===n.collection.get(e.machine_name)})),this.num_results=Math.max(this.num_results,t.num_results),this.num_pages=Math.ceil(this.num_results/this.page_size),this.last_received_num_results=t.results.length,t.search?this.last_received_search_string=t.search:this.last_received_search_string=null,this.$page_links.remove(),this.$page_links.empty(),this.$search_results_holder.children().detach();for(var i=0;i<t.results.length;i++){var s=t.results[i].machine_name,a=this.collection.get(s),o=this.rendered_views[s];if(void 0===o){var l=new r({constants:this.constants,shopping_cart:this.shopping_cart,current_country:this.current_country,model:a,render_as_grid:!1,wishlist:this.wishlist,is_logged_in:this.is_logged_in,monthly_is_paused:this.monthly_is_paused,className:"storefront-list-product",attributes:{"data-product":s}});o=l.render().$el,this.rendered_views[s]=o}a.is_territory_allowed(this.current_country)&&this.$search_results_holder.append(o)}t.results.length?(this.$search_link.text("All Results ("+this.num_results+")"),this.$search_results_holder.append(this.$search_link)):(this.$search_results_holder.prepend(this.$empty_product_view),this.$search_link.detach());var c=this.constants.STORE_ROOT;if(this.num_pages>1){var u=function(t,i){var s=e('<a href="'+c+n.build_search_url({page:t},[])+'" class="js-internal-store-link page-link">'+(t+1)+"</a>");return i&&s.addClass("current-page"),s},d=e('<a href="'+c+this.build_search_url({page:this.current_page-1},[])+'" class="js-internal-store-link page-link">Previous</a>');0===this.current_page&&d.addClass("disabled"),this.$page_links.append(d);var h={min:this.current_page-Math.floor(this.MAX_PAGE_BUTTONS_TO_SHOW/2),max:this.current_page+Math.floor(this.MAX_PAGE_BUTTONS_TO_SHOW/2)};h.max>this.num_pages&&(h.min+=this.num_pages-h.max-1,h.max=this.num_pages),h.min<0&&(h.max-=h.min,h.min=0),2==h.min&&(h.min=1),h.max==this.num_pages-3&&(h.max=this.num_pages-2);for(var p=0;p<this.num_pages;p++)if(this.num_pages<=this.MAX_PAGE_BUTTONS_TO_SHOW)this.$page_links.append(u.call(this,p,this.current_page===p));else if((0===p||p===this.num_pages-1||p>=h.min&&p<=h.max)&&this.$page_links.append(u.call(this,p,this.current_page===p)),0===p&&h.min>2||p===this.num_pages-2&&h.max<this.num_pages-3){var _=e("<span>...</span>");this.$page_links.append(_)}var m=e('<a href="'+c+this.build_search_url({page:this.current_page+1},[])+'" class="js-internal-store-link page-link">Next</a>');this.current_page>=this.num_pages-1&&m.addClass("disabled"),this.$page_links.append(m),this.$search_results_holder.append(this.$page_links)}this.$loading_products.hide(),this.$search_spinner.hide(),this.$search_results_holder.show()},ga_track_search_input:function(e){clearTimeout(this.ga_input),this.ga_input=setTimeout(function(){var t="/search?search="+e;_gaTrackPageview(t)},1e3)},ga_track_search_navigation:function(e){clearTimeout(this.ga_navigation),this.ga_navigation=setTimeout(function(){_gaTrackPageview(e)},1e3)},handle_search_input:function(){var e=this,t=this.get_search_string()||"";if(0==t.indexOf(this.previous_search_string)?this.skip_loading_state=!0:this.skip_loading_state=!1,this.previous_search_string=t,""!==t&&this.ga_track_search_input(t),this.minisearch_dropdown_display(),this.search_active&&0===this.current_page&&this.num_pages<=1&&this.last_received_num_results<this.page_size&&this.last_received_search_string&&t&&u(this.last_received_search_string,t)){this.last_received_request_id=this.last_sent_request_id;var n=t.split(" "),i=0;this.collection.each(function(t){var s=e.rendered_views[t.get_machine_name()];if(void 0!==s&&s.parent().length>0){var a=c(n,l(t.get_human_name()));s.toggle(a),a&&i++}},this),i>0?(this.$empty_product_view.detach(),this.$search_link.text("All Results ("+i+")"),this.$search_results_holder.append(this.$search_link),this.highlight_record(-1)):(this.$search_results_holder.prepend(this.$empty_product_view),this.$search_link.detach()),this.$loading_products.hide(),this.$search_results_holder.show()}else clearTimeout(this.searchInputEvent),this.searchInputEvent=setTimeout(function(){e.update_search()},250)},handle_search_unfocus:function(){this.options.mini&&(this.$(".js-search-results-holder").hide(),this.$search_spinner.hide())},handle_search_focus:function(t){if(t.stopPropagation(),this.options.mini){var n=this;e("body").one("click",function(e){n.handle_search_unfocus()}),this.minisearch_dropdown_display()}},minisearch_dropdown_display:function(){if(this.options.mini){var e=this.get_search_string();if(void 0===e)return this.handle_search_unfocus(),void this.cancel_search();this.$(".js-search-results-holder").show(),this.highlight_record(-1);var t=s.add_link_prefix("/search/search/"+(e||""),this.constants);this.$search_link.attr("href",t)}},handle_results_click:function(){this.handle_search_unfocus()},go_to_search_page:function(e){var t=this.$search_link.attr("href");s.navigate(e,t,!1,this.constants,{trigger:!0})},highlight_record:function(t){if(0>t)e(".storefront-list-product").removeClass("user-selected"),this.mini_search_highlighted_index=-1,this.highlighted_url="";else if(t<this.$(".storefront-list-product:visible").length){var n=this.$(".storefront-list-product:visible")[t];e(".storefront-list-product").removeClass("user-selected"),e(n).addClass("user-selected"),this.mini_search_highlighted_index=t,this.highlighted_url=this.collection.get(e(".user-selected").data("product")).get_path()}},handle_mini_search_keydown:function(e){if(this.options.mini)if(13===e.keyCode)if(this.highlighted_url)s.navigate(e,this.highlighted_url,!1,this.constants,{trigger:!0});else if(1===this.$(".storefront-list-product:visible").length){var t=this.$(".storefront-list-product:visible").data("product"),n=this.collection.get(t).get_path();s.navigate(e,n,!1,this.constants,{trigger:!0})}else this.handle_search_unfocus(),this.go_to_search_page(e);else 38===e.keyCode?this.highlight_record(this.mini_search_highlighted_index-1):40===e.keyCode&&this.highlight_record(this.mini_search_highlighted_index+1)},update_search:function(){var e=this.get_search_string();""===e?this.search_active&&(this.cancel_search(),this.refresh()):(this.search_active||(this.search_active=!0,this.saved_sort_method=this.get_sort_name(),this.$("#srb-"+this.saved_sort_method).removeAttr("checked"),this.saved_platform=this.get_selected_platform(),this.$("#prb-"+this.saved_platform).removeAttr("checked"),this.saved_drm=this.get_selected_drm(),this.$("#drb-"+this.saved_drm).removeAttr("checked")),this.refresh())},cancel_search:function(e){this.$(".js-search").val(""),this.search_active=!1}});return h}),define("lib/hbTemplate!storefrontv2/templates/searchViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="product-search-container">\n  <div class="js-search-view search-view searchbar">\n    <div class="js-searchbar-holder searchbar-holder"></div>\n    <div class="js-search-results-holder search-results-holder"></div>\n  </div>\n</script>'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/SearchView",["require","jquery","storefrontv2/views/BaseView","storefront/views/ProductSearchView","hbtemplate!storefrontv2/templates/searchViewTemplates.html","util/templating"],function(e){"use strict";var t=e("jquery"),n=e("storefrontv2/views/BaseView"),i=e("storefront/views/ProductSearchView"),s=e("hbtemplate!storefrontv2/templates/searchViewTemplates.html"),a=e("util/templating");return t("body").append(s),n.extend({initialize:function(e){n.prototype.initialize.call(this,e),this.options=e,this.on("search",this.search)},loadSubViews:function(){this.productSearchView=new i(t.extend(this.options,{el:this.$(".js-search-view")})),this.listenTo(this.productSearchView,"loading",function(){this.trigger("loading")}),this.listenTo(this.productSearchView,"loading:error",function(){this.trigger("loading:error")}),this.listenTo(this.productSearchView,"loading:success",function(){this.trigger("loading:success")})},render:function(){return this.$el.html(a.renderTemplateId("product-search-container")),this},search:function(e){this.productSearchView.set_search_params(e),this.productSearchView.refresh()}})}),define("storefront/shoppingCart",["lib/jquery/full","backbone","lib/big","util/templating","util/main","coupon/coupon","storefront/views/BaseView","platformIcons/main","storefront/models/Product"],function(e,t,n,i,s,a,r,o,l){"use strict";var c=t.View.extend({initialize:function(e){this.coupons=e.coupons,this.shoppingCart=e.shopping_cart,this.pubSub=e.pubSub,this.selectedCoupons=[],this.upsellCoupons=[],this.discount=0,this.loaded=!1,this.current=!1,this.rendered=!1,this.rendered_content=!1,this.parent=e.parent,this.coupons.on("fetchAutoAddProducts:success",this.auto_add_coupon_products,this).on("fetchAutoAddProductBatch:complete",this.apply_qualifying_autogen_coupons,this).on("sync",function(){this.current=!1,this.parent.trigger("couponsSynced")},this)},events:{"change #shopping-cart-coupon":"select_coupon","click .js-remove-coupon":"remove_coupon"},apply_selected_coupons:function(){var e,t=null,i=null,s=!1,a=!1,r=null,o=this,l=[];if(o.selectedCoupons.length)for(var c=0;c<o.selectedCoupons.length;c++)if(e=o.selectedCoupons[c],e.provides_savings(o.shoppingCart)){if("humble_monthly_10"!=e.get("coupon_definition")){if(null===r)r=e.stacks_with_sales();else if(e.stacks_with_sales()!=r){l=l.concat(o.selectedCoupons.splice(c,1)),c--;continue}if(null===i)i=e.stacks_with_coupons();else if(!i&&!e.is_auto_generated()||s&&!e.stacks_with_coupons()){l=l.concat(o.selectedCoupons.splice(c,1)),c--;continue}if(null===t)t=e.stacks_with_auto_coupons();else if(!t&&e.is_auto_generated()||a&&!e.stacks_with_auto_coupons()){l=l.concat(o.selectedCoupons.splice(c,1)),c--;continue}}e.is_auto_generated()?a=!0:s=!0}else l=l.concat(o.selectedCoupons.splice(c,1)),c--;if(o.shoppingCart.forEach(function(e){e.set({use_full_price:!1},{silent:!0}),o.selectedCoupons.forEach(function(t){t.apply_to_full_price(e,o.shoppingCart)&&e.set({use_full_price:!0},{silent:!0})})}),o.selectedCoupons.length){for(var c=0;c<o.selectedCoupons.length;c++)e=o.selectedCoupons[c],e.apply_coupon(o.shoppingCart);o.discount=o.get_discount(),o.discount.eq(0)&&(o.selectedCoupons=[])}else o.discount=n(0);o.removedCoupons=l,o.coupons.forEach(function(e){var t=e.is_valid(o.shoppingCart,o.selectedCoupons),n=e.can_generate(o.shoppingCart),i=e.can_redeem(o.shoppingCart);e.set("valid",t),e.set("relevant",(!e.is_auto_generated()||n)&&i)},this),o.render(),o.parent.display_captcha(),o.publish_coupons()},auto_add_coupon_products:function(e,t){var n=[],i=this;t&&(_.each(t,function(e){i.parent.is_in_cart(e.machine_name)||n.push(new l(e))}),n.length&&i.shoppingCart.add_items(n,!0))},invalidate_dynamic_coupons:function(){this.current=!1},update_coupon_products:function(e,t){var n=_.difference(t,e.cart_products);if(!(n.length>0)){var i=this;_.each(e.coupon_products,function(e,t){var n=i.coupons.findWhere({coupon_definition:t});n.set("coupon_generation_products",e.generation_products),n.set("coupon_valid_products",e.redemption_products)}),this.current=!0,this.calculate_coupon_discounts(),this.pubSub.publish("syncing_coupon_products",{done:!0})}},dynamic_coupon_machine_names:function(){var e=[];return this.coupons.each(function(t){t.get("coupon_is_dynamic")&&e.push(t.get("coupon_definition"))}),e},select_coupon:function(e){var t=this.$el.find("#shopping-cart-coupon").find(":selected"),n=t.val(),i=t.data("auto-generated");this.add_coupon(n,i,!0)},add_coupon:function(e,t,n){this.$el.find("#shopping-cart-coupon").val(null);var i=t?"coupon_definition":"coupon_key";this.coupons.forEach(function(t){
t.get(i)===e&&t.get("valid")===!0&&(this.selectedCoupons.push(t),n===!0&&t.set("manually_selected",!0))},this),this.calculate_coupon_discounts()},remove_coupon:function(e){if(e){e.preventDefault();for(var t=$(e.currentTarget),n=t.data("coupon-id"),i=t.data("auto-generated"),s=i?"coupon_definition":"coupon_key",a=0;a<this.selectedCoupons.length;a++)if(this.selectedCoupons[a].get(s)==n){this.selectedCoupons.splice(a,1);break}}else this.selectedCoupons.pop();0===this.selectedCoupons.length&&this.shoppingCart.forEach(function(e){e.set({use_full_price:!1},{silent:!0})}),this.calculate_coupon_discounts()},get_discount:function(){var e=n(0);return _.each(this.selectedCoupons,function(t){e=e.plus(t.get_applied_discount())}),e},get_total:function(){return this.shoppingCart.get_total()[0]},get_currency:function(){return this.shoppingCart.get_total()[1]},apply_qualifying_autogen_coupons:function(){var e=this;this.upsellCoupons=[],this.selectedCoupons=_.filter(this.selectedCoupons,function(e){return e.is_auto_generated()===!1||e.get("manually_selected")&&e.get("relevant")}),this.update_coupon_validity(),this.coupons.forEach(function(t){var n=t.get("coupon_definition"),i=t.can_generate(e.shoppingCart),s=t.can_redeem(e.shoppingCart),a=t.get("valid"),r=e.coupons.some(function(e){return t!=e&&e.get("relevant")&&!e.is_auto_generated()})&&"humble_monthly_10"!=n;i&&s&&a&&!r?e.selectedCoupons.unshift(t):t.can_upsell(e.shoppingCart)&&e.upsellCoupons.push(t),i&&t.set("alt_available",r)});var t=_.find(e.selectedCoupons,function(e){return"humble_monthly_10"==e.get("coupon_definition")});t&&(e.selectedCoupons=_.difference(e.selectedCoupons,[t]),e.selectedCoupons.push(t)),e.apply_selected_coupons()},update_auto_add_products:function(){var e=!1,t=this;this.coupons.forEach(function(n){n.can_generate(t.shoppingCart)?n.get("auto_add_product_machine_names").length&&(e=!0,t.coupons.trigger("fetchAutoAddProducts",n)):t.shoppingCart.remove_matching_auto_add_machine_names(n.get("auto_add_product_machine_names"))}),e||t.apply_qualifying_autogen_coupons()},publish_coupons:function(){var e,t=this,n={active_coupons:{},upsell_coupons:{},product_names:{},qualifying_products_for_coupons:{},discount:[this.discount,this.get_currency()]};_.each(this.selectedCoupons,function(i){e=i.get("coupon_definition"),n.active_coupons[e]=i.get_applicable_product_machine_names(t.shoppingCart),n.qualifying_products_for_coupons[e]=i.get_matching_generation_products(t.shoppingCart)}),_.each(this.upsellCoupons,function(i){e=i.get("coupon_definition"),n.upsell_coupons[e]=i.get_applicable_product_machine_names(t.shoppingCart),n.qualifying_products_for_coupons[e]=i.get_matching_generation_products(t.shoppingCart)}),n.product_names=this.shoppingCart.reduce(function(e,t){return e[t.get("machine_name")]=t.get("human_name"),e},{}),this.pubSub.publish("active_coupons",n)},require_captcha_if_free:function(){return _.any(this.selectedCoupons,function(e){return e.get("coupon_require_captcha_if_free")})},calculate_coupon_discounts:function(){this.shoppingCart.forEach(function(e){e.set({coupons_applied:[]},{silent:!0})}),this.update_auto_add_products()},get_selected_coupon_keys:function(){for(var e=[],t=0;t<this.selectedCoupons.length;t++)this.selectedCoupons[t].is_auto_generated()||e.push(this.selectedCoupons[t].get("coupon_key"));return e},auto_generated_coupon_names:function(){for(var e=[],t=0;t<this.selectedCoupons.length;t++)this.selectedCoupons[t].is_auto_generated()&&e.push(this.selectedCoupons[t].get("coupon_definition"));return e},get_coupons:function(){this.loaded||(this.coupons.fetch({add:!0,remove:!1,merge:!0}),this.loaded=!0)},update_coupon_validity:function(){var e=this;this.coupons.forEach(function(t){var n=t.is_valid(e.shoppingCart,e.selectedCoupons),i=t.can_generate(e.shoppingCart)||!t.is_auto_generated(),s=t.can_redeem(e.shoppingCart);t.set("valid",n&&s&&i),t.set("relevant",s&&i)},this)},render:function(){var e=this,t=[],n=[];this.coupons&&(t=this.coupons.filter(function(t){return!_.contains(e.selectedCoupons,t)&&t.get("valid")&&t.get("relevant")}),n=this.coupons.filter(function(t){return!_.contains(e.selectedCoupons,t)&&t.get("relevant")}));var a=i.renderTemplateId("coupon-template",{coupons:this.coupons,selected_coupons:this.selectedCoupons,selectable_coupons:t,alt_coupons:n,upsell_coupons:this.upsellCoupons,discount:s.moneyfmt(this.discount),removed_coupons:this.removedCoupons}),r=$(a);this.$el.empty().append(r),this.rendered&&!this.rendered_content&&this.$el.css({height:0}).animate({height:r.height()+"px"},100,function(){e.$el.css({height:"auto"})}),this.rendered=!0,this.rendered_content=this.selectedCoupons.length>0||t.length>0||this.upsellCoupons.length>0}}),u=t.Model.extend({idAttribute:"machine_name",defaults:{price:["0","USD"],full_price:["0","USD"],current_price:["0","USD"],tax_exempt:!1,use_full_price:!1,machine_name:"",human_name:"",human_url:"",operating_systems:[],auto_added:!1,cyoc_split:0,keep_split:0,hide_pricing:!1,incompatible_features:[],icon_dict:{}},initialize:function(){this.set("cyoc_split",new n(this.get("cyoc_split"))),this.set("keep_split",new n(this.get("keep_split"))),_.bindAll(this,"get_current_price_as_big","get_full_price_as_big","get_human_price_after_coupon","get_human_full_price","is_discounted","get_price_as_big","price_equal_with","incompatible_with_coupon"),this.set("coupons_applied",[])},get_current_price_as_big:function(){var e=this.get_current_price();return[new n(e[0]),e[1]]},get_current_price:function(){return this.get("use_full_price")?this.get("full_price"):this.get("current_price")},get_full_price_as_big:function(){var e=this.get("full_price");return[new n(e[0]),e[1]]},get_price_after_coupon_as_big:function(){var e=this.get_current_price_as_big();return e[0]=e[0].minus(this.get_discount_amount()),e},get_discount_amount:function(){var e=new n(0);return _.each(this.get("coupons_applied"),function(t){e=e.plus(t.discount_amount)}),e?e:n(0)},get_cyoc_amount_as_big:function(){var e=this.get("cyoc_split"),t=this.get_current_price_as_big();return t[0]=t[0].times(e),_.each(this.get("coupons_applied"),function(n){var i=n.coupon.get("coupon_cyoc_split");null===i&&(i=e),t[0]=t[0].minus(n.discount_amount*i)}),t},get_keep_amount_as_big:function(){var e=this.get("keep_split"),t=this.get_current_price_as_big();return t[0]=t[0].times(e),_.each(this.get("coupons_applied"),function(n){var i=n.coupon.get("coupon_keep_split");null===i&&(i=e),t[0]=t[0].minus(n.discount_amount*i)}),t},add_coupon_discount:function(e,t){var n=this.get("coupons_applied");n.push({coupon:e,discount_amount:t})},get_human_price_after_coupon:function(e){return s.moneyfmt(this.get_price_after_coupon_as_big(),null,!1,e)},get_human_full_price:function(e){return s.moneyfmt(this.get_full_price_as_big(),null,!1,e)},get_price_as_big:function(){return new n(this.get("price"))},is_discounted:function(){var e=this.get_full_price_as_big(),t=this.get_price_after_coupon_as_big();return t[0].toFixed(2)!=e[0].toFixed(2)},price_equal_with:function(e){if(!e)return!1;var t=this.get_current_price(),n=e.get_current_price();if(2!=t.length||2!=n.length)return!1;for(var i in t)if(t[i]!=n[i])return!1;return!0},incompatible_with_coupon:function(e){return-1!=this.get("incompatible_features").indexOf("coupons")?!0:-1!=this.get("incompatible_features").indexOf("subscriber-discount-coupons")?e.requires_subscription():!1},incompatible_with_spending_wallet_credit:function(){return-1!=this.get("incompatible_features").indexOf("spend-wallet-credit")},incompatible_with_earning_promotional_wallet_credit:function(){return-1!=this.get("incompatible_features").indexOf("earn-keep-credit")},can_participate_in_promotional_wallet_credit:function(){return!this.incompatible_with_earning_promotional_wallet_credit()}}),d=t.Collection.extend({idAttribute:"machine_name",model:u,initialize:function(e,t){this.constants=t.constants,this.tax_rate=n(0),this.last_sent_request_id=0,this.last_received_request_id=-1,this.xhrs={},_.isArray(e)&&e.length&&(this.currency=e[0].current_price[1]),_.bindAll(this,"item_machine_names","add_items","remove_item","post_to_cart","get_total","get_total_full_price"),this.on("addToCart",this.add_items).on("removeFromCart",this.remove_item).on("sync_products_and_prices",this.sync_products_and_prices,this).on("sync_products_and_prices",this.fetch_tax_rate)},item_machine_names:function(){return this.pluck("machine_name")},add_items:function(e,t){var n,i,s,a=[],r=this;for(i=0,s=e.length;s>i;i++){if(null==r.currency)r.currency=e[i].get_currency();else if(r.currency!=e[i].get_currency())return void show_flash(e[i].get("human_name")+" could not be added to your cart because other items in a different currency are currently in your cart.");n=r.create_cart_item(e[i],t),a.push(n),t||r.post_to_cart("addtocart",n)}r.add(a),a.length&&r.trigger("collectionModified")},create_cart_item:function(e,t){return new u({machine_name:e.get("machine_name"),human_name:e.get("human_name"),human_url:e.get("human_url"),price:e.get("price"),giftable:e.get("giftable"),full_price:e.get("full_price"),current_price:e.get("current_price"),operating_systems:e.get_platforms(),coupons_applied:[],wallet_reload:e.get("wallet_reload"),incompatible_features:e.get("incompatible_features"),tax_exempt:e.get("tax_exempt"),auto_added:t,cyoc_split:new n(e.get("cyoc_split")),keep_split:new n(e.get("keep_split")),hide_pricing:e.get("hide_pricing"),icon_dict:e.get("icon_dict")})},remove_item:function(e,t){this.remove(e),this.trigger("collectionModified"),t||this.post_to_cart("removefromcart",e)},remove_matching_auto_add_machine_names:function(e){var t,n=this;_.each(e,function(e){t=n.get(e),t&&t.get("auto_added")&&n.remove_item(e,!0)})},post_to_cart:function(e,t){$.ajax({url:"/store/addtocart",type:"post",data:{event_type:e,machine_name:t.get("machine_name"),human_name:t.get("human_name"),full_price:t.get("full_price")[0],currency_code:t.get_current_price()[1],current_price:t.get_current_price()[0],url:window.location.href}})},get_total:function(e){void 0===e&&(e=!0);var t=this.tax_rate,i=[new n(0),null];return this.forEach(function(n){var s=n.get_price_after_coupon_as_big();e&&!n.get("tax_exempt")&&(s[0]=s[0].plus(s[0].times(t))),i[0]=i[0].plus(s[0]),i[1]?i[1]!=s[1]&&console.log("non-matching currencies!"):i[1]=s[1]}),e&&this.tax_rate.gt(0)&&(i[0]=i[0].round(2,1)),i},get_total_without_tax:function(){return this.get_total(!1)},get_wallet_eligible_total:function(){var e=this.tax_rate,t=new n(0);return this.forEach(function(n){var i=n.get_price_after_coupon_as_big();n.get("tax_exempt")||(i[0]=i[0].plus(i[0].times(e))),n.incompatible_with_spending_wallet_credit()||(t=t.plus(i[0]))}),t=t.round(2)},get_total_full_price:function(){var e=[new n(0),null];return this.forEach(function(t){var n=t.get_full_price_as_big();e[0]=e[0].plus(n[0]),e[1]?e[1]!=n[1]&&console.log("non-matching currencies!"):e[1]=n[1]}),e},get_cyoc_total:function(e){var t=[new n(0),this.currency],i=this.constants.HUMBLEKEEP_ENABLED;return this.forEach(function(n){var s=n.get_cyoc_amount_as_big();if(i&&e&&n.can_participate_in_promotional_wallet_credit()){var a=n.get_keep_amount_as_big();return void(s[0].gt(0)?t[0]=t[0].plus(s[0].minus(a[0])):t[0]=t[0].plus(s[0]))}t[1]!=s[1]&&console.log("non-matching currencies!"),t[0]=t[0].plus(s[0])}),t[0]=t[0].round(4,1).round(2,0),t},get_keep_total:function(e){var t=[new n(0),this.currency],i=this.constants.HUMBLEKEEP_ENABLED;return this.forEach(function(n){if(i&&e&&n.can_participate_in_promotional_wallet_credit()){var s=n.get_keep_amount_as_big();t[1]!=s[1]&&console.log("non-matching currencies!"),t[0]=t[0].plus(s[0])}}),t[0]=t[0].round(2,0),t},sync_products_and_prices:function(){if(!this.xhrs.sync_products_and_prices&&this.item_machine_names().length>0){var e=this,t=[];e.xhrs.sync_products_and_prices=$.ajax({url:e.constants.STORE_ROOT+"/api/lookup",data:{products:e.item_machine_names(),request:++e.last_sent_request_id}}).done(function(n){if(n.request>e.last_received_request_id){e.last_received_request_id=n.request;var i,s,a,r,o,l,c,u,d,h=[],p={},_=[],m=[];for(i=0,s=n.result.length;s>i;i++)d=n.result[i],p[d.machine_name]=d;e.forEach(function(e){return(d=p[e.get("machine_name")])?(a=d.current_price,u=a[0]-e.get("current_price")[0],r=d.cyoc_split,o=e.get("cyoc_split").minus(r),l=d.keep_split,c=e.get("keep_split").minus(l),void(0!=u?(_.push({machine_name:d.machine_name,price_change:u}),t.push(d)):a[1]==e.get("current_price")[1]&&o.eq(0)&&c.eq(0)||t.push(d))):(h.push(e),void m.push(e.get("human_name")))}),e.add(t,{merge:!0}),e.remove(h),(t.length||h.length)&&e.trigger("collectionModified"),e.trigger("sync_products_and_prices:complete",_,m)}}).fail(function(){e.trigger("sync_products_and_prices:complete")}).always(function(){delete e.xhrs.sync_products_and_prices})}},fetch_tax_rate:function(){if(!this.xhrs.fetch_tax_rate){var e=this.tax_rate,t=this;this.xhrs.fetch_tax_rate=$.ajax({url:"/api/v1/tax_rate"}).done(function(i){var s=n(i.tax_rate);s.eq(e)||(t.tax_rate=s,t.trigger("tax_rate:updated"))}).always(function(){delete t.xhrs.fetch_tax_rate})}}}),h=r.extend({defaults:{},initialize:function(t){var i=this;r.prototype.initialize.call(this,t),this.options=t,_.bindAll(this,"add_item","render","render_item","submit_form","hide_payment_processors","show_payment_processors","on_collection_changed","on_scroll","init_collection_event_handlers","render_charity","update_charity","update_active_coupons","select_charity","select_humblekeep","is_in_cart","size","update_total","save_to_localstorage","load_from_localstorage","show_email_message","hide_email_messages","live_email_check_callback","show_error_message","hide_error_message","show_cart_error","hide_cart_error","toggle_cart_collapsed","close_cart","toggle_collapsable","switch_payment_options","on_localstorage_modified","expand_payment_disclaimer"),this.LOCALSTORAGE_KEY="shopping-cart-humblebundle",this.PRODUCT_PRICE_PARAM_PREFIX="p-",this.usd_postfix="us"!==this.options.current_country,this.current_os="Windows",-1!=navigator.appVersion.indexOf("Mac")&&(this.current_os="Mac"),-1!=navigator.appVersion.indexOf("Linux")&&(this.current_os="Linux"),this.expanded=!1,this.iframe=this.options.iframe,this.force_email=this.options.force_email,this.stripe_pubkey=this.options.stripe_pubkey,this.coupons=this.options.coupons||new a.couponCollection([],{}),this.collection=new d(null,{constants:this.options.constants}),this.coupon_view=new c({parent:this,coupons:this.coupons,shopping_cart:this.collection,pubSub:this.options.pubSub}),this.featured_charities=this.options.featured_charities,this.current_charity=null,this.humblekeep_opt_in=this.options.humblekeep_opt_in,this.pubSub=this.options.pubSub,this.wallet_balance=new n(this.options.wallet_balance),this.wallet_currency=this.options.wallet_currency,this.pubSub.subscribe("charity_updated",this.update_charity),this.pubSub.subscribe("active_coupons",this.update_active_coupons),this.active_coupons={},this.upsell_coupons={},this.partner_vars=this.options.partner_vars,this.load_from_localstorage(),this.rendered=!1,this.render(),this.coupon_view.calculate_coupon_discounts(),this.coupon_view.render(),this.$el.find(".js-shopping-cart-coupon-holder").append(this.coupon_view.$el),this.$email_field=this.$el.find(".js-email"),bindEmailField(this.$email_field,this.live_email_check_callback),e(window).scroll(this.on_scroll).on("storage",this.on_localstorage_modified).on("focus",function(){i.rendered&&$(".shopping-cart-grayout").is(":visible")&&i.collection.trigger("sync_products_and_prices")}),this.collection.on("add",function(e){e.get("machine_name");this.hide_error_message("empty-cart",this.$(".js-product-error-holder"))},this).on("sync_products_and_prices:complete",this.product_and_price_sync_complete,this),this.on("couponsSynced",function(){i.sync_coupon_products()}),this.listenTo(this.collection,"tax_rate:updated",this.render),"error-store-price-changed"==e.cookie("hbstatus")&&(e.removeCookie("hbstatus"),this.toggle_collapsable())},events:_.extend(r.prototype.events,{"click .js-remove-from-cart":"remove_from_cart","click .js-buy-button":"submit_form","click .js-toggle-collapsable":"toggle_cart_collapsed","click .js-switch-payments":"switch_payment_options","click .js-expand-disclaimer":"expand_payment_disclaimer","click .js-close-cart":"close_cart","click .js-internal-store-link":"close_cart","click .js-select-charity":"select_charity","click .js-select-humblekeep":"select_humblekeep"}),render:function(){var e=this.collection.length;if(0==this.$(".js-shopping-cart").length&&this.$el.html(r.prototype.render_template_id.call(this,"shopping-cart-template",{force_email:this.force_email,partner_vars:this.partner_vars})),this.$(".js-count").html(e),1==e?this.$(".js-count-s").hide():this.$(".js-count-s").show(),this.$(".js-shopping-cart-row-holder").empty(),this.$(".js-shopping-cart-total-holder").empty(),0==e){var t=r.prototype.render_template_id.call(this,"shopping-cart-empty-template",{});this.$(".js-shopping-cart-row-holder").append(t),this.$(".js-shopping-cart-total-holder").slideUp()}else this.$(".js-shopping-cart-total-holder").show();this.is_cart_giftable()?this.$(".js-gift-section").show():(this.$(".js-gift-section").hide(),this.$(".js-gift-checkbox").prop("checked",!1)),this.render_items(),this.update_total(),this.rendered=!0,this.render_charity()},render_items:function(){var e=this,t=[];_.each(e.active_coupons,function(n,i){var s=e.coupons.findWhere({coupon_definition:i});if(s&&s.is_auto_generated()){var a=_.difference(n,t),r=_.map(a,function(t){return e.collection.get(t)});r=_.filter(r,function(e){return!!e}),_.each(r,function(e){e.set("active_coupon",s),e.set("upsell_coupon",null),e.set("coupon_status","active"),e.set("coupon_max_count",s.get("coupon_max_count"))}),a=_.map(r,function(e){return e.get("machine_name")}),e.render_cart_item_group(a),t=_.union(t,a)}}),_.each(e.upsell_coupons,function(n,i){var s=e.coupons.findWhere({coupon_definition:i});if(s&&s.is_auto_generated()){var a=_.difference(n,t),r=_.map(a,function(t){return e.collection.get(t)});r=_.filter(r,function(e){return!!e}),_.each(r,function(e){e.set("active_coupon",null),e.set("upsell_coupon",s),e.set("coupon_status","upsell"),e.set("coupon_count",s.get("coupon_min_count"))}),a=_.map(r,function(e){return e.get("machine_name")}),e.render_cart_item_group(a),t=_.union(t,a)}});var n=this.collection.pluck("machine_name"),i=_.difference(n,t);_.each(i,function(t){var n=e.collection.get(t);n.set("active_coupon",null),n.set("upsell_coupon",null),n.set("coupon_status",null)}),e.render_cart_item_group(i)},render_cart_item_group:function(e){if(e.length){var t=$('<div class="cart-group"></div>'),n=this;_.each(e,function(e){n.render_item(n.collection.get(e),t)}),this.$(".js-shopping-cart-row-holder").append(t)}},render_item:function(e,t){var n={shopping_cart_item:e,render_platform_icons:o.render_platform_icons,usd_postfix:this.usd_postfix},i=r.prototype.render_template_id.call(this,"shopping-cart-row-template",n);if(t.append(i),this.$(".js-product-error-holder-"+e.get("machine_name")),!e.get("wallet_reload")&&$.inArray(this.current_os.toLowerCase(),e.get("operating_systems"))<0){var s=$('<div class="platform-warning">Warning: does not support '+this.current_os+"</div>");this.$(".js-product-error-holder-"+e.get("machine_name")).append(s)}if(!e.can_participate_in_promotional_wallet_credit()&&this.constants.HUMBLEKEEP_ENABLED){var s=$('<div class="keep-warning">Note: not eligible for Humble Rewards</div>');this.$(".js-product-error-holder-"+e.get("machine_name")).append(s)}},render_charity:function(){if(this.current_charity){var e={current_charity:this.current_charity.toJSON(),featured_charities:this.featured_charities.toJSON(),humblekeep_opt_in:this.humblekeep_opt_in,humblekeep_enabled:this.constants.HUMBLEKEEP_ENABLED},t=r.prototype.render_template_id.call(this,"shopping-cart-charity",e);this.$(".js-charity-holder").html(t)}},update_charity:function(e){e.current_charity&&(this.current_charity=e.current_charity,this.current_charity_is_random=e.current_charity_is_random),e.hasOwnProperty("humblekeep_opt_in")&&(this.humblekeep_opt_in=e.humblekeep_opt_in),this.rendered&&this.render_charity()},update_active_coupons:function(e){this.active_coupons=e.active_coupons,this.upsell_coupons=e.upsell_coupons,this.render()},select_charity:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).data("charity-id"),n=this.featured_charities.get(t);this.pubSub.publish("set_charity",{current_charity_is_random:!1,current_charity:n})},select_humblekeep:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).hasClass("opt-in"),n=$(e.currentTarget).hasClass("opt-out");t?this.pubSub.publish("set_charity",{current_charity:this.current_charity,current_charity_is_random:this.current_charity_is_random,humblekeep_opt_in:!0}):n&&this.pubSub.publish("set_charity",{current_charity:this.current_charity,current_charity_is_random:this.current_charity_is_random,humblekeep_opt_in:!1})},is_in_cart:function(e){return!!this.collection.get(e)},size:function(){return this.collection.size()},add_item:function(e){this.collection.add_items([e])},on_localstorage_modified:function(e){e.originalEvent.key&&e.originalEvent.key!==this.LOCALSTORAGE_KEY||this.load_from_localstorage()},get_total:function(){return this.collection.get_total()},get_total_without_tax:function(){return this.collection.get_total_without_tax()},get_total_full_price:function(){return this.collection.get_total_full_price()},get_cyoc_total:function(){return this.collection.get_cyoc_total(this.humblekeep_opt_in)},get_keep_total:function(){return this.collection.get_keep_total(this.humblekeep_opt_in)},get_amount_to_pay_from_wallet:function(){if(this.wallet_currency!=this.collection.currency)return new n(0);var e,t=this.collection.get_wallet_eligible_total();return e=this.wallet_balance.gt(t)?t:this.wallet_balance,e=e.lt(0)?n(0):e},is_cart_giftable:function(){return this.collection.all(function(e){return e.get("giftable")})},update_total:function(){var e=this.get_total_full_price(),t=this.get_total_without_tax(),n=this.get_total(),i=this.get_amount_to_pay_from_wallet(),a=this.get_cyoc_total(),o=this.get_keep_total(),l={total:s.moneyfmt(n,null,!1,this.usd_postfix),original_subtotal:null,total_without_tax:null,tax_amount:null,wallet_amount:null,amount_to_charge:null,cyoc_total:s.moneyfmt(a,null,!1,this.usd_postfix),keep_total:s.moneyfmt(o,null,!1,this.usd_postfix)};t[0].eq(e[0])||(l.original_subtotal=s.moneyfmt(e,null,!1,this.usd_postfix)),i.gt(0)&&(l.wallet_amount=s.moneyfmt(i,this.wallet_currency,!1,this.usd_postfix),l.amount_to_charge=s.moneyfmt(n[0].minus(i),this.wallet_currency,!1,this.usd_postfix)),this.collection.tax_rate.gt(0)&&(l.total_without_tax=s.moneyfmt(t[0],null,!1,this.usd_postfix),l.tax_amount=s.moneyfmt(n[0].minus(t[0]),null,!1,this.usd_postfix));var c=r.prototype.render_template_id.call(this,"shopping-cart-total-template",l);this.$(".js-shopping-cart-total-holder").html(c),this.update_payment_options()},init_collection_event_handlers:function(){this.collection.off("collectionModified",this.on_collection_changed,this),this.collection.on("collectionModified",this.on_collection_changed,this),this.coupon_view&&(this.collection.off("collectionModified",this.coupon_view.get_coupons,this.coupon_view),this.collection.off("collectionModified",this.sync_coupon_products,this),this.collection.on("collectionModified",this.coupon_view.get_coupons,this.coupon_view),this.collection.on("collectionModified",this.sync_coupon_products,this))},on_collection_changed:function(e){e!==!0&&this.save_to_localstorage(),this.coupon_view&&this.coupon_view.calculate_coupon_discounts()},sync_coupon_products:function(){this.pubSub.publish("syncing_coupon_products",{done:!1}),this.coupon_view.invalidate_dynamic_coupons();var e=this,t=this.coupon_view.dynamic_coupon_machine_names();0==t.length?(e.coupon_view.current=!0,this.coupon_view.calculate_coupon_discounts()):$.ajax({url:"/store/coupon-products",type:"GET",data:{cart_contents:this.collection.item_machine_names(),coupon_definitions:this.coupon_view.dynamic_coupon_machine_names()},error:function(){console.log("failed to sync coupon products!")},success:function(t){e.coupon_view.update_coupon_products(t,e.collection.item_machine_names())}})},product_and_price_sync_complete:function(e,t){var n=this.$el.find(".js-cart-notifications");e&&e.length||t&&t.length?n.html(i.renderTemplateId("shopping-cart-changes-template",{price_changes:e,removed_products:t,products:this.collection,usd_postfix:this.usd_postfix})).slideDown():n.slideUp(),this.sync_coupon_products()},save_to_localstorage:function(){var e=JSON.stringify(this.collection),t=s.getLocalStorage();try{t.setItem(this.LOCALSTORAGE_KEY,e)}catch(n){console&&console.log(n)}},load_from_localstorage:function(){try{var e=s.getLocalStorage(),t=JSON.parse(e.getItem(this.LOCALSTORAGE_KEY));this.collection.reset(t),this.collection.forEach(function(e){e.set({use_full_price:!1},{silent:!0}),e.set({coupons_applied:[]}),this.collection.currency=e.get_current_price()[1]},this),this.init_collection_event_handlers(),this.on_collection_changed(!0),this.collection.trigger("sync_products_and_prices")}catch(n){this.init_collection_event_handlers(),this.on_collection_changed(!0),this.collection.trigger("sync_products_and_prices")}},on_scroll:function(){var t=e(window).scrollTop(),n=Math.max(-102,-t);this.$(".js-shopping-cart").css({top:n})},remove_from_cart:function(t){t.stopPropagation();var n=e(t.currentTarget),i=n.data("model-id"),s=this;n.closest(".js-shopping-cart-row").slideUp(100,function(){var e=s.collection.get(i);e.get("machine_name");s.collection.remove_item(e),s.collection.length||(s.collection.currency=null,s.hide_cart_error())})},toggle_cart_collapsed:function(e){$(e.target).closest(".js-cart-contents").length>0||(this.expanded||s._gaTrackEvent(void 0,"'View cart' clicked",void 0,parseInt(100*this.collection.get_total())),this.toggle_collapsable())},close_cart:function(e){this.expanded&&this.toggle_collapsable()},toggle_collapsable:function(){var e=200,t=this.$(".js-cart-contents"),n=this.$(".js-grayout"),i=this;if(this.expanded)n.fadeOut(e,function(){$("body").css({overflow:"auto","margin-right":"auto"}),$(".js-shopping-cart, .js-show-wishlist, .js-wallet-thumb").css({"margin-right":0}),i.trigger("onToggleShoppingCart",i.expanded)}),i.expanded=!1;else{this.coupon_view.get_coupons();var s=$("body").width();$("body").css({overflow:"hidden"});var a=$("html").width(),r=a-s;$("body").css({"margin-right":r+"px"}),$(".js-shopping-cart, .js-show-wishlist, .js-wallet-thumb").css({"margin-right":r+"px"}),n.fadeIn(e);var o=t.css("margin-top");t.css({"margin-top":"100%"}).animate({"margin-top":o},200,function(){}),i.expanded=!0,i.trigger("onToggleShoppingCart",i.expanded)}},show_payment_option:function(e){if(!e.hasClass("is-visible")){var t=this.$(".js-payment-set.is-visible"),n=this.$(".js-payment-holder");n.css("overflow","hidden");var i=200,s=this,a=function(){t.css("display","none"),n.css("overflow","visible"),t.removeClass("is-visible"),e.addClass("is-visible"),e.hasClass("conditional-payment-set")||(s.$(".is-selected").removeClass("is-selected"),e.addClass("is-selected"))};e.data("payment-set-index")>t.data("payment-set-index")?(t.animate({"margin-left":"-100%"},i,a),e.css({display:"inline-block"})):(e.css({"margin-left":"-100%",display:"inline-block"}),e.animate({"margin-left":"0"},i,a))}},update_payment_options:function(){var e=this.get_total(),t=this.get_amount_to_pay_from_wallet();this.$(".js-payment-set").removeClass("is-selected"),this.$(".js-default-payment-set").addClass("is-selected"),this.collection.length?e[0].lt("0.01")?this.show_payment_option(this.$(".js-free-payment")):e[0].minus(t).lt("0.01")?this.show_payment_option(this.$(".js-wallet-payment")):this.show_payment_option(this.$(".is-selected")):this.show_payment_option(this.$(".is-selected"))},display_captcha:function(){var e=this.get_total(),t=this.$(".js-captcha-holder");e[0].lt("0.01")&&this.collection.length&&this.coupon_view.require_captcha_if_free()?(t.show(),this.captcha||(this.captcha=new Recaptcha2("storefront-captcha"))):t.hide()},switch_payment_options:function(e){e.preventDefault(),this.show_payment_option(this.$(".js-payment-set:not(.conditional-payment-set):not(.is-selected)")),s._gaTrackEvent(void 0,"'Other payment options' clicked")},live_email_check_callback:function(e,t){return t?this.show_email_message(t):(this.hide_email_messages(),null)},show_email_message:function(e){if(e){var t=this.$(".js-email-error-holder");return this.show_error_message(e,"typecheck",t)}},show_error_message:function(t,n,i){i.find("."+n).remove();var s=r.prototype.render_template_id.call(this,"shopping-cart-error-message-template",{error_text:t,identifier_class:n}),a=e(s);return i.html(a),a},show_cart_error:function(e){var t=this.$(".js-shopping-cart-total-holder").next(".js-cart-error");t.text(e),t.show()},hide_error_message:function(e,t){var n=t.find("."+e);n.fadeOut(function(){n.remove()})},hide_email_messages:function(){e(".js-email-error-holder .js-error-message").fadeOut(function(){e(this).remove()})},hide_cart_error:function(){this.$(".js-shopping-cart-total-holder").next(".js-cart-error").hide()},expand_payment_disclaimer:function(e){e.preventDefault(),this.$(".js-expand-disclaimer").hide(),this.$(".js-expandable-disclaimer").show()},hide_payment_processors:function(){this.$(".js-payment-set").slideUp(100),this.$(".processing").slideDown(100)},show_payment_processors:function(){this.$(".js-default-payment").slideDown(100),this.$(".processing").slideUp(100)},validate_cart:function(){return 0==this.collection.length?(this.show_error_message("Please add some items to your cart first!","empty-cart",this.$(".js-product-error-holder")),!1):isValidEmail(this.$email_field.val())?(s._gaTrackEvent(void 0,"Email address entered"),!0):(this.show_email_message("Please enter a valid email!"),!1)},submit_form:function(t){t.preventDefault();var i=this,a=e(t.target),r=a.attr("value")||a.data("processor"),o=a.data("type"),l=a.data("alipay-enabled"),c=a.data("alipay-default");if(i.validate_cart()){i.hide_cart_error();var u=i._get_submit_data(r,o),d=u[0],h=u[1],p=(u[3],u[4]),_=h.minus(p),m=u[2];d&&("stripe"===r&&"ideal"!=o&&"sofort"!=o?StripeCheckout.open({key:i.stripe_pubkey,address:!0,amount:_.times(new n(100)).round().toString(),currency:i.collection.currency,email:i.$(".js-email").val(),name:"Humble Bundle",description:"Humble Bundle Shopping Cart",panelLabel:"Checkout",alipay:l,alipay_default:c,locale:l?"zh":"auto",token:function(t){d.append(e("<input type=hidden name=stripe_token />").val(t.id)),d.append(e("<input type=hidden name=stripe_token_type />").val(t.type)),t.card&&d.append(e("<input type=hidden name=stripe_cc_data />").val($.param(t.card))),i.hide_payment_processors(),d.submit()}}):(i.hide_payment_processors(),d.submit()),s._gaTrackEvent(void 0,"'Pay with "+r+"' clicked",m,Math.floor(100*_)))}},_get_submit_data:function(t,i){var s=this,a="/humbler/submit",r=e('<form id="deserialized-order-form" method="POST" target="_top" action="'+a+'"></form>').appendTo(s.el),o={},l=s.$(".js-gift-checkbox").prop("checked");l&&(o.gift="on");var c=new n(0),u=[],d=[];this.coupon_view.selectedCoupons&&(c=this.coupon_view.discount,u=this.coupon_view.get_selected_coupon_keys(),d=this.coupon_view.auto_generated_coupon_names());var h=s.$(".js-subscribe-checkbox").prop("checked");h&&(o.subscribe="on");var p=s.$(".js-email").val();this.humblekeep_opt_in&&this.constants.HUMBLEKEEP_ENABLED&&(o.humblekeep_opt_in="on"),$.extend(o,{email:p,product:"shopping_cart",processor:t,payment_type:i,"g-recaptcha-response":this.captcha?this.captcha.get_response():""});var _=new n(0);s.collection.forEach(function(e){_=_.plus(e.get_current_price_as_big()[0]),o[s.PRODUCT_PRICE_PARAM_PREFIX+e.get("machine_name")]=e.get_current_price()});var m=this.get_total(),g=this.get_amount_to_pay_from_wallet(),f=this.get_cyoc_total()[0],v=this.get_keep_total()[0];
this.current_charity&&(o.charity_id=this.current_charity.get("charity_id")),o.discount=c.toString(),o.wallet_amount=g.toString(),o.cyoc_total=f.toString(),o.keep_total=v.toString();var b=s.collection.first().get_current_price()[1];o.currency=b,o.amount=_.toString(),o.tax_rate=s.collection.tax_rate.toString(),o.tax_amount=s.collection.get_total()[0].minus(s.collection.get_total_without_tax()[0]).round(2,1).toString(),s.iframe&&(o.iframe=!0);for(var y in o)o.hasOwnProperty(y)&&e("<input>").attr({type:"hidden",name:y,value:o[y]}).appendTo(r);s.collection.forEach(function(t){e("<input>").attr({type:"hidden",name:"cart_contents",value:t.get("machine_name")}).appendTo(r)});for(var w=0;w<u.length;w++)e("<input>").attr({type:"hidden",name:"coupon",value:u[w]}).appendTo(r);for(var w=0;w<d.length;w++)e("<input>").attr({type:"hidden",name:"auto_coupon",value:d[w]}).appendTo(r);return[r,m[0],b,c,g]}});return{CouponView:c,ShoppingCartItem:u,ShoppingCart:d,ShoppingCartView:h}}),define("lib/hbTemplate!storefrontv2/templates/storefrontViewTemplates.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<script type="text/template" id="background-image">\n  <img class="background-image" src="<%- backgroundImage %>">\n</script>'.replace(/xSTATIC_URLx/g,t)}()}),define("storefrontv2/views/StorefrontView",["require","underscore","account/accountModals","backbone","storefrontv2/views/BaseView","hbtemplate!storefrontv2/templates/storefrontViewTemplates.html","util/templating","util/main"],function(e){"use strict";var t=e("underscore"),n=e("account/accountModals"),i=e("backbone"),s=e("storefrontv2/views/BaseView"),a=e("hbtemplate!storefrontv2/templates/storefrontViewTemplates.html"),r=e("util/templating"),o=e("util/main");$("body").append(a);var l=s.extend({events:function(){var e={resize:"adjustViewport"},t=navigator.userAgent;return/iPhone|iPad|iPod/.test(navigator.platform)&&t.indexOf("AppleWebKit")>-1&&(e.devicemotion="checkTilt",e.orientationchange="restoreZoom"),e},initialize:function(e){s.prototype.initialize.call(this,e),t.bindAll(this,"forceRedrawOnEmpty","getEffectiveViewportWidth","hideMobileNav","showErrorState","showLoadingState","toggleShoppingCart","updatePageBackground","updatePageClasses","updatePageTitle"),this.mobileSideNavView=e.mobileSideNavView,this.$backgroundContainer=$(e.htmlContainers.backgroundContainer),this.$pageContainer=$(e.htmlContainers.pageContainer),this.$pageViewContainer=$(e.htmlContainers.pageViewContainer),this.shoppingCartView=e.shoppingCartView,this.savedScrollPositions=[],this.$storefrontHeaderNav=$(e.htmlContainers.storefrontHeaderNavViewContainer),this.storefrontHeaderNavView=e.storefrontHeaderNavView,this.zoomEnabled=!0,this.listenTo(e.appRouter,"loading",this.showLoadingState).listenTo(e.appRouter,"loading:error",this.showErrorState).listenTo(e.appRouter,"loading:success",this.showLoadedState).listenTo(i,"free-product-requires-login",this.onFreeProductRequiresLogin).listenTo(i,"free-product-requires-steam-link",this.onFreeProductRequiresSteamLink).listenTo(this.mobileSideNavView,"toggleShoppingCart",this.toggleShoppingCart).listenTo(this.shoppingCartView,"onToggleShoppingCart",this.onToggleShoppingCart).listenTo(this.shoppingCartView.collection,"collectionModified",this.forceRedrawOnEmpty).listenTo(this.storefrontHeaderNavView,"onToggleMobileSidebarNav",this.onToggleMobileSidebarNav).listenTo(this.storefrontHeaderNavView,"toggleShoppingCart",this.toggleShoppingCart).on("toggleShoppingCart",this.toggleShoppingCart),this.sharedConfig.pubSub.subscribe("onBuyButtonClick",this.toggleShoppingCart)},adjustViewport:function(){$("#js-viewport").attr("content","initial-scale=1, width="+this.getViewportWidth())},checkTilt:function(e){var t=e.accelerationIncludingGravity;x=Math.abs(t.x),y=Math.abs(t.y),z=Math.abs(t.z),w.orientation&&180!==w.orientation||!(x>7||(z>6&&y<8||z<8&&y>6)&&x>5)?this.zoomEnabled||this.enableZoom():this.zoomEnabled&&this.disableZoom()},disableZoom:function(){var e=this.$pageContainer.find("#js-viewport");e.attr("content",e.attr("content")+", maximum-scale=1"),this.zoomEnabled=!1},enableZoom:function(){var e=this.$("#js-viewport");e.attr("content","width="+this.getViewportWidth()+", maximum-scale=10"),this.zoomEnabled=!0},forceRedrawOnEmpty:function(){this.getEffectiveViewportWidth()<l.SITE_MAX_MOBILE_WIDTH&&!this.shoppingCartView.collection.length&&o.forceRedraw(this.$pageContainer.find(".js-cart-container .js-grayout")[0])},getEffectiveViewportWidth:function(){var e=window.screen.height,t=window.screen.width;return window.innerHeight<window.innerWidth?e:t},getViewportWidth:function(){return this.getEffectiveViewportWidth()<l.SITE_MIN_WIDTH?l.SITE_MIN_WIDTH:"device-width"},hideMobileNav:function(e){var t=$(e.target);!this.$pageContainer.hasClass("mobile-nav-active")||this.$pageContainer.hasClass("shopping-cart-active")||t.closest(".js-sidebar-nav-container").length||t.hasClass("account-login")||t.closest("#site-modal").length||(this.$pageContainer.off("click",this.hideMobileNav),this.storefrontHeaderNavView.trigger("toggleMobileNav",e,!1),this.scrollRestore())},onFreeProductRequiresLogin:function(e){var t=$.extend({},window.modal_attributes);t.product_human_name=e.get("human_name");var i=new n.AccountLoginFreeProductModal({attributes:t});$("#site-modal").html(i.render().$el)},onFreeProductRequiresSteamLink:function(e){var i=t.extend({},window.modal_attributes);i.product_human_name=e.get("human_name"),i.product_redirect=this.sharedConfig.storefrontConstants.STORE_ROOT+"/"+e.get("human_url");var s=new n.AccountSteamLinkFreeProductModal({attributes:i});$("#site-modal").html(s.render().$el)},onToggleMobileSidebarNav:function(e){e&&(this.$pageContainer.on("click",this.hideMobileNav),this.scrollSave()),this.$pageContainer.toggleClass("mobile-nav-active",e)},onToggleShoppingCart:function(e){var t=this.$storefrontHeaderNav;this.$pageContainer.toggleClass("shopping-cart-active",e),t.length&&o.forceRedraw(t.get(0))},scrollSave:function(){this.savedScrollPositions[i.history.fragment]={x:window.pageXOffset,y:window.pageYOffset}},scrollRestore:function(){var e=this.savedScrollPositions[i.history.fragment]||{x:0,y:0};window.scrollTo(e.x,e.y)},showErrorState:function(){this.updatePageClasses(l.PAGE_CLASSES.ERROR),this.updatePageTitle("The Humble Store: Error"),window.scrollTo(0,0)},showLoadedState:function(e){e=e||{},this.$pageContainer.removeClass(l.PAGE_CLASSES.LOADING),this.updatePageBackground(e.backgroundImage),this.updatePageTitle(e.pageTitle)},showLoadingState:function(e){e=e||"",e+=" "+l.PAGE_CLASSES.LOADING,this.$pageViewContainer.empty(),this.updatePageClasses(e),this.updatePageTitle("The Humble Store: Loading"),window.scrollTo(0,0)},toggleShoppingCart:function(){this.shoppingCartView.toggle_collapsable()},updatePageBackground:function(e){e?this.$backgroundContainer.html(r.renderTemplateId("background-image",{backgroundImage:e})):this.$backgroundContainer.empty()},updatePageClasses:function(e){this.$pageContainer.removeClass(t.values(l.PAGE_CLASSES).join(" ")),this.$pageContainer.addClass(e)},updatePageTitle:function(e){e=e||"The Humble Store",document.title=e}},{PAGE_CLASSES:{ABOUT:"about",CHARITY:"charity",ERROR:"error",LOADING:"loading",PAGE:"page",PRODUCT:"product",SEARCH:"search",WISHLIST:"wishlist"},SITE_MAX_MOBILE_WIDTH:700,SITE_MIN_WIDTH:360});return l}),define("storefrontv2/views/StorefrontNavViews",["require","underscore","storefrontv2/views/BaseView","util/main"],function(e){"use strict";var t=e("underscore"),n=e("storefrontv2/views/BaseView"),i=e("util/main"),s=n.extend({events:{"click .js-cart":"toggleShoppingCart","click .js-wishlist":"showWishlist"},initialize:function(e){n.prototype.initialize.call(this,e),t.bindAll(this,"updateCartSize"),this.shoppingCartCollection=e.shoppingCartCollection,this.listenTo(this.sharedConfig.userModel.get("wishlistModel"),"modifyWishlist:success",this.updateWishlist),this.listenTo(this.shoppingCartCollection,"collectionModified",this.updateCartSize),this.updateCartSize()},showWishlist:function(e){this.sharedConfig.userModel.isLoggedIn()||(i.login($(e.currentTarget).attr("href")),e.preventDefault())},toggleShoppingCart:function(){this.trigger("toggleShoppingCart")},updateCartSize:function(){this.$(".js-cart .js-item-count").html(this.shoppingCartCollection.size())},updateWishlist:function(){this.$(".js-wishlist .js-item-count").html(this.sharedConfig.userModel.get("wishlistModel").size())}}),a=s.extend({events:function(){return t.extend({},s.prototype.events,{"click .js-mobile-nav":"toggleMobileNav","mouseenter .js-nav-item":"emphasizeHoveredNavItem","mouseleave .js-nav":"deemphasizeHoveredNavItem"})},initialize:function(e){s.prototype.initialize.call(this,e),t.bindAll(this,"animateToCart","toggleHeaderStickiness"),this.$cart=this.$(".js-cart"),this.registerExternalEventHandlers(),this.on("toggleMobileNav",this.toggleMobileNav),this.sharedConfig.pubSub.subscribe("addToCart",this.animateToCart)},animateToCart:function(e){window.animate_add_to_cart(e.startButton,e.product.get("storefront_icon"),$.noop,this.$cart)},deemphasizeHoveredNavItem:function(e){var t=$(e.currentTarget);this.$el.removeClass("hover-active"),t.find(".js-nav-item").removeClass("hover")},emphasizeHoveredNavItem:function(e){var t=$(e.currentTarget);t.siblings(".js-nav-item").removeClass("hover"),t.addClass("hover"),this.$el.addClass("hover-active")},registerExternalEventHandlers:function(){$(window).resize(this.toggleHeaderStickiness).scroll(this.toggleHeaderStickiness)},toggleHeaderStickiness:function(){var e=$(window),t=this.headerPositionTop||this.$el.offset().top;e.scrollTop()-t>0?(this.headerPositionTop=t,this.$el.addClass("sticky"),this.$el.parent().css("padding-top",this.$el.outerHeight())):(delete this.headerPositionTop,this.$el.removeClass("sticky"),this.$el.parent().css("padding-top",0))},toggleMobileNav:function(e,n){this.isMobileNavActive=t.isBoolean(n)?n:!this.isMobileNavActive,this.trigger("onToggleMobileSidebarNav",this.isMobileNavActive),e.stopPropagation()}});return{StorefrontNavView:s,StickyStorefrontHeaderNavView:a}}),define("storefront/models/Wishlist",["underscore","backbone","lib/jquery/full"],function(e,t,n){"use strict";var i=t.Model.extend({defaults:{contents:[],title:"My Wish List",share:!1,url:""},initialize:function(e,t){t=t||{},this.CSRF_TOKEN=t.CSRF_TOKEN,this.CSRF_FORM_KEY=t.CSRF_FORM_KEY,this.on("add",this.add).on("remove",this.remove)},contains:function(t){return e.indexOf(this.get("contents"),t)>-1},add:function(e){var t=this.get("contents").slice();t.push(e),this.set("contents",t),this.modify_wishlist("add",e)},remove:function(t){var n=this.get("contents").slice(),i=e.indexOf(this.get("contents"),t);i>-1&&n.splice(i,1),this.set("contents",n),this.modify_wishlist("remove",t)},size:function(){return this.get("contents").length},modify_wishlist:function(e,t){var i=this,s={};s[this.CSRF_FORM_KEY]=this.CSRF_TOKEN,n.ajax({method:"POST",url:"/wishlist/"+e+"/"+t,data:s,dataType:"json"}).done(function(e){e.success&&(i.update(e.wishlist),i.trigger("modifyWishlist:success",t)),e.error&&(show_flash(e.error),i.trigger("modifyWishlist:error",t)),e.subscribed&&show_flash("You will receive an email when this item goes on sale.")})},update:function(e){this.set("contents",e)},save:function(){var e={wishlist:this.get("contents"),title:this.get("title"),share:this.get("share")};e[this.CSRF_FORM_KEY]=this.CSRF_TOKEN,n.ajax({type:"POST",url:"/wishlist/update",data:e,dataType:"json"}).done(function(e){e.error&&show_flash(e.error)})}});return i}),define("storefrontv2/StorefrontAppRouter",["require","jquery","underscore","storefront/views/AboutView","backbone","storefrontv2/models/BaseEntityCollection","storefront/charity","storefrontv2/views/CharityKeepHeaderView","coupon/coupon","storefrontv2/models/EntitiesCache","storefrontv2/models/Entity","storefrontv2/models/Page","storefrontv2/views/PageView","storefront/views/PermalinkView","storefrontv2/views/SearchView","pubsub","storefrontv2/sharedConfig","storefront/shoppingCart","storefrontv2/views/StorefrontView","storefrontv2/views/StorefrontNavViews","storefrontv2/models/User","storefront/models/Wishlist"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),i=e("storefront/views/AboutView"),s=e("backbone"),a=e("storefrontv2/models/BaseEntityCollection"),r=e("storefront/charity"),o=e("storefrontv2/views/CharityKeepHeaderView"),l=e("coupon/coupon"),c=e("storefrontv2/models/EntitiesCache"),u=(e("storefrontv2/models/Entity"),e("storefrontv2/models/Page"),e("storefrontv2/views/PageView")),d=e("storefront/views/PermalinkView"),h=e("storefrontv2/views/SearchView"),p=e("pubsub"),_=e("storefrontv2/sharedConfig"),m=e("storefront/shoppingCart"),g=e("storefrontv2/views/StorefrontView"),f=e("storefrontv2/views/StorefrontNavViews"),v=e("storefrontv2/models/User"),b=e("storefront/models/Wishlist"),y=s.Router.extend({routes:{about:"aboutPageHandler","wishlist(/:user_key)":"wishlistHandler",":human_url/edit":"loadProductHandler",":human_url(/coupon:coupon_key)":"loadProductHandler","":"loadPageHandler"},initialize:function(e){n.bindAll(this,"pageHandler","productHandler"),this.adminOverrides=y.getAdminOverrides(location.search),this.currentCountry=e.currentCountry,this.genres=e.genres,this.htmlContainers=e.htmlContainers,this.international=e.international,this.$pageViewContainer=t(e.htmlContainers.pageViewContainer),this.stripePubKey=e.stripePubKey,this.storefrontConstants=e.constants,this.partnerVars=e.partner_vars,this.shouldShowMonthlyPromo=e.should_show_monthly_promo,this.initializeCommonModelsAndViews(e),this.setupRegexRoutes()},initializeCommonModelsAndViews:function(e){var i=new r.CharityList(e.charity.charityData),s=e.products||[],a=new r.CharityList,u=e.wallet,d=new b(e.wishlist,{CSRF_FORM_KEY:this.storefrontConstants.CSRF_FORM_KEY,CSRF_TOKEN:this.storefrontConstants.CSRF_TOKEN});n.isEmpty(e.page)||s.push(e.page),this.couponCollection=new l.couponCollection(e.coupons,{}),this.entitiesCache=new c(null,{adminOverrides:this.adminOverrides}),this.entitiesCache.addEntities(s,{parse:!0}),this.pubSub=new p,t.extend(_.storefrontConstants,this.storefrontConstants),_.pubSub=this.pubSub,_.userModel=this.userModel=new v({abTestBuckets:e.user.abTestBuckets,email:e.user.email,hasSteamLink:e.user.hasSteamLink,humbleKeepOptIn:e.charity.humbleKeepOptIn,monthlyIsPaused:e.user.monthlyIsPaused,userPreferredCharityId:e.charity.userPreferredCharityId,wallet:u,wishlistModel:d},{appRouter:this,charityCollection:i,parse:!0}),this.charityAccountCtaView=new r.CharityAccountCTAView({constants:this.storefrontConstants,el:this.htmlContainers.charityAccountCtaContainer,pubSub:this.pubSub,user_email:this.userModel.get("email"),wallet_currency:u.currency}),this.charityKeepHeaderView=new o,this.charityKeepHeaderView.renderTo(t(this.htmlContainers.charityHeaderContainer)),n.each(this.storefrontConstants.FEATURED_CHARITY_IDS,function(e){a.add(i.get(e))}),this.shoppingCartView=new m.ShoppingCartView({constants:this.storefrontConstants,coupons:this.couponCollection,current_country:this.currentCountry,el:this.htmlContainers.shoppingCartContainer,featured_charities:a,force_email:this.userModel.get("email"),pubSub:this.pubSub,stripe_pubkey:this.stripePubKey,wallet_balance:u.balance,wallet_currency:u.currency,partner_vars:this.partnerVars}),this.mobileSideNavView=new f.StorefrontNavView({el:this.htmlContainers.storefrontMobileSideNavViewContainer,shoppingCartCollection:this.shoppingCartView.collection}),this.storefrontHeaderNavView=new f.StickyStorefrontHeaderNavView({el:this.htmlContainers.storefrontHeaderNavViewContainer,shoppingCartCollection:this.shoppingCartView.collection}),this.storefrontView=new g({appRouter:this,htmlContainers:this.htmlContainers,mobileSideNavView:this.mobileSideNavView,shoppingCartView:this.shoppingCartView,storefrontHeaderNavView:this.storefrontHeaderNavView})},setupRegexRoutes:function(){this.route(/((promo|bundle|wallet)\/[^\/]+)/,"loadPageHandler");var e="search";n.each(this.storefrontConstants.SEARCH_PARAM_ORDER,function(t){e+="(/"+t+"/:"+t+")"}),this.route(e,"searchResultsHandler")},aboutPageHandler:function(){this.trigger("loading",g.PAGE_CLASSES.ABOUT),this.trigger("loading:success"),this.aboutView||(this.aboutView=new i({constants:this.storefrontConstants}),this.$pageViewContainer.html(this.aboutView.render()))},loadPageHandler:function(e){var t=y.normalizePath(e),n=this;n.trigger("loading",g.PAGE_CLASSES.PAGE),n.entitiesCache.getEntityByHumanUrl(t).done(function(e){n.trigger("loading:success",{pageTitle:e.getTitleText()}),n.pageHandler(e)}).fail(function(){n.trigger("loading:error")})},loadProductHandler:function(e,n){var i=this;t("#js-viewport").attr("content","width=960"),i.trigger("loading",g.PAGE_CLASSES.PRODUCT),i.entitiesCache.getEntityByHumanUrl(e).done(function(e){i.trigger("loading:success",{pageTitle:e.getTitleText()}),i.productHandler(e,n)}).fail(function(){i.trigger("loading:error")})},pageHandler:function(e){this.trigger("loading:success",{backgroundImage:e.get("background_image"),pageTitle:e.getTitleText()}),this.pageView=new u({couponCollection:this.couponCollection,currentCountry:this.currentCountry,model:e,shoppingCartCollection:this.shoppingCartView.collection}),this.pageView.renderTo(this.$pageViewContainer),this.trigger("pageContentUpdated",e)},productHandler:function(e,t){this.productDetailsPageView=new d({constants:this.storefrontConstants,current_country:this.currentCountry,is_logged_in:this.userModel.isLoggedIn(),model:e,shopping_cart:this.shoppingCartView,wishlist:this.userModel.get("wishlistModel"),monthly_is_paused:this.userModel.get("monthlyIsPaused"),partner_vars:this.partnerVars,should_show_monthly_promo:this.shouldShowMonthlyPromo,userModel:this.userModel}),this.$pageViewContainer.html(this.productDetailsPageView.render()),t&&(this.trigger("toggleShoppingCart"),this.shoppingCartView.is_in_cart(e.get("machine_name"))||this.shoppingCartView.add_item(e),this.shoppingCartView.on("couponsSynced",function(){this.shoppingCartView.coupon_view.add_coupon(t)})),this.productDetailsPageView.finish_loading()},searchResultsHandler:function(e,n,i,s,r,o,l,c){t("#js-viewport").attr("content","width=960");var u=this;this.trigger("loading",g.PAGE_CLASSES.SEARCH),this.searchView=new h({collection:new a,constants:this.storefrontConstants,current_country:this.currentCountry,genres:this.genres,international:this.international,is_logged_in:this.userModel.isLoggedIn(),monthly_is_paused:this.userModel.get("monthlyIsPaused"),render_as_grid:!1,shopping_cart:this.shoppingCartView,wishlist:this.userModel.get("wishlistModel")}),this.listenTo(this.searchView,"loading:error",function(){u.trigger("loading:error")}),this.listenTo(this.searchView,"loading:success",function(){u.trigger("loading:success",{pageTitle:"The Humble Store: Search"})}),this.searchView.renderTo(this.$pageViewContainer),this.searchView.trigger("search",{developer:l||null,drm:i||"all",genre:e||"all",page:parseInt(o||0),platform:n||"all",publisher:c||null,search:s||"",sort:r||null})}},{VALID_OVERRIDES:{view:!0},getAdminOverrides:function(e){var t={};return e=e.replace("?",""),n.each(e.split("&"),function(e){var n,i=e.split("=");2==i.length&&(n=i[0],y.VALID_OVERRIDES[n]&&(t[n]=i[1]))}),t},normalizePath:function(e){return e=e||"","/"!=e[0]&&(e="/"+e),"/"!=e[e.length-1]&&(e+="/"),e}});return y}),define("storefrontv2/main",["require","backbone","storefrontv2/dependencies","storefrontv2/StorefrontAppRouter"],function(e){"use strict";function t(e){e.htmlContainers={backgroundContainer:"#js-background-container",charityAccountCtaContainer:"#js-charity-account-cta",charityHeaderContainer:".js-charity-keep-content",pageContainer:"body",pageViewContainer:".js-page-content",shoppingCartContainer:"#js-cart-container",storefrontHeaderNavViewContainer:".js-storefront-header-nav",storefrontMobileSideNavViewContainer:".js-sidebar-nav-container"},new i(e),n.history.start({pushState:!0,root:e.constants.STORE_ROOT})}var n=e("backbone"),i=(e("storefrontv2/dependencies"),e("storefrontv2/StorefrontAppRouter"));return{init:t}});
//# sourceMappingURL=main.js.map