!function(){function exists(t,n){1!=arguments.length&&"object"==typeof t||(n=t,t=document);var i=Sizzle(n,t)[0];return!!i}function attr(t,n,i){try{"object"!=typeof t&&(i=n,n=t,t=document);var e=Sizzle(n,t)[0];return e?i?e.getAttribute(i):e.innerHTML:null}catch(t){u(t.message+" for "+n+" -- "+i)}}function addEventToElement(t,n,i){var e;if(e=n?function(){window[h](t,j(n))}:function(){window[h](t)},m[i]||(m[i]={}),!m[i][t]){m[i][t]=e;var o=v[i],r=Sizzle(i)[0];if(v[i]=r,r&&!o)for(var a in m[i])b(r,m[i][a]);else r&&o&&b(r,e)}};for(var t="",n="anon-1484180944869-6885181581_4577",i="4577",e="/p/cp/",o="https://ssl.micpn.com",r="MovableInkTrack",a=document.getElementsByTagName("script"),c=0;c<a.length;c++)if(a[c].src){var s=a[c].src.match(/(\/\/.+)\/p\/js\/\d+/);s&&(o=s[1])}var u=window.location.hash.match(/midebug/)?function(t){console.log(t)}:function(){},p=window.location.hash.match(/midebug/)?function(t){console.error(t)}:function(){},h=window[r]||"_miconv",l=window[h]||[],f=1e3,d=500;if(!l.initialized){var m={},v={},g=l.q||window._miconv||[];g.length>0&&u("Loading "+g.length+" queued events.");for(var y={},_=window.location.search.substring(1),w=_.split("&"),c=0;c<w.length;c++){var S=w[c].split("=");y[S[0]]=S[1]}var I=function(){var t=(new Date).getTime(),n=Math.ceil(1e10*Math.random());return"anon-"+t.toString()+"-"+n.toString()},z=function(t){var n=function(t){for(var n=[],i=0;i<t.length;i++){var e=t[i];n.push(z(e))}return n.join("|")},i=function(t){var n=[];for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];"string"==typeof o&&(o=z(o)),n.push([e(i),o].join(":"))}return n.join(",")},e=function(t){return t.replace(/[\|\,:]/g," ")};return"[object Array]"===Object.prototype.toString.call(t)?n(t):"object"==typeof t?i(t):"string"==typeof t?e(t):t},j=function(t){var n={};for(var i in t)if(t.hasOwnProperty(i))if("function"==typeof t[i])try{n[i]=t[i]()}catch(t){n.jserror=t.toString(),p(t)}else n[i]=t[i];return n},b=function(t,n){t.attachEvent?t.attachEvent("onclick",n):t.addEventListener&&t.addEventListener("click",n,!1)},k=function(){for(var t in v){var n=v[t],i=Sizzle(t)[0];if(v[t]=i,i&&!n)for(var e in m[t])b(i,m[t][e])}};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});var C=function(){};C.prototype.init=function(){var e=this,o=""===t||this.validateCampaignCookie(t),r=""===n||this.validateBehavioralCookie(n);if(!o||!r)return u("Bad campaign cookie: "+t),u("Bad behavioral cookie: "+n),this.valid=!1,void 0;if(this.valid=!0,this.userIdentifier=I(),this.companyId=i,this.campaignKey=-1,this.campaignTimestamp=new Date,""!==t&&t.indexOf("::")!==-1){var a=t.split("::");t=a[1],this.userIdentifier=this.cleanString(a[0])}if(""!==t&&t.indexOf(":")!==-1){var a=t.split(":");this.campaignKey=this.cleanString(a[0])||-1,this.campaignTimestamp=new Date(parseInt(a[1],10))}if(""!==n&&n.indexOf("_")!==-1){var a=n.match(/^(.+)_(\d+)$/);this.userIdentifier=this.cleanString(a[1]),this.companyId=this.cleanString(a[2])}y.mi_u&&(this.userIdentifier=this.cleanString(y.mi_u)),y.mi_cmp&&(this.campaignKey=this.cleanString(y.mi_cmp)),this.products=[],this.sendPageEvents(),this.currentUrl=document.location.toString(),setInterval(function(){e.currentUrl!=document.location.toString()&&(e.currentUrl=document.location.toString(),e.sendPageEvents())},f),setInterval(k,d);for(var c=0;c<g.length;c++)this.push(g[c]);u("Initialized miconv.")},C.prototype.sendPageEvents=function(){this.customData={},this.executeCustomJs(),"conversion"==this.customData.type&&this.push("conversion",this.customData),this.push("pageview",this.customData)},C.prototype.executeCustomJs=function(){!function(page){try{}catch(t){page.jserror=t.toString(),p(t)}}(this.customData)},C.prototype.cleanString=function(t){return t.replace(/[^a-z0-9\_\.\-]/gi,"")},C.prototype.validateCampaignCookie=function(t){var n=/^(.+)?::(\w+):(\d+)/,i=/^(\w+):(\d+)/;return null!=(t.match(n)||t.match(i))},C.prototype.validateBehavioralCookie=function(t){var n=/^(.+)_(\d+)$/;return null!=t.match(n)},C.prototype.push=function(){if(this.valid){var t;if(t="string"==typeof arguments[0]?Array.prototype.slice.call(arguments,0):Array.prototype.slice.call(arguments[0],0),"send"===t[0])t.shift();else{if("addProduct"===t[0])return this.products.push(t[1]),void 0;if("addPromo"===t[0])return t[1]&&(t[1].promo=!0),this.products.push(t[1]),void 0}var n=t[0],i;i=void 0===t[1]?{amount:0}:"string"==typeof t[1]||"number"==typeof t[1]?{amount:t[1]}:t[1];var e=(i.amount||i.revenue||"").toString().replace(/[^0-9\.]/g,"");i.amount=parseFloat(e)||0;var o=t[2],r=this.campaignTimestamp.getTime(),a={t:(new Date).getTime(),mi_u:this.userIdentifier,mi_cid:this.companyId,page_title:document.title,referrer:document.referrer||document.referer,timezone_offset:(new Date).getTimezoneOffset(),event_type:n,conversion_id:o,cdate:r,products:this.products.length?this.products:null};y.mi_cmp&&(a.mi_cmp=y.mi_cmp);for(var c in i)i.hasOwnProperty(c)&&(a[c]=i[c]);this.sendData(a)}},C.prototype.sendData=function(t){var n=[o,e,this.campaignKey,"/track.gif"].join(""),i=[];for(var r in t)if(t.hasOwnProperty(r)&&t[r]){var a=t[r];"string"!=typeof a&&(a=z(a));var c=[encodeURIComponent(r),encodeURIComponent(a)].join("=");i.push(c)}n+="?"+i.join("&"),u("Constructed URL: "+n);var s=new Image(1,1),p=this;s.onload=function(){u("Pushed event: "+p.campaignKey+" : "+t.event_type+", "+n),s.onload=null},s.onerror=function(){u("Failed event: "+p.campaignKey+" : "+t.event_type+", "+n),s.onerror=null},s.src=n},C.setup=function(){var t=new C;window[h]=function(){t.push.apply(t,arguments)},window[h].push=window[h],window[h].initialized=!0,t.init()},C.setup()}}();
