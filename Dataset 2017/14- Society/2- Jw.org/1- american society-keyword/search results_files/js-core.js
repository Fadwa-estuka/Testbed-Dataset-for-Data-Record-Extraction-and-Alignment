/*! jworg-content-theme - v0.1.0 - 2017-01-24 06:58:43 PM UTC */
!function(){"use strict";var a,b,c,d,e,f={},g={};a=function(a){this.message=a},a.prototype=$.extend(new Error,{name:"Module Exception"}),e=function(a){var c=b(a);return new c},c=function(b,c){if(!c)return void delete f[b];if(f.hasOwnProperty(b))throw new a("Cannot redefine module with name '"+b+"'.");f[b]=c},d=function(a){return g.hasOwnProperty(a)||(g[a]=e(a)),g[a]},b=function(b){if(!f.hasOwnProperty(b))throw new a("Module with name '"+b+"' has not been defined.");return f[b]},window.jscore={},window.module=window.jscore.module={construct:e,define:c,get:d,require:b}}(),function(){"use strict";function a(){var a=_.toArray(arguments);return _.reduce(a,function(a,b){return b?0===a.length?b:("/"!==a[a.length-1]&&(a+="/"),"/"===b[0]&&(b=b.slice(1)),a+b):a},"")}function b(b){var d,e,f,g=$("base"),h=g.attr("href")||"";return g.length>0&&(d=c(h)),!b.origin&&d&&(b.origin=d.origin),b.path&&"/"!==b.path[0]&&(d?b.path=a(d.path,b.path):b.path=a(window.location.pathname,b.path)),e=query.build(b.query)||"",b.hash?(f=b.hash.path||"",f+=query.build(b.hash.query)||"",f=f.length?"#"+f:""):f="",a(b.origin,b.path)+e+f}function c(a){var b,c=d.exec(a||window.location.href);return c=c||[],b=c[8]?c[8].split("?"):[],c={origin:c[1],path:c[4],query:c[6]?query.parse({rebuild:!0,query:c[6]}):{},hash:{path:b[0],query:b[1]?query.parse({rebuild:!0,query:b[1]}):{}}}}var d=/^((https?):\/\/([^\/]+)){0,1}([^?#]+){0,1}(\?([^#]+)){0,1}(\#(.+)){0,1}$/;jscore.module.define("url",{build:b,parse:c,join:a})}(),function(){"use strict";var a,b,c,d,e,f,g=jscore.module.require("url"),h=$("body").data("ui-core-settings")||{},i=$("script[src]:last").attr("src").split("?").shift().split("/").slice(0,-1).join("/");a={CAST_APPID:"E0F2D815",CAST_LOAD_SCREEN:null,CAST_END_SCREEN:null,CAST_LOGO:null,CAST_RAIL_COLOR:"#4E6BA7",JWP_LICENSE:"I3QXOEg/BYJ7bjcYjTi4ln6hFHstf3qfXWw+XQ==",JS_CORE_BASE:function(){var a=i,b=g.parse(a);return b.origin=window.location.origin,g.build(b)},JWP_BASE:function(){return e("JS_CORE_BASE")+"/jwplayer/"},JWP_PROVIDER:function(){return e("JWP_BASE")+"AkamaiAdvancedJWStreamProvider.swf"},JWP_SKIN:function(){return e("JWP_BASE")+"skins/light/light.xml"}},b=_.extend({},a,h),c=function(a){var b=$("#pageConfig"),c=$.persistentData(a);return void 0!==c?c:(a=a.toLowerCase(),b.data(a))},d=function(a,b){$.persistentData(a,b)},e=function(a){var c=b[a];return"function"==typeof c&&(c=c()),c},f=function(a){b=_.extend(b,a)},jscore.module.define("settings",{getPageConfig:c,setPageConfig:d,getSetting:e,setSettings:f})}(),function(){"use strict";var a={isAndroid:function(){return!!navigator.userAgent.match(/Android/i)},isFlashInstalled:function(){try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(a)return!0}catch(a){if(void 0!==navigator.mimeTypes["application/x-shockwave-flash"])return!0}return!1},isIOS:function(){return!!navigator.userAgent.match(/(iPad|iPhone|iPod)/i)},isIE:function(){var a=navigator.userAgent,b=!!a.match(/MSIE/i),c=!!a.match(/Trident\/7\./i),d=b||c;return d},isFF:function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},isWindowsPhone:function(){return navigator.userAgent.toLowerCase().indexOf("windows phone")>-1},supportsAudioMuteControl:function(){var a=document.createElement("audio"),b=!0;return a.muted=!0,b=b&&a.muted,a.muted=!1,b=b&&!a.muted},supportsHTML5Video:function(){var a=Modernizr.video.h264||"";return a=!!a.replace(/no/,"")},supportsMP3Audio:function(){var a=Modernizr.audio.mp3||"";return!!a.replace(/no/,"")},supportsTemplating:function(){var a=$("html"),b=a.hasClass("ie7"),c=a.hasClass("ie6");return!c&&!b}};jscore.module.define("browser",a)}(),function(){"use strict";var a,b={};a={listen:function(a,c){return b.hasOwnProperty(a)||(b[a]=[]),b[a].indexOf(c)===-1&&b[a].push(c),this},send:function(a,c){if(b.hasOwnProperty(a)){var d,e;for(d=0;d<b[a].length;d++)(e=b[a][d])(c)}return this}},jscore.module.define("signal",a)}(),function(){"use strict";var a=function(a){return a=a||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",a.replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})};jscore.module.define("guid",{generate:a})}(),function(){"use strict";var a,b,c=module.require("url"),d={},e="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;b=function(a){if(d.hasOwnProperty(a))return d[a]},a=function(a,b){d[a]=b},$.getJSONCached=function(a){var b=c.parse(a),d=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),f=b.origin&&b.origin!==d,g=!e&&f;return $.getCached(a,g?"jsonp":"json")},$.getCached=function(c,d){var e=b(c);return e?e:(e=$.ajax({url:c,dataType:d}),a(c,e),e)}}(),function(){"use strict";var a,b,c={};a=function(a){if(void 0===window.JSON)return c[a];var b=Modernizr.localstorage?window.localStorage[a]:$.cookie(a);if(void 0!==b&&null!==b)return window.JSON.parse(b)},b=function(a,b){if(void 0===window.JSON)return void(c[a]=b);var d=window.JSON.stringify(b);if(!Modernizr.localstorage)return void $.cookie(a,d);try{window.localStorage[a]=d}catch(a){}},$.persistentData=function(c,d){if(void 0===c.substr)throw new TypeError("$.persistentData key should be a string");return c="persistentData-"+c,void 0===d?a(c):(b(c,d),this)}}(),function(){"use strict";$.fn.exists=function(){return this.length>0},String.prototype.format=function(){var a,b=Array.prototype.slice.call(arguments),c=this.split("%s"),d="";for(a=0;a<c.length;a++)d+=c[a],d+=void 0===b[a]||null===b[a]?"":b[a];return d},$.fn.getAttributes=function(a,b,c){c=void 0===c||c;var d=c?{}:[];return this.length?($.each(this[0].attributes,function(e,f){if(void 0===a||0===f.name.indexOf(a))if(c){var g=f.name;void 0!==a&&b&&(g=f.name.substr(a.length)),d[g]=f.value}else d.push(f.value)}),d):this}}(),function(){"use strict";var a,b=jscore.module.require("settings"),c=jscore.module.require("guid"),d=!1;try{Object.defineProperty({},"test",{get:function(){},set:function(){}}),d=!0}catch(a){}a=Class.extend({TEMPLATE_NAME:"",init:function(){this.id=this.__createID()},on:function(a,b){$(this).on(a,b)},trigger:function(a,b){$(this).trigger(a,b)},_buildStateContext:function(){return{}},_draw:function(){var a,b,c=this,e=this._prepareTemplateContext(),f=$.proxy(this._injectHTML,this),g=$.proxy(this._onFirstRender,this);return a=function(a){return c._renderTemplate(a).then(f).then(function(){c.trigger("UIController:injectedHTML",a)})},this._redraw=function(){return d?c.__formalityPromise():a(b)},e.then(function(c){return b=c,a(c).then(function(){g(b)})})},_injectHTML:function(a){return this.html=a,this.html},_loadTemplate:function(){return this._fetchTemplate(this.TEMPLATE_NAME)},_fetchTemplate:function(a){var c=b.getSetting("TEMPLATE_URL")+a+".html";return $.getCached(c,"html",!0)},_onFirstRender:function(){},_prepareTemplateContext:function(){var a,b=this;return a=this._buildStateContext(),this._resolveDeferrends(a).then(function(a){var c={state:a,controller:b,literals:_t.literals};return c})},_redraw:function(){return this.__formalityPromise()},_renderTemplate:function(a){return this._loadTemplate().then(function(b){return b=$(b),rivets.bind(b,a),b})},_resolveDeferrends:function(a){var b,c=$.proxy(this._resolveDeferrends,this),d=[];return _.isObject(a)?a.then?a.then(c):(d=_.map(a,function(a,b,d){var e=function(a){d[b]=a};if(a)return a.then?a.then(c).then(e):_.isObject(a)?c(a).then(e):void 0}),$.when.apply($,d).then(function(){return a})):(b=new $.Deferred,b.resolve(a),b)},__createID:function(){return"controller-"+c.generate("xxxxxxxx")},__formalityPromise:function(a){var b=new $.Deferred;return b.resolve(a),b}}),rivets.binders.html=function(a,b){return $(a).html(b||"")},rivets.binders["data-*"]=function(a,b){return void 0!==b?a.setAttribute(this.type,""+b):a.removeAttribute(this.type)},d||(rivets.adapters["."].subscribe=function(){},rivets.adapters["."].unsubscribe=function(){}),jscore.module.define("UIController",a)}(),function(){"use strict";var a,b="application/zip",c=jscore.module.require("settings"),d=jscore.module.require("browser");a=Class.extend({init:function(a){this.resource=a,this.useAkamaiProvider=!1,this.posterImage=""},build:function(a,b,c){var d=this,e=this.resource.listFiles(a,b);return e.then(function(a){var b,e=_.groupBy(a,"track");return b=_.reduce(e,function(a,b){return a.concat(d.__filterPlaylistFiles(b,c))},[]),b=d.__convertPlaylistSchema(b)})},setPosterImage:function(a){this.posterImage=a},__convertPlaylistSchema:function(a){var b,d=this;return a=_.groupBy(a,"track"),a=_.map(a,function(a){var c={title:a[0].title,booknum:a[0].booknum,track:a[0].track,image:d.posterImage,duration:Math.round(a[0].duration)};return c.sources=_.map(a,function(a){var b;return d.useAkamaiProvider&&a.file.stream?b=a.file.stream:(b=a.file.url,d.useAkamaiProvider=!1),{height:a.frameHeight,width:a.frameWidth,bitrate:Math.round(a.bitRate),label:a.label,mimeType:a.mimetype,file:b}}),c.sources=_.sortBy(c.sources,"height").reverse(),c.markers=_.reduce(a,function(a,b){return a||(b.markers?b.markers.markers:void 0)},void 0),b=_.chain(a).sortBy("frameWidth").reverse().find(function(a){return!!a.subtitles}).value(),b&&!b.subtitled&&(c.tracks=[{file:b.subtitles.url,kind:"captions",default:!1}]),c.markers=_.map(c.markers||[],function(a){var b={};return b.startTime=d.__parseMarkerTime(a.startTime),b.duration=d.__parseMarkerTime(a.duration),b.endTime=b.startTime+b.duration,_.extend({},a,b)}),c}),a=_.map(a,function(a){return a.provider=d.useAkamaiProvider?c.getSetting("JWP_PROVIDER"):"",a})},__filterPlaylistFiles:function(a,c){var e,f,g,h,i,j=this;return c=!!c,e=_.groupBy(a,"subtitled"),f=e.true,g=e.false,i=_.reduce(a,function(a,b){return a||!!b.subtitles},!1),h=c&&!i?f?f:g:g?g:f,_.filter(h,function(a){return j.useAkamaiProvider=j.__isVideo(a.mimetype)&&!d.supportsHTML5Video()&&d.isFlashInstalled(),!(j.useAkamaiProvider&&a.frameHeight>=720)&&a.mimetype!==b})},__isVideo:function(a){return a.indexOf("video/")!==-1},__parseMarkerTime:function(a){var b=a.split(":"),c=parseFloat(b.pop(),10),d=parseInt(b.pop(),10),e=parseInt(b.pop(),10);return 60*e*60+60*d+c}}),jscore.module.define("MediaPlaylist",a)}(),function(){"use strict";var a,b="MP3",c="PDF",d="MP4",e=[b,c,d],f=jscore.module.require("MediaPlaylist");a=Class.extend({SUBTITLES_NONE:1,SUBTITLES_ONLY:2,SUBTITLES_BOTH:3,SUBTITLES_TTS:4,init:function(a){this.sourceURL=a,this.pageID=null,this.statusCode=0,this.dataset=null,this.posterImage=null},getFormattedDate:function(){return this.__fetch().then(function(a){return a.dataset.formattedDate})},getPlaylist:function(){var a,b=new f(this);return this.posterImage?b.setPosterImage(this.posterImage):this.pageID&&(a=$(".jsVideoPoster").filter("."+this.pageID).data("src"),b.setPosterImage(a)),b},getLanguage:function(a){return this.__fetch().then(function(b){return a=b.__languageCode(a),a=b.dataset.languages[a]})},getLanguageLocaleCode:function(a){return this.getLanguage(a).then(function(a){return a?a.locale:""})},getLanguageDirection:function(a){return this.getLanguage(a).then(function(a){return a?a.direction:""})},getLanguageName:function(a){return this.getLanguage(a).then(function(a){return a?a.name:""})},getParentPubName:function(){return this.__fetch().then(function(a){return a.dataset.parentPubName})},getPubName:function(){return this.__fetch().then(function(a){return a.dataset.pubName})},hasSubtitles:function(a,b){var c=this;return this.listFiles(a,b).then(function(a){var b,d,e;return b=_.find(a,function(a){return _.has(a,"subtitles")}),_.isEmpty(b)?(a=_.groupBy(a,"subtitled"),d=a.true,e=a.false,d&&e?c.SUBTITLES_BOTH:d?c.SUBTITLES_ONLY:c.SUBTITLES_NONE):c.SUBTITLES_TTS})},isSingleFile:function(){var a=this;return this.listLanguages().then(function(b){return!(Object.keys(b).length>1)&&a.__getLanguageDataset(0).then(function(a){var b,c;return b=Object.keys(a),!(b.length>1)&&(c=a[b[0]],!(c.length>1)&&c[0].file.url)})})},listAllFiles:function(a){return this.__getLanguageDataset(a).then(function(a){return a=a||{},_.reduce(a,function(a,b,c){var d=[];return b=b||[],b=_.map(b,function(a){return a.fileType=c,a}),d=_.filter(b,function(a){return a.file.url.length>0}),d.length>0&&(a=a.concat(d)),a},[])})},listFiles:function(a,b){return b=b||0,this.__getLanguageDataset(a).then(function(a){return _.isNumber(b)&&(b=Object.keys(a)[b]),a=a[b]||[],a=_.filter(a,function(a){return a.file.url.length>0})})},listFileTypes:function(b){return this.__getLanguageDataset(b).then(function(b){return a.sortFileFormats(_.keys(b))})},listLanguages:function(){return this.__fetch().then(function(a){var b,c=Object.keys(a.dataset.files);return b=_.map(a.dataset.languages,function(b,c){return b.code=c,b.isPrimary=void 0===a.dataset.files[b.code].__deferred,b}),b=_.sortBy(b,function(a){return c.indexOf(a.code)})})},listFrameHeights:function(a,b){var c=this.listFiles(a,b);return c.then(function(a){var b,c,d=[];for(c=0;c<a.length;c++)b=a[c],d.indexOf(b.frameHeight)===-1&&d.push(b.frameHeight);return d.sort(function(a,b){return b-a}),d})},listTrackNums:function(a,b){var c=this.listFiles(a,b);return c.then(function(a){var b,c,d=[];for(c=0;c<a.length;c++)b=a[c],d.indexOf(b.track)===-1&&d.push(b.track);return d.sort(function(a,b){return a-b}),d})},setPageID:function(a){this.pageID=a||null},setPosterImage:function(a){this.posterImage=a},__fetch:function(){if(this.__fetching)return this.__fetching;var b,c=this,d=new $.Deferred;return this.__fetching=d,this.sourceURL?(b=$.getJSONCached(this.sourceURL),b.done(function(e){var f,g,h,i,j=function(a){return!!a.__deferred},k=0;return c.statusCode=b.status,c.dataset=e,_.each(c.dataset.languages,function(a,b){c.dataset.languages[b].index=k++,c.dataset.languages[b].code=b}),g=Object.keys(c.dataset.files),f=_.filter(c.dataset.files,j),f.length<g.length?void d.resolve(c):(i=_.first(g),c.dataset.files[i]||d.reject(c),h=new a(c.dataset.files[i].__deferred),void h.__getLanguageDataset(i).then(function(a){c.dataset.files[i]=a,d.resolve(c)}))}),b.fail(function(){c.statusCode=b.status,c.dataset=void 0,d.reject(c)}),d):(d.reject(this),d)},__getLanguageDataset:function(b){return b=b||0,this.__fetch().then(function(c){b=c.__languageCode(b);var d,e,f=c.dataset.files[b].__deferred;return f?(d=new a(f),e=d.__fetch().then(function(a){return a.dataset.files[b]})):(e=new $.Deferred,e.resolve(c.dataset.files[b])),e})},__languageCode:function(a){return _.isFinite(parseInt(a,10))&&(a=_.find(this.dataset.languages,function(b){return b.index===a}).code),a}}),a.sortFileFormats=function(a){var b=0;return a=_.sortBy(a,function(a,b){return e.indexOf(a)!==-1?-1:e.indexOf(b)!==-1?1:0}),a=_.map(a,function(a){return{name:a,index:b++}})},jscore.module.define("PubMediaResource",a)}(),function(){"use strict";var a,b,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b=function(a){var b,c,d;for(a=a.replace(/\x0d\x0a/g,"\n"),b="",c=0;c<a.length;c++)d=a.charCodeAt(c),d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128));return b},c=function(a){for(var b="",c=0,d=0,e=0,f=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(e=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&e),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&e)<<6|63&f),c+=3);return b},a={encode:function(a){var c,e,f,g,h,i,j,k="",l=0;for(a=b(a);l<a.length;)c=a.charCodeAt(l++),e=a.charCodeAt(l++),f=a.charCodeAt(l++),g=c>>2,h=(3&c)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),k=k+d.charAt(g)+d.charAt(h)+d.charAt(i)+d.charAt(j);return k},decode:function(a){var b,e,f,g,h,i,j,k="",l=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<a.length;)g=d.indexOf(a.charAt(l++)),h=d.indexOf(a.charAt(l++)),i=d.indexOf(a.charAt(l++)),j=d.indexOf(a.charAt(l++)),b=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,k+=String.fromCharCode(b),64!==i&&(k+=String.fromCharCode(e)),64!==j&&(k+=String.fromCharCode(f));return k=c(k)}},jscore.module.define("base64",a)}(window,window.document),function(){"use strict";var a=function(a){return a};a.literals={},window._t||(window._t=a)}(),function(){"use strict";var a,b,c,d,e=jscore.module.require("browser"),f=jscore.module.require("UIController");a='<div class="jsAudioPlayerInterface"><a class="jsPlay controlElem icon" rv-title="literals.CMSPUBS.LnkTtlAttPlay"></a><a class="jsPrevious controlElem icon" rv-title="literals.CMSPUBS.LnkTtlAttPrevious"></a><a class="jsNext controlElem icon" rv-title="literals.CMSPUBS.LnkTtlAttNext"></a><!-- TODO: use CMSPUBS.LnkTtlAttPause for pause --><div class="jsElapsed controlElem text auralHide">00:00</div><div class="jsScrubber controlElem auralHide"></div><a class="jsMute controlElem icon" rv-title="literals.CMSPUBS.LnkTtlAttMute"></a><!-- TODO: use CMSPUBS.LnkTtlAttUnmute for unmute --><div class="jsRemaining controlElem text auralHide">00:00</div><audio preload="none"><p class="error" rv-text="literals.CMSPUBS.TxtPlayerFailed"></p></audio></div>',b={TEMPLATE_NAME:"AudioPlayer",activeClass:"active",singleTrackClass:"singleTrack",init:function(a,b){var c=this;this.controls=$(a),this.id=this.controls.attr("id"),this.properties=$.extend({},b),this.properties.playOne=!!this.properties.playOne,this.properties.shuffled=!!this.properties.shuffled,this.__buildPlayer(0).then(function(){c.__triggerEvent("setPlaylist"),c.playlistItem(0)}).fail(function(){c.__triggerEvent("setupError")})},getAudioPlayer:function(){return this.controls.closest(".jsAudioPlayer")},getDuration:function(){var a=this.getPlayerElem(),b=this.properties.playlist[this.currentTrack].duration;return b=b||a.duration,b=isNaN(b)?0:Math.round(b)},getElapsedTime:function(){var a=this.getPlayerElem();return Math.round(a.currentTime)},getMuteButton:function(){return this.controls.find(".jsMute")},getPlayButton:function(){return this.controls.find(".jsPlay")},getNextButton:function(){return this.controls.find(".jsNext")},getPreviousButton:function(){return this.controls.find(".jsPrevious")},getPlaylist:function(){return $.extend({},this.properties.playlist)},getPlaylistIndex:function(){return this.currentTrack},getPlaylistItem:function(){var a=this.properties.playlist[this.currentTrack];return $.extend(a,{index:this.currentTrack})},getPlayerElem:function(){return this.controls.find("audio")[0]},getPosition:function(){return this.getPlayerElem().currentTime},getRenderingMode:function(){return"html5"},getScrubber:function(){return this.controls.find(".jsScrubber")},getState:function(){return this.state},load:function(a){this.properties.shuffled&&(a=_.shuffle(a)),this.properties.playlist=a,this.playlistItem(0),this.__triggerEvent("setPlaylist")},nextTrack:function(){var a=this.currentTrack;return this.playlistItem(a+1),this.currentTrack>a&&(this.play(),!0)},previousTrack:function(){var a=this.currentTrack;return this.playlistItem(a-1),this.currentTrack<a&&(this.play(),!0)},pause:function(){var a=this.getPlayerElem();a&&a.pause()},play:function(){var a=this.getPlayerElem();a&&($(a).attr("preload","auto"),a.play())},playlistItem:function(a){var b=this.properties.playlist[a],c=this.getPlayerElem();b&&(this.pause(),c.src=b.sources[0].file,c.type=b.sources[0].mimeType,this.getPlayButton().removeClass(this.activeClass),this.state="IDLE",this.currentTrack=a,this.__handleTimeUpdate(),this.__triggerEvent("setPlaylistItem"))},seek:function(a){this.disableSeeking||(this.__setCurrentTime(a),this.play())},setMute:function(a){var b=this.getMuteButton();b.hasClass(this.activeClass)!==a&&b.click()},stop:function(){this.pause(),this.__setCurrentTime(0),this.state="IDLE",this.__triggerEvent("idle")},setPlayOne:function(a){this.properties.playOne=a},setShuffled:function(a){var b,c=this.properties.playlist[this.currentTrack],d=[];this.properties.shuffled=a,this.properties.shuffled?(this.currentTrack=0,b=this.properties.playlist,"IDLE"!==this.getState()&&(b=_.without(b,c),d=[c]),b=_.shuffle(b),this.properties.playlist=_.union(d,b),"IDLE"===this.getState()&&this.playlistItem(this.currentTrack)):(this.properties.playlist=_.sortBy(this.properties.playlist,"track"),this.currentTrack=_.indexOf(this.properties.playlist,c))},_loadTemplate:function(){return $.Deferred().resolve(a)},__addPlayerEventListeners:function(){var a=this.getPlayerElem(),b=this.getPlayButton(),c=this.getNextButton(),d=this.getPreviousButton(),f=this.getMuteButton(),g=this.getScrubber(),h=$.proxy(this.__handleBufferingStatus,this),i=$.proxy(this.__handleTimeUpdate,this),j=this;a.addEventListener("timeupdate",i),a.addEventListener("ended",function(){j.__triggerEvent("playlistItemComplete"),!j.properties.playOne&&j.nextTrack()||(j.stop(),j.__triggerEvent("playlistComplete"))}),a.addEventListener("play",function(){b.addClass(j.activeClass),j.state="PLAYING",j.__triggerEvent("play")}),a.addEventListener("pause",function(){b.removeClass(j.activeClass),j.state="PAUSED",j.__triggerEvent("pause")}),a.addEventListener("error",function(){j.__triggerEvent("error")}),a.addEventListener("play",h),a.addEventListener("progress",h),a.addEventListener("timeupdate",h),g.on("slide",i),g.on("slidechange",function(){var a=j.getElapsedTime(),b=g.slider("value");a!==b&&j.__setCurrentTime(b)}),g.on("slidestart",function(){j.scrubbing=!0}),g.on("slidestop",function(){j.scrubbing=!1}),b.click(function(){b.hasClass(j.activeClass)?j.pause():j.play()}),c.click(function(){j.nextTrack()}),d.click(function(){j.previousTrack()}),f.click(function(){a.muted=!f.hasClass(j.activeClass),a.muted?f.addClass(j.activeClass):f.removeClass(j.activeClass)}),e.supportsAudioMuteControl()||this.controls.addClass("jsNoMute")},__buildPlayer:function(a){var b=this.properties.playlist[a],c=this;return b?this._prepareTemplateContext().then(function(a){return c._renderTemplate(a)}).then(function(b){c.controls.replaceWith(b),c.controls=b,c.properties.playlist.length<=1?c.getAudioPlayer().addClass(c.singleTrackClass):c.getAudioPlayer().removeClass(c.singleTrackClass),c.getScrubber().slider({range:"min",min:0,max:0}),c.__addPlayerEventListeners(),c.currentTrack=a,c.__handleTimeUpdate()}):(this.state="IDLE",this.__triggerEvent("idle"),$.Deferred().reject("Playlist item at index "+a+" does not exist"))},__handleBufferingStatus:function(){var a,b=this.getPlayerElem(),c=b.currentTime;try{a=b.buffered.end(0)}catch(b){a=0}"IDLE"!==this.getState()&&a<=0&&c<=0||a>0&&a<=c?this.__openLoadingIndicator():this.__closeLoadingIndicator()},__handleTimeUpdate:function(){var a,b,c,d,e,f,g,h,i=this.getDuration(),j="%s:%s",k=this.getScrubber(),l=function(a){return("00"+a).slice(-2)};if(e=this.scrubbing?k.slider("value"):this.getElapsedTime(),f=Math.floor(e/60),g=e%60,a=i-e,b=Math.floor(a/60),c=a%60,h=j.format(l(f),l(g)),this.controls.find(".jsElapsed").html(h),d=j.format(l(b),l(c)),this.controls.find(".jsRemaining").html(d),!this.scrubbing){this.disableSeeking=!0;try{k.slider("option","min",0),k.slider("option","max",i),k.slider("value",e)}catch(a){}this.disableSeeking=!1}this.__triggerEvent("time")},__openLoadingIndicator:function(){if(!(this.controls.find(".jsPlayerLoading").length>0)){var a=$("<div></div>");a.addClass("jsPlayerLoading"),a.css("opacity",0),this.loadingIndicatorStatus=!0,this.controls.prepend(a),a.animate({opacity:.85},"fast")}},__closeLoadingIndicator:function(){var a=this.controls.find(".jsPlayerLoading");0!==a.length&&a.animate({opacity:0},"fast",function(){a.remove()})},__registerEvent:function(a,b){this.controls.parent().bind(a,b)},__setCurrentTime:function(a){var b,c,d,e=this.getPlayerElem();!this.disableSeeking&&e&&(b=function(){c=e.seekable.start(0),d=e.seekable.end(0),a=Math.min(d,a),a=Math.max(c,a),e.currentTime=a},"IDLE"===this.getState()?$(e).one("durationchange playing",b):b())},__triggerEvent:function(a){this.controls.parent().trigger(a)}},c={onComplete:"playlistItemComplete",onPlaylistComplete:"playlistComplete",onError:"error",onIdle:"idle",onPause:"pause",onPlay:"play",onPlaylist:"setPlaylist",onPlaylistItem:"setPlaylistItem",onReady:"ready",onSeek:"seek",onSetupError:"setupError",onTime:"time"},_.each(c,function(a,c){b[c]=function(b){this.__registerEvent(a,b)}}),d=f.extend(b),jscore.module.define("AudioPlayer",d)}(),function(){"use strict";var a,b=jscore.module.require("settings"),c=jscore.module.require("browser"),d=jscore.module.require("signal"),e=jscore.module.require("AudioPlayer"),f={},g="showing",h="disabled";a=function(b,i,j,k,l){var m=this.buildProperties(i,j),n=$(b).attr("id"),o=27,p=this;if(n||(n="MediaPlayer-%s".format($.expando),$(b).attr("id",n)),1!==b.length)throw new Error("Element #"+n+" should exist before instantiating MediaPlayer");this.trackIdentifierField=l||!1,this.id=n,$(b).parent().before(this.buildAccessibilityLinks()),$(b).parent().on("remove",function(){p.remove()}),void 0!==k?this.player=k:!j&&c.supportsMP3Audio()?this.player=new e(b,m):this.player=jwplayer(n).setup(m),this.player.onSetupError(function(c){$(b).html(a.getSetupError())}),this.player.hasCaptionsActive=!1,this.bind("ready",function(){var a,b,c,d=$(this.container).find("video");$("div.jwclick").remove(),$(this.container).keydown(function(a){a.keyCode===o&&a.stopPropagation()}),d.length&&(a=d.get(0),b=this,c=function(b){setTimeout(function(){_.each(a.textTracks,function(a){a.mode=b})},0)},a.addEventListener("webkitbeginfullscreen",function(){var a=b.hasCaptionsActive?g:h;c(a)},!1),a.addEventListener("webkitendfullscreen",function(){c(h)},!1))}),f[n]=this,this.bind("play",function(){d.send("requestSilence",p.id)})},a.GENERIC_ERROR=$("<p class='mediaPlayer error'>"+_t("CMSPUBS.TxtNoFilesErr")+"</p>"),a.getSetupError=function(){var a,b=$("<div></div>");return a="<p>"+_t("CMSPUBS.TxtPlayerFailed")+"</p>",a+="<p>"+_t("CMSPUBS.TxtNoFlash")+" ",a+='<a target="_blank" href="http://get.adobe.com/flashplayer/">'+_t("CMSPUBS.TxtUpdateFlash")+"</a>",a+="</p>",b.append(a),b.addClass("error jwtext"),b},a.getInstance=function(a){return a instanceof String||"string"==typeof a||(a=$(a).data("mediaplayer")),f[a]},a.prototype={buildAccessibilityLinks:function(){var a=$('<div class="accessibilityControls"></div>'),b=$("<a></a>"),c=$("<a></a>"),d=$("<a></a>"),e=$("<a></a>"),f=this;return b.html(_t("CMSPUBS.LnkTtlAttPlay")),c.html(_t("CMSPUBS.LnkTtlAttPause")),d.html(_t("CMSPUBS.LnkTtlAttMute")),e.html(_t("CMSPUBS.LnkTtlAttUnmute")),b.click(function(){f.play()}),c.click(function(){f.pause()}),d.click(function(){f.setMute(!0)}),e.click(function(){f.setMute(!1)}),a.append(b),a.append(c),a.append(d),a.append(e),a},bind:function(a,b){var c,d,e;if(a&&b&&b instanceof Function)for(c={playlistAltered:"onPlaylist",trackChanged:"onPlaylistItem",playlistComplete:"onPlaylistComplete",play:"onPlay",pause:"onPause",idle:"onIdle",playlistItemComplete:"onComplete",seek:"onSeek",fullscreen:"onFullscreen",time:"onTime",ready:"onReady"},a instanceof Array||(a=[a]),e=0;e<a.length;e++)d=c[a[e]],this.player[d]&&this.player[d](b)},buildProperties:function(a,d){var e,f,g=!c.supportsHTML5Video();for(f=0;f<a.length;f++)if(a[f].provider){g=!0;break}return e={width:"100%",base:b.getSetting("JWP_BASE"),fallback:!1,height:d?"100%":36,primary:g?"flash":"html5",playlist:a,skin:b.getSetting("JWP_SKIN"),cast:{appid:b.getSetting("CAST_APPID"),loadscreen:b.getSetting("CAST_LOAD_SCREEN"),endscreen:b.getSetting("CAST_END_SCREEN"),logo:b.getSetting("CAST_LOGO"),railcolor:b.getSetting("CAST_RAIL_COLOR")},logo:{hide:!0},analytics:{cookies:!1,enabled:!1},abouttext:$("title").html(),aboutlink:window.location.href,displaytitle:!1}},getPlaylist:function(){return this.player.getPlaylist()},getPlaylistIndex:function(){return this.player.getPlaylistIndex()},getCurrentTrack:function(){return this.player.getPlaylistItem()},getCurrentTrackID:function(){var a=this.getCurrentTrack();return this.trackIDForTrack(a)},getPlayerID:function(){return this.player.id},getPosition:function(){return this.player.getPosition()},getStatus:function(){return this.player.getState()},isPlayerOk:function(){return void 0!==this.player.getRenderingMode()},pause:function(){this.player.pause(!0)},play:function(){this.player.play(!0)},remove:function(){var a=this.getPlayerID();this.pause(),delete f[a];try{jwplayer.api.destroyPlayer(a)}catch(a){}},stop:function(){this.player.stop()},setMute:function(a){this.player.setMute(a)},setPlaylist:function(a){this.getStatus()&&this.player.load(a)},setPosition:function(a){this.player.seek(a)},setPlayOne:function(a){_.isFunction(this.player.setPlayOne)&&this.player.setPlayOne(a)},setShuffled:function(a){_.isFunction(this.player.setShuffled)&&this.player.setShuffled(a)},skipTo:function(a){this.player.playlistItem(a)},skipToTrack:function(a){this.skipTo(this.__findIndexOfTrackID(a))},toggleCaptions:function(a){var b=a?1:0;this.player&&this.player.setCurrentCaptions&&(this.player.setCurrentCaptions(b),this.player.hasCaptionsActive=a,$.removeCookie("jwplayer.captionLabel",{path:"/"}))},trackIDForTrack:function(a){if(a)return this.trackIdentifierField?a[this.trackIdentifierField]:_.pluck(this.getPlaylist(),"track").indexOf(a.track)},__findIndexOfTrackID:function(a){return this.trackIdentifierField?_.pluck(this.getPlaylist(),this.trackIdentifierField).indexOf(a):a}},d.listen("requestSilence",function(a){_.each(f,function(b){b.id!==a&&b.pause()})}),jwplayer.key=b.getSetting("JWP_LICENSE"),jscore.module.define("MediaPlayer",a)}();
//# sourceMappingURL=js-core.js.map