var header=function($,headerConfig,undefined){"use strict";function ajax(options){options.testResponse?setTimeout(function(){options.success(options.testResponse)},settings.testing.ajaxDelay||500):$.ajax($.extend({},{dataType:"jsonp",cache:!1,timeout:settings.jQueryTimeout},options))}function bindBusEvents(){if(window.acom&&window.acom.bus)window.acom.bus.on("PersonHintTab::hintcount_change::pending",function(){header.updateUserData("hints")});else setTimeout(function(){if(window.acom&&window.acom.bus)window.acom.bus.on("PersonHintTab::hintcount_change::pending",function(){header.updateUserData("hints")})},500)}function bindDnaLoad(){function loadDna(){$("#nav, #navDnaMenu").off(".nav.dna");loadSubMenu(settings.dnaUrl+"/rest/headerinfo",renderDna,"dna")}if(settings.isLoggedIn&&$("#navDna").attr("aria-haspopup")==="true"){$("#nav").one("focusin.nav.dna mouseenter.nav.dna","#navDna",loadDna);$("#navDnaMenu").one("focusin.nav.dna mouseenter.nav.dna touchstart.nav.dna",loadDna)}}function bindEvents(){bindSubMenus();bindSkipLink();bindBusEvents();bindOutlineFix();bindLanguageToggle();bindDnaLoad()}function bindExpertWarning(){$("#nav").on("click.nav",'a[href*="//www.progenealogists.com"]',expertWarning);$('#nav a[href*="//www.progenealogists.com"]').on("click.nav",expertWarning)}function bindLanguageToggle(){$(".navLanguageToggle").on("click",function(){var languageId=$(this).data("language-id"),languageName=$(this).data("language-name"),daysToExpiration=3560,windowLoc,newWindowLoc;setDictionaryCookie("VARS","LCID",languageId,null,daysToExpiration);setDictionaryCookie("VARS","LCISONAME",languageName,null,daysToExpiration);windowLoc=""+window.location;newWindowLoc=windowLoc.replace(/lcid=\d{4}/ig,"lcid="+languageId);windowLoc===newWindowLoc?window.location.reload():window.location=newWindowLoc})}function bindOutlineFix(){function usingKeyboard(e){if(e.which===9)$body.removeClass("mouseEvents").off("keydown.outline").one("mousedown.outline",usingMouse)}function usingMouse(){$body.addClass("mouseEvents").on("keydown.outline",usingKeyboard)}var $body=$("body");$body.one("mousedown.outline",usingMouse)}function bindSeeMoreDnaButton(){$("#navSeeMoreDnaNotifications").off("click.nav").on("click.nav",function(){var $navDnaNotificationsList=$("#navDnaNotificationsList"),$lastVisibleItem=$navDnaNotificationsList.find(".navListItem:visible").last();$navDnaNotificationsList.find(".navListItem").addClass("navShowListItem");$lastVisibleItem.next().find("a").addClass("navHideHighlight").focus().one("focusout",function(){$(this).removeClass("navHideHighlight")});handleDisplayOfSeeMoreDnaButton()})}function bindSkipLink(){$("#nav").on("keydown.nav","#navSkip",function(e){var $target=$($(this).attr("href"));if(e.keyCode===13||e.keyCode===32){if(!$target.attr("tabindex"))$target.attr("tabindex","-1").one("blur.nav",function(){$target.removeAttr("tabindex")});return $target.focus(),!1}})}function bindSubMenus(){var $window=$(window);$window.on("resize.nav",debounce(function(){destroyHiddenSubMenus();initCalloutSubMenus()},200));initSubMenus()}function bindCartTracking(){$("#navCartCheckout, #navCartEmpty").on("click",function(){fireTracking("Header Cart : "+$(this).data("tracking-name"))})}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null;immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);callNow&&func.apply(context,args)}}function fireTracking(trackingName){window.sc_npv?window.sc_npv&&window.sc_npv("eVar70",trackingName,0):console.warn("Omniture Unavailable : "+trackingName)}function clearHints(){var options={url:settings.hintsClearAllUrl+"?customerId="+settings.userId,success:function(data){data&&$("#navHints").find(".badge").fadeOut(function(){$(this).addClass("noDisplay").css("display","")})}};ajax(options)}function clearCart(){var options={url:settings.clearCartUrl+"?customerId="+settings.userId,success:function(data){data&&($("#navCart").remove(),$(".navSecondaryMenu .navEmphasizedButton").removeClass("noDisplay"))}};ajax(options)}function clearDnaNotifications(){$("#navDnaNotifications").find(".badge").fadeOut(function(){$(this).addClass("noDisplay").css("display","")})}function correctDomLocation(){var $HeaderRegion=$("#HeaderRegion");$HeaderRegion.closest("#GlobalWrpr").length&&$("body").outerWidth()>$HeaderRegion.outerWidth()&&$HeaderRegion.insertBefore("#GlobalWrpr");$HeaderRegion.css({height:"","min-height":""})}function destroyHiddenSubMenus(){$("#nav .initialized[aria-owns]:not(:visible)").removeClass("initialized").off("keyup.nav keydown.nav").callout("destroy")}function expertWarning(e){var $progenLogo=$("div.navProgenLogo");$progenLogo.length&&$progenLogo.replaceWith('<img class="navProgenLogo" alt="'+$progenLogo.data("alt")+'" src="'+$progenLogo.data("src")+'" />');$("#progenLeavingAncestryModal").modal({width:500});e.preventDefault()}function getDateHtml(birth,death){return birth&&death?"<em>"+birth+" - "+death+"<\/em>":birth?"<em>"+birth+"<\/em>":death?"<em>"+death+"<\/em>":""}function getCss(){var url=settings.cacheDomain+"/lib/tgn/combo.ashx",unloadedCount=0,divider="?x",loaded="";(cssAssetsRequested=!0,$('link[href*=".css"]').each(function(){loaded+=$(this).attr("href").toLowerCase()}),loaded.indexOf("/css/core.css")===-1)&&($.each(["/css/v1/main.css","/css/v2/alert.css","/css/v1/button.css","/css/v1/callout.css","/css/v1/icon.css","/css/v3/modal.css","/css/v1/user-card.css"],function(i,value){loaded.indexOf(value)===-1&&(url+=divider+value,divider="&x",unloadedCount++,warn(value))}),unloadedCount>0&&$("head").append('<link href="'+url+'" rel="stylesheet" />'))}function getJs(){var url=settings.cacheDomain+"/lib/tgn/combo.ashx",unloadedCount=0,divider="?x",loaded="";($("script[src]").each(function(){loaded+=$(this).attr("src")}),jsAssetsRequested=!0,loaded.indexOf("/js/core.js")===-1)&&($.each(["/js/v1/callout.js","/js/v3/modal.js"],function(i,value){loaded.indexOf(value)===-1&&(url+=divider+value,divider="&x",unloadedCount++,warn(value))}),unloadedCount>0&&$("<script />",{src:url}).appendTo("head"))}function initCalloutSubMenus(){$("#nav [aria-owns]:visible:not(.initialized)").addClass("initialized link").each(function(){var $this=$(this),hasUnviewedBadge,badgeTimer,submenuId="#"+$this.attr("aria-owns"),$submenu=$(submenuId),isBadgeable=$this.hasClass("navMainLink"),isHintsMenu=$this.hasClass("navHints"),isCartMenu=$this.hasClass("navCart"),isDnaNotificationsMenu=$this.hasClass("navDnaNotifications"),allowClick=!$this.closest(".navSecondaryMenu").length;$this.callout({allowClick:allowClick,content:$submenu,classes:"calloutMenu navCalloutMenu",hideDelay:500,disableAutofocusOnOpen:!0,onOpen:function($trigger){var $badge=$trigger.find(".badge:visible");if(hasUnviewedBadge=$badge.length,$trigger.add($submenu).attr("aria-expanded",!0),settings.isLoggedIn&&(obj.updateUserData(submenuId.toLowerCase().replace("#nav","").replace("menu","")),$trigger.data("already-loaded",!0)),isBadgeable&&settings.isLoggedIn){hasUnviewedBadge&&(badgeTimer=setTimeout(function(){$submenu.find(".badge").attr("data-badge-viewed",!0);$badge.animate({"margin-right":-$badge.outerWidth(),opacity:0},function(){$(this).remove()}).prev(".navSpacer").animate({"margin-right":-$badge.prev(".navSpacer").outerWidth()},function(){$(this).remove()});setBadgeCookie()},1e3));$submenu.off("click.nav.badge").on("click.nav.badge","a:has(.badge[data-badge-viewed])",function(){$(this).find(".badge[data-badge-viewed]").attr("data-badge-clicked",!0);setBadgeCookie()})}if(isCartMenu){$("#navCartEmpty").on("click.nav",function(){$trigger.callout("close");clearCart()});fireTracking("Header Cart : Opened")}else isHintsMenu&&hasUnviewedBadge?badgeTimer=setTimeout(clearHints,3e3):isDnaNotificationsMenu&&hasUnviewedBadge&&(badgeTimer=setTimeout(clearDnaNotifications,3e3))},onClose:function($trigger){$trigger.add($submenu).attr("aria-expanded",!1);hasUnviewedBadge&&clearTimeout(badgeTimer);isCartMenu&&$("#navCartEmpty").off("click.nav")}});$this.on("keyup.nav",function(e){e.keyCode===32&&$this.callout("open")});$submenu.data("$trigger",$this)}).on("keydown.nav",function(e){var $this=$(this),$subMenuItems=$("."+$this.attr("aria-owns")).find("a:visible");return e.keyCode===40||e.keyCode===32?($subMenuItems.first().focus(),!1):e.keyCode===38?($subMenuItems.last().focus(),!1):e.keyCode===32&&$this.data("submenu-type")!=="hover"?($this.callout("open"),!1):void 0})}function initSubMenus(){var $nav=$("nav"),navVersion=$nav.data("nav-version");$nav.find(".navSubMenu").addClass(navVersion);initCalloutSubMenus();$nav.on("focusout.nav",function(){var $activeCalloutTrigger=$(".calloutTrigger.active");setTimeout(function(){!$(":focus").closest(".calloutContent").length&&$activeCalloutTrigger.hasClass("active")&&$(":focus").length&&$activeCalloutTrigger.callout("close")},200)});$(".navSubMenu").on("keydown.nav","a, .link",function(e){if(!$(this).closest(".navMobileMenu").length)return handleKeyboardNavigation(e,$(this),$(this).closest(".navSubMenu"))});$(".navMobileMenu").on("keydown.nav","a",function(e){return handleKeyboardNavigation(e,$(this),$(this).closest(".navMobileMenu"))}).on("click.nav expandSubMenu.nav",".calloutMenuTitle",function(){$(this).closest(".navSubMenu").toggleClass("navSubMenuExpanded").siblings(".navSubMenu").removeClass("navSubMenuExpanded")});if(settings.isLoggedIn)$("#navSeeAllHintsIn").on("click.nav",function(){var $trigger=$(this),$navSeeAllHintsMenu=$("#navSeeAllHintsMenu");$navSeeAllHintsMenu.hasClass("noDisplay")?($trigger.attr("aria-expanded",!0),$navSeeAllHintsMenu.removeClass("noDisplay")):($trigger.attr("aria-expanded",!1),$navSeeAllHintsMenu.addClass("noDisplay"))})}function jsIsLoaded(){return $.callout&&$.modal?!0:!1}function getStaticAssets(){return suppressAssetInjection?!0:(cssAssetsRequested||getCss(),jsAssetsRequested||getJs(),cssAssetsRequested&&jsIsLoaded())?!0:!1}function getCookie(name){for(var cookie,cookieName=name+"=",cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){for(cookie=cookies[i];cookie.charAt(0)==" ";)cookie=cookie.substring(1);if(cookie.indexOf(cookieName)===0)return cookie.substring(cookieName.length,cookie.length)}return""}function setCookie(cookieName,value,daysUntilExpiration){var d,expires;d=new Date;d.setTime(d.getTime()+daysUntilExpiration*864e5);expires="expires="+d.toUTCString();document.cookie=cookieName+"="+value+"; "+expires+";domain=."+settings.cookieDomain+";path=/"}function deleteCookie(cookieName){document.cookie=cookieName+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}function setDictionaryCookie(cookie_name,key,value,path,daysUntilExpiration){cookie_name=cookie_name.toUpperCase();key=key.toUpperCase();var dict_src,start_key,end_key,dictionary=getCookie(cookie_name);dictionary===null||dictionary===undefined?dictionary=key+"="+value:(dict_src=dictionary.toLowerCase(),start_key=dict_src.indexOf(key.toLowerCase()+"="),start_key===-1?(dictionary.length>0&&(dictionary=dictionary+"&"),dictionary=dictionary+key+"="+value):(end_key=dict_src.indexOf("&",start_key),end_key===-1?dictionary=start_key===0?key+"="+value:dictionary.substring(0,start_key)+key+"="+value:(dict_src=dictionary,dictionary="",start_key>0&&(dictionary=dict_src.substring(0,start_key)),dictionary=dictionary+key+"="+value,dictionary=dictionary+dict_src.substring(end_key))));setCookie(cookie_name,dictionary,daysUntilExpiration)}function setBadgeCookie(){var badges=retrieveBadgesFromCookie()||{},newViewedBadgeIds=[],newClickedBadgeIds=[];$(".navSubMenu").find(".badge[data-badge-id]").each(function(){var $this=$(this);$this.attr("data-badge-viewed")&&newViewedBadgeIds.push($this.attr("data-badge-id"));$this.attr("data-badge-clicked")&&newClickedBadgeIds.push($this.attr("data-badge-id"))});newViewedBadgeIds.length||newClickedBadgeIds.length?(badges[settings.userId]={},newViewedBadgeIds.length&&(badges[settings.userId].viewed=newViewedBadgeIds),newClickedBadgeIds.length&&(badges[settings.userId].clicked=newClickedBadgeIds),setCookie(badgeCookieName,JSON.stringify(badges),90)):deleteCookie(badgeCookieName)}function retrieveUserBadgesFromCookie(){var badges=retrieveBadgesFromCookie();return badges[settings.userId]?badges[settings.userId]:!1}function retrieveBadgesFromCookie(){var badges=getCookie(badgeCookieName);return badges.length?JSON.parse(badges):!1}function handleKeyboardNavigation(e,$link,$menu){var $newLink,$closestSubMenu,isMobileMenu=$menu.hasClass("navMobileMenu"),$subMenuItems=$menu.find("a:visible, button:visible"),currentIndex=$subMenuItems.index($link),subMenuItemsCount=$subMenuItems.length;return e.keyCode===40?($newLink=$subMenuItems.eq(currentIndex+1>=subMenuItemsCount?0:currentIndex+1),isMobileMenu&&($closestSubMenu=$newLink.closest(".navSubMenu"),$closestSubMenu.hasClass("navSubMenuExpanded")||$closestSubMenu.find(".calloutMenuTitle").trigger("expandSubMenu.nav")),$newLink.focus(),!1):e.keyCode===38?($newLink=$subMenuItems.eq($subMenuItems.index($link)-1),isMobileMenu&&($closestSubMenu=$newLink.closest(".navSubMenu"),$closestSubMenu.hasClass("navSubMenuExpanded")||$closestSubMenu.find(".calloutMenuTitle").trigger("expandSubMenu.nav")),$newLink.focus(),!1):void 0}function handleFailedMenu(loadingSpot){$(loadingSpot).callout("destroy")}function handleBadges(){var now=Date.now(),badges=retrieveUserBadgesFromCookie();$("#navMobileMenu").find(".navSubMenu").each(function(){var $this=$(this),count=0;$this.find(".badge").each(function(){var $badge=$(this),id=$badge.attr("data-badge-id"),expiration=Date.parse($badge.attr("data-badge-expiration")),countBadge=!0;(badges&&badges.viewed&&badges.viewed.indexOf(id)!==-1||expiration<=now)&&(countBadge=!1,$badge.attr("data-badge-viewed",!0));!badges||badges&&!badges.clicked||badges&&badges.clicked&&badges.clicked.indexOf(id)===-1?expiration>now&&$badge.removeClass("noDisplay"):$badge.attr("data-badge-clicked",!0);countBadge&&count++});count>0&&$("#"+$this.attr("aria-labelledby")).children(".badge").remove().end().append(" "+templates.templateBadge.replace("{text}",count))})}function loadSubMenu(url,callback,key){var currentTime=Date.now(),options={url:url,success:callback,error:callback};settings.testing&&(options.testResponse=settings.testing[key]);currentTime>(lastRequestedTime[key]||0)+5e3&&(lastRequestedTime[key]=currentTime,ajax(options))}function renderUsername(username,userImage){var $accountImage=$("#navAccountImage"),$mobileAccountImage=$("#navAccountMobileImage"),$accountUsernames=$("#navAccountUsername, #navAccountMobileUsername");userImage?($accountImage.replaceWith('<span class="userCardImg userCardImgCenter" id="navAccountImage" style="background-image:url(\''+userImage+'\');"><img class="navUserImage" src="'+userImage+'" alt="'+username+'" /><\/span>'),$mobileAccountImage.replaceWith('<div aria-hidden="true" class="userCardImg" id="navAccountMobileImage"><img src="'+userImage+'" alt="'+username+'" /><\/div>')):($accountImage.replaceWith('<span class="userCardImg icon iconPerson" id="navAccountImage"><\/span>'),$mobileAccountImage.replaceWith('<div aria-hidden="true" class="userCardImg icon iconPerson" id="navAccountMobileImage"><\/div>'));$accountUsernames.html(username)}function renderUpsellLink(url,text,isFullAccessFreeTrialer){var $expertLink=$("#navLinkExpert");$(".navSecondaryMenu, .navMobileMenu").children(".navEmphasizedButton, .navEmphasizedTitle, .navEmphasizedExpertButton").remove();url||isFullAccessFreeTrialer||!$expertLink.length?url&&($(".navSecondaryMenu").prepend(templates.templateEmphasizedButton.replace("{url}",url).replace("{text}",text)),$(".navMobileMenu").append(templates.templateEmphasizedMobileButton.replace("{url}",url).replace("{text}",text))):(url=$expertLink.attr("href"),text=$expertLink.text(),$(".navSecondaryMenu").prepend(templates.templateEmphasizedButton.replace("{url}",url).replace("{text}",text).replace("navEmphasizedButton","navEmphasizedExpertButton")))}function updateCartLinks(cart){cart?($("#navCartCheckout, #navCart").attr("href",cart[0].checkoutUrl),$("#navCart").removeClass("noDisplay"),$(".navSecondaryMenu .navEmphasizedButton, .navSecondaryMenu .navEmphasizedExpertButton").addClass("noDisplay")):($("#navCart").addClass("noDisplay"),$(".navSecondaryMenu .navEmphasizedButton, .navSecondaryMenu .navEmphasizedExpertButton").removeClass("noDisplay"))}function objectsAreIdentical(obj1,obj2){return JSON.stringify(obj1)===JSON.stringify(obj2)}function renderDna(data){var i,menuLength=0,menuList="",$navDna=$("#navDna"),$navDnaMenu=$(".navDnaMenu");if(data&&(data=data.results),!data||!data.menuitems)return!1;for(menuLength=data.menuitems.length,i=0;i<menuLength;i+=1)menuList+='<li><a href="'+data.menuitems[i].url+'">'+data.menuitems[i].text+"<\/a><\/li>";$navDnaMenu.find("ul").html(menuList);$navDna.data("calloutInstance")&&$navDna.callout("position")}function renderTrees(data){var i,menuLength=0,menuList="",currentTree,isCurrentTree=!1,$navTrees=$("#navTrees"),$navTreesMenu=$("#navTreesMenu");if(data.success!==!0&&!$navTreesMenu.data("currentData"))return handleFailedMenu("#navTrees"),!1;if(data.success!==!0||objectsAreIdentical($navTreesMenu.data("currentData"),data))return!1;for($navTreesMenu.data("currentData",data),currentTree=data.mostRecentlyViewedTreeId||!1,menuLength=data.menuitems.length,i=0;i<menuLength;i++)isCurrentTree=currentTree&&data.menuitems[i].url.indexOf(currentTree)!==-1,menuList+="<li><a "+(isCurrentTree?'class="calloutMenuChecked iconAfter iconAfterCheck" ':"")+'href="'+data.menuitems[i].url+'">'+data.menuitems[i].text+"<\/a><\/li>",isCurrentTree&&$navTrees.attr("href",data.menuitems[i].url);$navTreesMenu.find("ul").html(menuList).one("click.nav","a",function(){ajax({url:settings.clearUserDataUrl+"?trees=true"})});hideLoadingMessageOnSubmenu("#navTreesMenu");$navTrees.data("calloutInstance")&&$navTrees.callout("position")}function renderMessages(data){var i,menuLength,html="",item="",$navMessagesMenu=$("#navMessagesMenu");if(data.success!==!0&&!$navMessagesMenu.data("currentData"))return handleFailedMenu("#navMessages"),!1;if(data.success!==!0||objectsAreIdentical($navMessagesMenu.data("currentData"),data))return!1;if($navMessagesMenu.data("currentData",data),menuLength=data.menuitems.length,menuLength>0){for(i=0;i<menuLength;i+=1)item=templates.templateNotification.replace("{url}",data.menuitems[i].url).replace("{unread}",data.menuitems[i].unread?"navUnread":""),item=data.menuitems[i].img&&data.menuitems[i].img.length?item.replace("{image}",templates.templateNotificationUsercardImage.replace("{imageUrl}",data.menuitems[i].img)):item.replace("{image}",templates.templateNotificationUsercardIcon.replace("{icon}","Person")),item=item.replace("{title}",data.menuitems[i].username).replace("{badge}",data.menuitems[i].unread?templates.templateBadge.replace("{text}",templates.templateNew):"").replace("{subtitle}",data.menuitems[i].text).replace("{meta}",data.menuitems[i].date+", "+data.menuitems[i].subject),html+=item;$("#navMessagesList").html(html);$("#navNoMessages").addClass("noDisplay");$("#navHasMessages").removeClass("noDisplay")}else $("#navNoMessages").removeClass("noDisplay"),$("#navHasMessages").addClass("noDisplay");hideLoadingMessageOnSubmenu("#navMessagesMenu")}function renderHints(data){var i,meta,html="",item="",hintIcon,menuLength,treesLength,$navHintsMenu=$("#navHintsMenu");if(data.success!==!0&&!$navHintsMenu.data("currentData"))return handleFailedMenu("#navHints"),!1;if(data.success!==!0||objectsAreIdentical($navHintsMenu.data("currentData"),data))return!1;if($navHintsMenu.data("currentData",data),menuLength=data.menuitems.length,treesLength=data.trees.length,menuLength>0){for(i=0;i<menuLength;i+=1)hintIcon=data.menuitems[i].type==="Person"?"Person":data.menuitems[i].type==="Photo"?"Image":data.menuitems[i].type==="Story"?"Story":"Note",meta=getDateHtml(data.menuitems[i].birth,data.menuitems[i].death),meta.length&&treesLength>1&&(meta+=", "),meta+=treesLength>1?data.menuitems[i].treeName:"",item=templates.templateNotification.replace("{url}",data.menuitems[i].url).replace("{unread}",data.menuitems[i].unread?"navUnread":"").replace("{image}",templates.templateNotificationUsercardIcon.replace("{icon}",hintIcon)).replace("{title}",data.menuitems[i].title).replace("{badge}",data.menuitems[i].unread?templates.templateBadge.replace("{text}",templates.templateNew):"").replace("{subtitle}",data.menuitems[i].name).replace("{meta}",meta),html+=item;$("#navHintsList").html(html);$("#navNoHints").addClass("noDisplay");$("#navHasHints").removeClass("noDisplay")}else $("#navNoHints").removeClass("noDisplay"),$("#navHasHints").addClass("noDisplay");if(treesLength>1){for(html="",i=0;i<treesLength;i+=1)html+='<li><a href="'+data.trees[i].url+'">'+data.trees[i].text+"<\/a><\/li>";$("#navSeeAllHintsMenu").html(html);$("#navSeeAllHints").addClass("noDisplay");$("#navSeeAllHintsIn").removeClass("noDisplay")}else $("#navSeeAllHints").removeClass("noDisplay"),$("#navSeeAllHintsIn").addClass("noDisplay");hideLoadingMessageOnSubmenu("#navHintsMenu")}function renderDnaNotifications(data){var i,menuLength,gender,html="",item,genderIcon,$navDnaNotificationsMenu=$("#navDnaNotificationsMenu");if(data.success!==!0&&!$navDnaNotificationsMenu.data("currentData"))return handleFailedMenu("#navDnaNotifications"),!1;if(data.success!==!0||objectsAreIdentical($navDnaNotificationsMenu.data("currentData"),data))return!1;if($navDnaNotificationsMenu.data("currentData",data),menuLength=data.menuitems.length,menuLength>0){for(i=0;i<menuLength;i+=1)item=templates.templateNotification.replace("{url}",data.menuitems[i].url).replace("{unread}",data.menuitems[i].unread?"navUnread":""),data.menuitems[i].img?item=item.replace("{image}",templates.templateNotificationUsercardImage.replace("{imageUrl}",data.menuitems[i].img)):(gender=(data.menuitems[i].gender||"").toLowerCase(),genderIcon=gender==="male"?"Male":gender==="female"?"Female":"Person",item=item.replace("{image}",templates.templateNotificationUsercardIcon.replace("{icon}",genderIcon))),item=item.replace("{title}",data.menuitems[i].title).replace("{badge}",data.menuitems[i].visited?"":templates.templateBadge.replace("{text}",templates.templateNew)).replace("{subtitle}",data.menuitems[i].name).replace("{meta}",data.menuitems[i].date+", "+data.menuitems[i].test),html+=item;$("#navDnaNotificationsList").html(html);$("#navHasDnaNotifications").removeClass("noDisplay");$("#navNoDnaNotifications").addClass("noDisplay");bindSeeMoreDnaButton();handleDisplayOfSeeMoreDnaButton()}else $("#navNoDnaNotifications").removeClass("noDisplay"),$("#navHasDnaNotifications").addClass("noDisplay");hideLoadingMessageOnSubmenu("#navDnaNotificationsMenu")}function showCount(area,count){var $area=$(area),$badge=$area.find(".badge");$badge.remove();count>0?$badge.html(count>99?"99+":count).removeClass("noDisplay"):$badge.addClass("noDisplay");$badge.appendTo($area)}function showDnaNotificationIcon(){$("#navDnaNotifications").removeClass("noDisplay")}function showLoadingMessageOnSubmenu(submenuId){$(submenuId+"Loading").attr("aria-busy","true").removeClass("noDisplay")}function hideLoadingMessageOnSubmenu(submenuId){$(submenuId+"Loading").attr("aria-busy","false").addClass("noDisplay")}function handleDisplayOfSeeMoreDnaButton(){var $hiddenNotifications=$("#navDnaNotificationsList .navListItem:not(:visible)");$hiddenNotifications.length?$("#navSeeMoreDnaNotifications").removeClass("noDisplay"):$("#navSeeMoreDnaNotifications").addClass("noDisplay")}function prepareTemplates(){templates===null&&(templates={templatesPrepared:!0,templateNew:$("#templateNew").html(),templateBadge:$("#templateBadge").html(),templateNotification:$("#templateNotification").html(),templateNotificationTypeIcon:$("#templateNotificationTypeIcon").html(),templateNotificationUsercardIcon:$("#templateNotificationUsercardIcon").html(),templateNotificationUsercardImage:$("#templateNotificationUsercardImage").html(),templateEmphasizedButton:$("#templateEmphasizedButton").html(),templateEmphasizedMobileButton:$("#templateEmphasizedMobileButton").html()},$(".navTemplates").remove())}function renderCachedMenuOrDisplayLoadingMessage(key,menuId,renderingFunction){settings.cachedData&&settings.cachedData[key]&&settings.cachedData[key].success?renderingFunction(settings.cachedData[key]):showLoadingMessageOnSubmenu("#"+menuId)}function personalizeHeader(){prepareTemplates();showLoadingMessageOnSubmenu("#navDnaMenu");renderCachedMenuOrDisplayLoadingMessage("trees","navTreesMenu",renderTrees);renderCachedMenuOrDisplayLoadingMessage("hints","navHintsMenu",renderHints);renderCachedMenuOrDisplayLoadingMessage("messages","navMessagesMenu",renderMessages);renderCachedMenuOrDisplayLoadingMessage("dnaNotifications","navDnaNotificationsMenu",renderDnaNotifications);loadUserInfo()}function unbindEvents(){$('#nav, #nav a[href*="//www.progenealogists.com"], #nav [aria-owns], .navSubMenu, .navMobileMenu, #navSeeAllHintsIn, #username').off(".nav")}function loadUserInfo(bypassCache){var options={url:settings.ajaxUrl+(bypassCache?"?bypassCache=true":""),success:function(data){data.user&&(renderUsername(data.user.name,data.user.image),renderUpsellLink(data.user.subscribeUrl,data.user.subscribeText,data.user.isFullAccessFreeTrialer),data.cart&&(updateCartLinks(data.cart),bindCartTracking()),showCount("#navMessages",data.messagecount),showCount("#navHints",data.hintcount),data.showDnaNotification&&(showDnaNotificationIcon(),showCount("#navDnaNotifications",data.dnaCount)),initCalloutSubMenus());$(".navSecondaryMenuUnloaded").removeClass("navSecondaryMenuUnloaded")}};settings.testing&&(options.testResponse=settings.testing.userinfo);ajax(options)}function updateQueryStringParameter(uri,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=uri.indexOf("?")!==-1?"&":"?";return uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value}function warn(name){console.warn("Header Resource Missing : "+name);fireTracking("Header Resource Missing : "+name+" : "+window.location.hostname+window.location.pathname)}function initializeHeader(){if(!getStaticAssets())return setTimeout(initializeHeader,200),!1;correctDomLocation();bindEvents();obj.setSelectedPage(settings.selectedTabName);settings.isLoggedIn&&(personalizeHeader(),handleBadges());settings.showHireAnExpertWarning&&bindExpertWarning()}var obj={},instance,suppressAssetInjection=headerConfig&&headerConfig.suppressAssetInjection,cssAssetsRequested=!1,jsAssetsRequested=!1,badgeCookieName="navbadges",settings={isLoggedIn:!1,dnaUrl:"//dna.ancestry.com",ajaxUrl:"//navigation.ancestry.com/ajax/userdata/2.1",hintsAjaxUrl:"//navigation.ancestry.com/ajax/Hints",messagesAjaxUrl:"//navigation.ancestry.com/ajax/Messages","treesAjaxUrl ":"//navigation.ancestry.com/ajax/Trees","dnaNotificationsAjaxUrl ":"//navigation.ancestry.com/ajax/DnaNotifications","userAjaxUrl ":"//navigation.ancestry.com/ajax/UserInfo",selectedTabName:!1,jQueryTimeout:1e4,cookieDomain:"ancestry.com",cacheDomain:"//c.mfcreative.com"},lastRequestedTime={},templates=null;return obj.setReturnUrl=function(returnUrl){var $link=$("a#navAccount"),href=$link.attr("href");href=updateQueryStringParameter(href,"returnUrl",encodeURIComponent(returnUrl));$link.attr("href",href)},obj.setSelectedPage=function(selectedTab){selectedTab&&$(".nav").find('.navLinkSelected:not(".nav'+selectedTab+'")').removeClass("navLinkSelected").end().find(".nav"+selectedTab).addClass("navLinkSelected")},obj.updateUserData=function(key){switch(key){case"trees":case"mobile":loadSubMenu(settings.treesAjaxUrl,renderTrees,"trees");break;case"hints":loadSubMenu(settings.hintsAjaxUrl+"?bypassCache=true",renderHints,"hints");break;case"messages":loadSubMenu(settings.messagesAjaxUrl+"?bypassCache=true",renderMessages,"messages");break;case"user":loadUserInfo(!0);break;case"dna":loadSubMenu(settings.dnaUrl+"/rest/headerinfo",renderDna,"dna");break;case"dnanotifications":loadSubMenu(settings.dnaNotificationsAjaxUrl,renderDnaNotifications,"dnaNotifications")}},obj.init=function(options){return instance!==undefined&&unbindEvents(),instance=$.extend(settings,options),setTimeout(initializeHeader,10),instance},obj}(jQuery,typeof headerConfig=="undefined"?null:headerConfig),AHS={};AHS.SetMessagesCount=function(){window.sc_npv&&sc_npv("prop70","Header 2.1 : Test : Called AHS.SetMessagesCount",0)};AHS.SetHintsCount=function(){window.sc_npv&&sc_npv("prop70","Header 2.1 : Test : Called AHS.SetHintsCount ",0)}