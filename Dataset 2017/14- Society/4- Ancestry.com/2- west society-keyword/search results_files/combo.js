(function($){"use strict";var defaults={customClasses:"",notchCount:4,notchWidth:"auto",handleAnimationTime:120,handleAnimationType:"linear",startingNotch:2,notchChange:function(){}};$.fn.slider=function(options){return this.each(function(){function initSettings(){return settings.notchData=settings.notchCount,typeof settings.notchCount=="object"?settings.notchCount=settings.notchCount.length:typeof settings.notchCount=="number"?settings.notchCount=settings.notchCount:console.warn("notchCount must be array or number"),settings.notchCount}function createTrack(){return $this.addClass("sliderDirective"),$this.data("slider-track",$("<div class='track'><\/div>").appendTo($this))}function createTrackCover(){return $this.data("slider-trackCover",$("<div class='trackCover'><\/div>").appendTo($this))}function isNotchDataAvailable(i){return typeof settings.notchData[i]!="undefined"&&typeof settings.notchData[i].value!="undefined"&&settings.notchData[i]!==null&&settings.notchData[i].value!==null}function createTriggerNotchesForCallouts(){var notchContent="",i,label="",notchPosition=0;if(settings.notchCount>1)for(i=0;i<settings.notchCount;i++)isNotchDataAvailable(i)&&(label=settings.notchData[i].label),notchContent+='<div class="notchTrigger calloutTriggerNoArrow" style="left:'+notchPosition+"%; width:"+100/settings.notchCount+"%; margin-left:-"+50/settings.notchCount+'px;" data-callout="'+label+'"><\/div>',notchPosition+=100/(settings.notchCount-1);$this.prepend(notchContent)}function createNotches(){var notchContent="",i,notchPosition=0;if(startingNotch=$this.find(".notch:eq("+settings.startingNotch+")"),settings.notchCount>1)for(i=0;i<settings.notchCount;i++)notchContent+='<div class="notch vHidden" style="left:'+notchPosition+'%;"><\/div>',notchPosition+=100/(settings.notchCount-1);else $this.css("opacity","0.5"),$this.off(),console.warn("Notch count must be 2 or more");return $this.data("slider-notches",$(notchContent).appendTo($this)).first().addClass("notchComp")}function createHandle(){var handleWidth;return handleWidth=settings.notchWidth!=="small"?$this.width()/settings.notchCount+10:27,$this.data("slider-handle",$("<button class='handle ancBtn tin silver calloutTriggerNoArrow'><\/button>").css({width:handleWidth,"margin-left":-handleWidth/2+$(".notch").width()/2-3+"px"}).appendTo($this).data("slider-default-position",settings.startingNotch))}function initHandlePosition(e){$handle=$this.find(".handle");var startingNotchIndex=$handle.data("slider-default-position"),notch=$this.find(".notch:eq("+startingNotchIndex+")");moveHandle(e,notch,startingNotchIndex,!1)}function initNotchCallout(){var $notchTrigger=$this.find(".notchTrigger");$notchTrigger.each(function(i){var notch=$notchTrigger.eq(i),notchContent=$.callout.content(notch,"<span>"+notch.data("callout")+"<\/span>");notch.callout({position:"top",align:"center",content:notchContent,calloutClasses:"sfsNotchCallout",type:"hover",style:"light",keepContentInPlace:!1,showDelay:0,hideDelay:0,onAfterOpen:function(){renderCalloutCloseBindings($notchTrigger.eq(i))}})})}function renderHandleCallouts(){if(settings.useCallouts===!0){setTimeout(function(){initNotchCallout()},10);$handle.on({"touchend mouseleave":function(){var selectedNotch=$this.find(".notchTrigger").eq($handle.data("slider-notch-position"));selectedNotch.callout("close")},"mouseenter mouseleave":function(e){var selectedNotch=$this.find(".notchTrigger").eq($handle.data("slider-notch-position"));selectedNotch.trigger(e.type)}})}}function moveHandle(event,notch,notchIndex,animate){var selectedNotch=$this.find(".notchTrigger").eq(notchIndex);return $handle.data("slider-label",$(".notch").eq(notchIndex).data("callout")),$handle.data("slider-notch-position",notchIndex),$this.data("slider-notch-position",notchIndex),typeof jQuery.ui=="undefined"&&(settings.handleAnimationType="linear"),animate===!0?$handle.animate({left:notch.css("left")},{duration:settings.handleAnimationTime,easing:settings.handleAnimationType}):$handle.css("left",notch.css("left")),event&&event.type!=="resize"&&selectedNotch&&selectedNotch.callout("open"),currentNotchIndex=notchIndex}function setHandleColor(){var notchPosition=$handle.data("slider-notch-position");settings.startingNotch===notchPosition&&$handle.hasClass("green")?$handle.removeClass("green").addClass("silver"):settings.startingNotch!==notchPosition&&$handle.hasClass("silver")&&$handle.removeClass("silver").addClass("green")}function renderHandleBinding(){$handle.on({"touchstart mousedown":function(){$(this).addClass("draggable");$this.find(".track").show()}})}function renderCalloutCloseBindings(){$(".sfsNotchCallout").on("mouseenter mouseleave",function(){var $calloutEl=$(".sfsNotchCallout");$calloutEl.hide()})}function addHoverClass(){var $track=$this.find(".track");$track.hasClass("hover")||$track.addClass("hover")}function addNotchClass(){var $notch=$this.find(".notch");$notch.hasClass("hover")||$notch.addClass("hover")}function renderSliderBindings(){renderHandleBinding();$("body").on({"touchend mouseup":function(){setHandleColor();$this.find(".notch").addClass("vHidden");$handle.removeClass("draggable");$handle.stop(!0,!0);$this.find(".track").removeClass("hover")},"touchstart touchmove mousemove":function(e){var notchIndex,notch;$handle.hasClass("draggable")&&(notchIndex=getNotchIndexForEvent(e),currentNotchIndex!==notchIndex&&(notch=$this.find(".notch:eq("+notchIndex+")"),moveHandle(e,notch,notchIndex,!1),settings.notchCount==2&&renderHandleBinding(),addHoverClass()));$handle.hasClass("draggable")&&($this.find(".track").show(),$this.find(".notch").removeClass("vHidden"))}});$this.on({mouseover:function(){$this.find(".track").show();addHoverClass()},mouseenter:function(){$handle.hasClass("silver")&&$handle.removeClass("silver").addClass("green");addHoverClass()},mouseleave:function(){$handle.hasClass("draggable")||(setHandleColor(),$this.find(".track").show(),$this.find(".notch").addClass("vHidden"),$this.find(".track").removeClass("hover"))},"touchmove mousemove":function(e){var notchIndex=getNotchIndexForEvent(e),selectedNotch=$this.find(".notchTrigger").eq(notchIndex),notch=$this.find(".notch:eq("+notchIndex+")");$this.find(".notch").addClass("vHidden");addNotchClass();addHoverClass();notch.removeClass("vHidden");selectedNotch.trigger("mouseenter")},"touchend click":function(e){var notchIndex=getNotchIndexForEvent(e),notch=$this.find(".notch:eq("+notchIndex+")");addNotchClass();moveHandle(e,notch,notchIndex,!0);setHandleColor()}})}function getNotchIndexForEvent(e){typeof e.originalEvent!="undefined"&&typeof e.originalEvent.touches!="undefined"&&(e=e.originalEvent.touches[0]);var pixelsBetweenNotches=$this.width()/(settings.notchCount-1),cursorLeftOffsetFromSliderBar=e.clientX-$this.offset().left,notchIndex=Math.round(cursorLeftOffsetFromSliderBar/pixelsBetweenNotches);return notchIndex<0?notchIndex=0:notchIndex>settings.notchCount-1&&(notchIndex=settings.notchCount-1),notchIndex}function setupEventHandlers(){$this.on("click touchend",function(){settings.notchChange($this.data("slider-notch-position"))});$this.parents("body").bind("mousemove touchmove",function(){$this.find(".handle").hasClass("draggable")&&settings.notchChange($this.data("slider-notch-position"))})}var $this=$(this),$handle,startingNotch,currentNotchIndex,settings=$.extend({},defaults,options);initSettings();createTrack();createNotches();createTriggerNotchesForCallouts();createTrackCover();createHandle();initHandlePosition();renderSliderBindings();renderHandleCallouts();setupEventHandlers();$(window).resize(function(e){initHandlePosition(e)})})}})(jQuery);
(function(){var sliderApp=angular.module("SliderApp",["sliderWidgetModule"]);sliderApp.service("urlParsingService",["$window",function($window){function getUrlParts(url){var queryIndex=url.indexOf("?"),fragmentIndex=url.indexOf("#"),uriEndIndex=queryIndex>0?queryIndex:fragmentIndex>0?fragmentIndex:url.length,uri=url.substring(0,uriEndIndex),fragmentStr=fragmentIndex<0?"":url.substring(fragmentIndex),queryStr=queryIndex<0?"":url.substring(queryIndex,fragmentIndex<0?url.length:fragmentIndex);return{uri:uri,queryString:queryStr,fragment:fragmentStr}}function escapeStrToUseInRegex(str){return(str+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}this.getQueryStringValue=function(key){var keys,keyParts,keyValue;return typeof key!="string"?"":(keys=[key],keyParts=this.getKeyPartsOrNull(key),keyParts&&(keyParts.index==""?keys.push(keyParts.prefix+"0"+keyParts.suffix):keyParts.index=="0"&&keys.push(keyParts.prefix+keyParts.suffix)),keyValue="",$.each(keys,function(keyIndex,keyToTry){keyToTry=keyToTry.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+keyToTry+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec($window.location.href);if(results)return keyValue=decodeURIComponent(results[1].replace(/\+/g," ")),!1}),keyValue&&(keyValue=$.trim(keyValue)),keyValue)};this.getKeyPartsOrNull=function(key){var match=key.match(/^(ms[a-z]{3})(\d{0,2})((?:_|-).*)?$/),eventType,indexAsInt;return match?(eventType=match[0].substr(2,1),indexAsInt=match[2]==""?0:parseInt(match[2]),{eventType:eventType,inputName:match[0],prefix:match[1],index:match[2],indexAsInt:indexAsInt,suffix:match[3]||""}):null};this.removeURLParameter=function(url,parameter){var urlParts,i,queryPart,newQueryStr,newUrl;if(url||(url=$window.location.href),urlParts=getUrlParts(url),urlParts.queryString.length==0||urlParts.queryString=="?")return url;var queryParts=urlParts.queryString.substring(1).split("&"),encodedKey=encodeURIComponent(parameter),prefix=encodedKey+"=";for(i=0;i<queryParts.length;++i)queryPart=queryParts[i],(queryPart==encodedKey||queryPart.substring(0,prefix.length)==prefix)&&(queryParts.splice(i,1),--i);return newQueryStr=queryParts.length==0?"":"?"+queryParts.join("&"),newUrl=urlParts.uri+newQueryStr+urlParts.fragment,newUrl};this.updateQueryStringParameter=function(url,key,value){var re,separator,hash;return(url||(url=$window.location.href),re=new RegExp("([?]|&)"+escapeStrToUseInRegex(key)+"=.*?(&|#|$)(.*)","gi"),re.test(url))?typeof value!="undefined"&&value!==null?url.replace(re,"$1"+key+"="+value+"$2$3"):this.removeURLParameter(url,key):typeof value!="undefined"&&value!==null?(separator=url.indexOf("?")!==-1?"&":"?",hash=url.split("#"),url=hash[0]+separator+key+"="+value,typeof hash[1]!="undefined"&&hash[1]!==null&&(url+="#"+hash[1]),url):url}}]);sliderApp.factory("sliderLocalizationService",["$window",function($window){return typeof $window.Ancestry=="undefined"&&($window.Ancestry={}),typeof $window.Ancestry.SFS=="undefined"&&($window.Ancestry.SFS={}),typeof $window.Ancestry.SFS.Strings=="undefined"&&($window.Ancestry.SFS.Strings={}),{get:function(key){var str=$window.Ancestry.SFS.Strings[key],i,arg;if(str){for(i=1;i<arguments.length;++i)arg=arguments[i],str=str.replace("{"+(i-1)+"}",arg);return str}return null}}}]);sliderApp.factory("collectionPriorityService",function(){return function(){return Ancestry.SFS.CollectionSelectOptions}});sliderApp.controller("SliderController",["$scope","sliderResultsFactory","nonSliderDataService","collectionPriorityService","sliderLocalizationService","$window","urlParsingService",function($scope,sliderResultsFactory,nonSliderDataService,collectionPriorityService,sliderLocalizationService,$window,urlParsingService){$scope.ShouldDisableUpdateButton=function(){return $scope.Url==""};$scope.SubmitSearch=function(){$scope.ShouldDisableUpdateButton()||($window.location.href=$scope.Url)};$scope.SliderResults=sliderResultsFactory.getProcessedSliderData();$scope.CollectionFocusOptionForPartner=$window.Ancestry.SFS.CollectionFocusOptionForPartner;$scope.CurrentCollectionOptionSelected=0;$scope.Sbo=urlParsingService.getQueryStringValue("sbo");$scope.Url="";var updateUrlToRemovePaging=function(currentUrl){return currentUrl=urlParsingService.removeURLParameter(currentUrl,"pgoff"),currentUrl=urlParsingService.removeURLParameter(currentUrl,"fh"),currentUrl=urlParsingService.removeURLParameter(currentUrl,"fsk"),urlParsingService.removeURLParameter(currentUrl,"bsk")},getComparisonUrl=function(url){return urlParsingService.removeURLParameter(url,"msT")},updateUrlForTrackingParams=function(url){return urlParsingService.removeURLParameter(url,"msT")};$scope.UpdateUrlFromSliderData=function(item){var key=item.InputExactName,value=item.InputExactValue,currentUrl=$scope.Url,msav="MSAV",msadvCb="MS_AdvCB",msavValue=urlParsingService.getQueryStringValue(msav),currentCheckUrl,sliderCheckUrl;sliderResultsFactory.isLocationSlider(item)?urlParsingService.getQueryStringValue(item.InputPInfo)!==""?value===""?(currentUrl=urlParsingService.removeURLParameter(currentUrl,item.InputExactName),currentUrl=urlParsingService.removeURLParameter(currentUrl,item.InputGpidExact)):(currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,item.InputExactName,"1"),currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,item.InputGpidExact,value)):currentUrl=value===""?urlParsingService.removeURLParameter(currentUrl,item.InputExactName):urlParsingService.updateQueryStringParameter(currentUrl,item.InputExactName,value):sliderResultsFactory.isDateSlider(item)?value===""?(currentUrl=urlParsingService.removeURLParameter(currentUrl,item.InputExactName),currentUrl=urlParsingService.removeURLParameter(currentUrl,item.InputRange)):(currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,item.InputExactName,"1"),currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,item.InputRange,value)):currentUrl=value===""?urlParsingService.removeURLParameter(currentUrl,key):urlParsingService.updateQueryStringParameter(currentUrl,key,value);(value===""||value==="0")&&(urlParsingService.getQueryStringValue(msadvCb)==="1"&&(currentUrl=urlParsingService.removeURLParameter(currentUrl,msadvCb)),msavValue==="-1"?currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,msav,"0"):msavValue==="2"&&(currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,msav,"1")));currentUrl=updateUrlToRemovePaging(currentUrl);currentUrl=updateUrlForTrackingParams(currentUrl);currentCheckUrl=getComparisonUrl($window.location.href);sliderCheckUrl=getComparisonUrl(currentUrl);sliderCheckUrl===currentCheckUrl&&(currentUrl="");$scope.Url=currentUrl};$scope.FormHasError=!1;$scope.OssModel={yearStart:null,yearEnd:null};$scope.ShouldShowOssYearRange=!1;$scope.SetOssModelFromOssParam=function(){$scope.OssModel.yearStart=urlParsingService.getQueryStringValue("ossyear");$scope.OssModel.yearEnd=urlParsingService.getQueryStringValue("ossyearend");($scope.OssModel.yearStart||$scope.OssModel.yearEnd)&&($scope.ShouldShowOssYearRange=!0)};$scope.SetOssModelFromOssParam();$scope.UpdateUrlForOssYearRange=function(ossObj){var ossYearStart="ossyear",ossYearEnd="ossyearend",currentUrl=$window.location.href;return(ossObj.yearStart||ossObj.yearStart==="")&&(currentUrl=ossObj.yearStart===""?urlParsingService.removeURLParameter(currentUrl,ossYearStart):urlParsingService.updateQueryStringParameter(currentUrl,ossYearStart,ossObj.yearStart)),(ossObj.yearEnd||ossObj.yearEnd==="")&&(currentUrl=ossObj.yearEnd===""?urlParsingService.removeURLParameter(currentUrl,ossYearEnd):urlParsingService.updateQueryStringParameter(currentUrl,ossYearEnd,ossObj.yearEnd)),currentUrl===$window.location.href&&(currentUrl=""),$scope.Url=currentUrl};$scope.CollectionSelectModel={value:null};$scope.showCollectionPriority=nonSliderDataService.hasCollectionPriority();$scope.CollectionSelectOptions=collectionPriorityService();$scope.SetInitialOptionFromCollectionParam=function(){for(var useDefault=!0,i=0;i<$scope.CollectionSelectOptions.length;i++)if(urlParsingService.getQueryStringValue("cp")===$scope.CollectionSelectOptions[i].value){$scope.CollectionSelectModel.value=$scope.CollectionSelectOptions[i].value;useDefault=!1;break}return useDefault&&($scope.CollectionSelectModel.value=$scope.CollectionFocusOptionForPartner.toString()),$scope.CurrentCollectionOptionSelected=$scope.CollectionSelectModel.value,$scope.CollectionSelectModel.value};$scope.UpdateUrlFromCollectionSelect=function(){var currentUrl=$scope.Url,sbo="sbo";currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,"cp",$scope.CollectionSelectModel.value);currentUrl=urlParsingService.updateQueryStringParameter(currentUrl,"cpxt","1");urlParsingService.getQueryStringValue(sbo)==="0"&&(currentUrl=urlParsingService.removeURLParameter(currentUrl,sbo));currentUrl=updateUrlToRemovePaging(currentUrl);currentUrl===$window.location.href&&(currentUrl="");$scope.Url=currentUrl};$scope.SetInitialOptionFromCollectionParam();$scope.moreSearchFields=nonSliderDataService.getMoreSearchFieldsData();$scope.moreSearchFieldsText=sliderLocalizationService.get("moreSearchFields",$scope.moreSearchFields.TotalMemberCount);$scope.moreSearchFieldsExpanded=!urlParsingService.getQueryStringValue("ssrc");$scope.toggleMoreSearchFieldsExpansion=function(){$scope.moreSearchFieldsExpanded=!$scope.moreSearchFieldsExpanded}}])})();
angular.module("SliderApp").directive("ossYear",function(){return{link:function(scope){$("#ossForm input").on("blur",function(){var $this=$(this),$alert=$("#ossForm").find(".alert");scope.FormHasError?($this.parents("form").find("input").addClass("error"),$alert.alert("open")):($this.parents("form").find("input").removeClass("error"),$alert.alert("close"))});$("#ossForm input").on("keyup",function(){var $this=$(this),$alert=$("#ossForm").find(".alert"),yearStart=parseInt(scope.OssModel.yearStart,10),yearEnd=parseInt(scope.OssModel.yearEnd,10);scope.$apply(function(){scope.FormHasError=yearStart>yearEnd?!0:!1});scope.$apply(function(){scope.FormHasError?scope.Url="":(scope.UpdateUrlForOssYearRange(scope.OssModel),$this.parents("form").find("input").removeClass("error"),$alert.alert("close"))})})}}});angular.module("SliderApp").directive("collectionSelectDirective",["urlParsingService",function(urlParsingService){return{link:function(scope,element,attrs){var selectChanged=!1,option="";scope.$watch(attrs.ngModel,function(){var cpParam=urlParsingService.getQueryStringValue("cp");option=scope.$eval(attrs.ngModel);selectChanged=option!==cpParam?!0:!1;selectChanged&&$("#refineView .updateFilters").removeAttr("href")})}}}]);
angular.module("SliderApp").service("configValues",["$window",function($window){return{getMaxSliderCount:function(){return $window.Ancestry&&$window.Ancestry.SFS&&$window.Ancestry.SFS.MaxSliders?$window.Ancestry.SFS.MaxSliders:10}}}]);angular.module("SliderApp").factory("sliderResultsFactory",["urlParsingService","sliderLocalizationService","nonSliderDataService","configValues",function(urlParsingService,localizationService,nonSliderDataService,configValues){function getProcessedSliderData(){var sliders=getAllSlidersWithValuesOnUrl(),filteredSliders=getFilteredSliders(sliders);return updateNonSliderDataServiceMetadataToExcludeValuesShownInSliders(filteredSliders),filteredSliders}function getAllSlidersWithValuesOnUrl(){for(var metadata,slider,queryIndex,indexStr,slidersMetadata=getSlidersMetadata(),sliders=[],i=0;i<slidersMetadata.length;i++)if(metadata=slidersMetadata[i],metadata.MaxCount)for(queryIndex=0;queryIndex<metadata.MaxCount;++queryIndex)indexStr=queryIndex==0?"":""+queryIndex,slider={InputName:metadata.InputNameFormat.replace("{0}",indexStr),InputPrefix:metadata.InputPrefix,NotchArray:metadata.NotchArray.slice(0)},metadata.InputRangeFormat?slider.InputRange=metadata.InputRangeFormat.replace("{0}",indexStr):(slider.NotchArrayGpid=metadata.NotchArrayGpid.slice(0),slider.NotchArrayNoGpid=metadata.NotchArrayNoGpid.slice(0),slider.InputPrefix=metadata.InputPrefix,slider.InputGpid=metadata.InputGpidFormat.replace("{0}",indexStr)),slider=getSliderConfigurationWithUrlDataOrNull(slider),slider!=null&&sliders.push(slider);else slider=getSliderConfigurationWithUrlDataOrNull($.extend({},metadata)),slider!=null&&sliders.push(slider);return sliders}function getSliderConfigurationWithUrlDataOrNull(slider){if(slider==null)return null;var sliderLabel=urlParsingService.getQueryStringValue(slider.InputName);if(sliderLabel!==""){if(slider.InputLabel=sliderLabel,slider.InputExactName=slider.InputName+exactX,isDateSlider(slider)&&(slider.NotchArray[0].name=slider.InputName+exactX,slider.NotchArray[slider.NotchArray.length-1].name=slider.InputName+exactX),isLocationSlider(slider)&&(slider.InputGpidExact=slider.InputGpid+exactX,slider.InputPInfo=slider.InputGpid+pInfo,initializeNotchesForLocationEventSliders(slider)),setNotchFromQueryString(slider),typeof slider.StartingNotchNumber=="undefined"){if($.inArray(slider.InputName,SlidersToDefaultWhenHasInvalidExactness)==-1)return null;slider.StartingNotchNumber=0}return slider.InputExactValue=slider.NotchArray[slider.StartingNotchNumber].value,slider}return null}function getFilteredSliders(sliders){function removeSliderWithInputNameFromOptionalSlidersArray(inputName,addToFilteredArray){var sliderFindResult=findSliderWithInputName(inputName,optionalSliders);return sliderFindResult!=null&&(addToFilteredArray&&filteredSliders.push(sliderFindResult.slider),optionalSliders.splice(sliderFindResult.index,1)),sliderFindResult!=null?sliderFindResult.slider:null}var filteredSliders=[],optionalSliders=sliders.slice(0),i,slider,locationMatch,relatedDateSliderInputName,dateSliderFindResult,newIndex,oldIndex;removeSliderWithInputNameFromOptionalSlidersArray("gsfn",!0);removeSliderWithInputNameFromOptionalSlidersArray("gsln",!0);removeSliderWithInputNameFromOptionalSlidersArray("msbdy",!0)||removeSliderWithInputNameFromOptionalSlidersArray("msbdy0",!0);removeSliderWithInputNameFromOptionalSlidersArray("msbpn__ftp",!0)||removeSliderWithInputNameFromOptionalSlidersArray("msbpn0__ftp",!0);var group1Length=filteredSliders.length,deathSliderDate=removeSliderWithInputNameFromOptionalSlidersArray("msddy",!1)||removeSliderWithInputNameFromOptionalSlidersArray("msddy0",!1),deathSliderLocation=removeSliderWithInputNameFromOptionalSlidersArray("msdpn__ftp",!1)||removeSliderWithInputNameFromOptionalSlidersArray("msdpn0__ftp",!1),eventTypeSortOrder=["b","g","m","r","a","e","i","y","w","d"];for(optionalSliders.sort(function(slider1,slider2){var date1=parseInt(urlParsingService.getQueryStringValue(slider1.InputName)),date2=parseInt(urlParsingService.getQueryStringValue(slider2.InputName)),isSlider1Date=slider1.InputRange&&!isNaN(date1),isSlider2Date=slider2.InputRange&&!isNaN(date2),isSlider1Location,isSlider2Location;if(isSlider1Date&&!isSlider2Date)return-1;if(isSlider2Date&&!isSlider1Date)return 1;if(!isSlider1Date&&!isSlider2Date){if(isSlider1Location=typeof slider1.InputGpid!="undefined",isSlider2Location=typeof slider2.InputGpid!="undefined",isSlider1Location&&!isSlider2Location)return-1;if(!isSlider1Location&&isSlider2Location)return 1;if(!isSlider1Location&&!isSlider2Location)return 0;var slider1KeyParts=urlParsingService.getKeyPartsOrNull(slider1.InputName),slider2KeyParts=urlParsingService.getKeyPartsOrNull(slider2.InputName),slider1EventTypeIndex=$.inArray(slider1KeyParts.eventType,eventTypeSortOrder),slider2EventTypeIndex=$.inArray(slider2KeyParts.eventType,eventTypeSortOrder);return slider1EventTypeIndex<slider2EventTypeIndex?-1:slider1EventTypeIndex>slider2EventTypeIndex?1:slider1KeyParts.indexAsInt<slider2KeyParts.indexAsInt?-1:slider1KeyParts.indexAsInt>slider2KeyParts.indexAsInt?1:0}return date1>date2?1:date1<date2?-1:0}),filteredSliders=filteredSliders.concat(optionalSliders),deathSliderDate!=null&&filteredSliders.push(deathSliderDate),deathSliderLocation!=null&&filteredSliders.push(deathSliderLocation),i=filteredSliders.length-1;i>=0;--i)slider=filteredSliders[i],locationMatch=slider.InputName.match(/^ms([a-z])pn(\d{0,2})__ftp$/),locationMatch&&(relatedDateSliderInputName="ms"+locationMatch[1]+"dy"+locationMatch[2],dateSliderFindResult=findSliderWithInputName(relatedDateSliderInputName,filteredSliders),dateSliderFindResult!=null&&(slider.IsNested=!0,slider.InputPrefix=localizationService.get("InLabelSliderPrefix")+": ",newIndex=dateSliderFindResult.index+1,oldIndex=i,newIndex<oldIndex&&(filteredSliders.splice(oldIndex,1),filteredSliders.splice(newIndex,0,slider),++i)));if(urlParsingService.getQueryStringValue("ssrc")){var slidersToRemoveCount=Math.max(filteredSliders.length-configValues.getMaxSliderCount(),0),arr1=filteredSliders.slice(0,group1Length),arr2=filteredSliders.slice(group1Length,group1Length+optionalSliders.length),arr3=filteredSliders.slice(group1Length+optionalSliders.length),slidersRemovedCount=limitSlidersArray(arr2,slidersToRemoveCount);filteredSliders=arr1.concat(arr2).concat(arr3);limitSlidersArray(filteredSliders,slidersToRemoveCount-slidersRemovedCount)}return filteredSliders}function limitSlidersArray(sliders,limit){var slidersToRemoveCount=Math.min(sliders.length,limit),startRemoveIndex,firstSliderToRemove;return slidersToRemoveCount<=0||sliders.length==0?0:(startRemoveIndex=sliders.length-slidersToRemoveCount,firstSliderToRemove=sliders[startRemoveIndex],firstSliderToRemove.IsNested&&(startRemoveIndex--,slidersToRemoveCount++),sliders.splice(startRemoveIndex,slidersToRemoveCount),slidersToRemoveCount)}function findSliderWithInputName(inputName,sliders){for(var i=0;i<sliders.length;++i)if(sliders[i].InputName===inputName)return{slider:sliders[i],index:i};return null}function existsInStringArrayCaseInsensitive(array,value){var valueLowerCase,i;if(!array||array.length===0||value==null)return!1;for(valueLowerCase=value.toLowerCase(),i=0;i<array.length;i++)if(array[i].toLowerCase()===valueLowerCase)return!0;return!1}function setNotchFromQueryString(sliderConfig){var notchIndex;if(isDateSlider(sliderConfig)){var dateExactValue=urlParsingService.getQueryStringValue(sliderConfig.InputExactName),isDateExact=dateExactValue=="1"||dateExactValue=="XO",isDateSliderWithExactSearchAndNoProximity=isDateExact&&urlParsingService.getQueryStringValue(sliderConfig.InputRange)==="";if(isDateSliderWithExactSearchAndNoProximity){sliderConfig.StartingNotchNumber=sliderConfig.NotchArray.length-1;return}}else if(isLocationSlider(sliderConfig)&&urlParsingService.getQueryStringValue(sliderConfig.InputGpid)!=""&&urlParsingService.getQueryStringValue(sliderConfig.InputPInfo)=="")return;for(notchIndex=0;notchIndex<sliderConfig.NotchArray.length;notchIndex++)if(doesUrlValueIndicateThisNotchPositionShouldBeUsed(sliderConfig,notchIndex)){sliderConfig.StartingNotchNumber=notchIndex;break}}function doesUrlValueIndicateThisNotchPositionShouldBeUsed(sliderConfig,n){var valuesForNotchPosition=[sliderConfig.NotchArray[n].value],inputExactnessValue;return sliderConfig.NotchArray[n].alternateValues&&(valuesForNotchPosition=valuesForNotchPosition.concat(sliderConfig.NotchArray[n].alternateValues)),inputExactnessValue=isDateSlider(sliderConfig)?urlParsingService.getQueryStringValue(sliderConfig.InputRange):isLocationSlider(sliderConfig)?urlParsingService.getQueryStringValue(sliderConfig.InputGpid)!=""?urlParsingService.getQueryStringValue(sliderConfig.InputGpidExact):urlParsingService.getQueryStringValue(sliderConfig.InputExactName):urlParsingService.getQueryStringValue(sliderConfig.InputExactName),existsInStringArrayCaseInsensitive(valuesForNotchPosition,inputExactnessValue)}function isDateSlider(slider){return typeof slider.InputRange!="undefined"}function isLocationSlider(slider){return typeof slider.InputGpid!="undefined"}function removeItemsFromNotchArrayForGpid(notchArray,item){for(var idx=-1,i=0;i<notchArray.length;i++)if(notchArray[i].value==item){idx=i;break}idx>=0&&notchArray.splice(idx,1)}function initializeNotchesForLocationEventSliders(sliderConfig){var pInfoValue,levelId,exactNotchAlternateValues;if(isLocationSlider(sliderConfig))if(pInfoValue=urlParsingService.getQueryStringValue(sliderConfig.InputPInfo),pInfoValue==="")sliderConfig.NotchArray=sliderConfig.NotchArrayNoGpid.slice(0);else{sliderConfig.NotchArray=sliderConfig.NotchArrayGpid.slice(0);levelId=parseInt(pInfoValue.split("|")[0].replace("-",""));exactNotchAlternateValues=sliderConfig.NotchArray[sliderConfig.NotchArray.length-1].alternateValues;switch(levelId){case 7:removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PCO");exactNotchAlternateValues.push("PCO");break;case 6:case 5:removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PS");removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PACO");removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PCO");exactNotchAlternateValues.push("PS");break;case 4:case 3:case 2:case 1:case 0:removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PACO");removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PCO");removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PS");removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PAS");removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PC");exactNotchAlternateValues.push("PC")}(levelId>=7&&pInfoValue.indexOf("|5027|")!==-1||pInfoValue.indexOf("|3243|")!==-1)&&(removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PACO"),removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PCO"));(levelId>=5&&pInfoValue.indexOf("|3257|")!==-1&&(pInfoValue.indexOf("|5250|")!==-1||pInfoValue.indexOf("|3251|")!==-1)||pInfoValue.indexOf("|3250|")!==-1)&&(removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PAS"),removeItemsFromNotchArrayForGpid(sliderConfig.NotchArray,"PS"))}}function updateNonSliderDataServiceMetadataToExcludeValuesShownInSliders(sliders){for(var slider,i=0;i<sliders.length;++i)slider=sliders[i],nonSliderDataService.removeMoreSearchFieldByInputName(slider.InputName)}function getSlidersMetadata(){var i,sliderMetadata;if(slidersMetadataStore)return slidersMetadataStore;for(slidersMetadataStore=[{InputName:"gsfn",NotchArray:[{value:"0",label:localizationService.get("BroadSearchFilterLabel")},{value:"NP_NN_NIC",alternateValues:["NP_NIC","NN_NIC","NIC"],label:localizationService.get("ExactSimilarSoundsLikeInitialsSliderFilterText")},{value:"NP_NN",alternateValues:["NP"],label:localizationService.get("ExactSoundsLikeSimilarSliderFilterText")},{value:"NN",label:localizationService.get("ExactSimilarSliderFilterText")},{value:"XO",alternateValues:["1"],label:localizationService.get("ExactLabel")}]},{InputName:"gsln",NotchArray:[{value:"NS_NP_NN",alternateValues:["NS_NP","NS_NN","NS"],label:localizationService.get("BroadSearchFilterLabel")},{value:"NP_NN",alternateValues:["","0","NP"],label:localizationService.get("ExactSoundsLikeSimilarSliderFilterText")},{value:"NN",label:localizationService.get("ExactSimilarSliderFilterText")},{value:"XO",alternateValues:["1"],label:localizationService.get("ExactLabel")}]},{InputName:"msbdy",InputPrefix:localizationService.get("BornSliderPrefixLabel")+": ",InputRange:"msbdp"},{InputName:"msbpn__ftp",InputPrefix:localizationService.get("BornSliderPrefixLabel")+": ",InputGpid:"msbpn"},{InputName:"msgdy",InputPrefix:localizationService.get("SliderMarriageLabel")+": ",InputRange:"msgdp"},{InputName:"msgpn__ftp",InputPrefix:localizationService.get("SliderMarriageLabel")+": ",InputGpid:"msgpn"},{InputName:"msmdy",InputPrefix:localizationService.get("SliderMarriageLabel")+": ",InputRange:"msmdp"},{InputName:"msmpn__ftp",InputPrefix:localizationService.get("SliderMarriageLabel")+": ",InputGpid:"msmpn"},{InputNameFormat:"msrpn{0}__ftp",InputPrefix:localizationService.get("ResidenceEventLabel")+": ",InputGpidFormat:"msrpn{0}",MaxCount:11},{InputNameFormat:"msrdy{0}",InputPrefix:localizationService.get("ResidenceEventLabel")+": ",InputRangeFormat:"msrdp{0}",MaxCount:11},{InputName:"msady",InputPrefix:localizationService.get("ArrivalEventLabel")+": ",InputRange:"msadp"},{InputName:"msapn__ftp",InputPrefix:localizationService.get("ArrivalEventLabel")+": ",InputGpid:"msapn"},{InputName:"msedy",InputPrefix:localizationService.get("DepartureEventLabel")+": ",InputRange:"msedp"},{InputName:"msepn__ftp",InputPrefix:localizationService.get("DepartureEventLabel")+": ",InputGpid:"msepn"},{InputName:"msidy",InputPrefix:localizationService.get("MilitaryEventLabel")+": ",InputRange:"msidp"},{InputName:"msipn__ftp",InputPrefix:localizationService.get("MilitaryEventLabel")+": ",InputGpid:"msipn"},{InputNameFormat:"msydy{0}",InputPrefix:localizationService.get("AnyLabelSliderPrefix")+": ",InputRangeFormat:"msydp{0}",MaxCount:11},{InputNameFormat:"msypn{0}__ftp",InputPrefix:localizationService.get("AnyLabelSliderPrefix")+": ",InputGpidFormat:"msypn{0}",MaxCount:11},{InputNameFormat:"mswpn{0}__ftp",InputPrefix:localizationService.get("AnyLabelSliderPrefix")+": ",InputGpidFormat:"mswpn{0}",MaxCount:11},{InputName:"msddy",InputPrefix:localizationService.get("DeathEventLabel")+": ",InputRange:"msddp"},{InputName:"msdpn__ftp",InputPrefix:localizationService.get("DeathEventLabel")+": ",InputGpid:"msdpn"}],i=0;i<slidersMetadataStore.length;++i)sliderMetadata=slidersMetadataStore[i],sliderMetadata.InputGpid||sliderMetadata.InputGpidFormat?(sliderMetadata.NotchArray=[],sliderMetadata.NotchArrayGpid=[{value:"",alternateValues:["0"],label:localizationService.get("BroadSearchFilterLabel")},{value:"PC",label:localizationService.get("CountryOptionText")},{value:"PAS",label:localizationService.get("StateAndAdjacentStatesOptionText")},{value:"PS",label:localizationService.get("StateOptionText")},{value:"PACO",label:localizationService.get("CountyAndAdjacentCountiesOptionText")},{value:"PCO",label:localizationService.get("CountyOptionText")},{value:"XO",alternateValues:["1"],label:localizationService.get("ExactLabel")}],sliderMetadata.NotchArrayNoGpid=[{value:"",alternateValues:["0"],label:localizationService.get("BroadSearchFilterLabel")},{value:"XO",alternateValues:["1"],label:localizationService.get("ExactLabel")}]):(sliderMetadata.InputRange||sliderMetadata.InputRangeFormat)&&(sliderMetadata.NotchArray=[{value:"",label:localizationService.get("BroadSearchFilterLabel")},{value:"10",label:"+/- 10 "+localizationService.get("YearSliderFilterText")},{value:"5",label:"+/- 5 "+localizationService.get("YearSliderFilterText")},{value:"2",label:"+/- 2 "+localizationService.get("YearSliderFilterText")},{value:"1",label:"+/- 1 "+localizationService.get("YearSliderFilterText")},{value:"_x",label:localizationService.get("ExactLabel")}]);return slidersMetadataStore}var exactX="_x",pInfo="_PInfo",SlidersToDefaultWhenHasInvalidExactness=["gsfn","gsln","msbdy","msbdy0","msbpn__ftp","msbpn0__ftp","msddy","msddy0","msdpn__ftp","msdpn0__ftp"],slidersMetadataStore=null;return{getProcessedSliderData:getProcessedSliderData,isDateSlider:isDateSlider,isLocationSlider:isLocationSlider}}]);
angular.module("SliderApp").service("nonSliderDataService",["urlParsingService","sliderLocalizationService",function(urlParsingService,localizationService){function hasCollectionPriority(){var gl=urlParsingService.getQueryStringValue("gl"),cp=urlParsingService.getQueryStringValue("cp"),db=urlParsingService.getQueryStringValue("db"),showCollections=!1;return gl&&(gl==="ROOT_CATEGORY"||gl==="allgs")?showCollections=!0:db||(gl&&!isNaN(gl)?showCollections=!0:cp?showCollections=!0:gl||db||(showCollections=!0)),showCollections}function getMoreSearchFieldsData(){for(var labelGroupMetadata,labelGroup,searchTypeIndex,searchType,i,summaryLine,summary,totalMemberCount,labelGroupsMetadata=getMoreSearchFieldsMetaData(),labelGroups=[],labelIndex=0;labelIndex<labelGroupsMetadata.length;labelIndex++){if(labelGroupMetadata=labelGroupsMetadata[labelIndex],labelGroup={Label:labelGroupMetadata.InputLabelPrefix,Summary:[],MemberCount:0},labelGroupMetadata.SubGroup)for(searchTypeIndex=0;searchTypeIndex<labelGroupMetadata.SubGroup.length;searchTypeIndex++)for(searchType=labelGroupMetadata.SubGroup[searchTypeIndex],i=searchType.StartIndex;i<searchType.MaxCount;i++)summaryLine="",hasFirstOrLastName(searchType)?($.inArray(searchType.InputFirstName+i,searchType.ExcludeList)==-1&&(summaryLine+=urlParsingService.getQueryStringValue(searchType.InputFirstName+i)+" "),$.inArray(searchType.InputLastName+i,searchType.ExcludeList)==-1&&(summaryLine+=urlParsingService.getQueryStringValue(searchType.InputLastName+i))):hasInputNameOrLocation(searchType)&&($.inArray(searchType.InputName+i,searchType.ExcludeList)==-1&&(summaryLine+=urlParsingService.getQueryStringValue(searchType.InputName+i)+" "),$.inArray(searchType.InputGpid+i,searchType.ExcludeList)==-1&&(summaryLine+=urlParsingService.getQueryStringValue(searchType.InputGpid+i+ftp))),summaryLine=$.trim(summaryLine),summaryLine&&(labelGroup.Summary.push(summaryLine),labelGroup.MemberCount++);else summary=urlParsingService.getQueryStringValue(labelGroupMetadata.InputName),summary&&labelGroupMetadata.Male&&labelGroupMetadata.Female&&(summary=summary==="f"||summary==="F"?labelGroupMetadata.Male:summary==="m"||summary==="M"?labelGroupMetadata.Female:""),labelGroupMetadata.InputPlaceName&&(summary+=" "+urlParsingService.getQueryStringValue(labelGroupMetadata.InputPlaceName)),summary=$.trim(summary),summary!=""&&(labelGroup.Summary.push(summary),labelGroup.MemberCount=1);labelGroup.MemberCount>0&&(labelGroupMetadata.SummaryOnWrappedLine&&(labelGroup.Summary=[labelGroup.Summary.join(", ")]),labelGroups.push(labelGroup))}return totalMemberCount=0,$.each(labelGroups,function(labelGroupIndex,labelGroup){totalMemberCount+=labelGroup.MemberCount}),{LabelGroups:labelGroups,TotalMemberCount:totalMemberCount}}function hasFirstOrLastName(item){return item.InputFirstName||item.InputLastName}function hasInputNameOrLocation(item){return item.InputName||item.InputGpid}function removeMoreSearchFieldByInputName(inputName){for(var groupMetadata,subGroupIndex,subGroup,metadata=getMoreSearchFieldsMetaData(),keyParts=urlParsingService.getKeyPartsOrNull(inputName),i=0;i<metadata.length;++i)if(groupMetadata=metadata[i],groupMetadata.SubGroup&&keyParts){for(subGroupIndex=0;subGroupIndex<groupMetadata.SubGroup.length;++subGroupIndex)if(subGroup=groupMetadata.SubGroup[subGroupIndex],subGroup.InputName==keyParts.prefix||subGroup.InputGpid==keyParts.prefix){subGroup.ExcludeList.push(keyParts.prefix+parseInt(keyParts.index||"0"));return}}else if(groupMetadata.InputName==inputName||groupMetadata.InputPlaceName==inputName){metadata.splice(i,1);return}}function getMoreSearchFieldsMetaData(){return moreSearchFieldsMetaDataStore!=null?moreSearchFieldsMetaDataStore:moreSearchFieldsMetaDataStore=[{InputLabelPrefix:localizationService.get("AnyLabelSliderPrefix"),SubGroup:[{InputName:"msydy",InputGpid:"msypn",MaxCount:11,StartIndex:0,ExcludeList:[]},{InputGpid:"mswpn",MaxCount:11,StartIndex:0,ExcludeList:[]}]},{InputLabelPrefix:localizationService.get("AlsoLivedInLabel"),SubGroup:[{InputName:"msrdy",InputGpid:"msrpn",MaxCount:11,StartIndex:0,ExcludeList:[]}]},{InputLabelPrefix:localizationService.get("MarriageEventLabel"),InputName:"msgdy",InputPlaceName:"msgpn__ftp"},{InputLabelPrefix:localizationService.get("ArrivalEventLabel"),InputName:"msady",InputPlaceName:"msapn__ftp"},{InputLabelPrefix:localizationService.get("DepartureEventLabel"),InputName:"msedy",InputPlaceName:"msepn__ftp"},{InputLabelPrefix:localizationService.get("MilitaryEventLabel"),InputName:"msidy",InputPlaceName:"msipn__ftp"},{InputLabelPrefix:localizationService.get("SlidersAnythingLabel"),InputName:"gskw"},{InputLabelPrefix:localizationService.get("RaceLabelSliderPrefix"),InputName:"_83004002"},{InputLabelPrefix:localizationService.get("GenderLabel"),InputName:"_83004003-n_xcl",Male:localizationService.get("Male"),Female:localizationService.get("Female")},{InputLabelPrefix:localizationService.get("ParentsSliderLabel"),SummaryOnWrappedLine:!0,SubGroup:[{InputFirstName:"msfng",InputLastName:"msfns",MaxCount:1,StartIndex:0,ExcludeList:[]},{InputFirstName:"msmng",InputLastName:"msmns",MaxCount:1,StartIndex:0,ExcludeList:[]}]},{InputLabelPrefix:localizationService.get("SiblingsSliderLabel"),SummaryOnWrappedLine:!0,SubGroup:[{InputFirstName:"msbng",MaxCount:10,StartIndex:0,ExcludeList:[]}]},{InputLabelPrefix:localizationService.get("SpousesSliderLabel"),SummaryOnWrappedLine:!0,SubGroup:[{InputFirstName:"mssng",InputLastName:"mssns",MaxCount:10,StartIndex:0,ExcludeList:[]}]},{InputLabelPrefix:localizationService.get("ChildrenSliderLabel"),SummaryOnWrappedLine:!0,SubGroup:[{InputFirstName:"mscng",MaxCount:10,StartIndex:0,ExcludeList:[]}]}]}var ftp="__ftp",moreSearchFieldsMetaDataStore=null;return{getMoreSearchFieldsData:getMoreSearchFieldsData,hasCollectionPriority:hasCollectionPriority,removeMoreSearchFieldByInputName:removeMoreSearchFieldByInputName}}]);
(function(){var sliderModule=angular.module("sliderWidgetModule",[]);sliderModule.directive("sliderDirective",function(){return{scope:{sliderItem:"=",sliderChange:"&"},link:function(scope,element){function getSliderValue(notchNumber){return notchNumber>=scope.sliderItem.NotchArray.length||notchNumber<0?null:scope.sliderItem.NotchArray[notchNumber].value}function getNotchNumber(value){for(var currentNotch,i=0;i<scope.sliderItem.NotchArray.length;i++)if(currentNotch=scope.sliderItem.NotchArray[i],currentNotch.value===value)return i;return 0}function notchChange(newNotchNumber){currentNotchNumber=newNotchNumber;scope.sliderItem.InputExactValue=getSliderValue(currentNotchNumber);sliderValueChangedInternally=!0;scope.$apply(function(){scope.sliderChange()})}function setupSlider(){element.empty();currentNotchNumber=getNotchNumber(scope.sliderItem.InputExactValue);sliderWidget=element.slider({startingNotch:currentNotchNumber,notchCount:scope.sliderItem.NotchArray,notchWidth:"small",radioName:scope.sliderItem.InputExactName,useCallouts:!0,handleAnimationType:"easeOutElastic",handleAnimationTime:400,notchChange:notchChange})}var currentNotchNumber,sliderValueChangedInternally=!1,sliderWidget=null;setupSlider();scope.$watch("sliderItem.NotchArray.length",function(newValue,oldValue){newValue!==oldValue&&setupSlider()});scope.$watch("sliderItem.InputExactValue",function(newValue,oldValue){sliderValueChangedInternally||newValue===oldValue||setupSlider();sliderValueChangedInternally=!1})}}})})()